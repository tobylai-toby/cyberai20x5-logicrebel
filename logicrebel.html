<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LogicRebel - Cyberpunk Coding Adventure</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono&display=swap">
  <script type="module" crossorigin>var GC=Object.defineProperty;var HC=(l,t,s)=>t in l?GC(l,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[t]=s;var Ee=(l,t,s)=>HC(l,typeof t!="symbol"?t+"":t,s);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const h of a.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function s(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(o){if(o.ep)return;o.ep=!0;const a=s(o);fetch(o.href,a)}})();var nn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function co(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var lv={exports:{}};(function(l,t){(function(s,r){l.exports=r()})(nn,function(){var s={},r,o,a,h,u,p,f,g,_,$,E,v,w,x,C,R,A,D,G,M,k,z,se,Q,ie,_e,ge,ue,St,pe,be,he,Ne,pt,Kt,ps,fs,gt,Ft,qe,xs,si,kt,os,ii,jt,Ut,qt,lt,It,Cs,ws,vi,fe,Xe,Ue,Fs,Jt,P,ri,$t,tt,Zt,Y,re,T,S,B,F,ee,Ye,Gt,ni,dn,Us,b,I,L,H,J,ce,ye,ls,qi,yr,Ji,uo,Yl,Eh,yh,pm,fm,gm,pn,mm,Kl,_m,po,jl,$m,ql,Tm,Jl,vh,Sh,Zl,Ql,ea,fo,bm,fn,go,ta,Em,ym,vm,Zi,xt,mo,Ih,Gs,Si,Sm,xh,sa,Ch,Im,wh,_o,xm,ia,Cm,wm,ra,Rm,gn,km,Rh,na,kh,Oh,Om,oa,mn,la,Am,Ah,Mh,Mm,Lm,vr,Pm,$o,gs,Nm,Dm,Bm,Fm,Um,Gm,Hm,Lh,Ii,_n,Ph,Vm,Wm,zm,Xm,Ym,Km,jm,qm,Jm,Nh,Zm,$n,aa,Qm,Tn,Dh,Bh,Fh,To,ca,Uh,e_,Gh,Hh,Vh,Wh,zh,Xh,Yh,t_,bo,Kh,ha,ua,oi,jh,qh,Eo,Jh,Zh,s_,da,Qh,i_,r_,n_,o_,l_,bn,eu,tu,En,pa,a_,c_,su,iu,xi,ru,nu,h_,u_,d_,p_,ou,f_,lu,g_,Sr,yo,fa,ga,Ir,au,ma,cu,at,m_,yn,xr,__,hu,_a,vn,uu,Cr,vo,du,pu,$_,T_,b_,fu,E_,gu,So,y_,v_,S_,I_,Io,mu,_u,$a,Ta,x_,xo,$u,Co,C_,w_,Qi,Tu,li,R_,k_,bu,O_,wr,Eu,A_,M_,L_,P_,N_,yu,D_,B_,ba,F_,U_,vu,Ea,Su,ya,Iu,xu,Sn,Rr,Ci,ai,G_,H_,V_,Cu,va,W_,z_,X_,wu,Sa,Ru,Ia,Y_,K_,j_,q_,de,as,Tt,Qe,ci,In,ae,ct,ku,J_,er,xa,Ca,Ou,Z_,Au,wa,Mu,Lu,Q_,Pu,e$,Ra,t$,s$,i$,r$,n$,Nu,o$,wo,Ro,l$,Du,Bu,Fu,Uu,ka,Gu,a$,c$,h$,xn,Hu,u$,Oa,Rs,d$,tr,Vu,p$,ko,Wu,zu,Xu,Yu,Ku,ju,qu,Ju,Zu,Qu,f$,g$,m$,_$,$$,T$,Aa,b$,E$,ed,td,sd,id,rd,nd,od,Ma,Oo,ld,y$,ad,cd,hd,ud,dd,pd,fd,gd,md,_d,v$,S$,I$,$d,x$,C$,w$,R$,k$,q;r=function(e,i,n,c){if(!(e instanceof Z)&&typeof e!="string"||`${e}`.trim()==="")throw Error('Invalid type "'+e+'". The type must be a non-empty string or a Blockly.registry.Type.');if(e=`${e}`.toLowerCase(),typeof i!="string"||i.trim()==="")throw Error('Invalid name "'+i+'". The name must be a non-empty string.');const d=i.toLowerCase();if(!n)throw Error("Can not register a null value");let m=sr[e],y=La[e];if(m||(m=sr[e]=Object.create(null),y=La[e]=Object.create(null)),o(e,n),!c&&m[d]&&m[d]!==n)throw Error('Name "'+d+'" with type "'+e+'" already registered.');m[d]=n,y[d]=i},o=function(e,i){switch(e){case String(Z.FIELD):if(typeof i.fromJson!="function")throw Error('Type "'+e+'" must have a fromJson function')}},a=function(e,i){e=`${e}`.toLowerCase(),i=i.toLowerCase();const n=sr[e];n&&n[i]?(delete sr[e][i],delete La[e][i]):console.warn("Unable to unregister ["+i+"]["+e+"] from the registry.")},h=function(e,i,n){e=`${e}`.toLowerCase(),i=i.toLowerCase();const c=sr[e];if(!c||!c[i]){if(i="Unable to find ["+i+"]["+e+"] in the registry.",n)throw Error(i+" You must require or register a "+e+" plugin.");return console.warn(i),null}return c[i]},u=function(e,i){return e=`${e}`.toLowerCase(),i=i.toLowerCase(),(e=sr[e])?!!e[i]:!1},p=function(e,i,n){return h(e,i,n)},f=function(e,i,n){return h(e,i,n)},g=function(e,i,n){e=`${e}`.toLowerCase();var c=sr[e];if(!c){if(c=`Unable to find [${e}] in the registry.`,n)throw Error(`${c} You must require or register a ${e} plugin.`);return console.warn(c),null}if(!i)return c;e=La[e],n=Object.create(null);for(const d of Object.keys(c))n[e[d]]=c[d];return n},_=function(e,i,n){return i=i.plugins[String(e)]||hi,typeof i=="function"?i:p(e,i,n)},$=function(e,i,n,c){e=e+" was deprecated in "+i+" and will be deleted in "+n+".",c&&(e+=`
Use `+c+" instead."),A$.has(e)||(A$.add(e),console.warn(e))},E=function(){return"blockly-"+(Yx++).toString(36)},v=function(){return P$.genUid()},w=function(e){return e.type===W.BLOCK_CREATE},x=function(e){return e.type===W.BLOCK_DELETE},C=function(e){return e.type===W.BLOCK_CHANGE},R=function(e){return e.type===W.BLOCK_FIELD_INTERMEDIATE_CHANGE},A=function(e){return e.type===W.BLOCK_MOVE},D=function(e){return e.type===W.CLICK},G=function(e){return e.type===W.BUBBLE_OPEN},M=function(e){return e.type===W.VIEWPORT_CHANGE},s.setRecordUndo$$module$build$src$core$events$utils=function(e){Ao=e},k=function(){return Ao},z=function(e){D$.fireInternal(e)},se=function(e){if(ue()){if(!Ri.length)try{requestAnimationFrame(()=>{setTimeout(Q,0)})}catch{setTimeout(Q,0)}ie(e)}},Q=function(){const e=_e(Ri,!0);Ri.length=0;for(const i of e){if(!i.workspaceId)continue;let n;(n=pt(i.workspaceId))==null||n.fireChangeListener(i)}},ie=function(e){if(C(e)&&e.element==="mutation"){let i;for(i=Ri.length;0<i;i--){const n=Ri[i-1];if(n.group!==e.group||n.workspaceId!==e.workspaceId||!A(n)||n.newParentId!==e.blockId)break}Ri.splice(i,0,e)}else Ri.push(e)},_e=function(e,i=!0){i||($("filter(queue, /*forward=*/false)","v11.2","v12"),e=e.slice().reverse());const n=[];for(const c of e)if(e=n[n.length-1],!c.isNull())if(e&&e.workspaceId===c.workspaceId&&e.group===c.group)if(A(c)&&A(e)&&c.blockId===e.blockId){if(e.newParentId=c.newParentId,e.newInputName=c.newInputName,e.newCoordinate=c.newCoordinate,e.reason||c.reason){let d,m;e.reason=Array.from(new Set(((d=e.reason)!=null?d:[]).concat((m=c.reason)!=null?m:[])))}}else C(c)&&C(e)&&c.blockId===e.blockId&&c.element===e.element&&c.name===e.name?e.newValue=c.newValue:M(c)&&M(e)?(e.viewTop=c.viewTop,e.viewLeft=c.viewLeft,e.scale=c.scale,e.oldScale=c.oldScale):D(c)&&G(e)||n.push(c);else n.push(c);return e=n.filter(c=>!c.isNull()),i||e.reverse(),e},ge=function(){for(let e=0,i;i=Ri[e];e++)i.recordUndo=!1},s.disable$$module$build$src$core$events$utils=function(){bd++},s.enable$$module$build$src$core$events$utils=function(){bd--},ue=function(){return bd===0},s.getGroup$$module$build$src$core$events$utils=function(){return N$},s.setGroup$$module$build$src$core$events$utils=function(e){D$.setGroupInternal(e)},St=function(e){N$=typeof e=="boolean"?e?v():"":e},pe=function(e){const i=[];e=e.getDescendants(!1);for(let n=0,c;c=e[n];n++)i[n]=c.id;return i},be=function(e,i){const n=he(e.type);if(!n)throw Error("Unknown event type.");return n.fromJson(e,i)},he=function(e){const i=p(Z.EVENT,e);if(!i)throw Error(`Event type ${e} not found in registry.`);return i},Ne=function(e){if((A(e)||w(e))&&e.workspaceId){var i=pt(e.workspaceId);if(!e.blockId)throw Error("Encountered a blockEvent without a proper blockId");if(e=i.getBlockById(e.blockId)){const n=Ao;try{Ao=!1;const c=e.getParent();if(c&&!c.hasDisabledReason(Ed)){const d=e.getDescendants(!1);for(let m=0,y;y=d[m];m++)y.setDisabledReason(!1,Ed)}else if((e.outputConnection||e.previousConnection)&&!i.isDragging())do e.setDisabledReason(!0,Ed),e=e.getNextBlock();while(e)}finally{Ao=n}}}},pt=function(e){return Mo[e]||null},Kt=function(){const e=[];for(const i in Mo)e.push(Mo[i]);return e},ps=function(e){Mo[e.id]=e},fs=function(e){delete Mo[e.id]},gt=function(){return B$},Ft=function(e){B$=e},qe=function(){return kr},s.setSelected$$module$build$src$core$common=function(e){if(kr!==e){var i,n,c,d,m,y,O=new(he(W.SELECTED))((c=(i=kr)==null?void 0:i.id)!=null?c:null,(d=e==null?void 0:e.id)!=null?d:null,(y=(m=e==null?void 0:e.workspace.id)!=null?m:(n=kr)==null?void 0:n.workspace.id)!=null?y:"");z(O);var K;(K=kr)==null||K.unselect(),kr=e;var oe;(oe=kr)==null||oe.select()}},xs=function(){return F$},si=function(e){F$=e},kt=function(e){for(;e.options.parentWorkspace;)e=e.options.parentWorkspace;const i=e.getParentSvg(),n=e.getCachedParentSvgSize();var c=i.parentElement;if(c instanceof HTMLElement){var d=c.offsetWidth;c=c.offsetHeight,n.width!==d&&(i.setAttribute("width",d+"px"),e.setCachedParentSvgSize(d,null)),n.height!==c&&(i.setAttribute("height",c+"px"),e.setCachedParentSvgSize(null,c)),e.resize()}},os=function(e,i){const n=Object.create(null),c=e.getDescendants(!0);i&&(e=e.getNextBlock())&&(e=c.indexOf(e),c.splice(e,c.length-e));for(let d=0,m;m=c[d];d++)n[m.type]?n[m.type]++:n[m.type]=1;return n},ii=function(e){return function(){this.jsonInit(e)}},jt=function(e){U$.defineBlocksWithJsonArrayInternal(e)},Ut=function(e){s.defineBlocks$$module$build$src$core$common(s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common(e))},s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common=function(e){const i={};for(let n=0;n<e.length;n++){const c=e[n];if(!c){console.warn(`Block definition #${n} in JSON array is ${c}. Skipping`);continue}const d=c.type;d?i[d]={init:ii(c)}:console.warn(`Block definition #${n} in JSON array is missing a type attribute. Skipping.`)}return i},s.defineBlocks$$module$build$src$core$common=function(e){for(const i of Object.keys(e)){const n=e[i];i in cs&&console.warn(`Block definition "${i}" overwrites previous definition.`),cs[i]=n}},qt=function(e,i){lt(),Na=setTimeout(function(){i&&i.handleRightClick(e)},Kx)},lt=function(){Na&&(clearTimeout(Na),Na=0)},It=function(){Pa=null},Cs=function(e){return!e.type.startsWith("pointer")||e instanceof PointerEvent&&vi(e)},ws=function(e){return`${e.pointerId}`},vi=function(e){const i=ws(e);return Pa?Pa===i:e.type==="pointerdown"?(Pa=i,!0):!1},fe=function(e,i,n,c,d){function m(O){(d||Cs(O))&&(n?c.call(n,O):c(O))}const y=[];if(i in Or)for(let O=0;O<Or[i].length;O++){const K=Or[i][O];e.addEventListener(K,m,!1),y.push([e,K,m])}else e.addEventListener(i,m,!1),y.push([e,i,m]);return y},Xe=function(e,i,n,c){function d(y){n?c.call(n,y):c(y)}const m=[];if(i in Or)for(let y=0;y<Or[i].length;y++){const O=Or[i][y];e.addEventListener(O,d,!1),m.push([e,O,d])}else e.addEventListener(i,d,!1),m.push([e,i,d]);return m},Ue=function(e){const i=e[e.length-1][2];for(;e.length;){const[n,c,d]=e.pop();n.removeEventListener(c,d,!1)}return i},Fs=function(e){if(e.target instanceof HTMLElement){if(e.target.isContentEditable||e.target.getAttribute("data-is-text-input")==="true")return!0;if(e.target instanceof HTMLInputElement)return e=e.target,e.type==="text"||e.type==="number"||e.type==="email"||e.type==="password"||e.type==="search"||e.type==="tel"||e.type==="url";if(e.target instanceof HTMLTextAreaElement)return!0}return!1},Jt=function(e){return e.ctrlKey&&Cd?!0:e.button===2},P=function(e,i,n){const c=i.createSVGPoint();return c.x=e.clientX,c.y=e.clientY,n||(n=i.getScreenCTM().inverse()),c.matrixTransform(n)},ri=function(e){switch(e.deltaMode){default:return{x:e.deltaX,y:e.deltaY};case 1:return{x:e.deltaX*Z$,y:e.deltaY*Z$};case 2:return{x:e.deltaX*Q$,y:e.deltaY*Q$}}},$t=function(e,i){return i=e.indexOf(i),i===-1?!1:(e.splice(i,1),!0)},tt=function(e){if(wd)throw Error("CSS already injected");Rd+=`
`+e},Zt=function(e,i){wd||(wd=!0,e&&(e=i.replace(/[\\/]$/,""),i=Rd.replace(/<<<PATH>>>/g,e),Rd="",e=document.createElement("style"),e.id="blockly-common-style",i=document.createTextNode(i),e.appendChild(i),document.head.insertBefore(e,document.head.firstChild)))},Y=function(e,i,n){e=document.createElementNS(Po,`${e}`);for(const c in i)e.setAttribute(c,`${i[c]}`);return n&&n.appendChild(e),e},re=function(e,i){return i=i.split(" "),i.every(n=>e.classList.contains(n))?!1:(e.classList.add(...i),!0)},T=function(e,i){e.classList.remove(...i.split(" "))},S=function(e,i){return i=i.split(" "),i.every(n=>!e.classList.contains(n))?!1:(e.classList.remove(...i),!0)},B=function(e,i){return e.classList.contains(i)},F=function(e){return e&&e.parentNode?e.parentNode.removeChild(e):null},ee=function(e,i){const n=i.nextSibling;if(i=i.parentNode,!i)throw Error("Reference node has no parent.");n?i.insertBefore(e,n):i.appendChild(e)},Ye=function(e,i){e.style.transform=i,e.style["-webkit-transform"]=i},Gt=function(){Od++,Vs||(Vs=Object.create(null))},ni=function(){Od--,Od||(Vs=null)},dn=function(e){const i=e.textContent+`
`+e.className.baseVal;let n;if(Vs&&(n=Vs[i]))return n;try{n=e.getComputedTextLength()}catch{return 8*e.textContent.length}return Vs&&(Vs[i]=n),n},Us=function(e,i,n,c){return b(e,i+"pt",n,c)},b=function(e,i,n,c){const d=e.textContent;e=d+`
`+e.className.baseVal;var m;return Vs&&(m=Vs[e])||(Ua||(m=document.createElement("canvas"),m.className="blocklyComputeCanvas",document.body.appendChild(m),Ua=m.getContext("2d")),Ua.font=n+" "+i+" "+c,m=d?Ua.measureText(d).width:0,Vs&&(Vs[e]=m)),m},I=function(e,i,n,c){const d=document.createElement("span");d.style.font=n+" "+i+" "+c,d.textContent=e,e=document.createElement("div"),e.style.width="1px",e.style.height="0",i=document.createElement("div"),i.style.display="flex",i.style.position="fixed",i.style.top="0",i.style.left="0",i.appendChild(d),i.appendChild(e),document.body.appendChild(i),n={height:0,baseline:0};try{i.style.alignItems="baseline",n.baseline=e.offsetTop-d.offsetTop,i.style.alignItems="flex-end",n.height=e.offsetTop-d.offsetTop}finally{document.body.removeChild(i)}return n},L=function(e){return tT.getSizeInternal(e)},H=function(e){if(ce(e,"display")!=="none")return J(e);const i=e.style,n=i.display,c=i.visibility,d=i.position;i.visibility="hidden",i.position="absolute",i.display="inline";const m=e.offsetWidth;return e=e.offsetHeight,i.display=n,i.position=d,i.visibility=c,new Oe(m,e)},J=function(e){return new Oe(e.offsetWidth,e.offsetHeight)},ce=function(e,i){return e=window.getComputedStyle(e),e[i]||e.getPropertyValue(i)},ye=function(e){const i=new te(0,0);e=e.getBoundingClientRect();var n=document.documentElement;return n=new te(window.pageXOffset||n.scrollLeft,window.pageYOffset||n.scrollTop),i.x=e.left+n.x,i.y=e.top+n.y,i},ls=function(){const e=document.body,i=document.documentElement;return new te(e.scrollLeft||i.scrollLeft,e.scrollTop||i.scrollTop)},qi=function(e){const i=parseFloat(ce(e,"borderLeftWidth")),n=parseFloat(ce(e,"borderRightWidth")),c=parseFloat(ce(e,"borderTopWidth"));return e=parseFloat(ce(e,"borderBottomWidth")),new Ve(c,e,i,n)},yr=function(e,i,n){e=Ji(e,i,n),i.scrollLeft=e.x,i.scrollTop=e.y},Ji=function(e,i,n){var c=ye(e),d=ye(i),m=qi(i);const y=c.x-d.x-m.left;return c=c.y-d.y-m.top,d=J(e),e=i.clientWidth-d.width,d=i.clientHeight-d.height,m=i.scrollLeft,i=i.scrollTop,n?(m+=y-e/2,i+=c-d/2):(m+=Math.min(y,Math.max(y-e,0)),i+=Math.min(c,Math.max(c-d,0))),new te(m,i)},uo=function(e){const i=new te(0,0);var n=e.x&&e.getAttribute("x");const c=e.y&&e.getAttribute("y");return n&&(i.x=parseInt(n)),c&&(i.y=parseInt(c)),(n=(n=e.getAttribute("transform"))&&n.match(sT))&&(i.x+=Number(n[1]),n[3]&&(i.y+=Number(n[3]))),(e=e.getAttribute("style"))&&e.includes("translate")&&(e=e.match(iT))&&(i.x+=Number(e[1]),e[3]&&(i.y+=Number(e[3]))),i},Yl=function(e){let i=0,n=0;for(;e;){const c=uo(e);if(i+=c.x,n+=c.y,(" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv "))break;e=e.parentNode}return new te(i,n)},Eh=function(){const e=ls();return new Ve(e.y,document.documentElement.clientHeight+e.y,e.x,document.documentElement.clientWidth+e.x)},yh=function(){const e=document.documentElement,i=window;return new te(i.pageXOffset||e.scrollLeft,i.pageYOffset||e.scrollTop)},pm=function(e,i){var n=i.x;i=i.y;const c=e.getInjectionDiv().getBoundingClientRect();return n=new te(n-c.left,i-c.top),i=e.getOriginOffsetInPixels(),te.difference(n,i).scale(1/e.scale)},fm=function(e,i){var n=i.scale(e.scale);i=n.x,n=n.y;const c=e.getInjectionDiv().getBoundingClientRect();return e=e.getOriginOffsetInPixels(),new te(i+c.left+e.x,n+c.top+e.y)},gm=function(e){({document:Ha=Ha,DOMParser:No=No,XMLSerializer:Do=Do}=e),Ga=new No,Ad=new Do},s.createElement$$module$build$src$core$utils$xml=function(e){return Ha.createElementNS(rT,e)},s.createTextNode$$module$build$src$core$utils$xml=function(e){return Ha.createTextNode(e)},s.textToDom$$module$build$src$core$utils$xml=function(e){let i=Ga.parseFromString(e,"text/xml");if(i&&i.documentElement&&!i.getElementsByTagName("parsererror").length)return i.documentElement;if((i=Ga.parseFromString(e,"text/html"))&&i.body.firstChild&&i.body.firstChild.nodeName.toLowerCase()==="xml")return i.body.firstChild;throw Error(`DOMParser was unable to parse: ${e}`)},pn=function(e){return mm(Ad.serializeToString(e))},mm=function(e){return e.replace(Zx,i=>`&#${i.charCodeAt(0)};`)},Kl=function(e){return e?((e instanceof Element||typeof e=="string")&&(e=Sh(e),e=Tm(e)),_m(e),e):null},_m=function(e){const i=e.kind;if(e=e.contents,i&&i!==nT&&i!==Md)throw Error("Invalid toolbox kind "+i+". Please supply either "+nT+" or "+Md);if(!e)throw Error("Toolbox must have a contents attribute.")},po=function(e){return e?e.contents?e.contents:Array.isArray(e)&&0<e.length&&!e[0].nodeType?e:Jl(e):[]},jl=function(e){return oT.hasCategoriesInternal(e)},$m=function(e){if(!e)return!1;const i=e.kind;return i?i===Md:!!e.contents.filter(n=>n.kind.toUpperCase()==="CATEGORY").length},ql=function(e){return e&&e.contents?!!e.contents.filter(function(i){return i.kind.toUpperCase()==="CATEGORY"}).length:!1},Tm=function(e){const i={contents:Jl(e)};return e instanceof Node&&vh(e,i),i},Jl=function(e){const i=[];let n=e.childNodes;n||(n=e);for(let c=0,d;d=n[c];c++){if(!d.tagName)continue;e={};const m=d.tagName.toUpperCase();e.kind=m,m==="BLOCK"?e.blockxml=d:d.childNodes&&0<d.childNodes.length&&(e.contents=Jl(d)),vh(d,e),i.push(e)}return i},vh=function(e,i){for(let n=0;n<e.attributes.length;n++){const c=e.attributes[n];c.nodeName.includes("css-")?(i.cssconfig=i.cssconfig||{},i.cssconfig[c.nodeName.replace("css-","")]=c.value):i[c.nodeName]=c.value}},Sh=function(e){let i=null;if(e)if(typeof e=="string"){if(i=s.textToDom$$module$build$src$core$utils$xml(e),i.nodeName.toLowerCase()!=="xml")throw TypeError("Toolbox should be an <xml> document.")}else e instanceof Element&&(i=e);return i},Zl=function(e,i,n,c,d,m){const y=m.scrollbar&&m.scrollbar.canScrollVertically();return e.horizontal===Rn.LEFT?(n=d.absoluteMetrics.left+n,y&&m.RTL&&(n+=ht.scrollbarThickness)):(n=d.absoluteMetrics.left+d.viewMetrics.width-i.width-n,y&&!m.RTL&&(n-=ht.scrollbarThickness)),e.vertical===Mi.TOP?e=d.absoluteMetrics.top+c:(e=d.absoluteMetrics.top+d.viewMetrics.height-i.height-c,m.scrollbar&&m.scrollbar.canScrollHorizontally()&&(e-=ht.scrollbarThickness)),new Ve(e,e+i.height,n,n+i.width)},Ql=function(e,i){return{horizontal:i.toolboxMetrics.position===Ie.LEFT||e.horizontalLayout&&!e.RTL?Rn.RIGHT:Rn.LEFT,vertical:i.toolboxMetrics.position===Ie.BOTTOM?Mi.TOP:Mi.BOTTOM}},ea=function(e,i,n,c){const d=e.left,m=e.right-e.left,y=e.bottom-e.top;for(let O=0;O<c.length;O++){const K=c[O];e.intersects(K)&&(e=n===nr.UP?K.top-y-i:K.bottom+i,e=new Ve(e,e+y,d,d+m),O=-1)}return e},fo=function(e,i){r(Z.SERIALIZER,e,i)},bm=function(e){a(Z.SERIALIZER,e)},fn=function(e,{addCoordinates:i=!1,saveIds:n=!0}={}){const c=e.workspace,d=Object.create(null);return d.height=e.getSize().height,d.width=e.getSize().width,n&&(d.id=e.id),i&&(i=e.getRelativeToSurfaceXY(),d.x=c.RTL?c.getWidth()-i.x:i.x,d.y=i.y),e.getText()&&(d.text=e.getText()),e.isCollapsed()&&(d.collapsed=!0),e.isOwnEditable()||(d.editable=!1),e.isOwnMovable()||(d.movable=!1),e.isOwnDeletable()||(d.deletable=!1),d},go=function(e,i,{recordUndo:n=!1}={}){const c=k();if(s.setRecordUndo$$module$build$src$core$events$utils(n),n=i.newComment(e.id),e.text!==void 0&&n.setText(e.text),e.x!==void 0||e.y!==void 0){const m=n.getRelativeToSurfaceXY();let y,O=(y=e.x)!=null?y:m.x;O=i.RTL?i.getWidth()-O:O;var d;i=(d=e.y)!=null?d:m.y,n.moveTo(new te(O,i))}if(e.width!==void 0||e.height){d=n.getSize();let m,y;n.setSize(new Oe((m=e.width)!=null?m:d.width,(y=e.height)!=null?y:d.height))}return e.collapsed!==void 0&&n.setCollapsed(e.collapsed),e.editable!==void 0&&n.setEditable(e.editable),e.movable!==void 0&&n.setMovable(e.movable),e.deletable!==void 0&&n.setDeletable(e.deletable),s.setRecordUndo$$module$build$src$core$events$utils(c),n},ta=function(e,i){r(Z.PASTER,e,i)},Em=function(e){a(Z.PASTER,e)},ym=function(e){const i=e.workspace,n=e.getRelativeToSurfaceXY(),c=new te(0,0),d=i.getTopComments(!1).filter(m=>m.id!==e.id).map(m=>m.getRelativeToSurfaceXY());for(;vm(te.sum(n,c),d);)c.translate(i.RTL?-30:30,30);e.moveTo(te.sum(n,c))},vm=function(e,i){return i.some(n=>1>=Math.abs(n.x-e.x)&&1>=Math.abs(n.y-e.y))},Zi=function(e,i){e.setAttribute(tC,i)},xt=function(e,i,n){Array.isArray(n)&&(n=n.join(" ")),e.setAttribute(eC+i,`${n}`)},mo=function(e){return e.saveState!==void 0&&e.loadState!==void 0},Ih=function(e){return xh(e),Sm()?(sa(),Promise.resolve()):(kn||(kn=new Promise(i=>{Gd=i,pT=window.requestAnimationFrame(()=>{sa(),i()})})),kn)},Gs=function(){return kn||Promise.resolve()},Si=function(e){e||window.cancelAnimationFrame(pT),sa(e),!e&&Gd&&Gd()},Sm=function(){return K$},xh=function(e){Fd.add(e),Ud.set(e,s.getGroup$$module$build$src$core$events$utils());const i=e.getParent();i?xh(i):Xa.add(e)},sa=function(e){const i=e?new Set([e]):new Set([...Xa].map(m=>m.workspace)),n=[...Xa].filter(Im).filter(m=>i.has(m.workspace));for(var c of n)wh(c);for(const m of i)m.resizeContents();for(var d of n)c=d.getRelativeToSurfaceXY(),d.updateComponentLocations(c);for(const m of n)d=s.getGroup$$module$build$src$core$events$utils(),(c=Ud.get(m))&&s.setGroup$$module$build$src$core$events$utils(c),m.bumpNeighbours(),s.setGroup$$module$build$src$core$events$utils(d);for(const m of n)Ch(m);e||(kn=null)},Ch=function(e){Xa.delete(e),Fd.delete(e),Ud.delete(e);for(const i of e.getChildren(!1))Ch(i)},Im=function(e){return!e.isDisposed()&&!e.getParent()},wh=function(e){if(Fd.has(e)&&e.initialized){for(const i of e.getChildren(!1))wh(i);e.renderEfficiently()}},_o=function(e,i){fT(e,i)},xm=function(e){fT=e},ia=function(e,i){_T.confirmInternal(e,i)},Cm=function(e,i){gT(e,i)},wm=function(e){gT=e},ra=function(e,i,n){mT(e,i,n)},Rm=function(e){mT=e},gn=function(e){return e.getProcedureDef!==void 0},km=function(e){return e.getProcedureCall!==void 0&&e.renameProcedure!==void 0},Rh=function(e){return e.getVariableModel!==void 0},s.allUsedVarModels$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const i=new Set;for(let n=0;n<e.length;n++){const c=e[n].getVarModels();if(c)for(let d=0;d<c.length;d++){const m=c[d];m.getId()&&i.add(m)}}return Array.from(i.values())},s.allDeveloperVariables$$module$build$src$core$variables=function(e){e=e.getAllBlocks(!1);const i=new Set;for(let c=0,d;d=e[c];c++){var n=d.getDeveloperVariables;if(n){n=n();for(let m=0;m<n.length;m++)i.add(n[m])}}return Array.from(i.values())},na=function(e){let i=[];const n=document.createElement("button");return n.setAttribute("text","%{BKY_NEW_VARIABLE}"),n.setAttribute("callbackKey","CREATE_VARIABLE"),e.registerButtonCallback("CREATE_VARIABLE",function(c){mn(c.getTargetWorkspace())}),i.push(n),e=kh(e),i=i.concat(e)},kh=function(e){e=e.getVariablesOfType("");const i=[];if(0<e.length){var n=e[e.length-1];if(cs.variables_set){var c=s.createElement$$module$build$src$core$utils$xml("block");c.setAttribute("type","variables_set"),c.setAttribute("gap",cs.math_change?"8":"24"),c.appendChild(vr(n)),i.push(c)}if(cs.math_change&&(c=s.createElement$$module$build$src$core$utils$xml("block"),c.setAttribute("type","math_change"),c.setAttribute("gap",cs.variables_get?"20":"8"),c.appendChild(vr(n)),n=s.textToDom$$module$build$src$core$utils$xml('<value name="DELTA"><shadow type="math_number"><field name="NUM">1</field></shadow></value>'),c.appendChild(n),i.push(c)),cs.variables_get){e.sort(Go.compareByName);for(let d=0,m;m=e[d];d++)n=s.createElement$$module$build$src$core$utils$xml("block"),n.setAttribute("type","variables_get"),n.setAttribute("gap","8"),n.appendChild(vr(m)),i.push(n)}}return i},Oh=function(e){return TT.generateUniqueNameInternal(e)},Om=function(e){return oa(zd.charAt(0),e.getAllVariableNames())},oa=function(e,i){if(!i.length)return e;const n=zd;let c="",d=n.indexOf(e);for(;;){let m=!1;for(let y=0;y<i.length;y++)if(i[y].toLowerCase()===e){m=!0;break}if(!m)break;d++,d===n.length&&(d=0,c=`${Number(c)+1}`),e=n.charAt(d)+c}return e},mn=function(e,i,n){function c(m){la(s.Msg$$module$build$src$core$msg.NEW_VARIABLE_TITLE,m,function(y){if(y){var O=Ah(y,e);if(O){if(O.type===d)var K=s.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS.replace("%1",O.name);else K=s.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE,K=K.replace("%1",O.name).replace("%2",O.type);_o(K,function(){c(y)})}else e.createVariable(y,d),i&&i(y)}else i&&i(null)})}const d=n||"";c("")},s.renameVariable$$module$build$src$core$variables=function(e,i,n){function c(d){const m=s.Msg$$module$build$src$core$msg.RENAME_VARIABLE_TITLE.replace("%1",i.name);la(m,d,function(y){if(y){var O=Am(y,i.type,e),K=Mh(i.name,y,e);if(O||K){var oe="";O?oe=s.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE.replace("%1",O.name).replace("%2",O.type):K&&(oe=s.Msg$$module$build$src$core$msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER.replace("%1",y).replace("%2",K)),_o(oe,function(){c(y)})}else e.renameVariableById(i.getId(),y),n&&n(y)}else n&&n(null)})}c("")},la=function(e,i,n){ra(e,i,function(c){c&&(c=c.replace(/[\s\xa0]+/g," ").trim(),c===s.Msg$$module$build$src$core$msg.RENAME_VARIABLE||c===s.Msg$$module$build$src$core$msg.NEW_VARIABLE)&&(c=null),n(c)})},Am=function(e,i,n){n=n.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let c=0,d;d=n[c];c++)if(d.name.toLowerCase()===e&&d.type!==i)return d;return null},Ah=function(e,i){i=i.getVariableMap().getAllVariables(),e=e.toLowerCase();for(let n=0,c;c=i[n];n++)if(c.name.toLowerCase()===e)return c;return null},Mh=function(e,i,n){return n.getProcedureMap().getProcedures().length?Mm(e,i,n):Lm(e,i,n)},Mm=function(e,i,n){e=e.toLowerCase(),i=i.toLowerCase(),n=n.getProcedureMap().getProcedures();for(const d of n){var c=d.getParameters().filter(Rh).map(m=>m.getVariableModel().name);if(c&&(n=c.some(m=>m.toLowerCase()===e),c=c.some(m=>m.toLowerCase()===i),n&&c))return d.getName()}return null},Lm=function(e,i,n){e=e.toLowerCase(),i=i.toLowerCase(),n=n.getAllBlocks(!1);for(const d of n){if(!gn(d))continue;n=d.getProcedureDef();var c=n[1];const m=c.some(y=>y.toLowerCase()===e);if(c=c.some(y=>y.toLowerCase()===i),m&&c)return n[0]}return null},vr=function(e){const i=s.createElement$$module$build$src$core$utils$xml("field");return i.setAttribute("name","VAR"),i.setAttribute("id",e.getId()),i.setAttribute("variabletype",e.type),e=s.createTextNode$$module$build$src$core$utils$xml(e.name),i.appendChild(e),i},s.getOrCreateVariablePackage$$module$build$src$core$variables=function(e,i,n,c){let d=s.getVariable$$module$build$src$core$variables(e,i,n,c);return d||(d=Pm(e,i,n,c)),d},s.getVariable$$module$build$src$core$variables=function(e,i,n,c){const d=e.getPotentialVariableMap();let m=null;if(i&&(m=e.getVariableById(i),!m&&d&&(m=d.getVariableById(i)),m))return m;if(n){if(c===void 0)throw Error("Tried to look up a variable by name without a type");m=e.getVariable(n,c),!m&&d&&(m=d.getVariable(n,c))}return m},Pm=function(e,i,n,c){const d=e.getPotentialVariableMap();return n||(n=Oh(e.isFlyout?e.targetWorkspace:e)),d?d.createVariable(n,c,i):e.createVariable(n,c,i)},$o=function(e,i){e=e.getAllVariables();const n=[];if(i.length!==e.length)for(let c=0;c<e.length;c++){const d=e[c];i.includes(d)||n.push(d)}return n},gs=function(e,{addCoordinates:i=!1,addInputBlocks:n=!0,addNextBlocks:c=!0,doFullSerialization:d=!0,saveIds:m=!0}={}){if(e.isInsertionMarker())return null;const y={type:e.type,id:m?e.id:void 0};return i&&Dm(e,y),Nm(e,y),Bm(e,y,d),Fm(e,y,d),Um(e,y,d),n&&Gm(e,y,d,m),c&&Hm(e,y,d,m),y},Nm=function(e,i){e.isCollapsed()&&(i.collapsed=!0),e.isEnabled()||(i.disabledReasons=Array.from(e.getDisabledReasons())),e.isOwnDeletable()||(i.deletable=!1),e.isOwnMovable()||(i.movable=!1),e.isOwnEditable()||(i.editable=!1),e.inputsInline!==void 0&&e.inputsInline!==e.inputsInlineDefault&&(i.inline=e.inputsInline),e.data&&(i.data=e.data)},Dm=function(e,i){const n=e.workspace;e=e.getRelativeToSurfaceXY(),i.x=Math.round(n.RTL?n.getWidth()-e.x:e.x),i.y=Math.round(e.y)},Bm=function(e,i,n){e.saveExtraState?(e=e.saveExtraState(n),e!==null&&(i.extraState=e)):e.mutationToDom&&(e=e.mutationToDom(),e!==null&&(i.extraState=li(e).replace(' xmlns="https://developers.google.com/blockly/xml"',"")))},Fm=function(e,i,n){const c=Object.create(null);for(const d of e.getIcons())mo(d)&&(e=d.saveState(n))&&(c[d.getType().toString()]=e);Object.keys(c).length&&(i.icons=c)},Um=function(e,i,n){const c=Object.create(null);for(let d=0;d<e.inputList.length;d++){const m=e.inputList[d];for(let y=0;y<m.fieldRow.length;y++){const O=m.fieldRow[y];O.isSerializable()&&(c[O.name]=O.saveState(n))}}Object.keys(c).length&&(i.fields=c)},Gm=function(e,i,n,c){const d=Object.create(null);for(let m=0;m<e.inputList.length;m++){const y=e.inputList[m];if(!y.connection)continue;const O=Lh(y.connection,n,c);O&&(d[y.name]=O)}Object.keys(d).length&&(i.inputs=d)},Hm=function(e,i,n,c){e.nextConnection&&(e=Lh(e.nextConnection,n,c))&&(i.next=e)},Lh=function(e,i,n){const c=e.getShadowState(!0);if(e=e.targetBlock(),!c&&!e)return null;const d=Object.create(null);return c&&(d.shadow=c),e&&!e.isShadow()&&(d.block=gs(e,{doFullSerialization:i,saveIds:n})),d},Ii=function(e,i,{recordUndo:n=!1}={}){return e=_n(e,i,{recordUndo:n}),i.rendered&&Si(),e},_n=function(e,i,{parentConnection:n,isShadow:c=!1,recordUndo:d=!1}={}){const m=k();s.setRecordUndo$$module$build$src$core$events$utils(d),(d=s.getGroup$$module$build$src$core$events$utils())||s.setGroup$$module$build$src$core$events$utils(!0),s.disable$$module$build$src$core$events$utils();const y=i.getAllVariables();let O;try{O=Ph(e,i,{parentConnection:n,isShadow:c})}finally{s.enable$$module$build$src$core$events$utils()}if(Vm(i,y),ue()&&z(new(he(W.BLOCK_CREATE))(O)),s.setGroup$$module$build$src$core$events$utils(d),s.setRecordUndo$$module$build$src$core$events$utils(m),i.rendered){const K=O;setTimeout(()=>{K.disposed||K.setConnectionTracking(!0)},1)}return O},Ph=function(e,i,{parentConnection:n,isShadow:c=!1}={}){if(!e.type)throw new bT(e);const d=i.newBlock(e.type,e.id);return d.setShadow(c),Wm(d,e),zm(d,e),Xm(d,e),Ym(n,d,e),Km(d,e),jm(d,e),qm(d,e),Jm(d,e),Zm(d,i.rendered),d},Vm=function(e,i){if(ue())for(e=$o(e,i),i=0;i<e.length;i++){const n=e[i];z(new(he(W.VAR_CREATE))(n))}},Wm=function(e,i){let n=i.x===void 0?0:i.x;i=i.y===void 0?0:i.y;const c=e.workspace;n=c.RTL?c.getWidth()-n:n,e.moveBy(n,i)},zm=function(e,i){if(i.collapsed&&e.setCollapsed(!0),i.deletable===!1&&e.setDeletable(!1),i.movable===!1&&e.setMovable(!1),i.editable===!1&&e.setEditable(!1),i.enabled===!1&&e.setDisabledReason(!0,es),Array.isArray(i.disabledReasons))for(const n of i.disabledReasons)e.setDisabledReason(!0,n);i.inline!==void 0&&e.setInputsInline(i.inline),i.data!==void 0&&(e.data=i.data)},Xm=function(e,i){i.extraState&&(e.loadExtraState?e.loadExtraState(i.extraState):e.domToMutation&&e.domToMutation(s.textToDom$$module$build$src$core$utils$xml(i.extraState)))},Ym=function(e,i,n){if(e){if(e.getSourceBlock().isShadow()&&!i.isShadow())throw new yT(n);if(e.type===s.inputTypes$$module$build$src$core$inputs$input_types.VALUE){var c=i.outputConnection;if(!c)throw new Ho("output",i,n)}else if(c=i.previousConnection,!c)throw new Ho("previous",i,n);if(!e.connect(c)){const d=i.workspace.connectionChecker;throw new ET(d.getErrorMessage(d.canConnectWithReason(c,e,!1),c,e),e.type===s.inputTypes$$module$build$src$core$inputs$input_types.VALUE?"output connection":"previous connection",i,n)}}},Km=function(e,i){if(i.icons){var n=Object.keys(i.icons);for(const d of n){n=i.icons[d];var c=e.getIcon(d);if(!c){if(c=p(Z.ICON,d,!1),!c)throw new vT(d,e,i);c=new c(e),e.addIcon(c)}mo(c)&&c.loadState(n)}}},jm=function(e,i){if(i.fields){var n=Object.keys(i.fields);for(let c=0;c<n.length;c++){const d=n[c],m=i.fields[d],y=e.getField(d);y?y.loadState(m):console.warn(`Ignoring non-existant field ${d} in block ${e.type}`)}}},qm=function(e,i){if(i.inputs){var n=Object.keys(i.inputs);for(let c=0;c<n.length;c++){const d=n[c],m=e.getInput(d);if(!m||!m.connection)throw new Ho(d,e,i);Nh(m.connection,i.inputs[d])}}},Jm=function(e,i){if(i.next){if(!e.nextConnection)throw new Ho("next",e,i);Nh(e.nextConnection,i.next)}},Nh=function(e,i){i.shadow&&e.setShadowState(i.shadow),i.block&&Ph(i.block,e.getSourceBlock().workspace,{parentConnection:e})},Zm=function(e,i){if(i){e.setConnectionTracking(!1),e.initSvg(),e.queueRender();for(const n of e.getIcons())n.onLocationChange(e.getRelativeToSurfaceXY())}else e.initModel()},$n=function(e){return e.bubbleIsVisible!==void 0&&e.setBubbleVisible!==void 0},aa=function(e){return e*Math.PI/180},Qm=function(e){return 180*e/Math.PI},Tn=function(e,i,n){if(n<e){const c=n;n=e,e=c}return Math.max(e,Math.min(i,n))},Dh=function(){document.querySelector(".blocklyDropDownDiv")||(Le=document.createElement("div"),Le.className="blocklyDropDownDiv",(xs()||document.body).appendChild(Le),Ln=document.createElement("div"),Ln.className="blocklyDropDownContent",Le.appendChild(Ln),Ur=document.createElement("div"),Ur.className="blocklyDropDownArrow",Le.appendChild(Ur),Le.style.opacity="0",Le.style.transition="transform "+qa+"s, opacity "+qa+"s",Le.addEventListener("focusin",function(){re(Le,"blocklyFocused")}),Le.addEventListener("focusout",function(){S(Le,"blocklyFocused")}))},Bh=function(e){Kd=e},Fh=function(){return or},To=function(){return Ln},ca=function(){Ln.textContent="",Ln.style.width=""},Uh=function(e,i){Le.style.backgroundColor=e,Le.style.borderColor=i},e_=function(e,i,n,c){return Wh(Hh(i),e,n,c)},Gh=function(e,i,n){return CT=!0,Wh(Vh(e),e,i,n)},Hh=function(e){var i=e.getSvgRoot();const n=e.workspace.scale,c=e.height*n;return e=e.width*n,i=ye(i),new Ve(i.y,i.y+c,i.x,i.x+e)},Vh=function(e){return e=e.getScaledBBox(),new Ve(e.top,e.bottom,e.left,e.right)},Wh=function(e,i,n,c){const d=e.left+(e.right-e.left)/2,m=e.bottom;e=e.top,c&&(e+=c),c=i.getSourceBlock();let y=c.workspace;for(;y.options.parentWorkspace;)y=y.options.parentWorkspace;return Bh(y.getParentSvg().parentNode),zh(i,c.RTL,d,m,d,e,n)},zh=function(e,i,n,c,d,m,y){return or=e,Fr=y||null,Le.style.direction=i?"rtl":"ltr",e=gt(),An=e.getRenderer().getClassName(),Mn=e.getTheme().getClassName(),An&&re(Le,An),Mn&&re(Le,Mn),jh(n,c,d,m)},Xh=function(e,i,n,c){return e=bo(e,n.left,n.right,c.width),{initialX:e.divX,initialY:i,finalX:e.divX,finalY:i+Xd,arrowX:e.arrowX,arrowY:-9,arrowAtTop:!0,arrowVisible:!0}},Yh=function(e,i,n,c){return e=bo(e,n.left,n.right,c.width),{initialX:e.divX,initialY:i-c.height,finalX:e.divX,finalY:i-c.height-Xd,arrowX:e.arrowX,arrowY:c.height-2*IT-ja/2,arrowAtTop:!1,arrowVisible:!0}},t_=function(e,i,n){return e=bo(e,i.left,i.right,n.width),{initialX:e.divX,initialY:0,finalX:e.divX,finalY:0,arrowAtTop:null,arrowX:null,arrowY:null,arrowVisible:!1}},bo=function(e,i,n,c){return i=Tn(i,e-c/2,n-c),e=e-ja/2-i,n=xT,e=Tn(n,e,c-n-ja),{arrowX:e,divX:i}},Kh=function(){return!!or},ha=function(e,i){return or===e?(i?oi():ua(),!0):!1},ua=function(){Le.style.transform="translate(0, 0)",Le.style.opacity="0",Yd=setTimeout(function(){oi()},1e3*qa),Fr&&(Fr(),Fr=null)},oi=function(){Kh()&&(Yd&&clearTimeout(Yd),Le.style.transform="",Le.style.left="",Le.style.top="",Le.style.opacity="0",Le.style.display="none",Le.style.backgroundColor="",Le.style.borderColor="",Fr&&(Fr(),Fr=null),ca(),or=null,An&&(S(Le,An),An=""),Mn&&(S(Le,Mn),Mn=""),gt().markFocused())},jh=function(e,i,n,c){e=jd.getPositionMetrics(e,i,n,c),e.arrowVisible?(Ur.style.display="",Ur.style.transform="translate("+e.arrowX+"px,"+e.arrowY+"px) rotate(45deg)",Ur.setAttribute("class",e.arrowAtTop?"blocklyDropDownArrow blocklyArrowTop":"blocklyDropDownArrow blocklyArrowBottom")):Ur.style.display="none",i=Math.floor(e.initialX),n=Math.floor(e.initialY),c=Math.floor(e.finalX);const d=Math.floor(e.finalY);return Le.style.left=i+"px",Le.style.top=n+"px",Le.style.display="block",Le.style.opacity="1",Le.style.transform="translate("+(c-i)+"px,"+(d-n)+"px)",!!e.arrowAtTop},qh=function(){if(or){var e=or.getSourceBlock();e=CT?Vh(or):Hh(e);const i=e.left+(e.right-e.left)/2;jh(i,e.bottom,i,e.top)}else ua()},Eo=function(e){return e.length?e.reduce(function(i,n){return i.length<n.length?i:n}).length:0},Jh=function(e,i){if(!e.length)return 0;if(e.length===1)return e[0].length;let n=0;i=i||Eo(e);let c;for(c=0;c<i;c++){for(var d=e[0][c],m=1;m<e.length;m++)if(d!==e[m][c])return n;d===" "&&(n=c+1)}for(d=1;d<e.length;d++)if((m=e[d][c])&&m!==" ")return n;return i},Zh=function(e,i){if(!e.length)return 0;if(e.length===1)return e[0].length;let n=0;i=i||Eo(e);let c;for(c=0;c<i;c++){for(var d=e[0].substr(-c-1,1),m=1;m<e.length;m++)if(d!==e[m].substr(-c-1,1))return n;d===" "&&(n=c+1)}for(d=1;d<e.length;d++)if((m=e[d].charAt(e[d].length-c-1))&&m!==" ")return n;return i},s.wrap$$module$build$src$core$utils$string=function(e,i){e=e.split(`
`);for(let n=0;n<e.length;n++)e[n]=s_(e[n],i);return e.join(`
`)},s_=function(e,i){if(e.length<=i)return e;const n=e.trim().split(/\s+/);for(var c=0;c<n.length;c++)n[c].length>i&&(i=n[c].length);var d=-1/0;let m,y=1;do{c=d,m=e,e=[],d=n.length/y;let O=1;for(let K=0;K<n.length-1;K++)O<(K+1.5)/d?(O++,e[K]=!0):e[K]=!1;e=Qh(n,e,i),d=da(n,e,i),e=i_(n,e),y++}while(d>c);return m},da=function(e,i,n){const c=[0],d=[];for(var m=0;m<e.length;m++)c[c.length-1]+=e[m].length,i[m]===!0?(c.push(0),d.push(e[m].charAt(e[m].length-1))):i[m]===!1&&c[c.length-1]++;for(e=Math.max(...c),i=0,m=0;m<c.length;m++)i-=2*Math.pow(Math.abs(n-c[m]),1.5),i-=Math.pow(e-c[m],1.5),".?!".includes(d[m])?i+=n/3:",;)]}".includes(d[m])&&(i+=n/4);return 1<c.length&&c[c.length-1]<=c[c.length-2]&&(i+=.5),i},Qh=function(e,i,n){let c=da(e,i,n),d;for(let m=0;m<i.length-1;m++){if(i[m]===i[m+1])continue;const y=[].concat(i);y[m]=!y[m],y[m+1]=!y[m+1];const O=da(e,y,n);O>c&&(c=O,d=y)}return d?Qh(e,d,n):i},i_=function(e,i){const n=[];for(let c=0;c<e.length;c++)n.push(e[c]),i[c]!==void 0&&n.push(i[c]?`
`:" ");return n.join("")},s.isNumber$$module$build$src$core$utils$string=function(e){return/^\s*-?\d+(\.\d+)?\s*$/.test(e)},r_=function(e){Ja=e},n_=function(){return Ja},o_=function(){return zo},l_=function(){return _t},bn=function(e){if(e=eu(e)){for(e=e.tooltip;typeof e=="function";)e=e();if(typeof e!="string")throw Error("Tooltip function must return a string.");return e}return""},eu=function(e){for(;e&&e.tooltip;){if(typeof e.tooltip=="string"||typeof e.tooltip=="function")return e;e=e.tooltip}return null},tu=function(){document.querySelector(".blocklyTooltipDiv")||(_t=document.createElement("div"),_t.className="blocklyTooltipDiv",(xs()||document.body).appendChild(_t))},En=function(e){e.mouseOverWrapper_=Xe(e,"pointerover",null,a_),e.mouseOutWrapper_=Xe(e,"pointerout",null,c_),e.addEventListener("pointermove",su,!1)},pa=function(e){e&&(Ue(e.mouseOverWrapper_),Ue(e.mouseOutWrapper_),e.removeEventListener("pointermove",su))},a_=function(e){Nn||(e=eu(e.currentTarget),ks!==e&&(xi(),Xo=null,ks=e),clearTimeout(RT))},c_=function(e){Nn||(RT=setTimeout(function(){Xo=ks=null,xi()},1),clearTimeout(Gr),Gr=0)},su=function(e){if(ks&&ks.tooltip&&!Nn)if(zo){const i=qd-e.pageX;e=Jd-e.pageY,Math.sqrt(i*i+e*e)>kT&&xi()}else Xo!==ks&&(clearTimeout(Gr),qd=e.pageX,Jd=e.pageY,Gr=setTimeout(p_,OT))},iu=function(){Xo=ks=null,xi()},xi=function(){zo&&(zo=!1,_t&&(_t.style.display="none")),Gr&&(clearTimeout(Gr),Gr=0)},ru=function(){xi(),Nn=!0},nu=function(){Nn=!1},h_=function(){_t&&ks&&(typeof Ja=="function"?Ja(_t,ks):u_())},u_=function(){var e=bn(ks);e=s.wrap$$module$build$src$core$utils$string(e,wT),e=e.split(`
`);for(let i=0;i<e.length;i++){const n=document.createElement("div");n.appendChild(document.createTextNode(e[i])),_t.appendChild(n)}},d_=function(e){const i=document.documentElement.clientWidth,n=document.documentElement.clientHeight;let c=qd;c=e?c-(Zd+_t.offsetWidth):c+Zd;let d=Jd+Qd;return d+_t.offsetHeight>n+window.scrollY&&(d-=_t.offsetHeight+2*Qd),e?c=Math.max(Za-window.scrollX,c):c+_t.offsetWidth>i+window.scrollX-2*Za&&(c=i-_t.offsetWidth-2*Za),{x:c,y:d}},p_=function(){if(!Nn&&(Xo=ks,_t)){_t.textContent="",h_();var e=ks.RTL;_t.style.direction=e?"rtl":"ltr",_t.style.display="block",zo=!0;var{x:i,y:n}=d_(e);_t.style.left=i+"px",_t.style.top=n+"px"}},ou=function(){return ep},f_=function(e){ep=e},lu=function(){return tp},g_=function(e){tp=e},Sr=function(e){e=`${e}`.toLowerCase().trim();var i=AT[e];if(i||(i=e.substring(0,2)==="0x"?"#"+e.substring(2):e,i=i[0]==="#"?i:"#"+i,/^#[0-9a-f]{6}$/.test(i)))return i;if(/^#[0-9a-f]{3}$/.test(i))return["#",i[1],i[1],i[2],i[2],i[3],i[3]].join("");var n=e.match(/^(?:rgb)?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/);return n&&(e=Number(n[1]),i=Number(n[2]),n=Number(n[3]),0<=e&&256>e&&0<=i&&256>i&&0<=n&&256>n)?yo(e,i,n):null},yo=function(e,i,n){return i=e<<16|i<<8|n,16>e?"#"+(16777216|i).toString(16).substr(1):"#"+i.toString(16)},fa=function(e){return e=Sr(e),e?(e=parseInt(e.substr(1),16),[e>>16,e>>8&255,e&255]):[0,0,0]},ga=function(e,i,n){let c=0,d=0,m=0;if(i===0)m=d=c=n;else{const y=Math.floor(e/60),O=e/60-y;e=n*(1-i);const K=n*(1-i*O);switch(i=n*(1-i*(1-O)),y){case 1:c=K,d=n,m=e;break;case 2:c=e,d=n,m=i;break;case 3:c=e,d=K,m=n;break;case 4:c=i,d=e,m=n;break;case 5:c=n,d=e,m=K;break;case 6:case 0:c=n,d=i,m=e}}return yo(Math.floor(c),Math.floor(d),Math.floor(m))},Ir=function(e,i,n){return e=Sr(e),!e||(i=Sr(i),!i)?null:(e=fa(e),i=fa(i),yo(Math.round(i[0]+n*(e[0]-i[0])),Math.round(i[1]+n*(e[1]-i[1])),Math.round(i[2]+n*(e[2]-i[2]))))},au=function(e){return ga(e,ep,255*tp)},ma=function(e,i,n){const c=[];var d=e.split("");d.push("");var m=0;e=[];let y=null;for(let oe=0;oe<d.length;oe++){var O=d[oe];if(m===0)if(O==="%")(m=e.join(""))&&c.push(m),e.length=0,m=1;else if(n&&O===`
`){const Ze=e.join("");Ze&&c.push(Ze),e.length=0,c.push(O)}else e.push(O);else if(m===1)O==="%"?(e.push(O),m=0):i&&"0"<=O&&"9">=O?(m=2,y=O,(O=e.join(""))&&c.push(O),e.length=0):O==="{"?m=3:(e.push("%",O),m=0);else if(m===2)if("0"<=O&&"9">=O)y+=O;else{var K=void 0;c.push(parseInt((K=y)!=null?K:"",10)),oe--,m=0}else m===3&&(O===""?(e.splice(0,0,"%{"),oe--,m=0):O!=="}"?e.push(O):(m=e.join(""),/[A-Z]\w*/i.test(m)?(O=m.toUpperCase(),(O=O.startsWith("BKY_")?O.substring(4):null)&&O in s.Msg$$module$build$src$core$msg?(m=s.Msg$$module$build$src$core$msg[O],typeof m=="string"?Array.prototype.push.apply(c,ma(m,i,n)):i?c.push(`${m}`):c.push(m)):c.push("%{"+m+"}")):c.push("%{"+m+"}"),m=e.length=0))}for((i=e.join(""))&&c.push(i),K=[],e.length=0,d=0;d<c.length;d++)typeof c[d]!="string"||n&&c[d]===`
`?((i=e.join(""))&&K.push(i),e.length=0,K.push(c[d])):e.push(c[d]);return(i=e.join(""))&&K.push(i),e.length=0,K},cu=function(e){return ma(e,!0,!0)},at=function(e){return typeof e!="string"?e:(e=ma(e,!1,!1),e.length?String(e[0]):"")},m_=function(e){let i=!0;const n=s.Msg$$module$build$src$core$msg,c=e.match(/%{BKY_[A-Z]\w*}/gi);if(c)for(let d=0;d<c.length;d++){const m=c[d].toUpperCase();n[m.slice(6,-1)]===void 0&&(console.warn("No message string for "+c[d]+" in "+e),i=!1)}return i},yn=function(e){const i=typeof e=="string"?at(e):e;var n=Number(i);if(!isNaN(n)&&0<=n&&360>=n)return{hue:n,hex:ga(n,ou(),255*lu())};if(n=Sr(i))return{hue:null,hex:n};throw n='Invalid colour: "'+i+'"',e!==i&&(n+=' (from "'+e+'")'),Error(n)},xr=function(){return zs},__=function(e){if(zs=e,e===null){let i;(i=document.querySelector("."+ec))==null||i.remove()}},hu=function(){const e=xs()||document.body;document.querySelector("."+ec)?zs=document.querySelector("."+ec):(zs=document.createElement("div"),zs.className=ec),e.appendChild(zs)},_a=function(e,i,n,c){if(vn(),Dn=e,Qa=n,n=zs){if(n.style.direction=i?"rtl":"ltr",n.style.display="block",!c&&e instanceof Ke){let y;c=(y=e.getSourceBlock())==null?void 0:y.workspace}var d;sp=(d=c)!=null?d:null;var m;e=(m=c)!=null?m:gt(),Bn=e.getRenderer().getClassName(),Fn=e.getTheme().getClassName(),Bn&&re(n,Bn),Fn&&re(n,Fn)}},vn=function(){if(uu()){Dn=null;var e=zs;e&&(e.style.display="none",e.style.left="",e.style.top="",Qa&&Qa(),Qa=null,e.textContent="",Bn&&(S(e,Bn),Bn=""),Fn&&(S(e,Fn),Fn=""),gt().markFocused())}},uu=function(){return!!Dn},Cr=function(e){Dn===e&&vn()},vo=function(e){sp!==null&&sp!==e||vn()},du=function(e,i,n){zs.style.left=e+"px",zs.style.top=i+"px",zs.style.height=n+"px"},pu=function(e,i,n,c){const d=T_(e,i,n);e=$_(e,i,n,c),0>d?du(e,0,n.height+d):du(e,d,n.height)},$_=function(e,i,n,c){return c?Math.min(Math.max(i.right-n.width,e.left),e.right-n.width):Math.max(Math.min(i.left,e.right-n.width),e.left)},T_=function(e,i,n){return i.bottom+n.height>=e.bottom?i.top-n.height:i.bottom},b_=function(e){return!(e==null||!e.repositionForWindowResize)},fu=function(){b_(Dn)&&Dn.repositionForWindowResize()||vn()},E_=function(){return tc},gu=function(e){tc=e},So=function(e,i,n,c){if(_a(MT,n,mu,c),i.length){var d=y_(i,n,e);sc=d,v_(d,e,n),setTimeout(function(){d.focus()},1),tc=null}else Io()},y_=function(e,i,n){const c=new Dd;c.setRole(Ws.MENU);for(let d=0;d<e.length;d++){const m=e[d],y=new Bd(m.text);y.setRightToLeft(i),y.setRole(Ws.MENUITEM),c.addChild(y),y.setEnabled(m.enabled),m.enabled&&y.onAction(function(){Io(),requestAnimationFrame(()=>{setTimeout(()=>{m.callback(m.scope,n)},0)})},{})}return c},v_=function(e,i,n){const c=Eh();i=new Ve(i.clientY+c.top,i.clientY+c.top,i.clientX+c.left,i.clientX+c.left),S_(e);const d=e.getSize();n&&(i.left+=d.width,i.right+=d.width,c.left+=d.width,c.right+=d.width),pu(c,i,d,n),e.focus()},S_=function(e){var i=xr();if(!i)throw Error("Attempting to create a context menu when widget div is null");i=e.render(i),re(i,"blocklyContextMenu"),fe(i,"contextmenu",null,I_),e.focus()},I_=function(e){e.preventDefault(),e.stopPropagation()},Io=function(){Cr(MT),tc=null},mu=function(){sc&&(sc.dispose(),sc=null)},s.callbackFactory$$module$build$src$core$contextmenu=function(e,i){return()=>{s.disable$$module$build$src$core$events$utils();let n;try{n=i instanceof Element?wr(i,e.workspace):_n(i,e.workspace);const c=e.getRelativeToSurfaceXY();c.x=e.RTL?c.x-s.config$$module$build$src$core$config.snapRadius:c.x+s.config$$module$build$src$core$config.snapRadius,c.y+=2*s.config$$module$build$src$core$config.snapRadius,n.moveBy(c.x,c.y)}finally{s.enable$$module$build$src$core$events$utils()}return ue()&&!n.isShadow()&&z(new(he(W.BLOCK_CREATE))(n)),s.setSelected$$module$build$src$core$common(n),n}},_u=function(e,i){return i=P(i,e.getParentSvg(),e.getInverseScreenCTM()),i.x/=e.scale,i.y/=e.scale,i},$a=function(e,i,n){i=_u(e,i),PT.set(e,te.difference(n,i))},Ta=function(e,i){if(i=_u(e,i),e=PT.get(e),!e)throw Error("Drag not initialized");return te.sum(e,i)},x_=function(e,i=!1){const n=s.createElement$$module$build$src$core$utils$xml("xml");var c=$u(s.allUsedVarModels$$module$build$src$core$variables(e));c.hasChildNodes()&&n.appendChild(c);for(const d of e.getTopComments())n.appendChild(xo(d,i));for(e=e.getTopBlocks(!0),c=0;c<e.length;c++)n.appendChild(Co(e[c],i));return n},xo=function(e,i=!1){const n=s.createElement$$module$build$src$core$utils$xml("comment");i||n.setAttribute("id",e.id),i=e.workspace;const c=e.getRelativeToSurfaceXY();return c.x=i.RTL?i.getWidth()-c.x:c.x,n.setAttribute("x",`${c.x}`),n.setAttribute("y",`${c.y}`),n.setAttribute("w",`${e.getSize().width}`),n.setAttribute("h",`${e.getSize().height}`),e.getText()&&(n.textContent=e.getText()),e.isCollapsed()&&n.setAttribute("collapsed","true"),e.isOwnEditable()||n.setAttribute("editable","false"),e.isOwnMovable()||n.setAttribute("movable","false"),e.isOwnDeletable()||n.setAttribute("deletable","false"),n},$u=function(e){const i=s.createElement$$module$build$src$core$utils$xml("variables");for(let n=0;n<e.length;n++){const c=e[n],d=s.createElement$$module$build$src$core$utils$xml("variable");d.appendChild(s.createTextNode$$module$build$src$core$utils$xml(c.name)),c.type&&d.setAttribute("type",c.type),d.id=c.getId(),i.appendChild(d)}return i},Co=function(e,i){if(e.isInsertionMarker()&&(e=e.getChildren(!1)[0],!e))return new DocumentFragment;let n=0;if(e.workspace.RTL&&(n=e.workspace.getWidth()),i=Qi(e,i),vu(i)){const c=e.getRelativeToSurfaceXY();i.setAttribute("x",String(Math.round(e.workspace.RTL?n-c.x:c.x))),i.setAttribute("y",String(Math.round(c.y)))}return i},C_=function(e){if(e.isSerializable()){const i=s.createElement$$module$build$src$core$utils$xml("field");return i.setAttribute("name",e.name||""),e.toXml(i)}return null},w_=function(e,i){for(let n=0;n<e.inputList.length;n++){const c=e.inputList[n];for(let d=0;d<c.fieldRow.length;d++){const m=C_(c.fieldRow[d]);m&&i.appendChild(m)}}},Qi=function(e,i){if(e.isInsertionMarker())return(i=e.getChildren(!1)[0])?Qi(i):new DocumentFragment;const n=s.createElement$$module$build$src$core$utils$xml(e.isShadow()?"shadow":"block");if(n.setAttribute("type",e.type),i||(n.id=e.id),e.mutationToDom){var c=e.mutationToDom();c&&(c.hasChildNodes()||c.hasAttributes())&&n.appendChild(c)}if(w_(e,n),c=e.getCommentText()){var d=e.getIcon(mt.COMMENT),m=d.getBubbleSize();d=d.bubbleIsVisible();var y=s.createElement$$module$build$src$core$utils$xml("comment");y.appendChild(s.createTextNode$$module$build$src$core$utils$xml(c)),y.setAttribute("pinned",`${d}`),y.setAttribute("h",String(m.height)),y.setAttribute("w",String(m.width)),n.appendChild(y)}for(e.data&&(c=s.createElement$$module$build$src$core$utils$xml("data"),c.appendChild(s.createTextNode$$module$build$src$core$utils$xml(e.data)),n.appendChild(c)),c=0;c<e.inputList.length;c++){m=e.inputList[c];var O=void 0;if(d=!0,m.type!==s.inputTypes$$module$build$src$core$inputs$input_types.DUMMY&&m.type!==s.inputTypes$$module$build$src$core$inputs$input_types.END_ROW){y=m.connection.targetBlock(),m.type===s.inputTypes$$module$build$src$core$inputs$input_types.VALUE?O=s.createElement$$module$build$src$core$utils$xml("value"):m.type===s.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT&&(O=s.createElement$$module$build$src$core$utils$xml("statement"));const oe=m.connection.getShadowDom();!oe||y&&y.isShadow()||O.appendChild(Tu(oe,i)),y&&(y=Qi(y,i),y.nodeType===Ai.ELEMENT_NODE&&(O.appendChild(y),d=!1)),O.setAttribute("name",m.name),d||n.appendChild(O)}}e.inputsInline!==void 0&&e.inputsInline!==e.inputsInlineDefault&&n.setAttribute("inline",String(e.inputsInline)),e.isCollapsed()&&n.setAttribute("collapsed","true"),e.isEnabled()||n.setAttribute("disabled-reasons",Array.from(e.getDisabledReasons()).map(encodeURIComponent).join(",")),e.isOwnDeletable()||n.setAttribute("deletable","false"),e.isOwnMovable()||n.setAttribute("movable","false"),e.isOwnEditable()||n.setAttribute("editable","false"),O=e.getNextBlock();let K;return O&&(c=Qi(O,i),c.nodeType===Ai.ELEMENT_NODE&&(K=s.createElement$$module$build$src$core$utils$xml("next"),K.appendChild(c),n.appendChild(K))),e=e.nextConnection&&e.nextConnection.getShadowDom(),!e||O&&O.isShadow()||K.appendChild(Tu(e,i)),n},Tu=function(e,i){let n=e=e.cloneNode(!0),c;for(;n;)if(i&&n.nodeName==="shadow"&&n.removeAttribute("id"),n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;){c=n,n=n.parentNode;let d;c.nodeType===Ai.TEXT_NODE&&c.data.trim()===""&&((d=n)==null?void 0:d.firstChild)!==c&&F(c)}n&&(c=n,n=n.nextSibling,c.nodeType===Ai.TEXT_NODE&&c.data.trim()===""&&F(c))}return e},li=function(e){return pn(e).replace(/<(\w+)([^<]*)\/>/g,"<$1$2></$1>")},R_=function(e){e=li(e).split("<");let i="";for(let n=1;n<e.length;n++){const c=e[n];c[0]==="/"&&(i=i.substring(2)),e[n]=i+"<"+c,c[0]!=="/"&&c.slice(-2)!=="/>"&&(i+="  ")}return e=e.join(`
`),e=e.replace(/(<(\w+)\b[^>]*>[^\n]*)\n *<\/\2>/g,"$1</$2>"),e.replace(/^\n/,"")},k_=function(e,i){return i.setResizesEnabled(!1),i.clear(),e=s.domToWorkspace$$module$build$src$core$xml(e,i),i.setResizesEnabled(!0),e},s.domToWorkspace$$module$build$src$core$xml=function(e,i){let n=0;i.RTL&&(n=i.getWidth());const c=[];Gt();const d=s.getGroup$$module$build$src$core$events$utils();d||s.setGroup$$module$build$src$core$events$utils(!0),i.setResizesEnabled&&i.setResizesEnabled(!1);let m=!0;try{for(let y=0,O;O=e.childNodes[y];y++){const K=O.nodeName.toLowerCase(),oe=O;if(K==="block"||K==="shadow"&&!k()){const Ze=wr(oe,i);c.push(Ze.id);let Je;const us=parseInt((Je=oe.getAttribute("x"))!=null?Je:"10",10);let qn;const al=parseInt((qn=oe.getAttribute("y"))!=null?qn:"10",10);isNaN(us)||isNaN(al)||Ze.moveBy(i.RTL?n-us:us,al,["create"]),m=!1}else{if(K==="shadow")throw TypeError("Shadow block cannot be a top-level block.");if(K==="comment")bu(oe,i);else if(K==="variables"){if(m)Eu(oe,i);else throw Error("'variables' tag must exist once before block and shadow tag elements in the workspace XML, but it was found in another location.");m=!1}}}}finally{s.setGroup$$module$build$src$core$events$utils(d),i.setResizesEnabled&&i.setResizesEnabled(!0),i.rendered&&Si(),ni()}return z(new(he(W.FINISHED_LOADING))(i)),c},bu=function(e,i){var n;const c=(n=e.getAttribute("id"))!=null?n:void 0;n=i.rendered?new nc(i,c):new rc(i,c);var d;n.setText((d=e.textContent)!=null?d:"");var m;d=parseInt((m=e.getAttribute("x"))!=null?m:"",10);let y;m=parseInt((y=e.getAttribute("y"))!=null?y:"",10),isNaN(d)||isNaN(m)||(d=i.RTL?i.getWidth()-d:d,n.moveTo(new te(d,m)));var O;i=parseInt((O=e.getAttribute("w"))!=null?O:"",10);let K;return O=parseInt((K=e.getAttribute("h"))!=null?K:"",10),isNaN(i)||isNaN(O)||n.setSize(new Oe(i,O)),e.getAttribute("collapsed")==="true"&&n.setCollapsed(!0),e.getAttribute("editable")==="false"&&n.setEditable(!1),e.getAttribute("movable")==="false"&&n.setMovable(!1),e.getAttribute("deletable")==="false"&&n.setDeletable(!1),n},O_=function(e,i){if(!i.getBlocksBoundingBox)return s.domToWorkspace$$module$build$src$core$xml(e,i);var n=i.getBlocksBoundingBox();if(e=s.domToWorkspace$$module$build$src$core$xml(e,i),n&&n.top!==n.bottom){var c=n.bottom;n=i.RTL?n.right:n.left;var d=1/0;let m=-1/0,y=1/0;for(let O=0;O<e.length;O++){const K=i.getBlockById(e[O]).getRelativeToSurfaceXY();K.y<y&&(y=K.y),K.x<d&&(d=K.x),K.x>m&&(m=K.x)}for(c=c-y+10,n=i.RTL?n-m:n-d,d=0;d<e.length;d++)i.getBlockById(e[d]).moveBy(n,c,["create"])}return e},s.domToBlock$$module$build$src$core$xml=function(e,i){return e=wr(e,i),i.rendered&&Si(),e},wr=function(e,i){s.disable$$module$build$src$core$events$utils();var n=i.getAllVariables();let c;try{if(c=ba(e,i),i.rendered){const d=c,m=c.getDescendants(!1);d.setConnectionTracking(!1);for(let y=m.length-1;0<=y;y--)m[y].initSvg();for(let y=m.length-1;0<=y;y--)m[y].queueRender();setTimeout(function(){d.disposed||d.setConnectionTracking(!0)},1),i.resizeContents()}else{const d=c.getDescendants(!1);for(let m=d.length-1;0<=m;m--)d[m].initModel()}}finally{s.enable$$module$build$src$core$events$utils()}if(ue()){for(e=$o(i,n),i=0;i<e.length;i++)n=e[i],z(new(he(W.VAR_CREATE))(n));z(new(he(W.BLOCK_CREATE))(c))}return c},Eu=function(e,i){for(let c=0;c<e.children.length;c++){var n=e.children[c];const d=n.getAttribute("type"),m=n.getAttribute("id");if(n=n.textContent,!n)break;i.createVariable(n,d,m)}},A_=function(e){const i={mutation:[],comment:[],data:[],field:[],input:[],next:[]};for(let n=0;n<e.children.length;n++){const c=e.children[n];if(c.nodeType!==Ai.TEXT_NODE)switch(c.nodeName.toLowerCase()){case"mutation":i.mutation.push(c);break;case"comment":i.comment.push(c);break;case"data":i.data.push(c);break;case"title":case"field":i.field.push(c);break;case"value":case"statement":i.input.push(c);break;case"next":i.next.push(c);break;default:console.warn("Ignoring unknown tag: "+c.nodeName)}}return i},M_=function(e,i){let n=!1;for(let c=0;c<e.length;c++){const d=e[c];i.domToMutation&&(i.domToMutation(d),i.initSvg&&(n=!0))}return n},L_=function(e,i){for(let c=0;c<e.length;c++){var n=e[c];const d=n.textContent,m=n.getAttribute("pinned")==="true";let y;const O=parseInt((y=n.getAttribute("w"))!=null?y:"50",10);let K;n=parseInt((K=n.getAttribute("h"))!=null?K:"50",10),i.setCommentText(d);const oe=i.getIcon(mt.COMMENT);isNaN(O)||isNaN(n)||oe.setBubbleSize(new Oe(O,n)),oe.setBubbleVisible(m),setTimeout(()=>oe.setBubbleVisible(m),1)}},P_=function(e,i){for(let n=0;n<e.length;n++)i.data=e[n].textContent},N_=function(e,i){for(let n=0;n<e.length;n++){const c=e[n],d=c.getAttribute("name");d?F_(i,d,c):console.warn(`Ignoring unnamed field in block ${i.type}`)}},yu=function(e){let i=null,n=null;for(let c=0;c<e.childNodes.length;c++){const d=e.childNodes[c];vu(d)&&(d.nodeName.toLowerCase()==="block"?i=d:d.nodeName.toLowerCase()==="shadow"&&(n=d))}return{childBlockElement:i,childShadowElement:n}},D_=function(e,i,n,c){for(let m=0;m<e.length;m++){var d=e[m];const y=d.getAttribute("name"),O=y?n.getInput(y):null;if(!O){console.warn("Ignoring non-existent input "+y+" in block "+c);break}if(d=yu(d),d.childBlockElement){if(!O.connection)throw TypeError("Input connection does not exist.");ba(d.childBlockElement,i,O.connection,!1)}if(d.childShadowElement){let K;(K=O.connection)==null||K.setShadowDom(d.childShadowElement)}}},B_=function(e,i,n){for(let c=0;c<e.length;c++){const d=yu(e[c]);if(d.childBlockElement){if(!n.nextConnection)throw TypeError("Next statement does not exist.");if(n.nextConnection.isConnected())throw TypeError("Next statement is already connected.");ba(d.childBlockElement,i,n.nextConnection,!0)}d.childShadowElement&&n.nextConnection&&n.nextConnection.setShadowDom(d.childShadowElement)}},ba=function(e,i,n,c){var d;const m=e.getAttribute("type");if(!m)throw TypeError("Block type unspecified: "+e.outerHTML);var y=(d=e.getAttribute("id"))!=null?d:void 0;d=i.newBlock(m,y),y=A_(e);const O=M_(y.mutation,d);if(L_(y.comment,d),P_(y.data,d),n)if(c)if(d.previousConnection)n.connect(d.previousConnection);else throw TypeError("Next block does not have previous statement.");else if(d.outputConnection)n.connect(d.outputConnection);else if(d.previousConnection)n.connect(d.previousConnection);else throw TypeError("Child block does not have output or previous statement.");if(N_(y.field,d),D_(y.input,i,d,m),B_(y.next,i,d),O&&d.initSvg(),(i=e.getAttribute("inline"))&&d.setInputsInline(i==="true"),(i=e.getAttribute("disabled"))&&d.setDisabledReason(i==="true"||i==="disabled",es),i=e.getAttribute("disabled-reasons"),i!==null)for(var K of i.split(","))d.setDisabledReason(!0,decodeURIComponent(K));if((K=e.getAttribute("deletable"))&&d.setDeletable(K==="true"),(K=e.getAttribute("movable"))&&d.setMovable(K==="true"),(K=e.getAttribute("editable"))&&d.setEditable(K==="true"),(K=e.getAttribute("collapsed"))&&d.setCollapsed(K==="true"),e.nodeName.toLowerCase()==="shadow"){for(e=d.getChildren(!1),K=0;K<e.length;K++)if(!e[K].isShadow())throw TypeError("Shadow block not allowed non-shadow child.");d.setShadow(!0)}return d},F_=function(e,i,n){const c=e.getField(i);c?c.fromXml(n):console.warn("Ignoring non-existent field "+i+" in block "+e.type)},U_=function(e){for(let i=0;i<e.childNodes.length;i++){const n=e.childNodes[i];if(n.nodeName.toLowerCase()==="next"){e.removeChild(n);break}}},vu=function(e){return e.nodeType===Ai.ELEMENT_NODE},Ea=function(e){if(!(100<e.getDescendants(!1).length)){var i=e.workspace,n=e.getSvgRoot();i.getAudioManager().play("delete");var c=e.getRelativeToSurfaceXY(),d=n.cloneNode(!0);d.setAttribute("transform","translate("+c.x+","+c.y+")");var m;(m=i.getLayerManager())==null||m.appendToAnimationLayer({getSvgRoot:()=>d}),Su(d,{x:c.x,y:c.y,width:e.width,height:e.height},i.RTL,new Date)}},Su=function(e,i,n,c){const d=(new Date().getTime()-c.getTime())/150;1<d?F(e):(e.setAttribute("transform","translate("+(i.x+(n?-1:1)*i.width/2*d)+","+(i.y+i.height/2*d)+") scale("+(1-d)+")"),setTimeout(Su,10,e,i,n,c))},ya=function(e){var i=e.workspace;const n=i.scale;if(i.getAudioManager().play("click"),!(1>n)){var c=i.getSvgXY(e.getSvgRoot());e.outputConnection?(c.x+=(e.RTL?3:-3)*n,c.y+=13*n):e.previousConnection&&(c.x+=(e.RTL?-23:23)*n,c.y+=3*n);var d=Y(U.CIRCLE,{cx:c.x,cy:c.y,r:0,fill:"none",stroke:"#888","stroke-width":10},i.getParentSvg());e=Y(U.ANIMATE,{id:"animationCircle",begin:"indefinite",attributeName:"r",dur:"150ms",from:0,to:25*n},d),i=Y(U.ANIMATE,{id:"animationOpacity",begin:"indefinite",attributeName:"opacity",dur:"150ms",from:1,to:0},d),e.beginElement(),i.beginElement(),setTimeout(()=>void F(d),150)}},Iu=function(e){if(Sn(),e.workspace.getAudioManager().play("disconnect"),!(1>e.workspace.scale)){var i=e.getHeightWidth().height;i=Math.atan(10/i)/Math.PI*180,e.RTL||(i*=-1),Ko=e,xu(e,i,new Date,0)}},xu=function(e,i,n,c){const d=[.66,1,.66,0,-.66,-1,-.66,0];let m="";n.getTime()+200>new Date().getTime()&&(m=`skewX(${Math.round(d[c%d.length]*i)})`,oc=setTimeout(xu,15,e,i,n,c+1)),e.getSvgRoot().setAttribute("transform",`${e.getTranslation()} ${m}`)},Sn=function(){Ko&&(oc&&(clearTimeout(oc),oc=null),Ko.getSvgRoot().setAttribute("transform",Ko.getTranslation()),Ko=null)},Rr=function(e){return e.getRelativeToSurfaceXY!==void 0&&e.isMovable!==void 0&&e.startDrag!==void 0&&e.drag!==void 0&&e.endDrag!==void 0&&e.revertDrag!==void 0},Ci=function(e,i){for(const n in i)e[n]=i[n]!==null&&typeof i[n]=="object"?Ci(e[n]||Object.create(null),i[n]):i[n];return e},ai=function(e,i){r(Z.FIELD,e,i)},G_=function(e){a(Z.FIELD,e)},s.fromJson$$module$build$src$core$field_registry=function(e){return FT.fromJsonInternal(e)},H_=function(e){const i=f(Z.FIELD,e.type);return i?i.fromJson(e):(console.warn("Blockly could not create a field of type "+e.type+". The field is probably not being registered. This could be because the file is not loaded, the field does not register itself (Issue #1584), or the registration is not being reached."),null)},s.register$$module$build$src$core$extensions=function(e,i){if(typeof e!="string"||e.trim()==="")throw Error('Error: Invalid extension name "'+e+'"');if(Gn[e])throw Error('Error: Extension "'+e+'" is already registered.');if(typeof i!="function")throw Error('Error: Extension "'+e+'" must be a function');Gn[e]=i},s.registerMixin$$module$build$src$core$extensions=function(e,i){if(!i||typeof i!="object")throw Error('Error: Mixin "'+e+'" must be a object');s.register$$module$build$src$core$extensions(e,function(){this.mixin(i)})},s.registerMutator$$module$build$src$core$extensions=function(e,i,n,c){const d='Error when registering mutator "'+e+'": ';Ru(d,i);const m=wu(i,d);if(n&&typeof n!="function")throw Error(d+'Extension "'+e+'" is not a function');s.register$$module$build$src$core$extensions(e,function(){m&&this.setMutator(new s.MutatorIcon$$module$build$src$core$icons$mutator_icon(c||[],this)),this.mixin(i),n&&n.apply(this)})},V_=function(e){Cu(e)?delete Gn[e]:console.warn('No extension mapping for name "'+e+'" found to unregister')},Cu=function(e){return!!Gn[e]},va=function(e,i,n){const c=Gn[e];if(typeof c!="function")throw Error('Error: Extension "'+e+'" not found.');let d;if(n?W_(e,i):d=Ia(i),c.apply(i),n)Ru('Error after applying mutator "'+e+'": ',i);else if(!Y_(d,i))throw Error('Error when applying extension "'+e+'": mutation properties changed when applying a non-mutator extension.')},W_=function(e,i){if(Ia(i).length)throw Error('Error: tried to apply mutation "'+e+'" to a block that already has mutator functions.  Block id: '+i.id)},z_=function(e,i){return Sa(e.mutationToDom,e.domToMutation,i+" mutationToDom/domToMutation")},X_=function(e,i){return Sa(e.saveExtraState,e.loadExtraState,i+" saveExtraState/loadExtraState")},wu=function(e,i){return Sa(e.compose,e.decompose,i+" compose/decompose")},Sa=function(e,i,n){if(e&&i){if(typeof e!="function"||typeof i!="function")throw Error(n+" must be a function");return!0}if(!e&&!i)return!1;throw Error(n+"Must have both or neither functions")},Ru=function(e,i){const n=z_(i,e),c=X_(i,e);if(!n&&!c)throw Error(e+"Mutations must contain either XML hooks, or JSON hooks, or both");wu(i,e)},Ia=function(e){const i=[];return e.domToMutation!==void 0&&i.push(e.domToMutation),e.mutationToDom!==void 0&&i.push(e.mutationToDom),e.saveExtraState!==void 0&&i.push(e.saveExtraState),e.loadExtraState!==void 0&&i.push(e.loadExtraState),e.compose!==void 0&&i.push(e.compose),e.decompose!==void 0&&i.push(e.decompose),i},Y_=function(e,i){if(i=Ia(i),i.length!==e.length)return!1;for(let n=0;n<i.length;n++)if(e[n]!==i[n])return!1;return!0},K_=function(e){if(typeof document!="object")throw Error("runAfterPageLoad() requires browser document.");if(document.readyState==="complete")e();else{const i=setInterval(function(){document.readyState==="complete"&&(clearInterval(i),e())},10)}},s.buildTooltipForDropdown$$module$build$src$core$extensions=function(e,i){const n=[];return function(){n.includes(this.type)||(j_(this,e,i),n.push(this.type)),this.setTooltip((function(){const c=String(this.getFieldValue(e));return at(i[c])}).bind(this))}},j_=function(e,i,n){var c=e.getField(i);if(c instanceof hs&&!c.isOptionListDynamic()){c=c.getOptions();for(const[,d]of c)n[d]===void 0&&console.warn(`No tooltip mapping for value ${d} of field ${i} of block type ${e.type}.`)}},s.buildTooltipWithFieldText$$module$build$src$core$extensions=function(e,i){return function(){this.setTooltip((function(){const n=this.getField(i);return at(e).replace("%1",n?n.getText():"")}).bind(this))}},q_=function(){const e=this.tooltip;this.setTooltip((function(){const i=this.getParent();return i&&i.getInputsInline()&&i.tooltip||e}).bind(this))},de=function(e,i){return" "+e+","+i+" "},as=function(e,i){return" "+e+i.join("")},Tt=function(e,i){return" M "+e+","+i+" "},Qe=function(e,i){return" m "+e+","+i+" "},ci=function(e,i){return" l "+e+","+i+" "},In=function(e){return" l"+e.join("")},ae=function(e,i){return" "+e+" "+i+" "},ct=function(e,i,n,c){return e+" "+n+" "+n+" "+i+c},ku=function(e,i){r(Z.ICON,e.toString(),i)},J_=function(e){a(Z.ICON,e)},er=function(e){return e.getProcedureModel!==void 0&&e.doProcedureUpdate!==void 0&&e.isProcedureDef!==void 0},xa=function(e){return e.startPublishing!==void 0&&e.stopPublishing!==void 0},Ca=function(e){const i=e.getProcedureMap().getProcedures().filter(c=>!c.getReturnTypes()).map(c=>[c.getName(),c.getParameters().map(d=>d.getName()),!1]);e.getBlocksByType("procedures_defnoreturn",!1).forEach(c=>{!er(c)&&gn(c)&&i.push(c.getProcedureDef())});const n=e.getProcedureMap().getProcedures().filter(c=>!!c.getReturnTypes()).map(c=>[c.getName(),c.getParameters().map(d=>d.getName()),!0]);return e.getBlocksByType("procedures_defreturn",!1).forEach(c=>{!er(c)&&gn(c)&&n.push(c.getProcedureDef())}),i.sort(Ou),n.sort(Ou),[i,n]},Ou=function(e,i){return e[0].localeCompare(i[0],void 0,{sensitivity:"base"})},s.findLegalName$$module$build$src$core$procedures=function(e,i){if(i.isInFlyout)return e;for(e=e||s.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed";!Z_(e,i.workspace,i);){const n=e.match(/^(.*?)(\d+)$/);e=n?n[1]+(parseInt(n[2])+1):e+"2"}return e},Z_=function(e,i,n){return!Au(e,i,n)},Au=function(e,i,n){for(const c of i.getAllBlocks(!1))if(c!==n&&gn(c)&&s.Names$$module$build$src$core$names.equals(c.getProcedureDef()[0],e))return!0;n=n&&er(n)?n==null?void 0:n.getProcedureModel():void 0;for(const c of i.getProcedureMap().getProcedures())if(c!==n&&s.Names$$module$build$src$core$names.equals(c.getName(),e))return!0;return!1},s.rename$$module$build$src$core$procedures=function(e){var i=this.getSourceBlock();if(!i)throw new ut;e=e.trim();const n=s.findLegalName$$module$build$src$core$procedures(e,i);er(i)&&!i.isInsertionMarker()&&i.getProcedureModel().setName(n);const c=this.getValue();if(c!==e&&c!==n)for(e=i.workspace.getAllBlocks(!1),i=0;i<e.length;i++){const d=e[i];d.renameProcedure&&d.renameProcedure(c,n)}return n},wa=function(e){function i(m,y){for(let K=0;K<m.length;K++){var O=m[K][0];const oe=m[K][1],Ze=s.createElement$$module$build$src$core$utils$xml("block");Ze.setAttribute("type",y),Ze.setAttribute("gap","16");const Je=s.createElement$$module$build$src$core$utils$xml("mutation");for(Je.setAttribute("name",O),Ze.appendChild(Je),O=0;O<oe.length;O++){const us=s.createElement$$module$build$src$core$utils$xml("arg");us.setAttribute("name",oe[O]),Je.appendChild(us)}n.push(Ze)}}const n=[];if(cs.procedures_defnoreturn){var c=s.createElement$$module$build$src$core$utils$xml("block");c.setAttribute("type","procedures_defnoreturn"),c.setAttribute("gap","16");var d=s.createElement$$module$build$src$core$utils$xml("field");d.setAttribute("name","NAME"),d.appendChild(s.createTextNode$$module$build$src$core$utils$xml(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_PROCEDURE)),c.appendChild(d),n.push(c)}return cs.procedures_defreturn&&(c=s.createElement$$module$build$src$core$utils$xml("block"),c.setAttribute("type","procedures_defreturn"),c.setAttribute("gap","16"),d=s.createElement$$module$build$src$core$utils$xml("field"),d.setAttribute("name","NAME"),d.appendChild(s.createTextNode$$module$build$src$core$utils$xml(s.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_PROCEDURE)),c.appendChild(d),n.push(c)),cs.procedures_ifreturn&&(c=s.createElement$$module$build$src$core$utils$xml("block"),c.setAttribute("type","procedures_ifreturn"),c.setAttribute("gap","16"),n.push(c)),n.length&&n[n.length-1].setAttribute("gap","24"),e=Ca(e),i(e[0],"procedures_callnoreturn"),i(e[1],"procedures_callreturn"),n},Mu=function(e){var i=[],n=e.getBlocksByType("procedures_mutatorarg",!1);for(let m=0,y;y=n[m];m++)i.push(y.getFieldValue("NAME"));n=s.createElement$$module$build$src$core$utils$xml("xml");const c=s.createElement$$module$build$src$core$utils$xml("block");c.setAttribute("type","procedures_mutatorarg");const d=s.createElement$$module$build$src$core$utils$xml("field");d.setAttribute("name","NAME"),i=oa(s.DEFAULT_ARG$$module$build$src$core$procedures,i),i=s.createTextNode$$module$build$src$core$utils$xml(i),d.appendChild(i),c.appendChild(d),n.appendChild(c),e.updateToolbox(n)},Lu=function(e){if(G(e)&&e.bubbleType==="mutator"&&e.isOpen&&e.blockId){e=pt(e.workspaceId).getBlockById(e.blockId);var i=e.type;(i==="procedures_defnoreturn"||i==="procedures_defreturn")&&(e=e.getIcon(s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE).getWorkspace(),Mu(e),e.addChangeListener(Q_))}},Q_=function(e){(w(e)||x(e)||C(e)||R(e))&&(e=pt(e.workspaceId),Mu(e))},Pu=function(e,i){return i.getAllBlocks(!1).filter(n=>e$(n,e)||km(n)&&s.Names$$module$build$src$core$names.equals(n.getProcedureCall(),e))},e$=function(e,i){return er(e)&&!e.isProcedureDef()&&e.getProcedureModel()&&s.Names$$module$build$src$core$names.equals(e.getProcedureModel().getName(),i)},s.mutateCallers$$module$build$src$core$procedures=function(e){const i=k();var n=e.getProcedureDef()[0];const c=e.mutationToDom(!0);e=Pu(n,e.workspace);for(let m=0,y;y=e[m];m++){n=(n=y.mutationToDom())&&pn(n),y.domToMutation&&y.domToMutation(c);var d=y.mutationToDom();d=d&&pn(d),n!==d&&(s.setRecordUndo$$module$build$src$core$events$utils(!1),z(new(he(W.BLOCK_CHANGE))(y,"mutation",null,n,d)),s.setRecordUndo$$module$build$src$core$events$utils(i))}},s.getDefinition$$module$build$src$core$procedures=function(e,i){for(const n of i.getAllBlocks(!1))if(er(n)&&n.isProcedureDef()&&s.Names$$module$build$src$core$names.equals(n.getProcedureModel().getName(),e)||gn(n)&&s.Names$$module$build$src$core$names.equals(n.getProcedureDef()[0],e))return n;return null},Ra=function(e){return e.isDynamic},t$=function(e){return e.pathDown!==void 0&&e.pathUp!==void 0},s$=function(e){return e.pathLeft!==void 0&&e.pathRight!==void 0},i$=function(e,i){if(!e||!i)throw Error("Cannot connect null connections.");e.targetConnection=i,i.targetConnection=e},r$=function(e,i){let n=null;i=i.outputConnection;const c=i==null?void 0:i.getConnectionChecker();for(let d=0,m;m=e.inputList[d];d++){const y=m.connection;let O;if(y&&((O=c)!=null&&O.canConnect(i,y,!1))){if(n)return null;n=y}}return n},n$=function(e,i){let n;for(;n=r$(e,i);)if(e=n.targetBlock(),!e||e.isShadow())return n;return null},Nu=function(e){return e.getType!==void 0&&e.initView!==void 0&&e.dispose!==void 0&&e.getWeight!==void 0&&e.getSize!==void 0&&e.applyColour!==void 0&&e.hideForInsertionMarker!==void 0&&e.updateEditable!==void 0&&e.updateCollapsed!==void 0&&e.isShownWhenCollapsed!==void 0&&e.setOffsetInBlock!==void 0&&e.onLocationChange!==void 0&&e.onClick!==void 0},o$=function(e){return Nu(e)&&$n(e)&&mo(e)&&e.setText!==void 0&&e.getText!==void 0&&e.setBubbleSize!==void 0&&e.getBubbleSize!==void 0&&e.getType()===mt.COMMENT},wo=function(e){let i=e.outputConnection;return(!i||e.previousConnection&&e.previousConnection.isConnected())&&(i=e.previousConnection),i},Ro=function(e,i){r(Z.RENDERER,e,i)},l$=function(e){a(Z.RENDERER,e)},Du=function(e,i,n){return e=new(p(Z.RENDERER,e))(e),e.init(i,n),e},Bu=function(e){mn(e.getTargetWorkspace(),void 0,"String")},Fu=function(e){mn(e.getTargetWorkspace(),void 0,"Number")},Uu=function(e){mn(e.getTargetWorkspace(),void 0,"Colour")},ka=function(e){let i=[],n=document.createElement("button");return n.setAttribute("text",s.Msg$$module$build$src$core$msg.NEW_STRING_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_STRING"),i.push(n),n=document.createElement("button"),n.setAttribute("text",s.Msg$$module$build$src$core$msg.NEW_NUMBER_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_NUMBER"),i.push(n),n=document.createElement("button"),n.setAttribute("text",s.Msg$$module$build$src$core$msg.NEW_COLOUR_VARIABLE),n.setAttribute("callbackKey","CREATE_VARIABLE_COLOUR"),i.push(n),e.registerButtonCallback("CREATE_VARIABLE_STRING",Bu),e.registerButtonCallback("CREATE_VARIABLE_NUMBER",Fu),e.registerButtonCallback("CREATE_VARIABLE_COLOUR",Uu),e=Gu(e),i=i.concat(e)},Gu=function(e){e=e.getAllVariables();const i=[];if(0<e.length){if(cs.variables_set_dynamic){var n=e[e.length-1];const c=s.createElement$$module$build$src$core$utils$xml("block");c.setAttribute("type","variables_set_dynamic"),c.setAttribute("gap","24"),c.appendChild(vr(n)),i.push(c)}if(cs.variables_get_dynamic){e.sort(Go.compareByName);for(let c=0,d;d=e[c];c++)n=s.createElement$$module$build$src$core$utils$xml("block"),n.setAttribute("type","variables_get_dynamic"),n.setAttribute("gap","8"),n.appendChild(vr(d)),i.push(n)}}return i},a$=function(e,i){const n=e.workspace,c=s.config$$module$build$src$core$config.snapRadius,d=te.difference(i,e.getRelativeToSurfaceXY()),m=new te(0,0),y=n.getAllBlocks(!1).filter(O=>O.id!=e.id).map(O=>O.getRelativeToSurfaceXY());for(;c$(te.sum(i,m),y)||h$(e,te.sum(d,m),c);)n.RTL?m.translate(-c,2*c):m.translate(c,2*c);e.moveTo(te.sum(i,m))},c$=function(e,i){return i.some(n=>1>=Math.abs(n.x-e.x)&&1>=Math.abs(n.y-e.y))},h$=function(e,i,n){return e.getConnections_(!1).some(c=>!!c.closest(n,i).connection)},xn=function(e,i,n){const c=n.getBoundingRectangle(),d=c.right-c.left,m=Tn(i.top,c.top,i.top+i.height-(c.bottom-c.top))-c.top;let y=i.left;return i=i.left+i.width-d,e.RTL?y=Math.min(i,y):i=Math.max(y,i),(e=Tn(y,c.left,i)-c.left)||m?(n.moveBy(e,m,["inbounds"]),!0):!1},Hu=function(e){return i=>{var n=e.getMetricsManager();if(n.hasFixedEdges()&&!e.isDragging()){var c;if(O$.includes((c=i.type)!=null?c:"")){c=n.getScrollMetrics(!0);const d=u$(e,i);d&&(n=s.getGroup$$module$build$src$core$events$utils()||!1,s.setGroup$$module$build$src$core$events$utils(i.group),xn(e,c,d)&&!i.group&&console.warn("Moved object in bounds but there was no event group. This may break undo."),s.setGroup$$module$build$src$core$events$utils(n))}else M(i)&&i.scale&&i.oldScale&&i.scale>i.oldScale&&Oa(e)}}},u$=function(e,i){let n=null;switch(i.type){case W.BLOCK_CREATE:case W.BLOCK_MOVE:(n=e.getBlockById(i.blockId))&&(n=n.getRootBlock());break;case W.COMMENT_CREATE:case W.COMMENT_MOVE:case W.COMMENT_RESIZE:n=e.getCommentById(i.commentId)}return n},Oa=function(e){var i=e.getMetricsManager();if(i.hasFixedEdges()&&!e.isDragging()){i=i.getScrollMetrics(!0);var n=e.getTopBoundedElements();for(let c=0,d;d=n[c];c++)xn(e,i,d)}},Rs=function(e){return e.isDeletable!==void 0&&e.dispose!==void 0&&e.setDeleteStyle!==void 0},d$=function(e){const i=e.toCopyData();kp=i;let n;return Op=(n=e.workspace)!=null?n:null,i},tr=function(e,i,n){return e&&i?Vu(e,i,n):kp&&Op?Vu(kp,Op):null},Vu=function(e,i,n){let c;i=i.isMutator?i:(c=i.getRootWorkspace())!=null?c:i;let d,m;return(m=(d=f(Z.PASTER,e.paster,!1))==null?void 0:d.paste(e,i,n))!=null?m:null},p$=function(e){const i=e.toCopyData();return i?tr(i,e.workspace):null},ko=function(e){return e.toCopyData!==void 0},Wu=function(){Pe.registry.register({name:fi.ESCAPE,preconditionFn(e){return!e.options.readOnly},callback(e){return e.hideChaff(),!0},keyCodes:[Re.ESC]})},zu=function(){Pe.registry.register({name:fi.DELETE,preconditionFn(e){const i=qe();return!e.options.readOnly&&i!=null&&Rs(i)&&i.isDeletable()&&!Li.inProgress()},callback(e,i){return i.preventDefault(),e=qe(),e instanceof Ps?e.checkAndDelete():Rs(e)&&e.isDeletable()&&(s.setGroup$$module$build$src$core$events$utils(!0),e.dispose(),s.setGroup$$module$build$src$core$events$utils(!1)),!0},keyCodes:[Re.DELETE,Re.BACKSPACE]})},Xu=function(){const e=Pe.registry.createSerializedKey(Re.C,[Re.CTRL]),i=Pe.registry.createSerializedKey(Re.C,[Re.ALT]),n=Pe.registry.createSerializedKey(Re.C,[Re.META]);Pe.registry.register({name:fi.COPY,preconditionFn(c){const d=qe();return!c.options.readOnly&&!Li.inProgress()&&d!=null&&Rs(d)&&d.isDeletable()&&Rr(d)&&d.isMovable()&&ko(d)},callback(c,d){return d.preventDefault(),c.hideChaff(),d=qe(),!d||!ko(d)?!1:(ur=d.toCopyData(),dr=d.workspace instanceof Es?d.workspace:c,Yn=Rr(d)?d.getRelativeToSurfaceXY():null,!!ur)},keyCodes:[e,i,n]})},Yu=function(){const e=Pe.registry.createSerializedKey(Re.X,[Re.CTRL]),i=Pe.registry.createSerializedKey(Re.X,[Re.ALT]),n=Pe.registry.createSerializedKey(Re.X,[Re.META]);Pe.registry.register({name:fi.CUT,preconditionFn(c){const d=qe();return!c.options.readOnly&&!Li.inProgress()&&d!=null&&Rs(d)&&d.isDeletable()&&Rr(d)&&d.isMovable()&&!d.workspace.isFlyout},callback(c){const d=qe();return d instanceof Ps?(ur=d.toCopyData(),dr=c,Yn=d.getRelativeToSurfaceXY(),d.checkAndDelete(),!0):Rs(d)&&d.isDeletable()&&ko(d)?(ur=d.toCopyData(),dr=c,Yn=Rr(d)?d.getRelativeToSurfaceXY():null,d.dispose(),!0):!1},keyCodes:[e,i,n]})},Ku=function(){const e=Pe.registry.createSerializedKey(Re.V,[Re.CTRL]),i=Pe.registry.createSerializedKey(Re.V,[Re.ALT]),n=Pe.registry.createSerializedKey(Re.V,[Re.META]);Pe.registry.register({name:fi.PASTE,preconditionFn(c){return!c.options.readOnly&&!Li.inProgress()},callback(){if(!ur||!dr)return!1;if(!Yn)return!!tr(ur,dr);const{left:c,top:d,width:m,height:y}=dr.getMetricsManager().getViewMetrics(!0);if(new Ve(d,d+y,c,c+m).contains(Yn.x,Yn.y))return!!tr(ur,dr);const O=new te(c+m/2,d+y/2);return!!tr(ur,dr,O)},keyCodes:[e,i,n]})},ju=function(){const e=Pe.registry.createSerializedKey(Re.Z,[Re.CTRL]),i=Pe.registry.createSerializedKey(Re.Z,[Re.ALT]),n=Pe.registry.createSerializedKey(Re.Z,[Re.META]);Pe.registry.register({name:fi.UNDO,preconditionFn(c){return!c.options.readOnly&&!Li.inProgress()},callback(c,d){return c.hideChaff(),c.undo(!1),d.preventDefault(),!0},keyCodes:[e,i,n]})},qu=function(){const e=Pe.registry.createSerializedKey(Re.Z,[Re.SHIFT,Re.CTRL]),i=Pe.registry.createSerializedKey(Re.Z,[Re.SHIFT,Re.ALT]),n=Pe.registry.createSerializedKey(Re.Z,[Re.SHIFT,Re.META]),c=Pe.registry.createSerializedKey(Re.Y,[Re.CTRL]);Pe.registry.register({name:fi.REDO,preconditionFn(d){return!Li.inProgress()&&!d.options.readOnly},callback(d,m){return d.hideChaff(),d.undo(!0),m.preventDefault(),!0},keyCodes:[e,i,n,c]})},Ju=function(){Wu(),zu(),Xu(),Yu(),Ku(),ju(),qu()},Zu=function(e){const i=e.saveState();return e.getParameters().length&&(i.parameters=e.getParameters().map(n=>n.saveState())),i},Qu=function(e,i,n,c){if(e=e.loadState(n,c),!n.parameters)return e;for(const[d,m]of n.parameters.entries())e.insertParameter(i.loadState(m,c),d);return e},f$=function(e){const i=Object.create(null),n=g(Z.SERIALIZER,!0);for(const c in n){let d;const m=(d=n[c])==null?void 0:d.save(e);m&&(i[c]=m)}return i},g$=function(e,i,{recordUndo:n=!1}={}){var c=g(Z.SERIALIZER,!0);if(c){c=Object.entries(c).sort((m,y)=>y[1].priority-m[1].priority);var d=k();s.setRecordUndo$$module$build$src$core$events$utils(n),(n=s.getGroup$$module$build$src$core$events$utils())||s.setGroup$$module$build$src$core$events$utils(!0),Gt(),i instanceof Es&&i.setResizesEnabled(!1);for(const[,m]of c.reverse()){let y;(y=m)==null||y.clear(i)}for(const[m,y]of c.reverse())if(e[m]){let O;(O=y)==null||O.load(e[m],i)}i instanceof Es&&i.setResizesEnabled(!0),ni(),z(new(he(W.FINISHED_LOADING))(i)),s.setGroup$$module$build$src$core$events$utils(n),s.setRecordUndo$$module$build$src$core$events$utils(d)}},m$=function(e,i){let n=null;n=typeof e=="string"?document.getElementById(e)||document.querySelector(e):e;var c;if(!document.contains(n)&&document!==((c=n)==null?void 0:c.ownerDocument))throw Error("Error: container is not in current document");e=new As(i||{}),c=document.createElement("div"),re(c,"injectionDiv"),i!=null&&i.rtl&&re(c,"blocklyRTL"),c.tabIndex=0,xt(c,bt.LABEL,s.Msg$$module$build$src$core$msg.WORKSPACE_ARIA_LABEL),n.appendChild(c),i=_$(c,e);const d=$$(c,i,e);return T$(d),Ft(d),kt(d),c.addEventListener("focusin",function(){Ft(d)}),fe(c,"keydown",null,Aa),fe(To(),"keydown",null,Aa),(i=xr())&&fe(i,"keydown",null,Aa),d},_$=function(e,i){e.setAttribute("dir","LTR"),Zt(i.hasCss,i.pathToMedia),e=Y(U.SVG,{xmlns:Po,"xmlns:html":ui,"xmlns:xlink":ms,version:"1.1",class:"blocklySvg",tabindex:"0"},e);const n=Y(U.DEFS,{},e),c=String(Math.random()).substring(2);return i.gridPattern=op.createDom(c,i.gridOptions,n),e},$$=function(e,i,n){n.parentWorkspace=null,n=new Es(n);const c=n.options;n.scale=c.zoomOptions.startScale,i.appendChild(n.createDom("blocklyMainBackground",e));var d=n.getRenderer().getClassName();return d&&re(e,d),(d=n.getTheme().getClassName())&&re(e,d),!c.hasCategories&&c.languageTree&&(e=n.addFlyout(U.SVG),ee(e,i)),c.hasTrashcan&&n.addTrashcan(),c.zoomOptions&&c.zoomOptions.controls&&n.addZoomControls(),n.getThemeManager().subscribe(i,"workspaceBackgroundColour","background-color"),n.translate(0,0),n.addChangeListener(Hu(n)),kt(n),hu(),Dh(),tu(),n},T$=function(e){const i=e.options;var n=e.getParentSvg();if(fe(n.parentNode,"contextmenu",null,function(c){Fs(c)||c.preventDefault()}),n=fe(window,"resize",null,function(){xi(),e.hideComponents(!0),qh(),fu(),kt(e),Oa(e)}),e.setResizeHandlerWrapper(n),b$(),i.languageTree){n=e.getToolbox();const c=e.getFlyout(!0);n?n.init():c&&(c.init(e),c.show(i.languageTree),typeof c.scrollToStart=="function"&&c.scrollToStart())}i.hasTrashcan&&e.trashcan.init(),i.zoomOptions&&i.zoomOptions.controls&&e.zoomControls_.init(),i.moveOptions&&i.moveOptions.scrollbars?(e.scrollbar=new Mp(e,i.moveOptions.scrollbars===!0||!!i.moveOptions.scrollbars.horizontal,i.moveOptions.scrollbars===!0||!!i.moveOptions.scrollbars.vertical,"blocklyMainWorkspaceScrollbar"),e.scrollbar.resize()):e.setMetrics({x:.5,y:.5}),i.hasSounds&&E$(i.pathToMedia,e)},Aa=function(e){const i=gt();i&&!(Fs(e)||i.rendered&&!i.isVisible())&&Pe.registry.onKeyDown(i,e)},b$=function(){Sb||(fe(document,"scroll",null,function(){const e=Kt();for(let i=0,n;n=e[i];i++)n instanceof Es&&n.updateInverseScreenCTM()}),Xe(document,"touchend",null,lt),Xe(document,"touchcancel",null,lt)),Sb=!0},E$=function(e,i){function n(){for(;d.length;){const m=d.pop();m&&Ue(m)}c.preload()}const c=i.getAudioManager();c.load([e+"click.mp3",e+"click.wav",e+"click.ogg"],"click"),c.load([e+"disconnect.wav",e+"disconnect.mp3",e+"disconnect.ogg"],"disconnect"),c.load([e+"delete.mp3",e+"delete.ogg",e+"delete.wav"],"delete");const d=[];d.push(fe(document,"pointermove",null,n,!0)),d.push(fe(document,"touchstart",null,n,!0))},ed=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.UNDO},preconditionFn(e){return 0<e.workspace.getUndoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!1)},scopeType:Ce.ScopeType.WORKSPACE,id:"undoWorkspace",weight:1})},td=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.REDO},preconditionFn(e){return 0<e.workspace.getRedoStack().length?"enabled":"disabled"},callback(e){e.workspace.undo(!0)},scopeType:Ce.ScopeType.WORKSPACE,id:"redoWorkspace",weight:2})},sd=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.CLEAN_UP},preconditionFn(e){return e.workspace.isMovable()?1<e.workspace.getTopBlocks(!1).length?"enabled":"disabled":"hidden"},callback(e){e.workspace.cleanUp()},scopeType:Ce.ScopeType.WORKSPACE,id:"cleanWorkspace",weight:3})},id=function(e,i){function n(m){d--,m.setCollapsed(e),d===0&&s.setGroup$$module$build$src$core$events$utils(!1)}let c=0,d=0;s.setGroup$$module$build$src$core$events$utils(!0);for(let m=0;m<i.length;m++){let y=i[m];for(;y;)d++,setTimeout(n.bind(null,y),c),y=y.getNextBlock(),c+=10}},rd=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.COLLAPSE_ALL},preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let i=0;i<e.length;i++){let n=e[i];for(;n;){if(!n.isCollapsed())return"enabled";n=n.getNextBlock()}}return"disabled"}return"hidden"},callback(e){id(!0,e.workspace.getTopBlocks(!0))},scopeType:Ce.ScopeType.WORKSPACE,id:"collapseWorkspace",weight:4})},nd=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.EXPAND_ALL},preconditionFn(e){if(e.workspace.options.collapse){e=e.workspace.getTopBlocks(!1);for(let i=0;i<e.length;i++){let n=e[i];for(;n;){if(n.isCollapsed())return"enabled";n=n.getNextBlock()}}return"disabled"}return"hidden"},callback(e){id(!1,e.workspace.getTopBlocks(!0))},scopeType:Ce.ScopeType.WORKSPACE,id:"expandWorkspace",weight:5})},od=function(e,i){if(e.isDeletable())Array.prototype.push.apply(i,e.getDescendants(!1));else{e=e.getChildren(!1);for(let n=0;n<e.length;n++)od(e[n],i)}},Ma=function(e){const i=[];e=e.getTopBlocks(!0);for(let n=0;n<e.length;n++)od(e[n],i);return i},Oo=function(e,i){i?s.setGroup$$module$build$src$core$events$utils(i):(s.setGroup$$module$build$src$core$events$utils(!0),i=s.getGroup$$module$build$src$core$events$utils());const n=e.shift();n&&(n.isDeadOrDying()?Oo(e,i):(n.dispose(!1,!0),setTimeout(Oo,10,e,i))),s.setGroup$$module$build$src$core$events$utils(!1)},ld=function(){Ce.registry.register({displayText(e){return e.workspace?(e=Ma(e.workspace).length,e===1?s.Msg$$module$build$src$core$msg.DELETE_BLOCK:s.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)):""},preconditionFn(e){return e.workspace&&0<Ma(e.workspace).length?"enabled":"disabled"},callback(e){if(e.workspace){e.workspace.cancelCurrentGesture();var i=Ma(e.workspace);2>i.length?Oo(i):ia(s.Msg$$module$build$src$core$msg.DELETE_ALL_BLOCKS.replace("%1",String(i.length)),function(n){n&&Oo(i)})}},scopeType:Ce.ScopeType.WORKSPACE,id:"workspaceDelete",weight:6})},y$=function(){ed(),td(),sd(),rd(),nd(),ld()},ad=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.DUPLICATE_BLOCK},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.isDeletable()&&e.isMovable()?e.isDuplicatable()?"enabled":"disabled":"hidden"},callback(e){if(e.block){var i=e.block.toCopyData();i&&tr(i,e.block.workspace)}},scopeType:Ce.ScopeType.BLOCK,id:"blockDuplicate",weight:1})},cd=function(){Ce.registry.register({displayText(e){return e.block.hasIcon(Di.TYPE)?s.Msg$$module$build$src$core$msg.REMOVE_COMMENT:s.Msg$$module$build$src$core$msg.ADD_COMMENT},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.workspace.options.comments&&!e.isCollapsed()&&e.isEditable()?"enabled":"hidden"},callback(e){e=e.block,e.hasIcon(Di.TYPE)?e.setCommentText(null):e.setCommentText("")},scopeType:Ce.ScopeType.BLOCK,id:"blockComment",weight:2})},hd=function(){Ce.registry.register({displayText(e){return e.block.getInputsInline()?s.Msg$$module$build$src$core$msg.EXTERNAL_INPUTS:s.Msg$$module$build$src$core$msg.INLINE_INPUTS},preconditionFn(e){if(e=e.block,!e.isInFlyout&&e.isMovable()&&!e.isCollapsed()){for(let i=1;i<e.inputList.length;i++)if(!(e.inputList[i-1]instanceof Ic||e.inputList[i]instanceof Ic))return"enabled"}return"hidden"},callback(e){e.block.setInputsInline(!e.block.getInputsInline())},scopeType:Ce.ScopeType.BLOCK,id:"blockInline",weight:3})},ud=function(){Ce.registry.register({displayText(e){return e.block.isCollapsed()?s.Msg$$module$build$src$core$msg.EXPAND_BLOCK:s.Msg$$module$build$src$core$msg.COLLAPSE_BLOCK},preconditionFn(e){return e=e.block,!e.isInFlyout&&e.isMovable()&&e.workspace.options.collapse?"enabled":"hidden"},callback(e){e.block.setCollapsed(!e.block.isCollapsed())},scopeType:Ce.ScopeType.BLOCK,id:"blockCollapseExpand",weight:4})},dd=function(){Ce.registry.register({displayText(e){return e.block.hasDisabledReason(es)?s.Msg$$module$build$src$core$msg.ENABLE_BLOCK:s.Msg$$module$build$src$core$msg.DISABLE_BLOCK},preconditionFn(e){if(e=e.block,!e.isInFlyout&&e.workspace.options.disable&&e.isEditable()){var i=e.getDisabledReasons();return i=i.size>(i.has(es)?1:0),e.getInheritedDisabled()||i?"disabled":"enabled"}return"hidden"},callback(e){e=e.block;const i=s.getGroup$$module$build$src$core$events$utils();i||s.setGroup$$module$build$src$core$events$utils(!0),e.setDisabledReason(!e.hasDisabledReason(es),es),s.setGroup$$module$build$src$core$events$utils(i)},scopeType:Ce.ScopeType.BLOCK,id:"blockDisable",weight:5})},pd=function(){Ce.registry.register({displayText(e){var i=e.block;return e=i.getDescendants(!1).length,(i=i.getNextBlock())&&(e-=i.getDescendants(!1).length),e===1?s.Msg$$module$build$src$core$msg.DELETE_BLOCK:s.Msg$$module$build$src$core$msg.DELETE_X_BLOCKS.replace("%1",`${e}`)},preconditionFn(e){return!e.block.isInFlyout&&e.block.isDeletable()?"enabled":"hidden"},callback(e){e.block&&e.block.checkAndDelete()},scopeType:Ce.ScopeType.BLOCK,id:"blockDelete",weight:6})},fd=function(){Ce.registry.register({displayText(){return s.Msg$$module$build$src$core$msg.HELP},preconditionFn(e){return e=e.block,(typeof e.helpUrl=="function"?e.helpUrl():e.helpUrl)?"enabled":"hidden"},callback(e){e.block.showHelp()},scopeType:Ce.ScopeType.BLOCK,id:"blockHelp",weight:7})},gd=function(){Ce.registry.register({displayText:()=>s.Msg$$module$build$src$core$msg.REMOVE_COMMENT,preconditionFn(e){let i;return(i=e.comment)!=null&&i.isDeletable()?"enabled":"hidden"},callback(e){s.setGroup$$module$build$src$core$events$utils(!0);let i;(i=e.comment)==null||i.dispose(),s.setGroup$$module$build$src$core$events$utils(!1)},scopeType:Ce.ScopeType.COMMENT,id:"commentDelete",weight:6})},md=function(){Ce.registry.register({displayText:()=>s.Msg$$module$build$src$core$msg.DUPLICATE_COMMENT,preconditionFn(e){let i;return(i=e.comment)!=null&&i.isMovable()?"enabled":"hidden"},callback(e){if(e.comment){var i=e.comment.toCopyData();i&&tr(i,e.comment.workspace)}},scopeType:Ce.ScopeType.COMMENT,id:"commentDuplicate",weight:1})},_d=function(){Ce.registry.register({displayText:()=>s.Msg$$module$build$src$core$msg.ADD_COMMENT,preconditionFn:e=>{let i;return(i=e.workspace)!=null&&i.isMutator?"hidden":"enabled"},callback:(e,i)=>{if(e=e.workspace){s.setGroup$$module$build$src$core$events$utils(!0);var n=new nc(e);n.setText(s.Msg$$module$build$src$core$msg.WORKSPACE_COMMENT_DEFAULT_TEXT),n.moveTo(v$(new te(i.clientX,i.clientY),e)),s.setSelected$$module$build$src$core$common(n),s.setGroup$$module$build$src$core$events$utils(!1)}},scopeType:Ce.ScopeType.WORKSPACE,id:"commentCreate",weight:8})},v$=function(e,i){var n=i.getInjectionDiv().getBoundingClientRect();return e=new te(e.x-n.left,e.y-n.top),n=i.getOriginOffsetInPixels(),e=te.difference(e,n),e.scale(1/i.scale),e},S$=function(){ad(),cd(),hd(),ud(),dd(),pd(),fd()},I$=function(){md(),gd(),_d()},$d=function(){y$(),S$()},x$=function(e){return e.paste!==void 0},C$=function(e){return e.getSvgRoot!==void 0},w$=function(e){return typeof e.id=="string"&&e.workspace!==void 0&&e.select!==void 0&&e.unselect!==void 0},R$=function(e){return e.isSelectable()},k$=function(e){gt().hideChaff(e)},q=q||{},q.scope={},q.ASSUME_ES5=!1,q.ASSUME_NO_NATIVE_MAP=!1,q.ASSUME_NO_NATIVE_SET=!1,q.SIMPLE_FROUND_POLYFILL=!1,q.ISOLATE_POLYFILLS=!1,q.FORCE_POLYFILL_PROMISE=!1,q.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1,q.defineProperty=q.ASSUME_ES5||typeof Object.defineProperties=="function"?Object.defineProperty:function(e,i,n){return e==Array.prototype||e==Object.prototype||(e[i]=n.value),e},q.getGlobal=function(e){e=[typeof globalThis=="object"&&globalThis,e,typeof window=="object"&&window,typeof self=="object"&&self,typeof nn=="object"&&nn];for(var i=0;i<e.length;++i){var n=e[i];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")},q.global=q.getGlobal(this),q.IS_SYMBOL_NATIVE=typeof Symbol=="function"&&typeof Symbol("x")=="symbol",q.TRUST_ES6_POLYFILLS=!q.ISOLATE_POLYFILLS||q.IS_SYMBOL_NATIVE,q.polyfills={},q.propertyToPolyfillSymbol={},q.POLYFILL_PREFIX="$jscp$",q.polyfill=function(e,i,n,c){i&&(q.ISOLATE_POLYFILLS?q.polyfillIsolated(e,i,n,c):q.polyfillUnisolated(e,i,n,c))},q.polyfillUnisolated=function(e,i,n,c){for(n=q.global,e=e.split("."),c=0;c<e.length-1;c++){var d=e[c];if(!(d in n))return;n=n[d]}e=e[e.length-1],c=n[e],i=i(c),i!=c&&i!=null&&q.defineProperty(n,e,{configurable:!0,writable:!0,value:i})},q.polyfillIsolated=function(e,i,n,c){var d=e.split(".");e=d.length===1,c=d[0],c=!e&&c in q.polyfills?q.polyfills:q.global;for(var m=0;m<d.length-1;m++){var y=d[m];if(!(y in c))return;c=c[y]}d=d[d.length-1],n=q.IS_SYMBOL_NATIVE&&n==="es6"?c[d]:null,i=i(n),i!=null&&(e?q.defineProperty(q.polyfills,d,{configurable:!0,writable:!0,value:i}):i!==n&&(q.propertyToPolyfillSymbol[d]===void 0&&(n=1e9*Math.random()>>>0,q.propertyToPolyfillSymbol[d]=q.IS_SYMBOL_NATIVE?q.global.Symbol(d):q.POLYFILL_PREFIX+n+"$"+d),q.defineProperty(c,q.propertyToPolyfillSymbol[d],{configurable:!0,writable:!0,value:i})))},q.underscoreProtoCanBeSet=function(){var e={a:!0},i={};try{return i.__proto__=e,i.a}catch{}return!1},q.setPrototypeOf=q.TRUST_ES6_POLYFILLS&&typeof Object.setPrototypeOf=="function"?Object.setPrototypeOf:q.underscoreProtoCanBeSet()?function(e,i){if(e.__proto__=i,e.__proto__!==i)throw new TypeError(e+" is not extensible");return e}:null,q.arrayIteratorImpl=function(e){var i=0;return function(){return i<e.length?{done:!1,value:e[i++]}:{done:!0}}},q.arrayIterator=function(e){return{next:q.arrayIteratorImpl(e)}},q.makeIterator=function(e){var i=typeof Symbol<"u"&&Symbol.iterator&&e[Symbol.iterator];if(i)return i.call(e);if(typeof e.length=="number")return q.arrayIterator(e);throw Error(String(e)+" is not an iterable or ArrayLike")},q.generator={},q.generator.ensureIteratorResultIsObject_=function(e){if(!(e instanceof Object))throw new TypeError("Iterator result "+e+" is not an object")},q.generator.Context=function(){this.isRunning_=!1,this.yieldAllIterator_=null,this.yieldResult=void 0,this.nextAddress=1,this.finallyAddress_=this.catchAddress_=0,this.finallyContexts_=this.abruptCompletion_=null},q.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError("Generator is already running");this.isRunning_=!0},q.generator.Context.prototype.stop_=function(){this.isRunning_=!1},q.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_},q.generator.Context.prototype.next_=function(e){this.yieldResult=e},q.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0},this.jumpToErrorHandler_()},q.generator.Context.prototype.return=function(e){this.abruptCompletion_={return:e},this.nextAddress=this.finallyAddress_},q.generator.Context.prototype.jumpThroughFinallyBlocks=function(e){this.abruptCompletion_={jumpTo:e},this.nextAddress=this.finallyAddress_},q.generator.Context.prototype.yield=function(e,i){return this.nextAddress=i,{value:e}},q.generator.Context.prototype.yieldAll=function(e,i){e=q.makeIterator(e);var n=e.next();if(q.generator.ensureIteratorResultIsObject_(n),n.done)this.yieldResult=n.value,this.nextAddress=i;else return this.yieldAllIterator_=e,this.yield(n.value,i)},q.generator.Context.prototype.jumpTo=function(e){this.nextAddress=e},q.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0},q.generator.Context.prototype.setCatchFinallyBlocks=function(e,i){this.catchAddress_=e,i!=null&&(this.finallyAddress_=i)},q.generator.Context.prototype.setFinallyBlock=function(e){this.catchAddress_=0,this.finallyAddress_=e||0},q.generator.Context.prototype.leaveTryBlock=function(e,i){this.nextAddress=e,this.catchAddress_=i||0},q.generator.Context.prototype.enterCatchBlock=function(e){return this.catchAddress_=e||0,e=this.abruptCompletion_.exception,this.abruptCompletion_=null,e},q.generator.Context.prototype.enterFinallyBlock=function(e,i,n){n?this.finallyContexts_[n]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_],this.catchAddress_=e||0,this.finallyAddress_=i||0},q.generator.Context.prototype.leaveFinallyBlock=function(e,i){if(i=this.finallyContexts_.splice(i||0)[0],i=this.abruptCompletion_=this.abruptCompletion_||i){if(i.isException)return this.jumpToErrorHandler_();i.jumpTo!=null&&this.finallyAddress_<i.jumpTo?(this.nextAddress=i.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=e},q.generator.Context.prototype.forIn=function(e){return new q.generator.Context.PropertyIterator(e)},q.generator.Context.PropertyIterator=function(e){this.object_=e,this.properties_=[];for(var i in e)this.properties_.push(i);this.properties_.reverse()},q.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var e=this.properties_.pop();if(e in this.object_)return e}return null},q.generator.Engine_=function(e){this.context_=new q.generator.Context,this.program_=e},q.generator.Engine_.prototype.next_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.next,e,this.context_.next_):(this.context_.next_(e),this.nextStep_())},q.generator.Engine_.prototype.return_=function(e){this.context_.start_();var i=this.context_.yieldAllIterator_;return i?this.yieldAllStep_("return"in i?i.return:function(n){return{value:n,done:!0}},e,this.context_.return):(this.context_.return(e),this.nextStep_())},q.generator.Engine_.prototype.throw_=function(e){return this.context_.start_(),this.context_.yieldAllIterator_?this.yieldAllStep_(this.context_.yieldAllIterator_.throw,e,this.context_.next_):(this.context_.throw_(e),this.nextStep_())},q.generator.Engine_.prototype.yieldAllStep_=function(e,i,n){try{var c=e.call(this.context_.yieldAllIterator_,i);if(q.generator.ensureIteratorResultIsObject_(c),!c.done)return this.context_.stop_(),c;var d=c.value}catch(m){return this.context_.yieldAllIterator_=null,this.context_.throw_(m),this.nextStep_()}return this.context_.yieldAllIterator_=null,n.call(this.context_,d),this.nextStep_()},q.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var e=this.program_(this.context_);if(e)return this.context_.stop_(),{value:e.value,done:!1}}catch(i){this.context_.yieldResult=void 0,this.context_.throw_(i)}if(this.context_.stop_(),this.context_.abruptCompletion_){if(e=this.context_.abruptCompletion_,this.context_.abruptCompletion_=null,e.isException)throw e.exception;return{value:e.return,done:!0}}return{value:void 0,done:!0}},q.generator.Generator_=function(e){this.next=function(i){return e.next_(i)},this.throw=function(i){return e.throw_(i)},this.return=function(i){return e.return_(i)},this[Symbol.iterator]=function(){return this}},q.generator.createGenerator=function(e,i){return i=new q.generator.Generator_(new q.generator.Engine_(i)),q.setPrototypeOf&&e.prototype&&q.setPrototypeOf(i,e.prototype),i},q.asyncExecutePromiseGenerator=function(e){function i(c){return e.next(c)}function n(c){return e.throw(c)}return new Promise(function(c,d){function m(y){y.done?c(y.value):Promise.resolve(y.value).then(i,n).then(m,d)}m(e.next())})},q.asyncExecutePromiseGeneratorFunction=function(e){return q.asyncExecutePromiseGenerator(e())},q.asyncExecutePromiseGeneratorProgram=function(e){return q.asyncExecutePromiseGenerator(new q.generator.Generator_(new q.generator.Engine_(e)))},q.polyfill("globalThis",function(e){return e||q.global},"es_2020","es3"),q.polyfill("Array.prototype.includes",function(e){return e||function(i,n){var c=this;c instanceof String&&(c=String(c));var d=c.length;for(n=n||0,0>n&&(n=Math.max(n+d,0));n<d;n++){var m=c[n];if(m===i||Object.is(m,i))return!0}return!1}},"es7","es3"),q.initSymbol=function(){},q.iteratorPrototype=function(e){return e={next:e},e[Symbol.iterator]=function(){return this},e},q.iteratorFromArray=function(e,i){e instanceof String&&(e+="");var n=0,c=!1,d={next:function(){if(!c&&n<e.length){var m=n++;return{value:i(m,e[m]),done:!1}}return c=!0,{done:!0,value:void 0}}};return d[Symbol.iterator]=function(){return d},d},q.polyfill("Array.prototype.values",function(e){return e||function(){return q.iteratorFromArray(this,function(i,n){return n})}},"es8","es3"),q.polyfill("Array.prototype.flat",function(e){return e||function(i){i=i===void 0?1:i;var n=[];return Array.prototype.forEach.call(this,function(c){Array.isArray(c)&&0<i?(c=Array.prototype.flat.call(c,i-1),n.push.apply(n,c)):n.push(c)}),n}},"es9","es5"),q.polyfill("Array.prototype.flatMap",function(e){return e||function(i,n){var c=[];return Array.prototype.forEach.call(this,function(d,m){d=i.call(n,d,m,this),Array.isArray(d)?c.push.apply(c,d):c.push(d)}),c}},"es9","es5"),q.owns=function(e,i){return Object.prototype.hasOwnProperty.call(e,i)},q.polyfill("Object.entries",function(e){return e||function(i){var n=[],c;for(c in i)q.owns(i,c)&&n.push([c,i[c]]);return n}},"es8","es3"),q.polyfill("Object.values",function(e){return e||function(i){var n=[],c;for(c in i)q.owns(i,c)&&n.push(i[c]);return n}},"es8","es3");var sr=Object.create(null),Xx={typeMap:sr},La=Object.create(null),hi="default",Z=class{constructor(e){this.name=e}toString(){return this.name}};Z.CONNECTION_CHECKER=new Z("connectionChecker"),Z.CONNECTION_PREVIEWER=new Z("connectionPreviewer"),Z.CURSOR=new Z("cursor"),Z.EVENT=new Z("event"),Z.FIELD=new Z("field"),Z.INPUT=new Z("input"),Z.RENDERER=new Z("renderer"),Z.TOOLBOX=new Z("toolbox"),Z.THEME=new Z("theme"),Z.TOOLBOX_ITEM=new Z("toolboxItem"),Z.FLYOUTS_VERTICAL_TOOLBOX=new Z("flyoutsVerticalToolbox"),Z.FLYOUTS_HORIZONTAL_TOOLBOX=new Z("flyoutsHorizontalToolbox"),Z.METRICS_MANAGER=new Z("metricsManager"),Z.BLOCK_DRAGGER=new Z("blockDragger"),Z.SERIALIZER=new Z("serializer"),Z.ICON=new Z("icon"),Z.PASTER=new Z("paster");var wi={DEFAULT:hi,TEST_ONLY:Xx};wi.Type=Z,wi.getAllItems=g,wi.getClass=p,wi.getClassFromOptions=_,wi.getObject=f,wi.hasItem=u,wi.register=r,wi.unregister=a;var cs=Object.create(null),W;(function(e){e.BLOCK_CREATE="create",e.BLOCK_DELETE="delete",e.BLOCK_CHANGE="change",e.BLOCK_FIELD_INTERMEDIATE_CHANGE="block_field_intermediate_change",e.BLOCK_MOVE="move",e.VAR_CREATE="var_create",e.VAR_DELETE="var_delete",e.VAR_RENAME="var_rename",e.UI="ui",e.BLOCK_DRAG="drag",e.SELECTED="selected",e.CLICK="click",e.MARKER_MOVE="marker_move",e.BUBBLE_OPEN="bubble_open",e.TRASHCAN_OPEN="trashcan_open",e.TOOLBOX_ITEM_SELECT="toolbox_item_select",e.THEME_CHANGE="theme_change",e.VIEWPORT_CHANGE="viewport_change",e.COMMENT_CREATE="comment_create",e.COMMENT_DELETE="comment_delete",e.COMMENT_CHANGE="comment_change",e.COMMENT_MOVE="comment_move",e.COMMENT_RESIZE="comment_resize",e.COMMENT_DRAG="comment_drag",e.COMMENT_COLLAPSE="comment_collapse",e.FINISHED_LOADING="finished_loading"})(W||(W={}));var O$=[W.BLOCK_CREATE,W.BLOCK_MOVE,W.COMMENT_CREATE,W.COMMENT_MOVE],A$=new Set,M$={};M$.warn=$;var L$="!#$%()*+,-./:;=?@[]^_`{|}~ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",P$={genUid:()=>{const e=L$.length,i=[];for(let n=0;20>n;n++)i[n]=L$.charAt(Math.random()*e);return i.join("")}},Yx=0,Td={TEST_ONLY:P$};Td.genUid=v,Td.getNextUniqueId=E;var N$="",Ao=!0,bd=0,Ed="ORPHANED_BLOCK",Ri=[],D$={FIRE_QUEUE:Ri,enqueueEvent:ie,fireNow:Q,fireInternal:se,setGroupInternal:St};s.disable$$module$build$src$core$events$utils,s.enable$$module$build$src$core$events$utils,s.getGroup$$module$build$src$core$events$utils,s.setGroup$$module$build$src$core$events$utils,s.setRecordUndo$$module$build$src$core$events$utils;var Mo=Object.create(null),B$,kr=null,F$,Lo=[],U$={defineBlocksWithJsonArrayInternal:Ut},Ot={TEST_ONLY:U$};Ot.createBlockDefinitionsFromJsonArray=s.createBlockDefinitionsFromJsonArray$$module$build$src$core$common,Ot.defineBlocks=s.defineBlocks$$module$build$src$core$common,Ot.defineBlocksWithJsonArray=jt,Ot.draggingConnections=Lo,Ot.getAllWorkspaces=Kt,Ot.getBlockTypeCounts=os,Ot.getMainWorkspace=gt,Ot.getParentContainer=xs,Ot.getSelected=qe,Ot.getWorkspaceById=pt,Ot.registerWorkspace=ps,Ot.setMainWorkspace=Ft,Ot.setParentContainer=si,Ot.setSelected=s.setSelected$$module$build$src$core$common,Ot.svgResize=kt,Ot.unregisterWorkpace=fs;var Cn=class{constructor(){this.workspaceId=void 0,this.isUiEvent=!1,this.type="",this.group=s.getGroup$$module$build$src$core$events$utils(),this.recordUndo=k()}toJson(){return{type:this.type,group:this.group}}static fromJson(e,i,n){return n.isBlank=!1,n.group=e.group||"",n.workspaceId=i.id,n}isNull(){return!1}run(e){}getEventWorkspace_(){let e;if(this.workspaceId&&(e=pt(this.workspaceId)),!e)throw Error("Workspace is null. Event must have been generated from real Blockly events.");return e}},Hs=class extends Cn{constructor(e){super(),this.recordUndo=!1,this.isUiEvent=!0,this.isBlank=typeof e>"u",this.workspaceId=e||""}},yd=class extends Hs{constructor(e,i,n){i=e?e.workspace.id:i,i===null&&(i=void 0),super(i),this.type=W.CLICK,this.blockId=e?e.id:void 0,this.targetType=n}toJson(){const e=super.toJson();if(!this.targetType)throw Error("The click target type is undefined. Either pass a block to the constructor, or call fromJson");return e.targetType=this.targetType,e.blockId=this.blockId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new yd),i.targetType=e.targetType,i.blockId=e.blockId,i}},vd;(function(e){e.BLOCK="block",e.WORKSPACE="workspace",e.ZOOM_CONTROLS="zoom_controls"})(vd||(vd={})),r(Z.EVENT,W.CLICK,yd);var Kx=750,G$="ontouchstart"in globalThis||!!(globalThis.document&&document.documentElement&&"ontouchstart"in document.documentElement)||!(!globalThis.navigator||!globalThis.navigator.maxTouchPoints&&!globalThis.navigator.msMaxTouchPoints),Pa=null,Or={mousedown:["pointerdown"],mouseenter:["pointerenter"],mouseleave:["pointerleave"],mousemove:["pointermove"],mouseout:["pointerout"],mouseover:["pointerover"],mouseup:["pointerup","pointercancel"],touchend:["pointerup"],touchcancel:["pointercancel"]},Na=0,Ar={TOUCH_ENABLED:G$,TOUCH_MAP:Or};Ar.checkTouchIdentifier=vi,Ar.clearTouchIdentifier=It,Ar.getTouchIdentifierFromEvent=ws,Ar.longStart=qt,Ar.longStop=lt,Ar.shouldHandleEvent=Cs;var Sd,H$,V$,W$,Da,Ba,Id,z$,X$,Y$;(function(e){function i(c){return n.includes(c.toUpperCase())}Sd=e;const n=Sd.toUpperCase();H$=i("JavaFX"),V$=i("WebKit"),W$=i("Gecko")&&!V$,Da=i("Android"),e=globalThis.navigator&&globalThis.navigator.maxTouchPoints,Ba=i("iPad")||i("Macintosh")&&0<e,Id=i("iPhone")&&!Ba,z$=i("Macintosh"),X$=Ba||Da&&!i("Mobile")||i("Silk"),Y$=!X$&&(Id||Da)})(globalThis.navigator&&globalThis.navigator.userAgent||"");var jx=Sd,K$=H$,j$=W$,xd=Da,Fa=Ba,q$=Id,Cd=z$,J$=Y$,qx={ANDROID:xd,GECKO:j$,IPAD:Fa,IPHONE:q$,JavaFx:K$,MAC:Cd,MOBILE:J$,raw:jx},Z$=40,Q$=125,ki={};ki.bind=Xe,ki.conditionalBind=fe,ki.getScrollDeltaPixels=ri,ki.isRightButton=Jt,ki.isTargetInput=Fs,ki.mouseToSvg=P,ki.unbind=Ue;var eT={};eT.removeElem=$t;var Oi=class{constructor(e){this.name=e}toString(){return this.name}};Oi.POSITIONABLE=new Oi("positionable"),Oi.DRAG_TARGET=new Oi("drag_target"),Oi.DELETE_AREA=new Oi("delete_area"),Oi.AUTOHIDEABLE=new Oi("autohideable");var et=class{constructor(){this.componentData=new Map,this.capabilityToComponentIds=new Map}addComponent(e,i){const n=e.component.id;if(!i&&this.componentData.has(n)){var c;throw Error('Plugin "'+n+'" with capabilities "'+((c=this.componentData.get(n))==null?void 0:c.capabilities)+'" already added.')}for(this.componentData.set(n,e),i=[],c=0;c<e.capabilities.length;c++){const d=String(e.capabilities[c]).toLowerCase();if(i.push(d),this.capabilityToComponentIds.has(d)){let m;(m=this.capabilityToComponentIds.get(d))==null||m.push(n)}else this.capabilityToComponentIds.set(d,[n])}this.componentData.get(n).capabilities=i}removeComponent(e){const i=this.componentData.get(e);if(i){for(let n=0;n<i.capabilities.length;n++){const c=String(i.capabilities[n]).toLowerCase();$t(this.capabilityToComponentIds.get(c),e)}this.componentData.delete(e)}}addCapability(e,i){if(!this.getComponent(e))throw Error('Cannot add capability, "'+i+'". Plugin "'+e+'" has not been added to the ComponentManager');if(this.hasCapability(e,i))console.warn('Plugin "'+e+'already has capability "'+i+'"');else{i=`${i}`.toLowerCase();var n;(n=this.componentData.get(e))==null||n.capabilities.push(i);var c;(c=this.capabilityToComponentIds.get(i))==null||c.push(e)}}removeCapability(e,i){if(!this.getComponent(e))throw Error('Cannot remove capability, "'+i+'". Plugin "'+e+'" has not been added to the ComponentManager');this.hasCapability(e,i)?(i=`${i}`.toLowerCase(),$t(this.componentData.get(e).capabilities,i),$t(this.capabilityToComponentIds.get(i),e)):console.warn('Plugin "'+e+`doesn't have capability "`+i+'" to remove')}hasCapability(e,i){return i=`${i}`.toLowerCase(),this.componentData.has(e)&&this.componentData.get(e).capabilities.includes(i)}getComponent(e){let i;return(i=this.componentData.get(e))==null?void 0:i.component}getComponents(e,i){if(e=`${e}`.toLowerCase(),e=this.capabilityToComponentIds.get(e),!e)return[];const n=[];if(i){const c=[];e.forEach(d=>{c.push(this.componentData.get(d))}),c.sort(function(d,m){return d.weight-m.weight}),c.forEach(function(d){n.push(d.component)})}else e.forEach(c=>{n.push(this.componentData.get(c).component)});return n}};et.Capability=Oi,function(e){e=e.ComponentWeight||(e.ComponentWeight={}),e[e.TOOLBOX_WEIGHT=0]="TOOLBOX_WEIGHT",e[e.FLYOUT_WEIGHT=1]="FLYOUT_WEIGHT",e[e.TRASHCAN_WEIGHT=2]="TRASHCAN_WEIGHT",e[e.ZOOM_CONTROLS_WEIGHT=3]="ZOOM_CONTROLS_WEIGHT"}(et||(et={})),et.ComponentWeight;var wd=!1,Rd=`
.blocklySvg {
  background-color: #fff;
  outline: none;
  overflow: hidden;  /* IE overflows by default. */
  position: absolute;
  display: block;
}

.blocklyWidgetDiv {
  display: none;
  position: absolute;
  z-index: 99999;  /* big value for bootstrap3 compatibility */
}

.injectionDiv {
  height: 100%;
  position: relative;
  overflow: hidden;  /* So blocks in drag surface disappear at edges */
  touch-action: none;
  user-select: none;
  -webkit-user-select: none;
}

.blocklyNonSelectable {
  user-select: none;
  -ms-user-select: none;
  -webkit-user-select: none;
}

.blocklyBlockCanvas.blocklyCanvasTransitioning,
.blocklyBubbleCanvas.blocklyCanvasTransitioning {
  transition: transform .5s;
}

.blocklyTooltipDiv {
  background-color: #ffffc7;
  border: 1px solid #ddc;
  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);
  color: #000;
  display: none;
  font: 9pt sans-serif;
  opacity: .9;
  padding: 2px;
  position: absolute;
  z-index: 100000;  /* big value for bootstrap3 compatibility */
}

.blocklyDropDownDiv {
  position: absolute;
  left: 0;
  top: 0;
  z-index: 1000;
  display: none;
  border: 1px solid;
  border-color: #dadce0;
  background-color: #fff;
  border-radius: 2px;
  padding: 4px;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownContent {
  max-height: 300px;  /* @todo: spec for maximum height. */
  overflow: auto;
  overflow-x: hidden;
  position: relative;
}

.blocklyDropDownArrow {
  position: absolute;
  left: 0;
  top: 0;
  width: 16px;
  height: 16px;
  z-index: -1;
  background-color: inherit;
  border-color: inherit;
}

.blocklyDropDownButton {
  display: inline-block;
  float: left;
  padding: 0;
  margin: 4px;
  border-radius: 4px;
  outline: none;
  border: 1px solid;
  transition: box-shadow .1s;
  cursor: pointer;
}

.blocklyArrowTop {
  border-top: 1px solid;
  border-left: 1px solid;
  border-top-left-radius: 4px;
  border-color: inherit;
}

.blocklyArrowBottom {
  border-bottom: 1px solid;
  border-right: 1px solid;
  border-bottom-right-radius: 4px;
  border-color: inherit;
}

.blocklyResizeSE {
  cursor: se-resize;
  fill: #aaa;
}

.blocklyResizeSW {
  cursor: sw-resize;
  fill: #aaa;
}

.blocklyResizeLine {
  stroke: #515A5A;
  stroke-width: 1;
}

.blocklyHighlightedConnectionPath {
  fill: none;
  stroke: #fc3;
  stroke-width: 4px;
}

.blocklyPathLight {
  fill: none;
  stroke-linecap: round;
  stroke-width: 1;
}

.blocklySelected>.blocklyPathLight {
  display: none;
}

.blocklyDraggable {
  cursor: grab;
  cursor: -webkit-grab;
}

.blocklyDragging {
  cursor: grabbing;
  cursor: -webkit-grabbing;
  /* Drag surface disables events to not block the toolbox, so we have to
   * reenable them here for the cursor values to work. */
  pointer-events: auto;
}

  /* Changes cursor on mouse down. Not effective in Firefox because of
     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */
.blocklyDraggable:active {
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

.blocklyDragging.blocklyDraggingDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyDragging>.blocklyPath,
.blocklyDragging>.blocklyPathLight {
  fill-opacity: .8;
  stroke-opacity: .8;
}

.blocklyDragging>.blocklyPathDark {
  display: none;
}

.blocklyDisabled>.blocklyPath {
  fill-opacity: .5;
  stroke-opacity: .5;
}

.blocklyDisabled>.blocklyPathLight,
.blocklyDisabled>.blocklyPathDark {
  display: none;
}

.blocklyInsertionMarker>.blocklyPath,
.blocklyInsertionMarker>.blocklyPathLight,
.blocklyInsertionMarker>.blocklyPathDark {
  fill-opacity: .2;
  stroke: none;
}

.blocklyNonEditableText>text {
  pointer-events: none;
}

.blocklyFlyout {
  position: absolute;
  z-index: 20;
}

.blocklyText text {
  cursor: default;
}

.blocklyHidden {
  display: none;
}

.blocklyFieldDropdown:not(.blocklyHidden) {
  display: block;
}

.blocklyIconGroup {
  cursor: default;
}

.blocklyIconGroup:not(:hover),
.blocklyIconGroupReadonly {
  opacity: .6;
}

.blocklyIconShape {
  fill: #00f;
  stroke: #fff;
  stroke-width: 1px;
}

.blocklyIconSymbol {
  fill: #fff;
}

.blocklyMinimalBody {
  margin: 0;
  padding: 0;
  height: 100%;
}

.blocklyHtmlInput {
  border: none;
  border-radius: 4px;
  height: 100%;
  margin: 0;
  outline: none;
  padding: 0;
  width: 100%;
  text-align: center;
  display: block;
  box-sizing: border-box;
}

/* Remove the increase and decrease arrows on the field number editor */
input.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,
input.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}

input[type=number] {
  -moz-appearance: textfield;
}

.blocklyMainBackground {
  stroke-width: 1;
  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */
}

.blocklyMutatorBackground {
  fill: #fff;
  stroke: #ddd;
  stroke-width: 1;
}

.blocklyFlyoutBackground {
  fill: #ddd;
  fill-opacity: .8;
}

.blocklyMainWorkspaceScrollbar {
  z-index: 20;
}

.blocklyFlyoutScrollbar {
  z-index: 30;
}

.blocklyScrollbarHorizontal,
.blocklyScrollbarVertical {
  position: absolute;
  outline: none;
}

.blocklyScrollbarBackground {
  opacity: 0;
  pointer-events: none;
}

.blocklyScrollbarHandle {
  fill: #ccc;
}

.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyScrollbarHandle:hover {
  fill: #bbb;
}

/* Darken flyout scrollbars due to being on a grey background. */
/* By contrast, workspace scrollbars are on a white background. */
.blocklyFlyout .blocklyScrollbarHandle {
  fill: #bbb;
}

.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,
.blocklyFlyout .blocklyScrollbarHandle:hover {
  fill: #aaa;
}

.blocklyInvalidInput {
  background: #faa;
}

.blocklyVerticalMarker {
  stroke-width: 3px;
  fill: rgba(255,255,255,.5);
  pointer-events: none;
}

.blocklyComputeCanvas {
  position: absolute;
  width: 0;
  height: 0;
}

.blocklyNoPointerEvents {
  pointer-events: none;
}

.blocklyContextMenu {
  border-radius: 4px;
  max-height: 100%;
}

.blocklyDropdownMenu {
  border-radius: 2px;
  padding: 0 !important;
}

.blocklyDropdownMenu .blocklyMenuItem {
  /* 28px on the left for icon or checkbox. */
  padding-left: 28px;
}

/* BiDi override for the resting state. */
.blocklyDropdownMenu .blocklyMenuItemRtl {
  /* Flip left/right padding for BiDi. */
  padding-left: 5px;
  padding-right: 28px;
}

.blocklyWidgetDiv .blocklyMenu {
  background: #fff;
  border: 1px solid transparent;
  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);
  font: normal 13px Arial, sans-serif;
  margin: 0;
  outline: none;
  padding: 4px 0;
  position: absolute;
  overflow-y: auto;
  overflow-x: hidden;
  max-height: 100%;
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

.blocklyWidgetDiv .blocklyMenu.blocklyFocused {
  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);
}

.blocklyDropDownDiv .blocklyMenu {
  background: inherit;  /* Compatibility with gapi, reset from goog-menu */
  border: inherit;  /* Compatibility with gapi, reset from goog-menu */
  font: normal 13px "Helvetica Neue", Helvetica, sans-serif;
  outline: none;
  position: relative;  /* Compatibility with gapi, reset from goog-menu */
  z-index: 20000;  /* Arbitrary, but some apps depend on it... */
}

/* State: resting. */
.blocklyMenuItem {
  border: none;
  color: #000;
  cursor: pointer;
  list-style: none;
  margin: 0;
  /* 7em on the right for shortcut. */
  min-width: 7em;
  padding: 6px 15px;
  white-space: nowrap;
}

/* State: disabled. */
.blocklyMenuItemDisabled {
  color: #ccc;
  cursor: inherit;
}

/* State: hover. */
.blocklyMenuItemHighlight {
  background-color: rgba(0,0,0,.1);
}

/* State: selected/checked. */
.blocklyMenuItemCheckbox {
  height: 16px;
  position: absolute;
  width: 16px;
}

.blocklyMenuItemSelected .blocklyMenuItemCheckbox {
  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;
  float: left;
  margin-left: -24px;
  position: static;  /* Scroll with the menu. */
}

.blocklyMenuItemRtl .blocklyMenuItemCheckbox {
  float: right;
  margin-right: -24px;
}

.blocklyBlockDragSurface, .blocklyAnimationLayer {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  overflow: visible !important;
  z-index: 80;
  pointer-events: none;
}
`,kd={};kd.inject=Zt,kd.register=tt;var te=class{constructor(e,i){this.x=e,this.y=i}clone(){return new te(this.x,this.y)}scale(e){return this.x*=e,this.y*=e,this}translate(e,i){return this.x+=e,this.y+=i,this}static equals(e,i){return e===i?!0:e&&i?e.x===i.x&&e.y===i.y:!1}static distance(e,i){const n=e.x-i.x;return e=e.y-i.y,Math.sqrt(n*n+e*e)}static magnitude(e){return Math.sqrt(e.x*e.x+e.y*e.y)}static difference(e,i){return new te(e.x-i.x,e.y-i.y)}static sum(e,i){return new te(e.x+i.x,e.y+i.y)}},Po="http://www.w3.org/2000/svg",ui="http://www.w3.org/1999/xhtml",ms="http://www.w3.org/1999/xlink",Ai;(function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE"})(Ai||(Ai={}));var Vs=null,Od=0,Ua=null,Ct={HTML_NS:ui};Ct.NodeType=Ai,Ct.SVG_NS=Po,Ct.XLINK_NS=ms,Ct.addClass=re,Ct.createSvgElement=Y,Ct.getFastTextWidth=Us,Ct.getFastTextWidthWithSizeString=b,Ct.getTextWidth=dn,Ct.hasClass=B,Ct.insertAfter=ee,Ct.measureFontMetrics=I,Ct.removeClass=S,Ct.removeClasses=T,Ct.removeNode=F,Ct.setCssTransform=Ye,Ct.startTextWidthCache=Gt,Ct.stopTextWidthCache=ni;var U=class{constructor(e){this.tagName=e}toString(){return this.tagName}};U.ANIMATE=new U("animate"),U.CIRCLE=new U("circle"),U.CLIPPATH=new U("clipPath"),U.DEFS=new U("defs"),U.FECOMPOSITE=new U("feComposite"),U.FECOMPONENTTRANSFER=new U("feComponentTransfer"),U.FEFLOOD=new U("feFlood"),U.FEFUNCA=new U("feFuncA"),U.FEGAUSSIANBLUR=new U("feGaussianBlur"),U.FEPOINTLIGHT=new U("fePointLight"),U.FESPECULARLIGHTING=new U("feSpecularLighting"),U.FILTER=new U("filter"),U.FOREIGNOBJECT=new U("foreignObject"),U.G=new U("g"),U.IMAGE=new U("image"),U.LINE=new U("line"),U.PATH=new U("path"),U.PATTERN=new U("pattern"),U.POLYGON=new U("polygon"),U.RECT=new U("rect"),U.SVG=new U("svg"),U.TEXT=new U("text"),U.TSPAN=new U("tspan");var Ve=class{constructor(e,i,n,c){this.top=e,this.bottom=i,this.left=n,this.right=c}clone(){return new Ve(this.top,this.bottom,this.left,this.right)}getHeight(){return this.bottom-this.top}getWidth(){return this.right-this.left}contains(e,i){return e>=this.left&&e<=this.right&&i>=this.top&&i<=this.bottom}intersects(e){return this.left<=e.right&&this.right>=e.left&&this.bottom>=e.top&&this.top<=e.bottom}static equals(e,i){return e===i?!0:e&&i?e.top===i.top&&e.bottom===i.bottom&&e.left===i.left&&e.right===i.right:!1}static createFromPoint(e,i,n){const c=e.x;return e=e.y,new Ve(e,e+n,c,c+i)}},Oe=class{constructor(e,i){this.width=e,this.height=i}static equals(e,i){return e===i?!0:e&&i?e.width===i.width&&e.height===i.height:!1}static max(e,i){return new Oe(Math.max(e.width,i.width),Math.max(e.height,i.height))}static min(e,i){return new Oe(Math.min(e.width,i.width),Math.min(e.height,i.height))}},tT={getSizeInternal:H},ir={TEST_ONLY:tT};ir.getBorderBox=qi,ir.getComputedStyle=ce,ir.getContainerOffsetToScrollInto=Ji,ir.getPageOffset=ye,ir.getSize=L,ir.getViewportPageOffset=ls,ir.scrollIntoContainerView=yr;var sT=/translate\(\s*([-+\d.e]+)([ ,]\s*([-+\d.e]+)\s*)?/,iT=/transform:\s*translate(?:3d)?\(\s*([-+\d.e]+)\s*px([ ,]\s*([-+\d.e]+)\s*px)?/,Jx={XY_REGEX:sT,XY_STYLE_REGEX:iT},Mr={TEST_ONLY:Jx};Mr.getDocumentScroll=yh,Mr.getInjectionDivXY=Yl,Mr.getRelativeXY=uo,Mr.getViewportBBox=Eh,Mr.screenToWsCoordinates=pm,Mr.wsToScreenCoordinates=fm;var ht=class{constructor(e,i,n,c,d){this.workspace=e,this.horizontal=i,this.oldHostMetrics=null,this.ratio=1,this.origin=new te(0,0),this.startDragHandle=this.handlePosition=this.handleLength=this.scrollbarLength=this.startDragMouse=0,this.containerVisible=this.isHandleVisible=!0,this.position=new te(0,0),this.onMouseMoveWrapper_=this.onMouseUpWrapper_=null,this.pair=n||!1,this.margin=d!==void 0?d:ht.DEFAULT_SCROLLBAR_MARGIN,e="blocklyScrollbar"+(this.horizontal?"Horizontal":"Vertical"),c&&(e+=" "+c),this.outerSvg=Y(U.SVG,{class:e}),c=Y(U.G,{},this.outerSvg),this.svgBackground=Y(U.RECT,{class:"blocklyScrollbarBackground"},c),e=Math.floor((ht.scrollbarThickness-5)/2),this.svgHandle=Y(U.RECT,{class:"blocklyScrollbarHandle",rx:e,ry:e},c),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarColour","fill"),this.workspace.getThemeManager().subscribe(this.svgHandle,"scrollbarOpacity","fill-opacity"),ee(this.outerSvg,this.workspace.getParentSvg()),this.setInitialThickness(),i?(this.lengthAttribute_="width",this.positionAttribute_="x"):(this.lengthAttribute_="height",this.positionAttribute_="y"),this.onMouseDownBarWrapper_=fe(this.svgBackground,"pointerdown",this,this.onMouseDownBar),this.onMouseDownHandleWrapper_=fe(this.svgHandle,"pointerdown",this,this.onMouseDownHandle)}setInitialThickness(){const e=ht.scrollbarThickness;this.horizontal?(this.svgBackground.setAttribute("height",String(e)),this.outerSvg.setAttribute("height",String(e)),this.svgHandle.setAttribute("height",String(e-5)),this.svgHandle.setAttribute("y","2.5")):(this.svgBackground.setAttribute("width",String(e)),this.outerSvg.setAttribute("width",String(e)),this.svgHandle.setAttribute("width",String(e-5)),this.svgHandle.setAttribute("x","2.5"))}dispose(){this.cleanUp(),Ue(this.onMouseDownBarWrapper_),Ue(this.onMouseDownHandleWrapper_),F(this.outerSvg),this.workspace.getThemeManager().unsubscribe(this.svgHandle)}constrainHandleLength(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength)}setHandleLength(e){this.handleLength=e,this.svgHandle.setAttribute(this.lengthAttribute_,String(this.handleLength))}constrainHandlePosition(e){return e=0>=e||isNaN(e)?0:Math.min(e,this.scrollbarLength-this.handleLength)}setHandlePosition(e){this.handlePosition=e,this.svgHandle.setAttribute(this.positionAttribute_,String(this.handlePosition))}setScrollbarLength(e){this.scrollbarLength=e,this.outerSvg.setAttribute(this.lengthAttribute_,String(this.scrollbarLength)),this.svgBackground.setAttribute(this.lengthAttribute_,String(this.scrollbarLength))}setPosition(e,i){this.position.x=e,this.position.y=i,Ye(this.outerSvg,"translate("+(this.position.x+this.origin.x)+"px,"+(this.position.y+this.origin.y)+"px)")}resize(e){!e&&(e=this.workspace.getMetrics(),!e)||this.oldHostMetrics&&ht.metricsAreEquivalent(e,this.oldHostMetrics)||(this.horizontal?this.resizeHorizontal(e):this.resizeVertical(e),this.oldHostMetrics=e,this.updateMetrics())}requiresViewResize(e){return this.oldHostMetrics?this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft||this.oldHostMetrics.absoluteTop!==e.absoluteTop:!0}resizeHorizontal(e){this.requiresViewResize(e)?this.resizeViewHorizontal(e):this.resizeContentHorizontal(e)}resizeViewHorizontal(e){var i=e.viewWidth-2*this.margin;this.pair&&(i-=ht.scrollbarThickness),this.setScrollbarLength(Math.max(0,i)),i=e.absoluteLeft+this.margin,this.pair&&this.workspace.RTL&&(i+=ht.scrollbarThickness),this.setPosition(i,e.absoluteTop+e.viewHeight-ht.scrollbarThickness-this.margin),this.resizeContentHorizontal(e)}resizeContentHorizontal(e){if(e.viewWidth>=e.scrollWidth)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var i=this.scrollbarLength*e.viewWidth/e.scrollWidth;i=this.constrainHandleLength(i),this.setHandleLength(i),i=e.scrollWidth-e.viewWidth;var n=this.scrollbarLength-this.handleLength;e=(e.viewLeft-e.scrollLeft)/i*n,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=n/i}}resizeVertical(e){this.requiresViewResize(e)?this.resizeViewVertical(e):this.resizeContentVertical(e)}resizeViewVertical(e){let i=e.viewHeight-2*this.margin;this.pair&&(i-=ht.scrollbarThickness),this.setScrollbarLength(Math.max(0,i)),this.setPosition(this.workspace.RTL?e.absoluteLeft+this.margin:e.absoluteLeft+e.viewWidth-ht.scrollbarThickness-this.margin,e.absoluteTop+this.margin),this.resizeContentVertical(e)}resizeContentVertical(e){if(e.viewHeight>=e.scrollHeight)this.setHandleLength(this.scrollbarLength),this.setHandlePosition(0),this.pair||this.setVisible(!1);else{this.pair||this.setVisible(!0);var i=this.scrollbarLength*e.viewHeight/e.scrollHeight;i=this.constrainHandleLength(i),this.setHandleLength(i),i=e.scrollHeight-e.viewHeight;var n=this.scrollbarLength-this.handleLength;e=(e.viewTop-e.scrollTop)/i*n,e=this.constrainHandlePosition(e),this.setHandlePosition(e),this.ratio=n/i}}isVisible(){return this.isHandleVisible}setContainerVisible(e){const i=e!==this.containerVisible;this.containerVisible=e,i&&this.updateDisplay_()}setVisible(e){if(this.pair)throw Error("Unable to toggle visibility of paired scrollbars.");this.setVisibleInternal(e)}setVisibleInternal(e){const i=e!==this.isVisible();this.isHandleVisible=e,i&&this.updateDisplay_()}updateDisplay_(){this.containerVisible&&this.isVisible()?this.outerSvg.setAttribute("display","block"):this.outerSvg.setAttribute("display","none")}onMouseDownBar(e){if(this.workspace.markFocused(),It(),this.cleanUp(),Jt(e))e.stopPropagation();else{var i=P(e,this.workspace.getParentSvg(),this.workspace.getInverseScreenCTM());i=this.horizontal?i.x:i.y;var n=Yl(this.svgHandle);n=this.horizontal?n.x:n.y;var c=this.handlePosition,d=.95*this.handleLength;i<=n?c-=d:i>=n+this.handleLength&&(c+=d),this.setHandlePosition(this.constrainHandlePosition(c)),this.updateMetrics(),e.stopPropagation(),e.preventDefault()}}onMouseDownHandle(e){this.workspace.markFocused(),this.cleanUp(),Jt(e)?e.stopPropagation():(this.startDragHandle=this.handlePosition,this.startDragMouse=this.horizontal?e.clientX:e.clientY,this.onMouseUpWrapper_=fe(document,"pointerup",this,this.onMouseUpHandle),this.onMouseMoveWrapper_=fe(document,"pointermove",this,this.onMouseMoveHandle),e.stopPropagation(),e.preventDefault())}onMouseMoveHandle(e){this.setHandlePosition(this.constrainHandlePosition(this.startDragHandle+((this.horizontal?e.clientX:e.clientY)-this.startDragMouse))),this.updateMetrics()}onMouseUpHandle(){It(),this.cleanUp()}cleanUp(){this.workspace.hideChaff(!0),this.onMouseUpWrapper_&&(Ue(this.onMouseUpWrapper_),this.onMouseUpWrapper_=null),this.onMouseMoveWrapper_&&(Ue(this.onMouseMoveWrapper_),this.onMouseMoveWrapper_=null)}getRatio_(){let e=this.handlePosition/(this.scrollbarLength-this.handleLength);return isNaN(e)&&(e=0),e}updateMetrics(){const e=this.getRatio_();this.horizontal?this.workspace.setMetrics({x:e}):this.workspace.setMetrics({y:e})}set(e,i){this.setHandlePosition(this.constrainHandlePosition(e*this.ratio)),(i||i===void 0)&&this.updateMetrics()}setOrigin(e,i){this.origin=new te(e,i)}static metricsAreEquivalent(e,i){return e.viewWidth===i.viewWidth&&e.viewHeight===i.viewHeight&&e.viewLeft===i.viewLeft&&e.viewTop===i.viewTop&&e.absoluteTop===i.absoluteTop&&e.absoluteLeft===i.absoluteLeft&&e.scrollWidth===i.scrollWidth&&e.scrollHeight===i.scrollHeight&&e.scrollLeft===i.scrollLeft&&e.scrollTop===i.scrollTop}};ht.scrollbarThickness=G$?25:15,ht.DEFAULT_SCROLLBAR_MARGIN=.5;var Ga={parseFromString:function(){throw Error("DOMParser was not found in the global scope and was not properly injected using injectDependencies")}},Ad={serializeToString:function(){throw Error("XMLSerializer was not foundin the global scope and was not properly injected using injectDependencies")}},{document:Ha,DOMParser:No,XMLSerializer:Do}=globalThis;No&&(Ga=new No),Do&&(Ad=new Do);var rT="https://developers.google.com/blockly/xml",Zx=/[\x00-\x09\x0B\x0C\x0E-\x1F]/g,wn={NAME_SPACE:rT};wn.createElement=s.createElement$$module$build$src$core$utils$xml,wn.createTextNode=s.createTextNode$$module$build$src$core$utils$xml,wn.domToText=pn,wn.injectDependencies=gm,wn.textToDom=s.textToDom$$module$build$src$core$utils$xml;var Md="categoryToolbox",nT="flyoutToolbox",Ie;(function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM",e[e.LEFT=2]="LEFT",e[e.RIGHT=3]="RIGHT"})(Ie||(Ie={}));var oT={hasCategoriesInternal:$m},rr={};rr.Position=Ie,rr.TEST_ONLY=oT,rr.convertFlyoutDefToJsonArray=po,rr.convertToolboxDefToJson=Kl,rr.hasCategories=jl,rr.isCategoryCollapsible=ql,rr.parseToolboxTree=Sh;var Mi;(function(e){e[e.TOP=0]="TOP",e[e.BOTTOM=1]="BOTTOM"})(Mi||(Mi={}));var Rn;(function(e){e[e.LEFT=0]="LEFT",e[e.RIGHT=1]="RIGHT"})(Rn||(Rn={}));var nr;(function(e){e[e.UP=0]="UP",e[e.DOWN=1]="DOWN"})(nr||(nr={}));var Lr={};Lr.bumpDirection=nr,Lr.bumpPositionRect=ea,Lr.getCornerOppositeToolbox=Ql,Lr.getStartPositionRect=Zl,Lr.horizontalPosition=Rn,Lr.verticalPosition=Mi;var Qt={width:96,height:124,url:"sprites.png"},lT=class{constructor(e){this.workspace=e,this.id="zoomControls",this.boundEvents=[],this.zoomResetGroup=this.zoomOutGroup=this.zoomInGroup=null,this.HEIGHT=this.WIDTH=32,this.SMALL_SPACING=2,this.LARGE_SPACING=11,this.MARGIN_HORIZONTAL=this.MARGIN_VERTICAL=20,this.svgGroup=null,this.top=this.left=0,this.initialized=!1}createDom(){this.svgGroup=Y(U.G,{});const e=String(Math.random()).substring(2);return this.createZoomOutSvg(e),this.createZoomInSvg(e),this.workspace.isMovable()&&this.createZoomResetSvg(e),this.svgGroup}init(){this.workspace.getComponentManager().addComponent({component:this,weight:et.ComponentWeight.ZOOM_CONTROLS_WEIGHT,capabilities:[et.Capability.POSITIONABLE]}),this.initialized=!0}dispose(){this.workspace.getComponentManager().removeComponent("zoomControls"),this.svgGroup&&F(this.svgGroup);for(const e of this.boundEvents)Ue(e);this.boundEvents.length=0}getBoundingRectangle(){let e=this.SMALL_SPACING+2*this.HEIGHT;return this.zoomResetGroup&&(e+=this.LARGE_SPACING+this.HEIGHT),new Ve(this.top,this.top+e,this.left,this.left+this.WIDTH)}position(e,i){if(this.initialized){var n=Ql(this.workspace,e),c=this.SMALL_SPACING+2*this.HEIGHT;if(this.zoomResetGroup&&(c+=this.LARGE_SPACING+this.HEIGHT),e=Zl(n,new Oe(this.WIDTH,c),this.MARGIN_HORIZONTAL,this.MARGIN_VERTICAL,e,this.workspace),n=n.vertical,i=ea(e,this.MARGIN_VERTICAL,n===Mi.TOP?nr.DOWN:nr.UP,i),n===Mi.TOP){var d=this.SMALL_SPACING+this.HEIGHT,m;(m=this.zoomInGroup)==null||m.setAttribute("transform","translate(0, "+d+")"),this.zoomResetGroup&&this.zoomResetGroup.setAttribute("transform","translate(0, "+(d+this.LARGE_SPACING+this.HEIGHT)+")")}else{m=this.zoomResetGroup?this.LARGE_SPACING+this.HEIGHT:0;let O;(O=this.zoomInGroup)==null||O.setAttribute("transform","translate(0, "+m+")"),m=m+this.SMALL_SPACING+this.HEIGHT,(d=this.zoomOutGroup)==null||d.setAttribute("transform","translate(0, "+m+")")}this.top=i.top,this.left=i.left;var y;(y=this.svgGroup)==null||y.setAttribute("transform","translate("+this.left+","+this.top+")")}}createZoomOutSvg(e){this.zoomOutGroup=Y(U.G,{class:"blocklyZoom blocklyZoomOut"},this.svgGroup);const i=Y(U.CLIPPATH,{id:"blocklyZoomoutClipPath"+e},this.zoomOutGroup);Y(U.RECT,{width:32,height:32},i),Y(U.IMAGE,{width:Qt.width,height:Qt.height,x:-64,y:-92,"clip-path":"url(#blocklyZoomoutClipPath"+e+")"},this.zoomOutGroup).setAttributeNS(ms,"xlink:href",this.workspace.options.pathToMedia+Qt.url),this.boundEvents.push(fe(this.zoomOutGroup,"pointerdown",null,this.zoom.bind(this,-1)))}createZoomInSvg(e){this.zoomInGroup=Y(U.G,{class:"blocklyZoom blocklyZoomIn"},this.svgGroup);const i=Y(U.CLIPPATH,{id:"blocklyZoominClipPath"+e},this.zoomInGroup);Y(U.RECT,{width:32,height:32},i),Y(U.IMAGE,{width:Qt.width,height:Qt.height,x:-32,y:-92,"clip-path":"url(#blocklyZoominClipPath"+e+")"},this.zoomInGroup).setAttributeNS(ms,"xlink:href",this.workspace.options.pathToMedia+Qt.url),this.boundEvents.push(fe(this.zoomInGroup,"pointerdown",null,this.zoom.bind(this,1)))}zoom(e,i){this.workspace.markFocused(),this.workspace.zoomCenter(e),this.fireZoomEvent(),It(),i.stopPropagation(),i.preventDefault()}createZoomResetSvg(e){this.zoomResetGroup=Y(U.G,{class:"blocklyZoom blocklyZoomReset"},this.svgGroup);const i=Y(U.CLIPPATH,{id:"blocklyZoomresetClipPath"+e},this.zoomResetGroup);Y(U.RECT,{width:32,height:32},i),Y(U.IMAGE,{width:Qt.width,height:Qt.height,y:-92,"clip-path":"url(#blocklyZoomresetClipPath"+e+")"},this.zoomResetGroup).setAttributeNS(ms,"xlink:href",this.workspace.options.pathToMedia+Qt.url),this.boundEvents.push(fe(this.zoomResetGroup,"pointerdown",null,this.resetZoom.bind(this)))}resetZoom(e){this.workspace.markFocused();const i=Math.log(this.workspace.options.zoomOptions.startScale/this.workspace.scale)/Math.log(this.workspace.options.zoomOptions.scaleSpeed);this.workspace.beginCanvasTransition(),this.workspace.zoomCenter(i),this.workspace.scrollCenter(),setTimeout(this.workspace.endCanvasTransition.bind(this.workspace),500),this.fireZoomEvent(),It(),e.stopPropagation(),e.preventDefault()}fireZoomEvent(){const e=new(he(W.CLICK))(null,this.workspace.id,"zoom_controls");z(e)}};tt(`
.blocklyZoom>image, .blocklyZoom>svg>image {
  opacity: .4;
}

.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {
  opacity: .6;
}

.blocklyZoom>image:active, .blocklyZoom>svg>image:active {
  opacity: .8;
}
`);var aT=100,cT=75,hT=50,uT=25,Qx={BLOCKS:hT,PROCEDURES:cT,VARIABLES:aT,WORKSPACE_COMMENTS:uT},Ld={};Ld.register=fo,Ld.unregister=bm;var dT=class{constructor(){this.priority=uT}save(e){const i=[];for(const n of e.getTopComments())(e=fn(n,{addCoordinates:!0,saveIds:!0}))&&i.push(e);return i.length?i:null}load(e,i){for(const n of e)go(n,i,{recordUndo:k()})}clear(e){for(const i of e.getTopComments())i.dispose()}};fo("workspaceComments",new dT);var Va={};Va.WorkspaceCommentSerializer=dT,Va.append=go,Va.save=fn;var Pd={};Pd.register=ta,Pd.unregister=Em;var Wa=class{paste(e,i,n){e=e.commentState,n&&(e.x=n.x,e.y=n.y),s.disable$$module$build$src$core$events$utils();let c;try{c=go(e,i),ym(c)}finally{s.enable$$module$build$src$core$events$utils()}return c?(ue()&&z(new(he(W.COMMENT_CREATE))(c)),s.setSelected$$module$build$src$core$common(c),c):null}};Wa.TYPE="workspace-comment",ta(Wa.TYPE,new Wa);var Nd;Nd=28,s.config$$module$build$src$core$config={dragRadius:5,flyoutDragRadius:10,snapRadius:Nd,connectingSnapRadius:Nd,currentConnectionPreference:8,bumpDelay:250},s.config$$module$build$src$core$config;var eC="aria-",tC="role",Ws;(function(e){e.GRID="grid",e.GRIDCELL="gridcell",e.GROUP="group",e.LISTBOX="listbox",e.MENU="menu",e.MENUITEM="menuitem",e.MENUITEMCHECKBOX="menuitemcheckbox",e.OPTION="option",e.PRESENTATION="presentation",e.ROW="row",e.TREE="tree",e.TREEITEM="treeitem"})(Ws||(Ws={}));var bt;(function(e){e.ACTIVEDESCENDANT="activedescendant",e.COLCOUNT="colcount",e.DISABLED="disabled",e.EXPANDED="expanded",e.INVALID="invalid",e.LABEL="label",e.LABELLEDBY="labelledby",e.LEVEL="level",e.ORIENTATION="orientation",e.POSINSET="posinset",e.ROWCOUNT="rowcount",e.SELECTED="selected",e.SETSIZE="setsize",e.VALUEMAX="valuemax",e.VALUEMIN="valuemin"})(bt||(bt={}));var Bo={};Bo.Role=Ws,Bo.State=bt,Bo.setRole=Zi,Bo.setState=xt;var Dd=class{constructor(){this.menuItems=[],this.roleName=this.element=this.onKeyDownHandler=this.pointerLeaveHandler=this.pointerEnterHandler=this.clickHandler=this.pointerMoveHandler=this.highlightedItem=this.openingCoords=null}addChild(e){this.menuItems.push(e)}render(e){const i=document.createElement("div");i.className="blocklyMenu goog-menu blocklyNonSelectable",i.tabIndex=0,this.roleName&&Zi(i,this.roleName),this.element=i;for(let n=0,c;c=this.menuItems[n];n++)i.appendChild(c.createDom());return this.pointerMoveHandler=fe(i,"pointermove",this,this.handlePointerMove,!0),this.clickHandler=fe(i,"pointerup",this,this.handleClick,!0),this.pointerEnterHandler=fe(i,"pointerenter",this,this.handlePointerEnter,!0),this.pointerLeaveHandler=fe(i,"pointerleave",this,this.handlePointerLeave,!0),this.onKeyDownHandler=fe(i,"keydown",this,this.handleKeyEvent),e.appendChild(i),i}getElement(){return this.element}focus(){const e=this.getElement();e&&(e.focus({preventScroll:!0}),re(e,"blocklyFocused"))}blur(){const e=this.getElement();e&&(e.blur(),S(e,"blocklyFocused"))}setRole(e){this.roleName=e}dispose(){this.pointerMoveHandler&&(Ue(this.pointerMoveHandler),this.pointerMoveHandler=null),this.clickHandler&&(Ue(this.clickHandler),this.clickHandler=null),this.pointerEnterHandler&&(Ue(this.pointerEnterHandler),this.pointerEnterHandler=null),this.pointerLeaveHandler&&(Ue(this.pointerLeaveHandler),this.pointerLeaveHandler=null),this.onKeyDownHandler&&(Ue(this.onKeyDownHandler),this.onKeyDownHandler=null);for(let e=0,i;i=this.menuItems[e];e++)i.dispose();this.element=null}getMenuItem(e){const i=this.getElement();for(;e&&e!==i;){if(e.classList.contains("blocklyMenuItem")){for(let n=0,c;c=this.menuItems[n];n++)if(c.getElement()===e)return c}e=e.parentElement}return null}setHighlighted(e){var i=this.highlightedItem;if(i&&(i.setHighlighted(!1),this.highlightedItem=null),e){e.setHighlighted(!0),this.highlightedItem=e,i=this.getElement();const n=i==null?void 0:i.parentElement,c=e.getElement();n&&c&&(yr(c,n),xt(i,bt.ACTIVEDESCENDANT,e.getId()))}}highlightNext(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(e,1)}highlightPrevious(){const e=this.highlightedItem?this.menuItems.indexOf(this.highlightedItem):-1;this.highlightHelper(0>e?this.menuItems.length:e,-1)}highlightFirst(){this.highlightHelper(-1,1)}highlightLast(){this.highlightHelper(this.menuItems.length,-1)}highlightHelper(e,i){e+=i;let n;for(;n=this.menuItems[e];){if(n.isEnabled()){this.setHighlighted(n);break}e+=i}}handlePointerMove(e){Math.max(Math.abs(e.movementX),Math.abs(e.movementY))!==0&&(e=this.getMenuItem(e.target))&&(e.isEnabled()?this.highlightedItem!==e&&this.setHighlighted(e):this.setHighlighted(null))}handleClick(e){const i=this.openingCoords;if(this.openingCoords=null,i&&typeof e.clientX=="number"){const n=new te(e.clientX,e.clientY);if(1>te.distance(i,n))return}(e=this.getMenuItem(e.target))&&e.performAction()}handlePointerEnter(e){this.focus()}handlePointerLeave(e){this.getElement()&&this.setHighlighted(null)}handleKeyEvent(e){if(this.menuItems.length&&!(e.shiftKey||e.ctrlKey||e.metaKey||e.altKey)){var i=this.highlightedItem;switch(e.key){case"Enter":case" ":i&&i.performAction();break;case"ArrowUp":this.highlightPrevious();break;case"ArrowDown":this.highlightNext();break;case"PageUp":case"Home":this.highlightFirst();break;case"PageDown":case"End":this.highlightLast();break;default:return}e.preventDefault(),e.stopPropagation()}}getSize(){const e=this.getElement(),i=L(e);return i.height=e.scrollHeight,i}},Bd=class{constructor(e,i){this.content=e,this.opt_value=i,this.enabled=!0,this.element=null,this.rightToLeft=!1,this.roleName=null,this.highlight=this.checked=this.checkable=!1,this.actionHandler=null}createDom(){const e=document.createElement("div");e.id=E(),this.element=e,e.className="blocklyMenuItem goog-menuitem "+(this.enabled?"":"blocklyMenuItemDisabled goog-menuitem-disabled ")+(this.checked?"blocklyMenuItemSelected goog-option-selected ":"")+(this.highlight?"blocklyMenuItemHighlight goog-menuitem-highlight ":"")+(this.rightToLeft?"blocklyMenuItemRtl goog-menuitem-rtl ":"");const i=document.createElement("div");if(i.className="blocklyMenuItemContent goog-menuitem-content",this.checkable){var n=document.createElement("div");n.className="blocklyMenuItemCheckbox goog-menuitem-checkbox",i.appendChild(n)}return n=this.content,typeof this.content=="string"&&(n=document.createTextNode(this.content)),i.appendChild(n),e.appendChild(i),this.roleName&&Zi(e,this.roleName),xt(e,bt.SELECTED,this.checkable&&this.checked||!1),xt(e,bt.DISABLED,!this.enabled),e}dispose(){this.element=null}getElement(){return this.element}getId(){return this.element.id}getValue(){let e;return(e=this.opt_value)!=null?e:null}setRightToLeft(e){this.rightToLeft=e}setRole(e){this.roleName=e}setCheckable(e){this.checkable=e}setChecked(e){this.checked=e}setHighlighted(e){this.highlight=e;const i=this.getElement();i&&this.isEnabled()&&(e?(re(i,"blocklyMenuItemHighlight"),re(i,"goog-menuitem-highlight")):(S(i,"blocklyMenuItemHighlight"),S(i,"goog-menuitem-highlight")))}isEnabled(){return this.enabled}setEnabled(e){this.enabled=e}performAction(){this.isEnabled()&&this.actionHandler&&this.actionHandler(this)}onAction(e,i){this.actionHandler=e.bind(i)}},Fo="_TEMP_COLLAPSED_INPUT",za="_TEMP_COLLAPSED_FIELD",es="MANUALLY_DISABLED",sC={COLLAPSED_FIELD_NAME:za,COLLAPSED_INPUT_NAME:Fo,MANUALLY_DISABLED:es};(function(e){e[e.VALUE=1]="VALUE",e[e.STATEMENT=3]="STATEMENT",e[e.DUMMY=5]="DUMMY",e[e.CUSTOM=6]="CUSTOM",e[e.END_ROW=7]="END_ROW"})(s.inputTypes$$module$build$src$core$inputs$input_types||(s.inputTypes$$module$build$src$core$inputs$input_types={})),s.inputTypes$$module$build$src$core$inputs$input_types;var Xa=new Set,Fd=new WeakSet,Ud=new WeakMap,kn=null,Gd=null,pT=0,Ya={};Ya.finishQueuedRenders=Gs,Ya.queueRender=Ih,Ya.triggerQueuedRenders=Si;var fT=function(e,i){window.alert(e),i&&i()},gT=function(e,i){i(window.confirm(e))},mT=function(e,i,n){n(window.prompt(e,i))},_T={confirmInternal:Cm},Pr={TEST_ONLY:_T};Pr.alert=_o,Pr.confirm=ia,Pr.prompt=ra,Pr.setAlert=xm,Pr.setConfirm=wm,Pr.setPrompt=Rm;var Hd,$T;s.Msg$$module$build$src$core$msg=Object.create(null),Hd=function(e){Object.keys(e).forEach(function(i){s.Msg$$module$build$src$core$msg[i]=e[i]})},$T={Msg:s.Msg$$module$build$src$core$msg,setLocale:Hd};var Uo=class extends Cn{constructor(e){super(),this.isBlank=typeof e>"u",e&&(this.varId=e.getId(),this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");return e.varId=this.varId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Uo),i.varId=e.varId,i}},Vd=class extends Uo{constructor(e){super(e),this.type=W.VAR_CREATE,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Vd),i.varType=e.varType,i.varName=e.varName,i}run(e){const i=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?i.createVariable(this.varName,this.varType,this.varId):i.deleteVariableById(this.varId)}};r(Z.EVENT,W.VAR_CREATE,Vd);var Go=class{constructor(e,i,n,c){this.workspace=e,this.name=i,this.type=n||"",this.id=c||v()}getId(){return this.id}static compareByName(e,i){return e.name.localeCompare(i.name,void 0,{sensitivity:"base"})}},Wd="VARIABLE",zd="ijkmnopqrstuvwxyzabcdefgh",TT={generateUniqueNameInternal:Om},At={CATEGORY_NAME:Wd,TEST_ONLY:TT,VAR_LETTER_OPTIONS:zd};At.allDeveloperVariables=s.allDeveloperVariables$$module$build$src$core$variables,At.allUsedVarModels=s.allUsedVarModels$$module$build$src$core$variables,At.createVariableButtonHandler=mn,At.flyoutCategory=na,At.flyoutCategoryBlocks=kh,At.generateUniqueName=Oh,At.generateUniqueNameFromOptions=oa,At.generateVariableFieldDom=vr,At.getAddedVariables=$o,At.getOrCreateVariablePackage=s.getOrCreateVariablePackage$$module$build$src$core$variables,At.getVariable=s.getVariable$$module$build$src$core$variables,At.nameUsedWithAnyType=Ah,At.nameUsedWithConflictingParam=Mh,At.promptName=la,At.renameVariable=s.renameVariable$$module$build$src$core$variables;var On=class extends Error{},bT=class extends On{constructor(e){super("Expected to find a 'type' property, defining the block type"),this.state=e}},Ho=class extends On{constructor(e,i,n){super(`The block ${i.toDevString()} is missing a(n) ${e}
connection`),this.block=i,this.state=n}},ET=class extends On{constructor(e,i,n,c){super(`The block ${n.toDevString()} could not connect its
${i} to its parent, because: ${e}`),this.childBlock=n,this.childState=c}},yT=class extends On{constructor(e){super(`Encountered a real block which is defined as a child of a shadow
block. It is an invariant of Blockly that shadow blocks only have shadow
children`),this.state=e}},vT=class extends On{constructor(e,i,n){super(`Cannot add an icon of type '${e}' to the block ${i.toDevString()}, because there is no icon registered with type '${e}'. Make sure that all of your icons have been registered.`),this.block=i,this.state=n}},Nr={};Nr.BadConnectionCheck=ET,Nr.DeserializationError=On,Nr.MissingBlockType=bT,Nr.MissingConnection=Ho,Nr.RealChildOfShadow=yT,Nr.UnregisteredIcon=vT;var ST=class{constructor(){this.priority=hT}save(e){const i=[];for(const n of e.getTopBlocks(!1))(e=gs(n,{addCoordinates:!0,doFullSerialization:!1}))&&i.push(e);return i.length?{languageVersion:0,blocks:i}:null}load(e,i){e=e.blocks;for(const n of e)Ii(n,i,{recordUndo:k()})}clear(e){for(const i of e.getTopBlocks(!1))i.dispose(!1)}};fo("blocks",new ST);var Vo={};Vo.BlockSerializer=ST,Vo.append=Ii,Vo.appendInternal=_n,Vo.save=gs;var mt=class{constructor(e){this.name=e}toString(){return this.name}equals(e){return this.name===e.toString()}};mt.MUTATOR=new mt("mutator"),mt.WARNING=new mt("warning"),mt.COMMENT=new mt("comment");var Dr=class extends Cn{constructor(e){super(),this.isBlank=!e,e&&(this.blockId=e.id,this.workspaceId=e.workspace.id)}toJson(){const e=super.toJson();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.blockId=this.blockId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Dr),i.blockId=e.blockId,i}},Br=class extends Dr{constructor(e,i,n,c,d){super(e),this.type=W.BLOCK_CHANGE,e&&(this.element=i,this.name=n||void 0,this.oldValue=c,this.newValue=d)}toJson(){const e=super.toJson();if(!this.element)throw Error("The changed element is undefined. Either pass an element to the constructor, or call fromJson");return e.element=this.element,e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,this.disabledReason&&(e.disabledReason=this.disabledReason),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Br),i.element=e.element,i.name=e.name,i.oldValue=e.oldValue,i.newValue=e.newValue,e.disabledReason!==void 0&&(i.disabledReason=e.disabledReason),i}setDisabledReason(e){if(this.element!=="disabled")throw Error('Cannot set the disabled reason for a BlockChange event if the element is not "disabled".');this.disabledReason=e}isNull(){return this.oldValue===this.newValue}run(e){var i=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(i=i.getBlockById(this.blockId),!i)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");const n=i.getIcon(mt.MUTATOR);switch(n&&$n(n)&&n.bubbleIsVisible()&&n.setBubbleVisible(!1),e=e?this.newValue:this.oldValue,this.element){case"field":(i=i.getField(this.name))?i.setValue(e):console.warn("Can't set non-existent field: "+this.name);break;case"comment":i.setCommentText(e||null);break;case"collapsed":i.setCollapsed(!!e);break;case"disabled":var c;i.setDisabledReason(!!e,(c=this.disabledReason)!=null?c:es);break;case"inline":i.setInputsInline(!!e);break;case"mutation":c=Br.getExtraBlockState_(i),i.loadExtraState?i.loadExtraState(JSON.parse(e||"{}")):i.domToMutation&&i.domToMutation(s.textToDom$$module$build$src$core$utils$xml(e||"<mutation/>")),z(new Br(i,"mutation",null,c,e));break;default:console.warn("Unknown change type: "+this.element)}}static getExtraBlockState_(e){return e.saveExtraState?(e=e.saveExtraState(!0))?JSON.stringify(e):"":e.mutationToDom&&(e=e.mutationToDom())?li(e):""}};r(Z.EVENT,W.BLOCK_CHANGE,Br);var Ka={};Ka.clamp=Tn,Ka.toDegrees=Qm,Ka.toRadians=aa;var ja=16,IT=1,xT=12,Xd=16,qa=.25,Yd=null,Fr=null,An="",Mn="",Le,Ln,Ur,Kd=null,or=null,CT=null,jd={getBoundsInfo:function(){const e=ye(Kd),i=L(Kd);return{left:e.x,right:e.x+i.width,top:e.y,bottom:e.y+i.height,width:i.width,height:i.height}},getPositionMetrics:function(e,i,n,c){const d=jd.getBoundsInfo(),m=L(Le);return i+m.height<d.bottom?Xh(e,i,d,m):c-m.height>d.top?Yh(n,c,d,m):i+m.height<document.documentElement.clientHeight?Xh(e,i,d,m):c-m.height>document.documentElement.clientTop?Yh(n,c,d,m):t_(e,d,m)}},Ht={ANIMATION_TIME:qa,ARROW_HORIZONTAL_PADDING:xT,ARROW_SIZE:ja,BORDER_SIZE:IT,PADDING_Y:Xd,TEST_ONLY:jd};Ht.clearContent=ca,Ht.createDom=Dh,Ht.getContentDiv=To,Ht.getOwner=Fh,Ht.getPositionX=bo,Ht.hide=ua,Ht.hideIfOwner=ha,Ht.hideWithoutAnimation=oi,Ht.isVisible=Kh,Ht.repositionForWindowResize=qh,Ht.setBoundsElement=Bh,Ht.setColour=Uh,Ht.show=zh,Ht.showPositionedByBlock=e_,Ht.showPositionedByField=Gh;var Wo=class{constructor(e){this.workspace=e,this.cursorSvg=this.cursor=null,this.markers=new Map,this.markerSvg=null}registerMarker(e,i){this.markers.has(e)&&this.unregisterMarker(e),i.setDrawer(this.workspace.getRenderer().makeMarkerDrawer(this.workspace,i)),this.setMarkerSvg(i.getDrawer().createDom()),this.markers.set(e,i)}unregisterMarker(e){const i=this.markers.get(e);if(i)i.dispose(),this.markers.delete(e);else throw Error("Marker with ID "+e+" does not exist. Can only unregister markers that exist.")}getCursor(){return this.cursor}getMarker(e){return this.markers.get(e)||null}setCursor(e){this.cursor&&this.cursor.getDrawer()&&this.cursor.getDrawer().dispose(),(this.cursor=e)&&(e=this.workspace.getRenderer().makeMarkerDrawer(this.workspace,this.cursor),this.cursor.setDrawer(e),this.setCursorSvg(this.cursor.getDrawer().createDom()))}setCursorSvg(e){e?(this.workspace.getBlockCanvas().appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?this.workspace.getBlockCanvas()&&(this.cursorSvg?this.workspace.getBlockCanvas().insertBefore(e,this.cursorSvg):this.workspace.getBlockCanvas().appendChild(e)):this.markerSvg=null}updateMarkers(){this.workspace.keyboardAccessibilityMode&&this.cursorSvg&&this.workspace.getCursor().draw()}dispose(){const e=Object.keys(this.markers);for(let i=0,n;n=e[i];i++)this.unregisterMarker(n);this.markers.clear(),this.cursor&&(this.cursor.dispose(),this.cursor=null)}};Wo.LOCAL_MARKER="local_marker_1";var Pn={};Pn.commonWordPrefix=Jh,Pn.commonWordSuffix=Zh,Pn.isNumber=s.isNumber$$module$build$src$core$utils$string,Pn.shortestStringLength=Eo,Pn.wrap=s.wrap$$module$build$src$core$utils$string;var Ja=void 0,zo=!1,Nn=!1,wT=50,RT=0,Gr=0,qd=0,Jd=0,ks=null,Xo=null,Zd=0,Qd=10,kT=10,OT=750,Za=5,_t=null,_s={HOVER_MS:OT,LIMIT:wT,MARGINS:Za,OFFSET_X:Zd,OFFSET_Y:Qd,RADIUS_OK:kT};_s.bindMouseEvents=En,_s.block=ru,_s.createDom=tu,_s.dispose=iu,_s.getCustomTooltip=n_,_s.getDiv=l_,_s.getTooltipOfObject=bn,_s.hide=xi,_s.isVisible=o_,_s.setCustomTooltip=r_,_s.unbindMouseEvents=pa,_s.unblock=nu;var ep=.45,tp=.65,AT={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00"},Os={};Os.blend=Ir,Os.getHsvSaturation=ou,Os.getHsvValue=lu,Os.hexToRgb=fa,Os.hsvToHex=ga,Os.hueToHex=au,Os.names=AT,Os.parse=Sr,Os.rgbToHex=yo,Os.setHsvSaturation=f_,Os.setHsvValue=g_;var Yo={};Yo.checkMessageReferences=m_,Yo.parseBlockColour=yn,Yo.replaceMessageReferences=at,Yo.tokenizeInterpolation=cu;var Ke=class{constructor(e,i,n){this.DEFAULT_VALUE=null,this.name=void 0,this.constants_=this.mouseDownWrapper=this.textContent_=this.textElement_=this.borderRect_=this.fieldGroup_=this.markerSvg=this.cursorSvg=this.tooltip=this.validator_=null,this.disposed=!1,this.maxDisplayLength=50,this.sourceBlock_=null,this.enabled_=this.visible_=this.isDirty_=!0,this.suffixField=this.prefixField=this.clickTarget_=null,this.EDITABLE=!0,this.SERIALIZABLE=!1,this.CURSOR="",this.value_="DEFAULT_VALUE"in new.target.prototype?new.target.prototype.DEFAULT_VALUE:this.DEFAULT_VALUE,this.size_=new Oe(0,0),e!==Ke.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),i&&this.setValidator(i))}configure_(e){e.tooltip&&this.setTooltip(at(e.tooltip))}setSourceBlock(e){if(this.sourceBlock_)throw Error("Field already bound to a block");this.sourceBlock_=e}getConstants(){return!this.constants_&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&this.sourceBlock_.workspace.rendered&&(this.constants_=this.sourceBlock_.workspace.getRenderer().getConstants()),this.constants_}getSourceBlock(){return this.sourceBlock_}init(){this.fieldGroup_||(this.fieldGroup_=Y(U.G,{}),this.isVisible()||(this.fieldGroup_.style.display="none"),this.sourceBlock_.getSvgRoot().appendChild(this.fieldGroup_),this.initView(),this.updateEditable(),this.setTooltip(this.tooltip),this.bindEvents_(),this.initModel(),this.applyColour())}initView(){this.createBorderRect_(),this.createTextElement_()}initModel(){}isFullBlockField(){return!this.borderRect_}createBorderRect_(){this.borderRect_=Y(U.RECT,{rx:this.getConstants().FIELD_BORDER_RECT_RADIUS,ry:this.getConstants().FIELD_BORDER_RECT_RADIUS,x:0,y:0,height:this.size_.height,width:this.size_.width,class:"blocklyFieldRect"},this.fieldGroup_)}createTextElement_(){this.textElement_=Y(U.TEXT,{class:"blocklyText"},this.fieldGroup_),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.textElement_.setAttribute("dominant-baseline","central"),this.textContent_=document.createTextNode(""),this.textElement_.appendChild(this.textContent_)}bindEvents_(){const e=this.getClickTarget_();if(!e)throw Error("A click target has not been set.");En(e),this.mouseDownWrapper=fe(e,"pointerdown",this,this.onMouseDown_)}fromXml(e){this.setValue(e.textContent)}toXml(e){return e.textContent=this.getValue(),e}saveState(e){return e=this.saveLegacyState(Ke),e!==null?e:this.getValue()}loadState(e){this.loadLegacyState(Ke,e)||this.setValue(e)}saveLegacyState(e){return e.prototype.saveState===this.saveState&&e.prototype.toXml!==this.toXml?(e=s.createElement$$module$build$src$core$utils$xml("field"),e.setAttribute("name",this.name||""),pn(this.toXml(e)).replace(' xmlns="https://developers.google.com/blockly/xml"',"")):null}loadLegacyState(e,i){return e.prototype.loadState===this.loadState&&e.prototype.fromXml!==this.fromXml?(this.fromXml(s.textToDom$$module$build$src$core$utils$xml(i)),!0):!1}dispose(){ha(this),Cr(this);let e;(e=this.getSourceBlock())!=null&&e.isDeadOrDying()||F(this.fieldGroup_),this.disposed=!0}updateEditable(){const e=this.fieldGroup_,i=this.getSourceBlock();this.EDITABLE&&e&&i&&(this.enabled_&&i.isEditable()?(re(e,"blocklyEditableText"),S(e,"blocklyNonEditableText"),e.style.cursor=this.CURSOR):(re(e,"blocklyNonEditableText"),S(e,"blocklyEditableText"),e.style.cursor=""))}setEnabled(e){this.enabled_=e,this.updateEditable()}isEnabled(){return this.enabled_}isClickable(){return this.enabled_&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()&&this.showEditor_!==Ke.prototype.showEditor_}isClickableInFlyout(e){return!e}isCurrentlyEditable(){return this.enabled_&&this.EDITABLE&&!!this.sourceBlock_&&this.sourceBlock_.isEditable()}isSerializable(){let e=!1;return this.name&&(this.SERIALIZABLE?e=!0:this.EDITABLE&&(console.warn("Detected an editable field that was not serializable. Please define SERIALIZABLE property as true on all editable custom fields. Proceeding with serialization."),e=!0)),e}isVisible(){return this.visible_}setVisible(e){if(this.visible_!==e){this.visible_=e;var i=this.fieldGroup_;i&&(i.style.display=e?"block":"none")}}setValidator(e){this.validator_=e}getValidator(){return this.validator_}getSvgRoot(){return this.fieldGroup_}getBorderRect(){if(!this.borderRect_)throw Error(`The border rectangle is ${this.borderRect_}.`);return this.borderRect_}getTextElement(){if(!this.textElement_)throw Error(`The text element is ${this.textElement_}.`);return this.textElement_}getTextContent(){if(!this.textContent_)throw Error(`The text content is ${this.textContent_}.`);return this.textContent_}applyColour(){}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_()}showEditor(e){this.isClickable()&&this.showEditor_(e)}showEditor_(e){}repositionForWindowResize(){return!1}updateSize_(e){const i=this.getConstants();e=e!==void 0?e:this.isFullBlockField()?0:this.getConstants().FIELD_BORDER_RECT_X_PADDING;let n=2*e,c=i.FIELD_TEXT_HEIGHT,d=0;this.textElement_&&(d=Us(this.textElement_,i.FIELD_TEXT_FONTSIZE,i.FIELD_TEXT_FONTWEIGHT,i.FIELD_TEXT_FONTFAMILY),n+=d),this.isFullBlockField()||(c=Math.max(c,i.FIELD_BORDER_RECT_HEIGHT)),this.size_.height=c,this.size_.width=n,this.positionTextElement_(e,d),this.positionBorderRect_()}positionTextElement_(e,i){if(this.textElement_){var n=this.getConstants(),c=this.size_.height/2,d;this.textElement_.setAttribute("x",String((d=this.getSourceBlock())!=null&&d.RTL?this.size_.width-i-e:e)),this.textElement_.setAttribute("y",String(n.FIELD_TEXT_BASELINE_CENTER?c:c-n.FIELD_TEXT_HEIGHT/2+n.FIELD_TEXT_BASELINE))}}positionBorderRect_(){this.borderRect_&&(this.borderRect_.setAttribute("width",String(this.size_.width)),this.borderRect_.setAttribute("height",String(this.size_.height)),this.borderRect_.setAttribute("rx",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)),this.borderRect_.setAttribute("ry",String(this.getConstants().FIELD_BORDER_RECT_RADIUS)))}getSize(){return this.isVisible()?(this.isDirty_?(this.render_(),this.isDirty_=!1):this.visible_&&this.size_.width===0&&(this.render_(),this.size_.width!==0&&console.warn("Deprecated use of setting size_.width to 0 to rerender a field. Set field.isDirty_ to true instead.")),this.size_):new Oe(0,0)}getScaledBBox(){let e;var i=this.getSourceBlock();if(!i)throw new ut;if(this.isFullBlockField()){var n=this.sourceBlock_.getHeightWidth();const c=i.workspace.scale;e=this.getAbsoluteXY_(),i=(n.width+1)*c,n=(n.height+1)*c,j$?(e.x+=1.5*c,e.y+=1.5*c):(e.x-=.5*c,e.y-=.5*c)}else n=this.borderRect_.getBoundingClientRect(),e=ye(this.borderRect_),i=n.width,n=n.height;return new Ve(e.y,e.y+n,e.x,e.x+i)}onLocationChange(e){}getDisplayText_(){let e=this.getText();return e?(e.length>this.maxDisplayLength&&(e=e.substring(0,this.maxDisplayLength-2)+"…"),e=e.replace(/\s/g,Ke.NBSP),this.sourceBlock_&&this.sourceBlock_.RTL&&(e+="‏"),e):Ke.NBSP}getText(){const e=this.getText_();return String(e!==null?e:this.getValue())}getText_(){return null}markDirty(){this.isDirty_=!0,this.constants_=null}forceRerender(){this.isDirty_=!0,this.sourceBlock_&&this.sourceBlock_.rendered&&this.sourceBlock_.queueRender()}setValue(e,i=!0){if(e!==null){var n=s.getGroup$$module$build$src$core$events$utils();n||s.setGroup$$module$build$src$core$events$utils(!0);try{const K=this.doClassValidation_(e),oe=this.processValidation(e,K,i);if(!(oe instanceof Error)){var c,d=(c=this.getValidator())==null?void 0:c.call(this,oe),m=this.processValidation(oe,d,i);if(!(m instanceof Error)){var y=this.sourceBlock_;if(!y||!y.disposed){var O=this.getValue();O===m?this.doValueUpdate_(m):(this.doValueUpdate_(m),i&&y&&ue()&&z(new(he(W.BLOCK_CHANGE))(y,"field",this.name||null,O,m)),this.isDirty_&&this.forceRerender())}}}}finally{s.setGroup$$module$build$src$core$events$utils(n)}}}processValidation(e,i,n){return i===null?(this.doValueInvalid_(e,n),this.isDirty_&&this.forceRerender(),Error()):i===void 0?e:i}getValue(){return this.value_}doClassValidation_(e){return e??null}doValueUpdate_(e){this.value_=e,this.isDirty_=!0}doValueInvalid_(e,i){}onMouseDown_(e){this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()&&(e=this.sourceBlock_.workspace.getGesture(e))&&e.setStartField(this)}setTooltip(e){e||e===""||(e=this.sourceBlock_);const i=this.getClickTarget_();i?i.tooltip=e:this.tooltip=e}getTooltip(){const e=this.getClickTarget_();return bn(e||{tooltip:this.tooltip})}getClickTarget_(){return this.clickTarget_||this.getSvgRoot()}getAbsoluteXY_(){return ye(this.getClickTarget_())}referencesVariables(){return!1}refreshVariableName(){}getParentInput(){let e=null;const i=this.getSourceBlock();if(!i)throw new ut;const n=i.inputList;for(let c=0;c<i.inputList.length;c++){const d=n[c],m=d.fieldRow;for(let y=0;y<m.length;y++)if(m[y]===this){e=d;break}}return e}getFlipRtl(){return!1}isTabNavigable(){return!1}onShortcut(e){return!1}setCursorSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.cursorSvg=e}else this.cursorSvg=null}setMarkerSvg(e){if(e){if(!this.fieldGroup_)throw Error(`The field group is ${this.fieldGroup_}.`);this.fieldGroup_.appendChild(e),this.markerSvg=e}else this.markerSvg=null}updateMarkers_(){var e=this.getSourceBlock();if(!e)throw new ut;e=e.workspace,e.keyboardAccessibilityMode&&this.cursorSvg&&e.getCursor().draw(),e.keyboardAccessibilityMode&&this.markerSvg&&e.getMarker(Wo.LOCAL_MARKER).draw()}static fromJson(e){throw Error("Attempted to instantiate a field from the registry that hasn't defined a 'fromJson' method.")}};Ke.NBSP=" ",Ke.SKIP_SETUP=Symbol("SKIP_SETUP");var ut=class extends Error{constructor(){super("The field has not yet been attached to its input. Call appendField to attach it.")}},Dn=null,sp=null,Qa=null,ec="blocklyWidgetDiv",Bn="",Fn="",zs,Xs={};Xs.createDom=hu,Xs.getDiv=xr,Xs.hide=vn,Xs.hideIfOwner=Cr,Xs.hideIfOwnerIsInWorkspace=vo,Xs.isVisible=uu,Xs.positionWithAnchor=pu,Xs.repositionForWindowResize=fu,Xs.show=_a,Xs.testOnly_setDiv=__;var tc=null,MT={},sc=null,Hr={};Hr.callbackFactory=s.callbackFactory$$module$build$src$core$contextmenu,Hr.dispose=mu,Hr.getCurrentBlock=E_,Hr.hide=Io,Hr.setCurrentBlock=gu,Hr.show=So;var Ce=class{constructor(){this.registeredItems=new Map,this.reset()}reset(){this.registeredItems.clear()}register(e){if(this.registeredItems.has(e.id))throw Error('Menu item with ID "'+e.id+'" is already registered.');this.registeredItems.set(e.id,e)}unregister(e){if(!this.registeredItems.has(e))throw Error('Menu item with ID "'+e+'" not found.');this.registeredItems.delete(e)}getItem(e){let i;return(i=this.registeredItems.get(e))!=null?i:null}getContextMenuOptions(e,i){const n=[];for(const d of this.registeredItems.values())if(e===d.scopeType){var c=d.preconditionFn(i);c!=="hidden"&&(c={text:typeof d.displayText=="function"?d.displayText(i):d.displayText,enabled:c==="enabled",callback:d.callback,scope:i,weight:d.weight},n.push(c))}return n.sort(function(d,m){return d.weight-m.weight}),n}};(function(e){var i=e.ScopeType||(e.ScopeType={});i.BLOCK="block",i.WORKSPACE="workspace",i.COMMENT="comment",e.registry=new e})(Ce||(Ce={})),Ce.ScopeType;var lr=50,ic=100,iC={BLOCK:lr,BUBBLE:ic},LT=class{constructor(e){this.comment=e,this.startLoc=null,this.inGroup=!1,this.workspace=e.workspace}isMovable(){return this.comment.isOwnMovable()&&!this.comment.isDeadOrDying()&&!this.workspace.options.readOnly}startDrag(){(this.inGroup=!!s.getGroup$$module$build$src$core$events$utils())||s.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent(),this.startLoc=this.comment.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveToDragLayer(this.comment),this.comment.setDragging(!0)}drag(e){this.comment.moveDuringDrag(e)}endDrag(){this.fireDragEndEvent(),this.fireMoveEvent();let e;(e=this.workspace.getLayerManager())==null||e.moveOffDragLayer(this.comment,lr),this.comment.setDragging(!1),this.comment.snapToGrid(),this.workspace.setResizesEnabled(!0),this.inGroup||s.setGroup$$module$build$src$core$events$utils(!1)}fireDragStartEvent(){const e=new(he(W.COMMENT_DRAG))(this.comment,!0);z(e)}fireDragEndEvent(){const e=new(he(W.COMMENT_DRAG))(this.comment,!1);z(e)}fireMoveEvent(){if(!this.comment.isDeadOrDying()){var e=new(he(W.COMMENT_MOVE))(this.comment);e.setReason(["drag"]),e.oldCoordinate_=this.startLoc,e.recordNew(),z(e)}}revertDrag(){this.startLoc&&this.comment.moveDuringDrag(this.startLoc)}},PT=new WeakMap,NT=class{constructor(e){this.workspace=e,this.size=new Oe(120,100),this.collapsed=!1,this.editable=!0,this.location=new te(0,0),this.text="",this.textChangeListeners=[],this.sizeChangeListeners=[],this.disposeListeners=[],this.collapseChangeListeners=[],this.resizePointerMoveListener=this.resizePointerUpListener=null,this.disposed=this.disposing=!1,this.svgRoot=Y(U.G,{class:"blocklyComment blocklyEditable blocklyDraggable"}),this.highlightRect=this.createHighlightRect(this.svgRoot),{topBarGroup:this.topBarGroup,topBarBackground:this.topBarBackground,deleteIcon:this.deleteIcon,foldoutIcon:this.foldoutIcon,textPreview:this.textPreview,textPreviewNode:this.textPreviewNode}=this.createTopBar(this.svgRoot,e),{foreignObject:this.foreignObject,textArea:this.textArea}=this.createTextArea(this.svgRoot),this.resizeHandle=this.createResizeHandle(this.svgRoot,e);let i;(i=e.getLayerManager())==null||i.append(this,lr),this.setSizeWithoutFiringEvents(this.size),this.moveTo(new te(0,0))}createHighlightRect(e){return Y(U.RECT,{class:"blocklyCommentHighlight"},e)}createTopBar(e,i){e=Y(U.G,{class:"blocklyCommentTopbar"},e);const n=Y(U.RECT,{class:"blocklyCommentTopbarBackground"},e),c=Y(U.IMAGE,{class:"blocklyDeleteIcon",href:`${i.options.pathToMedia}delete-icon.svg`},e);i=Y(U.IMAGE,{class:"blocklyFoldoutIcon",href:`${i.options.pathToMedia}foldout-icon.svg`},e);const d=Y(U.TEXT,{class:"blocklyCommentPreview blocklyCommentText blocklyText"},e),m=document.createTextNode("");return d.appendChild(m),fe(i,"pointerdown",this,this.onFoldoutDown),fe(c,"pointerdown",this,this.onDeleteDown),{topBarGroup:e,topBarBackground:n,deleteIcon:c,foldoutIcon:i,textPreview:d,textPreviewNode:m}}createTextArea(e){e=Y(U.FOREIGNOBJECT,{class:"blocklyCommentForeignObject"},e);const i=document.createElementNS(ui,"body");i.setAttribute("xmlns",ui),i.className="blocklyMinimalBody";const n=document.createElementNS(ui,"textarea");return re(n,"blocklyCommentText"),re(n,"blocklyTextarea"),re(n,"blocklyText"),i.appendChild(n),e.appendChild(i),fe(n,"change",this,this.onTextChange),{foreignObject:e,textArea:n}}createResizeHandle(e,i){return e=Y(U.IMAGE,{class:"blocklyResizeHandle",href:`${i.options.pathToMedia}resize-handle.svg`},e),fe(e,"pointerdown",this,this.onResizePointerDown),e}getSvgRoot(){return this.svgRoot}getSize(){return this.collapsed?this.topBarBackground.getBBox():this.size}setSizeWithoutFiringEvents(e){const i=this.topBarBackground.getBBox(),n=this.deleteIcon.getBBox(),c=this.foldoutIcon.getBBox(),d=this.textPreview.getBBox(),m=this.resizeHandle.getBBox();this.size=e=Oe.max(e,this.calcMinSize(i,c,n)),this.svgRoot.setAttribute("height",`${e.height}`),this.svgRoot.setAttribute("width",`${e.width}`),this.updateHighlightRect(e),this.updateTopBarSize(e),this.updateTextAreaSize(e,i),this.updateDeleteIconPosition(e,i,n),this.updateFoldoutIconPosition(i,c),this.updateTextPreviewSize(e,i,d,n,m),this.updateResizeHandlePosition(e,m)}setSize(e){const i=this.preResizeSize||this.size;this.setSizeWithoutFiringEvents(e),this.onSizeChange(i,this.size)}calcMinSize(e,i,n){var c;this.updateTextPreview((c=this.textArea.value)!=null?c:""),c=dn(this.textPreview);const d=this.calcFoldoutMargin(e,i),m=this.calcDeleteMargin(e,n);let y=c;return this.foldoutIcon.checkVisibility()?y+=i.width+2*d:c&&(y+=4),this.deleteIcon.checkVisibility()?y+=n.width+2*m:c&&(y+=4),new Oe(y,e.height+20)}calcDeleteMargin(e,i){return(e.height-i.height)/2}calcFoldoutMargin(e,i){return(e.height-i.height)/2}updateHighlightRect(e){this.highlightRect.setAttribute("height",`${e.height}`),this.highlightRect.setAttribute("width",`${e.width}`),this.workspace.RTL&&this.highlightRect.setAttribute("x",`${-e.width}`)}updateTopBarSize(e){this.topBarBackground.setAttribute("width",`${e.width}`)}updateTextAreaSize(e,i){this.foreignObject.setAttribute("height",`${e.height-i.height}`),this.foreignObject.setAttribute("width",`${e.width}`),this.foreignObject.setAttribute("y",`${i.height}`),this.workspace.RTL&&this.foreignObject.setAttribute("x",`${-e.width}`)}updateDeleteIconPosition(e,i,n){i=this.calcDeleteMargin(i,n),this.deleteIcon.setAttribute("y",`${i}`),this.deleteIcon.setAttribute("x",`${e.width-n.width-i}`)}updateFoldoutIconPosition(e,i){e=this.calcFoldoutMargin(e,i),this.foldoutIcon.setAttribute("y",`${e}`),this.foldoutIcon.setAttribute("x",`${e}`)}updateTextPreviewSize(e,i,n,c,d){const m=(i.height-n.height)/2,y=this.calcDeleteMargin(i,c);i=this.calcFoldoutMargin(i,d),e=e.width-d.width-2*i-c.width-2*y,this.textPreview.setAttribute("x",`${d.width+2*i*(this.workspace.RTL?-1:1)}`),this.textPreview.setAttribute("y",`${m+n.height/2}`),this.textPreview.setAttribute("width",`${e}`)}updateResizeHandlePosition(e,i){this.resizeHandle.setAttribute("y",`${e.height-i.height}`),this.resizeHandle.setAttribute("x",`${e.width-i.width}`)}onSizeChange(e,i){for(let n=this.sizeChangeListeners.length-1;0<=n;n--)this.sizeChangeListeners[n](e,i)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}removeSizeChangeListener(e){this.sizeChangeListeners.splice(this.sizeChangeListeners.indexOf(e),1)}onResizePointerDown(e){this.isEditable()&&(this.bringToFront(),Jt(e)||(this.preResizeSize=this.getSize(),$a(this.workspace,e,new te(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=fe(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=fe(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation())}onResizePointerUp(e){It(),this.resizePointerUpListener&&(Ue(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(Ue(this.resizePointerMoveListener),this.resizePointerMoveListener=null),this.setSize(this.size),this.preResizeSize=void 0}onResizePointerMove(e){e=Ta(this.workspace,e),this.setSizeWithoutFiringEvents(new Oe(this.workspace.RTL?-e.x:e.x,e.y))}isCollapsed(){return this.collapsed}setCollapsed(e){(this.collapsed=e)?re(this.svgRoot,"blocklyCollapsed"):S(this.svgRoot,"blocklyCollapsed"),this.setSizeWithoutFiringEvents(this.size),this.onCollapse()}onCollapse(){for(let e=this.collapseChangeListeners.length-1;0<=e;e--)this.collapseChangeListeners[e](this.collapsed)}addOnCollapseListener(e){this.collapseChangeListeners.push(e)}removeOnCollapseListener(e){this.collapseChangeListeners.splice(this.collapseChangeListeners.indexOf(e),1)}onFoldoutDown(e){It(),this.bringToFront(),Jt(e)||(this.setCollapsed(!this.collapsed),this.workspace.hideChaff()),e.stopPropagation()}isEditable(){return this.editable}setEditable(e){(this.editable=e)?(re(this.svgRoot,"blocklyEditable"),S(this.svgRoot,"blocklyReadonly"),this.textArea.removeAttribute("readonly")):(S(this.svgRoot,"blocklyEditable"),re(this.svgRoot,"blocklyReadonly"),this.textArea.setAttribute("readonly","true"))}getRelativeToSurfaceXY(){return this.location}moveTo(e){this.location=e,this.svgRoot.setAttribute("transform",`translate(${e.x}, ${e.y})`)}getText(){return this.text}setText(e){this.textArea.value=e,this.onTextChange()}addTextChangeListener(e){this.textChangeListeners.push(e)}removeTextChangeListener(e){this.textChangeListeners.splice(this.textChangeListeners.indexOf(e),1)}onTextChange(){const e=this.text;this.text=this.textArea.value,this.updateTextPreview(this.text),this.setSize(this.size);for(let i=this.textChangeListeners.length-1;0<=i;i--)this.textChangeListeners[i](e,this.text)}updateTextPreview(e){this.textPreviewNode.textContent=this.truncateText(e)}truncateText(e){return 12<=e.length?`${e.substring(0,9)}...`:e}bringToFront(){const e=this.svgRoot.parentNode,i=e.childNodes;i[i.length-1]!==this.svgRoot&&e.appendChild(this.svgRoot)}onDeleteDown(e){It(),Jt(e)||this.dispose(),e.stopPropagation()}dispose(){this.disposing=!0,F(this.svgRoot);for(let e=this.disposeListeners.length-1;0<=e;e--)this.disposeListeners[e]();this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}addDisposeListener(e){this.disposeListeners.push(e)}removeDisposeListener(e){this.disposeListeners.splice(this.disposeListeners.indexOf(e),1)}};tt(`
.injectionDiv {
  --commentFillColour: #FFFCC7;
  --commentBorderColour: #F2E49B;
}

.blocklyComment .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 1px solid var(--commentBorderColour);
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}

.blocklyReadonly.blocklyComment .blocklyTextarea {
  cursor: inherit;
}

.blocklyDeleteIcon {
  width: 20px;
  height: 20px;
  display: none;
  cursor: pointer;
}

.blocklyFoldoutIcon {
  width: 20px;
  height: 20px;
  transform-origin: 12px 12px;
  cursor: pointer;
}
.blocklyResizeHandle {
  width: 12px;
  height: 12px;
  cursor: se-resize;
}
.blocklyReadonly.blocklyComment .blocklyResizeHandle {
  cursor: inherit;
}

.blocklyCommentTopbarBackground {
  fill: var(--commentBorderColour);
  height: 24px;
}

.blocklyComment .blocklyCommentPreview.blocklyText {
  fill: #000;
  dominant-baseline: middle;
  visibility: hidden;
}

.blocklyCollapsed.blocklyComment .blocklyCommentPreview {
  visibility: visible;
}

.blocklyCollapsed.blocklyComment .blocklyCommentForeignObject,
.blocklyCollapsed.blocklyComment .blocklyResizeHandle {
  display: none;
}

.blocklyCollapsed.blocklyComment .blocklyFoldoutIcon {
  transform: rotate(-90deg);
}

.blocklyRTL .blocklyCommentTopbar {
  transform: scale(-1, 1);
}

.blocklyRTL .blocklyCommentForeignObject {
  direction: rtl;
}

.blocklyRTL .blocklyCommentPreview {
  /* Revert the scale and control RTL using direction instead. */
  transform: scale(-1, 1);
  direction: rtl;
}

.blocklyRTL .blocklyResizeHandle {
  transform: scale(-1, 1);
  cursor: sw-resize;
}

.blocklyCommentHighlight {
  fill: none;
}

.blocklySelected .blocklyCommentHighlight {
  stroke: #fc3;
  stroke-width: 3px;
}

.blocklyCollapsed.blocklySelected .blocklyCommentHighlight {
  stroke: none;
}

.blocklyCollapsed.blocklySelected .blocklyCommentTopbarBackground {
  stroke: #fc3;
  stroke-width: 3px;
}
`);var rc=class{constructor(e,i){this.workspace=e,this.text="",this.size=new Oe(120,100),this.collapsed=!1,this.deletable=this.movable=this.editable=!0,this.location=new te(0,0),this.disposing=this.disposed=!1,this.id=i&&!e.getCommentById(i)?i:v(),e.addTopComment(this),this.fireCreateEvent()}fireCreateEvent(){ue()&&z(new(he(W.COMMENT_CREATE))(this))}fireDeleteEvent(){ue()&&z(new(he(W.COMMENT_DELETE))(this))}fireChangeEvent(e,i){ue()&&z(new(he(W.COMMENT_CHANGE))(this,e,i))}fireCollapseEvent(e){ue()&&z(new(he(W.COMMENT_COLLAPSE))(this,e))}setText(e){const i=this.text;this.text=e,this.fireChangeEvent(i,e)}getText(){return this.text}setSize(e){const i=new(he(W.COMMENT_RESIZE))(this);this.size=e,i.recordCurrentSizeAsNewSize(),z(i)}getSize(){return this.size}setCollapsed(e){this.collapsed=e,this.fireCollapseEvent(e)}isCollapsed(){return this.collapsed}setEditable(e){this.editable=e}isEditable(){return this.isOwnEditable()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable}setMovable(e){this.movable=e}isMovable(){return this.isOwnMovable()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable}setDeletable(e){this.deletable=e}isDeletable(){return this.isOwnDeletable()&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable}moveTo(e,i){const n=new(he(W.COMMENT_MOVE))(this);i&&n.setReason(i),this.location=e,n.recordNew(),z(n)}getRelativeToSurfaceXY(){return this.location}dispose(){this.disposing=!0,this.fireDeleteEvent(),this.workspace.removeTopComment(this),this.disposed=!0}isDisposed(){return this.disposed}isDeadOrDying(){return this.disposing||this.disposed}},nc=class extends rc{constructor(e,i){super(e,i),this.dragStrategy=new LT(this),this.workspace=e,this.view=new NT(e),this.view.setSize(this.getSize()),this.view.setEditable(this.isEditable()),this.view.getSvgRoot().setAttribute("data-id",this.id),this.addModelUpdateBindings(),fe(this.view.getSvgRoot(),"pointerdown",this,this.startGesture),fe(this.view.getSvgRoot(),"wheel",this,n=>{n.stopPropagation()})}addModelUpdateBindings(){this.view.addTextChangeListener((e,i)=>void super.setText(i)),this.view.addSizeChangeListener((e,i)=>void super.setSize(i)),this.view.addOnCollapseListener(()=>void super.setCollapsed(this.view.isCollapsed())),this.view.addDisposeListener(()=>{this.isDeadOrDying()||this.dispose()})}setText(e){this.view.setText(e)}setSize(e){this.view.setSize(e)}setCollapsed(e){this.view.setCollapsed(e)}setEditable(e){super.setEditable(e),this.view.setEditable(this.isEditable())}getSvgRoot(){return this.view.getSvgRoot()}getSize(){return super.getSize()}getBoundingRectangle(){const e=this.getRelativeToSurfaceXY();var i,n;const c=(n=(i=this.view)==null?void 0:i.getSize())!=null?n:this.getSize();return this.workspace.RTL?(i=e.x-c.width,n=e.x):(i=e.x,n=e.x+c.width),new Ve(e.y,e.y+c.height,i,n)}moveBy(e,i,n){const c=this.getRelativeToSurfaceXY();e=new te(c.x+e,c.y+i),this.moveTo(e,n)}moveTo(e,i){super.moveTo(e,i),this.view.moveTo(e)}moveDuringDrag(e){this.location=e,this.view.moveTo(e)}setDragging(e){e?re(this.getSvgRoot(),"blocklyDragging"):S(this.getSvgRoot(),"blocklyDragging")}dispose(){this.disposing=!0,this.view.isDeadOrDying()||this.view.dispose(),super.dispose()}startGesture(e){const i=this.workspace.getGesture(e);if(i){if(Fs(e))e.stopPropagation();else{i.handleCommentStart(e,this);let n;(n=this.workspace.getLayerManager())==null||n.append(this,lr)}s.setSelected$$module$build$src$core$common(this)}}setDeleteStyle(e){e?re(this.getSvgRoot(),"blocklyDraggingDelete"):S(this.getSvgRoot(),"blocklyDraggingDelete")}isMovable(){return this.dragStrategy.isMovable()}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){re(this.getSvgRoot(),"blocklySelected")}unselect(){S(this.getSvgRoot(),"blocklySelected")}toCopyData(){return{paster:Wa.TYPE,commentState:fn(this,{addCoordinates:!0})}}showContextMenu(e){const i=Ce.registry.getContextMenuOptions(Ce.ScopeType.COMMENT,{comment:this});So(e,i,this.workspace.RTL,this.workspace)}snapToGrid(){if(!this.isDeadOrDying()){var e=this.workspace.getGrid();if(e!=null&&e.shouldSnap()){var i=this.getRelativeToSurfaceXY();e=e.alignXY(i),e!==i&&this.moveTo(e,["snap"])}}}},Vt={};Vt.appendDomToWorkspace=O_,Vt.blockToDom=Qi,Vt.blockToDomWithXY=Co,Vt.clearWorkspaceAndLoadFromXml=k_,Vt.deleteNext=U_,Vt.domToBlock=s.domToBlock$$module$build$src$core$xml,Vt.domToBlockInternal=wr,Vt.domToPrettyText=R_,Vt.domToText=li,Vt.domToVariables=Eu,Vt.domToWorkspace=s.domToWorkspace$$module$build$src$core$xml,Vt.loadWorkspaceComment=bu,Vt.saveWorkspaceComment=xo,Vt.variablesToDom=$u,Vt.workspaceToDom=x_;var ip=class extends Dr{constructor(e){super(e),this.type=W.BLOCK_CREATE,e&&(e.isShadow()&&(this.recordUndo=!1),this.xml=Co(e),this.ids=pe(e),this.json=gs(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=li(this.xml),e.ids=this.ids,e.json=this.json,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new ip),i.xml=s.textToDom$$module$build$src$core$utils$xml(e.xml),i.ids=e.ids,i.json=e.json,e.recordUndo!==void 0&&(i.recordUndo=e.recordUndo),i}run(e){const i=this.getEventWorkspace_();if(!this.json)throw Error("The block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!rC(i,this.ids))if(e)Ii(this.json,i);else for(e=0;e<this.ids.length;e++){const n=this.ids[e],c=i.getBlockById(n);c?c.dispose(!1):n===this.blockId&&console.warn("Can't uncreate non-existent block: "+n)}}},rC=function(e,i){return i.map(n=>e.getBlockById(n)).filter(n=>n&&n.isShadow()).length===i.length};r(Z.EVENT,W.BLOCK_CREATE,ip);var rp=class extends Hs{constructor(e,i){super(i),this.type=W.THEME_CHANGE,this.themeName=e}toJson(){const e=super.toJson();if(!this.themeName)throw Error("The theme name is undefined. Either pass a theme name to the constructor, or call fromJson");return e.themeName=this.themeName,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new rp),i.themeName=e.themeName,i}};r(Z.EVENT,W.THEME_CHANGE,rp);var np=class extends Hs{constructor(e,i,n,c,d){super(c),this.type=W.VIEWPORT_CHANGE,this.viewTop=e,this.viewLeft=i,this.scale=n,this.oldScale=d}toJson(){const e=super.toJson();if(this.viewTop===void 0)throw Error("The view top is undefined. Either pass a value to the constructor, or call fromJson");if(this.viewLeft===void 0)throw Error("The view left is undefined. Either pass a value to the constructor, or call fromJson");if(this.scale===void 0)throw Error("The scale is undefined. Either pass a value to the constructor, or call fromJson");if(this.oldScale===void 0)throw Error("The old scale is undefined. Either pass a value to the constructor, or call fromJson");return e.viewTop=this.viewTop,e.viewLeft=this.viewLeft,e.scale=this.scale,e.oldScale=this.oldScale,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new np),i.viewTop=e.viewTop,i.viewLeft=e.viewLeft,i.scale=e.scale,i.oldScale=e.oldScale,i}};r(Z.EVENT,W.VIEWPORT_CHANGE,np);var le;(function(e){e[e.INPUT_VALUE=1]="INPUT_VALUE",e[e.OUTPUT_VALUE=2]="OUTPUT_VALUE",e[e.NEXT_STATEMENT=3]="NEXT_STATEMENT",e[e.PREVIOUS_STATEMENT=4]="PREVIOUS_STATEMENT"})(le||(le={}));var Un=class{constructor(e){this.connectionChecker=e,this.connections=[]}addConnection(e,i){i=this.calculateIndexForYPos(i),this.connections.splice(i,0,e)}findIndexOfConnection(e,i){if(!this.connections.length)return-1;const n=this.calculateIndexForYPos(i);if(n>=this.connections.length)return-1;i=e.y;let c=n;for(;0<=c&&this.connections[c].y===i;){if(this.connections[c]===e)return c;c--}for(c=n;c<this.connections.length&&this.connections[c].y===i;){if(this.connections[c]===e)return c;c++}return-1}calculateIndexForYPos(e){if(!this.connections.length)return 0;let i=0,n=this.connections.length;for(;i<n;){const c=Math.floor((i+n)/2);if(this.connections[c].y<e)i=c+1;else if(this.connections[c].y>e)n=c;else{i=c;break}}return i}removeConnection(e,i){if(e=this.findIndexOfConnection(e,i),e===-1)throw Error("Unable to find connection in connectionDB.");this.connections.splice(e,1)}getNeighbours(e,i){function n(oe){const Ze=d-c[oe].x,Je=m-c[oe].y;return Math.sqrt(Ze*Ze+Je*Je)<=i&&K.push(c[oe]),Je<i}const c=this.connections,d=e.x,m=e.y;e=0;let y=c.length-2,O=y;for(;e<O;)c[O].y<m?e=O:y=O,O=Math.floor((e+y)/2);const K=[];if(y=e=O,c.length){for(;0<=e&&n(e);)e--;do y++;while(y<c.length&&n(y))}return K}isInYRange(e,i,n){return Math.abs(this.connections[e].y-i)<=n}searchForClosest(e,i,n){if(!this.connections.length)return{connection:null,radius:i};const c=e.y,d=e.x;e.x=d+n.x,e.y=c+n.y;var m=this.calculateIndexForYPos(e.y);n=null;let y=i,O,K=m-1;for(;0<=K&&this.isInYRange(K,e.y,i);)O=this.connections[K],this.connectionChecker.canConnect(e,O,!0,y)&&(n=O,y=O.distanceFrom(e)),K--;for(;m<this.connections.length&&this.isInYRange(m,e.y,i);)O=this.connections[m],this.connectionChecker.canConnect(e,O,!0,y)&&(n=O,y=O.distanceFrom(e)),m++;return e.x=d,e.y=c,{connection:n,radius:y}}static init(e){const i=[];return i[le.INPUT_VALUE]=new Un(e),i[le.OUTPUT_VALUE]=new Un(e),i[le.NEXT_STATEMENT]=new Un(e),i[le.PREVIOUS_STATEMENT]=new Un(e),i}},oc=null,Ko=null,jo={};jo.connectionUiEffect=ya,jo.disconnectUiEffect=Iu,jo.disconnectUiStop=Sn,jo.disposeUiEffect=Ea;var DT=class{constructor(e){this.workspace=e,this.horizontalScrollEnabled=this.workspace.isMovableHorizontally(),this.verticalScrollEnabled=this.workspace.isMovableVertically(),this.startScrollXY_=new te(e.scrollX,e.scrollY)}dispose(){this.workspace=null}startDrag(){qe()&&qe().unselect()}endDrag(e){this.drag(e)}drag(e){if(e=te.sum(this.startScrollXY_,e),this.horizontalScrollEnabled&&this.verticalScrollEnabled)this.workspace.scroll(e.x,e.y);else if(this.horizontalScrollEnabled)this.workspace.scroll(e.x,this.workspace.scrollY);else if(this.verticalScrollEnabled)this.workspace.scroll(this.workspace.scrollX,e.y);else throw new TypeError("Invalid state.")}},nC=5,oC=6,Li=class{constructor(e,i){this.creatorWorkspace=i,this.mouseDownXY=new te(0,0),this.startWorkspace_=this.targetBlock=this.startComment=this.startBlock=this.startIcon=this.startField=this.startBubble=null,this.hasExceededDragRadius=!1,this.boundEvents=[],this.workspaceDragger=this.dragger=null,this.dragging=!1,this.flyout=null,this.multiTouch=this.isEnding_=this.gestureHasStarted=this.calledUpdateIsDragging=!1,this.cachedPoints=new Map,this.startDistance=this.previousScale=0,this.currentDropdownOwner=this.isPinchZoomEnabled=null,this.mostRecentEvent=e,this.currentDragDeltaXY=new te(0,0)}dispose(){It(),nu(),this.creatorWorkspace.clearGesture();for(const e of this.boundEvents)Ue(e);this.boundEvents.length=0,this.workspaceDragger&&this.workspaceDragger.dispose()}updateFromEvent(e){const i=new te(e.clientX,e.clientY);this.updateDragDelta(i)&&(this.updateIsDragging(e),lt()),this.mostRecentEvent=e}updateDragDelta(e){return this.currentDragDeltaXY=te.difference(e,this.mouseDownXY),this.hasExceededDragRadius?!1:this.hasExceededDragRadius=te.magnitude(this.currentDragDeltaXY)>(this.flyout?s.config$$module$build$src$core$config.flyoutDragRadius:s.config$$module$build$src$core$config.dragRadius)}updateIsDraggingFromFlyout(){let e;if(!this.targetBlock||(e=this.flyout)==null||!e.isBlockCreatable(this.targetBlock))return!1;if(!this.flyout.targetWorkspace)throw Error(`Cannot update dragging from the flyout because the ' +
          'flyout's target workspace is undefined`);return!this.flyout.isScrollable()||this.flyout.isDragTowardWorkspace(this.currentDragDeltaXY)?(this.startWorkspace_=this.flyout.targetWorkspace,this.startWorkspace_.updateScreenCalculationsIfScrolled(),s.getGroup$$module$build$src$core$events$utils()||s.setGroup$$module$build$src$core$events$utils(!0),this.startBlock=null,this.targetBlock=this.flyout.createBlock(this.targetBlock),s.setSelected$$module$build$src$core$common(this.targetBlock),!0):!1}updateIsDraggingWorkspace(){if(!this.startWorkspace_)throw Error("Cannot update dragging the workspace because the start workspace is undefined");(this.flyout?this.flyout.isScrollable():this.startWorkspace_&&this.startWorkspace_.isDraggable())&&(this.dragging=!0,this.workspaceDragger=new DT(this.startWorkspace_),this.workspaceDragger.startDrag())}updateIsDragging(e){if(!this.startWorkspace_)throw Error("Cannot update dragging because the start workspace is undefined");if(this.calledUpdateIsDragging)throw Error("updateIsDragging_ should only be called once per gesture.");this.calledUpdateIsDragging=!0,this.flyout&&this.updateIsDraggingFromFlyout();const i=qe();i&&Rr(i)&&i.isMovable()?(this.dragging=!0,this.dragger=this.createDragger(i,this.startWorkspace_),this.dragger.onDragStart(e),this.dragger.onDrag(e,this.currentDragDeltaXY)):this.updateIsDraggingWorkspace()}createDragger(e,i){return new(_(Z.BLOCK_DRAGGER,this.creatorWorkspace.options,!0))(e,i)}doStart(e){if(!this.startWorkspace_)throw Error("Cannot start the touch gesture becauase the start workspace is undefined");this.isPinchZoomEnabled=this.startWorkspace_.options.zoomOptions&&this.startWorkspace_.options.zoomOptions.pinch,Fs(e)?this.cancel():(this.gestureHasStarted=!0,Sn(),this.startWorkspace_.updateScreenCalculationsIfScrolled(),this.startWorkspace_.isMutator&&this.startWorkspace_.resize(),this.currentDropdownOwner=Fh(),this.startWorkspace_.hideChaff(!!this.flyout),this.startWorkspace_.markFocused(),this.mostRecentEvent=e,ru(),Jt(e)?this.handleRightClick(e):(e.type.toLowerCase()==="pointerdown"&&e.pointerType!=="mouse"&&qt(e,this),this.mouseDownXY=new te(e.clientX,e.clientY),this.bindMouseEvents(e),this.isEnding_||this.handleTouchStart(e)))}bindMouseEvents(e){this.boundEvents.push(fe(document,"pointerdown",null,this.handleStart.bind(this),!0)),this.boundEvents.push(fe(document,"pointermove",null,this.handleMove.bind(this),!0)),this.boundEvents.push(fe(document,"pointerup",null,this.handleUp.bind(this),!0)),e.preventDefault(),e.stopPropagation()}handleStart(e){this.isDragging()||(this.handleTouchStart(e),this.isMultiTouch()&&lt())}handleMove(e){this.isDragging()&&Cs(e)||!this.isMultiTouch()?(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation()):this.isMultiTouch()&&(this.handleTouchMove(e),lt())}handleUp(e){if(this.isDragging()||this.handleTouchEnd(e),!this.isMultiTouch()||this.isDragging()){if(!Cs(e))return;if(this.updateFromEvent(e),lt(),this.isEnding_){console.log("Trying to end a gesture recursively.");return}this.isEnding_=!0,this.dragger?this.dragger.onDragEnd(e,this.currentDragDeltaXY):this.workspaceDragger?this.workspaceDragger.endDrag(this.currentDragDeltaXY):this.isBubbleClick()||this.isCommentClick()||(this.isFieldClick()?this.doFieldClick():this.isIconClick()?this.doIconClick():this.isBlockClick()?this.doBlockClick():this.isWorkspaceClick()&&this.doWorkspaceClick(e))}e.preventDefault(),e.stopPropagation(),this.dispose()}handleTouchStart(e){var i=ws(e);this.cachedPoints.set(i,this.getTouchPoint(e));var n=Array.from(this.cachedPoints.keys());n.length===2&&(i=this.cachedPoints.get(n[0]),n=this.cachedPoints.get(n[1]),this.startDistance=te.distance(i,n),this.multiTouch=!0,e.preventDefault())}handleTouchMove(e){const i=ws(e);this.cachedPoints.set(i,this.getTouchPoint(e)),this.isPinchZoomEnabled&&this.cachedPoints.size===2?this.handlePinch(e):(this.updateFromEvent(e),this.workspaceDragger?this.workspaceDragger.drag(this.currentDragDeltaXY):this.dragger&&this.dragger.onDrag(this.mostRecentEvent,this.currentDragDeltaXY),e.preventDefault(),e.stopPropagation())}handlePinch(e){var i=Array.from(this.cachedPoints.keys()),n=this.cachedPoints.get(i[0]);if(i=this.cachedPoints.get(i[1]),n=te.distance(n,i)/this.startDistance,0<this.previousScale&&1/0>this.previousScale){if(i=n-this.previousScale,i=0<i?i*nC:i*oC,!this.startWorkspace_)throw Error("Cannot handle a pinch because the start workspace is undefined");const c=this.startWorkspace_,d=P(e,c.getParentSvg(),c.getInverseScreenCTM());c.zoom(d.x,d.y,i)}this.previousScale=n,e.preventDefault()}handleTouchEnd(e){e=ws(e),this.cachedPoints.has(e)&&this.cachedPoints.delete(e),2>this.cachedPoints.size&&(this.cachedPoints.clear(),this.previousScale=0)}getTouchPoint(e){return this.startWorkspace_?new te(e.pageX,e.pageY):null}isMultiTouch(){return this.multiTouch}cancel(){this.isEnding_||(lt(),this.dragger?this.dragger.onDragEnd(this.mostRecentEvent,this.currentDragDeltaXY):this.workspaceDragger&&this.workspaceDragger.endDrag(this.currentDragDeltaXY),this.dispose())}handleRightClick(e){this.targetBlock?(this.bringBlockToFront(),this.targetBlock.workspace.hideChaff(!!this.flyout),this.targetBlock.showContextMenu(e)):this.startBubble?this.startBubble.showContextMenu(e):this.startComment?(this.startComment.workspace.hideChaff(),this.startComment.showContextMenu(e)):this.startWorkspace_&&!this.flyout&&(this.startWorkspace_.hideChaff(),this.startWorkspace_.showContextMenu(e)),e.preventDefault(),e.stopPropagation(),this.dispose()}handleWsStart(e,i){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleWsStart, but the gesture had already been started.");this.setStartWorkspace(i),this.mostRecentEvent=e,this.startBlock||this.startBubble||this.startComment||s.setSelected$$module$build$src$core$common(null),this.doStart(e)}fireWorkspaceClick(e){z(new(he(W.CLICK))(null,e.id,"workspace"))}handleFlyoutStart(e,i){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleFlyoutStart, but the gesture had already been started.");this.setStartFlyout(i),this.handleWsStart(e,i.getWorkspace())}handleBlockStart(e,i){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBlockStart, but the gesture had already been started.");this.setStartBlock(i),this.mostRecentEvent=e}handleBubbleStart(e,i){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleBubbleStart, but the gesture had already been started.");this.setStartBubble(i),this.mostRecentEvent=e}handleCommentStart(e,i){if(this.gestureHasStarted)throw Error("Tried to call gesture.handleCommentStart, but the gesture had already been started.");this.setStartComment(i),this.mostRecentEvent=e}doFieldClick(){if(!this.startField)throw Error("Cannot do a field click because the start field is undefined");this.currentDropdownOwner!==this.startField&&this.startField.showEditor(this.mostRecentEvent),this.bringBlockToFront()}doIconClick(){if(!this.startIcon)throw Error("Cannot do an icon click because the start icon is undefined");this.bringBlockToFront(),this.startIcon.onClick()}doBlockClick(){if(this.flyout&&this.flyout.autoClose){if(!this.targetBlock)throw Error("Cannot do a block click because the target block is undefined");if(this.targetBlock.isEnabled()){s.getGroup$$module$build$src$core$events$utils()||s.setGroup$$module$build$src$core$events$utils(!0);var e=this.flyout.createBlock(this.targetBlock);e.snapToGrid(),e.bumpNeighbours()}}else{if(!this.startWorkspace_)throw Error("Cannot do a block click because the start workspace is undefined");e=new(he(W.CLICK))(this.startBlock,this.startWorkspace_.id,"block"),z(e)}this.bringBlockToFront(),s.setGroup$$module$build$src$core$events$utils(!1)}doWorkspaceClick(e){e=this.creatorWorkspace,qe()&&qe().unselect(),this.fireWorkspaceClick(this.startWorkspace_||e)}bringBlockToFront(){this.targetBlock&&!this.flyout&&this.targetBlock.bringToFront()}setStartField(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartField, but the gesture had already been started.");this.startField||(this.startField=e)}setStartIcon(e){if(this.gestureHasStarted)throw Error("Tried to call gesture.setStartIcon, but the gesture had already been started.");this.startIcon||(this.startIcon=e)}setStartBubble(e){this.startBubble||(this.startBubble=e)}setStartComment(e){this.startComment||(this.startComment=e)}setStartBlock(e){this.startBlock||this.startBubble||(this.startBlock=e,s.setSelected$$module$build$src$core$common(this.startBlock),e.isInFlyout&&e!==e.getRootBlock()?this.setTargetBlock(e.getRootBlock()):this.setTargetBlock(e))}setTargetBlock(e){e.isShadow()?this.setTargetBlock(e.getParent()):this.targetBlock=e}setStartWorkspace(e){this.startWorkspace_||(this.startWorkspace_=e)}setStartFlyout(e){this.flyout||(this.flyout=e)}isBubbleClick(){return!!this.startBubble&&!this.hasExceededDragRadius}isCommentClick(){return!!this.startComment&&!this.hasExceededDragRadius}isBlockClick(){return!!this.startBlock&&!this.hasExceededDragRadius&&!this.isFieldClick()&&!this.isIconClick()}isFieldClick(){return this.startField?this.startField.isClickable()&&!this.hasExceededDragRadius&&(!this.flyout||this.startField.isClickableInFlyout(this.flyout.autoClose)):!1}isIconClick(){if(!this.startIcon)return!1;const e=!this.flyout||!this.startIcon.isClickableInFlyout||this.startIcon.isClickableInFlyout(this.flyout.autoClose);return!this.hasExceededDragRadius&&e}isWorkspaceClick(){return!this.startBlock&&!this.startBubble&&!this.startField&&!this.hasExceededDragRadius}getCurrentDragger(){let e,i;return(i=(e=this.workspaceDragger)!=null?e:this.dragger)!=null?i:null}isDragging(){return this.dragging}hasStarted(){return this.gestureHasStarted}static inProgress(){const e=Kt();for(let i=0,n;n=e[i];i++)if(n.currentGesture_)return!0;return!1}},op=class{constructor(e,i){this.pattern=e,this.scale=1;let n;this.spacing=(n=i.spacing)!=null?n:0;let c;this.length=(c=i.length)!=null?c:1,this.line2=(this.line1=e.firstChild)&&this.line1.nextSibling;let d;this.snapToGrid=(d=i.snap)!=null?d:!1}setSpacing(e){this.spacing=e,this.update(this.scale)}getSpacing(){return this.spacing}setLength(e){this.length=e,this.update(this.scale)}getLength(){return this.length}setSnapToGrid(e){this.snapToGrid=e}shouldSnap(){return this.snapToGrid}getPatternId(){return this.pattern.id}update(e){this.scale=e;var i=this.spacing*e;this.pattern.setAttribute("width",`${i}`),this.pattern.setAttribute("height",`${i}`),i=Math.floor(this.spacing/2)+.5;let n=i-this.length/2,c=i+this.length/2;i*=e,n*=e,c*=e,this.setLineAttributes(this.line1,e,n,c,i,i),this.setLineAttributes(this.line2,e,i,i,n,c)}setLineAttributes(e,i,n,c,d,m){e&&(e.setAttribute("stroke-width",`${i}`),e.setAttribute("x1",`${n}`),e.setAttribute("y1",`${d}`),e.setAttribute("x2",`${c}`),e.setAttribute("y2",`${m}`))}moveTo(e,i){this.pattern.setAttribute("x",`${e}`),this.pattern.setAttribute("y",`${i}`)}alignXY(e){var i=this.getSpacing();const n=i/2,c=Math.round(Math.round((e.x-n)/i)*i+n);return i=Math.round(Math.round((e.y-n)/i)*i+n),c===e.x&&i===e.y?e:new te(c,i)}static createDom(e,i,n){e=Y(U.PATTERN,{id:"blocklyGridPattern"+e,patternUnits:"userSpaceOnUse"},n);let c,d;if(0<((c=i.length)!=null?c:1)&&0<((d=i.spacing)!=null?d:0)){Y(U.LINE,{stroke:i.colour},e);let m;(m=i.length)!=null&&m&&Y(U.LINE,{stroke:i.colour},e)}else Y(U.LINE,{},e);return e}},lC=class{constructor(e){this.workspace=e,this.layers=new Map,(e=e.getInjectionDiv())&&(this.dragLayer=this.createDragLayer(e),this.animationLayer=this.createAnimationLayer(e)),e=this.createLayer(lr),re(e,"blocklyBlockCanvas"),e=this.createLayer(ic),re(e,"blocklyBubbleCanvas")}createDragLayer(e){const i=Y(U.SVG,{class:"blocklyBlockDragSurface",xmlns:Po,"xmlns:html":ui,"xmlns:xlink":ms,version:"1.1"});return e.append(i),Y(U.G,{},i)}createAnimationLayer(e){const i=Y(U.SVG,{class:"blocklyAnimationLayer",xmlns:Po,"xmlns:html":ui,"xmlns:xlink":ms,version:"1.1"});return e.append(i),Y(U.G,{},i)}appendToAnimationLayer(e){let i;const n=(i=this.dragLayer)==null?void 0:i.getAttribute("transform");if(n){let d;(d=this.animationLayer)==null||d.setAttribute("transform",n)}let c;(c=this.animationLayer)==null||c.appendChild(e.getSvgRoot())}translateLayers(e,i){e=`translate(${e.x}, ${e.y}) scale(${i})`;let n;(n=this.dragLayer)==null||n.setAttribute("transform",e);for(const[,c]of this.layers)c.setAttribute("transform",e)}moveToDragLayer(e){let i;(i=this.dragLayer)==null||i.appendChild(e.getSvgRoot())}moveOffDragLayer(e,i){this.append(e,i)}append(e,i){this.layers.has(i)||this.createLayer(i);let n;(n=this.layers.get(i))==null||n.appendChild(e.getSvgRoot())}createLayer(e){const i=this.workspace.getSvgGroup(),n=Y(U.G,{});let c=!1;const d=[...this.layers].sort((m,y)=>m[0]-y[0]);for(const[m,y]of d)if(e<m){i.insertBefore(n,y),c=!0;break}return c||i.appendChild(n),this.layers.set(e,n),n}hasLayer(e){return e===this.dragLayer||new Set(this.layers.values()).has(e)}getBlockLayer(){return this.layers.get(lr)}getBubbleLayer(){return this.layers.get(ic)}},BT={};BT.deepMerge=Ci;var Vr=class{constructor(e,i,n,c){this.name=e,this.startHats=!1,this.blockStyles=i||Object.create(null),this.categoryStyles=n||Object.create(null),this.componentStyles=c||Object.create(null),this.fontStyle=Object.create(null),r(Z.THEME,e,this,!0)}getClassName(){return this.name+"-theme"}setBlockStyle(e,i){this.blockStyles[e]=i}setCategoryStyle(e,i){this.categoryStyles[e]=i}getComponentStyle(e){if(e=this.componentStyles[e],!e)return null;if(typeof e=="string"){const i=this.getComponentStyle(e);if(i)return i}return`${e}`}setComponentStyle(e,i){this.componentStyles[e]=i}setFontStyle(e){this.fontStyle=e}setStartHats(e){this.startHats=e}static defineTheme(e,i){e=e.toLowerCase();const n=new Vr(e);let c=i.base;if(c){if(typeof c=="string"){let d;c=(d=f(Z.THEME,c))!=null?d:void 0}c instanceof Vr&&(Ci(n,c),n.name=e)}return Ci(n.blockStyles,i.blockStyles),Ci(n.categoryStyles,i.categoryStyles),Ci(n.componentStyles,i.componentStyles),Ci(n.fontStyle,i.fontStyle),i.startHats!==null&&(n.startHats=i.startHats),n}},aC={colour_blocks:{colourPrimary:"20"},list_blocks:{colourPrimary:"260"},logic_blocks:{colourPrimary:"210"},loop_blocks:{colourPrimary:"120"},math_blocks:{colourPrimary:"230"},procedure_blocks:{colourPrimary:"290"},text_blocks:{colourPrimary:"160"},variable_blocks:{colourPrimary:"330"},variable_dynamic_blocks:{colourPrimary:"310"},hat_blocks:{colourPrimary:"330",hat:"cap"}},cC={colour_category:{colour:"20"},list_category:{colour:"260"},logic_category:{colour:"210"},loop_category:{colour:"120"},math_category:{colour:"230"},procedure_category:{colour:"290"},text_category:{colour:"160"},variable_category:{colour:"330"},variable_dynamic_category:{colour:"310"}},lc=new Vr("classic",aC,cC),As=class{constructor(e){this.gridPattern=null,this.getMetrics=this.setMetrics=void 0;let i=null,n=!1;var c=!1,d=!1,m=!1,y=!1,O=!1;const K=!!e.readOnly;if(!K){var oe;i=Kl((oe=e.toolbox)!=null?oe:null),n=jl(i),c=e.trashcan,c=c===void 0?n:c,d=e.collapse,d=d===void 0?n:d,m=e.comments,m=m===void 0?n:m,y=e.disable,y=y===void 0?n:y,O=e.sounds,O=O===void 0?!0:O}oe=e.maxTrashcanContents,c?oe===void 0&&(oe=32):oe=0;const Ze=!!e.rtl;let Je=e.horizontalLayout;Je===void 0&&(Je=!1);var us=e.toolboxPosition!=="end";us=Je?us?Ie.TOP:Ie.BOTTOM:us===Ze?Ie.RIGHT:Ie.LEFT;let qn=e.css;qn===void 0&&(qn=!0);let al="https://blockly-demo.appspot.com/static/media/";e.media&&(al=e.media.endsWith("/")?e.media:e.media+"/");const fE=e.oneBasedIndex,FC=e.renderer||"geras",UC=e.plugins||{};let Qp=e.modalInputs;Qp===void 0&&(Qp=!0),this.RTL=Ze,this.oneBasedIndex=fE===void 0?!0:fE,this.collapse=d,this.comments=m,this.disable=y,this.readOnly=K,this.maxBlocks=e.maxBlocks||1/0;let gE;this.maxInstances=(gE=e.maxInstances)!=null?gE:null,this.modalInputs=Qp,this.pathToMedia=al,this.hasCategories=n,this.moveOptions=As.parseMoveOptions(e,n),this.hasScrollbars=!!this.moveOptions.scrollbars,this.hasTrashcan=c,this.maxTrashcanContents=oe,this.hasSounds=O,this.hasCss=qn,this.horizontalLayout=Je,this.languageTree=i,this.gridOptions=As.parseGridOptions(e),this.zoomOptions=As.parseZoomOptions(e),this.toolboxPosition=us,this.theme=As.parseThemeOptions(e),this.renderer=FC;let mE;this.rendererOverrides=(mE=e.rendererOverrides)!=null?mE:null;let _E;this.parentWorkspace=(_E=e.parentWorkspace)!=null?_E:null,this.plugins=UC}static parseMoveOptions(e,i){const n=e.move||{},c={};return n.scrollbars===void 0&&e.scrollbars===void 0?c.scrollbars=i:typeof n.scrollbars=="object"?(c.scrollbars={horizontal:!!n.scrollbars.horizontal,vertical:!!n.scrollbars.vertical},c.scrollbars.horizontal&&c.scrollbars.vertical?c.scrollbars=!0:c.scrollbars.horizontal||c.scrollbars.vertical||(c.scrollbars=!1)):c.scrollbars=!!n.scrollbars||!!e.scrollbars,c.wheel=c.scrollbars&&n.wheel!==void 0?!!n.wheel:typeof c.scrollbars=="object",c.drag=c.scrollbars?n.drag===void 0?!0:!!n.drag:!1,c}static parseZoomOptions(e){e=e.zoom||{};const i={};return i.controls=e.controls===void 0?!1:!!e.controls,i.wheel=e.wheel===void 0?!1:!!e.wheel,i.startScale=e.startScale===void 0?1:Number(e.startScale),i.maxScale=e.maxScale===void 0?3:Number(e.maxScale),i.minScale=e.minScale===void 0?.3:Number(e.minScale),i.scaleSpeed=e.scaleSpeed===void 0?1.2:Number(e.scaleSpeed),i.pinch=e.pinch===void 0?i.wheel||i.controls:!!e.pinch,i}static parseGridOptions(e){e=e.grid||{};const i={};return i.spacing=Number(e.spacing)||0,i.colour=e.colour||"#888",i.length=e.length===void 0?1:Number(e.length),i.snap=0<i.spacing&&!!e.snap,i}static parseThemeOptions(e){return e=e.theme||lc,typeof e=="string"?f(Z.THEME,e):e instanceof Vr?e:Vr.defineTheme(e.name||"builtin"+E(),e)}},FT={fromJsonInternal:H_},ac={TEST_ONLY:FT};ac.fromJson=s.fromJson$$module$build$src$core$field_registry,ac.register=ai,ac.unregister=G_;var hs=class extends Ke{constructor(e,i,n){super(Ke.SKIP_SETUP),this.svgArrow=this.arrow=this.imageElement=this.menu_=this.selectedMenuItem=null,this.SERIALIZABLE=!0,this.CURSOR="default",this.clickTarget_=this.suffixField=this.prefixField=this.generatedOptions=null,e!==Ke.SKIP_SETUP&&(Array.isArray(e)?(this.validateOptions(e),e=this.trimOptions(e),this.menuGenerator_=e.options,this.prefixField=e.prefix||null,this.suffixField=e.suffix||null):this.menuGenerator_=e,this.selectedOption=this.getOptions(!1)[0],n&&this.configure_(n),this.setValue(this.selectedOption[1]),i&&this.setValidator(i))}fromXml(e){this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e.textContent)}loadState(e){this.loadLegacyState(hs,e)||(this.isOptionListDynamic()&&this.getOptions(!1),this.setValue(e))}initView(){this.shouldAddBorderRect_()?this.createBorderRect_():this.clickTarget_=this.sourceBlock_.getSvgRoot(),this.createTextElement_(),this.imageElement=Y(U.IMAGE,{},this.fieldGroup_),this.getConstants().FIELD_DROPDOWN_SVG_ARROW?this.createSVGArrow_():this.createTextArrow_(),this.borderRect_&&re(this.borderRect_,"blocklyDropdownRect")}shouldAddBorderRect_(){let e;return!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW&&!((e=this.getSourceBlock())!=null&&e.isShadow())}createTextArrow_(){this.arrow=Y(U.TSPAN,{},this.textElement_);let e;this.arrow.appendChild(document.createTextNode((e=this.getSourceBlock())!=null&&e.RTL?hs.ARROW_CHAR+" ":" "+hs.ARROW_CHAR)),this.getConstants().FIELD_TEXT_BASELINE_CENTER&&this.arrow.setAttribute("dominant-baseline","central");let i;(i=this.getSourceBlock())!=null&&i.RTL?this.getTextElement().insertBefore(this.arrow,this.textContent_):this.getTextElement().appendChild(this.arrow)}createSVGArrow_(){this.svgArrow=Y(U.IMAGE,{height:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px",width:this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE+"px"},this.fieldGroup_),this.svgArrow.setAttributeNS(ms,"xlink:href",this.getConstants().FIELD_DROPDOWN_SVG_ARROW_DATAURI)}showEditor_(e){var i=this.getSourceBlock();if(!i)throw new ut;this.dropdownCreate(),this.menu_.openingCoords=e&&typeof e.clientX=="number"?new te(e.clientX,e.clientY):null,ca(),e=this.menu_.render(To()),re(e,"blocklyDropdownMenu"),this.getConstants().FIELD_DROPDOWN_COLOURED_DIV&&(i=i.getColour(),e=this.sourceBlock_.getColourTertiary(),Uh(i,e)),Gh(this,this.dropdownDispose_.bind(this)),this.menu_.focus(),this.selectedMenuItem&&(this.menu_.setHighlighted(this.selectedMenuItem),yr(this.selectedMenuItem.getElement(),To(),!0)),this.applyColour()}dropdownCreate(){const e=this.getSourceBlock();if(!e)throw new ut;const i=new Dd;i.setRole(Ws.LISTBOX),this.menu_=i;const n=this.getOptions(!1);this.selectedMenuItem=null;for(let d=0;d<n.length;d++){const[m,y]=n[d];if(typeof m=="object"){var c=new Image(m.width,m.height);c.src=m.src,c.alt=m.alt||""}else c=m;c=new Bd(c,y),c.setRole(Ws.OPTION),c.setRightToLeft(e.RTL),c.setCheckable(!0),i.addChild(c),c.setChecked(y===this.value_),y===this.value_&&(this.selectedMenuItem=c),c.onAction(this.handleMenuActionEvent,this)}}dropdownDispose_(){this.menu_&&this.menu_.dispose(),this.selectedMenuItem=this.menu_=null,this.applyColour()}handleMenuActionEvent(e){ha(this,!0),this.onItemSelected_(this.menu_,e)}onItemSelected_(e,i){this.setValue(i.getValue())}isOptionListDynamic(){return typeof this.menuGenerator_=="function"}getOptions(e){if(!this.menuGenerator_)throw TypeError("A menu generator was never defined.");return Array.isArray(this.menuGenerator_)?this.menuGenerator_:e&&this.generatedOptions?this.generatedOptions:(this.generatedOptions=this.menuGenerator_(),this.validateOptions(this.generatedOptions),this.generatedOptions)}doClassValidation_(e){return this.getOptions(!0).some(i=>i[1]===e)?e:(this.sourceBlock_&&console.warn("Cannot set the dropdown's value to an unavailable option. Block type: "+this.sourceBlock_.type+", Field name: "+this.name+", Value: "+e),null)}doValueUpdate_(e){super.doValueUpdate_(e),e=this.getOptions(!0);for(let i=0,n;n=e[i];i++)n[1]===this.value_&&(this.selectedOption=n)}applyColour(){const e=this.sourceBlock_;this.borderRect_&&(this.borderRect_.setAttribute("stroke",e.getColourTertiary()),this.menu_?this.borderRect_.setAttribute("fill",e.getColourTertiary()):this.borderRect_.setAttribute("fill","transparent")),e&&this.arrow&&(e.isShadow()?this.arrow.style.fill=e.getColourSecondary():this.arrow.style.fill=e.getColour())}render_(){this.getTextContent().nodeValue="",this.imageElement.style.display="none";const e=this.selectedOption&&this.selectedOption[0];e&&typeof e=="object"?this.renderSelectedImage(e):this.renderSelectedText(),this.positionBorderRect_()}renderSelectedImage(e){const i=this.getSourceBlock();if(!i)throw new ut;this.imageElement.style.display="",this.imageElement.setAttributeNS(ms,"xlink:href",e.src),this.imageElement.setAttribute("height",String(e.height)),this.imageElement.setAttribute("width",String(e.width));const n=Number(e.height);e=Number(e.width);var c=!!this.borderRect_;const d=Math.max(c?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,n+hs.IMAGE_Y_PADDING);c=c?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let m;m=this.svgArrow?this.positionSVGArrow(e+c,d/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2):Us(this.arrow,this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY),this.size_.width=e+m+2*c,this.size_.height=d;let y=0;i.RTL?this.imageElement.setAttribute("x",`${c+m}`):(y=e+m,this.getTextElement().setAttribute("text-anchor","end"),this.imageElement.setAttribute("x",`${c}`)),this.imageElement.setAttribute("y",String(d/2-n/2)),this.positionTextElement_(y+c,e+m)}renderSelectedText(){this.getTextContent().nodeValue=this.getDisplayText_();var e=this.getTextElement();re(e,"blocklyDropdownText"),e.setAttribute("text-anchor","start");var i=!!this.borderRect_;e=Math.max(i?this.getConstants().FIELD_DROPDOWN_BORDER_RECT_HEIGHT:0,this.getConstants().FIELD_TEXT_HEIGHT);const n=Us(this.getTextElement(),this.getConstants().FIELD_TEXT_FONTSIZE,this.getConstants().FIELD_TEXT_FONTWEIGHT,this.getConstants().FIELD_TEXT_FONTFAMILY);i=i?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0;let c=0;this.svgArrow&&(c=this.positionSVGArrow(n+i,e/2-this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE/2)),this.size_.width=n+c+2*i,this.size_.height=e,this.positionTextElement_(i,n)}positionSVGArrow(e,i){if(!this.svgArrow)return 0;const n=this.getSourceBlock();if(!n)throw new ut;const c=this.borderRect_?this.getConstants().FIELD_BORDER_RECT_X_PADDING:0,d=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_PADDING,m=this.getConstants().FIELD_DROPDOWN_SVG_ARROW_SIZE;return this.svgArrow.setAttribute("transform","translate("+(n.RTL?c:e+d)+","+i+")"),m+d}getText_(){if(!this.selectedOption)return null;const e=this.selectedOption[0];return typeof e=="object"?e.alt:e}static fromJson(e){if(!e.options)throw Error("options are required for the dropdown field. The options property must be assigned an array of [humanReadableValue, languageNeutralValue] tuples.");return new this(e.options,void 0,e)}trimOptions(e){let i=!1;const n=e.map(([y,O])=>typeof y=="string"?[at(y),O]:(i=!0,[y.alt!==null?Object.assign({},y,{alt:at(y.alt)}):Object.assign({},y),O]));if(i||2>e.length)return{options:n};var c=n.map(([y])=>y),d=Eo(c);e=Jh(c,d);const m=Zh(c,d);return!e&&!m||d<=e+m?{options:n}:(d=e?c[0].substring(0,e-1):void 0,c=m?c[0].substr(1-m):void 0,{options:this.applyTrim(n,e,m),prefix:d,suffix:c})}applyTrim(e,i,n){return e.map(([c,d])=>[c.substring(i,c.length-n),d])}validateOptions(e){if(!Array.isArray(e))throw TypeError("FieldDropdown options must be an array.");if(!e.length)throw TypeError("FieldDropdown options must not be an empty array.");let i=!1;for(let n=0;n<e.length;n++){const c=e[n];Array.isArray(c)?typeof c[1]!="string"?(i=!0,console.error(`Invalid option[${n}]: Each FieldDropdown option id must be a string. 
          Found ${c[1]} in: ${c}`)):c[0]&&typeof c[0]!="string"&&typeof c[0].src!="string"&&(i=!0,console.error(`Invalid option[${n}]: Each FieldDropdown option must have a string 
          label or image description. Found ${c[0]} in: ${c}`)):(i=!0,console.error(`Invalid option[${n}]: Each FieldDropdown option must be an array.
          Found: ${c}`))}if(i)throw TypeError("Found invalid FieldDropdown options.")}};hs.CHECKMARK_OVERHANG=25,hs.MAX_MENU_HEIGHT_VH=.45,hs.ARROW_CHAR="▾",hs.IMAGE_Y_OFFSET=5,hs.IMAGE_Y_PADDING=2*hs.IMAGE_Y_OFFSET,ai("field_dropdown",hs);var UT=class{constructor(e,i){this.bubble=e,this.workspace=i,this.startLoc=null,this.inGroup=!1}isMovable(){return!0}startDrag(){(this.inGroup=!!s.getGroup$$module$build$src$core$events$utils())||s.setGroup$$module$build$src$core$events$utils(!0),this.startLoc=this.bubble.getRelativeToSurfaceXY(),this.workspace.setResizesEnabled(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveToDragLayer(this.bubble),this.bubble.setDragging&&this.bubble.setDragging(!0)}drag(e){this.bubble.moveDuringDrag(e)}endDrag(){this.workspace.setResizesEnabled(!0),this.inGroup||s.setGroup$$module$build$src$core$events$utils(!1);let e;(e=this.workspace.getLayerManager())==null||e.moveOffDragLayer(this.bubble,ic),this.bubble.setDragging(!1)}revertDrag(){this.startLoc&&this.bubble.moveDuringDrag(this.startLoc)}},$s,Ge=class{constructor(e,i,n){this.workspace=e,this.anchor=i,this.ownerRect=n,this.size=new Oe(0,0),this.colour="#ffffff",this.disposed=!1,this.relativeLeft=this.relativeTop=0,this.dragStrategy=new UT(this,this.workspace),this.id=E(),this.svgRoot=Y(U.G,{class:"blocklyBubble"},e.getBubbleCanvas()),e=Y(U.G,{filter:`url(#${this.workspace.getRenderer().getConstants().embossFilterId})`},this.svgRoot),this.tail=Y(U.PATH,{class:"blocklyBubbleTail"},e),this.background=Y(U.RECT,{class:"blocklyDraggable",x:0,y:0,rx:$s.BORDER_WIDTH,ry:$s.BORDER_WIDTH},e),this.contentContainer=Y(U.G,{},this.svgRoot),fe(this.background,"pointerdown",this,this.onMouseDown)}dispose(){F(this.svgRoot),this.disposed=!0}setAnchorLocation(e,i=!1){this.anchor=e,i?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}setPositionRelativeToAnchor(e,i){this.relativeLeft=e,this.relativeTop=i,this.positionRelativeToAnchor(),this.renderTail()}getSize(){return this.size}setSize(e,i=!1){e.width=Math.max(e.width,$s.MIN_SIZE),e.height=Math.max(e.height,$s.MIN_SIZE),this.size=e,this.background.setAttribute("width",`${e.width}`),this.background.setAttribute("height",`${e.height}`),i?this.positionByRect(this.ownerRect):this.positionRelativeToAnchor(),this.renderTail()}getColour(){return this.colour}setColour(e){this.colour=e,this.tail.setAttribute("fill",e),this.background.setAttribute("fill",e)}onMouseDown(e){let i;(i=this.workspace.getGesture(e))==null||i.handleBubbleStart(e,this),this.bringToFront(),s.setSelected$$module$build$src$core$common(this)}positionRelativeToAnchor(){let e=this.anchor.x;e=this.workspace.RTL?e-(this.relativeLeft+this.size.width):e+this.relativeLeft,this.moveTo(e,this.relativeTop+this.anchor.y)}moveTo(e,i){this.svgRoot.setAttribute("transform",`translate(${e}, ${i})`)}positionByRect(e=new Ve(0,0,0,0)){var i=this.workspace.getMetricsManager().getViewMetrics(!0),n=this.getOptimalRelativeLeft(i),c=this.getOptimalRelativeTop(i);const d={x:n,y:-this.size.height-this.workspace.getRenderer().getConstants().MIN_BLOCK_HEIGHT},m={x:-this.size.width-30,y:c};c={x:e.getWidth(),y:c};var y={x:n,y:e.getHeight()};n=e.getWidth()<e.getHeight()?c:y,e=e.getWidth()<e.getHeight()?y:c,c=this.getOverlap(d,i),y=this.getOverlap(m,i);const O=this.getOverlap(n,i);i=this.getOverlap(e,i),i=Math.max(c,y,O,i),c===i?(this.relativeLeft=d.x,this.relativeTop=d.y):y===i?(this.relativeLeft=m.x,this.relativeTop=m.y):O===i?(this.relativeLeft=n.x,this.relativeTop=n.y):(this.relativeLeft=e.x,this.relativeTop=e.y),this.positionRelativeToAnchor()}getOverlap(e,i){var n=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x+this.anchor.x;return e=e.y+this.anchor.y,Math.max(0,Math.min(1,(Math.min(n+this.size.width,i.left+i.width)-Math.max(n,i.left))*(Math.min(e+this.size.height,i.top+i.height)-Math.max(e,i.top))/(this.size.width*this.size.height)))}getOptimalRelativeLeft(e){let i=-this.size.width/4;if(this.size.width>e.width)return i;if(e=this.getWorkspaceViewRect(e),this.workspace.RTL){var n=this.anchor.x-i;n-this.size.width<e.left?i=-(e.left-this.anchor.x+this.size.width):n>e.right&&(i=-(e.right-this.anchor.x))}else{n=i+this.anchor.x;const c=n+this.size.width;n<e.left?i=e.left-this.anchor.x:c>e.right&&(i=e.right-this.anchor.x-this.size.width)}return i}getOptimalRelativeTop(e){let i=-this.size.height/4;if(this.size.height>e.height)return i;const n=this.anchor.y+i,c=n+this.size.height;return e=this.getWorkspaceViewRect(e),n<e.top?i=e.top-this.anchor.y:c>e.bottom&&(i=e.bottom-this.anchor.y-this.size.height),i}getWorkspaceViewRect(e){const i=e.top;let n=e.top+e.height,c=e.left;return e=e.left+e.width,n-=this.getScrollbarThickness(),this.workspace.RTL?c-=this.getScrollbarThickness():e-=this.getScrollbarThickness(),new Ve(i,n,c,e)}getScrollbarThickness(){return ht.scrollbarThickness/this.workspace.scale}renderTail(){const e=[];var i=this.size.width/2,n=this.size.height/2,c=-this.relativeLeft,d=-this.relativeTop;if(i===c&&n===d)e.push("M "+i+","+n);else{d-=n,c-=i,this.workspace.RTL&&(c*=-1);var m=Math.sqrt(d*d+c*c),y=Math.acos(c/m);0>d&&(y=2*Math.PI-y);var O=y+Math.PI/2;O>2*Math.PI&&(O-=2*Math.PI);var K=Math.sin(O);const Ze=Math.cos(O);let Je=(this.size.width+this.size.height)/$s.TAIL_THICKNESS;Je=Math.min(Je,this.size.width,this.size.height)/4,O=1-$s.ANCHOR_RADIUS/m,c=i+O*c,d=n+O*d,O=i+Je*Ze;const us=n+Je*K;i-=Je*Ze,n-=Je*K,K=aa(this.workspace.RTL?-$s.TAIL_ANGLE:$s.TAIL_ANGLE),K=y+K,K>2*Math.PI&&(K-=2*Math.PI),y=Math.sin(K)*m/$s.TAIL_BEND,m=Math.cos(K)*m/$s.TAIL_BEND,e.push("M"+O+","+us),e.push("C"+(O+m)+","+(us+y)+" "+c+","+d+" "+c+","+d),e.push("C"+c+","+d+" "+(i+m)+","+(n+y)+" "+i+","+n)}e.push("z");let oe;(oe=this.tail)==null||oe.setAttribute("d",e.join(" "))}bringToFront(){let e;const i=(e=this.svgRoot)==null?void 0:e.parentNode;return this.svgRoot&&(i==null?void 0:i.lastChild)!==this.svgRoot?(i==null||i.appendChild(this.svgRoot),!0):!1}getRelativeToSurfaceXY(){return new te(this.workspace.RTL?-this.relativeLeft+this.anchor.x-this.size.width:this.anchor.x+this.relativeLeft,this.anchor.y+this.relativeTop)}getSvgRoot(){return this.svgRoot}moveDuringDrag(e){this.moveTo(e.x,e.y),this.relativeLeft=this.workspace.RTL?this.anchor.x-e.x-this.size.width:e.x-this.anchor.x,this.relativeTop=e.y-this.anchor.y,this.renderTail()}setDragging(e){}setDeleteStyle(e){}isDeletable(){return!1}showContextMenu(e){}isMovable(){return!0}startDrag(){this.dragStrategy.startDrag()}drag(e){this.dragStrategy.drag(e)}endDrag(){this.dragStrategy.endDrag()}revertDrag(){this.dragStrategy.revertDrag()}select(){}unselect(){}};$s=Ge,Ge.BORDER_WIDTH=6,Ge.DOUBLE_BORDER=2*$s.BORDER_WIDTH,Ge.MIN_SIZE=$s.DOUBLE_BORDER,Ge.TAIL_THICKNESS=1,Ge.TAIL_ANGLE=20,Ge.TAIL_BEND=4,Ge.ANCHOR_RADIUS=8;var Pi=class extends Ge{constructor(e,i,n,c){super(i,n,c),this.workspace=i,this.anchor=n,this.ownerRect=c,this.autoLayout=!0,i=new As(e),this.validateWorkspaceOptions(i),this.svgDialog=Y(U.SVG,{x:Ge.BORDER_WIDTH,y:Ge.BORDER_WIDTH},this.contentContainer),e.parentWorkspace=this.workspace,this.miniWorkspace=this.newWorkspaceSvg(new As(e)),this.miniWorkspace.internalIsMutator=!0,e=this.miniWorkspace.createDom("blocklyMutatorBackground"),this.svgDialog.appendChild(e),i.languageTree&&(e.insertBefore(this.miniWorkspace.addFlyout(U.G),this.miniWorkspace.getCanvas()),e=this.miniWorkspace.getFlyout(),e==null||e.init(this.miniWorkspace),e==null||e.show(i.languageTree)),this.miniWorkspace.addChangeListener(this.onWorkspaceChange.bind(this));let d,m;(d=this.miniWorkspace.getFlyout())==null||(m=d.getWorkspace())==null||m.addChangeListener(this.onWorkspaceChange.bind(this)),this.updateBubbleSize()}dispose(){this.miniWorkspace.dispose(),super.dispose()}getWorkspace(){return this.miniWorkspace}addWorkspaceChangeListener(e){this.miniWorkspace.addChangeListener(e)}validateWorkspaceOptions(e){if(e.hasCategories)throw Error("The miniworkspace bubble does not support toolboxes with categories");if(e.hasTrashcan)throw Error("The miniworkspace bubble does not support trashcans");if(e.zoomOptions.controls||e.zoomOptions.wheel||e.zoomOptions.pinch)throw Error("The miniworkspace bubble does not support zooming");if(e.moveOptions.scrollbars||e.moveOptions.wheel||e.moveOptions.drag)throw Error("The miniworkspace bubble does not scrolling/moving the workspace");if(e.horizontalLayout)throw Error("The miniworkspace bubble does not support horizontal layouts")}onWorkspaceChange(){this.bumpBlocksIntoBounds(),this.updateBubbleSize()}bumpBlocksIntoBounds(){if(!this.miniWorkspace.isDragging())for(const e of this.miniWorkspace.getTopBlocks(!1)){const i=e.getRelativeToSurfaceXY();if(20>i.y&&e.moveBy(0,20-i.y),e.RTL){let n=-20;const c=this.miniWorkspace.getFlyout();c&&(n-=c.getWidth()),i.x>n&&e.moveBy(n-i.x,0)}else 20>i.x&&e.moveBy(20-i.x,0)}}updateBubbleSize(){if(!this.miniWorkspace.isDragging()){var e=this.getSize(),i=this.calculateWorkspaceSize();Math.abs(e.width-i.width)<Pi.MINIMUM_VIEW_CHANGE&&Math.abs(e.height-i.height)<Pi.MINIMUM_VIEW_CHANGE||(this.svgDialog.setAttribute("width",`${i.width}px`),this.svgDialog.setAttribute("height",`${i.height}px`),this.miniWorkspace.setCachedParentSvgSize(i.width,i.height),this.miniWorkspace.RTL&&this.miniWorkspace.getCanvas().setAttribute("transform",`translate(${i.width}, 0)`),this.setSize(new Oe(i.width+Ge.DOUBLE_BORDER,i.height+Ge.DOUBLE_BORDER),this.autoLayout),this.miniWorkspace.resize(),this.miniWorkspace.recordDragTargets())}}calculateWorkspaceSize(){var e=this.miniWorkspace.getCanvas().getBBox();let i=e.width+Pi.MARGIN;e=e.height+Pi.MARGIN;const n=this.miniWorkspace.getFlyout();if(n){const c=n.getWorkspace().getMetricsManager().getScrollMetrics();e=Math.max(e,c.height+20),i+=n.getWidth()}return new Oe(i,e)}updateBlockStyles(){for(var e of this.miniWorkspace.getAllBlocks(!1))e.setStyle(e.getStyleName());let i;if(e=(i=this.miniWorkspace.getFlyout())==null?void 0:i.getWorkspace())for(const n of e.getAllBlocks(!1))n.setStyle(n.getStyleName())}moveDuringDrag(e){super.moveDuringDrag(e),this.autoLayout=!1}moveTo(e,i){super.moveTo(e,i),this.miniWorkspace.recordDragTargets()}newWorkspaceSvg(e){throw Error("The implementation of newWorkspaceSvg should be monkey-patched in by blockly.ts")}};Pi.MINIMUM_VIEW_CHANGE=10,Pi.MARGIN=3*Ge.DOUBLE_BORDER;var cc=class{constructor(e){this.sourceBlock=e,this.offsetInBlock=new te(0,0),this.workspaceLocation=new te(0,0),this.svgRoot=null,this.tooltip=e}getType(){throw Error("Icons must implement getType")}initView(e){if(!this.svgRoot){var i=this.sourceBlock;this.svgRoot=Y(U.G,{class:"blocklyIconGroup"}),i.getSvgRoot().appendChild(this.svgRoot),this.updateSvgRootOffset(),fe(this.svgRoot,"pointerdown",this,e),this.svgRoot.tooltip=this,En(this.svgRoot)}}dispose(){pa(this.svgRoot),F(this.svgRoot)}getWeight(){return-1}getSize(){return new Oe(0,0)}setTooltip(e){this.tooltip=e??this.sourceBlock}getTooltip(){return this.tooltip}applyColour(){}updateEditable(){}updateCollapsed(){this.svgRoot&&(this.sourceBlock.isCollapsed()?this.svgRoot.style.display="none":this.svgRoot.style.display="block",$n(this)&&this.setBubbleVisible(!1))}hideForInsertionMarker(){this.svgRoot&&(this.svgRoot.style.display="none")}isShownWhenCollapsed(){return!1}setOffsetInBlock(e){this.offsetInBlock=e,this.updateSvgRootOffset()}updateSvgRootOffset(){let e;(e=this.svgRoot)==null||e.setAttribute("transform",`translate(${this.offsetInBlock.x}, ${this.offsetInBlock.y})`)}onLocationChange(e){this.workspaceLocation=te.sum(e,this.offsetInBlock)}onClick(){}isClickableInFlyout(e){return!0}},hc,uc;hc=17,uc=16,s.MutatorIcon$$module$build$src$core$icons$mutator_icon=class extends cc{constructor(e,i){super(i),this.flyoutBlockTypes=e,this.sourceBlock=i,this.saveConnectionsListener=this.updateWorkspacePid=this.rootBlock=this.miniWorkspaceBubble=null}getType(){return s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE}initView(e){this.svgRoot||(super.initView(e),Y(U.RECT,{class:"blocklyIconShape",rx:"4",ry:"4",height:"16",width:"16"},this.svgRoot),Y(U.PATH,{class:"blocklyIconSymbol",d:"m4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 -0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z"},this.svgRoot),Y(U.CIRCLE,{class:"blocklyIconShape",r:"2.7",cx:"8",cy:"8"},this.svgRoot),re(this.svgRoot,"blockly-icon-mutator"))}dispose(){super.dispose();let e;(e=this.miniWorkspaceBubble)==null||e.dispose()}getWeight(){return s.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT}getSize(){return new Oe(hc,hc)}applyColour(){super.applyColour();let e;(e=this.miniWorkspaceBubble)==null||e.setColour(this.sourceBlock.getColour());let i;(i=this.miniWorkspaceBubble)==null||i.updateBlockStyles()}updateCollapsed(){super.updateCollapsed(),this.sourceBlock.isCollapsed()&&this.setBubbleVisible(!1)}onLocationChange(e){super.onLocationChange(e);let i;(i=this.miniWorkspaceBubble)==null||i.setAnchorLocation(this.getAnchorLocation())}onClick(){super.onClick(),this.sourceBlock.isEditable()&&this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.miniWorkspaceBubble}setBubbleVisible(e){const i=this;return q.asyncExecutePromiseGeneratorFunction(function*(){if(i.bubbleIsVisible()!==e){if(yield Gs(),e){i.miniWorkspaceBubble=new Pi(i.getMiniWorkspaceConfig(),i.sourceBlock.workspace,i.getAnchorLocation(),i.getBubbleOwnerRect()),i.applyColour(),i.createRootBlock(),i.addSaveConnectionsListener();let n;(n=i.miniWorkspaceBubble)==null||n.addWorkspaceChangeListener(i.createMiniWorkspaceChangeListener())}else{let n;(n=i.miniWorkspaceBubble)==null||n.dispose(),i.miniWorkspaceBubble=null,i.saveConnectionsListener&&i.sourceBlock.workspace.removeChangeListener(i.saveConnectionsListener),i.saveConnectionsListener=null}z(new(he(W.BUBBLE_OPEN))(i.sourceBlock,e,"mutator"))}})}getMiniWorkspaceConfig(){let e;const i={disable:!1,media:this.sourceBlock.workspace.options.pathToMedia,rtl:this.sourceBlock.RTL,renderer:this.sourceBlock.workspace.options.renderer,rendererOverrides:(e=this.sourceBlock.workspace.options.rendererOverrides)!=null?e:void 0};return this.flyoutBlockTypes.length&&(i.toolbox={kind:"flyoutToolbox",contents:this.flyoutBlockTypes.map(n=>({kind:"block",type:n}))}),i}getAnchorLocation(){const e=hc/2;return te.sum(this.workspaceLocation,new te(e,e))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Ve(e.y,e.y+e.height,e.x,e.x+e.width)}createRootBlock(){if(!this.sourceBlock.decompose)throw Error("Blocks with mutator icons must include a decompose method");this.rootBlock=this.sourceBlock.decompose(this.miniWorkspaceBubble.getWorkspace());for(var e of this.rootBlock.getDescendants(!1))e.queueRender();this.rootBlock.setMovable(!1),this.rootBlock.setDeletable(!1);let i,n,c,d;e=(d=(i=this.miniWorkspaceBubble)==null||(n=i.getWorkspace())==null||(c=n.getFlyout())==null?void 0:c.getWidth())!=null?d:0,this.rootBlock.moveBy(this.rootBlock.RTL?-(e+uc):uc,uc)}addSaveConnectionsListener(){this.sourceBlock.saveConnections&&this.rootBlock&&(this.saveConnectionsListener=()=>{this.sourceBlock.saveConnections&&this.rootBlock&&this.sourceBlock.saveConnections(this.rootBlock)},this.saveConnectionsListener(),this.sourceBlock.workspace.addChangeListener(this.saveConnectionsListener))}createMiniWorkspaceChangeListener(){return e=>{s.MutatorIcon$$module$build$src$core$icons$mutator_icon.isIgnorableMutatorEvent(e)||this.updateWorkspacePid||(this.updateWorkspacePid=setTimeout(()=>{this.updateWorkspacePid=null,this.recomposeSourceBlock()},0))}}static isIgnorableMutatorEvent(e){return e.isUiEvent||w(e)||C(e)&&e.element==="disabled"}recomposeSourceBlock(){if(this.rootBlock){if(!this.sourceBlock.compose)throw Error("Blocks with mutator icons must include a compose method");var e=s.getGroup$$module$build$src$core$events$utils();e||s.setGroup$$module$build$src$core$events$utils(!0);var i=Br.getExtraBlockState_(this.sourceBlock);this.sourceBlock.compose(this.rootBlock);var n=Br.getExtraBlockState_(this.sourceBlock);i!==n&&z(new(he(W.BLOCK_CHANGE))(this.sourceBlock,"mutation",null,i,n)),s.setGroup$$module$build$src$core$events$utils(e)}}getWorkspace(){let e;return(e=this.miniWorkspaceBubble)==null?void 0:e.getWorkspace()}},s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE=mt.MUTATOR,s.MutatorIcon$$module$build$src$core$icons$mutator_icon.WEIGHT=1,s.MutatorIcon$$module$build$src$core$icons$mutator_icon;var Gn=Object.create(null),hC={allExtensions:Gn};s.register$$module$build$src$core$extensions("parent_tooltip_when_inline",q_);var Ys={TEST_ONLY:hC};Ys.apply=va,Ys.buildTooltipForDropdown=s.buildTooltipForDropdown$$module$build$src$core$extensions,Ys.buildTooltipWithFieldText=s.buildTooltipWithFieldText$$module$build$src$core$extensions,Ys.isRegistered=Cu,Ys.register=s.register$$module$build$src$core$extensions,Ys.registerMixin=s.registerMixin$$module$build$src$core$extensions,Ys.registerMutator=s.registerMutator$$module$build$src$core$extensions,Ys.runAfterPageLoad=K_,Ys.unregister=V_;var Re;(function(e){e[e.WIN_KEY_FF_LINUX=0]="WIN_KEY_FF_LINUX",e[e.MAC_ENTER=3]="MAC_ENTER",e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.NUM_CENTER=12]="NUM_CENTER",e[e.ENTER=13]="ENTER",e[e.SHIFT=16]="SHIFT",e[e.CTRL=17]="CTRL",e[e.ALT=18]="ALT",e[e.PAUSE=19]="PAUSE",e[e.CAPS_LOCK=20]="CAPS_LOCK",e[e.ESC=27]="ESC",e[e.SPACE=32]="SPACE",e[e.PAGE_UP=33]="PAGE_UP",e[e.PAGE_DOWN=34]="PAGE_DOWN",e[e.END=35]="END",e[e.HOME=36]="HOME",e[e.LEFT=37]="LEFT",e[e.UP=38]="UP",e[e.RIGHT=39]="RIGHT",e[e.DOWN=40]="DOWN",e[e.PLUS_SIGN=43]="PLUS_SIGN",e[e.PRINT_SCREEN=44]="PRINT_SCREEN",e[e.INSERT=45]="INSERT",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.FF_SEMICOLON=59]="FF_SEMICOLON",e[e.FF_EQUALS=61]="FF_EQUALS",e[e.FF_DASH=173]="FF_DASH",e[e.FF_HASH=163]="FF_HASH",e[e.QUESTION_MARK=63]="QUESTION_MARK",e[e.AT_SIGN=64]="AT_SIGN",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.META=91]="META",e[e.WIN_KEY_RIGHT=92]="WIN_KEY_RIGHT",e[e.CONTEXT_MENU=93]="CONTEXT_MENU",e[e.NUM_ZERO=96]="NUM_ZERO",e[e.NUM_ONE=97]="NUM_ONE",e[e.NUM_TWO=98]="NUM_TWO",e[e.NUM_THREE=99]="NUM_THREE",e[e.NUM_FOUR=100]="NUM_FOUR",e[e.NUM_FIVE=101]="NUM_FIVE",e[e.NUM_SIX=102]="NUM_SIX",e[e.NUM_SEVEN=103]="NUM_SEVEN",e[e.NUM_EIGHT=104]="NUM_EIGHT",e[e.NUM_NINE=105]="NUM_NINE",e[e.NUM_MULTIPLY=106]="NUM_MULTIPLY",e[e.NUM_PLUS=107]="NUM_PLUS",e[e.NUM_MINUS=109]="NUM_MINUS",e[e.NUM_PERIOD=110]="NUM_PERIOD",e[e.NUM_DIVISION=111]="NUM_DIVISION",e[e.F1=112]="F1",e[e.F2=113]="F2",e[e.F3=114]="F3",e[e.F4=115]="F4",e[e.F5=116]="F5",e[e.F6=117]="F6",e[e.F7=118]="F7",e[e.F8=119]="F8",e[e.F9=120]="F9",e[e.F10=121]="F10",e[e.F11=122]="F11",e[e.F12=123]="F12",e[e.NUMLOCK=144]="NUMLOCK",e[e.SCROLL_LOCK=145]="SCROLL_LOCK",e[e.FIRST_MEDIA_KEY=166]="FIRST_MEDIA_KEY",e[e.LAST_MEDIA_KEY=183]="LAST_MEDIA_KEY",e[e.SEMICOLON=186]="SEMICOLON",e[e.DASH=189]="DASH",e[e.EQUALS=187]="EQUALS",e[e.COMMA=188]="COMMA",e[e.PERIOD=190]="PERIOD",e[e.SLASH=191]="SLASH",e[e.APOSTROPHE=192]="APOSTROPHE",e[e.TILDE=192]="TILDE",e[e.SINGLE_QUOTE=222]="SINGLE_QUOTE",e[e.OPEN_SQUARE_BRACKET=219]="OPEN_SQUARE_BRACKET",e[e.BACKSLASH=220]="BACKSLASH",e[e.CLOSE_SQUARE_BRACKET=221]="CLOSE_SQUARE_BRACKET",e[e.WIN_KEY=224]="WIN_KEY",e[e.MAC_FF_META=224]="MAC_FF_META",e[e.MAC_WK_CMD_LEFT=91]="MAC_WK_CMD_LEFT",e[e.MAC_WK_CMD_RIGHT=93]="MAC_WK_CMD_RIGHT",e[e.WIN_IME=229]="WIN_IME",e[e.VK_NONAME=252]="VK_NONAME",e[e.PHANTOM=255]="PHANTOM"})(Re||(Re={}));var Ni={};Ni.arc=ct,Ni.curve=as,Ni.line=In,Ni.lineOnAxis=ae,Ni.lineTo=ci,Ni.moveBy=Qe,Ni.moveTo=Tt,Ni.point=de;var rt={};rt.Coordinate=te,rt.KeyCodes=Re,rt.Rect=Ve,rt.Size=Oe,rt.Svg=U,rt.aria=Bo,rt.array=eT,rt.browserEvents=ki,rt.colour=Os,rt.deprecation=M$,rt.dom=Ct,rt.extensions=Ys,rt.idGenerator=Td,rt.math=Ka,rt.object=BT,rt.parsing=Yo,rt.string=Pn,rt.style=ir,rt.svgMath=Mr,rt.svgPaths=Ni,rt.toolbox=rr,rt.userAgent=qx,rt.xml=wn;var GT=class extends Ge{constructor(e,i,n){super(e,i,n),this.workspace=e,this.anchor=i,this.ownerRect=n,this.resizePointerMoveListener=this.resizePointerUpListener=null,this.textChangeListeners=[],this.sizeChangeListeners=[],this.text="",this.DEFAULT_SIZE=new Oe(160+Ge.DOUBLE_BORDER,80+Ge.DOUBLE_BORDER),this.MIN_SIZE=new Oe(45+Ge.DOUBLE_BORDER,20+Ge.DOUBLE_BORDER),this.editable=!0,re(this.svgRoot,"blocklyTextInputBubble"),{inputRoot:this.inputRoot,textArea:this.textArea}=this.createEditor(this.contentContainer),this.resizeGroup=this.createResizeHandle(this.svgRoot,e),this.setSize(this.DEFAULT_SIZE,!0)}getText(){return this.text}setText(e){this.text=e,this.textArea.value=e,this.onTextChange()}setEditable(e){(this.editable=e)?this.textArea.removeAttribute("readonly"):this.textArea.setAttribute("readonly","")}isEditable(){return this.editable}addTextChangeListener(e){this.textChangeListeners.push(e)}addSizeChangeListener(e){this.sizeChangeListeners.push(e)}createEditor(e){e=Y(U.FOREIGNOBJECT,{x:Ge.BORDER_WIDTH,y:Ge.BORDER_WIDTH},e);const i=document.createElementNS(ui,"body");i.setAttribute("xmlns",ui),i.className="blocklyMinimalBody";const n=document.createElementNS(ui,"textarea");return n.className="blocklyTextarea blocklyText",n.setAttribute("dir",this.workspace.RTL?"RTL":"LTR"),i.appendChild(n),e.appendChild(i),this.bindTextAreaEvents(n),setTimeout(()=>{n.focus()},0),{inputRoot:e,textArea:n}}bindTextAreaEvents(e){fe(e,"wheel",this,i=>{i.stopPropagation()}),fe(e,"focus",this,this.onStartEdit,!0),fe(e,"change",this,this.onTextChange)}createResizeHandle(e,i){return e=Y(U.IMAGE,{class:"blocklyResizeHandle",href:`${i.options.pathToMedia}resize-handle.svg`},e),fe(e,"pointerdown",this,this.onResizePointerDown),e}setSize(e,i=!1){e.width=Math.max(e.width,this.MIN_SIZE.width),e.height=Math.max(e.height,this.MIN_SIZE.height);const n=e.width-Ge.DOUBLE_BORDER,c=e.height-Ge.DOUBLE_BORDER;this.inputRoot.setAttribute("width",`${n}`),this.inputRoot.setAttribute("height",`${c}`),this.resizeGroup.setAttribute("y",`${c}`),this.workspace.RTL?this.resizeGroup.setAttribute("x",`${-Ge.DOUBLE_BORDER}`):this.resizeGroup.setAttribute("x",`${n}`),super.setSize(e,i),this.onSizeChange()}getSize(){return super.getSize()}onResizePointerDown(e){this.bringToFront(),Jt(e)||($a(this.workspace,e,new te(this.workspace.RTL?-this.getSize().width:this.getSize().width,this.getSize().height)),this.resizePointerUpListener=fe(document,"pointerup",this,this.onResizePointerUp),this.resizePointerMoveListener=fe(document,"pointermove",this,this.onResizePointerMove),this.workspace.hideChaff()),e.stopPropagation()}onResizePointerUp(e){It(),this.resizePointerUpListener&&(Ue(this.resizePointerUpListener),this.resizePointerUpListener=null),this.resizePointerMoveListener&&(Ue(this.resizePointerMoveListener),this.resizePointerMoveListener=null)}onResizePointerMove(e){e=Ta(this.workspace,e),this.setSize(new Oe(this.workspace.RTL?-e.x:e.x,e.y),!1),this.onSizeChange()}onStartEdit(){this.bringToFront()&&this.textArea.focus()}onTextChange(){this.text=this.textArea.value;for(const e of this.textChangeListeners)e()}onSizeChange(){for(const e of this.sizeChangeListeners)e()}};tt(`
.blocklyTextInputBubble .blocklyTextarea {
  background-color: var(--commentFillColour);
  border: 0;
  box-sizing: border-box;
  display: block;
  outline: 0;
  padding: 5px;
  resize: none;
  width: 100%;
  height: 100%;
}
`);var lp={};lp.register=ku,lp.unregister=J_;var ap=17,HT=160,VT=80,Di=class extends cc{constructor(e){super(e),this.sourceBlock=e,this.textInputBubble=null,this.text="",this.bubbleSize=new Oe(HT,VT),this.bubbleVisiblity=!1}getType(){return Di.TYPE}initView(e){this.svgRoot||(super.initView(e),Y(U.CIRCLE,{class:"blocklyIconShape",r:"8",cx:"8",cy:"8"},this.svgRoot),Y(U.PATH,{class:"blocklyIconSymbol",d:"m6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.4050.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25-1.201,0.998 -1.201,1.528 -1.204,2.19z"},this.svgRoot),Y(U.RECT,{class:"blocklyIconSymbol",x:"6.8",y:"10.78",height:"2",width:"2"},this.svgRoot),re(this.svgRoot,"blockly-icon-comment"))}dispose(){super.dispose();let e;(e=this.textInputBubble)==null||e.dispose()}getWeight(){return Di.WEIGHT}getSize(){return new Oe(ap,ap)}applyColour(){super.applyColour();const e=this.sourceBlock.getColour();let i;(i=this.textInputBubble)==null||i.setColour(e)}updateEditable(){const e=this,i=()=>super.updateEditable;return q.asyncExecutePromiseGeneratorFunction(function*(){i().call(e),e.bubbleIsVisible()&&(yield e.setBubbleVisible(!1),yield e.setBubbleVisible(!0))})}onLocationChange(e){super.onLocationChange(e),e=this.getAnchorLocation();let i;(i=this.textInputBubble)==null||i.setAnchorLocation(e)}setText(e){const i=this.text;z(new(he(W.BLOCK_CHANGE))(this.sourceBlock,"comment",null,i,e)),this.text=e;let n;(n=this.textInputBubble)==null||n.setText(this.text)}getText(){return this.text}setBubbleSize(e){this.bubbleSize=e;let i;(i=this.textInputBubble)==null||i.setSize(this.bubbleSize,!0)}getBubbleSize(){return this.bubbleSize}saveState(){return this.text?{text:this.text,pinned:this.bubbleIsVisible(),height:this.bubbleSize.height,width:this.bubbleSize.width}:null}loadState(e){let i;this.text=(i=e.text)!=null?i:"";let n,c;this.bubbleSize=new Oe((n=e.width)!=null?n:HT,(c=e.height)!=null?c:VT);let d;this.bubbleVisiblity=(d=e.pinned)!=null?d:!1,this.setBubbleVisible(this.bubbleVisiblity)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}onTextChange(){if(this.textInputBubble){var e=this.textInputBubble.getText();this.text!==e&&(z(new(he(W.BLOCK_CHANGE))(this.sourceBlock,"comment",null,this.text,e)),this.text=e)}}onSizeChange(){this.textInputBubble&&(this.bubbleSize=this.textInputBubble.getSize())}bubbleIsVisible(){return this.bubbleVisiblity}setBubbleVisible(e){const i=this;return q.asyncExecutePromiseGeneratorFunction(function*(){i.bubbleVisiblity!==e&&(i.bubbleVisiblity=e,yield Gs(),!i.sourceBlock.rendered||i.sourceBlock.isInFlyout||i.sourceBlock.isInsertionMarker()||(e?(i.sourceBlock.isEditable()?i.showEditableBubble():i.showNonEditableBubble(),i.applyColour()):i.hideBubble(),z(new(he(W.BUBBLE_OPEN))(i.sourceBlock,e,"comment"))))})}showEditableBubble(){this.createBubble();let e;(e=this.textInputBubble)==null||e.addTextChangeListener(()=>this.onTextChange());let i;(i=this.textInputBubble)==null||i.addSizeChangeListener(()=>this.onSizeChange())}showNonEditableBubble(){this.createBubble();let e;(e=this.textInputBubble)==null||e.setEditable(!1)}createBubble(){this.textInputBubble=new GT(this.sourceBlock.workspace,this.getAnchorLocation(),this.getBubbleOwnerRect()),this.textInputBubble.setText(this.getText()),this.textInputBubble.setSize(this.bubbleSize,!0)}hideBubble(){let e;(e=this.textInputBubble)==null||e.dispose(),this.textInputBubble=null}getAnchorLocation(){const e=ap/2;return te.sum(this.workspaceLocation,new te(e,e))}getBubbleOwnerRect(){return this.sourceBlock.getBoundingRectangleWithoutChildren()}};Di.TYPE=mt.COMMENT,Di.WEIGHT=3,ku(Di.TYPE,Di);var WT=class extends Error{constructor(e){super(`Tried to append an icon of type ${e.getType()} when an icon of that type already exists on the block. Use getIcon to access the existing icon.`),this.icon=e}},zT={};zT.DuplicateIconType=WT;var XT=class extends Ge{constructor(e,i,n,c){super(i,n,c),this.text=e,this.workspace=i,this.anchor=n,this.ownerRect=c,this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}getText(){return this.text}setText(e){this.text=e,F(this.paragraph),this.paragraph=this.stringToSvg(e,this.contentContainer),this.updateBubbleSize()}stringToSvg(e,i){return i=this.createParagraph(i),e=this.createTextFragments(i,e),this.workspace.RTL&&this.rightAlignTextFragments(i.getBBox().width,e),i}createParagraph(e){return Y(U.G,{class:"blocklyText blocklyBubbleText blocklyNoPointerEvents",transform:`translate(0,${Ge.BORDER_WIDTH})`,style:`direction: ${this.workspace.RTL?"rtl":"ltr"}`},e)}createTextFragments(e,i){let n=1;return i.split(`
`).map(c=>{const d=Y(U.TEXT,{y:`${n}em`,x:Ge.BORDER_WIDTH},e);return c=document.createTextNode(c),d.appendChild(c),n+=1,d})}rightAlignTextFragments(e,i){for(const n of i)n.setAttribute("text-anchor","start"),n.setAttribute("x",`${e+Ge.BORDER_WIDTH}`)}updateBubbleSize(){const e=this.paragraph.getBBox();this.setSize(new Oe(e.width+2*Ge.BORDER_WIDTH,e.height+2*Ge.BORDER_WIDTH),!0)}},cp=17,Bi=class extends cc{constructor(e){super(e),this.sourceBlock=e,this.textMap=new Map,this.textBubble=null}getType(){return Bi.TYPE}initView(e){this.svgRoot||(super.initView(e),Y(U.PATH,{class:"blocklyIconShape",d:"M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z"},this.svgRoot),Y(U.PATH,{class:"blocklyIconSymbol",d:"m7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z"},this.svgRoot),Y(U.RECT,{class:"blocklyIconSymbol",x:"7",y:"11",height:"2",width:"2"},this.svgRoot),re(this.svgRoot,"blockly-icon-warning"))}dispose(){super.dispose();let e;(e=this.textBubble)==null||e.dispose()}getWeight(){return Bi.WEIGHT}getSize(){return new Oe(cp,cp)}applyColour(){super.applyColour();let e;(e=this.textBubble)==null||e.setColour(this.sourceBlock.getColour())}updateCollapsed(){}isShownWhenCollapsed(){return!0}onLocationChange(e){super.onLocationChange(e);let i;(i=this.textBubble)==null||i.setAnchorLocation(this.getAnchorLocation())}addMessage(e,i){if(this.textMap.get(i)===e)return this;e?this.textMap.set(i,e):this.textMap.delete(i);let n;return(n=this.textBubble)==null||n.setText(this.getText()),this}getText(){return[...this.textMap.values()].join(`
`)}onClick(){super.onClick(),this.setBubbleVisible(!this.bubbleIsVisible())}isClickableInFlyout(){return!1}bubbleIsVisible(){return!!this.textBubble}setBubbleVisible(e){const i=this;return q.asyncExecutePromiseGeneratorFunction(function*(){if(i.bubbleIsVisible()!==e){if(yield Gs(),e)i.textBubble=new XT(i.getText(),i.sourceBlock.workspace,i.getAnchorLocation(),i.getBubbleOwnerRect()),i.applyColour();else{let n;(n=i.textBubble)==null||n.dispose(),i.textBubble=null}z(new(he(W.BUBBLE_OPEN))(i.sourceBlock,e,"warning"))}})}getAnchorLocation(){const e=cp/2;return te.sum(this.workspaceLocation,new te(e,e))}getBubbleOwnerRect(){const e=this.sourceBlock.getSvgRoot().getBBox();return new Ve(e.y,e.y+e.height,e.x,e.x+e.width)}};Bi.TYPE=mt.WARNING,Bi.WEIGHT=2;var ar={};ar.CommentIcon=Di,ar.Icon=cc,ar.IconType=mt,ar.MutatorIcon=s.MutatorIcon$$module$build$src$core$icons$mutator_icon,ar.WarningIcon=Bi,ar.exceptions=zT,ar.registry=lp,s.Names$$module$build$src$core$names=class{constructor(e,i){this.db=new Map,this.dbReverse=new Set,this.variableMap=null,this.variablePrefix=i||"",this.reservedWords=new Set(e?e.split(","):[])}reset(){this.db.clear(),this.dbReverse.clear(),this.variableMap=null}setVariableMap(e){this.variableMap=e}getNameForUserVariable(e){return this.variableMap?(e=this.variableMap.getVariableById(e))?e.name:null:(console.warn(`Deprecated call to Names.prototype.getName without defining a variable map. To fix, add the following code in your generator's init() function:
Blockly.YourGeneratorName.nameDB_.setVariableMap(workspace.getVariableMap());`),null)}populateVariables(e){e=s.allUsedVarModels$$module$build$src$core$variables(e);for(let i=0;i<e.length;i++)this.getName(e[i].getId(),s.NameType$$module$build$src$core$names.VARIABLE)}populateProcedures(e){throw Error("The implementation of populateProcedures should be monkey-patched in by blockly.ts")}getName(e,i){let n=e;i===s.NameType$$module$build$src$core$names.VARIABLE&&(e=this.getNameForUserVariable(e))&&(n=e),e=n.toLowerCase();const c=i===s.NameType$$module$build$src$core$names.VARIABLE||i===s.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"";this.db.has(i)||this.db.set(i,new Map);const d=this.db.get(i);return d.has(e)?c+d.get(e):(i=this.getDistinctName(n,i),d.set(e,i.substr(c.length)),i)}getUserNames(e){let i;return(e=(i=this.db.get(e))==null?void 0:i.keys())?Array.from(e):[]}getDistinctName(e,i){e=this.safeName(e);let n=null,c,d;for(;this.dbReverse.has(e+((c=n)!=null?c:""))||this.reservedWords.has(e+((d=n)!=null?d:""));)n=n?n+1:2;let m;return e+=(m=n)!=null?m:"",this.dbReverse.add(e),(i===s.NameType$$module$build$src$core$names.VARIABLE||i===s.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE?this.variablePrefix:"")+e}safeName(e){return e?(e=encodeURI(e.replace(/ /g,"_")).replace(/[^\w]/g,"_"),"0123456789".includes(e[0])&&(e="my_"+e)):e=s.Msg$$module$build$src$core$msg.UNNAMED_KEY||"unnamed",e}static equals(e,i){return e.toLowerCase()===i.toLowerCase()}},function(e){e=e.NameType||(e.NameType={}),e.DEVELOPER_VARIABLE="DEVELOPER_VARIABLE",e.VARIABLE="VARIABLE",e.PROCEDURE="PROCEDURE"}(s.Names$$module$build$src$core$names||(s.Names$$module$build$src$core$names={})),s.NameType$$module$build$src$core$names=s.Names$$module$build$src$core$names.NameType,s.Names$$module$build$src$core$names.DEVELOPER_VARIABLE_TYPE=s.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE,s.NameType$$module$build$src$core$names,s.Names$$module$build$src$core$names;var YT=class extends Map{constructor(){super()}set(e,i){return this.get(e)===i?this:(super.set(e,i),xa(i)&&i.startPublishing(),this)}delete(e){const i=this.get(e);return e=super.delete(e),e&&(xa(i)&&i.stopPublishing(),e)}clear(){if(this.size)for(const e of this.keys())this.delete(e)}add(e){return this.set(e.getId(),e)}getProcedures(){return[...this.values()]}},dc,ts;dc="PROCEDURE",s.DEFAULT_ARG$$module$build$src$core$procedures="x",ts={CATEGORY_NAME:dc,DEFAULT_ARG:s.DEFAULT_ARG$$module$build$src$core$procedures},ts.ObservableProcedureMap=YT,ts.allProcedures=Ca,ts.findLegalName=s.findLegalName$$module$build$src$core$procedures,ts.flyoutCategory=wa,ts.getCallers=Pu,ts.getDefinition=s.getDefinition$$module$build$src$core$procedures,ts.isNameUsed=Au,ts.isProcedureBlock=er,ts.mutateCallers=s.mutateCallers$$module$build$src$core$procedures,ts.mutatorOpenListener=Lu,ts.rename=s.rename$$module$build$src$core$procedures;var uC=class{constructor(){this.NONE=0,this.FIELD=1,this.HAT=2,this.ICON=4,this.SPACER=8,this.BETWEEN_ROW_SPACER=16,this.IN_ROW_SPACER=32,this.EXTERNAL_VALUE_INPUT=64,this.INPUT=128,this.INLINE_INPUT=256,this.STATEMENT_INPUT=512,this.CONNECTION=1024,this.PREVIOUS_CONNECTION=2048,this.NEXT_CONNECTION=4096,this.OUTPUT_CONNECTION=8192,this.CORNER=16384,this.LEFT_SQUARE_CORNER=32768,this.LEFT_ROUND_CORNER=65536,this.RIGHT_SQUARE_CORNER=131072,this.RIGHT_ROUND_CORNER=262144,this.JAGGED_EDGE=524288,this.ROW=1048576,this.TOP_ROW=2097152,this.BOTTOM_ROW=4194304,this.INPUT_ROW=8388608,this.LEFT_CORNER=this.LEFT_SQUARE_CORNER|this.LEFT_ROUND_CORNER,this.RIGHT_CORNER=this.RIGHT_SQUARE_CORNER|this.RIGHT_ROUND_CORNER,this.nextTypeValue_=16777216}getType(e){return Object.prototype.hasOwnProperty.call(this,e)||(this[e]=this.nextTypeValue_,this.nextTypeValue_<<=1),this[e]}isField(e){return e.type&this.FIELD}isHat(e){return e.type&this.HAT}isIcon(e){return e.type&this.ICON}isSpacer(e){return e.type&this.SPACER}isInRowSpacer(e){return e.type&this.IN_ROW_SPACER}isInput(e){return e.type&this.INPUT}isExternalInput(e){return e.type&this.EXTERNAL_VALUE_INPUT}isInlineInput(e){return e.type&this.INLINE_INPUT}isStatementInput(e){return e.type&this.STATEMENT_INPUT}isPreviousConnection(e){return e.type&this.PREVIOUS_CONNECTION}isNextConnection(e){return e.type&this.NEXT_CONNECTION}isPreviousOrNextConnection(e){return e.type&(this.PREVIOUS_CONNECTION|this.NEXT_CONNECTION)}isLeftRoundedCorner(e){return e.type&this.LEFT_ROUND_CORNER}isRightRoundedCorner(e){return e.type&this.RIGHT_ROUND_CORNER}isLeftSquareCorner(e){return e.type&this.LEFT_SQUARE_CORNER}isRightSquareCorner(e){return e.type&this.RIGHT_SQUARE_CORNER}isCorner(e){return e.type&this.CORNER}isJaggedEdge(e){return e.type&this.JAGGED_EDGE}isRow(e){return e.type&this.ROW}isBetweenRowSpacer(e){return e.type&this.BETWEEN_ROW_SPACER}isTopRow(e){return e.type&this.TOP_ROW}isBottomRow(e){return e.type&this.BOTTOM_ROW}isTopOrBottomRow(e){return e.type&(this.TOP_ROW|this.BOTTOM_ROW)}isInputRow(e){return e.type&this.INPUT_ROW}},N=new uC,di=class{constructor(e){this.centerline=this.xPos=this.height=this.width=0,this.constants_=e,this.type=N.NONE,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}},qo=class{constructor(e){this.elements=[],this.xPos=this.yPos=this.widthWithConnectedBlocks=this.minWidth=this.minHeight=this.width=this.height=0,this.hasStatement=this.hasExternalInput=!1,this.statementEdge=0,this.hasJaggedEdge=this.hasDummyInput=this.hasInlineInput=!1,this.align=null,this.constants_=e,this.type=N.ROW,this.notchOffset=this.constants_.NOTCH_OFFSET_LEFT}getLastInput(){for(let e=this.elements.length-1;0<=e;e--){const i=this.elements[e];if(N.isInput(i))return i}return null}measure(){throw Error("Unexpected attempt to measure a base Row.")}startsWithElemSpacer(){return!0}endsWithElemSpacer(){return!0}getFirstSpacer(){for(let e=0;e<this.elements.length;e++){const i=this.elements[e];if(N.isSpacer(i))return i}return null}getLastSpacer(){for(let e=this.elements.length-1;0<=e;e--){const i=this.elements[e];if(N.isSpacer(i))return i}return null}},hp=class extends qo{constructor(e){super(e),this.hasNextConnection=!1,this.connection=null,this.baseline=this.descenderHeight=0,this.type|=N.BOTTOM_ROW}hasLeftSquareCorner(e){return!!e.outputConnection||!!e.getNextBlock()}hasRightSquareCorner(e){return!0}measure(){let e=0,i=0,n=0;for(let c=0;c<this.elements.length;c++){const d=this.elements[c];i+=d.width,N.isSpacer(d)||(N.isNextConnection(d)?n=Math.max(n,d.height):e=Math.max(e,d.height))}this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+n,this.descenderHeight=n,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},Fi=class extends di{constructor(e,i){super(e),this.connectionModel=i,this.type|=N.CONNECTION,this.shape=this.constants_.shapeFor(i),this.isDynamicShape="isDynamic"in this.shape&&this.shape.isDynamic,this.highlighted=i.isHighlighted()}},cr=class extends Fi{constructor(e,i){super(e,i.connection),this.input=i,this.connectionOffsetY=this.connectionOffsetX=0,this.type|=N.INPUT,this.align=i.align,(this.connectedBlock=i.connection&&i.connection.targetBlock()?i.connection.targetBlock():null)?(e=this.connectedBlock.getHeightWidth(),this.connectedBlockWidth=e.width,this.connectedBlockHeight=e.height):this.connectedBlockHeight=this.connectedBlockWidth=0}},pc=class extends cr{constructor(e,i){super(e,i),this.height=0,this.type|=N.EXTERNAL_VALUE_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight-this.constants_.TAB_OFFSET_FROM_TOP-this.constants_.MEDIUM_PADDING:this.shape.height,this.width=this.shape.width+this.constants_.EXTERNAL_VALUE_INPUT_PADDING,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP,this.connectionHeight=this.shape.height,this.connectionWidth=this.shape.width}},Hn=class extends di{constructor(e,i,n){super(e),this.field=i,this.parentInput=n,this.isEditable=i.EDITABLE,this.flipRtl=i.getFlipRtl(),this.type|=N.FIELD,e=this.field.getSize(),this.height=e.height,this.width=e.width}},up=class extends di{constructor(e){super(e),this.type|=N.HAT,this.height=this.constants_.START_HAT.height,this.width=this.constants_.START_HAT.width,this.ascenderHeight=this.height}},KT=class extends di{constructor(e,i){super(e),this.icon=i,this.flipRtl=!1,this.type|=N.ICON,e=i.getSize(),this.height=e.height,this.width=e.width}},Ts=class extends di{constructor(e,i){super(e),this.type=this.type|N.SPACER|N.IN_ROW_SPACER,this.width=i,this.height=this.constants_.SPACER_DEFAULT_HEIGHT}},dp=class extends cr{constructor(e,i){super(e,i),this.type|=N.INLINE_INPUT,this.connectedBlock?(this.width=this.connectedBlockWidth,this.height=this.connectedBlockHeight):(this.height=this.constants_.EMPTY_INLINE_INPUT_HEIGHT,this.width=this.constants_.EMPTY_INLINE_INPUT_PADDING),this.connectionHeight=this.isDynamicShape?this.shape.height(this.height):this.shape.height,this.connectionWidth=this.isDynamicShape?this.shape.width(this.height):this.shape.width,this.connectedBlock||(this.width+=this.connectionWidth*(this.isDynamicShape?2:1)),this.connectionOffsetY="connectionOffsetY"in this.shape?this.shape.connectionOffsetY(this.connectionHeight):this.constants_.TAB_OFFSET_FROM_TOP,this.connectionOffsetX="connectionOffsetX"in this.shape?this.shape.connectionOffsetX(this.connectionWidth):0}},Jo=class extends cr{constructor(e,i){super(e,i),this.type|=N.STATEMENT_INPUT,this.height=this.connectedBlock?this.connectedBlockHeight+this.constants_.STATEMENT_BOTTOM_SPACER:this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT,this.width=this.constants_.STATEMENT_INPUT_NOTCH_OFFSET+this.shape.width}},pp=class extends qo{constructor(e){super(e),this.connectedBlockWidths=0,this.type|=N.INPUT_ROW}measure(){this.width=this.minWidth,this.height=this.minHeight;let e=0;for(let i=0;i<this.elements.length;i++){const n=this.elements[i];this.width+=n.width,N.isInput(n)&&n instanceof cr&&(N.isStatementInput(n)&&n instanceof Jo?e+=n.connectedBlockWidth:N.isExternalInput(n)&&n instanceof pc&&n.connectedBlockWidth!==0&&(e+=n.connectedBlockWidth-n.connectionWidth)),N.isSpacer(n)||(this.height=Math.max(this.height,n.height))}this.connectedBlockWidths=e,this.widthWithConnectedBlocks=this.width+e}endsWithElemSpacer(){return!this.hasExternalInput&&!this.hasStatement}},jT=class extends di{constructor(e){super(e),this.type|=N.JAGGED_EDGE,this.height=this.constants_.JAGGED_TEETH.height,this.width=this.constants_.JAGGED_TEETH.width}},qT=class extends Fi{constructor(e,i){super(e,i),this.type|=N.NEXT_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},JT=class extends Fi{constructor(e,i){super(e,i),this.connectionOffsetX=0,this.type|=N.OUTPUT_CONNECTION,this.height=this.isDynamicShape?0:this.shape.height,this.startX=this.width=this.isDynamicShape?0:this.shape.width,this.connectionOffsetY=this.constants_.TAB_OFFSET_FROM_TOP}},ZT=class extends Fi{constructor(e,i){super(e,i),this.type|=N.PREVIOUS_CONNECTION,this.height=this.shape.height,this.width=this.shape.width}},Zo=class extends di{constructor(e,i){super(e),this.type=(i&&i!=="left"?N.RIGHT_ROUND_CORNER:N.LEFT_ROUND_CORNER)|N.CORNER,this.width=this.constants_.CORNER_RADIUS,this.height=this.constants_.CORNER_RADIUS/2}},fp=class extends qo{constructor(e,i,n){super(e),this.height=i,this.width=n,this.precedesStatement=this.followsStatement=!1,this.widthWithConnectedBlocks=0,this.type=this.type|N.SPACER|N.BETWEEN_ROW_SPACER,this.elements=[new Ts(this.constants_,n)]}measure(){}},Qo=class extends di{constructor(e,i){super(e),this.type=(i&&i!=="left"?N.RIGHT_SQUARE_CORNER:N.LEFT_SQUARE_CORNER)|N.CORNER,this.width=this.height=this.constants_.NO_PADDING}},gp=class extends qo{constructor(e){super(e),this.ascenderHeight=this.capline=0,this.hasPreviousConnection=!1,this.connection=null,this.type|=N.TOP_ROW}hasLeftSquareCorner(e){const i=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection,n=e.getPreviousBlock();return!!e.outputConnection||i||(n?n.getNextBlock()===e:!1)}hasRightSquareCorner(e){return!0}measure(){let e=0,i=0,n=0;for(let c=0;c<this.elements.length;c++){const d=this.elements[c];i+=d.width,N.isSpacer(d)||(N.isHat(d)&&d instanceof up?n=Math.max(n,d.ascenderHeight):e=Math.max(e,d.height))}this.width=Math.max(this.minWidth,i),this.height=Math.max(this.minHeight,e)+n,this.capline=this.ascenderHeight=n,this.widthWithConnectedBlocks=this.width}startsWithElemSpacer(){return!1}endsWithElemSpacer(){return!1}},fc=class{constructor(){this.NO_PADDING=0,this.SMALL_PADDING=3,this.MEDIUM_PADDING=5,this.MEDIUM_LARGE_PADDING=8,this.LARGE_PADDING=10,this.TAB_HEIGHT=15,this.TAB_OFFSET_FROM_TOP=5,this.TAB_VERTICAL_OVERLAP=2.5,this.TAB_WIDTH=8,this.NOTCH_WIDTH=15,this.NOTCH_HEIGHT=4,this.MIN_BLOCK_WIDTH=12,this.EMPTY_BLOCK_SPACER_HEIGHT=16,this.CORNER_RADIUS=8,this.NOTCH_OFFSET_LEFT=15,this.STATEMENT_BOTTOM_SPACER=0,this.STATEMENT_INPUT_PADDING_LEFT=20,this.BETWEEN_STATEMENT_PADDING_Y=4,this.ADD_START_HATS=!1,this.START_HAT_HEIGHT=15,this.START_HAT_WIDTH=100,this.SPACER_DEFAULT_HEIGHT=15,this.MIN_BLOCK_HEIGHT=24,this.EMPTY_INLINE_INPUT_PADDING=14.5,this.EXTERNAL_VALUE_INPUT_PADDING=2,this.JAGGED_TEETH_HEIGHT=12,this.JAGGED_TEETH_WIDTH=6,this.FIELD_TEXT_FONTSIZE=11,this.FIELD_TEXT_FONTWEIGHT="normal",this.FIELD_TEXT_FONTFAMILY="sans-serif",this.FIELD_TEXT_BASELINE=this.FIELD_TEXT_HEIGHT=-1,this.FIELD_BORDER_RECT_RADIUS=4,this.FIELD_BORDER_RECT_HEIGHT=16,this.FIELD_BORDER_RECT_X_PADDING=5,this.FIELD_BORDER_RECT_Y_PADDING=3,this.FIELD_BORDER_RECT_COLOUR="#fff",this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!1,this.FIELD_DROPDOWN_SVG_ARROW_SIZE=12,this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=!1,this.FIELD_COLOUR_DEFAULT_WIDTH=26,this.defs=null,this.embossFilterId="",this.embossFilter=null,this.disabledPatternId="",this.disabledPattern=null,this.debugFilterId="",this.cssNode=this.debugFilter=null,this.CURSOR_COLOUR="#cc0a0a",this.MARKER_COLOUR="#4286f4",this.CURSOR_WS_WIDTH=100,this.WS_CURSOR_HEIGHT=5,this.CURSOR_STACK_PADDING=10,this.CURSOR_BLOCK_PADDING=2,this.CURSOR_STROKE_WIDTH=4,this.FULL_BLOCK_FIELDS=!1,this.INSERTION_MARKER_COLOUR="#000000",this.INSERTION_MARKER_OPACITY=.2,this.SHAPES={PUZZLE:1,NOTCH:2},this.TALL_INPUT_FIELD_OFFSET_Y=this.MEDIUM_PADDING,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=this.DUMMY_INPUT_MIN_HEIGHT=this.TAB_HEIGHT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT,this.TOP_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.MEDIUM_PADDING,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.EMPTY_INLINE_INPUT_HEIGHT=this.TAB_HEIGHT+11,this.EMPTY_STATEMENT_INPUT_HEIGHT=this.MIN_BLOCK_HEIGHT,this.START_POINT=Qe(0,0),this.FIELD_TEXT_BASELINE_CENTER=!0,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_DROPDOWN_SVG_ARROW_DATAURI="data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaGVpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLWFycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuNDEsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTDAuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNzFDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMCwxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNzlhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYzAuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMzdBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=",this.FIELD_COLOUR_DEFAULT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT,this.FIELD_CHECKBOX_X_OFFSET=this.FIELD_BORDER_RECT_X_PADDING-3,this.randomIdentifier=String(Math.random()).substring(2)}init(){this.JAGGED_TEETH=this.makeJaggedTeeth(),this.NOTCH=this.makeNotch(),this.START_HAT=this.makeStartHat(),this.PUZZLE_TAB=this.makePuzzleTab(),this.INSIDE_CORNERS=this.makeInsideCorners(),this.OUTSIDE_CORNERS=this.makeOutsideCorners()}setTheme(e){this.blockStyles=Object.create(null);const i=e.blockStyles;for(const n in i)this.blockStyles[n]=this.validatedBlockStyle_(i[n]);this.setDynamicProperties_(e)}setDynamicProperties_(e){this.setFontConstants_(e),this.setComponentConstants_(e),this.ADD_START_HATS=e.startHats!==void 0?e.startHats:this.ADD_START_HATS}setFontConstants_(e){e.fontStyle&&e.fontStyle.family&&(this.FIELD_TEXT_FONTFAMILY=e.fontStyle.family),e.fontStyle&&e.fontStyle.weight&&(this.FIELD_TEXT_FONTWEIGHT=e.fontStyle.weight),e.fontStyle&&e.fontStyle.size&&(this.FIELD_TEXT_FONTSIZE=e.fontStyle.size),e=I("Hg",this.FIELD_TEXT_FONTSIZE+"pt",this.FIELD_TEXT_FONTWEIGHT,this.FIELD_TEXT_FONTFAMILY),this.FIELD_TEXT_HEIGHT=e.height,this.FIELD_TEXT_BASELINE=e.baseline}setComponentConstants_(e){this.CURSOR_COLOUR=e.getComponentStyle("cursorColour")||this.CURSOR_COLOUR,this.MARKER_COLOUR=e.getComponentStyle("markerColour")||this.MARKER_COLOUR,this.INSERTION_MARKER_COLOUR=e.getComponentStyle("insertionMarkerColour")||this.INSERTION_MARKER_COLOUR,this.INSERTION_MARKER_OPACITY=Number(e.getComponentStyle("insertionMarkerOpacity"))||this.INSERTION_MARKER_OPACITY}getBlockStyleForColour(e){const i="auto_"+e;return this.blockStyles[i]||(this.blockStyles[i]=this.createBlockStyle_(e)),{style:this.blockStyles[i],name:i}}getBlockStyle(e){return this.blockStyles[e||""]||(e&&e.startsWith("auto_")?this.getBlockStyleForColour(e.substring(5)).style:this.createBlockStyle_("#000000"))}createBlockStyle_(e){return this.validatedBlockStyle_({colourPrimary:e})}validatedBlockStyle_(e){const i={};return e&&Object.assign(i,e),e=yn(i.colourPrimary||"#000"),i.colourPrimary=e.hex,i.colourSecondary=i.colourSecondary?yn(i.colourSecondary).hex:this.generateSecondaryColour_(i.colourPrimary),i.colourTertiary=i.colourTertiary?yn(i.colourTertiary).hex:this.generateTertiaryColour_(i.colourPrimary),i.hat=i.hat||"",i}generateSecondaryColour_(e){return Ir("#fff",e,.6)||e}generateTertiaryColour_(e){return Ir("#fff",e,.3)||e}dispose(){this.embossFilter&&F(this.embossFilter),this.disabledPattern&&F(this.disabledPattern),this.debugFilter&&F(this.debugFilter),this.cssNode=null}makeJaggedTeeth(){const e=this.JAGGED_TEETH_HEIGHT,i=this.JAGGED_TEETH_WIDTH,n=In([de(i,e/4),de(2*-i,e/2),de(i,e/4)]);return{height:e,width:i,path:n}}makeStartHat(){const e=this.START_HAT_HEIGHT,i=this.START_HAT_WIDTH,n=as("c",[de(30,-e),de(70,-e),de(i,0)]);return{height:e,width:i,path:n}}makePuzzleTab(){function e(m){m=m?-1:1;const y=-m;var O=n/2;const K=O+2.5,oe=O+.5,Ze=de(-i,m*O);return O=de(i,m*O),as("c",[de(0,m*K),de(-i,y*oe),Ze])+as("s",[de(i,2.5*y),O])}const i=this.TAB_WIDTH,n=this.TAB_HEIGHT,c=e(!0),d=e(!1);return{type:this.SHAPES.PUZZLE,width:i,height:n,pathDown:d,pathUp:c}}makeNotch(){function e(y){return In([de(y*c,n),de(3*y,0),de(y*c,-n)])}const i=this.NOTCH_WIDTH,n=this.NOTCH_HEIGHT,c=(i-3)/2,d=e(1),m=e(-1);return{type:this.SHAPES.NOTCH,width:i,height:n,pathLeft:d,pathRight:m}}makeInsideCorners(){const e=this.CORNER_RADIUS,i=ct("a","0 0,0",e,de(-e,e)),n=ct("a","0 0,0",e,de(e,e));return{width:e,height:e,pathTop:i,pathBottom:n}}makeOutsideCorners(){const e=this.CORNER_RADIUS,i=Qe(0,e)+ct("a","0 0,1",e,de(e,-e)),n=ct("a","0 0,1",e,de(e,e)),c=ct("a","0 0,1",e,de(-e,-e)),d=ct("a","0 0,1",e,de(-e,e));return{topLeft:i,topRight:n,bottomRight:d,bottomLeft:c,rightHeight:e}}shapeFor(e){switch(e.type){case le.INPUT_VALUE:case le.OUTPUT_VALUE:return this.PUZZLE_TAB;case le.PREVIOUS_STATEMENT:case le.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown connection type")}}createDom(e,i,n){this.injectCSS_(i,n),this.defs=Y(U.DEFS,{},e),e=Y(U.FILTER,{id:"blocklyEmbossFilter"+this.randomIdentifier},this.defs),Y(U.FEGAUSSIANBLUR,{in:"SourceAlpha",stdDeviation:1,result:"blur"},e),i=Y(U.FESPECULARLIGHTING,{in:"blur",surfaceScale:1,specularConstant:.5,specularExponent:10,"lighting-color":"white",result:"specOut"},e),Y(U.FEPOINTLIGHT,{x:-5e3,y:-1e4,z:2e4},i),Y(U.FECOMPOSITE,{in:"specOut",in2:"SourceAlpha",operator:"in",result:"specOut"},e),Y(U.FECOMPOSITE,{in:"SourceGraphic",in2:"specOut",operator:"arithmetic",k1:0,k2:1,k3:1,k4:0},e),this.embossFilterId=e.id,this.embossFilter=e,e=Y(U.PATTERN,{id:"blocklyDisabledPattern"+this.randomIdentifier,patternUnits:"userSpaceOnUse",width:10,height:10},this.defs),Y(U.RECT,{width:10,height:10,fill:"#aaa"},e),Y(U.PATH,{d:"M 0 0 L 10 10 M 10 0 L 0 10",stroke:"#cc0"},e),this.disabledPatternId=e.id,this.disabledPattern=e,this.createDebugFilter()}createDebugFilter(){if(!this.debugFilter){const e=Y(U.FILTER,{id:"blocklyDebugFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},this.defs),i=Y(U.FECOMPONENTTRANSFER,{result:"outBlur"},e);Y(U.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),Y(U.FEFLOOD,{"flood-color":"#ff0000","flood-opacity":.5,result:"outColor"},e),Y(U.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),this.debugFilterId=e.id,this.debugFilter=e}}injectCSS_(e,i){i=this.getCSS_(i),e="blockly-renderer-style-"+e,this.cssNode=document.getElementById(e);const n=i.join(`
`);this.cssNode?this.cssNode.firstChild.textContent=n:(i=document.createElement("style"),i.id=e,e=document.createTextNode(n),i.appendChild(e),document.head.insertBefore(i,document.head.firstChild),this.cssNode=i)}getCSS_(e){return[`${e} .blocklyText, `,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect,`,`${e} .blocklyEditableText>rect {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"fill-opacity: .6;","stroke: none;","}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text {`,"fill: #000;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #000;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #000;","}",`${e} .blocklyEditableText:not(.editing):hover>rect {`,"stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"}",`${e} .blocklySelected>.blocklyPath {`,"stroke: #fc3;","stroke-width: 3px;","}",`${e} .blocklyHighlightedConnectionPath {`,"stroke: #fc3;","}",`${e} .blocklyReplaceable .blocklyPath {`,"fill-opacity: .5;","}",`${e} .blocklyReplaceable .blocklyPathLight,`,`${e} .blocklyReplaceable .blocklyPathDark {`,"display: none;","}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},gc=class{constructor(e,i){this.inlinePath_=this.outlinePath_="",this.block_=e,this.info_=i,this.topLeft_=e.getRelativeToSurfaceXY(),this.constants_=i.getRenderer().getConstants()}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),this.block_.pathObject.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&this.block_.pathObject.flipRTL(),this.recordSizeOnBlock_()}recordSizeOnBlock_(){this.block_.height=this.info_.height,this.block_.width=this.info_.widthWithChildren,this.block_.childlessWidth=this.info_.width}drawOutline_(){this.drawTop_();for(let e=1;e<this.info_.rows.length-1;e++){const i=this.info_.rows[e];i.hasJaggedEdge?this.drawJaggedEdge_(i):i.hasStatement?this.drawStatementInput_(i):i.hasExternalInput?this.drawValueInput_(i):this.drawRightSideRow_(i)}this.drawBottom_(),this.drawLeft_()}drawTop_(){const e=this.info_.topRow,i=e.elements;this.positionPreviousConnection_(),this.outlinePath_+=Qe(e.xPos,this.info_.startY);for(let n=0,c;c=i[n];n++)N.isLeftRoundedCorner(c)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topLeft:N.isRightRoundedCorner(c)?this.outlinePath_+=this.constants_.OUTSIDE_CORNERS.topRight:N.isPreviousConnection(c)&&c instanceof Fi?this.outlinePath_+=c.shape.pathLeft:N.isHat(c)?this.outlinePath_+=this.constants_.START_HAT.path:N.isSpacer(c)&&(this.outlinePath_+=ae("h",c.width));this.outlinePath_+=ae("v",e.height)}drawJaggedEdge_(e){this.outlinePath_+=this.constants_.JAGGED_TEETH.path+ae("v",e.height-this.constants_.JAGGED_TEETH.height)}drawValueInput_(e){const i=e.getLastInput();this.positionExternalValueConnection_(e);const n=Ra(i.shape)?i.shape.pathDown(i.height):i.shape.pathDown;this.outlinePath_+=ae("H",i.xPos+i.width)+n+ae("v",e.height-i.connectionHeight)}drawStatementInput_(e){var i=e.getLastInput();if(i){var n=i.xPos+i.notchOffset+i.shape.width;i=i.shape.pathRight+ae("h",-(i.notchOffset-this.constants_.INSIDE_CORNERS.width))+this.constants_.INSIDE_CORNERS.pathTop;var c=e.height-2*this.constants_.INSIDE_CORNERS.height;this.outlinePath_+=ae("H",n)+i+ae("v",c)+this.constants_.INSIDE_CORNERS.pathBottom+ae("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}}drawRightSideRow_(e){this.outlinePath_+=ae("V",e.yPos+e.height)}drawBottom_(){const e=this.info_.bottomRow,i=e.elements;this.positionNextConnection_();let n=0,c="";for(let d=i.length-1,m;m=i[d];d--)N.isNextConnection(m)&&m instanceof Fi?c+=m.shape.pathRight:N.isLeftSquareCorner(m)?c+=ae("H",e.xPos):N.isLeftRoundedCorner(m)?c+=this.constants_.OUTSIDE_CORNERS.bottomLeft:N.isRightRoundedCorner(m)?(c+=this.constants_.OUTSIDE_CORNERS.bottomRight,n=this.constants_.OUTSIDE_CORNERS.rightHeight):N.isSpacer(m)&&(c+=ae("h",-1*m.width));this.outlinePath_+=ae("V",e.baseline-n),this.outlinePath_+=c}drawLeft_(){var e=this.info_.outputConnection;if(this.positionOutputConnection_(),e){const i=e.connectionOffsetY+e.height;e=Ra(e.shape)?e.shape.pathUp(e.height):e.shape.pathUp,this.outlinePath_+=ae("V",i)+e}this.outlinePath_+="z"}drawInternals_(){for(let e=0,i;i=this.info_.rows[e];e++)for(let n=0,c;c=i.elements[n];n++)N.isInlineInput(c)?this.drawInlineInput_(c):(N.isIcon(c)||N.isField(c))&&this.layoutField_(c)}layoutField_(e){const i=e.centerline-e.height/2;let n=e.xPos;var c="";this.info_.RTL&&(n=-(n+e.width),e.flipRtl&&(n+=e.width,c="scale(-1 1)")),N.isIcon(e)?(c=e.icon,c.setOffsetInBlock(new te(n,i)),this.info_.isInsertionMarker&&c.hideForInsertionMarker()):(e=e.field.getSvgRoot(),e.setAttribute("transform","translate("+n+","+i+")"+c),this.info_.isInsertionMarker&&e.setAttribute("display","none"))}drawInlineInput_(e){const i=e.width,n=e.height,c=e.connectionOffsetY,d=e.connectionHeight+c;this.inlinePath_+=Tt(e.xPos+e.connectionWidth,e.centerline-n/2)+ae("v",c)+e.shape.pathDown+ae("v",n-d)+ae("h",i-e.connectionWidth)+ae("v",-n)+"z",this.positionInlineInputConnection_(e)}positionInlineInputConnection_(e){const i=e.centerline-e.height/2;if(e.connectionModel){let n=e.xPos+e.connectionWidth+e.connectionOffsetX;this.info_.RTL&&(n*=-1),e.connectionModel.setOffsetInBlock(n,i+e.connectionOffsetY)}}positionStatementInputConnection_(e){const i=e.getLastInput();if(i!=null&&i.connectionModel){let n=e.xPos+e.statementEdge+i.notchOffset;this.info_.RTL&&(n*=-1),i.connectionModel.setOffsetInBlock(n,e.yPos)}}positionExternalValueConnection_(e){const i=e.getLastInput();if(i&&i.connectionModel){let n=e.xPos+e.width;this.info_.RTL&&(n*=-1),i.connectionModel.setOffsetInBlock(n,e.yPos)}}positionPreviousConnection_(){const e=this.info_.topRow;if(e.connection){const i=e.xPos+e.notchOffset;e.connection.connectionModel.setOffsetInBlock(this.info_.RTL?-i:i,0)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const i=e.connection,n=i.xPos;i.connectionModel.setOffsetInBlock(this.info_.RTL?-n:n,e.baseline)}}positionOutputConnection_(){if(this.info_.outputConnection){const e=this.info_.startX+this.info_.outputConnection.connectionOffsetX;this.block_.outputConnection.setOffsetInBlock(this.info_.RTL?-e:e,this.info_.outputConnection.connectionOffsetY)}}updateConnectionHighlights(){for(const e of this.info_.rows)for(const i of e.elements)if(i instanceof Fi)if(i.highlighted)this.drawConnectionHighlightPath(i);else{let n,c;(c=(n=this.block_.pathObject).removeConnectionHighlight)==null||c.call(n,i.connectionModel)}}drawConnectionHighlightPath(e){const i=e.connectionModel;e=i.type===le.INPUT_VALUE||i.type===le.OUTPUT_VALUE?this.getExpressionConnectionHighlightPath(e):this.getStatementConnectionHighlightPath(e);const n=i.getSourceBlock();let c,d;(d=(c=n.pathObject).addConnectionHighlight)==null||d.call(c,i,e,i.getOffsetInBlock(),n.RTL)}getExpressionConnectionHighlightPath(e){let i="";return Ra(e.shape)?i=e.shape.pathDown(e.height):t$(e.shape)&&(i=e.shape.pathDown),e=this.constants_.TAB_OFFSET_FROM_TOP,Qe(0,-e)+ae("v",e)+i+ae("v",e)}getStatementConnectionHighlightPath(e){if(!s$(e.shape))throw Error("Statement connections should have notch shapes");const i=this.constants_.NOTCH_OFFSET_LEFT-this.constants_.CORNER_RADIUS;return Qe(-i,0)+ae("h",i)+e.shape.pathLeft+ae("h",i)}};(function(e){e[e.LEFT=-1]="LEFT",e[e.CENTRE=0]="CENTRE",e[e.RIGHT=1]="RIGHT"})(s.Align$$module$build$src$core$inputs$align||(s.Align$$module$build$src$core$inputs$align={})),s.Align$$module$build$src$core$inputs$align;var Wr=class extends Ke{constructor(e,i,n){super(Ke.SKIP_SETUP),this.class=null,this.EDITABLE=!1,this.maxDisplayLength=1/0,e!==Ke.SKIP_SETUP&&(n?this.configure_(n):this.class=i||null,this.setValue(e))}configure_(e){super.configure_(e),e.class&&(this.class=e.class)}initView(){this.createTextElement_(),this.class&&re(this.getTextElement(),this.class)}doClassValidation_(e){return e==null?null:`${e}`}setClass(e){this.textElement_&&(this.class&&S(this.textElement_,this.class),e&&re(this.textElement_,e)),this.class=e}static fromJson(e){return new this(at(e.text),void 0,e)}};ai("field_label",Wr),Wr.prototype.DEFAULT_VALUE="";var Vn=class{constructor(e,i){this.name=e,this.sourceBlock=i,this.fieldRow=[],this.align=s.Align$$module$build$src$core$inputs$align.LEFT,this.visible=!0,this.type=s.inputTypes$$module$build$src$core$inputs$input_types.CUSTOM,this.connection=null}getSourceBlock(){return this.sourceBlock}appendField(e,i){return this.insertFieldAt(this.fieldRow.length,e,i),this}insertFieldAt(e,i,n){if(0>e||e>this.fieldRow.length)throw Error("index "+e+" out of bounds.");return(i||i===""&&n)&&(typeof i=="string"&&(i=s.fromJson$$module$build$src$core$field_registry({type:"field_label",text:i})),i.setSourceBlock(this.sourceBlock),this.sourceBlock.initialized&&this.initField(i),i.name=n,i.setVisible(this.isVisible()),i.prefixField&&(e=this.insertFieldAt(e,i.prefixField)),this.fieldRow.splice(e,0,i),e++,i.suffixField&&(e=this.insertFieldAt(e,i.suffixField)),this.sourceBlock.rendered&&this.sourceBlock.queueRender()),e}removeField(e,i){for(let n=0,c;c=this.fieldRow[n];n++)if(c.name===e)return c.dispose(),this.fieldRow.splice(n,1),this.sourceBlock.rendered&&this.sourceBlock.queueRender(),!0;if(i)return!1;throw Error('Field "'+e+'" not found.')}isVisible(){return this.visible}setVisible(e){let i=[];if(this.visible===e)return i;this.visible=e;for(let c=0,d;d=this.fieldRow[c];c++)d.setVisible(e);if(this.connection){var n=this.connection;e?i=n.startTrackingAll():n.stopTrackingAll(),(n=n.targetBlock())&&(n.getSvgRoot().style.display=e?"block":"none")}return i}markDirty(){for(let e=0,i;i=this.fieldRow[e];e++)i.markDirty()}setCheck(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setCheck(e),this}setAlign(e){return this.align=e,this.sourceBlock.rendered&&this.sourceBlock.queueRender(),this}setShadowDom(e){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.setShadowDom(e),this}getShadowDom(){if(!this.connection)throw Error("This input does not have a connection.");return this.connection.getShadowDom()}init(){for(const e of this.fieldRow)e.init()}initModel(){for(const e of this.fieldRow)e.initModel()}initField(e){this.sourceBlock.rendered?e.init():e.initModel()}dispose(){for(let e=0,i;i=this.fieldRow[e];e++)i.dispose();this.connection&&this.connection.dispose()}makeConnection(e){return this.sourceBlock.makeConnection_(e)}},pi=class extends Vn{constructor(e,i){super(e,i),this.name=e,this.type=s.inputTypes$$module$build$src$core$inputs$input_types.DUMMY}},Ui=class extends Vn{constructor(e,i){super(e,i),this.name=e,this.type=s.inputTypes$$module$build$src$core$inputs$input_types.END_ROW}},bs=class extends Vn{constructor(e,i){if(!e)throw Error("Statement inputs must have a non-empty name");super(e,i),this.name=e,this.type=s.inputTypes$$module$build$src$core$inputs$input_types.STATEMENT,this.connection=this.makeConnection(le.NEXT_STATEMENT)}},QT;s.ValueInput$$module$build$src$core$inputs$value_input=class extends Vn{constructor(e,i){if(!e)throw Error("Value inputs must have a non-empty name");super(e,i),this.name=e,this.type=s.inputTypes$$module$build$src$core$inputs$input_types.VALUE,this.connection=this.makeConnection(le.INPUT_VALUE)}},QT={},QT.ValueInput=s.ValueInput$$module$build$src$core$inputs$value_input;var el=class{constructor(e,i){this.statementEdge=this.width=this.widthWithChildren=this.height=0,this.rows=[],this.inputRows=[],this.startY=this.startX=0,this.renderer_=e,this.block_=i,this.constants_=this.renderer_.getConstants(),this.outputConnection=i.outputConnection?new JT(this.constants_,i.outputConnection):null,this.isInline=i.getInputsInline()&&!i.isCollapsed(),this.isCollapsed=i.isCollapsed(),this.isInsertionMarker=i.isInsertionMarker(),this.RTL=i.RTL,this.topRow=new gp(this.constants_),this.bottomRow=new hp(this.constants_)}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}createRows_(){this.populateTopRow_(),this.rows.push(this.topRow);let e=new pp(this.constants_);this.inputRows.push(e);var i=this.block_.getIcons();for(let n=0,c;c=i[n];n++){const d=new KT(this.constants_,c);this.isCollapsed&&!c.isShownWhenCollapsed()||e.elements.push(d)}i=void 0;for(let n=0,c;c=this.block_.inputList[n];n++)if(c.isVisible()){this.shouldStartNewRow_(c,i)&&(this.rows.push(e),e=new pp(this.constants_),this.inputRows.push(e));for(let d=0,m;m=c.fieldRow[d];d++)e.elements.push(new Hn(this.constants_,m,c));this.addInput_(c,e),i=c}this.isCollapsed&&(e.hasJaggedEdge=!0,e.elements.push(new jT(this.constants_))),(e.elements.length||e.hasDummyInput)&&this.rows.push(e),this.populateBottomRow_(),this.rows.push(this.bottomRow)}populateTopRow_(){var e=!!this.block_.previousConnection;const i=(this.block_.hat?this.block_.hat==="cap":this.constants_.ADD_START_HATS)&&!this.outputConnection&&!e;let n=this.topRow.hasLeftSquareCorner(this.block_)?Qo:Zo;this.topRow.elements.push(new n(this.constants_)),i?(e=new up(this.constants_),this.topRow.elements.push(e),this.topRow.capline=e.ascenderHeight):e&&(this.topRow.hasPreviousConnection=!0,this.topRow.connection=new ZT(this.constants_,this.block_.previousConnection),this.topRow.elements.push(this.topRow.connection)),this.block_.inputList.length&&this.block_.inputList[0]instanceof bs&&!this.block_.isCollapsed()?this.topRow.minHeight=this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT:this.topRow.minHeight=this.constants_.TOP_ROW_MIN_HEIGHT,n=this.topRow.hasRightSquareCorner(this.block_)?Qo:Zo,this.topRow.elements.push(new n(this.constants_,"right"))}populateBottomRow_(){this.bottomRow.hasNextConnection=!!this.block_.nextConnection,this.bottomRow.minHeight=this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof bs?this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT:this.constants_.BOTTOM_ROW_MIN_HEIGHT,this.bottomRow.hasLeftSquareCorner(this.block_)?this.bottomRow.elements.push(new Qo(this.constants_)):this.bottomRow.elements.push(new Zo(this.constants_)),this.bottomRow.hasNextConnection&&(this.bottomRow.connection=new qT(this.constants_,this.block_.nextConnection),this.bottomRow.elements.push(this.bottomRow.connection)),this.bottomRow.hasRightSquareCorner(this.block_)?this.bottomRow.elements.push(new Qo(this.constants_,"right")):this.bottomRow.elements.push(new Zo(this.constants_,"right"))}addInput_(e,i){this.isInline&&e instanceof s.ValueInput$$module$build$src$core$inputs$value_input?(i.elements.push(new dp(this.constants_,e)),i.hasInlineInput=!0):e instanceof bs?(i.elements.push(new Jo(this.constants_,e)),i.hasStatement=!0):e instanceof s.ValueInput$$module$build$src$core$inputs$value_input?(i.elements.push(new pc(this.constants_,e)),i.hasExternalInput=!0):(e instanceof pi||e instanceof Ui)&&(i.minHeight=Math.max(i.minHeight,e.getSourceBlock()&&e.getSourceBlock().isShadow()?this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT:this.constants_.DUMMY_INPUT_MIN_HEIGHT),i.hasDummyInput=!0),i.align===null&&(i.align=e.align)}shouldStartNewRow_(e,i){return i?i instanceof Ui||e instanceof bs||i instanceof bs?!0:e instanceof s.ValueInput$$module$build$src$core$inputs$value_input||e instanceof pi||i instanceof s.ValueInput$$module$build$src$core$inputs$value_input?!this.isInline:!1:!1}addElemSpacing_(){for(let e=0,i;i=this.rows[e];e++){const n=i.elements;if(i.elements=[],i.startsWithElemSpacer()&&i.elements.push(new Ts(this.constants_,this.getInRowSpacing_(null,n[0]))),n.length){for(let c=0;c<n.length-1;c++){i.elements.push(n[c]);const d=this.getInRowSpacing_(n[c],n[c+1]);i.elements.push(new Ts(this.constants_,d))}i.elements.push(n[n.length-1]),i.endsWithElemSpacer()&&i.elements.push(new Ts(this.constants_,this.getInRowSpacing_(n[n.length-1],null)))}}}getInRowSpacing_(e,i){if(!e&&i&&N.isStatementInput(i))return this.constants_.STATEMENT_INPUT_PADDING_LEFT;if(e&&N.isInput(e)&&!i){if(N.isExternalInput(e))return this.constants_.NO_PADDING;if(N.isInlineInput(e))return this.constants_.LARGE_PADDING;if(N.isStatementInput(e))return this.constants_.NO_PADDING}return e&&N.isLeftSquareCorner(e)&&i&&(N.isPreviousConnection(i)||N.isNextConnection(i))?i.notchOffset:e&&N.isLeftRoundedCorner(e)&&i&&(N.isPreviousConnection(i)||N.isNextConnection(i))?i.notchOffset-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}computeBounds_(){let e=0,i=0,n=0;for(let d=0,m;m=this.rows[d];d++){if(m.measure(),i=Math.max(i,m.width),m.hasStatement){var c=m.getLastInput();let y,O;c=m.width-((O=(y=c)==null?void 0:y.width)!=null?O:0),e=Math.max(e,c)}n=Math.max(n,m.widthWithConnectedBlocks)}this.statementEdge=e,this.width=i;for(let d=0,m;m=this.rows[d];d++)m.hasStatement&&(m.statementEdge=this.statementEdge);this.widthWithChildren=Math.max(i,n),this.outputConnection&&(this.startX=this.outputConnection.width,this.width+=this.outputConnection.width,this.widthWithChildren+=this.outputConnection.width)}alignRowElements_(){for(let i=0,n;n=this.rows[i];i++)if(n.hasStatement)this.alignStatementRow_(n);else{var e=n.width;e=this.getDesiredRowWidth_(n)-e,0<e&&this.addAlignmentPadding_(n,e),N.isTopOrBottomRow(n)&&(n.widthWithConnectedBlocks=n.width)}}getDesiredRowWidth_(e){return this.width-this.startX}addAlignmentPadding_(e,i){const n=e.getFirstSpacer(),c=e.getLastSpacer();if((e.hasExternalInput||e.hasStatement)&&(e.widthWithConnectedBlocks+=i),e.align===s.Align$$module$build$src$core$inputs$align.LEFT&&c)c.width+=i;else if(e.align===s.Align$$module$build$src$core$inputs$align.CENTRE&&n&&c)n.width+=i/2,c.width+=i/2;else if(e.align===s.Align$$module$build$src$core$inputs$align.RIGHT&&n)n.width+=i;else if(c)c.width+=i;else return;e.width+=i}alignStatementRow_(e){const i=e.getLastInput();if(i){var n=e.width-i.width,c=this.statementEdge;n=c-n,0<n&&this.addAlignmentPadding_(e,n),n=e.width,c=this.getDesiredRowWidth_(e),i.width+=c-n,i.height=Math.max(i.height,e.height),e.width+=c-n,e.widthWithConnectedBlocks=Math.max(e.width,this.statementEdge+e.connectedBlockWidths)}}addRowSpacing_(){const e=this.rows;this.rows=[];for(let i=0;i<e.length;i++)this.rows.push(e[i]),i!==e.length-1&&this.rows.push(this.makeSpacerRow_(e[i],e[i+1]))}makeSpacerRow_(e,i){var n=this.getSpacerRowHeight_(e,i);const c=this.getSpacerRowWidth_(e,i);return n=new fp(this.constants_,n,c),e.hasStatement&&(n.followsStatement=!0),i.hasStatement&&(n.precedesStatement=!0),n}getSpacerRowWidth_(e,i){return this.width-this.startX}getSpacerRowHeight_(e,i){return this.constants_.MEDIUM_PADDING}getElemCenterline_(e,i){return N.isSpacer(i)?e.yPos+i.height/2:N.isBottomRow(e)?(e=e.yPos+e.height-e.descenderHeight,N.isNextConnection(i)?e+i.height/2:e-i.height/2):N.isTopRow(e)?N.isHat(i)?e.capline-i.height/2:e.capline+i.height/2:e.yPos+e.height/2}recordElemPositions_(e){let i=e.xPos;for(let n=0,c;c=e.elements[n];n++)N.isSpacer(c)&&(c.height=e.height),c.xPos=i,c.centerline=this.getElemCenterline_(e,c),i+=c.width}finalize_(){let e=0,i=0;for(let n=0,c;c=this.rows[n];n++)c.yPos=i,c.xPos=this.startX,i+=c.height,e=Math.max(e,c.widthWithConnectedBlocks),this.recordElemPositions_(c);if(this.outputConnection&&this.block_.nextConnection){const n=this.block_.nextConnection.targetBlock();n&&(e=Math.max(e,n.getHeightWidth().width))}this.widthWithChildren=e+this.startX,this.height=i,this.startY=this.topRow.capline,this.bottomRow.baseline=i-this.bottomRow.descenderHeight}getMeasureableForConnection(e){let i;if(((i=this.outputConnection)==null?void 0:i.connectionModel)===e)return this.outputConnection;for(const n of this.rows)for(const c of n.elements)if(c instanceof Fi&&c.connectionModel===e)return c;return null}},mp=class extends Dr{constructor(e){if(super(e),this.type=W.BLOCK_DELETE,e){if(e.getParent())throw Error("Connected blocks cannot be deleted.");e.isShadow()&&(this.recordUndo=!1),this.oldXml=Co(e),this.ids=pe(e),this.wasShadow=e.isShadow(),this.oldJson=gs(e,{addCoordinates:!0})}}toJson(){const e=super.toJson();if(!this.oldXml)throw Error("The old block XML is undefined. Either pass a block to the constructor, or call fromJson");if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(this.wasShadow===void 0)throw Error("Whether the block was a shadow is undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.oldXml=li(this.oldXml),e.ids=this.ids,e.wasShadow=this.wasShadow,e.oldJson=this.oldJson,this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new mp),i.oldXml=s.textToDom$$module$build$src$core$utils$xml(e.oldXml),i.ids=e.ids,i.wasShadow=e.wasShadow||i.oldXml.tagName.toLowerCase()==="shadow",i.oldJson=e.oldJson,e.recordUndo!==void 0&&(i.recordUndo=e.recordUndo),i}run(e){const i=this.getEventWorkspace_();if(!this.ids)throw Error("The block IDs are undefined. Either pass a block to the constructor, or call fromJson");if(!this.oldJson)throw Error("The old block JSON is undefined. Either pass a block to the constructor, or call fromJson");if(e)for(e=0;e<this.ids.length;e++){const n=this.ids[e],c=i.getBlockById(n);c?c.dispose(!1):n===this.blockId&&console.warn("Can't delete non-existent block: "+n)}else Ii(this.oldJson,i)}};r(Z.EVENT,W.BLOCK_DELETE,mp);var Ae=class{constructor(e,i){this.type=i,this.targetConnection=null,this.disposed=!1,this.shadowDom=this.check=null,this.y=this.x=0,this.shadowState=null,this.sourceBlock_=e}connect_(e){const i=le.INPUT_VALUE,n=this.getSourceBlock();var c=e.getSourceBlock();e.isConnected()&&e.disconnectInternal(!1);let d;if(this.isConnected()){const y=this.stashShadowState(),O=this.targetBlock();O.isShadow()?O.dispose(!1):(this.disconnectInternal(),d=O),this.applyShadowState(y)}let m;ue()&&(m=new(he(W.BLOCK_MOVE))(c),m.setReason(["connect"])),i$(this,e),c.setParent(n),m&&(m.recordNew(),z(m)),d&&(e=this.type===i?d.outputConnection:d.previousConnection)&&((c=Ae.getConnectionForOrphanedConnection(c,e))?e.connect(c):e.onFailedConnect(this))}dispose(){if(this.isConnected()){this.isSuperior()&&this.setShadowStateInternal();const e=this.targetBlock();e&&!e.isDeadOrDying()&&e.unplug()}this.disposed=!0}getSourceBlock(){return this.sourceBlock_}isSuperior(){return this.type===le.INPUT_VALUE||this.type===le.NEXT_STATEMENT}isConnected(){return!!this.targetConnection}getConnectionChecker(){return this.sourceBlock_.workspace.connectionChecker}onFailedConnect(e){}connect(e){if(this.targetConnection===e)return!0;if(this.getConnectionChecker().canConnect(this,e,!1)){const i=s.getGroup$$module$build$src$core$events$utils();i||s.setGroup$$module$build$src$core$events$utils(!0),this.isSuperior()?this.connect_(e):e.connect_(this),s.setGroup$$module$build$src$core$events$utils(i)}return this.isConnected()}disconnect(){this.disconnectInternal()}disconnectInternal(e=!0){const{parentConnection:i,childConnection:n}=this.getParentAndChildConnections();if(!i||!n)throw Error("Source connection not connected.");const c=s.getGroup$$module$build$src$core$events$utils();c||s.setGroup$$module$build$src$core$events$utils(!0);let d;ue()&&(d=new(he(W.BLOCK_MOVE))(n.getSourceBlock()),d.setReason(["disconnect"]));const m=this.targetConnection;m&&(m.targetConnection=null),this.targetConnection=null,e&&n.getSourceBlock().setParent(null),d&&(d.recordNew(),z(d)),n.getSourceBlock().isShadow()||i.respawnShadow_(),s.setGroup$$module$build$src$core$events$utils(c)}getParentAndChildConnections(){return this.targetConnection?this.isSuperior()?{parentConnection:this,childConnection:this.targetConnection}:{parentConnection:this.targetConnection,childConnection:this}:{}}respawnShadow_(){this.createShadowBlock(!0)}reconnect(e,i){if(this.getSourceBlock().isDeadOrDying())return!1;var n;return i=(n=e.getInput(i))==null?void 0:n.connection,n=this.targetBlock(),n&&n!==e||!i||i.targetConnection===this?!1:(i.isConnected()&&i.disconnect(),i.connect(this),!0)}targetBlock(){if(this.isConnected()){let e,i;return(i=(e=this.targetConnection)==null?void 0:e.getSourceBlock())!=null?i:null}return null}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return e?(Array.isArray(e)||(e=[e]),this.check=e,this.onCheckChanged_()):this.check=null,this}getCheck(){return this.check}setShadowDom(e){this.setShadowStateInternal({shadowDom:e})}getShadowDom(e){return e&&this.targetBlock().isShadow()?Qi(this.targetBlock()):this.shadowDom}setShadowState(e){this.setShadowStateInternal({shadowState:e})}getShadowState(e){return e&&this.targetBlock()&&this.targetBlock().isShadow()?gs(this.targetBlock()):this.shadowState}neighbours(e){return[]}getParentInput(){let e=null;const i=this.sourceBlock_.inputList;for(let n=0;n<i.length;n++)if(i[n].connection===this){e=i[n];break}return e}toString(){const e=this.sourceBlock_;if(!e)return"Orphan Connection";if(e.outputConnection===this)var i="Output Connection of ";else if(e.previousConnection===this)i="Previous Connection of ";else if(e.nextConnection===this)i="Next Connection of ";else{i=null;for(let n=0,c;c=e.inputList[n];n++)if(c.connection===this){i=c;break}if(i)i='Input "'+i.name+'" connection on ';else return console.warn("Connection not actually connected to sourceBlock_"),"Orphan Connection"}return i+e.toDevString()}stashShadowState(){const e=this.getShadowDom(!0),i=this.getShadowState(!0);return this.shadowState=this.shadowDom=null,{shadowDom:e,shadowState:i}}applyShadowState({shadowDom:e,shadowState:i}){this.shadowDom=e,this.shadowState=i}setShadowStateInternal({shadowDom:e=null,shadowState:i=null}={}){this.shadowDom=e,this.shadowState=i,this.getSourceBlock().isDeadOrDying()||((e=this.targetBlock())?e.isShadow()?(e.dispose(!1),this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())):(e=this.createShadowBlock(!1),this.serializeShadow(e),e&&e.dispose(!1)):(this.respawnShadow_(),this.targetBlock()&&this.targetBlock().isShadow()&&this.serializeShadow(this.targetBlock())))}createShadowBlock(e){var i=this.getSourceBlock();const n=this.getShadowState(),c=this.getShadowDom();if(i.isDeadOrDying()||!n&&!c)return null;if(n)return i=_n(n,i.workspace,{parentConnection:e?this:void 0,isShadow:!0,recordUndo:!1});if(c){if(i=wr(c,i.workspace),e)if(this.type===le.INPUT_VALUE){if(!i.outputConnection)throw Error("Shadow block is missing an output connection");if(!this.connect(i.outputConnection))throw Error("Could not connect shadow block to connection")}else if(this.type===le.NEXT_STATEMENT){if(!i.previousConnection)throw Error("Shadow block is missing previous connection");if(!this.connect(i.previousConnection))throw Error("Could not connect shadow block to connection")}else throw Error("Cannot connect a shadow block to a previous/output connection");return i}return null}serializeShadow(e){e&&(this.shadowDom=Qi(e),this.shadowState=gs(e))}static getConnectionForOrphanedConnection(e,i){if(i.type===le.OUTPUT_VALUE)return n$(e,i.getSourceBlock());e=e.lastConnectionInStack(!0);const n=i.getConnectionChecker();return e&&n.canConnect(i,e,!1)?e:null}};Ae.CAN_CONNECT=0,Ae.REASON_SELF_CONNECTION=1,Ae.REASON_WRONG_TYPE=2,Ae.REASON_TARGET_NULL=3,Ae.REASON_CHECKS_FAILED=4,Ae.REASON_DIFFERENT_WORKSPACES=5,Ae.REASON_SHADOW_PARENT=6,Ae.REASON_DRAG_CHECKS_FAILED=7,Ae.REASON_PREVIOUS_AND_OUTPUT=8;var hr=class{constructor(e,i,n){if(this.data=null,this.disposed=!1,this.hue=null,this.colour_="#000000",this.styleName_="",this.suppressPrefixSuffix=!1,this.previousConnection=this.nextConnection=this.outputConnection=null,this.inputList=[],this.icons=[],this.disabledReasons=new Set,this.tooltip="",this.contextMenu=!0,this.parentBlock_=null,this.childBlocks_=[],this.editable=this.movable=this.deletable=!0,this.collapsed_=this.shadow=!1,this.outputShape_=null,this.rendered=this.isInsertionMarker_=this.initialized=this.disposing=!1,this.onchangeWrapper=this.helpUrl=null,this.statementInputCount=0,this.workspace=e,this.id=n&&!e.getBlockById(n)?n:v(),e.setBlockById(this.id,this),this.xy=new te(0,0),this.isInFlyout=e.isFlyout,this.isInMutator=e.isMutator,this.RTL=e.RTL,i){if(this.type=i,n=cs[i],!n||typeof n!="object")throw TypeError("Invalid block definition for type: "+i);Object.assign(this,n)}e.addTopBlock(this),e.addTypedBlock(this),new.target===hr&&this.doInit_()}doInit_(){const e=s.getGroup$$module$build$src$core$events$utils();e||s.setGroup$$module$build$src$core$events$utils(!0);const i=k();try{typeof this.init=="function"&&(s.setRecordUndo$$module$build$src$core$events$utils(!1),this.init(),s.setRecordUndo$$module$build$src$core$events$utils(i)),ue()&&z(new(he(W.BLOCK_CREATE))(this))}finally{s.setGroup$$module$build$src$core$events$utils(e),s.setRecordUndo$$module$build$src$core$events$utils(i)}this.inputsInlineDefault=this.inputsInline,typeof this.onchange=="function"&&this.setOnChange(this.onchange)}dispose(e=!1){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.unplug(e),ue()&&z(new(he(W.BLOCK_DELETE))(this)),this.workspace.removeTopBlock(this),this.disposeInternal()}disposeInternal(){this.disposing=!0,this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.workspace.removeTypedBlock(this),this.workspace.removeBlockById(this.id),typeof this.destroy=="function"&&this.destroy(),this.childBlocks_.forEach(e=>e.disposeInternal()),this.inputList.forEach(e=>e.dispose()),this.inputList.length=0,this.getConnections_(!0).forEach(e=>e.dispose()),this.disposed=!0}isDeadOrDying(){return this.disposing||this.disposed}initModel(){if(!this.initialized){for(const e of this.inputList)e.initModel();this.initialized=!0}}unplug(e){this.outputConnection&&this.unplugFromRow(e),this.previousConnection&&this.unplugFromStack(e)}unplugFromRow(e){let i=null,n;(n=this.outputConnection)!=null&&n.isConnected()&&(i=this.outputConnection.targetConnection,this.outputConnection.disconnect()),i&&e&&(e=this.getOnlyValueConnection())&&e.isConnected()&&!e.targetBlock().isShadow()&&(e=e.targetConnection,e==null||e.disconnect(),this.workspace.connectionChecker.canConnect(e,i,!1)?i.connect(e):e==null||e.onFailedConnect(i))}getOnlyValueConnection(){let e=null;for(let i=0;i<this.inputList.length;i++){const n=this.inputList[i].connection;if(n&&n.type===le.INPUT_VALUE&&n.targetConnection){if(e)return null;e=n}}return e}unplugFromStack(e){let i=null;var n;if((n=this.previousConnection)!=null&&n.isConnected()&&(i=this.previousConnection.targetConnection,this.previousConnection.disconnect()),n=this.getNextBlock(),e&&n&&!n.isShadow()){let c,d;e=(d=(c=this.nextConnection)==null?void 0:c.targetConnection)!=null?d:null,e==null||e.disconnect(),i&&this.workspace.connectionChecker.canConnect(i,e,!1)&&i.connect(e)}}getConnections_(e){e=[],this.outputConnection&&e.push(this.outputConnection),this.previousConnection&&e.push(this.previousConnection),this.nextConnection&&e.push(this.nextConnection);for(let i=0,n;n=this.inputList[i];i++)n.connection&&e.push(n.connection);return e}lastConnectionInStack(e){let i=this.nextConnection;for(;i;){const n=i.targetBlock();if(!n||e&&n.isShadow())return i;i=n.nextConnection}return null}bumpNeighbours(){}getParent(){return this.parentBlock_}getInputWithBlock(e){for(let i=0,n;n=this.inputList[i];i++)if(n.connection&&n.connection.targetBlock()===e)return n;return null}getSurroundParent(){let e=this,i;do if(i=e,e=e.getParent(),!e)return null;while(e.getNextBlock()===i);return e}getNextBlock(){return this.nextConnection&&this.nextConnection.targetBlock()}getPreviousBlock(){return this.previousConnection&&this.previousConnection.targetBlock()}getRootBlock(){let e,i=this;do e=i,i=e.parentBlock_;while(i);return e}getTopStackBlock(){let e=this,i;do i=e.getPreviousBlock();while(i&&i.getNextBlock()===e&&(e=i));return e}getChildren(e){if(!e)return this.childBlocks_;e=[];for(let n=0,c;c=this.inputList[n];n++)if(c.connection){var i=c.connection.targetBlock();i&&e.push(i)}return(i=this.getNextBlock())&&e.push(i),e}setParent(e){if(e!==this.parentBlock_){var i=this.previousConnection&&this.previousConnection.targetBlock()||this.outputConnection&&this.outputConnection.targetBlock(),n=!!i;if(n&&e&&i!==e)throw Error("Block connected to superior one that is not new parent.");if(!n&&e)throw Error("Block not connected to new parent.");if(n&&!e)throw Error("Cannot set parent to null while block is still connected to superior block.");this.parentBlock_?$t(this.parentBlock_.childBlocks_,this):this.workspace.removeTopBlock(this),(this.parentBlock_=e)?e.childBlocks_.push(this):this.workspace.addTopBlock(this)}}getDescendants(e){const i=[this],n=this.getChildren(e);for(let c,d=0;c=n[d];d++)i.push(...c.getDescendants(e));return i}isDeletable(){return this.deletable&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnDeletable(){return this.deletable}setDeletable(e){this.deletable=e}isMovable(){return this.movable&&!this.shadow&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnMovable(){return this.movable}setMovable(e){this.movable=e}isDuplicatable(){return this.workspace.hasBlockLimits()?this.workspace.isCapacityAvailable(os(this,!0)):!0}isShadow(){return this.shadow}setShadow(e){this.shadow=e}isInsertionMarker(){return this.isInsertionMarker_}setInsertionMarker(e){this.isInsertionMarker_=e}isEditable(){return this.editable&&!this.isDeadOrDying()&&!this.workspace.options.readOnly}isOwnEditable(){return this.editable}setEditable(e){this.editable=e;for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)d.updateEditable()}isDisposed(){return this.disposed}isSimpleReporter(){if(!this.outputConnection)return!1;for(const e of this.inputList)if(e.connection||1<e.fieldRow.length)return!1;return!0}getMatchingConnection(e,i){const n=this.getConnections_(!0);if(e=e.getConnections_(!0),n.length!==e.length)throw Error("Connection lists did not match in length.");for(let c=0;c<e.length;c++)if(e[c]===i)return n[c];return null}setHelpUrl(e){this.helpUrl=e}setTooltip(e){this.tooltip=e}getTooltip(){return bn(this)}getColour(){return this.colour_}getStyleName(){return this.styleName_}getHue(){return this.hue}setColour(e){e=yn(e),this.hue=e.hue,this.colour_=e.hex}setStyle(e){this.styleName_=e}setOnChange(e){if(e&&typeof e!="function")throw Error("onchange must be a function.");this.onchangeWrapper&&this.workspace.removeChangeListener(this.onchangeWrapper),this.onchange=e,this.onchangeWrapper=e.bind(this),this.workspace.addChangeListener(this.onchangeWrapper)}getField(e){if(typeof e!="string")throw TypeError("Block.prototype.getField expects a string with the field name but received "+(e===void 0?"nothing":e+" of type "+typeof e)+" instead");for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)if(d.name===e)return d;return null}getVars(){const e=[];for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)d.referencesVariables()&&e.push(d.getValue());return e}getVarModels(){const e=[];for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)if(d.referencesVariables()){const m=this.workspace.getVariableById(d.getValue());m&&e.push(m)}return e}updateVarName(e){for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)d.referencesVariables()&&e.getId()===d.getValue()&&d.refreshVariableName()}renameVarById(e,i){for(let n=0,c;c=this.inputList[n];n++)for(let d=0,m;m=c.fieldRow[d];d++)m.referencesVariables()&&e===m.getValue()&&m.setValue(i)}getFieldValue(e){return(e=this.getField(e))?e.getValue():null}setFieldValue(e,i){const n=this.getField(i);if(!n)throw Error('Field "'+i+'" not found.');n.setValue(e)}setPreviousStatement(e,i){if(e)i===void 0&&(i=null),this.previousConnection||(this.previousConnection=this.makeConnection_(le.PREVIOUS_STATEMENT)),this.previousConnection.setCheck(i);else if(this.previousConnection){if(this.previousConnection.isConnected())throw Error("Must disconnect previous statement before removing connection.");this.previousConnection.dispose(),this.previousConnection=null}}setNextStatement(e,i){if(e)i===void 0&&(i=null),this.nextConnection||(this.nextConnection=this.makeConnection_(le.NEXT_STATEMENT)),this.nextConnection.setCheck(i);else if(this.nextConnection){if(this.nextConnection.isConnected())throw Error("Must disconnect next statement before removing connection.");this.nextConnection.dispose(),this.nextConnection=null}}setOutput(e,i){if(e)i===void 0&&(i=null),this.outputConnection||(this.outputConnection=this.makeConnection_(le.OUTPUT_VALUE)),this.outputConnection.setCheck(i);else if(this.outputConnection){if(this.outputConnection.isConnected())throw Error("Must disconnect output value before removing connection.");this.outputConnection.dispose(),this.outputConnection=null}}setInputsInline(e){this.inputsInline!==e&&(z(new(he(W.BLOCK_CHANGE))(this,"inline",null,this.inputsInline,e)),this.inputsInline=e)}getInputsInline(){if(this.inputsInline!==void 0)return this.inputsInline;for(var e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof pi&&this.inputList[e]instanceof pi)return!1;for(e=1;e<this.inputList.length;e++)if(this.inputList[e-1]instanceof s.ValueInput$$module$build$src$core$inputs$value_input&&this.inputList[e]instanceof pi)return!0;for(e=0;e<this.inputList.length;e++)if(this.inputList[e]instanceof Ui)return!0;return!1}setOutputShape(e){this.outputShape_=e}getOutputShape(){return this.outputShape_}isEnabled(){return this.disabledReasons.size===0}get disabled(){return $("disabled","v11","v12","the isEnabled or hasDisabledReason methods of Block"),this.hasDisabledReason(es)}set disabled(e){$("disabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(e,es)}setEnabled(e){$("setEnabled","v11","v12","the setDisabledReason method of Block"),this.setDisabledReason(!e,es)}setDisabledReason(e,i){e||this.workspace.options.disable||!this.hasDisabledReason(es)||i==es||this.setDisabledReason(!1,es),this.disabledReasons.has(i)!==e&&(e?this.disabledReasons.add(i):this.disabledReasons.delete(i),e=new(he(W.BLOCK_CHANGE))(this,"disabled",null,!e,e),e.setDisabledReason(i),z(e))}getInheritedDisabled(){let e=this.getSurroundParent();for(;e;){if(!e.isEnabled())return!0;e=e.getSurroundParent()}return!1}hasDisabledReason(e){return this.disabledReasons.has(e)}getDisabledReasons(){return this.disabledReasons}isCollapsed(){return this.collapsed_}setCollapsed(e){this.collapsed_!==e&&(z(new(he(W.BLOCK_CHANGE))(this,"collapsed",null,this.collapsed_,e)),this.collapsed_=e)}toString(e,i){i=this.toTokens(i);for(let c=2;c<i.length;c++)i[c-2]==="("&&i[c]===")"&&(i[c-2]=i[c-1],i.splice(c-1,2));let n="";return i=i.reduce((c,d)=>(c=c+(n==="("||d===")"?"":" ")+d,n=d[d.length-1],c),""),i=i.trim()||"???",e&&i.length>e&&(i=i.substring(0,e-3)+"..."),i}toTokens(e="?"){const i=[];for(const c of this.inputList)if(c.name!=Fo){for(const d of c.fieldRow)i.push(d.getText());if(c.connection){const d=c.connection.targetBlock();if(d){var n=c.connection;let m=n.getCheck();!m&&n.targetConnection&&(m=n.targetConnection.getCheck()),(n=!!m&&(m.includes("Boolean")||m.includes("Number")))&&i.push("("),i.push(...d.toTokens(e)),n&&i.push(")")}else i.push(e)}}return i}appendValueInput(e){return this.appendInput(new s.ValueInput$$module$build$src$core$inputs$value_input(e,this))}appendStatementInput(e){return this.statementInputCount++,this.appendInput(new bs(e,this))}appendDummyInput(e=""){return this.appendInput(new pi(e,this))}appendEndRowInput(e=""){return this.appendInput(new Ui(e,this))}appendInput(e){return this.inputList.push(e),e}appendInputFromRegistry(e,i){return(e=p(Z.INPUT,e,!1))?this.appendInput(new e(i,this)):null}jsonInit(e){var i=e.type?'Block "'+e.type+'": ':"";if(e.output&&e.previousStatement)throw Error(i+"Must not have both an output and a previousStatement.");for(var n=0;e["args"+n];){if(e["message"+n]===void 0)throw Error(i+`args${n} must have a corresponding message (message${n}).`);n++}if(e.style&&e.style.hat&&(this.hat=e.style.hat,e.style=null),e.style&&e.colour)throw Error(i+"Must not have both a colour and a style.");for(e.style?this.jsonInitStyle(e,i):this.jsonInitColour(e,i),n=0;e["message"+n]!==void 0;)this.interpolate(e["message"+n],e["args"+n]||[],e["implicitAlign"+n]||e["lastDummyAlign"+n],i),n++;if(e.inputsInline!==void 0&&(s.disable$$module$build$src$core$events$utils(),this.setInputsInline(e.inputsInline),s.enable$$module$build$src$core$events$utils()),e.output!==void 0&&this.setOutput(!0,e.output),e.outputShape!==void 0&&this.setOutputShape(e.outputShape),e.previousStatement!==void 0&&this.setPreviousStatement(!0,e.previousStatement),e.nextStatement!==void 0&&this.setNextStatement(!0,e.nextStatement),e.tooltip!==void 0&&(n=at(e.tooltip),this.setTooltip(n)),e.enableContextMenu!==void 0&&(this.contextMenu=!!e.enableContextMenu),e.suppressPrefixSuffix!==void 0&&(this.suppressPrefixSuffix=!!e.suppressPrefixSuffix),e.helpUrl!==void 0&&(n=at(e.helpUrl),this.setHelpUrl(n)),typeof e.extensions=="string"&&(console.warn(i+"JSON attribute 'extensions' should be an array of strings. Found raw string in JSON for '"+e.type+"' block."),e.extensions=[e.extensions]),e.mutator!==void 0&&va(e.mutator,this,!0),e=e.extensions,Array.isArray(e))for(i=0;i<e.length;i++)va(e[i],this,!1)}jsonInitColour(e,i){if("colour"in e)if(e.colour===void 0)console.warn(i+"Undefined colour value.");else{e=e.colour;try{this.setColour(e)}catch{console.warn(i+"Illegal colour value: ",e)}}}jsonInitStyle(e,i){e=e.style;try{this.setStyle(e)}catch{console.warn(i+"Style does not exist: ",e)}}mixin(e,i){if(i!==void 0&&typeof i!="boolean")throw Error("opt_disableCheck must be a boolean if provided");if(!i){i=[];for(const n in e)this[n]!==void 0&&i.push(n);if(i.length)throw Error("Mixin will overwrite block members: "+JSON.stringify(i))}Object.assign(this,e)}interpolate(e,i,n,c){e=cu(e),this.validateTokens(e,i.length),i=this.interpolateArguments(e,i,n),n=[];for(let d=0,m;m=i[d];d++)if(this.isInputKeyword(m.type)){if(e=this.inputFromJson(m,c)){for(let y=0,O;O=n[y];y++)e.appendField(O[0],O[1]);n.length=0}}else(e=this.fieldFromJson(m))&&n.push([e,m.name])}validateTokens(e,i){const n=[];let c=0;for(let d=0;d<e.length;d++){const m=e[d];if(typeof m=="number"){if(1>m||m>i)throw Error('Block "'+this.type+'": Message index %'+m+" out of range.");if(n[m])throw Error('Block "'+this.type+'": Message index %'+m+" duplicated.");n[m]=!0,c++}}if(c!==i)throw Error('Block "'+this.type+'": Message does not reference all '+i+" arg(s).")}interpolateArguments(e,i,n){const c=[];for(let m=0;m<e.length;m++){var d=e[m];if(typeof d=="number"&&(d=i[d-1]),typeof d=="string"){if(d===`
`)d={type:"input_end_row"},n&&(d.align=n);else if(d=this.stringToFieldJson(d),!d)continue}c.push(d)}return(e=c.length)&&!this.isInputKeyword(c[e-1].type)&&(e={type:"input_dummy"},n&&(e.align=n),c.push(e)),c}fieldFromJson(e){const i=s.fromJson$$module$build$src$core$field_registry(e);return!i&&e.alt?typeof e.alt=="string"?(e=this.stringToFieldJson(e.alt))?this.fieldFromJson(e):null:this.fieldFromJson(e.alt):i}inputFromJson(e,i){var n={LEFT:s.Align$$module$build$src$core$inputs$align.LEFT,RIGHT:s.Align$$module$build$src$core$inputs$align.RIGHT,CENTRE:s.Align$$module$build$src$core$inputs$align.CENTRE,CENTER:s.Align$$module$build$src$core$inputs$align.CENTRE};let c;switch(e.type){case"input_value":c=this.appendValueInput(e.name);break;case"input_statement":c=this.appendStatementInput(e.name);break;case"input_dummy":c=this.appendDummyInput(e.name);break;case"input_end_row":c=this.appendEndRowInput(e.name);break;default:c=this.appendInputFromRegistry(e.type,e.name)}return c?(e.check&&c.setCheck(e.check),e.align&&(n=n[e.align.toUpperCase()],n===void 0?console.warn(i+"Illegal align value: ",e.align):c.setAlign(n)),c):null}isInputKeyword(e){return e==="input_value"||e==="input_statement"||e==="input_dummy"||e==="input_end_row"||u(Z.INPUT,e)}stringToFieldJson(e){return(e=e.trim())?{type:"field_label",text:e}:null}moveInputBefore(e,i){if(e!==i){var n=-1,c=i?-1:this.inputList.length;for(let d=0,m;m=this.inputList[d];d++)if(m.name===e){if(n=d,c!==-1)break}else if(i&&m.name===i&&(c=d,n!==-1))break;if(n===-1)throw Error('Named input "'+e+'" not found.');if(c===-1)throw Error('Reference input "'+i+'" not found.');this.moveNumberedInputBefore(n,c)}}moveNumberedInputBefore(e,i){if(e===i)throw Error("Can't move input to itself.");if(e>=this.inputList.length)throw RangeError("Input index "+e+" out of bounds.");if(i>this.inputList.length)throw RangeError("Reference input "+i+" out of bounds.");const n=this.inputList[e];this.inputList.splice(e,1),e<i&&i--,this.inputList.splice(i,0,n)}removeInput(e,i){for(let n=0,c;c=this.inputList[n];n++)if(c.name===e)return c instanceof bs&&this.statementInputCount--,c.dispose(),this.inputList.splice(n,1),!0;if(i)return!1;throw Error("Input not found: "+e)}getInput(e){for(let i=0,n;n=this.inputList[i];i++)if(n.name===e)return n;return null}getInputTargetBlock(e){return(e=this.getInput(e))&&e.connection&&e.connection.targetBlock()}getCommentText(){let e,i;return(i=(e=this.getIcon(mt.COMMENT))==null?void 0:e.getText())!=null?i:null}setCommentText(e){var i;let n;const c=(n=(i=this.getIcon(mt.COMMENT))==null?void 0:i.getText())!=null?n:null;if(c!==e){if(e!==null){if(i=this.getIcon(mt.COMMENT),!i){if(i=p(Z.ICON,mt.COMMENT.toString(),!1),!i)throw Error("No comment icon class is registered, so a comment cannot be set");if(i=new i(this),!o$(i))throw Error("The class registered as a comment icon does not conform to the ICommentIcon interface");i=this.addIcon(i)}s.disable$$module$build$src$core$events$utils(),i.setText(e),s.enable$$module$build$src$core$events$utils()}else this.removeIcon(mt.COMMENT);z(new(he(W.BLOCK_CHANGE))(this,"comment",null,c,e))}}setWarningText(e,i){}setMutator(e){}addIcon(e){if(this.hasIcon(e.getType()))throw new WT(e);return this.icons.push(e),this.icons.sort((i,n)=>i.getWeight()-n.getWeight()),e}removeIcon(e){if(!this.hasIcon(e))return!1;let i;return(i=this.getIcon(e))==null||i.dispose(),this.icons=this.icons.filter(n=>!n.getType().equals(e)),!0}hasIcon(e){return this.icons.some(i=>i.getType().equals(e))}getIcon(e){return e instanceof mt?this.icons.find(i=>i.getType().equals(e)):this.icons.find(i=>i.getType().toString()===e)}getIcons(){return[...this.icons]}getRelativeToSurfaceXY(){return this.xy}moveBy(e,i,n){if(this.parentBlock_)throw Error("Block has parent");const c=new(he(W.BLOCK_MOVE))(this);n&&c.setReason(n),this.xy.translate(e,i),c.recordNew(),z(c)}makeConnection_(e){return new Ae(this,e)}allInputsFilled(e){if(e===void 0&&(e=!0),!e&&this.isShadow())return!1;for(let n=0,c;c=this.inputList[n];n++)if(c.connection){var i=c.connection.targetBlock();if(!i||!i.allInputsFilled(e))return!1}return(i=this.getNextBlock())?i.allInputsFilled(e):!0}toDevString(){let e=this.type?'"'+this.type+'" block':"Block";return this.id&&(e+=' (id="'+this.id+'")'),e}};hr.COLLAPSED_INPUT_NAME=Fo,hr.COLLAPSED_FIELD_NAME=za;var Ms=class{constructor(e,i,n,c){this.workspace=e,this.targetWorkspace=i,this.isFlyoutLabel=c,this.onMouseUpWrapper=null,this.height=this.width=0,this.cursorSvg=this.svgText=this.svgGroup=null,this.text=n.text,this.position=new te(0,0),this.callbackKey=n.callbackKey||n.callbackkey,this.cssClass=n["web-class"]||null,this.info=n}createDom(){var e=this.isFlyoutLabel?"blocklyFlyoutLabel":"blocklyFlyoutButton";this.cssClass&&(e+=" "+this.cssClass),this.svgGroup=Y(U.G,{class:e},this.workspace.getCanvas());let i;this.isFlyoutLabel||(i=Y(U.RECT,{class:"blocklyFlyoutButtonShadow",rx:Ms.BORDER_RADIUS,ry:Ms.BORDER_RADIUS,x:1,y:1},this.svgGroup)),e=Y(U.RECT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelBackground":"blocklyFlyoutButtonBackground",rx:Ms.BORDER_RADIUS,ry:Ms.BORDER_RADIUS},this.svgGroup);const n=Y(U.TEXT,{class:this.isFlyoutLabel?"blocklyFlyoutLabelText":"blocklyText",x:0,y:0,"text-anchor":"middle"},this.svgGroup);var c=at(this.text);this.workspace.RTL&&(c+="‏"),n.textContent=c,this.isFlyoutLabel&&(this.svgText=n,this.workspace.getThemeManager().subscribe(this.svgText,"flyoutForegroundColour","fill"));const d=ce(n,"fontSize"),m=ce(n,"fontWeight"),y=ce(n,"fontFamily");if(this.width=b(n,d,m,y),c=I(c,d,m,y),this.height=c.height,!this.isFlyoutLabel){this.width+=2*Ms.TEXT_MARGIN_X,this.height+=2*Ms.TEXT_MARGIN_Y;let O;(O=i)==null||O.setAttribute("width",String(this.width));let K;(K=i)==null||K.setAttribute("height",String(this.height))}return e.setAttribute("width",String(this.width)),e.setAttribute("height",String(this.height)),n.setAttribute("x",String(this.width/2)),n.setAttribute("y",String(this.height/2-c.height/2+c.baseline)),this.updateTransform(),this.onMouseUpWrapper=fe(this.svgGroup,"pointerup",this,this.onMouseUp),this.svgGroup}show(){this.updateTransform(),this.svgGroup.setAttribute("display","block")}updateTransform(){this.svgGroup.setAttribute("transform","translate("+this.position.x+","+this.position.y+")")}moveTo(e,i){this.position.x=e,this.position.y=i,this.updateTransform()}isLabel(){return this.isFlyoutLabel}getPosition(){return this.position}getButtonText(){return this.text}getTargetWorkspace(){return this.targetWorkspace}getWorkspace(){return this.workspace}dispose(){this.onMouseUpWrapper&&Ue(this.onMouseUpWrapper),this.svgGroup&&F(this.svgGroup),this.svgText&&this.workspace.getThemeManager().unsubscribe(this.svgText)}setCursorSvg(e){e?this.svgGroup&&(this.svgGroup.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(){throw Error("Attempted to set a marker on a button.")}onMouseUp(e){(e=this.targetWorkspace.getGesture(e))&&e.cancel(),this.isFlyoutLabel&&this.callbackKey?console.warn("Labels should not have callbacks. Label text: "+this.text):this.isFlyoutLabel||this.callbackKey&&this.targetWorkspace.getButtonCallback(this.callbackKey)?this.isFlyoutLabel||(e=this.targetWorkspace.getButtonCallback(this.callbackKey))&&e(this):console.warn("Buttons should have callbacks. Button text: "+this.text)}};Ms.TEXT_MARGIN_X=5,Ms.TEXT_MARGIN_Y=2,Ms.BORDER_RADIUS=4,tt(`
.blocklyFlyoutButton {
  fill: #888;
  cursor: default;
}

.blocklyFlyoutButtonShadow {
  fill: #666;
}

.blocklyFlyoutButton:hover {
  fill: #aaa;
}

.blocklyFlyoutLabel {
  cursor: default;
}

.blocklyFlyoutLabelBackground {
  opacity: 0;
}
`);var j=class{constructor(e,i,n){if(this.wsCoordinate=null,!i)throw Error("Cannot create a node without a location.");this.type=e,this.isConnectionLocation=j.isConnectionType(e),this.location=i,this.processParams(n||null)}processParams(e){e&&e.wsCoordinate&&(this.wsCoordinate=e.wsCoordinate)}getLocation(){return this.location}getType(){return this.type}getWsCoordinate(){return this.wsCoordinate}isConnection(){return this.isConnectionLocation}findNextForInput(){var e=this.location.getParentInput();const i=e.getSourceBlock();for(e=i.inputList.indexOf(e),e+=1;e<i.inputList.length;e++){const n=i.inputList[e],c=n.fieldRow;for(let d=0;d<c.length;d++){const m=c[d];if(m.isClickable()||j.NAVIGATE_ALL_FIELDS)return j.createFieldNode(m)}if(n.connection)return j.createInputNode(n)}return null}findNextForField(){var e=this.location,i=e.getParentInput();const n=e.getSourceBlock();if(!n)throw Error("The current AST location is not associated with a block");var c=n.inputList.indexOf(i);for(e=i.fieldRow.indexOf(e)+1;c<n.inputList.length;c++){i=n.inputList[c];const d=i.fieldRow;for(;e<d.length;){if(d[e].isClickable()||j.NAVIGATE_ALL_FIELDS)return j.createFieldNode(d[e]);e++}if(e=0,i.connection)return j.createInputNode(i)}return null}findPrevForInput(){const e=this.location.getParentInput(),i=e.getSourceBlock();for(var n=i.inputList.indexOf(e);0<=n;n--){var c=i.inputList[n];if(c.connection&&c!==e)return j.createInputNode(c);c=c.fieldRow;for(let d=c.length-1;0<=d;d--){const m=c[d];if(m.isClickable()||j.NAVIGATE_ALL_FIELDS)return j.createFieldNode(m)}}return null}findPrevForField(){var e=this.location;const i=e.getParentInput(),n=e.getSourceBlock();if(!n)throw Error("The current AST location is not associated with a block");var c=n.inputList.indexOf(i);for(e=i.fieldRow.indexOf(e)-1;0<=c;c--){var d=n.inputList[c];if(d.connection&&d!==i)return j.createInputNode(d);for(d=d.fieldRow;-1<e;){if(d[e].isClickable()||j.NAVIGATE_ALL_FIELDS)return j.createFieldNode(d[e]);e--}0<=c-1&&(e=n.inputList[c-1].fieldRow.length-1)}return null}navigateBetweenStacks(e){var i=this.getLocation();if(i.getSourceBlock){var n=i.getSourceBlock();n&&(i=n)}if(!i||i.isDeadOrDying())return null;if(i.workspace.isFlyout)return this.navigateFlyoutContents(e);n=i.getRootBlock(),i=n.workspace.getTopBlocks(!0);for(let c=0;c<i.length;c++)if(n.id===i[c].id)return e=c+(e?1:-1),e===-1||e===i.length?null:j.createStackNode(i[e]);throw Error("Couldn't find "+(e?"next":"previous")+" stack?!")}navigateFlyoutContents(e){let i;switch(this.getType()){case j.types.STACK:i=this.getLocation();var n=i.workspace.targetWorkspace;break;case j.types.BUTTON:i=this.getLocation(),n=i.getTargetWorkspace();break;default:return null}return n=n.getFlyout(),n&&(e=this.findNextLocationInFlyout(n.getContents(),i,e))?e.type==="button"&&e.button?j.createButtonNode(e.button):e.type==="block"&&e.block?j.createStackNode(e.block):null:null}findNextLocationInFlyout(e,i,n){const c=e.findIndex(d=>i instanceof hr&&d.block===i||i instanceof Ms&&d.button===i);return 0>c?null:(n=n?c+1:c-1,n===-1||n===e.length?null:e[n])}findTopASTNodeForBlock(e){const i=wo(e);return i?j.createConnectionNode(i):j.createBlockNode(e)}getOutAstNodeForBlock(e){if(!e)return null;e=e.getTopStackBlock();const i=wo(e);return i&&i.targetConnection&&i.targetConnection.getParentInput()?j.createInputNode(i.targetConnection.getParentInput()):j.createStackNode(e)}findFirstFieldOrInput(e){e=e.inputList;for(let i=0;i<e.length;i++){const n=e[i],c=n.fieldRow;for(let d=0;d<c.length;d++){const m=c[d];if(m.isClickable()||j.NAVIGATE_ALL_FIELDS)return j.createFieldNode(m)}if(n.connection)return j.createInputNode(n)}return null}getSourceBlock(){return this.getType()===j.types.BLOCK?this.getLocation():this.getType()===j.types.STACK?this.getLocation():this.getType()===j.types.WORKSPACE||this.getType()===j.types.BUTTON?null:this.getLocation().getSourceBlock()}next(){switch(this.type){case j.types.STACK:return this.navigateBetweenStacks(!0);case j.types.OUTPUT:return j.createBlockNode(this.location.getSourceBlock());case j.types.FIELD:return this.findNextForField();case j.types.INPUT:return this.findNextForInput();case j.types.BLOCK:const e=this.location.nextConnection;if(!e)break;return j.createConnectionNode(e);case j.types.PREVIOUS:return j.createBlockNode(this.location.getSourceBlock());case j.types.NEXT:return j.createConnectionNode(this.location.targetConnection);case j.types.BUTTON:return this.navigateFlyoutContents(!0)}return null}in(){switch(this.type){case j.types.WORKSPACE:const e=this.location.getTopBlocks(!0);if(0<e.length)return j.createStackNode(e[0]);break;case j.types.STACK:return this.findTopASTNodeForBlock(this.location);case j.types.BLOCK:return this.findFirstFieldOrInput(this.location);case j.types.INPUT:return j.createConnectionNode(this.location.targetConnection)}return null}prev(){switch(this.type){case j.types.STACK:return this.navigateBetweenStacks(!1);case j.types.FIELD:return this.findPrevForField();case j.types.INPUT:return this.findPrevForInput();case j.types.BLOCK:var e=wo(this.location);if(!e)break;return j.createConnectionNode(e);case j.types.PREVIOUS:if((e=this.location.targetConnection)&&!e.getParentInput())return j.createConnectionNode(e);break;case j.types.NEXT:return j.createBlockNode(this.location.getSourceBlock());case j.types.BUTTON:return this.navigateFlyoutContents(!1)}return null}out(){switch(this.type){case j.types.STACK:var e=this.location,i=e.getRelativeToSurfaceXY();return i=new te(i.x,i.y+j.DEFAULT_OFFSET_Y),j.createWorkspaceNode(e.workspace,i);case j.types.OUTPUT:return e=this.location,(i=e.targetConnection)?j.createConnectionNode(i):j.createStackNode(e.getSourceBlock());case j.types.FIELD:if(e=this.location.getSourceBlock(),!e)throw Error("The current AST location is not associated with a block");return j.createBlockNode(e);case j.types.INPUT:return j.createBlockNode(this.location.getSourceBlock());case j.types.BLOCK:return this.getOutAstNodeForBlock(this.location);case j.types.PREVIOUS:return this.getOutAstNodeForBlock(this.location.getSourceBlock());case j.types.NEXT:return this.getOutAstNodeForBlock(this.location.getSourceBlock())}return null}static isConnectionType(e){switch(e){case j.types.PREVIOUS:case j.types.NEXT:case j.types.INPUT:case j.types.OUTPUT:return!0}return!1}static createFieldNode(e){return e?new j(j.types.FIELD,e):null}static createConnectionNode(e){if(!e)return null;const i=e.type;return i===le.INPUT_VALUE||i===le.NEXT_STATEMENT&&e.getParentInput()?j.createInputNode(e.getParentInput()):i===le.NEXT_STATEMENT?new j(j.types.NEXT,e):i===le.OUTPUT_VALUE?new j(j.types.OUTPUT,e):i===le.PREVIOUS_STATEMENT?new j(j.types.PREVIOUS,e):null}static createInputNode(e){return e&&e.connection?new j(j.types.INPUT,e.connection):null}static createBlockNode(e){return e?new j(j.types.BLOCK,e):null}static createStackNode(e){return e?new j(j.types.STACK,e):null}static createButtonNode(e){return e?new j(j.types.BUTTON,e):null}static createWorkspaceNode(e,i){return i&&e?new j(j.types.WORKSPACE,e,{wsCoordinate:i}):null}static createTopNode(e){const i=wo(e);return i?j.createConnectionNode(i):j.createBlockNode(e)}};j.NAVIGATE_ALL_FIELDS=!1,j.DEFAULT_OFFSET_Y=-20,function(e){e=e.types||(e.types={}),e.FIELD="field",e.BLOCK="block",e.INPUT="input",e.OUTPUT="output",e.NEXT="next",e.PREVIOUS="previous",e.STACK="stack",e.WORKSPACE="workspace",e.BUTTON="button"}(j||(j={}));var _p=class extends Hs{constructor(e,i,n,c){let d=e?e.workspace.id:void 0;c&&c.getType()===j.types.WORKSPACE&&(d=c.getLocation().id),super(d),this.type=W.MARKER_MOVE,this.blockId=e==null?void 0:e.id,this.oldNode=n||void 0,this.newNode=c,this.isCursor=i}toJson(){const e=super.toJson();if(this.isCursor===void 0)throw Error("Whether this is a cursor event or not is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newNode)throw Error("The new node is undefined. Either pass a node to the constructor, or call fromJson");return e.isCursor=this.isCursor,e.blockId=this.blockId,e.oldNode=this.oldNode,e.newNode=this.newNode,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new _p),i.isCursor=e.isCursor,i.blockId=e.blockId,i.oldNode=e.oldNode,i.newNode=e.newNode,i}};r(Z.EVENT,W.MARKER_MOVE,_p);var dC="blocklyCursor",pC="blocklyMarker",fC=.75,$p=class{constructor(e,i,n){this.workspace=e,this.marker=n,this.markerSvgRect_=this.markerSvgLine_=this.markerInput_=this.markerBlock_=this.svgGroup_=this.markerSvg_=this.currentMarkerSvg=this.parent=null,this.constants_=i,e=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR,this.colour_=n.colour||e}getSvgRoot(){return this.svgGroup_}getMarker(){return this.marker}isCursor(){return this.marker.type==="cursor"}createDom(){const e=this.isCursor()?dC:pC;return this.svgGroup_=Y(U.G,{class:e}),this.createDomInternal_(),this.svgGroup_}setParent_(e){this.isCursor()?(this.parent&&this.parent.setCursorSvg(null),e.setCursorSvg(this.getSvgRoot())):(this.parent&&this.parent.setMarkerSvg(null),e.setMarkerSvg(this.getSvgRoot())),this.parent=e}draw(e,i){if(i){this.constants_=this.workspace.getRenderer().getConstants();var n=this.isCursor()?this.constants_.CURSOR_COLOUR:this.constants_.MARKER_COLOUR;this.colour_=this.marker.colour||n,this.applyColour_(i),this.showAtLocation_(i),this.fireMarkerEvent(e,i),e=this.currentMarkerSvg.childNodes[0],e!==void 0&&e.beginElement&&e.beginElement()}else this.hide()}showAtLocation_(e){const i=e.getLocation().type;e.getType()===j.types.BLOCK?this.showWithBlock_(e):e.getType()===j.types.OUTPUT?this.showWithOutput_(e):i===le.INPUT_VALUE?this.showWithInput_(e):i===le.NEXT_STATEMENT?this.showWithNext_(e):e.getType()===j.types.PREVIOUS?this.showWithPrevious_(e):e.getType()===j.types.FIELD?this.showWithField_(e):e.getType()===j.types.WORKSPACE?this.showWithCoordinates_(e):e.getType()===j.types.STACK?this.showWithStack_(e):e.getType()===j.types.BUTTON&&this.showWithButton_(e)}showWithBlockPrevOutput(e){e=e.getSourceBlock();const i=e.width;var n=e.height,c=n*fC;const d=this.constants_.CURSOR_BLOCK_PADDING;e.previousConnection?(n=this.constants_.shapeFor(e.previousConnection),this.positionPrevious_(i,d,c,n)):e.outputConnection?(c=this.constants_.shapeFor(e.outputConnection),this.positionOutput_(i,n,c)):this.positionBlock_(i,d,c),this.setParent_(e),this.showCurrent_()}showWithBlock_(e){this.showWithBlockPrevOutput(e)}showWithPrevious_(e){this.showWithBlockPrevOutput(e)}showWithOutput_(e){this.showWithBlockPrevOutput(e)}showWithCoordinates_(e){var i=e.getWsCoordinate();e=i.x,i=i.y,this.workspace.RTL&&(e-=this.constants_.CURSOR_WS_WIDTH),this.positionLine_(e,i,this.constants_.CURSOR_WS_WIDTH),this.setParent_(this.workspace),this.showCurrent_()}showWithField_(e){e=e.getLocation();const i=e.getSize().width,n=e.getSize().height;this.positionRect_(0,0,i,n),this.setParent_(e),this.showCurrent_()}showWithInput_(e){e=e.getLocation();const i=e.getSourceBlock();this.positionInput_(e),this.setParent_(i),this.showCurrent_()}showWithNext_(e){var i=e.getLocation();e=i.getSourceBlock();let n=0;i=i.getOffsetInBlock().y;const c=e.getHeightWidth().width;this.workspace.RTL&&(n=-c),this.positionLine_(n,i,c),this.setParent_(e),this.showCurrent_()}showWithStack_(e){e=e.getLocation();var i=e.getHeightWidth();const n=i.width+this.constants_.CURSOR_STACK_PADDING;i=i.height+this.constants_.CURSOR_STACK_PADDING;const c=-this.constants_.CURSOR_STACK_PADDING/2,d=-this.constants_.CURSOR_STACK_PADDING/2;let m=c;this.workspace.RTL&&(m=-(n+c)),this.positionRect_(m,d,n,i),this.setParent_(e),this.showCurrent_()}showWithButton_(e){e=e.getLocation();const i=e.width+this.constants_.CURSOR_STACK_PADDING,n=e.height+this.constants_.CURSOR_STACK_PADDING,c=-this.constants_.CURSOR_STACK_PADDING/2,d=-this.constants_.CURSOR_STACK_PADDING/2;let m=c;this.workspace.RTL&&(m=-(i+c)),this.positionRect_(m,d,i,n),this.setParent_(e),this.showCurrent_()}showCurrent_(){this.hide(),this.currentMarkerSvg&&(this.currentMarkerSvg.style.display="")}positionBlock_(e,i,n){if(e=Qe(-i,n)+ae("V",-i)+ae("H",e+2*i)+ae("V",n),!this.markerBlock_)throw Error("createDom should be called before positioning the marker");this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionInput_(e){const i=e.getOffsetInBlock().x,n=e.getOffsetInBlock().y;e=Tt(0,0)+this.constants_.shapeFor(e).pathDown,this.markerInput_.setAttribute("d",e),this.markerInput_.setAttribute("transform","translate("+i+","+n+")"+(this.workspace.RTL?" scale(-1 1)":"")),this.currentMarkerSvg=this.markerInput_}positionLine_(e,i,n){if(!this.markerSvgLine_)throw Error("createDom should be called before positioning the line");this.markerSvgLine_.setAttribute("x",`${e}`),this.markerSvgLine_.setAttribute("y",`${i}`),this.markerSvgLine_.setAttribute("width",`${n}`),this.currentMarkerSvg=this.markerSvgLine_}positionOutput_(e,i,n){if(!this.markerBlock_)throw Error("createDom should be called before positioning the output");e=Qe(e,0)+ae("h",-(e-n.width))+ae("v",this.constants_.TAB_OFFSET_FROM_TOP)+n.pathDown+ae("V",i)+ae("H",e),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionPrevious_(e,i,n,c){if(!this.markerBlock_)throw Error("createDom should be called before positioning the previous connection marker");e=Qe(-i,n)+ae("V",-i)+ae("H",this.constants_.NOTCH_OFFSET_LEFT)+c.pathLeft+ae("H",e+2*i)+ae("V",n),this.markerBlock_.setAttribute("d",e),this.workspace.RTL&&this.flipRtl(this.markerBlock_),this.currentMarkerSvg=this.markerBlock_}positionRect_(e,i,n,c){if(!this.markerSvgRect_)throw Error("createDom should be called before positioning the rect");this.markerSvgRect_.setAttribute("x",`${e}`),this.markerSvgRect_.setAttribute("y",`${i}`),this.markerSvgRect_.setAttribute("width",`${n}`),this.markerSvgRect_.setAttribute("height",`${c}`),this.currentMarkerSvg=this.markerSvgRect_}flipRtl(e){e.setAttribute("transform","scale(-1 1)")}hide(){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before hiding the marker");this.markerSvgLine_.style.display="none",this.markerSvgRect_.style.display="none",this.markerInput_.style.display="none",this.markerBlock_.style.display="none"}fireMarkerEvent(e,i){const n=i.getSourceBlock();e=new(he(W.MARKER_MOVE))(n,this.isCursor(),e,i),z(e)}getBlinkProperties_(){return{attributeType:"XML",attributeName:"fill",dur:"1s",values:this.colour_+";transparent;transparent;",repeatCount:"indefinite"}}createDomInternal_(){if(this.markerSvg_=Y(U.G,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.svgGroup_),this.markerSvgLine_=Y(U.RECT,{width:this.constants_.CURSOR_WS_WIDTH,height:this.constants_.WS_CURSOR_HEIGHT},this.markerSvg_),this.markerSvgRect_=Y(U.RECT,{class:"blocklyVerticalMarker",rx:10,ry:10},this.markerSvg_),this.markerInput_=Y(U.PATH,{transform:""},this.markerSvg_),this.markerBlock_=Y(U.PATH,{transform:"",fill:"none","stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();Y(U.ANIMATE,e,this.markerSvgLine_),Y(U.ANIMATE,e,this.markerInput_),Y(U.ANIMATE,Object.assign({},e,{attributeName:"stroke"}),this.markerBlock_)}return this.markerSvg_}applyColour_(e){if(!(this.markerSvgLine_&&this.markerSvgRect_&&this.markerInput_&&this.markerBlock_))throw Error("createDom should be called before applying color to the markerj");this.markerSvgLine_.setAttribute("fill",this.colour_),this.markerSvgRect_.setAttribute("stroke",this.colour_),this.markerInput_.setAttribute("fill",this.colour_),this.markerBlock_.setAttribute("stroke",this.colour_),this.isCursor()&&(e=this.colour_+";transparent;transparent;",this.markerSvgLine_.firstElementChild.setAttribute("values",e),this.markerInput_.firstElementChild.setAttribute("values",e),this.markerBlock_.firstElementChild.setAttribute("values",e))}dispose(){this.svgGroup_&&F(this.svgGroup_)}},mc=class{constructor(e,i,n){this.markerSvg=this.cursorSvg=null,this.connectionHighlights=new WeakMap,this.highlightOffsets=new WeakMap,this.constants=n,this.style=i,this.svgRoot=e,this.svgPath=Y(U.PATH,{class:"blocklyPath"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)")}setCursorSvg(e){e?(this.svgRoot.appendChild(e),this.cursorSvg=e):this.cursorSvg=null}setMarkerSvg(e){e?(this.cursorSvg?this.svgRoot.insertBefore(e,this.cursorSvg):this.svgRoot.appendChild(e),this.markerSvg=e):this.markerSvg=null}applyColour(e){this.svgPath.setAttribute("stroke",this.style.colourTertiary),this.svgPath.setAttribute("fill",this.style.colourPrimary),this.updateShadow_(e.isShadow()),this.updateDisabled_(!e.isEnabled()||e.getInheritedDisabled())}setStyle(e){this.style=e}setClass_(e,i){e&&(i?re(this.svgRoot,e):S(this.svgRoot,e))}updateHighlighted(e){e?this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"):this.svgPath.setAttribute("filter","none")}updateShadow_(e){e&&(this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary))}updateDisabled_(e){this.setClass_("blocklyDisabled",e),e&&this.svgPath.setAttribute("fill","url(#"+this.constants.disabledPatternId+")")}updateSelected(e){this.setClass_("blocklySelected",e)}updateDraggingDelete(e){this.setClass_("blocklyDraggingDelete",e)}updateInsertionMarker(e){this.setClass_("blocklyInsertionMarker",e)}updateMovable(e){this.setClass_("blocklyDraggable",e)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e)}updateShapeForInputHighlight(e,i){}addConnectionHighlight(e,i,n,c){if(this.connectionHighlights.has(e)){if(this.currentHighlightMatchesNew(e,i,n))return;this.removeConnectionHighlight(e)}i=Y(U.PATH,{class:"blocklyHighlightedConnectionPath",d:i,transform:`translate(${n.x}, ${n.y})`+(c?" scale(-1 1)":"")},this.svgRoot),this.connectionHighlights.set(e,i)}currentHighlightMatchesNew(e,i,n){let c;const d=(c=this.connectionHighlights.get(e))==null?void 0:c.getAttribute("d");return e=this.highlightOffsets.get(e),d===i&&te.equals(e,n)}removeConnectionHighlight(e){const i=this.connectionHighlights.get(e);i&&(F(i),this.connectionHighlights.delete(e))}},Ls=class{constructor(e){this.activeCandidate=this.lastMarker=this.lastOnStack=null,this.wouldDeleteBlock=!1,this.fadedBlock=this.highlightedBlock=this.markerConnection=null,s.setSelected$$module$build$src$core$common(e),this.topBlock=e,this.workspace=e.workspace,this.firstMarker=this.createMarkerBlock(this.topBlock),this.availableConnections=this.initAvailableConnections(),this.lastOnStack&&(this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock()))}dispose(){this.availableConnections.length=0,this.disposeInsertionMarker(this.firstMarker),this.disposeInsertionMarker(this.lastMarker)}updateAvailableConnections(){this.availableConnections=this.initAvailableConnections()}wouldConnectBlock(){return!!this.activeCandidate}applyConnections(){if(this.activeCandidate){s.disable$$module$build$src$core$events$utils(),this.hidePreview(),s.enable$$module$build$src$core$events$utils();var{local:e,closest:i}=this.activeCandidate;e.connect(i);var n=e.isSuperior()?i:e,c=this.topBlock.getRootBlock();Gs().then(()=>{ya(n.getSourceBlock()),setTimeout(()=>{c.bringToFront()},0)})}}update(e,i){const n=this.getCandidate(e);((this.wouldDeleteBlock=this.shouldDelete(!!n,i))||this.shouldUpdatePreviews(n,e))&&(s.disable$$module$build$src$core$events$utils(),this.maybeHidePreview(n),this.maybeShowPreview(n),s.enable$$module$build$src$core$events$utils())}createMarkerBlock(e){s.disable$$module$build$src$core$events$utils();let i;try{const n=gs(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!n)throw Error(`Failed to serialize source block. ${e.toDevString()}`);i=Ii(n,this.workspace);for(const c of i.getDescendants(!1))c.setInsertionMarker(!0);i.initSvg(),i.getSvgRoot().setAttribute("visibility","hidden")}finally{s.enable$$module$build$src$core$events$utils()}return i}initAvailableConnections(){const e=this.topBlock.getConnections_(!1),i=this.topBlock.lastConnectionInStack(!0);return i&&i!==this.topBlock.nextConnection&&(e.push(i),this.lastOnStack=i),e}shouldUpdatePreviews(e,i){if(!e)return!!this.activeCandidate;if(!this.activeCandidate)return!0;const{local:n,closest:c}=this.activeCandidate;if(c===e.closest&&n===e.local)return!1;const d=n.x+i.x-c.x;return i=n.y+i.y-c.y,e.radius<Math.sqrt(d*d+i*i)-s.config$$module$build$src$core$config.currentConnectionPreference}getCandidate(e){this.markerConnection&&this.markerConnection.isConnected()||this.updateAvailableConnections();let i=this.getStartRadius(),n=null;for(let c=0;c<this.availableConnections.length;c++){const d=this.availableConnections[c],m=d.closest(i,e);m.connection&&(n={closest:m.connection,local:d,radius:m.radius},i=m.radius)}return n}getStartRadius(){return this.activeCandidate?s.config$$module$build$src$core$config.connectingSnapRadius:s.config$$module$build$src$core$config.snapRadius}shouldDelete(e,i){return i&&this.workspace.getComponentManager().hasCapability(i.id,et.Capability.DELETE_AREA)?i.wouldDelete(this.topBlock):!1}maybeShowPreview(e){if(!this.wouldDeleteBlock&&e){var i=e.closest,n;i===((n=this.activeCandidate)==null?void 0:n.closest)||i.getSourceBlock().isInsertionMarker()?console.log("Trying to connect to an insertion marker"):(this.activeCandidate=e,this.showPreview(this.activeCandidate))}}showPreview(e){const i=this.workspace.getRenderer();switch(i.getConnectionPreviewMethod(e.closest,e.local,this.topBlock)){case Ls.PREVIEW_TYPE.INPUT_OUTLINE:this.showInsertionInputOutline(e);break;case Ls.PREVIEW_TYPE.INSERTION_MARKER:this.showInsertionMarker(e);break;case Ls.PREVIEW_TYPE.REPLACEMENT_FADE:this.showReplacementFade(e)}i.shouldHighlightConnection(e.closest)&&e.closest.highlight()}maybeHidePreview(e){if(!e)this.hidePreview();else if(this.activeCandidate){const i=this.activeCandidate.local!==e.local;(this.activeCandidate.closest!==e.closest||i||this.wouldDeleteBlock)&&this.hidePreview()}this.activeCandidate=this.markerConnection=null}hidePreview(){let e;const i=(e=this.activeCandidate)==null?void 0:e.closest;i&&i.targetBlock()&&this.workspace.getRenderer().shouldHighlightConnection(i)&&i.unhighlight(),this.hideReplacementFade(),this.hideInsertionInputOutline(),this.hideInsertionMarker()}showInsertionMarker(e){const{local:i,closest:n}=e;let c=(e=this.lastOnStack&&i===this.lastOnStack)?this.lastMarker:this.firstMarker;if(!c)throw Error("Cannot show the insertion marker because there is no insertion marker block");let d;try{d=c.getMatchingConnection(i.getSourceBlock(),i)}catch{if(e&&this.lastOnStack?(this.disposeInsertionMarker(this.lastMarker),c=this.lastMarker=this.createMarkerBlock(this.lastOnStack.getSourceBlock())):(this.disposeInsertionMarker(this.firstMarker),c=this.firstMarker=this.createMarkerBlock(this.topBlock)),!c)throw Error("Cannot show the insertion marker because there is no insertion marker block");d=c.getMatchingConnection(i.getSourceBlock(),i)}if(!d)throw Error("Cannot show the insertion marker because there is no associated connection");if(d===this.markerConnection)throw Error("Made it to showInsertionMarker_ even though the marker isn't changing");c.queueRender(),Si(),d.connect(n);const m={x:n.x-d.x,y:n.y-d.y},y=d.getOffsetInBlock().clone(),O=d;Gs().then(()=>{let K;(K=c)==null||K.positionNearConnection(O,m,y);let oe;(oe=c)==null||oe.getSvgRoot().setAttribute("visibility","visible")}),this.markerConnection=d}hideInsertionMarker(){if(this.markerConnection){var e=this.markerConnection,i=e.getSourceBlock(),n=i.outputConnection,c;if((c=i.previousConnection)!=null&&c.targetConnection||n!=null&&n.targetConnection)i.unplug(!0);else{let d;(d=e.targetBlock())==null||d.unplug(!1)}if(e.targetConnection)throw Error("markerConnection still connected at the end of disconnectInsertionMarker");this.markerConnection=null,(e=i.getSvgRoot())&&e.setAttribute("visibility","hidden")}}showInsertionInputOutline(e){e=e.closest,this.highlightedBlock=e.getSourceBlock(),this.highlightedBlock.highlightShapeForInput(e,!0)}hideInsertionInputOutline(){if(this.highlightedBlock){if(!this.activeCandidate)throw Error("Cannot hide the insertion marker outline because there is no active candidate");this.highlightedBlock.highlightShapeForInput(this.activeCandidate.closest,!1),this.highlightedBlock=null}}showReplacementFade(e){if(this.fadedBlock=e.closest.targetBlock(),!this.fadedBlock)throw Error("Cannot show the replacement fade because the closest connection does not have a target block");this.fadedBlock.fadeForReplacement(!0)}hideReplacementFade(){this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null)}getInsertionMarkers(){const e=[];return this.firstMarker&&e.push(this.firstMarker),this.lastMarker&&e.push(this.lastMarker),e}disposeInsertionMarker(e){if(e){s.disable$$module$build$src$core$events$utils();try{e.dispose()}finally{s.enable$$module$build$src$core$events$utils()}}}};(function(e){e=e.PREVIEW_TYPE||(e.PREVIEW_TYPE={}),e[e.INSERTION_MARKER=0]="INSERTION_MARKER",e[e.INPUT_OUTLINE=1]="INPUT_OUTLINE",e[e.REPLACEMENT_FADE=2]="REPLACEMENT_FADE"})(Ls||(Ls={})),Ls.PREVIEW_TYPE;var _c=class{constructor(e){this.overrides=null,this.name=e}getClassName(){return this.name+"-renderer"}init(e,i){this.constants_=this.makeConstants_(),i&&(this.overrides=i,Object.assign(this.constants_,i)),this.constants_.setTheme(e),this.constants_.init()}createDom(e,i){this.constants_.createDom(e,this.name+"-"+i.name,"."+this.getClassName()+"."+i.getClassName())}refreshDom(e,i){const n=this.getConstants();n.dispose(),this.constants_=this.makeConstants_(),this.overrides&&Object.assign(this.constants_,this.overrides),this.constants_.randomIdentifier=n.randomIdentifier,this.constants_.setTheme(i),this.constants_.init(),this.createDom(e,i)}dispose(){this.constants_&&this.constants_.dispose()}makeConstants_(){return new fc}makeRenderInfo_(e){return new el(this,e)}makeDrawer_(e,i){return new gc(e,i)}makeMarkerDrawer(e,i){return new $p(e,this.getConstants(),i)}makePathObject(e,i){return new mc(e,i,this.constants_)}getConstants(){return this.constants_}shouldHighlightConnection(e){return!0}orphanCanConnectAtEnd(e,i,n){return!!Ae.getConnectionForOrphanedConnection(e,n===le.OUTPUT_VALUE?i.outputConnection:i.previousConnection)}getConnectionPreviewMethod(e,i,n){return $("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),i.type===le.OUTPUT_VALUE||i.type===le.PREVIOUS_STATEMENT?!e.isConnected()||this.orphanCanConnectAtEnd(n,e.targetBlock(),i.type)?Ls.PREVIEW_TYPE.INSERTION_MARKER:Ls.PREVIEW_TYPE.REPLACEMENT_FADE:Ls.PREVIEW_TYPE.INSERTION_MARKER}render(e){const i=this.makeRenderInfo_(e);i.measure(),this.makeDrawer_(e,i).draw()}},De={};De.BottomRow=hp,De.Connection=Fi,De.ConstantProvider=fc,De.Drawer=gc,De.ExternalValueInput=pc,De.Field=Hn,De.Hat=up,De.Icon=KT,De.InRowSpacer=Ts,De.InlineInput=dp,De.InputConnection=cr,De.InputRow=pp,De.JaggedEdge=jT,De.MarkerSvg=$p,De.Measurable=di,De.NextConnection=qT,De.OutputConnection=JT,De.PathObject=mc,De.PreviousConnection=ZT,De.RenderInfo=el,De.Renderer=_c,De.RoundCorner=Zo,De.Row=qo,De.SpacerRow=fp,De.SquareCorner=Qo,De.StatementInput=Jo,De.TopRow=gp,De.Types=N,De.init=Du,De.register=Ro,De.unregister=l$;var eb=class{constructor(e,i){this.workspace=e,this.theme=i,this.subscribedWorkspaces=[],this.componentDB=new Map}getTheme(){return this.theme}setTheme(e){var i=this.theme;this.theme=e,(e=this.workspace.getInjectionDiv())&&(i&&(i=i.getClassName())&&S(e,i),(i=this.theme.getClassName())&&re(e,i));for(let n=0,c;c=this.subscribedWorkspaces[n];n++)c.refreshTheme();for(const[n,c]of this.componentDB)for(const d of c){e=d.element,i=d.propertyName;const m=this.theme&&this.theme.getComponentStyle(n);e.style.setProperty(i,m||"")}for(const n of this.subscribedWorkspaces)n.hideChaff()}subscribeWorkspace(e){this.subscribedWorkspaces.push(e)}unsubscribeWorkspace(e){if(!$t(this.subscribedWorkspaces,e))throw Error("Cannot unsubscribe a workspace that hasn't been subscribed.")}subscribe(e,i,n){this.componentDB.has(i)||this.componentDB.set(i,[]),this.componentDB.get(i).push({element:e,propertyName:n}),i=this.theme&&this.theme.getComponentStyle(i),e.style.setProperty(n,i||"")}unsubscribe(e){if(e)for(const[i,n]of this.componentDB){for(let c=n.length-1;0<=c;c--)n[c].element===e&&n.splice(c,1);n.length||this.componentDB.delete(i)}}dispose(){this.subscribedWorkspaces.length=0,this.componentDB.clear()}},Tp="VARIABLE_DYNAMIC",zr={CATEGORY_NAME:Tp};zr.flyoutCategory=ka,zr.flyoutCategoryBlocks=Gu,zr.onCreateVariableButtonClick_Colour=Uu,zr.onCreateVariableButtonClick_Number=Fu,zr.onCreateVariableButtonClick_String=Bu;var tb=30,Xr=[];Xr[le.INPUT_VALUE]=le.OUTPUT_VALUE,Xr[le.OUTPUT_VALUE]=le.INPUT_VALUE,Xr[le.NEXT_STATEMENT]=le.PREVIOUS_STATEMENT,Xr[le.PREVIOUS_STATEMENT]=le.NEXT_STATEMENT;var bp="RENAME_VARIABLE_ID",Ep="DELETE_VARIABLE_ID",sb=class{canConnect(e,i,n,c){return this.canConnectWithReason(e,i,n,c)===Ae.CAN_CONNECT}canConnectWithReason(e,i,n,c){const d=this.doSafetyChecks(e,i);return d!==Ae.CAN_CONNECT?d:this.doTypeChecks(e,i)?n&&!this.doDragChecks(e,i,c||0)?Ae.REASON_DRAG_CHECKS_FAILED:Ae.CAN_CONNECT:Ae.REASON_CHECKS_FAILED}getErrorMessage(e,i,n){switch(e){case Ae.REASON_SELF_CONNECTION:return"Attempted to connect a block to itself.";case Ae.REASON_DIFFERENT_WORKSPACES:return"Blocks not on same workspace.";case Ae.REASON_WRONG_TYPE:return"Attempt to connect incompatible types.";case Ae.REASON_TARGET_NULL:return"Target connection is null.";case Ae.REASON_CHECKS_FAILED:return"Connection checks failed. "+(i+" expected "+i.getCheck()+", found "+n.getCheck());case Ae.REASON_SHADOW_PARENT:return"Connecting non-shadow to shadow block.";case Ae.REASON_DRAG_CHECKS_FAILED:return"Drag checks failed.";case Ae.REASON_PREVIOUS_AND_OUTPUT:return"Block would have an output and a previous connection.";default:return"Unknown connection failure: this should never happen!"}}doSafetyChecks(e,i){if(!e||!i)return Ae.REASON_TARGET_NULL;let n,c,d;return e.isSuperior()?(n=e.getSourceBlock(),c=i.getSourceBlock(),d=i):(c=e.getSourceBlock(),n=i.getSourceBlock(),d=e,e=i),n===c?Ae.REASON_SELF_CONNECTION:d.type!==Xr[e.type]?Ae.REASON_WRONG_TYPE:n.workspace!==c.workspace?Ae.REASON_DIFFERENT_WORKSPACES:n.isShadow()&&!c.isShadow()?Ae.REASON_SHADOW_PARENT:d.type===le.OUTPUT_VALUE&&c.previousConnection&&c.previousConnection.isConnected()||d.type===le.PREVIOUS_STATEMENT&&c.outputConnection&&c.outputConnection.isConnected()?Ae.REASON_PREVIOUS_AND_OUTPUT:Ae.CAN_CONNECT}doTypeChecks(e,i){if(e=e.getCheck(),i=i.getCheck(),!e||!i)return!0;for(let n=0;n<e.length;n++)if(i.includes(e[n]))return!0;return!1}doDragChecks(e,i,n){if(e.distanceFrom(i)>n||i.getSourceBlock().isInsertionMarker())return!1;switch(i.type){case le.PREVIOUS_STATEMENT:return this.canConnectToPrevious_(e,i);case le.OUTPUT_VALUE:if(i.isConnected()&&!i.targetBlock().isInsertionMarker()||e.isConnected())return!1;break;case le.INPUT_VALUE:if(i.isConnected()&&!i.targetBlock().isMovable()&&!i.targetBlock().isShadow())return!1;break;case le.NEXT_STATEMENT:if(i.isConnected()&&!e.getSourceBlock().nextConnection&&!i.targetBlock().isShadow()&&i.targetBlock().nextConnection||i.targetBlock()&&!i.targetBlock().isMovable()&&!i.targetBlock().isShadow())return!1;break;default:return!1}return!Lo.includes(i)}canConnectToPrevious_(e,i){return e.targetConnection||Lo.includes(i)?!1:i.targetConnection?(e=i.targetBlock(),e.isInsertionMarker()?!e.getPreviousBlock():!1):!0}};r(Z.CONNECTION_CHECKER,hi,sb);var yp=class extends Uo{constructor(e){super(e),this.type=W.VAR_DELETE,e&&(this.varType=e.type,this.varName=e.name)}toJson(){const e=super.toJson();if(this.varType===void 0)throw Error("The var type is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");return e.varType=this.varType,e.varName=this.varName,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new yp),i.varType=e.varType,i.varName=e.varName,i}run(e){const i=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.varName)throw Error("The var name is undefined. Either pass a variable to the constructor, or call fromJson");e?i.deleteVariableById(this.varId):i.createVariable(this.varName,this.varType,this.varId)}};r(Z.EVENT,W.VAR_DELETE,yp);var vp=class extends Uo{constructor(e,i){super(e),this.type=W.VAR_RENAME,e&&(this.oldName=e.name,this.newName=typeof i>"u"?"":i)}toJson(){const e=super.toJson();if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");return e.oldName=this.oldName,e.newName=this.newName,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new vp),i.oldName=e.oldName,i.newName=e.newName,i}run(e){const i=this.getEventWorkspace_();if(!this.varId)throw Error("The var ID is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.oldName)throw Error("The old var name is undefined. Either pass a variable to the constructor, or call fromJson");if(!this.newName)throw Error("The new var name is undefined. Either pass a value to the constructor, or call fromJson");e?i.renameVariableById(this.varId,this.newName):i.renameVariableById(this.varId,this.oldName)}};r(Z.EVENT,W.VAR_RENAME,vp);var Sp=class{constructor(e){this.workspace=e,this.variableMap=new Map}clear(){for(const e of this.variableMap.values())for(;0<e.length;)this.deleteVariable(e[0]);if(this.variableMap.size!==0)throw Error("Non-empty variable map")}renameVariable(e,i){if(e.name!==i){var n=this.getVariable(i,e.type),c=this.workspace.getAllBlocks(!1),d=s.getGroup$$module$build$src$core$events$utils();d||s.setGroup$$module$build$src$core$events$utils(!0);try{n&&n.getId()!==e.getId()?this.renameVariableWithConflict(e,i,n,c):this.renameVariableAndUses(e,i,c)}finally{s.setGroup$$module$build$src$core$events$utils(d)}}}renameVariableById(e,i){const n=this.getVariableById(e);if(!n)throw Error("Tried to rename a variable that didn't exist. ID: "+e);this.renameVariable(n,i)}renameVariableAndUses(e,i,n){for(z(new(he(W.VAR_RENAME))(e,i)),e.name=i,i=0;i<n.length;i++)n[i].updateVarName(e)}renameVariableWithConflict(e,i,n,c){const d=e.type;for(i!==n.name&&this.renameVariableAndUses(n,i,c),i=0;i<c.length;i++)c[i].renameVarById(e.getId(),n.getId());z(new(he(W.VAR_DELETE))(e)),$t(this.variableMap.get(d),e)}createVariable(e,i,n){var c=this.getVariable(e,i);if(c){if(n&&c.getId()!==n)throw Error('Variable "'+e+'" is already in use and its id is "'+c.getId()+'" which conflicts with the passed in id, "'+n+'".');return c}if(n&&this.getVariableById(n))throw Error('Variable id, "'+n+'", is already in use.');return c=n||v(),i=i||"",c=new Go(this.workspace,e,i,c),e=this.variableMap.get(i)||[],e.push(c),this.variableMap.delete(i),this.variableMap.set(i,e),z(new(he(W.VAR_CREATE))(c)),c}deleteVariable(e){const i=e.getId(),n=this.variableMap.get(e.type);if(n){for(let c=0;c<n.length;c++)if(n[c].getId()===i){n.splice(c,1),z(new(he(W.VAR_DELETE))(e)),n.length===0&&this.variableMap.delete(e.type);break}}}deleteVariableById(e){const i=this.getVariableById(e);if(i){var n=i.name;const c=this.getVariableUsesById(e);for(let d=0,m;m=c[d];d++)if(m.type==="procedures_defnoreturn"||m.type==="procedures_defreturn"){e=String(m.getFieldValue("NAME")),n=s.Msg$$module$build$src$core$msg.CANNOT_DELETE_VARIABLE_PROCEDURE.replace("%1",n).replace("%2",e),_o(n);return}1<c.length?(n=s.Msg$$module$build$src$core$msg.DELETE_VARIABLE_CONFIRMATION.replace("%1",String(c.length)).replace("%2",n),ia(n,d=>{d&&i&&this.deleteVariableInternal(i,c)})):this.deleteVariableInternal(i,c)}else console.warn("Can't delete non-existent variable: "+e)}deleteVariableInternal(e,i){const n=s.getGroup$$module$build$src$core$events$utils();n||s.setGroup$$module$build$src$core$events$utils(!0);try{for(let c=0;c<i.length;c++)i[c].dispose(!0);this.deleteVariable(e)}finally{s.setGroup$$module$build$src$core$events$utils(n)}}getVariable(e,i){if(i=this.variableMap.get(i||"")){for(let n=0,c;c=i[n];n++)if(s.Names$$module$build$src$core$names.equals(c.name,e))return c}return null}getVariableById(e){for(const i of this.variableMap.values())for(const n of i)if(n.getId()===e)return n;return null}getVariablesOfType(e){return(e=this.variableMap.get(e||""))?e.slice():[]}getVariableTypes(e){const i=new Set(this.variableMap.keys());if(e&&e.getPotentialVariableMap())for(const n of e.getPotentialVariableMap().variableMap.keys())i.add(n);return i.has("")||i.add(""),Array.from(i.values())}getAllVariables(){let e=[];for(const i of this.variableMap.values())e=e.concat(i);return e}getAllVariableNames(){return Array.from(this.variableMap.values()).flat().map(e=>e.name)}getVariableUsesById(e){const i=[],n=this.workspace.getAllBlocks(!1);for(let c=0;c<n.length;c++){const d=n[c].getVarModels();if(d)for(let m=0;m<d.length;m++)d[m].getId()===e&&i.push(n[c])}return i}},Wn=class{get isFlyout(){return this.internalIsFlyout}get isMutator(){return this.internalIsMutator}constructor(e){this.isClearing=this.internalIsMutator=this.internalIsFlyout=this.rendered=!1,this.MAX_UNDO=1024,this.connectionDBList=[],this.topBlocks=[],this.topComments=[],this.commentDB=new Map,this.listeners=[],this.undoStack_=[],this.redoStack_=[],this.blockDB=new Map,this.typedBlocksDB=new Map,this.procedureMap=new YT,this.potentialVariableMap=null,this.id=v(),ps(this),this.options=e||new As({}),this.RTL=!!this.options.RTL,this.horizontalLayout=!!this.options.horizontalLayout,this.toolboxPosition=this.options.toolboxPosition,this.connectionChecker=new(_(Z.CONNECTION_CHECKER,this.options,!0))(this),this.variableMap=new Sp(this)}dispose(){this.listeners.length=0,this.clear(),fs(this)}sortObjects(e,i){const n=Math.sin(aa(Wn.SCAN_ANGLE))*(this.RTL?-1:1);return e=e.getRelativeToSurfaceXY(),i=i.getRelativeToSurfaceXY(),e.y+n*e.x-(i.y+n*i.x)}addTopBlock(e){this.topBlocks.push(e)}removeTopBlock(e){if(!$t(this.topBlocks,e))throw Error("Block not present in workspace's list of top-most blocks.")}getTopBlocks(e=!1){const i=[].concat(this.topBlocks);return e&&1<i.length&&i.sort(this.sortObjects.bind(this)),i}addTypedBlock(e){this.typedBlocksDB.has(e.type)||this.typedBlocksDB.set(e.type,[]),this.typedBlocksDB.get(e.type).push(e)}removeTypedBlock(e){$t(this.typedBlocksDB.get(e.type),e),this.typedBlocksDB.get(e.type).length||this.typedBlocksDB.delete(e.type)}getBlocksByType(e,i=!1){return this.typedBlocksDB.has(e)?(e=this.typedBlocksDB.get(e).slice(0),i&&e&&1<e.length&&e.sort(this.sortObjects.bind(this)),e.filter(n=>!n.isInsertionMarker())):[]}addTopComment(e){this.topComments.push(e),this.commentDB.has(e.id)&&console.warn('Overriding an existing comment on this workspace, with id "'+e.id+'"'),this.commentDB.set(e.id,e)}removeTopComment(e){if(!$t(this.topComments,e))throw Error("Comment not present in workspace's list of top-most comments.");this.commentDB.delete(e.id)}getTopComments(e=!1){const i=[].concat(this.topComments);return e&&1<i.length&&i.sort(this.sortObjects.bind(this)),i}getAllBlocks(e=!1){if(e){var i=this.getTopBlocks(!0);e=[];for(let n=0;n<i.length;n++)e.push(...i[n].getDescendants(!0))}else for(e=this.getTopBlocks(!1),i=0;i<e.length;i++)e.push(...e[i].getChildren(!1));return e.filter(n=>!n.isInsertionMarker())}clear(){this.isClearing=!0;try{const e=s.getGroup$$module$build$src$core$events$utils();for(e||s.setGroup$$module$build$src$core$events$utils(!0);this.topBlocks.length;)this.topBlocks[0].dispose(!1);for(;this.topComments.length;)this.topComments[this.topComments.length-1].dispose();s.setGroup$$module$build$src$core$events$utils(e),this.variableMap.clear(),this.potentialVariableMap&&this.potentialVariableMap.clear()}finally{this.isClearing=!1}}renameVariableById(e,i){this.variableMap.renameVariableById(e,i)}createVariable(e,i,n){return this.variableMap.createVariable(e,i,n)}getVariableUsesById(e){return this.variableMap.getVariableUsesById(e)}deleteVariableById(e){this.variableMap.deleteVariableById(e)}getVariable(e,i){return this.variableMap.getVariable(e,i)}getVariableById(e){return this.variableMap.getVariableById(e)}getVariablesOfType(e){return this.variableMap.getVariablesOfType(e)}getVariableTypes(){return this.variableMap.getVariableTypes(this)}getAllVariables(){return this.variableMap.getAllVariables()}getAllVariableNames(){return this.variableMap.getAllVariableNames()}getWidth(){return 0}newBlock(e,i){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}remainingCapacity(){return isNaN(this.options.maxBlocks)?1/0:this.options.maxBlocks-this.getAllBlocks(!1).length}remainingCapacityOfType(e){return this.options.maxInstances?(this.options.maxInstances[e]!==void 0?this.options.maxInstances[e]:1/0)-this.getBlocksByType(e,!1).length:1/0}isCapacityAvailable(e){if(!this.hasBlockLimits())return!0;let i=0;for(const n in e){if(e[n]>this.remainingCapacityOfType(n))return!1;i+=e[n]}return!(i>this.remainingCapacity())}hasBlockLimits(){return this.options.maxBlocks!==1/0||!!this.options.maxInstances}getUndoStack(){return this.undoStack_}getRedoStack(){return this.redoStack_}undo(e){var i=e?this.redoStack_:this.undoStack_,n=e?this.undoStack_:this.redoStack_;const c=i.pop();if(c){for(var d=[c];i.length&&c.group&&c.group===i[i.length-1].group;){const m=i.pop();m&&d.push(m)}for(i=0;i<d.length;i++)n.push(d[i]);s.setRecordUndo$$module$build$src$core$events$utils(!1);try{for(n=0;n<d.length;n++)d[n].run(e)}finally{s.setRecordUndo$$module$build$src$core$events$utils(!0)}}}clearUndo(){this.undoStack_.length=0,this.redoStack_.length=0,ge()}addChangeListener(e){return this.listeners.push(e),e}removeChangeListener(e){$t(this.listeners,e)}fireChangeListener(e){if(e.recordUndo)for(this.undoStack_.push(e),this.redoStack_.length=0;this.undoStack_.length>this.MAX_UNDO&&0<=this.MAX_UNDO;)this.undoStack_.shift();for(let i=0;i<this.listeners.length;i++)(0,this.listeners[i])(e)}getBlockById(e){return this.blockDB.get(e)||null}setBlockById(e,i){this.blockDB.set(e,i)}removeBlockById(e){this.blockDB.delete(e)}getCommentById(e){let i;return(i=this.commentDB.get(e))!=null?i:null}allInputsFilled(e){const i=this.getTopBlocks(!1);for(let n=0;n<i.length;n++)if(!i[n].allInputsFilled(e))return!1;return!0}getPotentialVariableMap(){return this.potentialVariableMap}createPotentialVariableMap(){this.potentialVariableMap=new Sp(this)}getVariableMap(){return this.variableMap}setVariableMap(e){this.variableMap=e}getProcedureMap(){return this.procedureMap}getRootWorkspace(){let e=null;const i=this.options.parentWorkspace;return this.isFlyout?i&&i.options&&(e=i.options.parentWorkspace):i&&(e=i),e}static getById(e){return pt(e)}static getAll(){return Kt()}};Wn.SCAN_ANGLE=3;var gC=100,ib=class{constructor(e){this.parentWorkspace=e,this.sounds=new Map,this.lastSound=null,this.muted=!1}dispose(){this.sounds.clear()}load(e,i){if(e.length){try{var n=new globalThis.Audio}catch{return}for(let d=0;d<e.length;d++){const m=e[d],y=m.match(/\.(\w+)$/);if(y&&n.canPlayType("audio/"+y[1])){var c=new globalThis.Audio(m);break}}c&&this.sounds.set(i,c)}}preload(){for(const e of this.sounds.values()){e.volume=.01;const i=e.play();if(i!==void 0?i.then(e.pause).catch(function(){}):e.pause(),Fa||q$)break}}play(e,i){if(!this.muted){var n=this.sounds.get(e);n?(e=new Date,this.lastSound!==null&&e.getTime()-this.lastSound.getTime()<gC||(this.lastSound=e,n=Fa||xd?n:n.cloneNode(),n.volume=i===void 0?1:i,n.play())):this.parentWorkspace&&this.parentWorkspace.getAudioManager().play(e,i)}}setMuted(e){this.muted=e}getMuted(){return this.muted}},mC=20,Es=class extends Wn{constructor(e){super(e),this.resizeHandlerWrapper=null,this.resizesEnabled=this.visible=this.rendered=!0,this.startScrollY=this.startScrollX=this.scrollY=this.scrollX=0,this.oldScale=this.scale=1,this.oldLeft=this.oldTop=0,this.inverseScreenCTM=this.targetWorkspace=this.dummyWheelListener=this.configureContextMenu=this.lastRecordedPageScroll=this.injectionDiv=this.currentGesture_=this.toolbox=this.flyout=this.scrollbar=this.trashcan=null,this.inverseScreenCTMDirty=!0,this.highlightedBlocks=[],this.toolboxCategoryCallbacks=new Map,this.flyoutButtonCallbacks=new Map,this.cachedParentSvg=null,this.keyboardAccessibilityMode=!1,this.topBoundedElements=[],this.dragTargetAreas=[],this.zoomControls_=this.layerManager=null,this.metricsManager=new(_(Z.METRICS_MANAGER,e,!0))(this),this.getMetrics=e.getMetrics||this.metricsManager.getMetrics.bind(this.metricsManager),this.setMetrics=e.setMetrics||Es.setTopLevelWorkspaceMetrics,this.componentManager=new et,this.connectionDBList=Un.init(this.connectionChecker),this.audioManager=new ib(e.parentWorkspace),this.grid=this.options.gridPattern?new op(this.options.gridPattern,e.gridOptions):null,this.markerManager=new Wo(this),At&&na&&this.registerToolboxCategoryCallback(Wd,na),zr&&ka&&this.registerToolboxCategoryCallback(Tp,ka),ts&&wa&&(this.registerToolboxCategoryCallback(dc,wa),this.addChangeListener(Lu)),this.themeManager_=this.options.parentWorkspace?this.options.parentWorkspace.getThemeManager():new eb(this,this.options.theme||lc),this.themeManager_.subscribeWorkspace(this);let i;this.renderer=Du(this.options.renderer||"geras",this.getTheme(),(i=this.options.rendererOverrides)!=null?i:void 0),this.cachedParentSvgSize=new Oe(0,0)}getMarkerManager(){return this.markerManager}getMetricsManager(){return this.metricsManager}setMetricsManager(e){this.metricsManager=e,this.getMetrics=this.metricsManager.getMetrics.bind(this.metricsManager)}getComponentManager(){return this.componentManager}setCursorSvg(e){this.markerManager.setCursorSvg(e)}setMarkerSvg(e){this.markerManager.setMarkerSvg(e)}getMarker(e){return this.markerManager?this.markerManager.getMarker(e):null}getCursor(){return this.markerManager?this.markerManager.getCursor():null}getRenderer(){return this.renderer}getThemeManager(){return this.themeManager_}getTheme(){return this.themeManager_.getTheme()}setTheme(e){e||(e=lc),this.themeManager_.setTheme(e)}refreshTheme(){this.svgGroup_&&this.renderer.refreshDom(this.svgGroup_,this.getTheme()),this.updateBlockStyles(this.getAllBlocks(!1).filter(i=>!!i.getStyleName())),this.refreshToolboxSelection(),this.toolbox&&this.toolbox.refreshTheme(),this.isVisible()&&this.setVisible(!0);const e=new(he(W.THEME_CHANGE))(this.getTheme().name,this.id);z(e)}updateBlockStyles(e){for(let i=0,n;n=e[i];i++){const c=n.getStyleName();c&&n.setStyle(c)}}getInverseScreenCTM(){if(this.inverseScreenCTMDirty){const e=this.getParentSvg().getScreenCTM();e&&(this.inverseScreenCTM=e.inverse(),this.inverseScreenCTMDirty=!1)}return this.inverseScreenCTM}updateInverseScreenCTM(){this.inverseScreenCTMDirty=!0}isVisible(){return this.visible}getSvgXY(e){let i=0,n=0,c=1;(this.getCanvas().contains(e)||this.getBubbleCanvas().contains(e))&&(c=this.scale);do{const d=uo(e);(e===this.getCanvas()||e===this.getBubbleCanvas())&&(c=1),i+=d.x*c,n+=d.y*c,e=e.parentNode}while(e&&e!==this.getParentSvg()&&e!==this.getInjectionDiv());return new te(i,n)}getCachedParentSvgSize(){const e=this.cachedParentSvgSize;return new Oe(e.width,e.height)}getOriginOffsetInPixels(){return Yl(this.getCanvas())}getInjectionDiv(){if(!this.injectionDiv){let e=this.svgGroup_;for(;e;){if((" "+(e.getAttribute("class")||"")+" ").includes(" injectionDiv ")){this.injectionDiv=e;break}e=e.parentNode}}return this.injectionDiv}getSvgGroup(){return this.svgGroup_}getBlockCanvas(){return this.getCanvas()}setResizeHandlerWrapper(e){this.resizeHandlerWrapper=e}createDom(e,i){return this.injectionDiv||(this.injectionDiv=i??null),this.svgGroup_=Y(U.G,{class:"blocklyWorkspace"}),e&&(this.svgBackground_=Y(U.RECT,{height:"100%",width:"100%",class:e},this.svgGroup_),e==="blocklyMainBackground"&&this.grid?this.svgBackground_.style.fill="url(#"+this.grid.getPatternId()+")":this.themeManager_.subscribe(this.svgBackground_,"workspaceBackgroundColour","fill")),this.layerManager=new lC(this),this.svgBlockCanvas_=this.layerManager.getBlockLayer(),this.svgBubbleCanvas_=this.layerManager.getBubbleLayer(),this.isFlyout||(fe(this.svgGroup_,"pointerdown",this,this.onMouseDown,!1),this.dummyWheelListener=()=>{},document.body.addEventListener("wheel",this.dummyWheelListener),fe(this.svgGroup_,"wheel",this,this.onMouseWheel)),this.options.hasCategories&&(this.toolbox=new(_(Z.TOOLBOX,this.options,!0))(this)),this.grid&&this.grid.update(this.scale),this.recordDragTargets(),(e=_(Z.CURSOR,this.options))&&this.markerManager.setCursor(new e),this.renderer.createDom(this.svgGroup_,this.getTheme()),this.svgGroup_}dispose(){if(this.rendered=!1,this.currentGesture_&&this.currentGesture_.cancel(),this.svgGroup_&&F(this.svgGroup_),this.toolbox&&(this.toolbox.dispose(),this.toolbox=null),this.flyout&&(this.flyout.dispose(),this.flyout=null),this.trashcan&&(this.trashcan.dispose(),this.trashcan=null),this.scrollbar&&(this.scrollbar.dispose(),this.scrollbar=null),this.zoomControls_&&this.zoomControls_.dispose(),this.audioManager&&this.audioManager.dispose(),this.grid&&(this.grid=null),this.renderer.dispose(),this.markerManager&&this.markerManager.dispose(),super.dispose(),this.themeManager_&&(this.themeManager_.unsubscribeWorkspace(this),this.themeManager_.unsubscribe(this.svgBackground_),this.options.parentWorkspace||this.themeManager_.dispose()),this.connectionDBList.length=0,this.toolboxCategoryCallbacks.clear(),this.flyoutButtonCallbacks.clear(),!this.options.parentWorkspace){const e=this.getParentSvg();e&&e.parentNode&&F(e.parentNode)}this.resizeHandlerWrapper&&(Ue(this.resizeHandlerWrapper),this.resizeHandlerWrapper=null),this.dummyWheelListener&&(document.body.removeEventListener("wheel",this.dummyWheelListener),this.dummyWheelListener=null)}addTrashcan(){this.trashcan=Es.newTrashcan(this);const e=this.trashcan.createDom();this.svgGroup_.insertBefore(e,this.getCanvas())}static newTrashcan(e){throw Error("The implementation of newTrashcan should be monkey-patched in by blockly.ts")}addZoomControls(){this.zoomControls_=new lT(this);const e=this.zoomControls_.createDom();this.svgGroup_.appendChild(e)}addFlyout(e){const i=new As({parentWorkspace:this,rtl:this.RTL,oneBasedIndex:this.options.oneBasedIndex,horizontalLayout:this.horizontalLayout,renderer:this.options.renderer,rendererOverrides:this.options.rendererOverrides,move:{scrollbars:!0}});return i.toolboxPosition=this.options.toolboxPosition,this.flyout=this.horizontalLayout?new(_(Z.FLYOUTS_HORIZONTAL_TOOLBOX,this.options,!0))(i):new(_(Z.FLYOUTS_VERTICAL_TOOLBOX,this.options,!0))(i),this.flyout.autoClose=!1,this.flyout.getWorkspace().setVisible(!0),this.flyout.createDom(e)}getFlyout(e){return this.flyout||e?this.flyout:this.toolbox?this.toolbox.getFlyout():null}getToolbox(){return this.toolbox}updateScreenCalculations(){this.updateInverseScreenCTM(),this.recordDragTargets()}resizeContents(){this.resizesEnabled&&this.rendered&&(this.scrollbar&&this.scrollbar.resize(),this.updateInverseScreenCTM())}resize(){this.toolbox&&this.toolbox.position(),this.flyout&&this.flyout.position();const e=this.componentManager.getComponents(et.Capability.POSITIONABLE,!0),i=this.getMetricsManager().getUiMetrics(),n=[];for(let c=0,d;d=e[c];c++){d.position(i,n);const m=d.getBoundingRectangle();m&&n.push(m)}this.scrollbar&&this.scrollbar.resize(),this.updateScreenCalculations()}updateScreenCalculationsIfScrolled(){const e=yh();te.equals(this.lastRecordedPageScroll,e)||(this.lastRecordedPageScroll=e,this.updateScreenCalculations())}getLayerManager(){return this.layerManager}getCanvas(){return this.layerManager.getBlockLayer()}setCachedParentSvgSize(e,i){const n=this.getParentSvg();e!=null&&(this.cachedParentSvgSize.width=e,n.setAttribute("data-cached-width",`${e}`)),i!=null&&(this.cachedParentSvgSize.height=i,n.setAttribute("data-cached-height",`${i}`))}getBubbleCanvas(){return this.layerManager.getBubbleLayer()}getParentSvg(){if(!this.cachedParentSvg){let e=this.svgGroup_;for(;e;){if(e.tagName==="svg"){this.cachedParentSvg=e;break}e=e.parentNode}}return this.cachedParentSvg}maybeFireViewportChangeEvent(){if(ue()){var e=this.scale,i=-this.scrollY,n=-this.scrollX;if(!(e===this.oldScale&&1>Math.abs(i-this.oldTop)&&1>Math.abs(n-this.oldLeft))){var c=new(he(W.VIEWPORT_CHANGE))(i,n,e,this.id,this.oldScale);this.oldScale=e,this.oldTop=i,this.oldLeft=n,z(c)}}}translate(e,i){let n;(n=this.layerManager)==null||n.translateLayers(new te(e,i),this.scale);let c;(c=this.grid)==null||c.moveTo(e,i),this.maybeFireViewportChangeEvent()}getWidth(){const e=this.getMetrics();return e?e.viewWidth/this.scale:0}setVisible(e){this.visible=e,this.svgGroup_&&(this.scrollbar&&this.scrollbar.setContainerVisible(e),this.getFlyout()&&this.getFlyout().setContainerVisible(e),this.getParentSvg().style.display=e?"block":"none",this.toolbox&&this.toolbox.setVisible(e),e||this.hideChaff(!0))}render(){const e=this.getAllBlocks(!1);for(let i=e.length-1;0<=i;i--)e[i].queueRender();this.getTopBlocks().flatMap(i=>i.getDescendants(!1)).filter(i=>i.isInsertionMarker()).forEach(i=>i.queueRender()),Gs().then(()=>void this.markerManager.updateMarkers())}highlightBlock(e,i){if(i===void 0){for(let n=0,c;c=this.highlightedBlocks[n];n++)c.setHighlighted(!1);this.highlightedBlocks.length=0}(e=e?this.getBlockById(e):null)&&((i=i===void 0||i)?this.highlightedBlocks.includes(e)||this.highlightedBlocks.push(e):$t(this.highlightedBlocks,e),e.setHighlighted(i))}refreshToolboxSelection(){const e=this.isFlyout?this.targetWorkspace:this;e&&!e.currentGesture_&&e.toolbox&&e.toolbox.getFlyout()&&e.toolbox.refreshSelection()}renameVariableById(e,i){super.renameVariableById(e,i),this.refreshToolboxSelection()}deleteVariableById(e){super.deleteVariableById(e),this.refreshToolboxSelection()}createVariable(e,i,n){return e=super.createVariable(e,i,n),this.refreshToolboxSelection(),e}recordDragTargets(){const e=this.componentManager.getComponents(et.Capability.DRAG_TARGET,!0);this.dragTargetAreas=[];for(let i=0,n;n=e[i];i++){const c=n.getClientRect();c&&this.dragTargetAreas.push({component:n,clientRect:c})}}newBlock(e,i){throw Error("The implementation of newBlock should be monkey-patched in by blockly.ts")}newComment(e){throw Error("The implementation of newComment should be monkey-patched in by blockly.ts")}getDragTarget(e){for(let i=0,n;n=this.dragTargetAreas[i];i++)if(n.clientRect.contains(e.clientX,e.clientY))return n.component;return null}onMouseDown(e){const i=this.getGesture(e);i&&i.handleWsStart(e,this)}startDrag(e,i){$a(this,e,i)}moveDrag(e){return Ta(this,e)}isDragging(){return this.currentGesture_!==null&&this.currentGesture_.isDragging()}isDraggable(){return this.options.moveOptions&&this.options.moveOptions.drag}isMovable(){return this.options.moveOptions&&!!this.options.moveOptions.scrollbars||this.options.moveOptions&&this.options.moveOptions.wheel||this.options.moveOptions&&this.options.moveOptions.drag||this.options.zoomOptions&&this.options.zoomOptions.wheel||this.options.zoomOptions&&this.options.zoomOptions.pinch}isMovableHorizontally(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollHorizontally())}isMovableVertically(){const e=!!this.scrollbar;return this.isMovable()&&(!e||e&&this.scrollbar.canScrollVertically())}onMouseWheel(e){if(Li.inProgress())e.preventDefault(),e.stopPropagation();else{var i=this.options.zoomOptions&&this.options.zoomOptions.wheel,n=this.options.moveOptions&&this.options.moveOptions.wheel;if(i||n){var c=ri(e);if(Cd)var d=e.metaKey;i&&(e.ctrlKey||d||!n)?(c=-c.y/50,i=P(e,this.getParentSvg(),this.getInverseScreenCTM()),this.zoom(i.x,i.y,c)):(i=this.scrollX-c.x,n=this.scrollY-c.y,e.shiftKey&&!c.x&&(i=this.scrollX-c.y,n=this.scrollY),this.scroll(i,n)),e.preventDefault()}}}getBlocksBoundingBox(){const e=this.getTopBoundedElements();if(!e.length)return new Ve(0,0,0,0);const i=e[0].getBoundingRectangle();for(let c=1;c<e.length;c++){var n=e[c];n.isInsertionMarker&&n.isInsertionMarker()||(n=n.getBoundingRectangle(),n.top<i.top&&(i.top=n.top),n.bottom>i.bottom&&(i.bottom=n.bottom),n.left<i.left&&(i.left=n.left),n.right>i.right&&(i.right=n.right))}return i}cleanUp(){this.setResizesEnabled(!1),s.setGroup$$module$build$src$core$events$utils(!0);var e=this.getTopBlocks(!0),i=e.filter(m=>m.isMovable());const n=e.filter(m=>!m.isMovable()).map(m=>m.getBoundingRectangle());e=function(m){for(const y of n)if(m.intersects(y))return y;return null};var c=0;const d=this.renderer.getConstants().MIN_BLOCK_HEIGHT;for(const m of i){for(i=m.getBoundingRectangle(),m.moveBy(-i.left,c-i.top,["cleanup"]),m.snapToGrid(),i=m.getBoundingRectangle(),c=e(i);c!=null;)c=c.top+c.getHeight()+d,m.moveBy(0,c-i.top,["cleanup"]),m.snapToGrid(),i=m.getBoundingRectangle(),c=e(i);c=m.getRelativeToSurfaceXY().y+m.getHeightWidth().height+d}s.setGroup$$module$build$src$core$events$utils(!1),this.setResizesEnabled(!0)}showContextMenu(e){if(!this.options.readOnly&&!this.isFlyout){var i=Ce.registry.getContextMenuOptions(Ce.ScopeType.WORKSPACE,{workspace:this});this.configureContextMenu&&this.configureContextMenu(i,e),So(e,i,this.RTL,this)}}updateToolbox(e){if(e=Kl(e)){if(!this.options.languageTree)throw Error("Existing toolbox is null.  Can't create new toolbox.");if(jl(e)){if(!this.toolbox)throw Error("Existing toolbox has no categories.  Can't change mode.");this.options.languageTree=e,this.toolbox.render(e)}else{if(!this.flyout)throw Error("Existing toolbox has categories.  Can't change mode.");this.options.languageTree=e,this.flyout.show(e)}}else if(this.options.languageTree)throw Error("Can't nullify an existing toolbox.")}markFocused(){this.options.parentWorkspace?this.options.parentWorkspace.markFocused():(Ft(this),this.getParentSvg().focus({preventScroll:!0}))}zoom(e,i,n){n=Math.pow(this.options.zoomOptions.scaleSpeed,n);const c=this.scale*n;if(this.scale!==c){c>this.options.zoomOptions.maxScale?n=this.options.zoomOptions.maxScale/this.scale:c<this.options.zoomOptions.minScale&&(n=this.options.zoomOptions.minScale/this.scale);var d=this.getCanvas().getCTM(),m=this.getParentSvg().createSVGPoint();m.x=e,m.y=i,m=m.matrixTransform(d.inverse()),e=m.x,i=m.y,d=d.translate(e*(1-n),i*(1-n)).scale(n),this.scrollX=d.e,this.scrollY=d.f,this.setScale(c)}}zoomCenter(e){var i=this.getMetrics();let n;this.flyout?(n=i.svgWidth?i.svgWidth/2:0,i=i.svgHeight?i.svgHeight/2:0):(n=i.viewWidth/2+i.absoluteLeft,i=i.viewHeight/2+i.absoluteTop),this.zoom(n,i,e)}zoomToFit(){if(this.isMovable()){var e=this.getMetrics(),i=e.viewWidth;e=e.viewHeight;var n=this.getBlocksBoundingBox(),c=2*mC,d=n.right-n.left+c;if(n=n.bottom-n.top+c,d){this.flyout&&(this.horizontalLayout?(e+=this.flyout.getHeight(),n+=this.flyout.getHeight()/this.scale):(i+=this.flyout.getWidth(),d+=this.flyout.getWidth()/this.scale)),i/=d,e/=n,s.disable$$module$build$src$core$events$utils();try{this.setScale(Math.min(i,e)),this.scrollCenter()}finally{s.enable$$module$build$src$core$events$utils()}this.maybeFireViewportChangeEvent()}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}beginCanvasTransition(){re(this.getCanvas(),"blocklyCanvasTransitioning"),re(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}endCanvasTransition(){S(this.getCanvas(),"blocklyCanvasTransitioning"),S(this.getBubbleCanvas(),"blocklyCanvasTransitioning")}scrollCenter(){if(this.isMovable()){var e=this.getMetrics(),i=(e.scrollWidth-e.viewWidth)/2,n=(e.scrollHeight-e.viewHeight)/2;i=-i-e.scrollLeft,n=-n-e.scrollTop,this.scroll(i,n)}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}centerOnBlock(e,i){if(this.isMovable()){var n=e?this.getBlockById(e):null;if(n){e=n.getRelativeToSurfaceXY(),n=i?{height:n.height,width:n.width}:n.getHeightWidth();var c=this.scale;i=(e.x+(this.RTL?-1:1)*n.width/2)*c,e=(e.y+n.height/2)*c,n=this.getMetrics(),this.scroll(-(i-n.viewWidth/2),-(e-n.viewHeight/2))}}else console.warn("Tried to move a non-movable workspace. This could result in blocks becoming inaccessible.")}setScale(e){this.options.zoomOptions.maxScale&&e>this.options.zoomOptions.maxScale?e=this.options.zoomOptions.maxScale:this.options.zoomOptions.minScale&&e<this.options.zoomOptions.minScale&&(e=this.options.zoomOptions.minScale),this.scale=e,this.hideChaff(!1),(e=this.getFlyout(!1))&&e.isVisible()&&(e.reflow(),this.recordDragTargets()),this.grid&&this.grid.update(this.scale),e=this.getMetrics(),this.scrollX-=e.absoluteLeft,this.scrollY-=e.absoluteTop,e.viewLeft+=e.absoluteLeft,e.viewTop+=e.absoluteTop,this.scroll(this.scrollX,this.scrollY),this.scrollbar&&(this.flyout?this.scrollbar.resizeView(e):this.scrollbar.resizeContent(e))}getScale(){return this.options.parentWorkspace?this.options.parentWorkspace.getScale():this.scale}scroll(e,i){this.hideChaff(!0);const n=this.getMetrics();e=Math.min(e,-n.scrollLeft),i=Math.min(i,-n.scrollTop);const c=n.scrollTop+Math.max(0,n.scrollHeight-n.viewHeight);e=Math.max(e,-(n.scrollLeft+Math.max(0,n.scrollWidth-n.viewWidth))),i=Math.max(i,-c),this.scrollX=e,this.scrollY=i,this.scrollbar&&this.scrollbar.set(-(e+n.scrollLeft),-(i+n.scrollTop),!1),e+=n.absoluteLeft,i+=n.absoluteTop,this.translate(e,i)}getBlockById(e){return super.getBlockById(e)}getAllBlocks(e=!1){return super.getAllBlocks(e)}getTopBlocks(e=!1){return super.getTopBlocks(e)}addTopBlock(e){this.addTopBoundedElement(e),super.addTopBlock(e)}removeTopBlock(e){this.removeTopBoundedElement(e),super.removeTopBlock(e)}addTopComment(e){this.addTopBoundedElement(e),super.addTopComment(e)}removeTopComment(e){this.removeTopBoundedElement(e),super.removeTopComment(e)}getRootWorkspace(){return super.getRootWorkspace()}addTopBoundedElement(e){this.topBoundedElements.push(e)}removeTopBoundedElement(e){$t(this.topBoundedElements,e)}getTopBoundedElements(){return[].concat(this.topBoundedElements)}setResizesEnabled(e){const i=!this.resizesEnabled&&e;this.resizesEnabled=e,i&&this.resizeContents()}clear(){this.setResizesEnabled(!1),super.clear(),this.topBoundedElements=[],this.setResizesEnabled(!0)}registerButtonCallback(e,i){if(typeof i!="function")throw TypeError("Button callbacks must be functions.");this.flyoutButtonCallbacks.set(e,i)}getButtonCallback(e){let i;return(i=this.flyoutButtonCallbacks.get(e))!=null?i:null}removeButtonCallback(e){this.flyoutButtonCallbacks.delete(e)}registerToolboxCategoryCallback(e,i){if(typeof i!="function")throw TypeError("Toolbox category callbacks must be functions.");this.toolboxCategoryCallbacks.set(e,i)}getToolboxCategoryCallback(e){return this.toolboxCategoryCallbacks.get(e)||null}removeToolboxCategoryCallback(e){this.toolboxCategoryCallbacks.delete(e)}getGesture(e){const i=e.type==="pointerdown",n=this.currentGesture_;return n?i&&n.hasStarted()?(console.warn("Tried to start the same gesture twice."),n.cancel(),null):n:i?this.currentGesture_=new Li(e,this):null}clearGesture(){this.currentGesture_=null}cancelCurrentGesture(){this.currentGesture_&&this.currentGesture_.cancel()}getAudioManager(){return this.audioManager}getGrid(){return this.grid}hideChaff(e=!1){xi(),vo(this),oi(),this.hideComponents(e)}hideComponents(e=!1){this.getComponentManager().getComponents(et.Capability.AUTOHIDEABLE,!0).forEach(i=>i.autoHide(e))}static setTopLevelWorkspaceMetrics(e){const i=this.getMetrics();typeof e.x=="number"&&(this.scrollX=-(i.scrollLeft+(i.scrollWidth-i.viewWidth)*e.x)),typeof e.y=="number"&&(this.scrollY=-(i.scrollTop+(i.scrollHeight-i.viewHeight)*e.y)),this.translate(this.scrollX+i.absoluteLeft,this.scrollY+i.absoluteTop)}},Ip=class extends Hs{constructor(e,i,n){super(n),this.type=W.SELECTED,this.oldElementId=e??void 0,this.newElementId=i??void 0}toJson(){const e=super.toJson();return e.oldElementId=this.oldElementId,e.newElementId=this.newElementId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Ip),i.oldElementId=e.oldElementId,i.newElementId=e.newElementId,i}};r(Z.EVENT,W.SELECTED,Ip);var tl=class{paste(e,i,n){if(!i.isCapacityAvailable(e.typeCounts))return null;n&&(e.blockState.x=n.x,e.blockState.y=n.y),n=n||new te(e.blockState.x||0,e.blockState.y||0),s.disable$$module$build$src$core$events$utils();let c;try{c=Ii(e.blockState,i),a$(c,n)}finally{s.enable$$module$build$src$core$events$utils()}return c&&(ue()&&!c.isShadow()&&z(new(he(W.BLOCK_CREATE))(c)),s.setSelected$$module$build$src$core$common(c),c)}};tl.TYPE="block",ta(tl.TYPE,new tl);var $c={};$c.bumpIntoBounds=xn,$c.bumpIntoBoundsHandler=Hu,$c.bumpTopObjectsIntoBounds=Oa;var rb=class{constructor(e){this.block=e,this.connectionPreviewer=this.connectionCandidate=this.startLoc=this.startChildConn=this.startParentConn=null,this.dragging=!1,this.dragOffset=new te(0,0),this.inGroup=!1,this.workspace=e.workspace}isMovable(){if(this.block.isShadow()){let e,i;return(i=(e=this.block.getParent())==null?void 0:e.isMovable())!=null?i:!1}return this.block.isOwnMovable()&&!this.block.isDeadOrDying()&&!this.workspace.options.readOnly&&!this.block.isInFlyout}startDrag(e){if(this.block.isShadow())this.startDraggingShadow(e);else{this.dragging=!0,(this.inGroup=!!s.getGroup$$module$build$src$core$events$utils())||s.setGroup$$module$build$src$core$events$utils(!0),this.fireDragStartEvent(),this.startLoc=this.block.getRelativeToSurfaceXY(),this.connectionCandidate=null,this.connectionPreviewer=new(_(Z.CONNECTION_PREVIEWER,this.workspace.options))(this.block),Gt(),this.workspace.setResizesEnabled(!1),Sn(),e=!!e&&(e.altKey||e.ctrlKey||e.metaKey),this.shouldDisconnect(e)&&this.disconnectBlock(e),this.block.setDragging(!0);var i;(i=this.workspace.getLayerManager())==null||i.moveToDragLayer(this.block)}}startDraggingShadow(e){const i=this.block.getParent();if(!i)throw Error("Tried to drag a shadow block with no parent. Shadow blocks should always have parents.");this.dragOffset=te.difference(i.getRelativeToSurfaceXY(),this.block.getRelativeToSurfaceXY()),i.startDrag(e)}shouldDisconnect(e){return!!(this.block.getParent()||e&&this.block.nextConnection&&this.block.nextConnection.targetBlock())}disconnectBlock(e){let i,n,c;if(this.startParentConn=(c=(i=this.block.outputConnection)==null?void 0:i.targetConnection)!=null?c:(n=this.block.previousConnection)==null?void 0:n.targetConnection,e){let d;this.startChildConn=(d=this.block.nextConnection)==null?void 0:d.targetConnection}this.block.unplug(e),Iu(this.block)}fireDragStartEvent(){const e=new(he(W.BLOCK_DRAG))(this.block,!0,this.block.getDescendants(!1));z(e)}fireDragEndEvent(){const e=new(he(W.BLOCK_DRAG))(this.block,!1,this.block.getDescendants(!1));z(e)}fireMoveEvent(){if(!this.block.isDeadOrDying()){var e=new(he(W.BLOCK_MOVE))(this.block);e.setReason(["drag"]),e.oldCoordinate=this.startLoc,e.recordNew(),z(e)}}drag(e){if(this.block.isShadow()){let i;(i=this.block.getParent())==null||i.drag(te.sum(e,this.dragOffset))}else this.block.moveDuringDrag(e),this.updateConnectionPreview(this.block,te.difference(e,this.startLoc))}updateConnectionPreview(e,i){var n=this.connectionCandidate;const c=this.getConnectionCandidate(e,i);if(c){this.connectionCandidate=i=n&&this.currCandidateIsBetter(n,i,c)?n:c;var{local:d,neighbour:m}=i;i=d.type===le.OUTPUT_VALUE||d.type===le.PREVIOUS_STATEMENT,n=m.isConnected()&&!m.targetBlock().isInsertionMarker(),i&&n&&!this.orphanCanConnectAtEnd(e,m.targetBlock(),d.type)?this.connectionPreviewer.previewReplacement(d,m,m.targetBlock()):this.connectionPreviewer.previewConnection(d,m)}else this.connectionPreviewer.hidePreview(),this.connectionCandidate=null}orphanCanConnectAtEnd(e,i,n){return!!Ae.getConnectionForOrphanedConnection(e,n===le.OUTPUT_VALUE?i.outputConnection:i.previousConnection)}currCandidateIsBetter(e,i,n){const{local:c,neighbour:d}=e;e=new te(c.x,c.y);const m=new te(d.x,d.y);return i=te.distance(te.sum(e,i),m),n.distance>i-s.config$$module$build$src$core$config.currentConnectionPreference}getConnectionCandidate(e,i){e=this.getLocalConnections(e);let n=this.connectionCandidate?s.config$$module$build$src$core$config.connectingSnapRadius:s.config$$module$build$src$core$config.snapRadius,c=null;for(const d of e){const{connection:m,radius:y}=d.closest(n,i);m&&(c={local:d,neighbour:m,distance:y},n=y)}return c}getLocalConnections(e){const i=e.getConnections_(!1),n=e.lastConnectionInStack(!0);return n&&n!==e.nextConnection&&i.push(n),i}endDrag(e){if(this.block.isShadow()){let i;(i=this.block.getParent())==null||i.endDrag(e)}else{if(this.fireDragEndEvent(),this.fireMoveEvent(),ni(),Sn(),this.connectionPreviewer.hidePreview(),!this.block.isDeadOrDying()&&this.dragging){let i;(i=this.workspace.getLayerManager())==null||i.moveOffDragLayer(this.block,lr),this.block.setDragging(!1)}this.connectionCandidate?(this.applyConnections(this.connectionCandidate),this.disposeStep()):this.block.queueRender().then(()=>this.disposeStep()),this.inGroup||s.setGroup$$module$build$src$core$events$utils(!1)}}disposeStep(){this.block.snapToGrid(),this.connectionPreviewer.dispose(),this.workspace.setResizesEnabled(!0)}applyConnections(e){const{local:i,neighbour:n}=e;i.connect(n);const c=i.isSuperior()?n:i,d=this.block.getRootBlock();Gs().then(()=>{ya(c.getSourceBlock()),setTimeout(()=>{d.bringToFront()},0)})}revertDrag(){if(this.block.isShadow()){let i;(i=this.block.getParent())==null||i.revertDrag()}else{var e;if((e=this.startChildConn)==null||e.connect(this.block.nextConnection),this.startParentConn)switch(this.startParentConn.type){case le.INPUT_VALUE:this.startParentConn.connect(this.block.outputConnection);break;case le.NEXT_STATEMENT:this.startParentConn.connect(this.block.previousConnection)}else{this.block.moveTo(this.startLoc,["drag"]);let i;(i=this.workspace.getLayerManager())==null||i.moveOffDragLayer(this.block,lr),xn(this.workspace,this.workspace.getMetricsManager().getScrollMetrics(!0),this.block)}this.startParentConn=this.startChildConn=null,this.connectionPreviewer.hidePreview(),this.connectionCandidate=null,this.block.setDragging(!1),this.dragging=!1}}},nb=class{constructor(){this.drawer=this.curNode=this.colour=null,this.type="marker"}setDrawer(e){this.drawer=e}getDrawer(){return this.drawer}getCurNode(){return this.curNode}setCurNode(e){const i=this.curNode;this.curNode=e,this.drawer&&this.drawer.draw(i,this.curNode)}draw(){this.drawer&&this.drawer.draw(this.curNode,this.curNode)}hide(){this.drawer&&this.drawer.hide()}dispose(){this.getDrawer()&&this.getDrawer().dispose()}},xp=class extends nb{constructor(){super(),this.type="cursor"}next(){var e=this.getCurNode();if(!e)return null;for(e=e.next();e&&e.next()&&(e.getType()===j.types.NEXT||e.getType()===j.types.BLOCK);)e=e.next();return e&&this.setCurNode(e),e}in(){var e=this.getCurNode();if(!e)return null;(e.getType()===j.types.PREVIOUS||e.getType()===j.types.OUTPUT)&&(e=e.next());let i,n;return(e=(n=(i=e)==null?void 0:i.in())!=null?n:null)&&this.setCurNode(e),e}prev(){var e=this.getCurNode();if(!e)return null;for(e=e.prev();e&&e.prev()&&(e.getType()===j.types.NEXT||e.getType()===j.types.BLOCK);)e=e.prev();return e&&this.setCurNode(e),e}out(){var e=this.getCurNode();return e?((e=e.out())&&e.getType()===j.types.BLOCK&&(e=e.prev()||e),e&&this.setCurNode(e),e):null}};r(Z.CURSOR,hi,xp);var sl=class extends xp{constructor(){super()}next(){var e=this.getCurNode();return e?((e=this.getNextNode_(e,this.validNode_))&&this.setCurNode(e),e):null}in(){return this.next()}prev(){var e=this.getCurNode();return e?((e=this.getPreviousNode_(e,this.validNode_))&&this.setCurNode(e),e):null}out(){return this.prev()}getNextNode_(e,i){if(!e)return null;const n=e.in()||e.next();return i(n)?n:n?this.getNextNode_(n,i):(e=this.findSiblingOrParent(e.out()),i(e)?e:e?this.getNextNode_(e,i):null)}getPreviousNode_(e,i){if(!e)return null;let n=e.prev();return n=n?this.getRightMostChild(n):e.out(),i(n)?n:n?this.getPreviousNode_(n,i):null}validNode_(e){let i=!1;return e=e&&e.getType(),(e===j.types.OUTPUT||e===j.types.INPUT||e===j.types.FIELD||e===j.types.NEXT||e===j.types.PREVIOUS||e===j.types.WORKSPACE)&&(i=!0),i}findSiblingOrParent(e){if(!e)return null;const i=e.next();return i||this.findSiblingOrParent(e.out())}getRightMostChild(e){if(!e.in())return e;for(e=e.in();e&&e.next();)e=e.next();return this.getRightMostChild(e)}};sl.registrationName="basicCursor",r(Z.CURSOR,sl.registrationName,sl);var ob=class extends sl{validNode_(e){let i=!1;const n=e&&e.getType();return e&&(e=e.getLocation(),n===j.types.FIELD&&e&&e.isTabNavigable()&&e.isClickable()&&(i=!0)),i}},lb=10,ss=class extends Ae{constructor(e,i){super(e,i),this.highlighted=!1,this.targetConnection=null,this.db=e.workspace.connectionDBList[i],this.dbOpposite=e.workspace.connectionDBList[Xr[i]],this.offsetInBlock=new te(0,0),this.trackedState=ss.TrackedState.WILL_TRACK}dispose(){super.dispose(),this.trackedState===ss.TrackedState.TRACKED&&this.db.removeConnection(this,this.y);let e,i;(i=(e=this.sourceBlock_.pathObject).removeConnectionHighlight)==null||i.call(e,this)}getSourceBlock(){return super.getSourceBlock()}targetBlock(){return super.targetBlock()}distanceFrom(e){const i=this.x-e.x;return e=this.y-e.y,Math.sqrt(i*i+e*e)}bumpAwayFrom(e,i=!1){if(!this.sourceBlock_.workspace.isDragging()){var n=s.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*lb),c=s.config$$module$build$src$core$config.snapRadius+Math.floor(Math.random()*lb),d=e.sourceBlock_.getRootBlock(),m=this.sourceBlock_.getRootBlock();if(!d.isInFlyout&&!m.isInFlyout){var y=!0;if(m.isMovable())d.isMovable()&&i&&(c=-c);else if(d.isMovable())y=!1,n=-n,c=-c;else return;i=y?e:this,e=y?this:e,d=y?m:d,(m=qe()===d)||d.addSelect(),d.RTL&&(n=-n),d.moveBy(i.x+n-e.x,i.y+c-e.y,["bump"]),m||d.removeSelect()}}}moveTo(e,i){let n=!1;return this.trackedState===ss.TrackedState.WILL_TRACK?(this.db.addConnection(this,i),this.trackedState=ss.TrackedState.TRACKED,n=!0):this.trackedState===ss.TrackedState.TRACKED&&(this.db.removeConnection(this,this.y),this.db.addConnection(this,i),n=!0),this.x=e,this.y=i,n}moveBy(e,i){return this.moveTo(this.x+e,this.y+i)}moveToOffset(e){return this.moveTo(e.x+this.offsetInBlock.x,e.y+this.offsetInBlock.y)}setOffsetInBlock(e,i){this.offsetInBlock.x=e,this.offsetInBlock.y=i}getOffsetInBlock(){return this.offsetInBlock}tightenEfficiently(){var e=this.targetConnection;const i=this.targetBlock();e&&i&&(e=te.difference(this.offsetInBlock,e.offsetInBlock),i.translate(e.x,e.y))}closest(e,i){return this.dbOpposite.searchForClosest(this,e,i)}highlight(){this.highlighted=!0,this.getSourceBlock().queueRender()}unhighlight(){this.highlighted=!1,this.getSourceBlock().queueRender()}isHighlighted(){return this.highlighted}setTracking(e){e&&this.trackedState===ss.TrackedState.TRACKED||!e&&this.trackedState===ss.TrackedState.UNTRACKED||this.sourceBlock_.isInFlyout||(e?(this.db.addConnection(this,this.y),this.trackedState=ss.TrackedState.TRACKED):(this.trackedState===ss.TrackedState.TRACKED&&this.db.removeConnection(this,this.y),this.trackedState=ss.TrackedState.UNTRACKED))}stopTrackingAll(){if(this.setTracking(!1),this.targetConnection){const e=this.targetBlock().getDescendants(!1);for(let i=0;i<e.length;i++){const n=e[i],c=n.getConnections_(!0);for(let d=0;d<c.length;d++)c[d].setTracking(!1);for(const d of n.getIcons())$n(d)&&d.setBubbleVisible(!1)}}}startTrackingAll(){this.setTracking(!0);let e=[];if(this.type!==le.INPUT_VALUE&&this.type!==le.NEXT_STATEMENT)return e;const i=this.targetBlock();if(i){let n;i.isCollapsed()?(n=[],i.outputConnection&&n.push(i.outputConnection),i.nextConnection&&n.push(i.nextConnection),i.previousConnection&&n.push(i.previousConnection)):n=i.getConnections_(!0);for(let c=0;c<n.length;c++)e.push(...n[c].startTrackingAll());e.length||(e=[i])}return e}onFailedConnect(e){const i=this.getSourceBlock();if(k()){const n=s.getGroup$$module$build$src$core$events$utils();setTimeout((function(){i.isDisposed()||i.getParent()||(s.setGroup$$module$build$src$core$events$utils(n),this.bumpAwayFrom(e),s.setGroup$$module$build$src$core$events$utils(!1))}).bind(this),s.config$$module$build$src$core$config.bumpDelay)}}disconnectInternal(e=!0){const{parentConnection:i,childConnection:n}=this.getParentAndChildConnections();if(i&&n){var c=s.getGroup$$module$build$src$core$events$utils();c||s.setGroup$$module$build$src$core$events$utils(!0);var d=i.getSourceBlock(),m=n.getSourceBlock();super.disconnectInternal(e),d.queueRender(),m.updateDisabled(),m.queueRender(),m.getSvgRoot().style.display="block",s.setGroup$$module$build$src$core$events$utils(c)}}respawnShadow_(){super.respawnShadow_();const e=this.targetBlock();e&&(e.initSvg(),e.queueRender())}neighbours(e){return this.dbOpposite.getNeighbours(this,e)}connect_(e){super.connect_(e);var i=this.getSourceBlock();e=e.getSourceBlock(),i.updateDisabled(),e.updateDisabled(),e.queueRender();var n=qe();(n=n===i&&i||n===e&&e)&&(n.removeSelect(),n.addSelect()),(i=i.getInputWithBlock(e))&&(i=i.isVisible(),e.getSvgRoot().style.display=i?"block":"none")}onCheckChanged_(){!this.isConnected()||this.targetConnection&&this.getConnectionChecker().canConnect(this,this.targetConnection,!1)||(this.isSuperior()?this.targetBlock():this.sourceBlock_).unplug()}setCheck(e){return super.setCheck(e),this.sourceBlock_.queueRender(),this}};(function(e){e=e.TrackedState||(e.TrackedState={}),e[e.WILL_TRACK=-1]="WILL_TRACK",e[e.UNTRACKED=0]="UNTRACKED",e[e.TRACKED=1]="TRACKED"})(ss||(ss={})),ss.TrackedState;var Ps=class extends hr{constructor(e,i,n){if(super(e,i,n),this.childlessWidth=this.width=this.height=0,this.warningTextDb=new Map,this.mutator=null,this.rendered=!0,this.visuallyDisabled=!1,this.translation="",this.dragging=!1,this.relativeCoords=new te(0,0),this.dragStrategy=new rb(this),!e.rendered)throw TypeError("Cannot create a rendered block in a headless workspace");this.workspace=e,this.svgGroup=Y(U.G,{}),this.style=e.getRenderer().getConstants().getBlockStyle(null),this.pathObject=e.getRenderer().makePathObject(this.svgGroup,this.style),e=this.pathObject.svgPath,e.tooltip=this,En(e),this.svgGroup.setAttribute("data-id",this.id),this.doInit_()}initSvg(){if(!this.initialized){for(var e of this.inputList)e.init();for(const i of this.getIcons())i.initView(this.createIconPointerDownListener(i)),i.updateEditable();this.applyColour(),this.pathObject.updateMovable(this.isMovable()||this.isInFlyout),e=this.getSvgRoot(),!this.workspace.options.readOnly&&e&&fe(e,"pointerdown",this,this.onMouseDown),e.parentNode||this.workspace.getCanvas().appendChild(e),this.initialized=!0}}getColourSecondary(){return this.style.colourSecondary}getColourTertiary(){return this.style.colourTertiary}select(){if(this.isShadow()){let e;(e=this.getParent())==null||e.select()}else this.addSelect()}unselect(){if(this.isShadow()){let e;(e=this.getParent())==null||e.unselect()}else this.removeSelect()}setParent(e){const i=this.parentBlock_;if(e!==i){Gt(),super.setParent(e),ni();var n=this.getSvgRoot();if(!this.workspace.isClearing&&n){var c=this.getRelativeToSurfaceXY();e?e.getSvgRoot().appendChild(n):i&&((e=this.workspace.getCanvas().querySelector(".blocklyDragging"))?this.workspace.getCanvas().insertBefore(n,e):this.workspace.getCanvas().appendChild(n),this.translate(c.x,c.y)),this.applyColour()}}}getRelativeToSurfaceXY(){const e=this.workspace.getLayerManager();if(!e)throw Error("Cannot calculate position because the workspace has not been appended");let i=0,n=0,c=this.getSvgRoot();if(c)do{const d=uo(c);i+=d.x,n+=d.y,c=c.parentNode}while(c&&!e.hasLayer(c));return new te(i,n)}moveBy(e,i,n){if(this.parentBlock_)throw Error("Block has parent");const c=ue();let d=null;c&&(d=new(he(W.BLOCK_MOVE))(this),n&&d.setReason(n)),e=new te(e,i),i=this.getRelativeToSurfaceXY(),e=te.sum(i,e),this.translate(e.x,e.y),this.updateComponentLocations(e),c&&d&&(d.recordNew(),z(d)),this.workspace.resizeContents()}translate(e,i){this.translation=`translate(${e}, ${i})`,this.relativeCoords=new te(e,i),this.getSvgRoot().setAttribute("transform",this.getTranslation())}getTranslation(){return this.translation}moveTo(e,i){const n=this.getRelativeToSurfaceXY();this.moveBy(e.x-n.x,e.y-n.y,i)}moveDuringDrag(e){this.translate(e.x,e.y),this.getSvgRoot().setAttribute("transform",this.getTranslation()),this.updateComponentLocations(e)}snapToGrid(){if(!this.isDeadOrDying()&&!this.getParent()&&!this.isInFlyout){var e=this.workspace.getGrid();if(e!=null&&e.shouldSnap()){var i=this.getRelativeToSurfaceXY();e=e.alignXY(i),e!==i&&this.moveTo(e,["snap"])}}}getBoundingRectangle(){return this.getBoundingRectangleWithDimensions(this.getHeightWidth())}getBoundingRectangleWithoutChildren(){return this.getBoundingRectangleWithDimensions({height:this.height,width:this.childlessWidth})}getBoundingRectangleWithDimensions(e){const i=this.getRelativeToSurfaceXY();let n,c;return this.RTL?(n=i.x-e.width,c=i.x):(n=i.x,c=i.x+e.width),new Ve(i.y,i.y+e.height,n,c)}markDirty(){this.pathObject.constants=this.workspace.getRenderer().getConstants();for(let e=0,i;i=this.inputList[e];e++)i.markDirty()}setCollapsed(e){this.collapsed_!==e&&(super.setCollapsed(e),this.updateCollapsed())}updateCollapsed(){var e=this.isCollapsed();const i=Fo,n=za;for(let d=0,m;m=this.inputList[d];d++)m.name!==i&&m.setVisible(!e);for(var c of this.getIcons())c.updateCollapsed();e?(e=this.toString(tb),(c=this.getField(n))?c.setValue(e):(this.getInput(i)||this.appendDummyInput(i)).appendField(new Wr(e),n)):(this.updateDisabled(),this.removeInput(i))}tab(e,i){const n=new ob;n.setCurNode(j.createFieldNode(e)),e=n.getCurNode(),i?n.next():n.prev(),(i=n.getCurNode())&&i!==e&&(i.getLocation().showEditor(),this.workspace.keyboardAccessibilityMode&&this.workspace.getCursor().setCurNode(i))}onMouseDown(e){const i=this.workspace.getGesture(e);i&&i.handleBlockStart(e,this)}showHelp(){const e=typeof this.helpUrl=="function"?this.helpUrl():this.helpUrl;e&&window.open(e)}generateContextMenu(){if(this.workspace.options.readOnly||!this.contextMenu)return null;const e=Ce.registry.getContextMenuOptions(Ce.ScopeType.BLOCK,{block:this});return this.customContextMenu&&this.customContextMenu(e),e}showContextMenu(e){const i=this.generateContextMenu();i&&i.length&&(So(e,i,this.RTL,this.workspace),gu(this))}updateComponentLocations(e){this.dragging||this.updateConnectionLocations(e),this.updateIconLocations(e),this.updateFieldLocations(e);for(const i of this.getChildren(!1))i.updateComponentLocations(te.sum(e,i.relativeCoords))}updateConnectionLocations(e){for(const i of this.getConnections_(!1))i.moveToOffset(e)}updateIconLocations(e){for(const i of this.getIcons())i.onLocationChange(e)}updateFieldLocations(e){for(const i of this.inputList)for(const n of i.fieldRow)n.onLocationChange(e)}setDragging(e){(this.dragging=e)?(this.translation="",Lo.push(...this.getConnections_(!0)),re(this.svgGroup,"blocklyDragging")):(Lo.length=0,S(this.svgGroup,"blocklyDragging"));for(let i=0;i<this.childBlocks_.length;i++)this.childBlocks_[i].setDragging(e)}setMovable(e){super.setMovable(e),this.pathObject.updateMovable(e)}setEditable(e){super.setEditable(e),e=this.getIcons();for(let i=0;i<e.length;i++)e[i].updateEditable()}setShadow(e){super.setShadow(e),this.applyColour()}setInsertionMarker(e){this.isInsertionMarker_!==e&&(this.isInsertionMarker_=e)&&(this.setColour(this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR),this.pathObject.updateInsertionMarker(!0))}getSvgRoot(){return this.svgGroup}dispose(e,i){if(this.disposing=!0,iu(),Io(),i&&(this.unplug(e),Ea(this)),i=qe(),i instanceof hr){let n=i;for(;n!==null;)n===this&&i.unselect(),n=n.getParent()}super.dispose(!!e),F(this.svgGroup)}disposeInternal(){this.disposing=!0,super.disposeInternal(),qe()===this&&(this.unselect(),this.workspace.cancelCurrentGesture()),[...this.warningTextDb.values()].forEach(e=>clearTimeout(e)),this.warningTextDb.clear(),this.getIcons().forEach(e=>e.dispose())}checkAndDelete(){this.workspace.isFlyout||(s.setGroup$$module$build$src$core$events$utils(!0),this.workspace.hideChaff(),this.outputConnection?this.dispose(!1,!0):this.dispose(!0,!0),s.setGroup$$module$build$src$core$events$utils(!1))}toCopyData(){return this.isInsertionMarker_?null:{paster:tl.TYPE,blockState:gs(this,{addCoordinates:!0,addNextBlocks:!1}),typeCounts:os(this,!0)}}applyColour(){this.pathObject.applyColour(this);const e=this.getIcons();for(let i=0;i<e.length;i++)e[i].applyColour();for(let i=0,n;n=this.inputList[i];i++)for(let c=0,d;d=n.fieldRow[c];c++)d.applyColour()}updateDisabled(){const e=!this.isEnabled()||this.getInheritedDisabled();if(this.visuallyDisabled===e){let i;(i=this.getNextBlock())==null||i.updateDisabled()}else{this.applyColour(),this.visuallyDisabled=e;for(const i of this.getChildren(!1))i.updateDisabled()}}setWarningText(e,i=""){if(i)this.warningTextDb.has(i)&&(clearTimeout(this.warningTextDb.get(i)),this.warningTextDb.delete(i));else{for(var n of this.warningTextDb.values())clearTimeout(n);this.warningTextDb.clear()}if(this.workspace.isDragging())this.warningTextDb.set(i,setTimeout(()=>{this.isDeadOrDying()||(this.warningTextDb.delete(i),this.setWarningText(e,i))},100));else if(this.isInFlyout&&(e=null),n=this.getIcon(Bi.TYPE),e){let c=this.getSurroundParent(),d=null;for(;c;)c.isCollapsed()&&(d=c),c=c.getSurroundParent();d&&d.setWarningText(s.Msg$$module$build$src$core$msg.COLLAPSED_WARNINGS_WARNING,Ps.COLLAPSED_WARNING_ID),n?n.addMessage(e,i):this.addIcon(new Bi(this).addMessage(e,i))}else n&&(i?(n.addMessage("",i),n.getText()||this.removeIcon(Bi.TYPE)):this.removeIcon(Bi.TYPE))}setMutator(e){this.removeIcon(s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE),e&&this.addIcon(e)}addIcon(e){return super.addIcon(e),e instanceof s.MutatorIcon$$module$build$src$core$icons$mutator_icon&&(this.mutator=e),e.initView(this.createIconPointerDownListener(e)),e.applyColour(),e.updateEditable(),this.queueRender(),e}createIconPointerDownListener(e){return i=>{this.isDeadOrDying()||(i=this.workspace.getGesture(i))&&i.setStartIcon(e)}}removeIcon(e){const i=super.removeIcon(e);return e.equals(s.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE)&&(this.mutator=null),this.queueRender(),i}setEnabled(e){$("setEnabled","v11","v12","the setDisabledReason method of BlockSvg");const i=this.isEnabled();super.setEnabled(e),this.isEnabled()===i||this.getInheritedDisabled()||this.updateDisabled()}setDisabledReason(e,i){const n=this.isEnabled();super.setDisabledReason(e,i),this.isEnabled()===n||this.getInheritedDisabled()||this.updateDisabled()}setHighlighted(e){this.pathObject.updateHighlighted(e)}addSelect(){this.pathObject.updateSelected(!0)}removeSelect(){this.pathObject.updateSelected(!1)}setDeleteStyle(e){this.pathObject.updateDraggingDelete(e)}getColour(){return this.style.colourPrimary}setColour(e){super.setColour(e),e=this.workspace.getRenderer().getConstants().getBlockStyleForColour(this.colour_),this.pathObject.setStyle(e.style),this.style=e.style,this.styleName_=e.name,this.applyColour()}setStyle(e){const i=this.workspace.getRenderer().getConstants().getBlockStyle(e);if(this.styleName_=e,i)this.hat=i.hat,this.pathObject.setStyle(i),this.colour_=i.colourPrimary,this.style=i,this.applyColour();else throw Error("Invalid style name: "+e)}getStyle(){return this.style}bringToFront(e=!1){let i=this;if(!i.isDeadOrDying())do{const n=i.getSvgRoot(),c=n.parentNode,d=c.childNodes;if(d[d.length-1]!==n&&c.appendChild(n),e)break;i=i.getParent()}while(i)}setPreviousStatement(e,i){super.setPreviousStatement(e,i),this.queueRender()}setNextStatement(e,i){super.setNextStatement(e,i),this.queueRender()}setOutput(e,i){super.setOutput(e,i),this.queueRender()}setInputsInline(e){super.setInputsInline(e),this.queueRender()}removeInput(e,i){return e=super.removeInput(e,i),this.queueRender(),e}moveNumberedInputBefore(e,i){super.moveNumberedInputBefore(e,i),this.queueRender()}appendInput(e){return super.appendInput(e),this.queueRender(),e}setConnectionTracking(e){if(this.previousConnection&&this.previousConnection.setTracking(e),this.outputConnection&&this.outputConnection.setTracking(e),this.nextConnection){this.nextConnection.setTracking(e);var i=this.nextConnection.targetBlock();i&&i.setConnectionTracking(e)}if(!this.collapsed_)for(i=0;i<this.inputList.length;i++){var n=this.inputList[i].connection;n&&(n.setTracking(e),(n=n.targetBlock())&&n.setConnectionTracking(e))}}getConnections_(e){const i=[];if(this.outputConnection&&i.push(this.outputConnection),this.previousConnection&&i.push(this.previousConnection),this.nextConnection&&i.push(this.nextConnection),e||!this.collapsed_)for(let n=0,c;c=this.inputList[n];n++)c.connection&&i.push(c.connection);return i}lastConnectionInStack(e){return super.lastConnectionInStack(e)}getMatchingConnection(e,i){return super.getMatchingConnection(e,i)}makeConnection_(e){return new ss(this,e)}getNextBlock(){return super.getNextBlock()}getPreviousBlock(){return super.getPreviousBlock()}bumpNeighbours(){const e=this.getRootBlock();if(!(this.isDeadOrDying()||this.workspace.isDragging()||e.isInFlyout))for(const i of this.getConnections_(!1)){if(i.isSuperior()){let n;(n=i.targetBlock())==null||n.bumpNeighbours()}for(const n of i.neighbours(s.config$$module$build$src$core$config.snapRadius))n.getSourceBlock().getRootBlock()!==e&&(i.isConnected()&&n.isConnected()||(i.isSuperior()?n.bumpAwayFrom(i,!1):i.bumpAwayFrom(n,!0)))}}scheduleSnapAndBump(){this.snapToGrid(),this.bumpNeighbours()}positionNearConnection(e,i,n){if(e.type===le.NEXT_STATEMENT||e.type===le.INPUT_VALUE){let c=i.x;i=i.y,c+=n.x-e.getOffsetInBlock().x,i+=n.y-e.getOffsetInBlock().y,this.moveBy(c,i)}}getChildren(e){return super.getChildren(e)}queueRender(){return Ih(this)}render(){this.queueRender(),Si()}renderEfficiently(){Gt(),this.isCollapsed()&&this.updateCollapsed(),this.isEnabled()||this.updateDisabled(),this.workspace.getRenderer().render(this),this.tightenChildrenEfficiently(),ni(),this.updateMarkers_()}tightenChildrenEfficiently(){for(const e of this.inputList){const i=e.connection;i&&i.tightenEfficiently()}this.nextConnection&&this.nextConnection.tightenEfficiently()}updateMarkers_(){this.workspace.keyboardAccessibilityMode&&this.pathObject.cursorSvg&&this.workspace.getCursor().draw(),this.workspace.keyboardAccessibilityMode&&this.pathObject.markerSvg&&this.workspace.getMarker(Wo.LOCAL_MARKER).draw();for(const e of this.inputList)for(const i of e.fieldRow)i.updateMarkers_()}setCursorSvg(e){this.pathObject.setCursorSvg(e)}setMarkerSvg(e){this.pathObject.setMarkerSvg(e)}getHeightWidth(){let e=this.height,i=this.width;var n=this.getNextBlock();if(n){n=n.getHeightWidth();const c=this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;e+=n.height-c,i=Math.max(i,n.width)}return{height:e,width:i}}fadeForReplacement(e){this.pathObject.updateReplacementFade(e)}highlightShapeForInput(e,i){this.pathObject.updateShapeForInputHighlight(e,i)}setDragStrategy(e){this.dragStrategy=e}isMovable(){return this.dragStrategy.isMovable()}startDrag(e){this.dragStrategy.startDrag(e)}drag(e,i){this.dragStrategy.drag(e,i)}endDrag(e){this.dragStrategy.endDrag(e)}revertDrag(){this.dragStrategy.revertDrag()}toFlyoutInfo(){const e=Object.assign({},{kind:"BLOCK"},gs(this)),i=new Set(["id","height","width","pinned","enabled"]),n=function(c){for(const d in c)i.has(d)?delete c[d]:typeof c[d]=="object"&&n(c[d])};return n(e),[e]}};Ps.INLINE=-1,Ps.COLLAPSED_WARNING_ID="TEMP_COLLAPSED_WARNING_";var ab=class{constructor(){}onDragEnter(e){}onDragOver(e){}onDragExit(e){}onDrop(e){}getClientRect(){return null}shouldPreventMove(e){return!1}},Tc=class extends ab{constructor(){super(),this.wouldDelete_=!1}wouldDelete(e){return e instanceof Ps?(e=!e.getParent()&&e.isDeletable(),this.updateWouldDelete_(e)):this.updateWouldDelete_(Rs(e)&&e.isDeletable()),this.wouldDelete_}updateWouldDelete_(e){this.wouldDelete_=e}},Cp=class extends Hs{constructor(e,i){super(i),this.type=W.TRASHCAN_OPEN,this.isOpen=e}toJson(){const e=super.toJson();if(this.isOpen===void 0)throw Error("Whether this is already open or not is undefined. Either pass a value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Cp),i.isOpen=e.isOpen,i}};r(Z.EVENT,W.TRASHCAN_OPEN,Cp);var cb=class extends Tc{constructor(e){super(),this.workspace=e,this.id="trashcan",this.contents=[],this.flyout=null,this.isLidOpen=!1,this.minOpenness=0,this.lidTask=this.svgLid=this.svgGroup=null,this.top=this.left=this.lidOpen=0,this.initialized=!1,0>=this.workspace.options.maxTrashcanContents||(e=new As({scrollbars:!0,parentWorkspace:this.workspace,rtl:this.workspace.RTL,oneBasedIndex:this.workspace.options.oneBasedIndex,renderer:this.workspace.options.renderer,rendererOverrides:this.workspace.options.rendererOverrides,move:{scrollbars:!0}}),this.workspace.horizontalLayout?(e.toolboxPosition=this.workspace.toolboxPosition===Ie.TOP?Ie.BOTTOM:Ie.TOP,this.flyout=new(_(Z.FLYOUTS_HORIZONTAL_TOOLBOX,this.workspace.options,!0))(e)):(e.toolboxPosition=this.workspace.toolboxPosition===Ie.RIGHT?Ie.LEFT:Ie.RIGHT,this.flyout=new(_(Z.FLYOUTS_VERTICAL_TOOLBOX,this.workspace.options,!0))(e)),this.workspace.addChangeListener(this.onDelete.bind(this)))}createDom(){this.svgGroup=Y(U.G,{class:"blocklyTrash"});let e;const i=String(Math.random()).substring(2);e=Y(U.CLIPPATH,{id:"blocklyTrashBodyClipPath"+i},this.svgGroup),Y(U.RECT,{width:zn,height:bc,y:Xn},e);const n=Y(U.IMAGE,{width:Qt.width,x:-wp,height:Qt.height,y:-Rp,"clip-path":"url(#blocklyTrashBodyClipPath"+i+")"},this.svgGroup);return n.setAttributeNS(ms,"xlink:href",this.workspace.options.pathToMedia+Qt.url),e=Y(U.CLIPPATH,{id:"blocklyTrashLidClipPath"+i},this.svgGroup),Y(U.RECT,{width:zn,height:Xn},e),this.svgLid=Y(U.IMAGE,{width:Qt.width,x:-wp,height:Qt.height,y:-Rp,"clip-path":"url(#blocklyTrashLidClipPath"+i+")"},this.svgGroup),this.svgLid.setAttributeNS(ms,"xlink:href",this.workspace.options.pathToMedia+Qt.url),Xe(this.svgGroup,"pointerdown",this,this.blockMouseDownWhenOpenable),Xe(this.svgGroup,"pointerup",this,this.click),Xe(n,"pointerover",this,this.mouseOver),Xe(n,"pointerout",this,this.mouseOut),this.animateLid(),this.svgGroup}init(){0<this.workspace.options.maxTrashcanContents&&(ee(this.flyout.createDom(U.SVG),this.workspace.getParentSvg()),this.flyout.init(this.workspace)),this.workspace.getComponentManager().addComponent({component:this,weight:et.ComponentWeight.TRASHCAN_WEIGHT,capabilities:[et.Capability.AUTOHIDEABLE,et.Capability.DELETE_AREA,et.Capability.DRAG_TARGET,et.Capability.POSITIONABLE]}),this.initialized=!0,this.setLidOpen(!1)}dispose(){this.workspace.getComponentManager().removeComponent("trashcan"),this.svgGroup&&F(this.svgGroup),this.lidTask&&clearTimeout(this.lidTask)}hasContents(){return!!this.contents.length}contentsIsOpen(){return!!this.flyout&&this.flyout.isVisible()}openFlyout(){if(!this.contentsIsOpen()){var e=this.contents.map(function(n){return JSON.parse(n)}),i=this.workspace.getParentSvg().style;i.cursor="wait",setTimeout(()=>{let n;(n=this.flyout)==null||n.show(e),i.cursor="";let c;(c=this.workspace.scrollbar)==null||c.setVisible(!1)},10),this.fireUiEvent(!0)}}closeFlyout(){if(this.contentsIsOpen()){var e;(e=this.flyout)==null||e.hide();var i;(i=this.workspace.scrollbar)==null||i.setVisible(!0),this.fireUiEvent(!1),this.workspace.recordDragTargets()}}autoHide(e){!e&&this.flyout&&this.closeFlyout()}emptyContents(){this.hasContents()&&(this.contents.length=0,this.setMinOpenness(0),this.closeFlyout())}position(e,i){if(this.initialized){var n=Ql(this.workspace,e);e=Zl(n,new Oe(zn,bc+Xn),_C,hb,e,this.workspace),i=ea(e,hb,n.vertical===Mi.TOP?nr.DOWN:nr.UP,i),this.top=i.top,this.left=i.left;var c;(c=this.svgGroup)==null||c.setAttribute("transform","translate("+this.left+","+this.top+")");var d;(d=this.flyout)==null||d.position()}}getBoundingRectangle(){return new Ve(this.top,this.top+bc+Xn,this.left,this.left+zn)}getClientRect(){if(!this.svgGroup)return null;var e=this.svgGroup.getBoundingClientRect();const i=e.top+Rp-Ec;return e=e.left+wp-Ec,new Ve(i,i+Xn+bc+2*Ec,e,e+zn+2*Ec)}onDragOver(e){this.setLidOpen(this.wouldDelete_)}onDragExit(e){this.setLidOpen(!1)}onDrop(e){setTimeout(this.setLidOpen.bind(this,!1),100)}setLidOpen(e){this.isLidOpen!==e&&(this.lidTask&&clearTimeout(this.lidTask),this.isLidOpen=e,this.animateLid())}animateLid(){const e=bC;var i=1/(e+1);this.lidOpen+=this.isLidOpen?i:-i,this.lidOpen=Math.min(Math.max(this.lidOpen,this.minOpenness),1),this.setLidAngle(this.lidOpen*db),i=ub+this.lidOpen*(EC-ub),this.svgGroup&&(this.svgGroup.style.opacity=`${i}`),this.lidOpen>this.minOpenness&&1>this.lidOpen&&(this.lidTask=setTimeout(this.animateLid.bind(this),TC/e))}setLidAngle(e){const i=this.workspace.toolboxPosition===Ie.RIGHT||this.workspace.horizontalLayout&&this.workspace.RTL;let n;(n=this.svgLid)==null||n.setAttribute("transform","rotate("+(i?-e:e)+","+(i?4:zn-4)+","+(Xn-2)+")")}setMinOpenness(e){this.minOpenness=e,this.isLidOpen||this.setLidAngle(e*db)}closeLid(){this.setLidOpen(!1)}click(){this.hasContents()&&!this.workspace.isDragging()&&this.openFlyout()}fireUiEvent(e){e=new(he(W.TRASHCAN_OPEN))(e,this.workspace.id),z(e)}blockMouseDownWhenOpenable(e){!this.contentsIsOpen()&&this.hasContents()&&e.stopPropagation()}mouseOver(){this.hasContents()&&this.setLidOpen(!0)}mouseOut(){this.setLidOpen(!1)}onDelete(e){if(!(0>=this.workspace.options.maxTrashcanContents||!x(e)||e.wasShadow)){if(!e.oldJson)throw Error("Encountered a delete event without proper oldJson");if(e=JSON.stringify(this.cleanBlockJson(e.oldJson)),!this.contents.includes(e)){for(this.contents.unshift(e);this.contents.length>this.workspace.options.maxTrashcanContents;)this.contents.pop();this.setMinOpenness($C)}}}cleanBlockJson(e){function i(n){if(n){if(delete n.id,delete n.x,delete n.y,delete n.enabled,delete n.disabledReasons,n.icons&&n.icons.comment){var c=n.icons.comment;delete c.height,delete c.width,delete c.pinned}c=n.inputs;for(var d in c){var m=c[d];const y=m.block;m=m.shadow,y&&i(y),m&&i(m)}n.next&&(d=n.next,n=d.block,d=d.shadow,n&&i(n),d&&i(d))}}return e=JSON.parse(JSON.stringify(e)),i(e),Object.assign({},{kind:"BLOCK"},e)}},zn=47,bc=44,Xn=16,hb=20,_C=20,Ec=10,wp=0,Rp=32,$C=.1,TC=80,bC=4,ub=.4,EC=.8,db=45,Pe=class{constructor(){this.shortcuts=new Map,this.keyMap=new Map,this.reset()}reset(){this.shortcuts.clear(),this.keyMap.clear()}register(e,i){if(this.shortcuts.get(e.name)&&!i)throw Error(`Shortcut named "${e.name}" already exists.`);if(this.shortcuts.set(e.name,e),i=e.keyCodes,i!=null&&i.length)for(const n of i)this.addKeyMapping(n,e.name,!!e.allowCollision)}unregister(e){return this.shortcuts.get(e)?(this.removeAllKeyMappings(e),this.shortcuts.delete(e),!0):(console.warn(`Keyboard shortcut named "${e}" not found.`),!1)}addKeyMapping(e,i,n){e=`${e}`;const c=this.keyMap.get(e);if(c&&!n)throw Error(`Shortcut named "${i}" collides with shortcuts "${c}"`);c&&n?c.unshift(i):this.keyMap.set(e,[i])}removeKeyMapping(e,i,n){const c=this.keyMap.get(e);if(!c)return n||console.warn(`No keyboard shortcut named "${i}" registered with key code "${e}"`),!1;const d=c.indexOf(i);return-1<d?(c.splice(d,1),c.length===0&&this.keyMap.delete(e),!0):(n||console.warn(`No keyboard shortcut named "${i}" registered with key code "${e}"`),!1)}removeAllKeyMappings(e){for(const i of this.keyMap.keys())this.removeKeyMapping(i,e,!0)}setKeyMap(e){this.keyMap.clear();for(const i in e)this.keyMap.set(i,e[i])}getKeyMap(){const e=Object.create(null);for(const[i,n]of this.keyMap)e[i]=n;return e}getRegistry(){const e=Object.create(null);for(const[i,n]of this.shortcuts)e[i]=n;return Ci(Object.create(null),e)}onKeyDown(e,i){var n=this.serializeKeyEvent(i);if(n=this.getShortcutNamesByKeyCode(n),!n)return!1;for(const c of n){if(n=this.shortcuts.get(c),!n||n.preconditionFn&&!n.preconditionFn(e))continue;let d,m;if((m=(d=n).callback)!=null&&m.call(d,e,i,n))return!0}return!1}getShortcutNamesByKeyCode(e){return this.keyMap.get(e)||[]}getKeyCodesByShortcutName(e){const i=[];for(const[n,c]of this.keyMap)-1<c.indexOf(e)&&i.push(n);return i}serializeKeyEvent(e){let i="";for(const n in Pe.modifierKeys)e.getModifierState(n)&&(i!==""&&(i+="+"),i+=n);return i!==""&&e.keyCode?i+="+"+e.keyCode:e.keyCode&&(i=String(e.keyCode)),i}checkModifiers(e){for(const i of e)if(!(i in Pe.modifierKeys))throw Error(i+" is not a valid modifier key.")}createSerializedKey(e,i){let n="";if(i){this.checkModifiers(i);for(const c in Pe.modifierKeys)i.includes(Pe.modifierKeys[c])&&(n!==""&&(n+="+"),n+=c)}return n!==""&&e?n+="+"+e:e&&(n=`${e}`),n}};Pe.registry=new Pe,function(e){e=e.modifierKeys||(e.modifierKeys={}),e[e.Shift=16]="Shift",e[e.Control=17]="Control",e[e.Alt=18]="Alt",e[e.Meta=91]="Meta"}(Pe||(Pe={}));var kp=null,Op=null,yC={duplicateInternal:p$,copyInternal:d$},il={};il.BlockPaster=tl,il.TEST_ONLY=yC,il.paste=tr,il.registry=Pd;var fi;(function(e){e.ESCAPE="escape",e.DELETE="delete",e.COPY="copy",e.CUT="cut",e.PASTE="paste",e.UNDO="undo",e.REDO="redo"})(fi||(fi={}));var ur=null,dr=null,Yn=null;Ju();var gi={};gi.names=fi,gi.registerCopy=Xu,gi.registerCut=Yu,gi.registerDefaultShortcuts=Ju,gi.registerDelete=zu,gi.registerEscape=Wu,gi.registerPaste=Ku,gi.registerRedo=qu,gi.registerUndo=ju;var vC=class{constructor(e,i){this.procedureModelClass=e,this.parameterModelClass=i,this.priority=cT}save(e){return e=e.getProcedureMap().getProcedures().map(i=>Zu(i)),e.length?e:null}load(e,i){const n=i.getProcedureMap();for(const c of e)n.add(Qu(this.procedureModelClass,this.parameterModelClass,c,i))}clear(e){e.getProcedureMap().clear()}},yc={};yc.ProcedureSerializer=vC,yc.loadProcedure=Qu,yc.saveProcedure=Zu;var pb=class{constructor(){this.priority=aT}save(e){const i=[];for(const n of e.getAllVariables())e={name:n.name,id:n.getId()},n.type&&(e.type=n.type),i.push(e);return i.length?i:null}load(e,i){for(const n of e)i.createVariable(n.name,n.type,n.id)}clear(e){e.getVariableMap().clear()}};fo("variables",new pb);var fb={};fb.VariableSerializer=pb;var Ap={};Ap.load=g$,Ap.save=f$;var SC={blocks:Vo,exceptions:Nr,priorities:Qx,procedures:yc,registry:Ld,variables:fb,workspaceComments:Va,workspaces:Ap},Mp=class{constructor(e,i,n,c,d){this.workspace=e,this.oldHostMetrics=this.corner_=this.vScroll=this.hScroll=null,i=i===void 0?!0:i,n=n===void 0?!0:n;const m=i&&n;i&&(this.hScroll=new ht(e,!0,m,c,d)),n&&(this.vScroll=new ht(e,!1,m,c,d)),m&&(this.corner_=Y(U.RECT,{height:ht.scrollbarThickness,width:ht.scrollbarThickness,class:"blocklyScrollbarBackground"}),ee(this.corner_,e.getBubbleCanvas()))}dispose(){F(this.corner_),this.oldHostMetrics=this.corner_=null,this.hScroll&&(this.hScroll.dispose(),this.hScroll=null),this.vScroll&&(this.vScroll.dispose(),this.vScroll=null)}resize(){const e=this.workspace.getMetrics();if(e){var i=!1,n=!1;if(this.oldHostMetrics&&this.oldHostMetrics.viewWidth===e.viewWidth&&this.oldHostMetrics.viewHeight===e.viewHeight&&this.oldHostMetrics.absoluteTop===e.absoluteTop&&this.oldHostMetrics.absoluteLeft===e.absoluteLeft?(this.oldHostMetrics&&this.oldHostMetrics.scrollWidth===e.scrollWidth&&this.oldHostMetrics.viewLeft===e.viewLeft&&this.oldHostMetrics.scrollLeft===e.scrollLeft||(i=!0),this.oldHostMetrics&&this.oldHostMetrics.scrollHeight===e.scrollHeight&&this.oldHostMetrics.viewTop===e.viewTop&&this.oldHostMetrics.scrollTop===e.scrollTop||(n=!0)):n=i=!0,i||n){try{s.disable$$module$build$src$core$events$utils(),this.hScroll&&i&&this.hScroll.resize(e),this.vScroll&&n&&this.vScroll.resize(e)}finally{s.enable$$module$build$src$core$events$utils()}this.workspace.maybeFireViewportChangeEvent()}if(this.hScroll&&this.vScroll){if(!this.oldHostMetrics||this.oldHostMetrics.viewWidth!==e.viewWidth||this.oldHostMetrics.absoluteLeft!==e.absoluteLeft){let c;(c=this.corner_)==null||c.setAttribute("x",String(this.vScroll.position.x))}if(!this.oldHostMetrics||this.oldHostMetrics.viewHeight!==e.viewHeight||this.oldHostMetrics.absoluteTop!==e.absoluteTop){let c;(c=this.corner_)==null||c.setAttribute("y",String(this.hScroll.position.y))}}this.oldHostMetrics=e}}canScrollHorizontally(){return!!this.hScroll}canScrollVertically(){return!!this.vScroll}setOrigin(e,i){this.hScroll&&this.hScroll.setOrigin(e,i),this.vScroll&&this.vScroll.setOrigin(e,i)}set(e,i,n){this.hScroll&&this.hScroll.set(e,!1),this.vScroll&&this.vScroll.set(i,!1),(n||n===void 0)&&(e={},this.hScroll&&(e.x=this.hScroll.getRatio_()),this.vScroll&&(e.y=this.vScroll.getRatio_()),this.workspace.setMetrics(e))}setX(e){this.hScroll&&this.hScroll.set(e,!0)}setY(e){this.vScroll&&this.vScroll.set(e,!0)}setContainerVisible(e){this.hScroll&&this.hScroll.setContainerVisible(e),this.vScroll&&this.vScroll.setContainerVisible(e)}isVisible(){let e=!1;return this.hScroll&&(e=this.hScroll.isVisible()),this.vScroll&&(e=e||this.vScroll.isVisible()),e}setVisible(e){this.hScroll&&this.hScroll.setVisibleInternal(e),this.vScroll&&this.vScroll.setVisibleInternal(e)}resizeContent(e){this.hScroll&&this.hScroll.resizeContentHorizontal(e),this.vScroll&&this.vScroll.resizeContentVertical(e)}resizeView(e){this.hScroll&&this.hScroll.resizeViewHorizontal(e),this.vScroll&&this.vScroll.resizeViewVertical(e)}},Lp=class{constructor(e){this.workspace_=e}getDimensionsPx_(e){let i=0,n=0;return e&&(i=e.getWidth(),n=e.getHeight()),new Oe(i,n)}getFlyoutMetrics(e){return e=this.getDimensionsPx_(this.workspace_.getFlyout(e)),{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getToolboxMetrics(){const e=this.getDimensionsPx_(this.workspace_.getToolbox());return{width:e.width,height:e.height,position:this.workspace_.toolboxPosition}}getSvgMetrics(){return this.workspace_.getCachedParentSvgSize()}getAbsoluteMetrics(){let e=0,i=0;const n=this.getToolboxMetrics(),c=this.getFlyoutMetrics(),d=!!this.workspace_.getToolbox();var m;const y=!((m=this.workspace_.getFlyout())!=null&&m.autoClose);m=d?n.position:c.position;const O=m===Ie.TOP;return m===Ie.LEFT&&(d&&(e+=n.width),y&&(e+=c.width)),O&&(d&&(i+=n.height),y&&(i+=c.height)),{top:i,left:e}}getViewMetrics(e){e=e?this.workspace_.scale:1;const i=this.getSvgMetrics(),n=this.getToolboxMetrics(),c=this.getFlyoutMetrics(),d=!!this.workspace_.getToolbox();var m;const y=!((m=this.workspace_.getFlyout())!=null&&m.autoClose);m=d?n.position:c.position;const O=m===Ie.LEFT||m===Ie.RIGHT;return(m===Ie.TOP||m===Ie.BOTTOM)&&(d&&(i.height-=n.height),y&&(i.height-=c.height)),O&&(d&&(i.width-=n.width),y&&(i.width-=c.width)),{height:i.height/e,width:i.width/e,top:-this.workspace_.scrollY/e,left:-this.workspace_.scrollX/e}}getContentMetrics(e){e=e?1:this.workspace_.scale;const i=this.workspace_.getBlocksBoundingBox();return{height:(i.bottom-i.top)*e,width:(i.right-i.left)*e,top:i.top*e,left:i.left*e}}hasFixedEdges(){return!this.workspace_.isMovableHorizontally()||!this.workspace_.isMovableVertically()}getComputedFixedEdges_(e){if(!this.hasFixedEdges())return{};const i=this.workspace_.isMovableHorizontally(),n=this.workspace_.isMovableVertically();e=e||this.getViewMetrics(!1);const c={};return n||(c.top=e.top,c.bottom=e.top+e.height),i||(c.left=e.left,c.right=e.left+e.width),c}getPaddedContent_(e,i){const n=i.top+i.height,c=i.left+i.width,d=e.width;e=e.height;const m=d/2,y=e/2;return{top:Math.min(i.top-y,n-e),bottom:Math.max(n+y,i.top+e),left:Math.min(i.left-m,c-d),right:Math.max(c+m,i.left+d)}}getScrollMetrics(e,i,n){e=e?this.workspace_.scale:1,i=i||this.getViewMetrics(!1);var c=n||this.getContentMetrics();n=this.getComputedFixedEdges_(i),i=this.getPaddedContent_(i,c),c=n.top!==void 0?n.top:i.top;const d=n.left!==void 0?n.left:i.left;return{top:c/e,left:d/e,width:((n.right!==void 0?n.right:i.right)-d)/e,height:((n.bottom!==void 0?n.bottom:i.bottom)-c)/e}}getUiMetrics(){return{viewMetrics:this.getViewMetrics(),absoluteMetrics:this.getAbsoluteMetrics(),toolboxMetrics:this.getToolboxMetrics()}}getMetrics(){const e=this.getToolboxMetrics(),i=this.getFlyoutMetrics(!0),n=this.getSvgMetrics(),c=this.getAbsoluteMetrics(),d=this.getViewMetrics(),m=this.getContentMetrics(),y=this.getScrollMetrics(!1,d,m);return{contentHeight:m.height,contentWidth:m.width,contentTop:m.top,contentLeft:m.left,scrollHeight:y.height,scrollWidth:y.width,scrollTop:y.top,scrollLeft:y.left,viewHeight:d.height,viewWidth:d.width,viewTop:d.top,viewLeft:d.left,absoluteTop:c.top,absoluteLeft:c.left,svgHeight:n.height,svgWidth:n.width,toolboxWidth:e.width,toolboxHeight:e.height,toolboxPosition:e.position,flyoutWidth:i.width,flyoutHeight:i.height}}};r(Z.METRICS_MANAGER,hi,Lp),"Blockly"in globalThis||(globalThis.Blockly={Msg:$T});var gb=class extends fc{constructor(){super(),this.GRID_UNIT=4,this.CURSOR_COLOUR="#ffa200",this.CURSOR_RADIUS=5,this.JAGGED_TEETH_WIDTH=this.JAGGED_TEETH_HEIGHT=0,this.START_HAT_HEIGHT=22,this.START_HAT_WIDTH=96,this.SHAPES={HEXAGONAL:1,ROUND:2,SQUARE:3,PUZZLE:4,NOTCH:5},this.SHAPE_IN_SHAPE_PADDING={1:{0:5*this.GRID_UNIT,1:2*this.GRID_UNIT,2:5*this.GRID_UNIT,3:5*this.GRID_UNIT},2:{0:3*this.GRID_UNIT,1:3*this.GRID_UNIT,2:1*this.GRID_UNIT,3:2*this.GRID_UNIT},3:{0:2*this.GRID_UNIT,1:2*this.GRID_UNIT,2:2*this.GRID_UNIT,3:2*this.GRID_UNIT}},this.FULL_BLOCK_FIELDS=!0,this.FIELD_TEXT_FONTWEIGHT="bold",this.FIELD_TEXT_FONTFAMILY='"Helvetica Neue", "Segoe UI", Helvetica, sans-serif',this.FIELD_COLOUR_FULL_BLOCK=this.FIELD_TEXTINPUT_BOX_SHADOW=this.FIELD_DROPDOWN_SVG_ARROW=this.FIELD_DROPDOWN_COLOURED_DIV=this.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW=!0,this.SELECTED_GLOW_COLOUR="#fff200",this.SELECTED_GLOW_SIZE=.5,this.REPLACEMENT_GLOW_COLOUR="#fff200",this.REPLACEMENT_GLOW_SIZE=2,this.selectedGlowFilterId="",this.selectedGlowFilter=null,this.replacementGlowFilterId="",this.SQUARED=this.ROUNDED=this.HEXAGONAL=this.replacementGlowFilter=null,this.SMALL_PADDING=this.GRID_UNIT,this.MEDIUM_PADDING=2*this.GRID_UNIT,this.MEDIUM_LARGE_PADDING=3*this.GRID_UNIT,this.LARGE_PADDING=4*this.GRID_UNIT,this.CORNER_RADIUS=1*this.GRID_UNIT,this.NOTCH_WIDTH=9*this.GRID_UNIT,this.NOTCH_HEIGHT=2*this.GRID_UNIT,this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT=3*this.GRID_UNIT,this.MIN_BLOCK_WIDTH=2*this.GRID_UNIT,this.MIN_BLOCK_HEIGHT=12*this.GRID_UNIT,this.EMPTY_STATEMENT_INPUT_HEIGHT=6*this.GRID_UNIT,this.TOP_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT=this.LARGE_PADDING,this.BOTTOM_ROW_MIN_HEIGHT=this.CORNER_RADIUS,this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT=6*this.GRID_UNIT,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT,this.STATEMENT_INPUT_SPACER_MIN_WIDTH=40*this.GRID_UNIT,this.STATEMENT_INPUT_PADDING_LEFT=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_PADDING=4*this.GRID_UNIT,this.EMPTY_INLINE_INPUT_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_MIN_HEIGHT=8*this.GRID_UNIT,this.DUMMY_INPUT_SHADOW_MIN_HEIGHT=6*this.GRID_UNIT,this.CURSOR_WS_WIDTH=20*this.GRID_UNIT,this.FIELD_TEXT_FONTSIZE=3*this.GRID_UNIT,this.FIELD_BORDER_RECT_RADIUS=this.CORNER_RADIUS,this.FIELD_BORDER_RECT_X_PADDING=2*this.GRID_UNIT,this.FIELD_BORDER_RECT_Y_PADDING=1.625*this.GRID_UNIT,this.FIELD_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=8*this.GRID_UNIT,this.FIELD_DROPDOWN_SVG_ARROW_PADDING=this.FIELD_BORDER_RECT_X_PADDING,this.FIELD_COLOUR_DEFAULT_WIDTH=6*this.GRID_UNIT,this.FIELD_COLOUR_DEFAULT_HEIGHT=8*this.GRID_UNIT,this.FIELD_CHECKBOX_X_OFFSET=1*this.GRID_UNIT,this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH=12*this.GRID_UNIT}setFontConstants_(e){super.setFontConstants_(e),this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT=this.FIELD_BORDER_RECT_HEIGHT=this.FIELD_TEXT_HEIGHT+2*this.FIELD_BORDER_RECT_Y_PADDING}init(){super.init(),this.HEXAGONAL=this.makeHexagonal(),this.ROUNDED=this.makeRounded(),this.SQUARED=this.makeSquared(),this.STATEMENT_INPUT_NOTCH_OFFSET=this.NOTCH_OFFSET_LEFT+this.INSIDE_CORNERS.rightWidth}setDynamicProperties_(e){super.setDynamicProperties_(e),this.SELECTED_GLOW_COLOUR=e.getComponentStyle("selectedGlowColour")||this.SELECTED_GLOW_COLOUR;const i=Number(e.getComponentStyle("selectedGlowSize"));this.SELECTED_GLOW_SIZE=i&&!isNaN(i)?i:this.SELECTED_GLOW_SIZE,this.REPLACEMENT_GLOW_COLOUR=e.getComponentStyle("replacementGlowColour")||this.REPLACEMENT_GLOW_COLOUR,this.REPLACEMENT_GLOW_SIZE=(e=Number(e.getComponentStyle("replacementGlowSize")))&&!isNaN(e)?e:this.REPLACEMENT_GLOW_SIZE}dispose(){super.dispose(),this.selectedGlowFilter&&F(this.selectedGlowFilter),this.replacementGlowFilter&&F(this.replacementGlowFilter)}makeStartHat(){const e=this.START_HAT_HEIGHT,i=this.START_HAT_WIDTH,n=as("c",[de(25,-e),de(71,-e),de(i,0)]);return{height:e,width:i,path:n}}makeHexagonal(){function e(n,c,d){var m=n/2;return m=m>i?i:m,d=d?-1:1,n=(c?-1:1)*n/2,ci(-d*m,n)+ci(d*m,n)}const i=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;return{type:this.SHAPES.HEXAGONAL,isDynamic:!0,width(n){return n/=2,n>i?i:n},height(n){return n},connectionOffsetY(n){return n/2},connectionOffsetX(n){return-n},pathDown(n){return e(n,!1,!1)},pathUp(n){return e(n,!0,!1)},pathRightDown(n){return e(n,!1,!0)},pathRightUp(n){return e(n,!1,!0)}}}makeRounded(){function e(c,d,m){const y=c>n?c-n:0;c=(c>n?n:c)/2;const O=m===d?"0":"1";return ct("a","0 0,"+O,c,de((m?1:-1)*c,(d?-1:1)*c))+ae("v",(d?-1:1)*y)+ct("a","0 0,"+O,c,de((m?-1:1)*c,(d?-1:1)*c))}const i=this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,n=2*i;return{type:this.SHAPES.ROUND,isDynamic:!0,width(c){return c/=2,c>i?i:c},height(c){return c},connectionOffsetY(c){return c/2},connectionOffsetX(c){return-c},pathDown(c){return e(c,!1,!1)},pathUp(c){return e(c,!0,!1)},pathRightDown(c){return e(c,!1,!0)},pathRightUp(c){return e(c,!1,!0)}}}makeSquared(){function e(n,c,d){n-=2*i;const m=d===c?"0":"1";return ct("a","0 0,"+m,i,de((d?1:-1)*i,(c?-1:1)*i))+ae("v",(c?-1:1)*n)+ct("a","0 0,"+m,i,de((d?-1:1)*i,(c?-1:1)*i))}const i=this.CORNER_RADIUS;return{type:this.SHAPES.SQUARE,isDynamic:!0,width(n){return i},height(n){return n},connectionOffsetY(n){return n/2},connectionOffsetX(n){return-n},pathDown(n){return e(n,!1,!1)},pathUp(n){return e(n,!0,!1)},pathRightDown(n){return e(n,!1,!0)},pathRightUp(n){return e(n,!1,!0)}}}shapeFor(e){let i=e.getCheck();switch(!i&&e.targetConnection&&(i=e.targetConnection.getCheck()),e.type){case le.INPUT_VALUE:case le.OUTPUT_VALUE:if(e=e.getSourceBlock().getOutputShape(),e!==null)switch(e){case this.SHAPES.HEXAGONAL:return this.HEXAGONAL;case this.SHAPES.ROUND:return this.ROUNDED;case this.SHAPES.SQUARE:return this.SQUARED}return i&&i.includes("Boolean")?this.HEXAGONAL:i&&i.includes("Number")?this.ROUNDED:(i&&i.includes("String"),this.ROUNDED);case le.PREVIOUS_STATEMENT:case le.NEXT_STATEMENT:return this.NOTCH;default:throw Error("Unknown type")}}makeNotch(){function e(oe){return as("c",[de(oe*d/2,0),de(oe*d*3/4,y/2),de(oe*d,y)])+In([de(oe*d,m)])+as("c",[de(oe*d/4,y/2),de(oe*d/2,y),de(oe*d,y)])+ae("h",oe*c)+as("c",[de(oe*d/2,0),de(oe*d*3/4,-(y/2)),de(oe*d,-y)])+In([de(oe*d,-m)])+as("c",[de(oe*d/4,-(y/2)),de(oe*d/2,-y),de(oe*d,-y)])}const i=this.NOTCH_WIDTH,n=this.NOTCH_HEIGHT,c=i/3,d=c/3,m=n/2,y=m/2,O=e(1),K=e(-1);return{type:this.SHAPES.NOTCH,width:i,height:n,pathLeft:O,pathRight:K}}makeInsideCorners(){const e=this.CORNER_RADIUS,i=ct("a","0 0,0",e,de(-e,e)),n=ct("a","0 0,1",e,de(-e,e)),c=ct("a","0 0,0",e,de(e,e)),d=ct("a","0 0,1",e,de(e,e));return{width:e,height:e,pathTop:i,pathBottom:c,rightWidth:e,rightHeight:e,pathTopRight:n,pathBottomRight:d}}generateSecondaryColour_(e){return Ir("#000",e,.15)||e}generateTertiaryColour_(e){return Ir("#000",e,.25)||e}createDom(e,i,n){super.createDom(e,i,n),e=Y(U.DEFS,{},e),i=Y(U.FILTER,{id:"blocklySelectedGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),Y(U.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.SELECTED_GLOW_SIZE},i),n=Y(U.FECOMPONENTTRANSFER,{result:"outBlur"},i),Y(U.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},n),Y(U.FEFLOOD,{"flood-color":this.SELECTED_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},i),Y(U.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},i),this.selectedGlowFilterId=i.id,this.selectedGlowFilter=i,e=Y(U.FILTER,{id:"blocklyReplacementGlowFilter"+this.randomIdentifier,height:"160%",width:"180%",y:"-30%",x:"-40%"},e),Y(U.FEGAUSSIANBLUR,{in:"SourceGraphic",stdDeviation:this.REPLACEMENT_GLOW_SIZE},e),i=Y(U.FECOMPONENTTRANSFER,{result:"outBlur"},e),Y(U.FEFUNCA,{type:"table",tableValues:"0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1"},i),Y(U.FEFLOOD,{"flood-color":this.REPLACEMENT_GLOW_COLOUR,"flood-opacity":1,result:"outColor"},e),Y(U.FECOMPOSITE,{in:"outColor",in2:"outBlur",operator:"in",result:"outGlow"},e),Y(U.FECOMPOSITE,{in:"SourceGraphic",in2:"outGlow",operator:"over"},e),this.replacementGlowFilterId=e.id,this.replacementGlowFilter=e}getCSS_(e){return[`${e} .blocklyText,`,`${e} .blocklyFlyoutLabelText {`,`font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e} .blocklyTextInputBubble textarea {`,"font-weight: normal;","}",`${e} .blocklyText {`,"fill: #fff;","}",`${e} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,`${e} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,`fill: ${this.FIELD_BORDER_RECT_COLOUR};`,"}",`${e} .blocklyNonEditableText>text,`,`${e} .blocklyEditableText>text,`,`${e} .blocklyNonEditableText>g>text,`,`${e} .blocklyEditableText>g>text {`,"fill: #575E75;","}",`${e} .blocklyFlyoutLabelText {`,"fill: #575E75;","}",`${e} .blocklyText.blocklyBubbleText {`,"fill: #575E75;","}",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>rect,",`${e} .blocklyDraggable:not(.blocklyDisabled)`," .blocklyEditableText:not(.editing):hover>.blocklyPath {","stroke: #fff;","stroke-width: 2;","}",`${e} .blocklyHtmlInput {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,`font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,"color: #575E75;","}",`${e} .blocklyDropdownText {`,"fill: #fff !important;","}",`${e}.blocklyWidgetDiv .blocklyMenuItem,`,`${e}.blocklyDropDownDiv .blocklyMenuItem {`,`font-family: ${this.FIELD_TEXT_FONTFAMILY};`,"}",`${e}.blocklyDropDownDiv .blocklyMenuItemContent {`,"color: #fff;","}",`${e} .blocklyHighlightedConnectionPath {`,`stroke: ${this.SELECTED_GLOW_COLOUR};`,"}",`${e} .blocklyDisabled > .blocklyOutlinePath {`,`fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,"}",`${e} .blocklyInsertionMarker>.blocklyPath {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"]}},mb=class extends gc{constructor(e,i){super(e,i)}draw(){const e=this.block_.pathObject;e.beginDrawing(),this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights(),e.setPath(this.outlinePath_+`
`+this.inlinePath_),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_(),this.info_.outputConnection&&(e.outputShapeType=this.info_.outputConnection.shape.type),e.endDrawing()}drawOutline_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape&&!this.info_.hasStatementInput&&!this.info_.bottomRow.hasNextConnection?(this.drawFlatTop_(),this.drawRightDynamicConnection_(),this.drawFlatBottom_(),this.drawLeftDynamicConnection_()):super.drawOutline_()}drawLeft_(){this.info_.outputConnection&&this.info_.outputConnection.isDynamicShape?this.drawLeftDynamicConnection_():super.drawLeft_()}drawRightSideRow_(e){if(!(0>=e.height)){if(N.isSpacer(e)){const c=e.precedesStatement;var i=e.followsStatement;if(c||i){const d=this.constants_.INSIDE_CORNERS;var n=d.rightHeight;n=e.height-(c?n:0),i=i?d.pathBottomRight:"",e=0<n?ae("V",e.yPos+n):"",this.outlinePath_+=i+e+(c?d.pathTopRight:"");return}}this.outlinePath_+=ae("V",e.yPos+e.height)}}drawRightDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.outlinePath_+=this.info_.outputConnection.shape.pathRightDown(this.info_.outputConnection.height)}drawLeftDynamicConnection_(){if(!this.info_.outputConnection)throw Error("Cannot draw the output connection of a block that doesn't have one");this.positionOutputConnection_(),this.outlinePath_+=this.info_.outputConnection.shape.pathUp(this.info_.outputConnection.height),this.outlinePath_+="z"}drawFlatTop_(){const e=this.info_.topRow;this.positionPreviousConnection_(),this.outlinePath_+=Qe(e.xPos,this.info_.startY),this.outlinePath_+=ae("h",e.width)}drawFlatBottom_(){const e=this.info_.bottomRow;this.positionNextConnection_(),this.outlinePath_+=ae("V",e.baseline),this.outlinePath_+=ae("h",-e.width)}drawInlineInput_(e){this.positionInlineInputConnection_(e);const i=e.input.name;e.connectedBlock||this.info_.isInsertionMarker||(e=Tt(e.xPos+e.connectionWidth,e.centerline-e.height/2)+this.getInlineInputPath(e),this.block_.pathObject.setOutlinePath(i,e))}getInlineInputPath(e){const i=e.width-2*e.connectionWidth,n=e.height;return ae("h",i)+e.shape.pathRightDown(n)+ae("h",-i)+e.shape.pathUp(n)+"z"}drawStatementInput_(e){var i=e.getLastInput();const n=i.xPos+i.notchOffset+i.shape.width,c=this.constants_.INSIDE_CORNERS,d=i.shape.pathRight+ae("h",-(i.notchOffset-c.width))+c.pathTop,m=e.height-2*c.height;i=c.pathBottom+ae("h",i.notchOffset-c.width)+(i.connectedBottomNextConnection?"":i.shape.pathLeft),this.outlinePath_+=ae("H",n)+d+ae("v",m)+i+ae("H",e.xPos+e.width),this.positionStatementInputConnection_(e)}drawConnectionHighlightPath(e){const i=e.connectionModel;if(i.type===le.NEXT_STATEMENT||i.type===le.PREVIOUS_STATEMENT||i.type===le.OUTPUT_VALUE&&!e.isDynamicShape)super.drawConnectionHighlightPath(e);else{e=i.type===le.INPUT_VALUE?Tt(e.connectionWidth,-e.height/2)+this.getInlineInputPath(e):Tt(e.width,-e.height/2)+e.shape.pathDown(e.height);var n=i.getSourceBlock(),c,d;(d=(c=n.pathObject).addConnectionHighlight)==null||d.call(c,i,e,i.getOffsetInBlock(),n.RTL)}}},Yr=class extends Ke{constructor(e,i,n,c,d,m,y){if(super(Ke.SKIP_SETUP),this.imageElement=this.clickHandler=null,this.flipRtl=this.isDirty_=this.EDITABLE=!1,this.altText="",n=Number(at(n)),i=Number(at(i)),isNaN(n)||isNaN(i))throw Error("Height and width values of an image field must cast to numbers.");if(0>=n||0>=i)throw Error("Height and width values of an image field must be greater than 0.");this.size_=new Oe(i,n+Yr.Y_PADDING),this.imageHeight=n,typeof d=="function"&&(this.clickHandler=d),e!==Ke.SKIP_SETUP&&(y?this.configure_(y):(this.flipRtl=!!m,this.altText=at(c)||""),this.setValue(at(e)))}configure_(e){super.configure_(e),e.flipRtl&&(this.flipRtl=e.flipRtl),e.alt&&(this.altText=at(e.alt))}initView(){this.imageElement=Y(U.IMAGE,{height:this.imageHeight+"px",width:this.size_.width+"px",alt:this.altText},this.fieldGroup_),this.imageElement.setAttributeNS(ms,"xlink:href",this.value_),this.clickHandler&&(this.imageElement.style.cursor="pointer")}updateSize_(){}doClassValidation_(e){return typeof e!="string"?null:e}doValueUpdate_(e){this.value_=e,this.imageElement&&this.imageElement.setAttributeNS(ms,"xlink:href",this.value_)}getFlipRtl(){return this.flipRtl}setAlt(e){e!==this.altText&&(this.altText=e||"",this.imageElement&&this.imageElement.setAttribute("alt",this.altText))}showEditor_(){this.clickHandler&&this.clickHandler(this)}setOnClickHandler(e){this.clickHandler=e}getText_(){return this.altText}static fromJson(e){if(!e.src||!e.width||!e.height)throw Error("src, width, and height values for an image field arerequired. The width and height must be non-zero.");return new this(e.src,e.width,e.height,void 0,void 0,void 0,e)}};Yr.Y_PADDING=1,ai("field_image",Yr),Yr.prototype.DEFAULT_VALUE="";var vc=class extends Ke{constructor(e,i,n){super(Ke.SKIP_SETUP),this.spellcheck_=!0,this.htmlInput_=null,this.isTextValid_=this.isBeingEdited_=!1,this.onKeyInputWrapper=this.onKeyDownWrapper=this.valueWhenEditorWasOpened_=null,this.fullBlockClickTarget_=!1,this.workspace_=null,this.SERIALIZABLE=!0,this.CURSOR="text",e!==Ke.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),i&&this.setValidator(i))}configure_(e){super.configure_(e),e.spellcheck!==void 0&&(this.spellcheck_=e.spellcheck)}initView(){if(!this.getSourceBlock())throw new ut;super.initView(),this.isFullBlockField()&&(this.clickTarget_=this.sourceBlock_.getSvgRoot())}isFullBlockField(){const e=this.getSourceBlock();if(!e)throw new ut;let i;return this.fullBlockClickTarget_=!((i=this.getConstants())==null||!i.FULL_BLOCK_FIELDS)&&e.isSimpleReporter()}doValueInvalid_(e,i=!0){this.isBeingEdited_&&(this.isDirty_=!0,this.isTextValid_=!1,e=this.value_,this.value_=this.valueWhenEditorWasOpened_,this.sourceBlock_&&ue()&&this.value_!==e&&i&&z(new(he(W.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,e,this.value_)))}doValueUpdate_(e){this.isTextValid_=this.isDirty_=!0,this.value_=e}applyColour(){const e=this.getSourceBlock();if(!e)throw new ut;this.getConstants().FULL_BLOCK_FIELDS&&this.fieldGroup_&&(!this.isFullBlockField()&&this.borderRect_?(this.borderRect_.style.display="block",this.borderRect_.setAttribute("stroke",e.getColourTertiary())):(this.borderRect_.style.display="none",e.pathObject.svgPath.setAttribute("fill",this.getConstants().FIELD_BORDER_RECT_COLOUR)))}getSize(){let e;return(e=this.getConstants())!=null&&e.FULL_BLOCK_FIELDS&&(this.render_(),this.isDirty_=!1),super.getSize()}onLocationChange(){this.isBeingEdited_&&this.resizeEditor_()}render_(){if(super.render_(),this.isBeingEdited_){var e=this.htmlInput_;this.isTextValid_?(S(e,"blocklyInvalidInput"),xt(e,bt.INVALID,!1)):(re(e,"blocklyInvalidInput"),xt(e,bt.INVALID,!0))}if(e=this.getSourceBlock(),!e)throw new ut;this.getConstants().FULL_BLOCK_FIELDS&&e.applyColour()}setSpellcheck(e){e!==this.spellcheck_&&(this.spellcheck_=e,this.htmlInput_&&this.htmlInput_.setAttribute("spellcheck",this.spellcheck_))}showEditor_(e,i=!1){this.workspace_=this.sourceBlock_.workspace,!i&&this.workspace_.options.modalInputs&&(J$||xd||Fa)?this.showPromptEditor():this.showInlineEditor(i)}showPromptEditor(){ra(s.Msg$$module$build$src$core$msg.CHANGE_VALUE_TITLE,this.getText(),e=>{e!==null&&this.setValue(this.getValueFromEditorText_(e)),this.onFinishEditing_(this.value_)})}showInlineEditor(e){const i=this.getSourceBlock();if(!i)throw new ut;_a(this,i.RTL,this.widgetDispose_.bind(this),this.workspace_),this.htmlInput_=this.widgetCreate_(),this.isBeingEdited_=!0,this.valueWhenEditorWasOpened_=this.value_,e||(this.htmlInput_.focus({preventScroll:!0}),this.htmlInput_.select())}widgetCreate_(){var e=this.getSourceBlock();if(!e)throw new ut;s.setGroup$$module$build$src$core$events$utils(!0);const i=xr();var n=this.getClickTarget_();if(!n)throw Error("A click target has not been set.");re(n,"editing"),n=document.createElement("input"),n.className="blocklyHtmlInput",n.setAttribute("spellcheck",this.spellcheck_);const c=this.workspace_.getScale();var d=this.getConstants().FIELD_TEXT_FONTSIZE*c+"pt";return i.style.fontSize=d,n.style.fontSize=d,d=vc.BORDERRADIUS*c+"px",this.isFullBlockField()&&(d=this.getScaledBBox(),d=(d.bottom-d.top)/2+"px",e=e.getParent()?e.getParent().getColourTertiary():this.sourceBlock_.getColourTertiary(),n.style.border=1*c+"px solid "+e,i.style.borderRadius=d,i.style.transition="box-shadow 0.25s ease 0s",this.getConstants().FIELD_TEXTINPUT_BOX_SHADOW&&(i.style.boxShadow="rgba(255, 255, 255, 0.3) 0 0 0 "+4*c+"px")),n.style.borderRadius=d,i.appendChild(n),n.value=n.defaultValue=this.getEditorText_(this.value_),n.setAttribute("data-untyped-default-value",String(this.value_)),this.resizeEditor_(),this.bindInputEvents_(n),n}widgetDispose_(){this.isBeingEdited_=!1,this.isTextValid_=!0,this.forceRerender(),this.onFinishEditing_(this.value_),this.sourceBlock_&&ue()&&this.valueWhenEditorWasOpened_!==null&&this.valueWhenEditorWasOpened_!==this.value_&&(z(new(he(W.BLOCK_CHANGE))(this.sourceBlock_,"field",this.name||null,this.valueWhenEditorWasOpened_,this.value_)),this.valueWhenEditorWasOpened_=null),s.setGroup$$module$build$src$core$events$utils(!1),this.unbindInputEvents_();var e=xr().style;if(e.width="auto",e.height="auto",e.fontSize="",e.transition="",e.boxShadow="",this.htmlInput_=null,e=this.getClickTarget_(),!e)throw Error("A click target has not been set.");S(e,"editing")}onFinishEditing_(e){}bindInputEvents_(e){this.onKeyDownWrapper=fe(e,"keydown",this,this.onHtmlInputKeyDown_),this.onKeyInputWrapper=fe(e,"input",this,this.onHtmlInputChange)}unbindInputEvents_(){this.onKeyDownWrapper&&(Ue(this.onKeyDownWrapper),this.onKeyDownWrapper=null),this.onKeyInputWrapper&&(Ue(this.onKeyInputWrapper),this.onKeyInputWrapper=null)}onHtmlInputKeyDown_(e){e.key==="Enter"?(Cr(this),oi()):e.key==="Escape"?(this.setValue(this.htmlInput_.getAttribute("data-untyped-default-value"),!1),Cr(this),oi()):e.key==="Tab"&&(Cr(this),oi(),this.sourceBlock_.tab(this,!e.shiftKey),e.preventDefault())}onHtmlInputChange(e){e=this.value_,this.setValue(this.getValueFromEditorText_(this.htmlInput_.value),!1),this.sourceBlock_&&ue()&&this.value_!==e&&z(new(he(W.BLOCK_FIELD_INTERMEDIATE_CHANGE))(this.sourceBlock_,this.name||null,e,this.value_))}setEditorValue_(e,i=!0){this.isDirty_=!0,this.isBeingEdited_&&(this.htmlInput_.value=this.getEditorText_(e)),this.setValue(e,i)}resizeEditor_(){Gs().then(()=>{const e=this.getSourceBlock();if(!e)throw new ut;const i=xr(),n=this.getScaledBBox();i.style.width=n.right-n.left+"px",i.style.height=n.bottom-n.top+"px";const c=n.top;i.style.left=`${e.RTL?n.right-i.offsetWidth:n.left}px`,i.style.top=`${c}px`})}repositionForWindowResize(){let e;const i=(e=this.getSourceBlock())==null?void 0:e.getRootBlock();return i instanceof Ps?(xn(this.workspace_,this.workspace_.getMetricsManager().getViewMetrics(!0),i)||this.resizeEditor_(),!0):!1}isTabNavigable(){return!0}getText_(){return this.isBeingEdited_&&this.htmlInput_?this.htmlInput_.value:null}getEditorText_(e){return`${e}`}getValueFromEditorText_(e){return e}};vc.BORDERRADIUS=4;var Sc=class extends vc{constructor(e,i,n){super(e,i,n)}doClassValidation_(e){return e===void 0?null:`${e}`}static fromJson(e){return new this(at(e.text),void 0,e)}};ai("field_input",Sc),Sc.prototype.DEFAULT_VALUE="";var _b=class extends hp{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){return!!e.outputConnection}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},Ic=class extends Jo{constructor(e,i){if(super(e,i),this.connectedBottomNextConnection=!1,this.connectedBlock){for(e=this.connectedBlock;i=e.getNextBlock();)e=i;e.nextConnection||(this.height=this.connectedBlockHeight,this.connectedBottomNextConnection=!0)}}},$b=class extends di{constructor(e){super(e),this.width=this.height=0,this.type|=N.getType("RIGHT_CONNECTION")}},Tb=class extends gp{constructor(e){super(e)}endsWithElemSpacer(){return!1}hasLeftSquareCorner(e){const i=(e.hat?e.hat==="cap":this.constants_.ADD_START_HATS)&&!e.outputConnection&&!e.previousConnection;return!!e.outputConnection||i}hasRightSquareCorner(e){return!!e.outputConnection&&!e.statementInputCount&&!e.nextConnection}},bb=class extends el{constructor(e,i){super(e,i),this.isInline=!0,this.renderer_=e,this.constants_=this.renderer_.getConstants(),this.topRow=new Tb(this.constants_),this.bottomRow=new _b(this.constants_),this.isMultiRow=!i.getInputsInline()||i.isCollapsed(),this.hasStatementInput=0<i.statementInputCount,this.rightSide=this.outputConnection?new $b(this.constants_):null,this.rightAlignedDummyInputs=new WeakMap}getRenderer(){return this.renderer_}measure(){this.createRows_(),this.addElemSpacing_(),this.addRowSpacing_(),this.adjustXPosition_(),this.computeBounds_(),this.alignRowElements_(),this.finalize_()}shouldStartNewRow_(e,i){return i?i instanceof Ui||e instanceof bs||i instanceof bs?!0:e instanceof s.ValueInput$$module$build$src$core$inputs$value_input||e instanceof pi||e instanceof Ui?!this.isInline||this.isMultiRow:!1:!1}getDesiredRowWidth_(e){return e.hasStatement?this.width-this.startX-(this.constants_.INSIDE_CORNERS.rightWidth||0):super.getDesiredRowWidth_(e)}getInRowSpacing_(e,i){return e&&i||!this.outputConnection||!this.outputConnection.isDynamicShape||this.hasStatementInput||this.bottomRow.hasNextConnection?!e&&i&&N.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:e&&N.isLeftRoundedCorner(e)&&i&&(N.isPreviousConnection(i)||N.isNextConnection(i))?i.notchOffset-this.constants_.CORNER_RADIUS:e&&N.isLeftSquareCorner(e)&&i&&N.isHat(i)?this.constants_.NO_PADDING:this.constants_.MEDIUM_PADDING:this.constants_.NO_PADDING}getSpacerRowHeight_(e,i){if(N.isTopRow(e)&&N.isBottomRow(i))return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;const n=N.isInputRow(e)&&e.hasStatement,c=N.isInputRow(i)&&i.hasStatement;return c||n?(e=Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.INSIDE_CORNERS.rightHeight||0),c&&n?Math.max(e,this.constants_.DUMMY_INPUT_MIN_HEIGHT):e):N.isTopRow(e)?e.hasPreviousConnection||this.outputConnection&&!this.hasStatementInput?this.constants_.NO_PADDING:Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):N.isBottomRow(i)?this.outputConnection?!i.hasNextConnection&&this.hasStatementInput?Math.abs(this.constants_.NOTCH_HEIGHT-this.constants_.CORNER_RADIUS):this.constants_.NO_PADDING:Math.max(this.topRow.minHeight,Math.max(this.constants_.NOTCH_HEIGHT,this.constants_.CORNER_RADIUS))-this.constants_.CORNER_RADIUS:this.constants_.MEDIUM_PADDING}getSpacerRowWidth_(e,i){const n=this.width-this.startX;return N.isInputRow(e)&&e.hasStatement||N.isInputRow(i)&&i.hasStatement?Math.max(n,this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH):n}getElemCenterline_(e,i){if(e.hasStatement&&!N.isSpacer(i)&&!N.isStatementInput(i))return e.yPos+this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT/2;if(N.isInlineInput(i)&&i instanceof cr){const n=i.connectedBlock;if(n&&n.outputConnection&&n.nextConnection)return e.yPos+n.height/2}return super.getElemCenterline_(e,i)}addInput_(e,i){if((e instanceof pi||e instanceof Ui)&&i.hasDummyInput&&i.align===s.Align$$module$build$src$core$inputs$align.LEFT&&e.align===s.Align$$module$build$src$core$inputs$align.RIGHT)this.rightAlignedDummyInputs.set(i,e);else if(e instanceof bs){i.elements.push(new Ic(this.constants_,e)),i.hasStatement=!0,i.align===null&&(i.align=e.align);return}super.addInput_(e,i)}addAlignmentPadding_(e,i){if(this.rightAlignedDummyInputs.get(e)){let n;for(let c=0;c<e.elements.length;c++){const d=e.elements[c];if(N.isSpacer(d)&&(n=d),N.isField(d)&&d instanceof Hn&&d.parentInput===this.rightAlignedDummyInputs.get(e))break}if(n){n.width+=i,e.width+=i;return}}super.addAlignmentPadding_(e,i)}adjustXPosition_(){const e=this.constants_.NOTCH_OFFSET_LEFT+this.constants_.NOTCH_WIDTH;let i=e;for(let d=2;d<this.rows.length-1;d+=2){var n=this.rows[d-1];const m=this.rows[d];var c=this.rows[d+1];if(n=d===2?!!this.topRow.hasPreviousConnection:!!n.followsStatement,c=d+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!c.precedesStatement,N.isInputRow(m)&&m.hasStatement){m.measure();let y,O;i=m.width-((O=(y=m.getLastInput())==null?void 0:y.width)!=null?O:0)+e}else if(n&&(d===2||c)&&N.isInputRow(m)&&!m.hasStatement){c=m.xPos,n=null;for(let y=0;y<m.elements.length;y++){const O=m.elements[y];N.isSpacer(O)&&(n=O),n&&(N.isField(O)||N.isInput(O))&&c<i&&!(N.isField(O)&&O instanceof Hn&&(O.field instanceof Wr||O.field instanceof Yr))&&(n.width+=i-c),c+=O.width}}}}finalizeOutputConnection_(){if(this.outputConnection&&this.outputConnection.isDynamicShape){var e=this.outputConnection.shape;if("isDynamic"in e&&e.isDynamic){for(var i=0,n=0;n<this.rows.length;n++){const c=this.rows[n];c.yPos=i,i+=c.height}this.height=i,n=this.bottomRow.hasNextConnection?this.height-this.bottomRow.descenderHeight:this.height,i=e.height(n),n=e.width(n),this.outputConnection.height=i,this.outputConnection.width=n,this.outputConnection.startX=n,this.outputConnection.connectionOffsetY=e.connectionOffsetY(i),this.outputConnection.connectionOffsetX=e.connectionOffsetX(n),e=0,this.hasStatementInput||this.bottomRow.hasNextConnection||(e=n,this.rightSide.height=i,this.rightSide.width=e,this.rightSide.centerline=i/2,this.rightSide.xPos=this.width+e),this.startX=n,this.width+=n+e,this.widthWithChildren+=n+e}}}finalizeHorizontalAlignment_(){if(this.outputConnection&&!this.hasStatementInput&&!this.bottomRow.hasNextConnection){for(var e=0,i=0;i<this.rows.length;i++){var n=this.rows[i];if(!N.isInputRow(n))continue;e=n.elements[n.elements.length-2];let c=this.getNegativeSpacing_(n.elements[1]),d=this.getNegativeSpacing_(e);e=c+d;const m=this.constants_.MIN_BLOCK_WIDTH+2*this.outputConnection.width;this.width-e<m&&(e=this.width-m,c=e/2,d=e/2),n.elements.unshift(new Ts(this.constants_,-c)),n.elements.push(new Ts(this.constants_,-d))}if(e)for(this.width-=e,this.widthWithChildren-=e,this.rightSide.xPos-=e,i=0;i<this.rows.length;i++)n=this.rows[i],N.isTopOrBottomRow(n)&&(n.elements[1].width-=e),n.width-=e,n.widthWithConnectedBlocks-=e}}getNegativeSpacing_(e){if(!e||!this.outputConnection)return 0;const i=this.outputConnection.width;var n=this.outputConnection.shape.type;const c=this.constants_;if(1<this.inputRows.length)switch(n){case c.SHAPES.ROUND:return n=this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH,n=this.height/2>n?n:this.height/2,i-n*(1-Math.sin(Math.acos((n-this.constants_.SMALL_PADDING)/n)));default:return 0}if(N.isInlineInput(e)&&e instanceof cr){const d=e.connectedBlock;return e=d?d.pathObject.outputShapeType:e.shape.type,e==null||d&&d.outputConnection&&(d.statementInputCount||d.nextConnection)||n===c.SHAPES.HEXAGONAL&&n!==e?0:i-this.constants_.SHAPE_IN_SHAPE_PADDING[n][e]}return N.isField(e)&&e instanceof Hn?n===c.SHAPES.ROUND&&e.field instanceof Sc?i-2.75*c.GRID_UNIT:i-this.constants_.SHAPE_IN_SHAPE_PADDING[n][0]:N.isIcon(e)?this.constants_.SMALL_PADDING:0}finalizeVerticalAlignment_(){if(!this.outputConnection)for(let c=2;c<this.rows.length-1;c+=2){const d=this.rows[c-1],m=this.rows[c],y=this.rows[c+1];var e=c===2,i=c+2>=this.rows.length-1?!!this.bottomRow.hasNextConnection:!!y.precedesStatement;if(e?this.topRow.hasPreviousConnection:d.followsStatement){var n=m.elements[1];if(n=m.elements.length===3&&n instanceof Hn&&(n.field instanceof Wr||n.field instanceof Yr),!e&&n)d.height-=this.constants_.SMALL_PADDING,y.height-=this.constants_.SMALL_PADDING,m.height-=this.constants_.MEDIUM_PADDING;else if(!e&&!i)d.height+=this.constants_.SMALL_PADDING;else if(i){for(e=!1,i=0;i<m.elements.length;i++)if(n=m.elements[i],n instanceof cr&&N.isInlineInput(n)&&n.connectedBlock&&!n.connectedBlock.isShadow()&&40<=n.connectedBlock.getHeightWidth().height){e=!0;break}e&&(d.height-=this.constants_.SMALL_PADDING,y.height-=this.constants_.SMALL_PADDING)}}}}finalize_(){this.finalizeOutputConnection_(),this.finalizeHorizontalAlignment_(),this.finalizeVerticalAlignment_(),super.finalize_(),this.rightSide&&(this.widthWithChildren+=this.rightSide.width)}},Eb=class extends $p{constructor(e,i,n){super(e,i,n),this.markerCircle=null}showWithInputOutput(e){const i=e.getSourceBlock();e=e.getLocation().getOffsetInBlock(),this.positionCircle(e.x,e.y),this.setParent_(i),this.showCurrent_()}showWithOutput_(e){this.showWithInputOutput(e)}showWithInput_(e){this.showWithInputOutput(e)}showWithBlock_(e){e=e.getLocation();const i=e.getHeightWidth();this.positionRect_(0,0,i.width,i.height),this.setParent_(e),this.showCurrent_()}positionCircle(e,i){let n;(n=this.markerCircle)==null||n.setAttribute("cx",`${e}`);let c;(c=this.markerCircle)==null||c.setAttribute("cy",`${i}`),this.currentMarkerSvg=this.markerCircle}hide(){super.hide(),this.markerCircle&&(this.markerCircle.style.display="none")}createDomInternal_(){if(super.createDomInternal_(),this.markerCircle=Y(U.CIRCLE,{r:this.constants_.CURSOR_RADIUS,"stroke-width":this.constants_.CURSOR_STROKE_WIDTH},this.markerSvg_),this.hide(),this.isCursor()){const e=this.getBlinkProperties_();Y(U.ANIMATE,e,this.markerCircle)}return this.markerSvg_}applyColour_(e){super.applyColour_(e);let i;(i=this.markerCircle)==null||i.setAttribute("fill",this.colour_);let n;if((n=this.markerCircle)==null||n.setAttribute("stroke",this.colour_),this.isCursor()){e=this.colour_+";transparent;transparent;";let c;(c=this.markerCircle)==null||c.firstElementChild.setAttribute("values",e)}}},yb=class extends mc{constructor(e,i,n){super(e,i,n),this.svgPathSelected=null,this.outlines=new Map,this.remainingOutlines=new Set,this.outputShapeType=null,this.constants=n}setPath(e){super.setPath(e),this.svgPathSelected&&this.svgPathSelected.setAttribute("d",e)}applyColour(e){super.applyColour(e);const i=e.getParent();e.isShadow()&&i&&this.svgPath.setAttribute("stroke",i.getColourTertiary());for(const n of this.outlines.values())n.setAttribute("fill",this.style.colourTertiary)}flipRTL(){super.flipRTL();for(const e of this.outlines.values())e.setAttribute("transform","scale(-1 1)")}updateSelected(e){this.setClass_("blocklySelected",e),e?this.svgPathSelected||(this.svgPathSelected=this.svgPath.cloneNode(!0),this.svgPathSelected.setAttribute("fill","none"),this.svgPathSelected.setAttribute("filter","url(#"+this.constants.selectedGlowFilterId+")"),this.svgRoot.appendChild(this.svgPathSelected)):this.svgPathSelected&&(this.svgRoot.removeChild(this.svgPathSelected),this.svgPathSelected=null)}updateReplacementFade(e){this.setClass_("blocklyReplaceable",e),e?this.svgPath.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):this.svgPath.removeAttribute("filter")}updateShapeForInputHighlight(e,i){e=e.getParentInput().name,(e=this.getOutlinePath(e))&&(i?e.setAttribute("filter","url(#"+this.constants.replacementGlowFilterId+")"):e.removeAttribute("filter"))}beginDrawing(){this.remainingOutlines.clear();for(const e of this.outlines.keys())this.remainingOutlines.add(e)}endDrawing(){if(this.remainingOutlines.size)for(const e of this.remainingOutlines)this.removeOutlinePath(e);this.remainingOutlines.clear()}setOutlinePath(e,i){e=this.getOutlinePath(e),e.setAttribute("d",i),e.setAttribute("fill",this.style.colourTertiary)}getOutlinePath(e){return this.outlines.has(e)||this.outlines.set(e,Y(U.PATH,{class:"blocklyOutlinePath",d:""},this.svgRoot)),this.remainingOutlines.delete(e),this.outlines.get(e)}removeOutlinePath(e){let i,n;(i=this.outlines.get(e))==null||(n=i.parentNode)==null||n.removeChild(this.outlines.get(e)),this.outlines.delete(e)}},Pp=class extends _c{constructor(e){super(e)}makeConstants_(){return new gb}makeRenderInfo_(e){return new bb(this,e)}makeDrawer_(e,i){return new mb(e,i)}makeMarkerDrawer(e,i){return new Eb(e,this.getConstants(),i)}makePathObject(e,i){return new yb(e,i,this.getConstants())}getConstants(){return this.constants_}getConnectionPreviewMethod(e,i,n){return $("getConnectionPreviewMethod","v10","v12","an IConnectionPreviewer, if it fulfills your use case."),i.type===le.OUTPUT_VALUE?e.isConnected()?Ls.PREVIEW_TYPE.REPLACEMENT_FADE:Ls.PREVIEW_TYPE.INPUT_OUTLINE:super.getConnectionPreviewMethod(e,i,n)}};Ro("zelos",Pp);var vb=class{constructor(e){this.staticConn=this.draggedConn=this.markerConn=this.fadedBlock=null,this.workspace=e.workspace}previewReplacement(e,i,n){s.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.fadedBlock=n,n.fadeForReplacement(!0),this.workspace.getRenderer().shouldHighlightConnection(i)&&(i.highlight(),this.staticConn=i)}finally{s.enable$$module$build$src$core$events$utils()}}previewConnection(e,i){if(e!==this.draggedConn||i!==this.staticConn){s.disable$$module$build$src$core$events$utils();try{this.hidePreview(),this.shouldUseMarkerPreview(e,i)&&(this.markerConn=this.previewMarker(e,i)),this.workspace.getRenderer().shouldHighlightConnection(i)&&i.highlight(),this.draggedConn=e,this.staticConn=i}finally{s.enable$$module$build$src$core$events$utils()}}}shouldUseMarkerPreview(e,i){return i.type===le.PREVIOUS_STATEMENT||i.type===le.NEXT_STATEMENT||!(this.workspace.getRenderer()instanceof Pp)}previewMarker(e,i){const n=e.getSourceBlock(),c=this.createInsertionMarker(n),d=this.getMatchingConnection(n,c,e);if(!d)return null;c.queueRender(),Si(),d.connect(i);const m={x:i.x-d.x,y:i.y-d.y},y=d.getOffsetInBlock().clone();return Gs().then(()=>{if(!c.isDeadOrDying()){s.disable$$module$build$src$core$events$utils();try{c==null||c.positionNearConnection(d,m,y),c==null||c.getSvgRoot().setAttribute("visibility","visible")}finally{s.enable$$module$build$src$core$events$utils()}}}),d}createInsertionMarker(e){const i=gs(e,{addCoordinates:!1,addInputBlocks:!1,addNextBlocks:!1,doFullSerialization:!1});if(!i)throw Error(`Failed to serialize source block. ${e.toDevString()}`);e=Ii(i,this.workspace);for(const n of e.getDescendants(!1))n.setInsertionMarker(!0);return e.initSvg(),e.getSvgRoot().setAttribute("visibility","hidden"),e}getMatchingConnection(e,i,n){if(e=e.getConnections_(!0),i=i.getConnections_(!0),e.length!==i.length)return null;for(let c=0;c<e.length;c++)if(e[c]===n)return i[c];return null}hidePreview(){s.disable$$module$build$src$core$events$utils();try{this.staticConn&&(this.staticConn.unhighlight(),this.staticConn=null),this.fadedBlock&&(this.fadedBlock.fadeForReplacement(!1),this.fadedBlock=null),this.markerConn&&(this.hideInsertionMarker(this.markerConn),this.draggedConn=this.markerConn=null)}finally{s.enable$$module$build$src$core$events$utils()}}hideInsertionMarker(e){const i=e.getSourceBlock(),n=i.outputConnection;let c;if((c=i.previousConnection)!=null&&c.targetConnection||n!=null&&n.targetConnection)i.unplug(!0);else{let d;(d=e.targetBlock())==null||d.unplug(!1)}i.dispose()}dispose(){this.hidePreview()}};r(Z.CONNECTION_PREVIEWER,hi,vb);var pr={};pr.Align=s.Align$$module$build$src$core$inputs$align,pr.DummyInput=pi,pr.EndRowInput=Ui,pr.Input=Vn,pr.StatementInput=bs,pr.ValueInput=s.ValueInput$$module$build$src$core$inputs$value_input,pr.inputTypes=s.inputTypes$$module$build$src$core$inputs$input_types;var Sb=!1,Ib;s.CodeGenerator$$module$build$src$core$generator=class{constructor(e){this.forBlock=Object.create(null),this.FUNCTION_NAME_PLACEHOLDER_="{leCUI8hutHZI4480Dc}",this.STATEMENT_SUFFIX=this.STATEMENT_PREFIX=this.INFINITE_LOOP_TRAP=null,this.INDENT="  ",this.COMMENT_WRAP=60,this.ORDER_OVERRIDES=[],this.isInitialized=null,this.RESERVED_WORDS_="",this.definitions_=Object.create(null),this.functionNames_=Object.create(null),this.nameDB_=void 0,this.name_=e,this.FUNCTION_NAME_PLACEHOLDER_REGEXP_=new RegExp(this.FUNCTION_NAME_PLACEHOLDER_,"g")}workspaceToCode(e){e||(console.warn("No workspace specified in workspaceToCode call.  Guessing."),e=gt());var i=[];this.init(e),e=e.getTopBlocks(!0);for(let n=0,c;c=e[n];n++){let d=this.blockToCode(c);Array.isArray(d)&&(d=d[0]),d&&(c.outputConnection&&(d=this.scrubNakedValue(d),this.STATEMENT_PREFIX&&!c.suppressPrefixSuffix&&(d=this.injectId(this.STATEMENT_PREFIX,c)+d),this.STATEMENT_SUFFIX&&!c.suppressPrefixSuffix&&(d+=this.injectId(this.STATEMENT_SUFFIX,c))),i.push(d))}return i=i.join(`
`),i=this.finish(i),i=i.replace(/^\s+\n/,""),i=i.replace(/\n\s+$/,`
`),i=i.replace(/[ \t]+\n/g,`
`)}prefixLines(e,i){return i+e.replace(/(?!\n$)\n/g,`
`+i)}allNestedComments(e){const i=[];e=e.getDescendants(!0);for(let n=0;n<e.length;n++){const c=e[n].getCommentText();c&&i.push(c)}return i.length&&i.push(""),i.join(`
`)}blockToCode(e,i){if(this.isInitialized===!1&&console.warn("CodeGenerator init was not called before blockToCode was called."),!e)return"";if(!e.isEnabled())return i?"":this.blockToCode(e.getNextBlock());if(e.isInsertionMarker())return i?"":this.blockToCode(e.getChildren(!1)[0]);var n=this.forBlock[e.type];if(typeof n!="function")throw Error(`${this.name_} generator does not know how to generate code for block type "${e.type}".`);if(n=n.call(e,e,this),Array.isArray(n)){if(!e.outputConnection)throw TypeError("Expecting string from statement block: "+e.type);return[this.scrub_(e,n[0],i),n[1]]}if(typeof n=="string")return this.STATEMENT_PREFIX&&!e.suppressPrefixSuffix&&(n=this.injectId(this.STATEMENT_PREFIX,e)+n),this.STATEMENT_SUFFIX&&!e.suppressPrefixSuffix&&(n+=this.injectId(this.STATEMENT_SUFFIX,e)),this.scrub_(e,n,i);if(n===null)return"";throw SyntaxError("Invalid code generated: "+n)}valueToCode(e,i,n){if(isNaN(n))throw TypeError("Expecting valid order from block: "+e.type);var c=e.getInputTargetBlock(i);if(!c&&!e.getInput(i))throw ReferenceError(`Input "${i}" doesn't exist on "${e.type}"`);if(!c||(i=this.blockToCode(c),i===""))return"";if(!Array.isArray(i))throw TypeError(`Expecting tuple from value block: ${c.type} See developers.google.com/blockly/guides/create-custom-blocks/generating-code for more information`);if(e=i[0],i=i[1],isNaN(i))throw TypeError("Expecting valid order from value block: "+c.type);if(!e)return"";c=!1;var d=Math.floor(n);const m=Math.floor(i);if(d<=m&&(d!==m||d!==0&&d!==99)){for(c=!0,d=0;d<this.ORDER_OVERRIDES.length;d++)if(this.ORDER_OVERRIDES[d][0]===n&&this.ORDER_OVERRIDES[d][1]===i){c=!1;break}}return c&&(e="("+e+")"),e}statementToCode(e,i){const n=e.getInputTargetBlock(i);if(!n&&!e.getInput(i))throw ReferenceError(`Input "${i}" doesn't exist on "${e.type}"`);if(e=this.blockToCode(n),typeof e!="string")throw TypeError("Expecting code from statement block: "+(n&&n.type));return e&&(e=this.prefixLines(e,this.INDENT)),e}addLoopTrap(e,i){return this.INFINITE_LOOP_TRAP&&(e=this.prefixLines(this.injectId(this.INFINITE_LOOP_TRAP,i),this.INDENT)+e),this.STATEMENT_SUFFIX&&!i.suppressPrefixSuffix&&(e=this.prefixLines(this.injectId(this.STATEMENT_SUFFIX,i),this.INDENT)+e),this.STATEMENT_PREFIX&&!i.suppressPrefixSuffix&&(e+=this.prefixLines(this.injectId(this.STATEMENT_PREFIX,i),this.INDENT)),e}injectId(e,i){return i=i.id.replace(/\$/g,"$$$$"),e.replace(/%1/g,"'"+i+"'")}addReservedWords(e){this.RESERVED_WORDS_+=e+","}provideFunction_(e,i){if(!this.definitions_[e]){const n=this.nameDB_.getDistinctName(e,s.NameType$$module$build$src$core$names.PROCEDURE);this.functionNames_[e]=n,Array.isArray(i)&&(i=i.join(`
`)),i=i.trim().replace(this.FUNCTION_NAME_PLACEHOLDER_REGEXP_,n);let c;for(;c!==i;)c=i,i=i.replace(/^(( {2})*) {2}/gm,"$1\0");i=i.replace(/\0/g,this.INDENT),this.definitions_[e]=i}return this.functionNames_[e]}getVariableName(e){return this.getName(e,s.NameType$$module$build$src$core$names.VARIABLE)}getProcedureName(e){return this.getName(e,s.NameType$$module$build$src$core$names.PROCEDURE)}getName(e,i){if(!this.nameDB_)throw Error("Name database is not defined. You must initialize `nameDB_` in your generator class and call `init` first.");return this.nameDB_.getName(e,i)}init(e){this.definitions_=Object.create(null),this.functionNames_=Object.create(null)}scrub_(e,i,n){return i}finish(e){return this.definitions_=Object.create(null),this.functionNames_=Object.create(null),e}scrubNakedValue(e){return e}},Ib={},Ib.CodeGenerator=s.CodeGenerator$$module$build$src$core$generator;var xb=class extends Lp{constructor(e,i){super(e),this.flyout_=i}getBoundingBox(){let e;try{e=this.workspace_.getCanvas().getBBox()}catch{e={height:0,y:0,width:0,x:0}}return e}getContentMetrics(e){const i=this.getBoundingBox();return e=e?1:this.workspace_.scale,{height:i.height*e,width:i.width*e,top:i.y*e,left:i.x*e}}getScrollMetrics(e,i,n){return i=n||this.getContentMetrics(),n=this.flyout_.MARGIN*this.workspace_.scale,e=e?this.workspace_.scale:1,{height:(i.height+2*n)/e,width:(i.width+i.left+n)/e,top:0,left:0}}},Kn;(function(e){e.BLOCK="block",e.BUTTON="button"})(Kn||(Kn={}));var IC="WORKSPACE_AT_BLOCK_CAPACITY",xc=class extends Tc{constructor(e){super(),this.horizontalLayout=!1,this.boundEvents=[],this.filterWrapper=this.reflowWrapper=null,this.mats=[],this.buttons_=[],this.contents=[],this.listeners=[],this.permanentlyDisabled=[],this.recycledBlocks=[],this.autoClose=!0,this.visible=!1,this.containerVisible=!0,this.CORNER_RADIUS=8,this.SCROLLBAR_MARGIN=2.5,this.height_=this.width_=0,this.dragAngleRange_=70,this.svgGroup_=this.svgBackground_=null,e.setMetrics=this.setMetrics_.bind(this),this.workspace_=new Es(e),this.workspace_.setMetricsManager(new xb(this.workspace_,this)),this.workspace_.internalIsFlyout=!0,this.workspace_.setVisible(this.visible),this.id=v(),this.RTL=!!e.RTL,this.toolboxPosition_=e.toolboxPosition,this.tabWidth_=this.workspace_.getRenderer().getConstants().TAB_WIDTH,this.rectMap_=new WeakMap,this.MARGIN=this.CORNER_RADIUS,this.GAP_X=3*this.MARGIN,this.GAP_Y=3*this.MARGIN}createDom(e){return this.svgGroup_=Y(e,{class:"blocklyFlyout"}),this.svgGroup_.style.display="none",this.svgBackground_=Y(U.PATH,{class:"blocklyFlyoutBackground"},this.svgGroup_),this.svgGroup_.appendChild(this.workspace_.createDom()),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutBackgroundColour","fill"),this.workspace_.getThemeManager().subscribe(this.svgBackground_,"flyoutOpacity","fill-opacity"),this.svgGroup_}init(e){this.targetWorkspace=e,this.workspace_.targetWorkspace=e,this.workspace_.scrollbar=new Mp(this.workspace_,this.horizontalLayout,!this.horizontalLayout,"blocklyFlyoutScrollbar",this.SCROLLBAR_MARGIN),this.hide(),this.boundEvents.push(fe(this.svgGroup_,"wheel",this,this.wheel_)),this.filterWrapper=this.filterForCapacity.bind(this),this.targetWorkspace.addChangeListener(this.filterWrapper),this.boundEvents.push(fe(this.svgBackground_,"pointerdown",this,this.onMouseDown)),this.workspace_.getGesture=this.targetWorkspace.getGesture.bind(this.targetWorkspace),this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap()),this.workspace_.createPotentialVariableMap(),e.getComponentManager().addComponent({component:this,weight:et.ComponentWeight.FLYOUT_WEIGHT,capabilities:[et.Capability.AUTOHIDEABLE,et.Capability.DELETE_AREA,et.Capability.DRAG_TARGET]})}dispose(){this.hide(),this.targetWorkspace.getComponentManager().removeComponent(this.id);for(const e of this.boundEvents)Ue(e);this.boundEvents.length=0,this.filterWrapper&&this.targetWorkspace.removeChangeListener(this.filterWrapper),this.workspace_&&(this.workspace_.getThemeManager().unsubscribe(this.svgBackground_),this.workspace_.dispose()),this.svgGroup_&&F(this.svgGroup_)}getWidth(){return this.width_}getHeight(){return this.height_}getFlyoutScale(){return this.targetWorkspace.scale}getWorkspace(){return this.workspace_}setAutoClose(e){this.autoClose=e,this.targetWorkspace.recordDragTargets(),this.targetWorkspace.resizeContents()}autoHide(e){!e&&this.targetWorkspace.getFlyout(!0)===this&&this.autoClose&&this.hide()}getTargetWorkspace(){return this.targetWorkspace}isVisible(){return this.visible}setVisible(e){const i=e!==this.isVisible();this.visible=e,i&&(this.autoClose||this.targetWorkspace.recordDragTargets(),this.updateDisplay())}setContainerVisible(e){const i=e!==this.containerVisible;this.containerVisible=e,i&&this.updateDisplay()}getContents(){return this.contents}setContents(e){this.contents=e}updateDisplay(){let e;e=this.containerVisible?this.isVisible():!1,this.svgGroup_&&(this.svgGroup_.style.display=e?"block":"none");let i;(i=this.workspace_.scrollbar)==null||i.setContainerVisible(e)}positionAt_(e,i,n,c){let d;(d=this.svgGroup_)==null||d.setAttribute("width",`${e}`);let m;(m=this.svgGroup_)==null||m.setAttribute("height",`${i}`),this.workspace_.setCachedParentSvgSize(e,i),this.svgGroup_&&Ye(this.svgGroup_,"translate("+n+"px,"+c+"px)"),(e=this.workspace_.scrollbar)&&(e.setOrigin(n,c),e.resize(),e.hScroll&&e.hScroll.setPosition(e.hScroll.position.x,e.hScroll.position.y),e.vScroll&&e.vScroll.setPosition(e.vScroll.position.x,e.vScroll.position.y))}hide(){if(this.isVisible()){this.setVisible(!1);for(const e of this.listeners)Ue(e);this.listeners.length=0,this.reflowWrapper&&(this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowWrapper=null)}}show(e){this.workspace_.setResizesEnabled(!1),this.hide(),this.clearOldBlocks(),typeof e=="string"&&(e=this.getDynamicCategoryContents(e)),this.setVisible(!0),e=po(e),e=this.createFlyoutInfo(e),Si(this.workspace_),this.setContents(e.contents),this.layout_(e.contents,e.gaps),this.horizontalLayout?this.height_=0:this.width_=0,this.workspace_.setResizesEnabled(!0),this.reflow(),this.filterForCapacity(),this.position(),this.reflowWrapper=this.reflow.bind(this),this.workspace_.addChangeListener(this.reflowWrapper),this.emptyRecycledBlocks()}createFlyoutInfo(e){const i=[],n=[];this.permanentlyDisabled.length=0;const c=this.horizontalLayout?this.GAP_X:this.GAP_Y;for(const d of e){if("custom"in d){e=this.getDynamicCategoryContents(d.custom),e=po(e);const{contents:m,gaps:y}=this.createFlyoutInfo(e);i.push(...m),n.push(...y)}switch(d.kind.toUpperCase()){case"BLOCK":e=d;const m=this.createFlyoutBlock(e);i.push({type:Kn.BLOCK,block:m}),this.addBlockGap(e,n,c);break;case"SEP":this.addSeparatorGap(d,n,c);break;case"LABEL":e=this.createButton(d,!0),i.push({type:Kn.BUTTON,button:e}),n.push(c);break;case"BUTTON":e=this.createButton(d,!1),i.push({type:Kn.BUTTON,button:e}),n.push(c)}}return{contents:i,gaps:n}}getDynamicCategoryContents(e){if(e=this.workspace_.targetWorkspace.getToolboxCategoryCallback(e),typeof e!="function")throw TypeError("Couldn't find a callback function when opening a toolbox category.");return e(this.workspace_.targetWorkspace)}createButton(e,i){return new Ms(this.workspace_,this.targetWorkspace,e,i)}createFlyoutBlock(e){let i;return e.blockxml?(e=typeof e.blockxml=="string"?s.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,(i=this.getRecycledBlock(e.getAttribute("type")))||(i=wr(e,this.workspace_))):(i=this.getRecycledBlock(e.type),i||(e.enabled===void 0&&(e.enabled=e.disabled!=="true"&&e.disabled!==!0),e.disabledReasons===void 0&&e.enabled===!1&&(e.disabledReasons=[es]),i=_n(e,this.workspace_))),i.isEnabled()||this.permanentlyDisabled.push(i),i}getRecycledBlock(e){let i=-1;for(let n=0;n<this.recycledBlocks.length;n++)if(this.recycledBlocks[n].type===e){i=n;break}return i===-1?void 0:this.recycledBlocks.splice(i,1)[0]}addBlockGap(e,i,n){let c;e.gap?c=parseInt(String(e.gap)):e.blockxml&&(e=typeof e.blockxml=="string"?s.textToDom$$module$build$src$core$utils$xml(e.blockxml):e.blockxml,c=parseInt(e.getAttribute("gap"))),i.push(!c||isNaN(c)?n:c)}addSeparatorGap(e,i,n){e=parseInt(String(e.gap)),!isNaN(e)&&0<i.length?i[i.length-1]=e:i.push(n)}clearOldBlocks(){var e=this.workspace_.getTopBlocks(!1);for(let n=0,c;c=e[n];n++)this.blockIsRecyclable_(c)?this.recycleBlock(c):c.dispose(!1,!1);for(e=0;e<this.mats.length;e++){const n=this.mats[e];n&&(pa(n),F(n))}this.mats.length=0;for(let n=0,c;c=this.buttons_[n];n++)c.dispose();this.buttons_.length=0;let i;(i=this.workspace_.getPotentialVariableMap())==null||i.clear()}emptyRecycledBlocks(){for(let e=0;e<this.recycledBlocks.length;e++)this.recycledBlocks[e].dispose();this.recycledBlocks=[]}blockIsRecyclable_(e){return!1}recycleBlock(e){const i=e.getRelativeToSurfaceXY();e.moveBy(-i.x,-i.y),this.recycledBlocks.push(e)}addBlockListeners_(e,i,n){this.listeners.push(fe(e,"pointerdown",null,this.blockMouseDown(i))),this.listeners.push(fe(n,"pointerdown",null,this.blockMouseDown(i))),this.listeners.push(Xe(e,"pointerenter",i,()=>{this.targetWorkspace.isDragging()||i.addSelect()})),this.listeners.push(Xe(e,"pointerleave",i,()=>{this.targetWorkspace.isDragging()||i.removeSelect()})),this.listeners.push(Xe(n,"pointerenter",i,()=>{this.targetWorkspace.isDragging()||i.addSelect()})),this.listeners.push(Xe(n,"pointerleave",i,()=>{this.targetWorkspace.isDragging()||i.removeSelect()}))}blockMouseDown(e){return i=>{const n=this.targetWorkspace.getGesture(i);n&&(n.setStartBlock(e),n.handleFlyoutStart(i,this))}}onMouseDown(e){const i=this.targetWorkspace.getGesture(e);i&&i.handleFlyoutStart(e,this)}isBlockCreatable(e){return e.isEnabled()}createBlock(e){let i=null;s.disable$$module$build$src$core$events$utils();var n=this.targetWorkspace.getAllVariables();this.targetWorkspace.setResizesEnabled(!1);try{i=this.placeNewBlock(e)}finally{s.enable$$module$build$src$core$events$utils()}if(this.targetWorkspace.hideChaff(),e=$o(this.targetWorkspace,n),ue()){for(s.setGroup$$module$build$src$core$events$utils(!0),n=0;n<e.length;n++){const c=e[n];z(new(he(W.VAR_CREATE))(c))}z(new(he(W.BLOCK_CREATE))(i))}return this.autoClose?this.hide():this.filterForCapacity(),i}initFlyoutButton_(e,i,n){const c=e.createDom();e.moveTo(i,n),e.show(),this.listeners.push(fe(c,"pointerdown",this,this.onMouseDown)),this.buttons_.push(e)}createRect_(e,i,n,c,d){return i=Y(U.RECT,{"fill-opacity":0,x:i,y:n,height:c.height,width:c.width}),i.tooltip=e,En(i),this.workspace_.getCanvas().insertBefore(i,e.getSvgRoot()),this.rectMap_.set(e,i),this.mats[d]=i}moveRectToBlock_(e,i){const n=i.getHeightWidth();e.setAttribute("width",String(n.width)),e.setAttribute("height",String(n.height)),i=i.getRelativeToSurfaceXY(),e.setAttribute("y",String(i.y)),e.setAttribute("x",String(this.RTL?i.x-n.width:i.x))}filterForCapacity(){const e=this.workspace_.getTopBlocks(!1);for(let i=0,n;n=e[i];i++)if(!this.permanentlyDisabled.includes(n)){const c=this.targetWorkspace.isCapacityAvailable(os(n));for(;n;)n.setDisabledReason(!c,IC),n=n.getNextBlock()}}reflow(){this.reflowWrapper&&this.workspace_.removeChangeListener(this.reflowWrapper),this.reflowInternal_(),this.reflowWrapper&&this.workspace_.addChangeListener(this.reflowWrapper)}isScrollable(){return this.workspace_.scrollbar?this.workspace_.scrollbar.isVisible():!1}placeNewBlock(e){var i=this.targetWorkspace;if(!e.getSvgRoot())throw Error("oldBlock is not rendered");const n=this.serializeBlock(e);return i.setResizesEnabled(!1),i=Ii(n,i),this.positionNewBlock(e,i),i}serializeBlock(e){return gs(e)}positionNewBlock(e,i){const n=this.targetWorkspace;var c=n.getOriginOffsetInPixels(),d=this.workspace_.getOriginOffsetInPixels();e=e.getRelativeToSurfaceXY(),e.scale(this.workspace_.scale),d=te.sum(d,e),c=te.difference(d,c),c.scale(1/n.scale),i.moveTo(new te(c.x,c.y))}};xc.FlyoutItemType=Kn;var Np=class extends xc{constructor(e){super(e)}setMetrics_(e){if(this.isVisible()){var i=this.workspace_.getMetricsManager(),n=i.getScrollMetrics(),c=i.getViewMetrics();i=i.getAbsoluteMetrics(),typeof e.y=="number"&&(this.workspace_.scrollY=-(n.top+(n.height-c.height)*e.y)),this.workspace_.translate(this.workspace_.scrollX+i.left,this.workspace_.scrollY+i.top)}}getX(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const i=e.getAbsoluteMetrics(),n=e.getViewMetrics();return e=e.getToolboxMetrics(),this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?this.toolboxPosition_===Ie.LEFT?e.width:n.width-this.width_:this.toolboxPosition_===Ie.LEFT?0:n.width:this.toolboxPosition_===Ie.LEFT?0:n.width+i.left-this.width_}getY(){return 0}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.height_=e.height,this.setBackgroundPath(this.width_-this.CORNER_RADIUS,e.height-2*this.CORNER_RADIUS),e=this.getX();var i=this.getY();this.positionAt_(this.width_,this.height_,e,i)}}setBackgroundPath(e,i){const n=this.toolboxPosition_===Ie.RIGHT;var c=e+this.CORNER_RADIUS;c=["M "+(n?c:0)+",0"],c.push("h",n?-e:e),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?-this.CORNER_RADIUS:this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("v",Math.max(0,i)),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,n?0:1,n?this.CORNER_RADIUS:-this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("h",n?e:-e),c.push("z"),this.svgBackground_.setAttribute("d",c.join(" "))}scrollToStart(){let e;(e=this.workspace_.scrollbar)==null||e.setY(0)}wheel_(e){var i=ri(e);if(i.y){const n=this.workspace_.getMetricsManager(),c=n.getScrollMetrics();i=n.getViewMetrics().top-c.top+i.y;let d;(d=this.workspace_.scrollbar)==null||d.setY(i),vo(this.workspace_),oi()}e.preventDefault(),e.stopPropagation()}layout_(e,i){this.workspace_.scale=this.targetWorkspace.scale;var n=this.MARGIN;const c=this.RTL?n:n+this.tabWidth_;for(let O=0,K;K=e[O];O++)if(K.type==="block"){var d=K.block;if(!d)continue;var m=d.getDescendants(!1);for(let Ze=0,Je;Je=m[Ze];Ze++)Je.isInFlyout=!0;m=d.getSvgRoot();const oe=d.getHeightWidth();var y=d.outputConnection?c-this.tabWidth_:c;d.moveBy(y,n),y=this.createRect_(d,this.RTL?y-oe.width:y,n,oe,O),this.addBlockListeners_(m,d,y),n+=oe.height+i[O]}else K.type==="button"&&(d=K.button,this.initFlyoutButton_(d,c,n),n+=d.height+i[O])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const i=this.dragAngleRange_;return e<i&&e>-i||e<-180+i||e>180-i}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),i=e.left;return this.toolboxPosition_===Ie.LEFT?new Ve(-1e9,1e9,-1e9,i+e.width):new Ve(-1e9,1e9,i,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;var i=this.workspace_.getTopBlocks(!1);for(let c=0,d;d=i[c];c++){var n=d.getHeightWidth().width;d.outputConnection&&(n-=this.tabWidth_),e=Math.max(e,n)}for(let c=0,d;d=this.buttons_[c];c++)e=Math.max(e,d.width);if(e+=1.5*this.MARGIN+this.tabWidth_,e*=this.workspace_.scale,e+=ht.scrollbarThickness,this.width_!==e){for(let c=0,d;d=i[c];c++){if(this.RTL){n=d.getRelativeToSurfaceXY().x;let m=e/this.workspace_.scale-this.MARGIN;d.outputConnection||(m-=this.tabWidth_),d.moveBy(m-n,0)}this.rectMap_.has(d)&&this.moveRectToBlock_(this.rectMap_.get(d),d)}if(this.RTL)for(let c=0,d;d=this.buttons_[c];c++)i=d.getPosition().y,d.moveTo(e/this.workspace_.scale-d.width-this.MARGIN-this.tabWidth_,i);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Ie.LEFT||this.targetWorkspace.translate(this.targetWorkspace.scrollX+e,this.targetWorkspace.scrollY),this.width_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};Np.registryName="verticalFlyout",r(Z.FLYOUTS_VERTICAL_TOOLBOX,hi,Np);var Cb=class extends xc{constructor(e){super(e),this.horizontalLayout=!0}setMetrics_(e){if(this.isVisible()){var i=this.workspace_.getMetricsManager(),n=i.getScrollMetrics(),c=i.getViewMetrics();i=i.getAbsoluteMetrics(),typeof e.x=="number"&&(this.workspace_.scrollX=-(n.left+(n.width-c.width)*e.x)),this.workspace_.translate(this.workspace_.scrollX+i.left,this.workspace_.scrollY+i.top)}}getX(){return 0}getY(){if(!this.isVisible())return 0;var e=this.targetWorkspace.getMetricsManager();const i=e.getAbsoluteMetrics(),n=e.getViewMetrics();e=e.getToolboxMetrics();const c=this.toolboxPosition_===Ie.TOP;return this.targetWorkspace.toolboxPosition===this.toolboxPosition_?this.targetWorkspace.getToolbox()?c?e.height:n.height-this.height_:c?0:n.height:c?0:n.height+i.top-this.height_}position(){if(this.isVisible()&&this.targetWorkspace.isVisible()){var e=this.targetWorkspace.getMetricsManager().getViewMetrics();this.width_=e.width,this.setBackgroundPath(e.width-2*this.CORNER_RADIUS,this.height_-this.CORNER_RADIUS),e=this.getX();var i=this.getY();this.positionAt_(this.width_,this.height_,e,i)}}setBackgroundPath(e,i){const n=this.toolboxPosition_===Ie.TOP,c=["M 0,"+(n?0:this.CORNER_RADIUS)];n?(c.push("h",e+2*this.CORNER_RADIUS),c.push("v",i),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("h",-e),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,-this.CORNER_RADIUS,-this.CORNER_RADIUS)):(c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,-this.CORNER_RADIUS),c.push("h",e),c.push("a",this.CORNER_RADIUS,this.CORNER_RADIUS,0,0,1,this.CORNER_RADIUS,this.CORNER_RADIUS),c.push("v",i),c.push("h",-e-2*this.CORNER_RADIUS)),c.push("z"),this.svgBackground_.setAttribute("d",c.join(" "))}scrollToStart(){let e;(e=this.workspace_.scrollbar)==null||e.setX(this.RTL?1/0:0)}wheel_(e){var i=ri(e);if(i=i.x||i.y){const n=this.workspace_.getMetricsManager(),c=n.getScrollMetrics();i=n.getViewMetrics().left-c.left+i;let d;(d=this.workspace_.scrollbar)==null||d.setX(i),vo(this.workspace_),oi()}e.preventDefault(),e.stopPropagation()}layout_(e,i){this.workspace_.scale=this.targetWorkspace.scale;const n=this.MARGIN;let c=n+this.tabWidth_;this.RTL&&(e=e.reverse());for(let O=0,K;K=e[O];O++)if(K.type==="block"){var d=K.block;if(d==null)continue;var m=d.getDescendants(!1);for(let Ze=0,Je;Je=m[Ze];Ze++)Je.isInFlyout=!0;m=d.getSvgRoot();const oe=d.getHeightWidth();var y=d.outputConnection?this.tabWidth_:0;y=this.RTL?c+oe.width:c-y,d.moveBy(y,n),y=this.createRect_(d,y,n,oe,O),c+=oe.width+i[O],this.addBlockListeners_(m,d,y)}else K.type==="button"&&(d=K.button,this.initFlyoutButton_(d,c,n),c+=d.width+i[O])}isDragTowardWorkspace(e){e=Math.atan2(e.y,e.x)/Math.PI*180;const i=this.dragAngleRange_;return e<90+i&&e>90-i||e>-90-i&&e<-90+i}getClientRect(){if(!this.svgGroup_||this.autoClose||!this.isVisible())return null;const e=this.svgGroup_.getBoundingClientRect(),i=e.top;return this.toolboxPosition_===Ie.TOP?new Ve(-1e9,i+e.height,-1e9,1e9):new Ve(i,1e9,-1e9,1e9)}reflowInternal_(){this.workspace_.scale=this.getFlyoutScale();let e=0;const i=this.workspace_.getTopBlocks(!1);for(let c=0,d;d=i[c];c++)e=Math.max(e,d.getHeightWidth().height);const n=this.buttons_;for(let c=0,d;d=n[c];c++)e=Math.max(e,d.height);if(e+=1.5*this.MARGIN,e*=this.workspace_.scale,e+=ht.scrollbarThickness,this.height_!==e){for(let c=0,d;d=i[c];c++)this.rectMap_.has(d)&&this.moveRectToBlock_(this.rectMap_.get(d),d);this.targetWorkspace.scrollbar||this.autoClose||this.targetWorkspace.getFlyout()!==this||this.toolboxPosition_!==Ie.TOP||this.targetWorkspace.translate(this.targetWorkspace.scrollX,this.targetWorkspace.scrollY+e),this.height_=e,this.position(),this.targetWorkspace.resizeContents(),this.targetWorkspace.recordDragTargets()}}};r(Z.FLYOUTS_HORIZONTAL_TOOLBOX,hi,Cb);var rl=class extends hs{constructor(e,i,n,c,d){super(Ke.SKIP_SETUP),this.defaultType="",this.variableTypes=[],this.variable=null,this.SERIALIZABLE=!0,this.menuGenerator_=rl.dropdownCreate,this.defaultVariableName=typeof e=="string"?e:"",this.size_=new Oe(0,0),e!==Ke.SKIP_SETUP&&(d?this.configure_(d):this.setTypes(n,c),i&&this.setValidator(i))}configure_(e){super.configure_(e),this.setTypes(e.variableTypes,e.defaultType)}initModel(){var e=this.getSourceBlock();if(!e)throw new ut;this.variable||(e=s.getOrCreateVariablePackage$$module$build$src$core$variables(e.workspace,null,this.defaultVariableName,this.defaultType),this.doValueUpdate_(e.getId()))}shouldAddBorderRect_(){const e=this.getSourceBlock();if(!e)throw new ut;return super.shouldAddBorderRect_()&&(!this.getConstants().FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW||e.type!=="variables_get")}fromXml(e){var i=this.getSourceBlock();if(!i)throw new ut;const n=e.getAttribute("id"),c=e.textContent,d=e.getAttribute("variabletype")||e.getAttribute("variableType")||"";if(i=s.getOrCreateVariablePackage$$module$build$src$core$variables(i.workspace,n,c,d),d!==null&&d!==i.type)throw Error("Serialized variable type with id '"+i.getId()+"' had type "+i.type+", and does not match variable field that references it: "+li(e)+".");this.setValue(i.getId())}toXml(e){return this.initModel(),e.id=this.variable.getId(),e.textContent=this.variable.name,this.variable.type&&e.setAttribute("variabletype",this.variable.type),e}saveState(e){var i=this.saveLegacyState(rl);return i!==null||(this.initModel(),i={id:this.variable.getId()},e&&(i.name=this.variable.name,i.type=this.variable.type)),i}loadState(e){const i=this.getSourceBlock();if(!i)throw new ut;this.loadLegacyState(rl,e)||(e=s.getOrCreateVariablePackage$$module$build$src$core$variables(i.workspace,e.id||null,e.name,e.type||""),this.setValue(e.getId()))}setSourceBlock(e){if(e.isShadow())throw Error("Variable fields are not allowed to exist on shadow blocks.");super.setSourceBlock(e)}getValue(){return this.variable?this.variable.getId():null}getText(){return this.variable?this.variable.name:""}getVariable(){return this.variable}getValidator(){return this.variable?this.validator_:null}doClassValidation_(e){if(e===null)return null;var i=this.getSourceBlock();if(!i)throw new ut;return i=s.getVariable$$module$build$src$core$variables(i.workspace,e),i?(i=i.type,this.typeIsAllowed(i)?e:(console.warn("Variable type doesn't match this field!  Type was "+i),null)):(console.warn("Variable id doesn't point to a real variable! ID was "+e),null)}doValueUpdate_(e){const i=this.getSourceBlock();if(!i)throw new ut;this.variable=s.getVariable$$module$build$src$core$variables(i.workspace,e),super.doValueUpdate_(e)}typeIsAllowed(e){const i=this.getVariableTypes();if(!i)return!0;for(let n=0;n<i.length;n++)if(e===i[n])return!0;return!1}getVariableTypes(){var e=this.variableTypes;if(e===null&&this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())return this.sourceBlock_.workspace.getVariableTypes();if(e=e||[""],e.length===0)throw e=this.getText(),Error("'variableTypes' of field variable "+e+" was an empty list");return e}setTypes(e=null,i=""){if(Array.isArray(e)){let n=!1;for(let c=0;c<e.length;c++)e[c]===i&&(n=!0);if(!n)throw Error("Invalid default type '"+i+"' in the definition of a FieldVariable")}else if(e!==null)throw Error("'variableTypes' was not an array in the definition of a FieldVariable");this.defaultType=i,this.variableTypes=e}refreshVariableName(){this.forceRerender()}onItemSelected_(e,i){if(e=i.getValue(),this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying()){if(e===bp){s.renameVariable$$module$build$src$core$variables(this.sourceBlock_.workspace,this.variable);return}if(e===Ep){this.sourceBlock_.workspace.deleteVariableById(this.variable.getId());return}}this.setValue(e)}referencesVariables(){return!0}static fromJson(e){return new this(at(e.variable),void 0,void 0,void 0,e)}static dropdownCreate(){if(!this.variable)throw Error("Tried to call dropdownCreate on a variable field with no variable selected.");const e=this.getText();let i=[];if(this.sourceBlock_&&!this.sourceBlock_.isDeadOrDying())for(var n=this.getVariableTypes(),c=0;c<n.length;c++){const d=this.sourceBlock_.workspace.getVariablesOfType(n[c]);i=i.concat(d)}for(i.sort(Go.compareByName),n=[],c=0;c<i.length;c++)n[c]=[i[c].name,i[c].getId()];return n.push([s.Msg$$module$build$src$core$msg.RENAME_VARIABLE,bp]),s.Msg$$module$build$src$core$msg.DELETE_VARIABLE&&n.push([s.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",e),Ep]),n}};ai("field_variable",rl);var Dp=class extends vc{constructor(e,i,n,c,d,m){super(Ke.SKIP_SETUP),this.min_=-1/0,this.max_=1/0,this.precision_=0,this.decimalPlaces=null,this.spellcheck_=!1,e!==Ke.SKIP_SETUP&&(m?this.configure_(m):this.setConstraints(i,n,c),this.setValue(e),d&&this.setValidator(d))}configure_(e){super.configure_(e),this.setMinInternal(e.min),this.setMaxInternal(e.max),this.setPrecisionInternal(e.precision)}setConstraints(e,i,n){this.setMinInternal(e),this.setMaxInternal(i),this.setPrecisionInternal(n),this.setValue(this.getValue())}setMin(e){this.setMinInternal(e),this.setValue(this.getValue())}setMinInternal(e){e==null?this.min_=-1/0:(e=Number(e),isNaN(e)||(this.min_=e))}getMin(){return this.min_}setMax(e){this.setMaxInternal(e),this.setValue(this.getValue())}setMaxInternal(e){e==null?this.max_=1/0:(e=Number(e),isNaN(e)||(this.max_=e))}getMax(){return this.max_}setPrecision(e){this.setPrecisionInternal(e),this.setValue(this.getValue())}setPrecisionInternal(e){this.precision_=Number(e)||0;let i=String(this.precision_);i.includes("e")&&(i=this.precision_.toLocaleString("en-US",{maximumFractionDigits:20}));const n=i.indexOf(".");this.decimalPlaces=n===-1?e?0:null:i.length-n-1}getPrecision(){return this.precision_}doClassValidation_(e){return e===null||(e=`${e}`.replace(/O/gi,"0"),e=e.replace(/,/g,""),e=e.replace(/infinity/i,"Infinity"),e=Number(e||0),isNaN(e))?null:(e=Math.min(Math.max(e,this.min_),this.max_),this.precision_&&isFinite(e)&&(e=Math.round(e/this.precision_)*this.precision_),this.decimalPlaces!==null&&(e=Number(e.toFixed(this.decimalPlaces))),e)}widgetCreate_(){const e=super.widgetCreate_();return-1/0<this.min_&&(e.min=`${this.min_}`,xt(e,bt.VALUEMIN,this.min_)),1/0>this.max_&&(e.max=`${this.max_}`,xt(e,bt.VALUEMAX,this.max_)),e}static fromJson(e){return new this(e.value,void 0,void 0,void 0,void 0,e)}};ai("field_number",Dp),Dp.prototype.DEFAULT_VALUE=0;var wb=class extends Wr{constructor(e,i,n){super(String(e??""),i,n),this.EDITABLE=!1,this.SERIALIZABLE=!0}static fromJson(e){return new this(at(e.text),void 0,e)}};ai("field_label_serializable",wb);var Kr=class extends Ke{constructor(e,i,n){super(Ke.SKIP_SETUP),this.SERIALIZABLE=!0,this.CURSOR="default",this.value_=this.value_,this.checkChar=Kr.CHECK_CHAR,e!==Ke.SKIP_SETUP&&(n&&this.configure_(n),this.setValue(e),i&&this.setValidator(i))}configure_(e){super.configure_(e),e.checkCharacter&&(this.checkChar=e.checkCharacter)}saveState(){const e=this.saveLegacyState(Kr);return e!==null?e:this.getValueBoolean()}initView(){super.initView();const e=this.getTextElement();re(e,"blocklyCheckbox"),e.style.display=this.value_?"block":"none"}render_(){this.textContent_&&(this.textContent_.nodeValue=this.getDisplayText_()),this.updateSize_(this.getConstants().FIELD_CHECKBOX_X_OFFSET)}getDisplayText_(){return this.checkChar}setCheckCharacter(e){this.checkChar=e||Kr.CHECK_CHAR,this.forceRerender()}showEditor_(){this.setValue(!this.value_)}doClassValidation_(e){return e===!0||e==="TRUE"?"TRUE":e===!1||e==="FALSE"?"FALSE":null}doValueUpdate_(e){this.value_=this.convertValueToBool(e),this.textElement_&&(this.textElement_.style.display=this.value_?"block":"none")}getValue(){return this.value_?"TRUE":"FALSE"}getValueBoolean(){return this.value_}getText(){return String(this.convertValueToBool(this.value_))}convertValueToBool(e){return typeof e=="string"?e==="TRUE":!!e}static fromJson(e){return new this(e.checked,void 0,e)}};Kr.CHECK_CHAR="✓",ai("field_checkbox",Kr),Kr.prototype.DEFAULT_VALUE=!1;var Rb=class{constructor(e,i){this.draggable=e,this.workspace=i,this.dragTarget=null,this.startLoc=e.getRelativeToSurfaceXY()}onDragStart(e){this.draggable.startDrag(e)}onDrag(e,i){this.moveDraggable(e,i),i=this.getRoot(this.draggable),Rs(i)&&i.setDeleteStyle(this.wouldDeleteDraggable(e,i)),this.updateDragTarget(e)}updateDragTarget(e){e=this.workspace.getDragTarget(e);const i=this.getRoot(this.draggable);if(this.dragTarget!==e){let n;(n=this.dragTarget)==null||n.onDragExit(i),e==null||e.onDragEnter(i)}e==null||e.onDragOver(i),this.dragTarget=e}moveDraggable(e,i){i=this.pixelsToWorkspaceUnits(i),i=te.sum(this.startLoc,i),this.draggable.drag(i,e)}wouldDeleteDraggable(e,i){return(e=this.workspace.getDragTarget(e))&&this.workspace.getComponentManager().hasCapability(e.id,et.Capability.DELETE_AREA)?e.wouldDelete(i):!1}onDragEnd(e){const i=s.getGroup$$module$build$src$core$events$utils();var n=this.workspace.getDragTarget(e);const c=this.getRoot(this.draggable);if(n){let d;(d=this.dragTarget)==null||d.onDrop(c)}this.shouldReturnToStart(e,c)&&this.draggable.revertDrag(),(n=Rs(c)&&this.wouldDeleteDraggable(e,c))&&this.draggable instanceof Ps&&Ea(this.draggable.getRootBlock()),this.draggable.endDrag(e),n&&Rs(c)&&(e=s.getGroup$$module$build$src$core$events$utils(),s.setGroup$$module$build$src$core$events$utils(i),c.dispose(),s.setGroup$$module$build$src$core$events$utils(e))}getRoot(e){return e instanceof Ps?e.getRootBlock():e}shouldReturnToStart(e,i){return(e=this.workspace.getDragTarget(e))?e.shouldPreventMove(i):!1}pixelsToWorkspaceUnits(e){return e=new te(e.x/this.workspace.scale,e.y/this.workspace.scale),this.workspace.isMutator&&e.scale(1/this.workspace.options.parentWorkspace.scale),e}};r(Z.BLOCK_DRAGGER,hi,Rb);var nl={};nl.BlockDragStrategy=rb,nl.BubbleDragStrategy=UT,nl.CommentDragStrategy=LT,nl.Dragger=Rb;var Bp=class extends Hs{constructor(e,i,n){super(e?e.workspace.id:void 0),this.type=W.BLOCK_DRAG,e&&(this.blockId=e.id,this.isStart=i,this.blocks=n)}toJson(){const e=super.toJson();if(this.isStart===void 0)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(this.blockId===void 0)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");return e.isStart=this.isStart,e.blockId=this.blockId,e.blocks=this.blocks,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Bp),i.isStart=e.isStart,i.blockId=e.blockId,i.blocks=e.blocks,i}};r(Z.EVENT,W.BLOCK_DRAG,Bp);var Fp=class extends Dr{constructor(e,i,n,c){super(e),this.type=W.BLOCK_FIELD_INTERMEDIATE_CHANGE,this.recordUndo=!1,e&&(this.name=i,this.oldValue=n,this.newValue=c)}toJson(){const e=super.toJson();if(!this.name)throw Error("The changed field name is undefined. Either pass a name to the constructor, or call fromJson.");return e.name=this.name,e.oldValue=this.oldValue,e.newValue=this.newValue,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Fp),i.name=e.name,i.oldValue=e.oldValue,i.newValue=e.newValue,i}isNull(){return this.oldValue===this.newValue}run(e){var i=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");if(i=i.getBlockById(this.blockId),!i)throw Error("The associated block is undefined. Either pass a block to the constructor, or call fromJson");e=e?this.newValue:this.oldValue,(i=i.getField(this.name))?i.setValue(e):console.warn("Can't set non-existent field: "+this.name)}};r(Z.EVENT,W.BLOCK_FIELD_INTERMEDIATE_CHANGE,Fp);var Up=class extends Dr{constructor(e){super(e),this.type=W.BLOCK_MOVE,e&&(e.isShadow()&&(this.recordUndo=!1),e=this.currentLocation(),this.oldParentId=e.parentId,this.oldInputName=e.inputName,this.oldCoordinate=e.coordinate)}toJson(){const e=super.toJson();return e.oldParentId=this.oldParentId,e.oldInputName=this.oldInputName,this.oldCoordinate&&(e.oldCoordinate=`${Math.round(this.oldCoordinate.x)}, ${Math.round(this.oldCoordinate.y)}`),e.newParentId=this.newParentId,e.newInputName=this.newInputName,this.newCoordinate&&(e.newCoordinate=`${Math.round(this.newCoordinate.x)}, ${Math.round(this.newCoordinate.y)}`),this.reason&&(e.reason=this.reason),this.recordUndo||(e.recordUndo=this.recordUndo),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Up),i.oldParentId=e.oldParentId,i.oldInputName=e.oldInputName,e.oldCoordinate&&(n=e.oldCoordinate.split(","),i.oldCoordinate=new te(Number(n[0]),Number(n[1]))),i.newParentId=e.newParentId,i.newInputName=e.newInputName,e.newCoordinate&&(n=e.newCoordinate.split(","),i.newCoordinate=new te(Number(n[0]),Number(n[1]))),e.reason!==void 0&&(i.reason=e.reason),e.recordUndo!==void 0&&(i.recordUndo=e.recordUndo),i}recordNew(){const e=this.currentLocation();this.newParentId=e.parentId,this.newInputName=e.inputName,this.newCoordinate=e.coordinate}setReason(e){this.reason=e}currentLocation(){var e=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var i=e.getBlockById(this.blockId);if(!i)throw Error("The block associated with the block move event could not be found");e={};const n=i.getParent();return n?(e.parentId=n.id,(i=n.getInputWithBlock(i))&&(e.inputName=i.name)):e.coordinate=i.getRelativeToSurfaceXY(),e}isNull(){return this.oldParentId===this.newParentId&&this.oldInputName===this.newInputName&&te.equals(this.oldCoordinate,this.newCoordinate)}run(e){var i=this.getEventWorkspace_();if(!this.blockId)throw Error("The block ID is undefined. Either pass a block to the constructor, or call fromJson");var n=i.getBlockById(this.blockId);if(n){var c=e?this.newParentId:this.oldParentId,d=e?this.newInputName:this.oldInputName;if(e=e?this.newCoordinate:this.oldCoordinate,c){var m=i.getBlockById(c);if(!m){console.warn("Can't connect to non-existent block: "+c);return}}if(n.getParent()&&n.unplug(),e)d=n.getRelativeToSurfaceXY(),n.moveBy(e.x-d.x,e.y-d.y,this.reason);else{i=n.outputConnection,(!i||n.previousConnection&&n.previousConnection.isConnected())&&(i=n.previousConnection);let y,O;n=(O=i)==null?void 0:O.type,d?(n=m.getInput(d))&&(y=n.connection):n===le.PREVIOUS_STATEMENT&&(y=m.nextConnection),y&&i?i.connect(y):console.warn("Can't connect to non-existent input: "+d)}}else console.warn("Can't move non-existent block: "+this.blockId)}};r(Z.EVENT,W.BLOCK_MOVE,Up);var Gp=class extends Hs{constructor(e,i,n){super(e?e.workspace.id:void 0),this.type=W.BUBBLE_OPEN,e&&(this.blockId=e.id,this.isOpen=i,this.bubbleType=n)}toJson(){const e=super.toJson();if(this.isOpen===void 0)throw Error("Whether this event is for opening the bubble is undefined. Either pass the value to the constructor, or call fromJson");if(!this.bubbleType)throw Error("The type of bubble is undefined. Either pass the value to the constructor, or call fromJson");return e.isOpen=this.isOpen,e.bubbleType=this.bubbleType,e.blockId=this.blockId||"",e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Gp),i.isOpen=e.isOpen,i.bubbleType=e.bubbleType,i.blockId=e.blockId,i}},Hp;(function(e){e.MUTATOR="mutator",e.COMMENT="comment",e.WARNING="warning"})(Hp||(Hp={})),r(Z.EVENT,W.BUBBLE_OPEN,Gp);var mi=class extends Cn{constructor(e){super(),this.isBlank=!e,e&&(this.commentId=e.id,this.workspaceId=e.workspace.id,this.group=s.getGroup$$module$build$src$core$events$utils(),this.recordUndo=k())}toJson(){const e=super.toJson();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.commentId=this.commentId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new mi),i.commentId=e.commentId,i}static CommentCreateDeleteHelper(e,i){const n=e.getEventWorkspace_();if(i){if(!e.json)throw Error("Encountered a comment event without proper json");go(e.json,n)}else{if(!e.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(i=n.getCommentById(e.commentId))?i.dispose():console.warn("Can't delete non-existent comment: "+e.commentId)}}},Vp=class extends mi{constructor(e,i,n){super(e),this.type=W.COMMENT_CHANGE,e&&(this.oldContents_=typeof i>"u"?"":i,this.newContents_=typeof n>"u"?"":n)}toJson(){const e=super.toJson();if(!this.oldContents_)throw Error("The old contents is undefined. Either pass a value to the constructor, or call fromJson");if(!this.newContents_)throw Error("The new contents is undefined. Either pass a value to the constructor, or call fromJson");return e.oldContents=this.oldContents_,e.newContents=this.newContents_,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Vp),i.oldContents_=e.oldContents,i.newContents_=e.newContents,i}isNull(){return this.oldContents_===this.newContents_}run(e){var i=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(i=i.getCommentById(this.commentId)){var n=e?this.newContents_:this.oldContents_;if(n===void 0)throw Error(e?"The new contents is undefined. Either pass a value to the constructor, or call fromJson":"The old contents is undefined. Either pass a value to the constructor, or call fromJson");i.setText(n)}else console.warn("Can't change non-existent comment: "+this.commentId)}};r(Z.EVENT,W.COMMENT_CHANGE,Vp);var Wp=class extends mi{constructor(e,i){super(e),this.newCollapsed=i,this.type=W.COMMENT_COLLAPSE}toJson(){const e=super.toJson();if(this.newCollapsed===void 0)throw Error("The new collapse value undefined. Either call recordNew, or call fromJson");return e.newCollapsed=this.newCollapsed,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Wp),i.newCollapsed=e.newCollapsed,i}run(e){var i=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");(i=i.getCommentById(this.commentId))?i.setCollapsed(e?!!this.newCollapsed:!this.newCollapsed):console.warn("Can't collapse or uncollapse non-existent comment: "+this.commentId)}};r(Z.EVENT,W.COMMENT_COLLAPSE,Wp);var zp=class extends mi{constructor(e){super(e),this.type=W.COMMENT_CREATE,e&&(this.xml=xo(e),this.json=fn(e,{addCoordinates:!0}))}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=li(this.xml),e.json=this.json,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new zp),i.xml=s.textToDom$$module$build$src$core$utils$xml(e.xml),i.json=e.json,i}run(e){mi.CommentCreateDeleteHelper(this,e)}};r(Z.EVENT,W.COMMENT_CREATE,zp);var Xp=class extends mi{constructor(e){super(e),this.type=W.COMMENT_DELETE,e&&(this.xml=xo(e),this.json=fn(e,{addCoordinates:!0}))}run(e){mi.CommentCreateDeleteHelper(this,!e)}toJson(){const e=super.toJson();if(!this.xml)throw Error("The comment XML is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.json)throw Error("The comment JSON is undefined. Either pass a block to the constructor, or call fromJson");return e.xml=li(this.xml),e.json=this.json,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Xp),i.xml=s.textToDom$$module$build$src$core$utils$xml(e.xml),i.json=e.json,i}};r(Z.EVENT,W.COMMENT_DELETE,Xp);var Yp=class extends Hs{constructor(e,i){super(e?e.workspace.id:void 0),this.type=W.COMMENT_DRAG,e&&(this.commentId=e.id,this.isStart=i)}toJson(){const e=super.toJson();if(this.isStart===void 0)throw Error("Whether this event is the start of a drag is undefined. Either pass the value to the constructor, or call fromJson");if(this.commentId===void 0)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");return e.isStart=this.isStart,e.commentId=this.commentId,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Yp),i.isStart=e.isStart,i.commentId=e.commentId,i}};r(Z.EVENT,W.COMMENT_DRAG,Yp);var Kp=class extends mi{constructor(e){super(e),this.type=W.COMMENT_MOVE,e&&(this.comment_=e,this.oldCoordinate_=e.getRelativeToSurfaceXY())}recordNew(){if(this.newCoordinate_)throw Error("Tried to record the new position of a comment on the same event twice.");if(!this.comment_)throw Error("The comment is undefined. Pass a comment to the constructor if you want to use the record functionality");this.newCoordinate_=this.comment_.getRelativeToSurfaceXY()}setReason(e){this.reason=e}setOldCoordinate(e){this.oldCoordinate_=e}toJson(){const e=super.toJson();if(!this.oldCoordinate_)throw Error("The old comment position is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newCoordinate_)throw Error("The new comment position is undefined. Either call recordNew, or call fromJson");return e.oldCoordinate=`${Math.round(this.oldCoordinate_.x)}, ${Math.round(this.oldCoordinate_.y)}`,e.newCoordinate=Math.round(this.newCoordinate_.x)+","+Math.round(this.newCoordinate_.y),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new Kp),n=e.oldCoordinate.split(","),i.oldCoordinate_=new te(Number(n[0]),Number(n[1])),n=e.newCoordinate.split(","),i.newCoordinate_=new te(Number(n[0]),Number(n[1])),i}isNull(){return te.equals(this.oldCoordinate_,this.newCoordinate_)}run(e){var i=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(i=i.getCommentById(this.commentId)){if(e=e?this.newCoordinate_:this.oldCoordinate_,!e)throw Error("Either oldCoordinate_ or newCoordinate_ is undefined. Either pass a comment to the constructor and call recordNew, or call fromJson");i.moveTo(e)}else console.warn("Can't move non-existent comment: "+this.commentId)}};r(Z.EVENT,W.COMMENT_MOVE,Kp);var jp=class extends mi{constructor(e){super(e),this.type=W.COMMENT_RESIZE,e&&(this.oldSize=e.getSize())}recordCurrentSizeAsNewSize(){if(this.newSize)throw Error("Tried to record the new size of a comment on the same event twice.");var e=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(e=e.getCommentById(this.commentId),!e)throw Error("The comment associated with the comment resize event could not be found");this.newSize=e.getSize()}toJson(){const e=super.toJson();if(!this.oldSize)throw Error("The old comment size is undefined. Either pass a comment to the constructor, or call fromJson");if(!this.newSize)throw Error("The new comment size is undefined. Either call recordCurrentSizeAsNewSize, or call fromJson");return e.oldWidth=Math.round(this.oldSize.width),e.oldHeight=Math.round(this.oldSize.height),e.newWidth=Math.round(this.newSize.width),e.newHeight=Math.round(this.newSize.height),e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new jp),i.oldSize=new Oe(e.oldWidth,e.oldHeight),i.newSize=new Oe(e.newWidth,e.newHeight),i}isNull(){return Oe.equals(this.oldSize,this.newSize)}run(e){var i=this.getEventWorkspace_();if(!this.commentId)throw Error("The comment ID is undefined. Either pass a comment to the constructor, or call fromJson");if(i=i.getCommentById(this.commentId)){if(e=e?this.newSize:this.oldSize,!e)throw Error("Either oldSize or newSize is undefined. Either pass a comment to the constructor and call recordCurrentSizeAsNewSize, or call fromJson");i.setSize(e)}else console.warn("Can't resize non-existent comment: "+this.commentId)}};r(Z.EVENT,W.COMMENT_RESIZE,jp);var qp=class extends Hs{constructor(e,i,n){super(n),this.type=W.TOOLBOX_ITEM_SELECT,this.oldItem=e??void 0,this.newItem=i??void 0}toJson(){const e=super.toJson();return e.oldItem=this.oldItem,e.newItem=this.newItem,e}static fromJson(e,i,n){return i=super.fromJson(e,i,n??new qp),i.oldItem=e.oldItem,i.newItem=e.newItem,i}};r(Z.EVENT,W.TOOLBOX_ITEM_SELECT,qp);var kb=class extends Cn{constructor(e){super(),this.isBlank=!0,this.recordUndo=!1,this.type=W.FINISHED_LOADING,this.isBlank=!!e,e&&(this.workspaceId=e.id)}};r(Z.EVENT,W.FINISHED_LOADING,kb);var Ob,Ab,Mb,Lb,Pb,Nb,Db,Bb,Fb,Ub,Gb,Hb,Vb,Wb,zb,Xb,Yb,Kb,jb,qb,Jb,Zb,Qb,eE,tE,ne;s.BLOCK_CHANGE$$module$build$src$core$events$events=W.BLOCK_CHANGE,s.BLOCK_CREATE$$module$build$src$core$events$events=W.BLOCK_CREATE,s.BLOCK_DELETE$$module$build$src$core$events$events=W.BLOCK_DELETE,Ob=W.BLOCK_DRAG,s.BLOCK_MOVE$$module$build$src$core$events$events=W.BLOCK_MOVE,Ab=W.BLOCK_FIELD_INTERMEDIATE_CHANGE,Mb=W.BUBBLE_OPEN,Lb=W.BLOCK_CHANGE,Pb=W.CLICK,Nb=W.COMMENT_CHANGE,Db=W.COMMENT_CREATE,Bb=W.COMMENT_DELETE,Fb=W.COMMENT_MOVE,Ub=W.COMMENT_RESIZE,Gb=W.COMMENT_DRAG,Hb=W.BLOCK_CREATE,Vb=W.BLOCK_DELETE,Wb=W.FINISHED_LOADING,zb=W.MARKER_MOVE,Xb=W.BLOCK_MOVE,Yb=W.SELECTED,Kb=W.THEME_CHANGE,jb=W.TOOLBOX_ITEM_SELECT,qb=W.TRASHCAN_OPEN,Jb=W.UI,Zb=W.VAR_CREATE,Qb=W.VAR_DELETE,eE=W.VAR_RENAME,tE=W.VIEWPORT_CHANGE,ne={},ne.Abstract=Cn,ne.BLOCK_CHANGE=s.BLOCK_CHANGE$$module$build$src$core$events$events,ne.BLOCK_CREATE=s.BLOCK_CREATE$$module$build$src$core$events$events,ne.BLOCK_DELETE=s.BLOCK_DELETE$$module$build$src$core$events$events,ne.BLOCK_DRAG=Ob,ne.BLOCK_FIELD_INTERMEDIATE_CHANGE=Ab,ne.BLOCK_MOVE=s.BLOCK_MOVE$$module$build$src$core$events$events,ne.BUBBLE_OPEN=Mb,ne.BUMP_EVENTS=O$,ne.BlockBase=Dr,ne.BlockChange=Br,ne.BlockCreate=ip,ne.BlockDelete=mp,ne.BlockDrag=Bp,ne.BlockFieldIntermediateChange=Fp,ne.BlockMove=Up,ne.BubbleOpen=Gp,ne.BubbleType=Hp,ne.CHANGE=Lb,ne.CLICK=Pb,ne.COMMENT_CHANGE=Nb,ne.COMMENT_CREATE=Db,ne.COMMENT_DELETE=Bb,ne.COMMENT_DRAG=Gb,ne.COMMENT_MOVE=Fb,ne.COMMENT_RESIZE=Ub,ne.CREATE=Hb,ne.Click=yd,ne.ClickTarget=vd,ne.CommentBase=mi,ne.CommentChange=Vp,ne.CommentCollapse=Wp,ne.CommentCreate=zp,ne.CommentDelete=Xp,ne.CommentDrag=Yp,ne.CommentMove=Kp,ne.CommentResize=jp,ne.DELETE=Vb,ne.FINISHED_LOADING=Wb,ne.FinishedLoading=kb,ne.MARKER_MOVE=zb,ne.MOVE=Xb,ne.MarkerMove=_p,ne.SELECTED=Yb,ne.Selected=Ip,ne.THEME_CHANGE=Kb,ne.TOOLBOX_ITEM_SELECT=jb,ne.TRASHCAN_OPEN=qb,ne.ThemeChange=rp,ne.ToolboxItemSelect=qp,ne.TrashcanOpen=Cp,ne.UI=Jb,ne.UiBase=Hs,ne.VAR_CREATE=Zb,ne.VAR_DELETE=Qb,ne.VAR_RENAME=eE,ne.VIEWPORT_CHANGE=tE,ne.VarBase=Uo,ne.VarCreate=Vd,ne.VarDelete=yp,ne.VarRename=vp,ne.ViewportChange=np,ne.clearPendingUndo=ge,ne.disable=s.disable$$module$build$src$core$events$utils,ne.disableOrphans=Ne,ne.enable=s.enable$$module$build$src$core$events$utils,ne.filter=_e,ne.fire=z,ne.fromJson=be,ne.get=he,ne.getDescendantIds=pe,ne.getGroup=s.getGroup$$module$build$src$core$events$utils,ne.getRecordUndo=k,ne.isEnabled=ue,ne.setGroup=s.setGroup$$module$build$src$core$events$utils,ne.setRecordUndo=s.setRecordUndo$$module$build$src$core$events$utils;var Ks={};Ks.BottomRow=_b,Ks.ConstantProvider=gb,Ks.Drawer=mb,Ks.MarkerSvg=Eb,Ks.PathObject=yb,Ks.RenderInfo=bb,Ks.Renderer=Pp,Ks.RightConnectionShape=$b,Ks.StatementInput=Ic,Ks.TopRow=Tb,$d();var Et={};Et.registerCleanup=sd,Et.registerCollapse=rd,Et.registerCollapseExpandBlock=ud,Et.registerComment=cd,Et.registerCommentCreate=_d,Et.registerCommentDelete=gd,Et.registerCommentDuplicate=md,Et.registerCommentOptions=I$,Et.registerDefaultOptions=$d,Et.registerDelete=pd,Et.registerDeleteAll=ld,Et.registerDisable=dd,Et.registerDuplicate=ad,Et.registerExpand=nd,Et.registerHelp=fd,Et.registerInline=hd,Et.registerRedo=td,Et.registerUndo=ed;var Cc={};Cc.CommentView=NT,Cc.RenderedWorkspaceComment=nc,Cc.WorkspaceComment=rc;var ol={};ol.Bubble=Ge,ol.MiniWorkspaceBubble=Pi,ol.TextBubble=XT,ol.TextInputBubble=GT;var sE=class extends fc{constructor(){super(),this.FIELD_TEXT_BASELINE_CENTER=!1,this.DARK_PATH_OFFSET=1,this.MAX_BOTTOM_WIDTH=30,this.STATEMENT_BOTTOM_SPACER=-this.NOTCH_HEIGHT/2}getCSS_(e){return super.getCSS_(e).concat([`${e} .blocklyInsertionMarker>.blocklyPathLight,`,`${e} .blocklyInsertionMarker>.blocklyPathDark {`,`fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,"stroke: none;","}"])}},iE=class{constructor(e){this.inlineSteps_=this.steps_="",this.info_=e,this.RTL_=this.info_.RTL,e=e.getRenderer(),this.constants_=e.getConstants(),this.highlightConstants_=e.getHighlightConstants(),this.highlightOffset=this.highlightConstants_.OFFSET,this.outsideCornerPaths_=this.highlightConstants_.OUTSIDE_CORNER,this.insideCornerPaths_=this.highlightConstants_.INSIDE_CORNER,this.puzzleTabPaths_=this.highlightConstants_.PUZZLE_TAB,this.notchPaths_=this.highlightConstants_.NOTCH,this.startPaths_=this.highlightConstants_.START_HAT,this.jaggedTeethPaths_=this.highlightConstants_.JAGGED_TEETH}getPath(){return this.steps_+`
`+this.inlineSteps_}drawTopCorner(e){this.steps_+=Qe(e.xPos,this.info_.startY);for(let i=0,n;n=e.elements[i];i++)N.isLeftSquareCorner(n)?this.steps_+=this.highlightConstants_.START_POINT:N.isLeftRoundedCorner(n)?this.steps_+=this.outsideCornerPaths_.topLeft(this.RTL_):N.isPreviousConnection(n)?this.steps_+=this.notchPaths_.pathLeft:N.isHat(n)?this.steps_+=this.startPaths_.path(this.RTL_):N.isSpacer(n)&&n.width!==0&&(this.steps_+=ae("H",n.xPos+n.width-this.highlightOffset));this.steps_+=ae("H",e.xPos+e.width-this.highlightOffset)}drawJaggedEdge_(e){this.info_.RTL&&(this.steps_+=this.jaggedTeethPaths_.pathLeft+ae("v",e.height-this.jaggedTeethPaths_.height-this.highlightOffset))}drawValueInput(e){const i=e.getLastInput();if(this.RTL_){const n=e.height-i.connectionHeight;this.steps_+=Tt(i.xPos+i.width-this.highlightOffset,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)+ae("v",n)}else this.steps_+=Tt(i.xPos+i.width,e.yPos)+this.puzzleTabPaths_.pathDown(this.RTL_)}drawStatementInput(e){const i=e.getLastInput();if(i)if(this.RTL_){const n=e.height-2*this.insideCornerPaths_.height;this.steps_+=Tt(i.xPos,e.yPos)+this.insideCornerPaths_.pathTop(this.RTL_)+ae("v",n)+this.insideCornerPaths_.pathBottom(this.RTL_)+ci(e.width-i.xPos-this.insideCornerPaths_.width,0)}else this.steps_+=Tt(i.xPos,e.yPos+e.height)+this.insideCornerPaths_.pathBottom(this.RTL_)+ci(e.width-i.xPos-this.insideCornerPaths_.width,0)}drawRightSideRow(e){const i=e.xPos+e.width-this.highlightOffset;e instanceof fp&&e.followsStatement&&(this.steps_+=ae("H",i)),this.RTL_&&(this.steps_+=ae("H",i),e.height>this.highlightOffset&&(this.steps_+=ae("V",e.yPos+e.height-this.highlightOffset)))}drawBottomRow(e){if(this.RTL_)this.steps_+=ae("V",e.baseline-this.highlightOffset);else{const i=this.info_.bottomRow.elements[0];N.isLeftSquareCorner(i)?this.steps_+=Tt(e.xPos+this.highlightOffset,e.baseline-this.highlightOffset):N.isLeftRoundedCorner(i)&&(this.steps_+=Tt(e.xPos,e.baseline),this.steps_+=this.outsideCornerPaths_.bottomLeft())}}drawLeft(){var e=this.info_.outputConnection;e&&(e=e.connectionOffsetY+e.height,this.RTL_?this.steps_+=Tt(this.info_.startX,e):(this.steps_+=Tt(this.info_.startX+this.highlightOffset,this.info_.bottomRow.baseline-this.highlightOffset),this.steps_+=ae("V",e)),this.steps_+=this.puzzleTabPaths_.pathUp(this.RTL_)),this.RTL_||(e=this.info_.topRow,N.isLeftRoundedCorner(e.elements[0])?this.steps_+=ae("V",this.outsideCornerPaths_.height):this.steps_+=ae("V",e.capline+this.highlightOffset))}drawInlineInput(e){const i=this.highlightOffset,n=e.xPos+e.connectionWidth;var c=e.centerline-e.height/2;const d=e.width-e.connectionWidth,m=c+i;this.RTL_?(c=e.connectionOffsetY-i,e=e.height-(e.connectionOffsetY+e.connectionHeight)+i,this.inlineSteps_+=Tt(n-i,m)+ae("v",c)+this.puzzleTabPaths_.pathDown(this.RTL_)+ae("v",e)+ae("h",d)):this.inlineSteps_+=Tt(e.xPos+e.width+i,m)+ae("v",e.height)+ae("h",-d)+Tt(n,c+e.connectionOffsetY)+this.puzzleTabPaths_.pathDown(this.RTL_)}},rE=class extends gc{constructor(e,i){super(e,i),this.highlighter_=new iE(i)}draw(){this.drawOutline_(),this.drawInternals_(),this.updateConnectionHighlights();const e=this.block_.pathObject;e.setPath(this.outlinePath_+`
`+this.inlinePath_),e.setHighlightPath(this.highlighter_.getPath()),this.info_.RTL&&e.flipRTL(),this.recordSizeOnBlock_()}drawTop_(){this.highlighter_.drawTopCorner(this.info_.topRow),this.highlighter_.drawRightSideRow(this.info_.topRow),super.drawTop_()}drawJaggedEdge_(e){this.highlighter_.drawJaggedEdge_(e),super.drawJaggedEdge_(e)}drawValueInput_(e){this.highlighter_.drawValueInput(e),super.drawValueInput_(e)}drawStatementInput_(e){this.highlighter_.drawStatementInput(e),super.drawStatementInput_(e)}drawRightSideRow_(e){this.highlighter_.drawRightSideRow(e),this.outlinePath_+=ae("H",e.xPos+e.width)+ae("V",e.yPos+e.height)}drawBottom_(){this.highlighter_.drawBottomRow(this.info_.bottomRow),super.drawBottom_()}drawLeft_(){this.highlighter_.drawLeft(),super.drawLeft_()}drawInlineInput_(e){this.highlighter_.drawInlineInput(e),super.drawInlineInput_(e)}positionInlineInputConnection_(e){const i=e.centerline-e.height/2;if(e.connectionModel){let n=e.xPos+e.connectionWidth+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(n*=-1),e.connectionModel.setOffsetInBlock(n,i+e.connectionOffsetY+this.constants_.DARK_PATH_OFFSET)}}positionStatementInputConnection_(e){const i=e.getLastInput();if(i!=null&&i.connectionModel){let n=e.xPos+e.statementEdge+i.notchOffset;n=this.info_.RTL?-1*n:n+this.constants_.DARK_PATH_OFFSET,i.connectionModel.setOffsetInBlock(n,e.yPos+this.constants_.DARK_PATH_OFFSET)}}positionExternalValueConnection_(e){const i=e.getLastInput();if(i&&i.connectionModel){let n=e.xPos+e.width+this.constants_.DARK_PATH_OFFSET;this.info_.RTL&&(n*=-1),i.connectionModel.setOffsetInBlock(n,e.yPos)}}positionNextConnection_(){const e=this.info_.bottomRow;if(e.connection){const i=e.connection,n=i.xPos;i.connectionModel.setOffsetInBlock((this.info_.RTL?-n:n)+this.constants_.DARK_PATH_OFFSET/2,e.baseline+this.constants_.DARK_PATH_OFFSET)}}},nE=class{constructor(e){this.OFFSET=.5,this.constantProvider=e,this.START_POINT=Qe(this.OFFSET,this.OFFSET)}init(){this.INSIDE_CORNER=this.makeInsideCorner(),this.OUTSIDE_CORNER=this.makeOutsideCorner(),this.PUZZLE_TAB=this.makePuzzleTab(),this.NOTCH=this.makeNotch(),this.JAGGED_TEETH=this.makeJaggedTeeth(),this.START_HAT=this.makeStartHat()}makeInsideCorner(){const e=this.constantProvider.CORNER_RADIUS,i=this.OFFSET,n=(1-Math.SQRT1_2)*(e+i)-i,c=Qe(n,n)+ct("a","0 0,0",e,de(-n-i,e-n)),d=ct("a","0 0,0",e+i,de(e+i,e+i)),m=Qe(n,-n)+ct("a","0 0,0",e+i,de(e-n,n+i));return{width:e+i,height:e,pathTop(y){return y?c:""},pathBottom(y){return y?d:m}}}makeOutsideCorner(){const e=this.constantProvider.CORNER_RADIUS,i=this.OFFSET,n=(1-Math.SQRT1_2)*(e-i)+i,c=Qe(n,n)+ct("a","0 0,1",e-i,de(e-n,-n+i)),d=Qe(i,e)+ct("a","0 0,1",e-i,de(e,-e+i)),m=-n,y=Qe(n,m)+ct("a","0 0,1",e-i,de(-n+i,-m-e));return{height:e,topLeft(O){return O?c:d},bottomLeft(){return y}}}makePuzzleTab(){const e=this.constantProvider.TAB_WIDTH,i=this.constantProvider.TAB_HEIGHT,n=Qe(-2,-i+3.4)+ci(-.45*e,-2.1),c=ae("v",2.5)+Qe(.97*-e,2.5)+as("q",[de(.05*-e,10),de(.3*e,9.5)])+Qe(.67*e,-1.9)+ae("v",2.5),d=ae("v",-1.5)+Qe(-.92*e,-.5)+as("q",[de(-.19*e,-5.5),de(0,-11)])+Qe(.92*e,1),m=Qe(-5,i-.7)+ci(.46*e,-2.1);return{width:e,height:i,pathUp(y){return y?n:d},pathDown(y){return y?c:m}}}makeNotch(){return{pathLeft:ae("h",this.OFFSET)+this.constantProvider.NOTCH.pathLeft}}makeJaggedTeeth(){return{pathLeft:ci(5.1,2.6)+Qe(-10.2,6.8)+ci(5.1,2.6),height:12,width:10.2}}makeStartHat(){const e=this.constantProvider.START_HAT.height,i=Qe(25,-8.7)+as("c",[de(29.7,-6.2),de(57.2,-.5),de(75,8.7)]),n=as("c",[de(17.8,-9.2),de(45.3,-14.9),de(75,-8.7)])+Tt(100.5,e+.5);return{path(c){return c?i:n}}}},oE=class extends dp{constructor(e,i){super(e,i),this.constants_=e,this.connectedBlock&&(this.width+=this.constants_.DARK_PATH_OFFSET,this.height+=this.constants_.DARK_PATH_OFFSET)}},lE=class extends Jo{constructor(e,i){super(e,i),this.constants_=e,this.connectedBlock&&(this.height+=this.constants_.DARK_PATH_OFFSET)}},aE=class extends el{constructor(e,i){super(e,i),this.renderer_=e}getRenderer(){return this.renderer_}populateBottomRow_(){super.populateBottomRow_(),this.block_.inputList.length&&this.block_.inputList[this.block_.inputList.length-1]instanceof bs||(this.bottomRow.minHeight=this.constants_.MEDIUM_PADDING-this.constants_.DARK_PATH_OFFSET)}addInput_(e,i){this.isInline&&e instanceof s.ValueInput$$module$build$src$core$inputs$value_input?(i.elements.push(new oE(this.constants_,e)),i.hasInlineInput=!0):e instanceof bs?(i.elements.push(new lE(this.constants_,e)),i.hasStatement=!0):e instanceof s.ValueInput$$module$build$src$core$inputs$value_input?(i.elements.push(new pc(this.constants_,e)),i.hasExternalInput=!0):(e instanceof pi||e instanceof Ui)&&(i.minHeight=Math.max(i.minHeight,this.constants_.DUMMY_INPUT_MIN_HEIGHT),i.hasDummyInput=!0),this.isInline||i.align!==null||(i.align=e.align)}addElemSpacing_(){let e=!1;for(let n=0,c;c=this.rows[n];n++)c.hasExternalInput&&(e=!0);for(let n=0,c;c=this.rows[n];n++){var i=c.elements;if(c.elements=[],c.startsWithElemSpacer()&&c.elements.push(new Ts(this.constants_,this.getInRowSpacing_(null,i[0]))),i.length){for(let d=0;d<i.length-1;d++){c.elements.push(i[d]);const m=this.getInRowSpacing_(i[d],i[d+1]);c.elements.push(new Ts(this.constants_,m))}c.elements.push(i[i.length-1]),c.endsWithElemSpacer()&&(i=this.getInRowSpacing_(i[i.length-1],null),e&&c.hasDummyInput&&(i+=this.constants_.TAB_WIDTH),c.elements.push(new Ts(this.constants_,i)))}}}getInRowSpacing_(e,i){if(!e)return i&&N.isField(i)&&i.isEditable?this.constants_.MEDIUM_PADDING:i&&N.isInlineInput(i)?this.constants_.MEDIUM_LARGE_PADDING:i&&N.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!N.isInput(e)&&(!i||N.isStatementInput(i)))return N.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:N.isIcon(e)?2*this.constants_.LARGE_PADDING+1:N.isHat(e)?this.constants_.NO_PADDING:N.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:N.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:N.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(N.isInput(e)&&!i){if(N.isExternalInput(e))return this.constants_.NO_PADDING;if(N.isInlineInput(e))return this.constants_.LARGE_PADDING;if(N.isStatementInput(e))return this.constants_.NO_PADDING}if(!N.isInput(e)&&i&&N.isInput(i)){if(N.isField(e)&&e.isEditable){if(N.isInlineInput(i)||N.isExternalInput(i))return this.constants_.SMALL_PADDING}else{if(N.isInlineInput(i)||N.isExternalInput(i))return this.constants_.MEDIUM_LARGE_PADDING;if(N.isStatementInput(i))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(N.isIcon(e)&&i&&!N.isInput(i))return this.constants_.LARGE_PADDING;if(N.isInlineInput(e)&&i&&N.isField(i))return i.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(N.isLeftSquareCorner(e)&&i){if(N.isHat(i))return this.constants_.NO_PADDING;if(N.isPreviousConnection(i))return i.notchOffset;if(N.isNextConnection(i))return i.notchOffset+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}if(N.isLeftRoundedCorner(e)&&i){if(N.isPreviousConnection(i))return i.notchOffset-this.constants_.CORNER_RADIUS;if(N.isNextConnection(i))return i.notchOffset-this.constants_.CORNER_RADIUS+(this.RTL?1:-1)*this.constants_.DARK_PATH_OFFSET/2}return N.isField(e)&&i&&N.isField(i)&&e.isEditable===i.isEditable||i&&N.isJaggedEdge(i)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,i){return N.isTopRow(e)&&N.isBottomRow(i)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:N.isTopRow(e)||N.isBottomRow(i)?this.constants_.NO_PADDING:e.hasExternalInput&&i.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&i.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&i.hasStatement||!e.hasStatement&&i.hasDummyInput||e.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,i){if(N.isSpacer(i))return e.yPos+i.height/2;if(N.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,N.isNextConnection(i)?e+i.height/2:e-i.height/2;if(N.isTopRow(e))return N.isHat(i)?e.capline-i.height/2:e.capline+i.height/2;let n=e.yPos;return N.isField(i)||N.isIcon(i)?(n+=i.height/2,(e.hasInlineInput||e.hasStatement)&&i.height+this.constants_.TALL_INPUT_FIELD_OFFSET_Y<=e.height&&(n+=this.constants_.TALL_INPUT_FIELD_OFFSET_Y)):n=N.isInlineInput(i)?n+i.height/2:n+e.height/2,n}alignRowElements_(){if(this.isInline){var e=0,i=new WeakMap,n=null;for(let c=this.rows.length-1,d;d=this.rows[c];c--)i.set(d,e),N.isInputRow(d)&&(d.hasStatement&&this.alignStatementRow_(d),n&&n.hasStatement&&d.width<n.width?i.set(d,n.width):e=d.hasStatement?d.width:Math.max(e,d.width),n=d);e=0;for(let c=0,d;d=this.rows[c];c++)d.hasStatement?e=this.getDesiredRowWidth_(d):N.isSpacer(d)?d.width=Math.max(e,i.get(d)):(n=d.width,e=Math.max(e,i.get(d))-n,0<e&&this.addAlignmentPadding_(d,e),e=d.width)}else super.alignRowElements_()}getDesiredRowWidth_(e){return this.isInline&&e.hasStatement?this.statementEdge+this.constants_.MAX_BOTTOM_WIDTH+this.startX:super.getDesiredRowWidth_(e)}finalize_(){let e=0,i=0;for(let c=0,d;d=this.rows[c];c++){d.yPos=i,d.xPos=this.startX,i+=d.height,e=Math.max(e,d.widthWithConnectedBlocks);var n=i-this.topRow.ascenderHeight;d===this.bottomRow&&n<this.constants_.MIN_BLOCK_HEIGHT&&(n=this.constants_.MIN_BLOCK_HEIGHT-n,this.bottomRow.height+=n,i+=n),this.recordElemPositions_(d)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(n=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,n.getHeightWidth().width-this.constants_.DARK_PATH_OFFSET)),this.bottomRow.baseline=i-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX+this.constants_.DARK_PATH_OFFSET,this.width+=this.constants_.DARK_PATH_OFFSET,this.height=i+this.constants_.DARK_PATH_OFFSET,this.startY=this.topRow.capline}},cE=class extends mc{constructor(e,i,n){super(e,i,n),this.constants=n,this.colourDark="#000000",this.svgPathDark=Y(U.PATH,{class:"blocklyPathDark",transform:"translate(1,1)"}),this.svgRoot.insertBefore(this.svgPathDark,this.svgPath),this.svgPathLight=Y(U.PATH,{class:"blocklyPathLight"},this.svgRoot)}setPath(e){this.svgPath.setAttribute("d",e),this.svgPathDark.setAttribute("d",e)}setHighlightPath(e){this.svgPathLight.setAttribute("d",e)}flipRTL(){this.svgPath.setAttribute("transform","scale(-1 1)"),this.svgPathLight.setAttribute("transform","scale(-1 1)"),this.svgPathDark.setAttribute("transform","translate(1,1) scale(-1 1)")}applyColour(e){if(this.svgPathLight.style.display="",this.svgPathDark.style.display="",!this.style.colourTertiary)throw Error("The renderer did not properly initialize the tertiary colour of the block style");this.svgPathLight.setAttribute("stroke",this.style.colourTertiary),this.svgPathDark.setAttribute("fill",this.colourDark),super.applyColour(e),this.svgPath.setAttribute("stroke","none")}setStyle(e){this.style=e,this.colourDark=Ir("#000",this.style.colourPrimary,.2)||this.colourDark}updateHighlighted(e){e?(this.svgPath.setAttribute("filter","url(#"+this.constants.embossFilterId+")"),this.svgPathLight.style.display="none"):(this.svgPath.setAttribute("filter","none"),this.svgPathLight.style.display="inline")}updateShadow_(e){if(e){if(this.svgPathLight.style.display="none",!this.style.colourSecondary)throw Error("The renderer did not properly initialize the secondary colour of the block style block style");this.svgPathDark.setAttribute("fill",this.style.colourSecondary),this.svgPath.setAttribute("stroke","none"),this.svgPath.setAttribute("fill",this.style.colourSecondary)}}updateDisabled_(e){super.updateDisabled_(e),e&&this.svgPath.setAttribute("stroke","none")}},hE=class extends _c{constructor(e){super(e),this.highlightConstants=null}init(e,i){super.init(e,i),this.highlightConstants=this.makeHighlightConstants_(),this.highlightConstants.init()}refreshDom(e,i){super.refreshDom(e,i),this.getHighlightConstants().init()}makeConstants_(){return new sE}makeRenderInfo_(e){return new aE(this,e)}makeDrawer_(e,i){return new rE(e,i)}makePathObject(e,i){return new cE(e,i,this.getConstants())}makeHighlightConstants_(){return new nE(this.getConstants())}getHighlightConstants(){if(!this.highlightConstants)throw Error("Cannot access the highlight constants because init has not been called");return this.highlightConstants}};Ro("geras",hE);var _i={};_i.ConstantProvider=sE,_i.Drawer=rE,_i.HighlightConstantProvider=nE,_i.Highlighter=iE,_i.InlineInput=oE,_i.PathObject=cE,_i.RenderInfo=aE,_i.Renderer=hE,_i.StatementInput=lE;var uE=class extends el{constructor(e,i){super(e,i)}getRenderer(){return this.renderer_}addElemSpacing_(){let e=!1;for(var i=0;i<this.rows.length;i++)if(this.rows[i].hasExternalInput){e=!0;break}for(i=0;i<this.rows.length;i++){const c=this.rows[i];var n=c.elements;if(c.elements=[],c.startsWithElemSpacer()&&c.elements.push(new Ts(this.constants_,this.getInRowSpacing_(null,n[0]))),n.length){for(let d=0;d<n.length-1;d++){c.elements.push(n[d]);const m=this.getInRowSpacing_(n[d],n[d+1]);c.elements.push(new Ts(this.constants_,m))}c.elements.push(n[n.length-1]),c.endsWithElemSpacer()&&(n=this.getInRowSpacing_(n[n.length-1],null),e&&c.hasDummyInput&&(n+=this.constants_.TAB_WIDTH),c.elements.push(new Ts(this.constants_,n)))}}}getInRowSpacing_(e,i){if(!e)return i&&N.isField(i)&&i.isEditable?this.constants_.MEDIUM_PADDING:i&&N.isInlineInput(i)?this.constants_.MEDIUM_LARGE_PADDING:i&&N.isStatementInput(i)?this.constants_.STATEMENT_INPUT_PADDING_LEFT:this.constants_.LARGE_PADDING;if(!N.isInput(e)&&!i)return N.isField(e)&&e.isEditable?this.constants_.MEDIUM_PADDING:N.isIcon(e)?2*this.constants_.LARGE_PADDING+1:N.isHat(e)?this.constants_.NO_PADDING:N.isPreviousOrNextConnection(e)?this.constants_.LARGE_PADDING:N.isLeftRoundedCorner(e)?this.constants_.MIN_BLOCK_WIDTH:N.isJaggedEdge(e)?this.constants_.NO_PADDING:this.constants_.LARGE_PADDING;if(N.isInput(e)&&!i){if(N.isExternalInput(e))return this.constants_.NO_PADDING;if(N.isInlineInput(e))return this.constants_.LARGE_PADDING;if(N.isStatementInput(e))return this.constants_.NO_PADDING}if(!N.isInput(e)&&i&&N.isInput(i)){if(N.isField(e)&&e.isEditable){if(N.isInlineInput(i)||N.isExternalInput(i))return this.constants_.SMALL_PADDING}else{if(N.isInlineInput(i)||N.isExternalInput(i))return this.constants_.MEDIUM_LARGE_PADDING;if(N.isStatementInput(i))return this.constants_.LARGE_PADDING}return this.constants_.LARGE_PADDING-1}if(N.isIcon(e)&&i&&!N.isInput(i))return this.constants_.LARGE_PADDING;if(N.isInlineInput(e)&&i&&N.isField(i))return i.isEditable?this.constants_.MEDIUM_PADDING:this.constants_.LARGE_PADDING;if(N.isLeftSquareCorner(e)&&i){if(N.isHat(i))return this.constants_.NO_PADDING;if(N.isPreviousConnection(i)||N.isNextConnection(i))return i.notchOffset}return N.isLeftRoundedCorner(e)&&i?i.notchOffset-this.constants_.CORNER_RADIUS:N.isField(e)&&i&&N.isField(i)&&e.isEditable===i.isEditable||i&&N.isJaggedEdge(i)?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getSpacerRowHeight_(e,i){return N.isTopRow(e)&&N.isBottomRow(i)?this.constants_.EMPTY_BLOCK_SPACER_HEIGHT:N.isTopRow(e)||N.isBottomRow(i)?this.constants_.NO_PADDING:e.hasExternalInput&&i.hasExternalInput?this.constants_.LARGE_PADDING:!e.hasStatement&&i.hasStatement?this.constants_.BETWEEN_STATEMENT_PADDING_Y:e.hasStatement&&i.hasStatement||e.hasDummyInput||i.hasDummyInput?this.constants_.LARGE_PADDING:this.constants_.MEDIUM_PADDING}getElemCenterline_(e,i){if(N.isSpacer(i))return e.yPos+i.height/2;if(N.isBottomRow(e))return e=e.yPos+e.height-e.descenderHeight,N.isNextConnection(i)?e+i.height/2:e-i.height/2;if(N.isTopRow(e))return N.isHat(i)?e.capline-i.height/2:e.capline+i.height/2;let n=e.yPos;return n=N.isField(i)&&e.hasStatement?n+(this.constants_.TALL_INPUT_FIELD_OFFSET_Y+i.height/2):n+e.height/2}finalize_(){let e=0,i=0;for(var n=0;n<this.rows.length;n++){const d=this.rows[n];d.yPos=i,d.xPos=this.startX,i+=d.height,e=Math.max(e,d.widthWithConnectedBlocks);var c=i-this.topRow.ascenderHeight;d===this.bottomRow&&c<this.constants_.MIN_BLOCK_HEIGHT&&(c=this.constants_.MIN_BLOCK_HEIGHT-c,this.bottomRow.height+=c,i+=c),this.recordElemPositions_(d)}this.outputConnection&&this.block_.nextConnection&&this.block_.nextConnection.isConnected()&&(n=this.block_.nextConnection.targetBlock())&&(e=Math.max(e,n.getHeightWidth().width)),this.bottomRow.baseline=i-this.bottomRow.descenderHeight,this.widthWithChildren=e+this.startX,this.height=i,this.startY=this.topRow.capline}},dE=class extends _c{constructor(e){super(e)}makeRenderInfo_(e){return new uE(this,e)}};Ro("thrasos",dE);var Jp={};Jp.RenderInfo=uE,Jp.Renderer=dE;var xC={colour_blocks:{colourPrimary:"#CF63CF",colourSecondary:"#C94FC9",colourTertiary:"#BD42BD"},list_blocks:{colourPrimary:"#9966FF",colourSecondary:"#855CD6",colourTertiary:"#774DCB"},logic_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC"},loop_blocks:{colourPrimary:"#0fBD8C",colourSecondary:"#0DA57A",colourTertiary:"#0B8E69"},math_blocks:{colourPrimary:"#59C059",colourSecondary:"#46B946",colourTertiary:"#389438"},procedure_blocks:{colourPrimary:"#FF6680",colourSecondary:"#FF4D6A",colourTertiary:"#FF3355"},text_blocks:{colourPrimary:"#FFBF00",colourSecondary:"#E6AC00",colourTertiary:"#CC9900"},variable_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},variable_dynamic_blocks:{colourPrimary:"#FF8C1A",colourSecondary:"#FF8000",colourTertiary:"#DB6E00"},hat_blocks:{colourPrimary:"#4C97FF",colourSecondary:"#4280D7",colourTertiary:"#3373CC",hat:"cap"}},CC={colour_category:{colour:"#CF63CF"},list_category:{colour:"#9966FF"},logic_category:{colour:"#4C97FF"},loop_category:{colour:"#0fBD8C"},math_category:{colour:"#59C059"},procedure_category:{colour:"#FF6680"},text_category:{colour:"#FFBF00"},variable_category:{colour:"#FF8C1A"},variable_dynamic_category:{colour:"#FF8C1A"}},wC=new Vr("zelos",xC,CC),RC={Classic:lc,Zelos:wC},Zp=class{constructor(e,i,n){this.id_=e.toolboxitemid||E(),this.level_=(this.parent_=n||null)?this.parent_.getLevel()+1:0,this.toolboxItemDef_=e,this.parentToolbox_=i,this.workspace_=this.parentToolbox_.getWorkspace()}init(){}getDiv(){return null}getClickTarget(){return null}getId(){return this.id_}getParent(){return null}getLevel(){return this.level_}isSelectable(){return!1}isCollapsible(){return!1}dispose(){}setVisible_(e){}},js=class extends Zp{constructor(e,i,n){super(e,i,n),this.colour_=this.name_="",this.labelDom_=this.iconDom_=this.rowContents_=this.rowDiv_=this.htmlDiv_=null,this.isDisabled_=this.isHidden_=!1,this.flyoutItems_=[],this.cssConfig_=this.makeDefaultCssConfig_()}init(){this.parseCategoryDef_(this.toolboxItemDef_),this.parseContents_(this.toolboxItemDef_),this.createDom_(),this.toolboxItemDef_.hidden==="true"&&this.hide()}makeDefaultCssConfig_(){return{container:"blocklyToolboxCategory",row:"blocklyTreeRow",rowcontentcontainer:"blocklyTreeRowContentContainer",icon:"blocklyTreeIcon",label:"blocklyTreeLabel",contents:"blocklyToolboxContents",selected:"blocklyTreeSelected",openicon:"blocklyTreeIconOpen",closedicon:"blocklyTreeIconClosed"}}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else if(e=e.contents)for(let i=0;i<e.length;i++){const n=e[i];Array.isArray(this.flyoutItems_)&&this.flyoutItems_.push(n)}}parseCategoryDef_(e){this.name_="name"in e?at(e.name):"",this.colour_=this.getColour_(e),Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}createDom_(){this.htmlDiv_=this.createContainer_(),Zi(this.htmlDiv_,Ws.TREEITEM),xt(this.htmlDiv_,bt.SELECTED,!1),xt(this.htmlDiv_,bt.LEVEL,this.level_+1),this.rowDiv_=this.createRowContainer_(),this.rowDiv_.style.pointerEvents="auto",this.htmlDiv_.appendChild(this.rowDiv_),this.rowContents_=this.createRowContentsContainer_(),this.rowContents_.style.pointerEvents="none",this.rowDiv_.appendChild(this.rowContents_),this.iconDom_=this.createIconDom_(),Zi(this.iconDom_,Ws.PRESENTATION),this.rowContents_.appendChild(this.iconDom_),this.labelDom_=this.createLabelDom_(this.name_),this.rowContents_.appendChild(this.labelDom_);const e=this.labelDom_.getAttribute("id");return e&&xt(this.htmlDiv_,bt.LABELLEDBY,e),this.addColourBorder_(this.colour_),this.htmlDiv_}createContainer_(){const e=document.createElement("div"),i=this.cssConfig_.container;return i&&re(e,i),e}createRowContainer_(){const e=document.createElement("div");var i=this.cssConfig_.row;return i&&re(e,i),i=`${js.nestedPadding*this.getLevel()}px`,this.workspace_.RTL?e.style.paddingRight=i:e.style.paddingLeft=i,e}createRowContentsContainer_(){const e=document.createElement("div"),i=this.cssConfig_.rowcontentcontainer;return i&&re(e,i),e}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const i=this.cssConfig_.icon;i&&re(e,i)}return e.style.display="inline-block",e}createLabelDom_(e){const i=document.createElement("span");return i.setAttribute("id",this.getId()+".label"),i.textContent=e,(e=this.cssConfig_.label)&&re(i,e),i}refreshTheme(){this.colour_=this.getColour_(this.toolboxItemDef_),this.addColourBorder_(this.colour_)}addColourBorder_(e){e&&(e=js.borderWidth+"px solid "+(e||"#ddd"),this.workspace_.RTL?this.rowDiv_.style.borderRight=e:this.rowDiv_.style.borderLeft=e)}getColour_(e){const i=e.categorystyle||e.categoryStyle;if((e=e.colour)&&i)console.warn('Toolbox category "'+this.name_+'" must not have both a style and a colour');else{if(i)return this.getColourfromStyle(i);if(e)return this.parseColour(e)}return""}getColourfromStyle(e){var i=this.workspace_.getTheme();if(e&&i){if((i=i.categoryStyles[e])&&i.colour)return this.parseColour(i.colour);console.warn('Style "'+e+'" must exist and contain a colour value')}return""}getClickTarget(){return this.rowDiv_}parseColour(e){if(e=at(e),e==null||e==="")return"";var i=Number(e);return isNaN(i)?(i=Sr(e))?i:(console.warn('Toolbox category "'+this.name_+'" has unrecognized colour attribute: '+e),""):au(i)}openIcon_(e){if(e){var i=this.cssConfig_.closedicon;i&&T(e,i),(i=this.cssConfig_.openicon)&&re(e,i)}}closeIcon_(e){if(e){var i=this.cssConfig_.openicon;i&&T(e,i),(i=this.cssConfig_.closedicon)&&re(e,i)}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none",this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}hide(){this.setVisible_(!1)}show(){this.setVisible_(!0)}isVisible(){return!this.isHidden_&&this.allAncestorsExpanded_()}allAncestorsExpanded_(){let e=this;for(;e.getParent();)if(e=e.getParent(),!e.isExpanded())return!1;return!0}isSelectable(){return this.isVisible()&&!this.isDisabled_}onClick(e){}setSelected(e){if(this.rowDiv_){var i=this.cssConfig_.selected;if(e){const n=this.parseColour(js.defaultBackgroundColour);this.rowDiv_.style.backgroundColor=this.colour_||n,i&&re(this.rowDiv_,i)}else this.rowDiv_.style.backgroundColor="",i&&S(this.rowDiv_,i);xt(this.htmlDiv_,bt.SELECTED,e)}}setDisabled(e){this.isDisabled_=e,this.getDiv().setAttribute("disabled",`${e}`),e?this.getDiv().setAttribute("disabled","true"):this.getDiv().removeAttribute("disabled")}getName(){return this.name_}getParent(){return this.parent_}getDiv(){return this.htmlDiv_}getContents(){return this.flyoutItems_}updateFlyoutContents(e){this.flyoutItems_=[],this.toolboxItemDef_=typeof e=="string"?{kind:this.toolboxItemDef_.kind,custom:e,id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden}:{kind:this.toolboxItemDef_.kind,name:"name"in this.toolboxItemDef_?this.toolboxItemDef_.name:"",contents:po(e),id:this.toolboxItemDef_.id,categorystyle:this.toolboxItemDef_.categorystyle,colour:this.toolboxItemDef_.colour,cssconfig:this.toolboxItemDef_.cssconfig,hidden:this.toolboxItemDef_.hidden},this.parseContents_(this.toolboxItemDef_)}dispose(){F(this.htmlDiv_)}};js.registrationName="category",js.nestedPadding=19,js.borderWidth=8,js.defaultBackgroundColour="#57e",tt(`
.blocklyTreeRow:not(.blocklyTreeSelected):hover {
  background-color: rgba(255, 255, 255, .2);
}

.blocklyToolboxDiv[layout="h"] .blocklyToolboxCategory {
  margin: 1px 5px 1px 0;
}

.blocklyToolboxDiv[dir="RTL"][layout="h"] .blocklyToolboxCategory {
  margin: 1px 0 1px 5px;
}

.blocklyTreeRow {
  height: 22px;
  line-height: 22px;
  margin-bottom: 3px;
  padding-right: 8px;
  white-space: nowrap;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeRow {
  margin-left: 8px;
  padding-right: 0;
}

.blocklyTreeIcon {
  background-image: url(<<<PATH>>>/sprites.png);
  height: 16px;
  vertical-align: middle;
  visibility: hidden;
  width: 16px;
}

.blocklyTreeIconClosed {
  background-position: -32px -1px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeIconClosed {
  background-position: 0 -1px;
}

.blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: -32px -17px;
}

.blocklyToolboxDiv[dir="RTL"] .blocklyTreeSelected>.blocklyTreeIconClosed {
  background-position: 0 -17px;
}

.blocklyTreeIconOpen {
  background-position: -16px -1px;
}

.blocklyTreeSelected>.blocklyTreeIconOpen {
  background-position: -16px -17px;
}

.blocklyTreeLabel {
  cursor: default;
  font: 16px sans-serif;
  padding: 0 3px;
  vertical-align: middle;
}

.blocklyToolboxDelete .blocklyTreeLabel {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyTreeSelected .blocklyTreeLabel {
  color: #fff;
}
`),r(Z.TOOLBOX_ITEM,js.registrationName,js);var ll=class extends Zp{constructor(e,i){super(e,i),this.cssConfig_={container:"blocklyTreeSeparator"},this.htmlDiv=null,Object.assign(this.cssConfig_,e.cssconfig||e.cssConfig)}init(){this.createDom_()}createDom_(){const e=document.createElement("div"),i=this.cssConfig_.container;return i&&re(e,i),this.htmlDiv=e}getDiv(){return this.htmlDiv}dispose(){F(this.htmlDiv)}};ll.registrationName="sep",tt(`
.blocklyTreeSeparator {
  border-bottom: solid #e5e5e5 1px;
  height: 0;
  margin: 5px 0;
}

.blocklyToolboxDiv[layout="h"] .blocklyTreeSeparator {
  border-right: solid #e5e5e5 1px;
  border-bottom: none;
  height: auto;
  margin: 0 5px 0 5px;
  padding: 5px 0;
  width: 0;
}
`),r(Z.TOOLBOX_ITEM,ll.registrationName,ll);var jn=class extends js{constructor(e,i,n){super(e,i,n),this.subcategoriesDiv_=null,this.expanded_=!1,this.toolboxItems_=[]}makeDefaultCssConfig_(){const e=super.makeDefaultCssConfig_();return e.contents="blocklyToolboxContents",e}parseContents_(e){if("custom"in e)this.flyoutItems_=e.custom;else{const i=e.contents;if(i){this.flyoutItems_=[],e=!0;for(let n=0;n<i.length;n++){const c=i[n];!u(Z.TOOLBOX_ITEM,c.kind)||c.kind.toLowerCase()===ll.registrationName&&e?(this.flyoutItems_.push(c),e=!0):(this.createToolboxItem(c),e=!1)}}}}createToolboxItem(e){let i=e.kind;i.toUpperCase()==="CATEGORY"&&ql(e)&&(i=jn.registrationName),e=new(p(Z.TOOLBOX_ITEM,i))(e,this.parentToolbox_,this),this.toolboxItems_.push(e)}init(){super.init(),this.setExpanded(this.toolboxItemDef_.expanded==="true"||this.toolboxItemDef_.expanded===!0)}createDom_(){super.createDom_();const e=this.getChildToolboxItems();return this.subcategoriesDiv_=this.createSubCategoriesDom_(e),Zi(this.subcategoriesDiv_,Ws.GROUP),this.htmlDiv_.appendChild(this.subcategoriesDiv_),this.closeIcon_(this.iconDom_),xt(this.htmlDiv_,bt.EXPANDED,!1),this.htmlDiv_}createIconDom_(){const e=document.createElement("span");if(!this.parentToolbox_.isHorizontal()){const i=this.cssConfig_.icon;i&&re(e,i),e.style.visibility="visible"}return e.style.display="inline-block",e}createSubCategoriesDom_(e){const i=document.createElement("div");i.style.display="none";var n=this.cssConfig_.contents;for(n&&re(i,n),n=0;n<e.length;n++){const c=e[n];c.init();const d=c.getDiv();if(i.appendChild(d),c.getClickTarget){let m;(m=c.getClickTarget())==null||m.setAttribute("id",c.getId())}}return i}setExpanded(e){if(this.expanded_!==e){if(this.expanded_=e)this.subcategoriesDiv_.style.display="block",this.openIcon_(this.iconDom_);else{let i;(i=this.parentToolbox_.getFlyout())==null||i.setVisible(!1),this.subcategoriesDiv_.style.display="none",this.closeIcon_(this.iconDom_)}xt(this.htmlDiv_,bt.EXPANDED,e),this.parentToolbox_.handleToolboxItemResize()}}setVisible_(e){this.htmlDiv_.style.display=e?"block":"none";const i=this.getChildToolboxItems();for(let n=0;n<i.length;n++)i[n].setVisible_(e);this.isHidden_=!e,this.parentToolbox_.getSelectedItem()===this&&this.parentToolbox_.clearSelection()}isExpanded(){return this.expanded_}isCollapsible(){return!0}onClick(e){this.toggleExpanded()}toggleExpanded(){this.setExpanded(!this.expanded_)}getDiv(){return this.htmlDiv_}getChildToolboxItems(){return this.toolboxItems_}};jn.registrationName="collapsibleCategory",r(Z.TOOLBOX_ITEM,jn.registrationName,jn);var pE=class extends Tc{constructor(e){super(),this.id="toolbox",this.contentsDiv_=this.HtmlDiv=null,this.isVisible_=!1,this.contents_=[],this.height_=this.width_=0,this.previouslySelectedItem_=this.selectedItem_=this.flyout=null,this.boundEvents_=[],this.workspace_=e,this.toolboxDef_=e.options.languageTree||{contents:[]},this.horizontalLayout=e.options.horizontalLayout,this.RTL=e.options.RTL,this.contentMap_=Object.create(null),this.toolboxPosition=e.options.toolboxPosition}onShortcut(e){return!1}init(){var e=this.workspace_;const i=e.getParentSvg();this.flyout=this.createFlyout_(),this.HtmlDiv=this.createDom_(this.workspace_),ee(this.flyout.createDom("svg"),i),this.setVisible(!0),this.flyout.init(e),this.render(this.toolboxDef_),e=e.getThemeManager(),e.subscribe(this.HtmlDiv,"toolboxBackgroundColour","background-color"),e.subscribe(this.HtmlDiv,"toolboxForegroundColour","color"),this.workspace_.getComponentManager().addComponent({component:this,weight:et.ComponentWeight.TOOLBOX_WEIGHT,capabilities:[et.Capability.AUTOHIDEABLE,et.Capability.DELETE_AREA,et.Capability.DRAG_TARGET]})}createDom_(e){e=e.getParentSvg();const i=this.createContainer_();return this.contentsDiv_=this.createContentsContainer_(),this.contentsDiv_.tabIndex=0,Zi(this.contentsDiv_,Ws.TREE),i.appendChild(this.contentsDiv_),e.parentNode.insertBefore(i,e),this.attachEvents_(i,this.contentsDiv_),i}createContainer_(){const e=document.createElement("div");return e.setAttribute("layout",this.isHorizontal()?"h":"v"),re(e,"blocklyToolboxDiv"),e.setAttribute("dir",this.RTL?"RTL":"LTR"),e}createContentsContainer_(){const e=document.createElement("div");return re(e,"blocklyToolboxContents"),this.isHorizontal()&&(e.style.flexDirection="row"),e}attachEvents_(e,i){e=fe(e,"pointerdown",this,this.onClick_,!1),this.boundEvents_.push(e),i=fe(i,"keydown",this,this.onKeyDown_,!1),this.boundEvents_.push(i)}onClick_(e){if(Jt(e)||e.target===this.HtmlDiv)gt().hideChaff(!1);else{var i=e.target.getAttribute("id");i&&(i=this.getToolboxItemById(i),i.isSelectable()&&(this.setSelectedItem(i),i.onClick(e))),gt().hideChaff(!0)}It()}onKeyDown_(e){let i=!1;switch(e.key){case"ArrowDown":i=this.selectNext();break;case"ArrowUp":i=this.selectPrevious();break;case"ArrowLeft":i=this.selectParent();break;case"ArrowRight":i=this.selectChild();break;case"Enter":case" ":this.selectedItem_&&this.selectedItem_.isCollapsible()&&(this.selectedItem_.toggleExpanded(),i=!0);break;default:i=!1}!i&&this.selectedItem_&&this.selectedItem_.onKeyDown&&(i=this.selectedItem_.onKeyDown(e)),i&&e.preventDefault()}createFlyout_(){const e=this.workspace_,i=new As({parentWorkspace:e,rtl:e.RTL,oneBasedIndex:e.options.oneBasedIndex,horizontalLayout:e.horizontalLayout,renderer:e.options.renderer,rendererOverrides:e.options.rendererOverrides,move:{scrollbars:!0}});return i.toolboxPosition=e.options.toolboxPosition,new(e.horizontalLayout?_(Z.FLYOUTS_HORIZONTAL_TOOLBOX,e.options,!0):_(Z.FLYOUTS_VERTICAL_TOOLBOX,e.options,!0))(i)}render(e){this.toolboxDef_=e;for(let i=0;i<this.contents_.length;i++){const n=this.contents_[i];n&&n.dispose()}this.contents_=[],this.contentMap_=Object.create(null),this.renderContents_(e.contents),this.position(),this.handleToolboxItemResize()}renderContents_(e){const i=document.createDocumentFragment();for(let n=0;n<e.length;n++)this.createToolboxItem(e[n],i);this.contentsDiv_.appendChild(i)}createToolboxItem(e,i){var n=e.kind;n.toUpperCase()==="CATEGORY"&&ql(e)&&(n=jn.registrationName),(n=p(Z.TOOLBOX_ITEM,n.toLowerCase()))&&(e=new n(e,this),e.init(),this.addToolboxItem_(e),(n=e.getDiv())&&i.appendChild(n),e.getClickTarget()&&e.getClickTarget().setAttribute("id",e.getId()))}addToolboxItem_(e){if(this.contents_.push(e),this.contentMap_[e.getId()]=e,e.isCollapsible()){e=e.getChildToolboxItems();for(let i=0;i<e.length;i++)this.addToolboxItem_(e[i])}}getToolboxItems(){return this.contents_}addStyle(e){e&&this.HtmlDiv&&re(this.HtmlDiv,e)}removeStyle(e){e&&this.HtmlDiv&&S(this.HtmlDiv,e)}getClientRect(){if(!this.HtmlDiv||!this.isVisible_)return null;var e=this.HtmlDiv.getBoundingClientRect();const i=e.top,n=i+e.height,c=e.left;return e=c+e.width,this.toolboxPosition===Ie.TOP?new Ve(-1e7,n,-1e7,1e7):this.toolboxPosition===Ie.BOTTOM?new Ve(i,1e7,-1e7,1e7):this.toolboxPosition===Ie.LEFT?new Ve(-1e7,1e7,-1e7,e):new Ve(-1e7,1e7,c,1e7)}wouldDelete(e){return e instanceof Ps?this.updateWouldDelete_(!e.getParent()&&e.isDeletable()):this.updateWouldDelete_(Rs(e)&&e.isDeletable()),this.wouldDelete_}onDragEnter(e){this.updateCursorDeleteStyle_(!0)}onDragExit(e){this.updateCursorDeleteStyle_(!1)}onDrop(e){this.updateCursorDeleteStyle_(!1)}updateWouldDelete_(e){e!==this.wouldDelete_&&(this.updateCursorDeleteStyle_(!1),this.wouldDelete_=e,this.updateCursorDeleteStyle_(!0))}updateCursorDeleteStyle_(e){const i=this.wouldDelete_?"blocklyToolboxDelete":"blocklyToolboxGrab";e?this.addStyle(i):this.removeStyle(i)}getToolboxItemById(e){return this.contentMap_[e]||null}getWidth(){return this.width_}getHeight(){return this.height_}getFlyout(){return this.flyout}getWorkspace(){return this.workspace_}getSelectedItem(){return this.selectedItem_}getPreviouslySelectedItem(){return this.previouslySelectedItem_}isHorizontal(){return this.horizontalLayout}position(){const e=this.workspace_.getMetrics(),i=this.HtmlDiv;i&&(this.horizontalLayout?(i.style.left="0",i.style.height="auto",i.style.width="100%",this.height_=i.offsetHeight,this.width_=e.viewWidth,this.toolboxPosition===Ie.TOP?i.style.top="0":i.style.bottom="0"):(this.toolboxPosition===Ie.RIGHT?i.style.right="0":i.style.left="0",i.style.height="100%",this.width_=i.offsetWidth,this.height_=e.viewHeight),this.flyout.position())}handleToolboxItemResize(){const e=this.workspace_,i=this.HtmlDiv.getBoundingClientRect();e.translate(this.toolboxPosition===Ie.LEFT?e.scrollX+i.width:e.scrollX,this.toolboxPosition===Ie.TOP?e.scrollY+i.height:e.scrollY),kt(e)}clearSelection(){this.setSelectedItem(null)}refreshTheme(){for(let e=0;e<this.contents_.length;e++){const i=this.contents_[e];i.refreshTheme&&i.refreshTheme()}}refreshSelection(){this.selectedItem_&&this.selectedItem_.isSelectable()&&this.selectedItem_.getContents().length&&this.flyout.show(this.selectedItem_.getContents())}setVisible(e){this.isVisible_!==e&&(this.HtmlDiv.style.display=e?"block":"none",this.isVisible_=e,this.workspace_.recordDragTargets())}autoHide(e){!e&&this.flyout&&this.flyout.autoClose&&this.clearSelection()}setSelectedItem(e){const i=this.selectedItem_;!e&&!i||e&&!R$(e)||(this.shouldDeselectItem_(i,e)&&i!==null&&this.deselectItem_(i),this.shouldSelectItem_(i,e)&&e!==null&&this.selectItem_(i,e),this.updateFlyout_(i,e),this.fireSelectEvent(i,e))}shouldDeselectItem_(e,i){return e!==null&&(!e.isCollapsible()||e!==i)}shouldSelectItem_(e,i){return i!==null&&i!==e}deselectItem_(e){this.selectedItem_=null,this.previouslySelectedItem_=e,e.setSelected(!1),xt(this.contentsDiv_,bt.ACTIVEDESCENDANT,"")}selectItem_(e,i){this.selectedItem_=i,this.previouslySelectedItem_=e,i.setSelected(!0),xt(this.contentsDiv_,bt.ACTIVEDESCENDANT,i.getId())}selectItemByPosition(e){-1<e&&e<this.contents_.length&&(e=this.contents_[e],e.isSelectable()&&this.setSelectedItem(e))}updateFlyout_(e,i){i&&(e!==i||i.isCollapsible())&&i.getContents().length?(this.flyout.show(i.getContents()),this.flyout.scrollToStart()):this.flyout.hide()}fireSelectEvent(e,i){const n=e&&e.getName();let c=i&&i.getName();e===i&&(c=null),e=new(he(W.TOOLBOX_ITEM_SELECT))(n,c,this.workspace_.id),z(e)}selectParent(){return this.selectedItem_?this.selectedItem_.isCollapsible()&&this.selectedItem_.isExpanded()?(this.selectedItem_.toggleExpanded(),!0):this.selectedItem_.getParent()&&this.selectedItem_.getParent().isSelectable()?(this.setSelectedItem(this.selectedItem_.getParent()),!0):!1:!1}selectChild(){if(!this.selectedItem_||!this.selectedItem_.isCollapsible())return!1;const e=this.selectedItem_;return e.isExpanded()?this.selectNext():e.toggleExpanded(),!0}selectNext(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)+1;if(-1<e&&e<this.contents_.length){let i=this.contents_[e];for(;i&&!i.isSelectable();)i=this.contents_[++e];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1}selectPrevious(){if(!this.selectedItem_)return!1;let e=this.contents_.indexOf(this.selectedItem_)-1;if(-1<e&&e<this.contents_.length){let i=this.contents_[e];for(;i&&!i.isSelectable();)i=this.contents_[--e];if(i&&i.isSelectable())return this.setSelectedItem(i),!0}return!1}dispose(){this.workspace_.getComponentManager().removeComponent("toolbox"),this.flyout.dispose();for(var e=0;e<this.contents_.length;e++)this.contents_[e].dispose();for(e=0;e<this.boundEvents_.length;e++)Ue(this.boundEvents_[e]);this.boundEvents_=[],this.contents_=[],this.HtmlDiv&&(this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv),F(this.HtmlDiv))}};tt(`
.blocklyToolboxDelete {
  cursor: url("<<<PATH>>>/handdelete.cur"), auto;
}

.blocklyToolboxGrab {
  cursor: url("<<<PATH>>>/handclosed.cur"), auto;
  cursor: grabbing;
  cursor: -webkit-grabbing;
}

/* Category tree in Toolbox. */
.blocklyToolboxDiv {
  background-color: #ddd;
  overflow-x: visible;
  overflow-y: auto;
  padding: 4px 0 4px 0;
  position: absolute;
  z-index: 70;  /* so blocks go under toolbox when dragging */
  -webkit-tap-highlight-color: transparent;  /* issue #1345 */
}

.blocklyToolboxContents {
  display: flex;
  flex-wrap: wrap;
  flex-direction: column;
}

.blocklyToolboxContents:focus {
  outline: none;
}
`),r(Z.TOOLBOX,hi,pE);var kC="11.2.2",OC=le.INPUT_VALUE,AC=le.OUTPUT_VALUE,MC=le.NEXT_STATEMENT,LC=le.PREVIOUS_STATEMENT,PC=Ie.TOP,NC=Ie.BOTTOM,DC=Ie.LEFT,BC=Ie.RIGHT;Wn.prototype.newBlock=function(e,i){return new hr(this,e,i)},Es.prototype.newBlock=function(e,i){return new Ps(this,e,i)},Wn.prototype.newComment=function(e){return new rc(this,e)},Es.prototype.newComment=function(e){return new nc(this,e)},Es.newTrashcan=function(e){return new cb(e)},Pi.prototype.newWorkspaceSvg=function(e){return new Es(e)},s.Names$$module$build$src$core$names.prototype.populateProcedures=function(e){e=Ca(e),e=e[0].concat(e[1]);for(let i=0;i<e.length;i++)this.getName(e[i][0],s.Names$$module$build$src$core$names.NameType.PROCEDURE)};var X={};return X.ASTNode=j,X.BasicCursor=sl,X.Block=hr,X.BlockSvg=Ps,X.Blocks=cs,X.COLLAPSED_FIELD_NAME=za,X.COLLAPSED_INPUT_NAME=Fo,X.COLLAPSE_CHARS=tb,X.CodeGenerator=s.CodeGenerator$$module$build$src$core$generator,X.CollapsibleToolboxCategory=jn,X.ComponentManager=et,X.Connection=Ae,X.ConnectionChecker=sb,X.ConnectionDB=Un,X.ConnectionType=le,X.ContextMenu=Hr,X.ContextMenuItems=Et,X.ContextMenuRegistry=Ce,X.Css=kd,X.Cursor=xp,X.DELETE_VARIABLE_ID=Ep,X.DeleteArea=Tc,X.DragTarget=ab,X.DropDownDiv=Ht,X.Events=ne,X.Extensions=Ys,X.Field=Ke,X.FieldCheckbox=Kr,X.FieldDropdown=hs,X.FieldImage=Yr,X.FieldLabel=Wr,X.FieldLabelSerializable=wb,X.FieldNumber=Dp,X.FieldTextInput=Sc,X.FieldVariable=rl,X.Flyout=xc,X.FlyoutButton=Ms,X.FlyoutMetricsManager=xb,X.Generator=s.CodeGenerator$$module$build$src$core$generator,X.Gesture=Li,X.Grid=op,X.HorizontalFlyout=Cb,X.INPUT_VALUE=OC,X.Input=Vn,X.InsertionMarkerManager=Ls,X.InsertionMarkerPreviewer=vb,X.Marker=nb,X.MarkerManager=Wo,X.Menu=Dd,X.MenuItem=Bd,X.MetricsManager=Lp,X.Msg=s.Msg$$module$build$src$core$msg,X.NEXT_STATEMENT=MC,X.Names=s.Names$$module$build$src$core$names,X.OPPOSITE_TYPE=Xr,X.OUTPUT_VALUE=AC,X.Options=As,X.PREVIOUS_STATEMENT=LC,X.PROCEDURE_CATEGORY_NAME=dc,X.Procedures=ts,X.RENAME_VARIABLE_ID=bp,X.RenderedConnection=ss,X.Scrollbar=ht,X.ScrollbarPair=Mp,X.ShortcutItems=gi,X.ShortcutRegistry=Pe,X.TOOLBOX_AT_BOTTOM=NC,X.TOOLBOX_AT_LEFT=DC,X.TOOLBOX_AT_RIGHT=BC,X.TOOLBOX_AT_TOP=PC,X.TabNavigateCursor=ob,X.Theme=Vr,X.ThemeManager=eb,X.Themes=RC,X.Toolbox=pE,X.ToolboxCategory=js,X.ToolboxItem=Zp,X.ToolboxSeparator=ll,X.Tooltip=_s,X.Touch=Ar,X.Trashcan=cb,X.UnattachedFieldError=ut,X.VARIABLE_CATEGORY_NAME=Wd,X.VARIABLE_DYNAMIC_CATEGORY_NAME=Tp,X.VERSION=kC,X.VariableMap=Sp,X.VariableModel=Go,X.Variables=At,X.VariablesDynamic=zr,X.VerticalFlyout=Np,X.WidgetDiv=Xs,X.Workspace=Wn,X.WorkspaceAudio=ib,X.WorkspaceDragger=DT,X.WorkspaceSvg=Es,X.Xml=Vt,X.ZoomControls=lT,X.blockAnimations=jo,X.blockRendering=De,X.browserEvents=ki,X.bubbles=ol,X.bumpObjects=$c,X.clipboard=il,X.comments=Cc,X.common=Ot,X.config=s.config$$module$build$src$core$config,X.constants=sC,X.defineBlocksWithJsonArray=jt,X.dialog=Pr,X.dragging=nl,X.fieldRegistry=ac,X.geras=_i,X.getMainWorkspace=gt,X.getSelected=qe,X.hasBubble=$n,X.hideChaff=k$,X.icons=ar,X.inject=m$,X.inputs=pr,X.isCopyable=ko,X.isDeletable=Rs,X.isDraggable=Rr,X.isIcon=Nu,X.isObservable=xa,X.isPaster=x$,X.isRenderedElement=C$,X.isSelectable=w$,X.isSerializable=mo,X.isVariableBackedParameterModel=Rh,X.layers=iC,X.procedures=ts,X.registry=wi,X.renderManagement=Ya,X.serialization=SC,X.setLocale=Hd,X.setParentContainer=si,X.svgResize=kt,X.thrasos=Jp,X.uiPosition=Lr,X.utils=rt,X.zelos=Ks,X.__namespace__=s,X})})(lv);var _g=lv.exports;const VC=co(_g),{ASTNode:EH,BasicCursor:yH,Block:vH,BlockSvg:SH,Blocks:Dt,COLLAPSED_FIELD_NAME:IH,COLLAPSED_INPUT_NAME:xH,COLLAPSE_CHARS:CH,CodeGenerator:wH,CollapsibleToolboxCategory:RH,ComponentManager:kH,Connection:OH,ConnectionChecker:AH,ConnectionDB:MH,ConnectionType:LH,ContextMenu:PH,ContextMenuItems:NH,ContextMenuRegistry:DH,Css:BH,Cursor:FH,DELETE_VARIABLE_ID:UH,DeleteArea:GH,DragTarget:HH,DropDownDiv:VH,Events:WH,Extensions:zH,Field:XH,FieldCheckbox:YH,FieldDropdown:KH,FieldImage:jH,FieldLabel:qH,FieldLabelSerializable:JH,FieldNumber:ZH,FieldTextInput:QH,FieldVariable:e2,Flyout:t2,FlyoutButton:s2,FlyoutMetricsManager:i2,Generator:r2,Gesture:n2,Grid:o2,HorizontalFlyout:l2,INPUT_VALUE:a2,Input:c2,InsertionMarkerManager:h2,InsertionMarkerPreviewer:u2,Marker:d2,MarkerManager:p2,Menu:f2,MenuItem:g2,MetricsManager:m2,Msg:_2,NEXT_STATEMENT:$2,Names:T2,OPPOSITE_TYPE:b2,OUTPUT_VALUE:E2,Options:y2,PREVIOUS_STATEMENT:v2,PROCEDURE_CATEGORY_NAME:S2,Procedures:I2,RENAME_VARIABLE_ID:x2,RenderedConnection:C2,Scrollbar:w2,ScrollbarPair:R2,ShortcutItems:k2,ShortcutRegistry:O2,TOOLBOX_AT_BOTTOM:A2,TOOLBOX_AT_LEFT:M2,TOOLBOX_AT_RIGHT:L2,TOOLBOX_AT_TOP:P2,TabNavigateCursor:N2,Theme:WC,ThemeManager:D2,Themes:zC,Toolbox:B2,ToolboxCategory:F2,ToolboxItem:U2,ToolboxSeparator:G2,Tooltip:H2,Touch:V2,Trashcan:W2,UnattachedFieldError:z2,VARIABLE_CATEGORY_NAME:X2,VARIABLE_DYNAMIC_CATEGORY_NAME:Y2,VERSION:K2,VariableMap:j2,VariableModel:q2,Variables:J2,VariablesDynamic:Z2,VerticalFlyout:Q2,WidgetDiv:eV,Workspace:tV,WorkspaceAudio:sV,WorkspaceDragger:iV,WorkspaceSvg:rV,Xml:eh,ZoomControls:nV,blockAnimations:oV,blockRendering:lV,browserEvents:aV,bubbles:cV,bumpObjects:hV,clipboard:uV,comments:dV,common:pV,config:fV,constants:gV,defineBlocksWithJsonArray:mV,dialog:_V,dragging:$V,fieldRegistry:TV,geras:bV,getMainWorkspace:EV,getSelected:yV,hasBubble:vV,hideChaff:SV,icons:IV,inject:XC,inputs:xV,isCopyable:CV,isDeletable:wV,isDraggable:RV,isIcon:kV,isObservable:OV,isPaster:AV,isRenderedElement:MV,isSelectable:LV,isSerializable:PV,isVariableBackedParameterModel:NV,layers:DV,procedures:BV,registry:YC,renderManagement:FV,serialization:UV,setLocale:KC,setParentContainer:GV,svgResize:HV,thrasos:VV,uiPosition:WV,utils:av,zelos:cv}=VC;var hv={exports:{}};(function(l,t){(function(s,r){l.exports=r(_g)})(nn,function(s){var r=s.__namespace__,o=function(b,I){return["[]",P.ATOMIC]},a=function(b,I){const L=Array(b.itemCount_);for(let H=0;H<b.itemCount_;H++)L[H]=I.valueToCode(b,"ADD"+H,P.NONE)||"null";return["["+L.join(", ")+"]",P.ATOMIC]},h=function(b,I){const L=I.provideFunction_("listsRepeat",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(value, n) {
  var array = [];
  for (var i = 0; i < n; i++) {
    array[i] = value;
  }
  return array;
}
`),H=I.valueToCode(b,"ITEM",P.NONE)||"null";return b=I.valueToCode(b,"NUM",P.NONE)||"0",[L+"("+H+", "+b+")",P.FUNCTION_CALL]},u=function(b,I){return[(I.valueToCode(b,"VALUE",P.MEMBER)||"[]")+".length",P.MEMBER]},p=function(b,I){return["!"+(I.valueToCode(b,"VALUE",P.MEMBER)||"[]")+".length",P.LOGICAL_NOT]},f=function(b,I){const L=b.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",H=I.valueToCode(b,"FIND",P.NONE)||"''";return I=(I.valueToCode(b,"VALUE",P.MEMBER)||"[]")+"."+L+"("+H+")",b.workspace.options.oneBasedIndex?[I+" + 1",P.ADDITION]:[I,P.FUNCTION_CALL]},g=function(b,I){const L=b.getFieldValue("MODE")||"GET",H=b.getFieldValue("WHERE")||"FROM_START";var J=I.valueToCode(b,"VALUE",H==="RANDOM"?P.NONE:P.MEMBER)||"[]";switch(H){case"FIRST":if(L==="GET")return[J+"[0]",P.MEMBER];if(L==="GET_REMOVE")return[J+".shift()",P.MEMBER];if(L==="REMOVE")return J+`.shift();
`;break;case"LAST":if(L==="GET")return[J+".slice(-1)[0]",P.MEMBER];if(L==="GET_REMOVE")return[J+".pop()",P.MEMBER];if(L==="REMOVE")return J+`.pop();
`;break;case"FROM_START":if(b=I.getAdjusted(b,"AT"),L==="GET")return[J+"["+b+"]",P.MEMBER];if(L==="GET_REMOVE")return[J+".splice("+b+", 1)[0]",P.FUNCTION_CALL];if(L==="REMOVE")return J+".splice("+b+`, 1);
`;break;case"FROM_END":if(b=I.getAdjusted(b,"AT",1,!0),L==="GET")return[J+".slice("+b+")[0]",P.FUNCTION_CALL];if(L==="GET_REMOVE")return[J+".splice("+b+", 1)[0]",P.FUNCTION_CALL];if(L==="REMOVE")return J+".splice("+b+", 1);";break;case"RANDOM":if(J=I.provideFunction_("listsGetRandomItem",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(list, remove) {
  var x = Math.floor(Math.random() * list.length);
  if (remove) {
    return list.splice(x, 1)[0];
  } else {
    return list[x];
  }
}
`)+"("+J+", "+(L!=="GET")+")",L==="GET"||L==="GET_REMOVE")return[J,P.FUNCTION_CALL];if(L==="REMOVE")return J+`;
`}throw Error("Unhandled combination (lists_getIndex).")},_=function(b,I){function L(){if(H.match(/^\w+$/))return"";const ls=I.nameDB_.getDistinctName("tmpList",r.NameType$$module$build$src$core$names.VARIABLE),qi="var "+ls+" = "+H+`;
`;return H=ls,qi}let H=I.valueToCode(b,"LIST",P.MEMBER)||"[]";const J=b.getFieldValue("MODE")||"GET";var ce=b.getFieldValue("WHERE")||"FROM_START";const ye=I.valueToCode(b,"TO",P.ASSIGNMENT)||"null";switch(ce){case"FIRST":if(J==="SET")return H+"[0] = "+ye+`;
`;if(J==="INSERT")return H+".unshift("+ye+`);
`;break;case"LAST":if(J==="SET")return L()+(H+"["+H+".length - 1] = "+ye+`;
`);if(J==="INSERT")return H+".push("+ye+`);
`;break;case"FROM_START":if(b=I.getAdjusted(b,"AT"),J==="SET")return H+"["+b+"] = "+ye+`;
`;if(J==="INSERT")return H+".splice("+b+", 0, "+ye+`);
`;break;case"FROM_END":if(b=I.getAdjusted(b,"AT",1,!1,P.SUBTRACTION),ce=L(),J==="SET")return ce+(H+"["+H+".length - "+b+"] = "+ye+`;
`);if(J==="INSERT")return ce+(H+".splice("+H+".length - "+b+", 0, "+ye+`);
`);break;case"RANDOM":if(b=L(),ce=I.nameDB_.getDistinctName("tmpX",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+ce+" = Math.floor(Math.random() * "+H+`.length);
`,J==="SET")return b+(H+"["+ce+"] = "+ye+`;
`);if(J==="INSERT")return b+(H+".splice("+ce+", 0, "+ye+`);
`)}throw Error("Unhandled combination (lists_setIndex).")},$=function(b,I){var L={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"},H=I.valueToCode(b,"LIST",P.MEMBER)||"[]";const J=b.getFieldValue("WHERE1"),ce=b.getFieldValue("WHERE2");if(J==="FIRST"&&ce==="LAST")H+=".slice(0)";else if(H.match(/^\w+$/)||J!=="FROM_END"&&ce==="FROM_START"){switch(J){case"FROM_START":L=I.getAdjusted(b,"AT1");break;case"FROM_END":L=I.getAdjusted(b,"AT1",1,!1,P.SUBTRACTION),L=H+".length - "+L;break;case"FIRST":L="0";break;default:throw Error("Unhandled option (lists_getSublist).")}switch(ce){case"FROM_START":I=I.getAdjusted(b,"AT2",1);break;case"FROM_END":I=I.getAdjusted(b,"AT2",0,!1,P.SUBTRACTION),I=H+".length - "+I;break;case"LAST":I=H+".length";break;default:throw Error("Unhandled option (lists_getSublist).")}H=H+".slice("+L+", "+I+")"}else{const ye=I.getAdjusted(b,"AT1");b=I.getAdjusted(b,"AT2"),H=I.provideFunction_("subsequence"+L[J]+L[ce],`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(sequence${J==="FROM_END"||J==="FROM_START"?", at1":""}${ce==="FROM_END"||ce==="FROM_START"?", at2":""}) {
  var start = ${$t("sequence",J,"at1")};
  var end = ${$t("sequence",ce,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+H+(J==="FROM_END"||J==="FROM_START"?", "+ye:"")+(ce==="FROM_END"||ce==="FROM_START"?", "+b:"")+")"}return[H,P.FUNCTION_CALL]},E=function(b,I){const L=I.valueToCode(b,"LIST",P.FUNCTION_CALL)||"[]",H=b.getFieldValue("DIRECTION")==="1"?1:-1;return b=b.getFieldValue("TYPE"),I=I.provideFunction_("listsGetSortCompare",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(type, direction) {
  var compareFuncs = {
    'NUMERIC': function(a, b) {
        return Number(a) - Number(b); },
    'TEXT': function(a, b) {
        return String(a) > String(b) ? 1 : -1; },
    'IGNORE_CASE': function(a, b) {
        return String(a).toLowerCase() > String(b).toLowerCase() ? 1 : -1; },
  };
  var compare = compareFuncs[type];
  return function(a, b) { return compare(a, b) * direction; };
}
      `),[L+".slice().sort("+I+'("'+b+'", '+H+"))",P.FUNCTION_CALL]},v=function(b,I){let L=I.valueToCode(b,"INPUT",P.MEMBER);if(I=I.valueToCode(b,"DELIM",P.NONE)||"''",b=b.getFieldValue("MODE"),b==="SPLIT")L||(L="''"),b="split";else if(b==="JOIN")L||(L="[]"),b="join";else throw Error("Unknown mode: "+b);return[L+"."+b+"("+I+")",P.FUNCTION_CALL]},w=function(b,I){return[(I.valueToCode(b,"LIST",P.FUNCTION_CALL)||"[]")+".slice().reverse()",P.FUNCTION_CALL]},x=function(b,I){var L=0;let H="";I.STATEMENT_PREFIX&&(H+=I.injectId(I.STATEMENT_PREFIX,b));do{const J=I.valueToCode(b,"IF"+L,P.NONE)||"false";let ce=I.statementToCode(b,"DO"+L);I.STATEMENT_SUFFIX&&(ce=I.prefixLines(I.injectId(I.STATEMENT_SUFFIX,b),I.INDENT)+ce),H+=(0<L?" else ":"")+"if ("+J+`) {
`+ce+"}",L++}while(b.getInput("IF"+L));return(b.getInput("ELSE")||I.STATEMENT_SUFFIX)&&(L=b.getInput("ELSE")?I.statementToCode(b,"ELSE"):"",I.STATEMENT_SUFFIX&&(L=I.prefixLines(I.injectId(I.STATEMENT_SUFFIX,b),I.INDENT)+L),H+=` else {
`+L+"}"),H+`
`},C=function(b,I){const L={EQ:"==",NEQ:"!=",LT:"<",LTE:"<=",GT:">",GTE:">="}[b.getFieldValue("OP")],H=L==="=="||L==="!="?P.EQUALITY:P.RELATIONAL,J=I.valueToCode(b,"A",H)||"0";return b=I.valueToCode(b,"B",H)||"0",[J+" "+L+" "+b,H]},R=function(b,I){const L=b.getFieldValue("OP")==="AND"?"&&":"||",H=L==="&&"?P.LOGICAL_AND:P.LOGICAL_OR;let J=I.valueToCode(b,"A",H);return b=I.valueToCode(b,"B",H),J||b?(I=L==="&&"?"true":"false",J||(J=I),b||(b=I)):b=J="false",[J+" "+L+" "+b,H]},A=function(b,I){const L=P.LOGICAL_NOT;return["!"+(I.valueToCode(b,"BOOL",L)||"true"),L]},D=function(b,I){return[b.getFieldValue("BOOL")==="TRUE"?"true":"false",P.ATOMIC]},G=function(b,I){return["null",P.ATOMIC]},M=function(b,I){const L=I.valueToCode(b,"IF",P.CONDITIONAL)||"false",H=I.valueToCode(b,"THEN",P.CONDITIONAL)||"null";return b=I.valueToCode(b,"ELSE",P.CONDITIONAL)||"null",[L+" ? "+H+" : "+b,P.CONDITIONAL]},k=function(b,I){let L;L=b.getField("TIMES")?String(Number(b.getFieldValue("TIMES"))):I.valueToCode(b,"TIMES",P.ASSIGNMENT)||"0";let H=I.statementToCode(b,"DO");H=I.addLoopTrap(H,b),b="";const J=I.nameDB_.getDistinctName("count",r.NameType$$module$build$src$core$names.VARIABLE);let ce=L;return L.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(L)||(ce=I.nameDB_.getDistinctName("repeat_end",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+ce+" = "+L+`;
`),b+("for (var "+J+" = 0; "+J+" < "+ce+"; "+J+`++) {
`+H+`}
`)},z=function(b,I){const L=b.getFieldValue("MODE")==="UNTIL";let H=I.valueToCode(b,"BOOL",L?P.LOGICAL_NOT:P.NONE)||"false",J=I.statementToCode(b,"DO");return J=I.addLoopTrap(J,b),L&&(H="!"+H),"while ("+H+`) {
`+J+`}
`},se=function(b,I){var L=I.getVariableName(b.getFieldValue("VAR")),H=I.valueToCode(b,"FROM",P.ASSIGNMENT)||"0",J=I.valueToCode(b,"TO",P.ASSIGNMENT)||"0";const ce=I.valueToCode(b,"BY",P.ASSIGNMENT)||"1";let ye=I.statementToCode(b,"DO");if(ye=I.addLoopTrap(ye,b),r.isNumber$$module$build$src$core$utils$string(H)&&r.isNumber$$module$build$src$core$utils$string(J)&&r.isNumber$$module$build$src$core$utils$string(ce))I=Number(H)<=Number(J),b="for ("+L+" = "+H+"; "+L+(I?" <= ":" >= ")+J+"; "+L,L=Math.abs(Number(ce)),b=L===1?b+(I?"++":"--"):b+((I?" += ":" -= ")+L),b+=`) {
`+ye+`}
`;else{b="";let ls=H;H.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(H)||(ls=I.nameDB_.getDistinctName(L+"_start",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+ls+" = "+H+`;
`),H=J,J.match(/^\w+$/)||r.isNumber$$module$build$src$core$utils$string(J)||(H=I.nameDB_.getDistinctName(L+"_end",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+H+" = "+J+`;
`),J=I.nameDB_.getDistinctName(L+"_inc",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+J+" = ",b=r.isNumber$$module$build$src$core$utils$string(ce)?b+(Math.abs(Number(ce))+`;
`):b+("Math.abs("+ce+`);
`),b+="if ("+ls+" > "+H+`) {
`,b+=I.INDENT+J+" = -"+J+`;
`,b=b+`}
for (`+(L+" = "+ls+"; "+J+" >= 0 ? "+L+" <= "+H+" : "+L+" >= "+H+"; "+L+" += "+J+`) {
`+ye+`}
`)}return b},Q=function(b,I){const L=I.getVariableName(b.getFieldValue("VAR"));var H=I.valueToCode(b,"LIST",P.ASSIGNMENT)||"[]";let J=I.statementToCode(b,"DO");J=I.addLoopTrap(J,b),b="";let ce=H;return H.match(/^\w+$/)||(ce=I.nameDB_.getDistinctName(L+"_list",r.NameType$$module$build$src$core$names.VARIABLE),b+="var "+ce+" = "+H+`;
`),H=I.nameDB_.getDistinctName(L+"_index",r.NameType$$module$build$src$core$names.VARIABLE),J=I.INDENT+L+" = "+ce+"["+H+`];
`+J,b+("for (var "+H+" in "+ce+`) {
`+J+`}
`)},ie=function(b,I){let L="";if(I.STATEMENT_PREFIX&&(L+=I.injectId(I.STATEMENT_PREFIX,b)),I.STATEMENT_SUFFIX&&(L+=I.injectId(I.STATEMENT_SUFFIX,b)),I.STATEMENT_PREFIX){const H=b.getSurroundLoop();H&&!H.suppressPrefixSuffix&&(L+=I.injectId(I.STATEMENT_PREFIX,H))}switch(b.getFieldValue("FLOW")){case"BREAK":return L+`break;
`;case"CONTINUE":return L+`continue;
`}throw Error("Unknown flow statement.")},_e=function(b,I){return b=Number(b.getFieldValue("NUM")),[String(b),0<=b?P.ATOMIC:P.UNARY_NEGATION]},ge=function(b,I){var L={ADD:[" + ",P.ADDITION],MINUS:[" - ",P.SUBTRACTION],MULTIPLY:[" * ",P.MULTIPLICATION],DIVIDE:[" / ",P.DIVISION],POWER:[null,P.NONE]}[b.getFieldValue("OP")];const H=L[0];L=L[1];const J=I.valueToCode(b,"A",L)||"0";return b=I.valueToCode(b,"B",L)||"0",H?[J+H+b,L]:["Math.pow("+J+", "+b+")",P.FUNCTION_CALL]},ue=function(b,I){const L=b.getFieldValue("OP");let H;if(L==="NEG")return b=I.valueToCode(b,"NUM",P.UNARY_NEGATION)||"0",b[0]==="-"&&(b=" "+b),["-"+b,P.UNARY_NEGATION];switch(b=L==="SIN"||L==="COS"||L==="TAN"?I.valueToCode(b,"NUM",P.DIVISION)||"0":I.valueToCode(b,"NUM",P.NONE)||"0",L){case"ABS":H="Math.abs("+b+")";break;case"ROOT":H="Math.sqrt("+b+")";break;case"LN":H="Math.log("+b+")";break;case"EXP":H="Math.exp("+b+")";break;case"POW10":H="Math.pow(10,"+b+")";break;case"ROUND":H="Math.round("+b+")";break;case"ROUNDUP":H="Math.ceil("+b+")";break;case"ROUNDDOWN":H="Math.floor("+b+")";break;case"SIN":H="Math.sin("+b+" / 180 * Math.PI)";break;case"COS":H="Math.cos("+b+" / 180 * Math.PI)";break;case"TAN":H="Math.tan("+b+" / 180 * Math.PI)"}if(H)return[H,P.FUNCTION_CALL];switch(L){case"LOG10":H="Math.log("+b+") / Math.log(10)";break;case"ASIN":H="Math.asin("+b+") / Math.PI * 180";break;case"ACOS":H="Math.acos("+b+") / Math.PI * 180";break;case"ATAN":H="Math.atan("+b+") / Math.PI * 180";break;default:throw Error("Unknown math operator: "+L)}return[H,P.DIVISION]},St=function(b,I){return{PI:["Math.PI",P.MEMBER],E:["Math.E",P.MEMBER],GOLDEN_RATIO:["(1 + Math.sqrt(5)) / 2",P.DIVISION],SQRT2:["Math.SQRT2",P.MEMBER],SQRT1_2:["Math.SQRT1_2",P.MEMBER],INFINITY:["Infinity",P.ATOMIC]}[b.getFieldValue("CONSTANT")]},pe=function(b,I){var L={EVEN:[" % 2 === 0",P.MODULUS,P.EQUALITY],ODD:[" % 2 === 1",P.MODULUS,P.EQUALITY],WHOLE:[" % 1 === 0",P.MODULUS,P.EQUALITY],POSITIVE:[" > 0",P.RELATIONAL,P.RELATIONAL],NEGATIVE:[" < 0",P.RELATIONAL,P.RELATIONAL],DIVISIBLE_BY:[null,P.MODULUS,P.EQUALITY],PRIME:[null,P.NONE,P.FUNCTION_CALL]};const H=b.getFieldValue("PROPERTY"),[J,ce,ye]=L[H];return L=I.valueToCode(b,"NUMBER_TO_CHECK",ce)||"0",H==="PRIME"?b=I.provideFunction_("mathIsPrime",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(n) {
  // https://en.wikipedia.org/wiki/Primality_test#Naive_methods
  if (n == 2 || n == 3) {
    return true;
  }
  // False if n is NaN, negative, is 1, or not whole.
  // And false if n is divisible by 2 or 3.
  if (isNaN(n) || n <= 1 || n % 1 !== 0 || n % 2 === 0 || n % 3 === 0) {
    return false;
  }
  // Check all the numbers of form 6k +/- 1, up to sqrt(n).
  for (var x = 6; x <= Math.sqrt(n) + 1; x += 6) {
    if (n % (x - 1) === 0 || n % (x + 1) === 0) {
      return false;
    }
  }
  return true;
}
`)+"("+L+")":H==="DIVISIBLE_BY"?(b=I.valueToCode(b,"DIVISOR",P.MODULUS)||"0",b=L+" % "+b+" === 0"):b=L+J,[b,ye]},be=function(b,I){const L=I.valueToCode(b,"DELTA",P.ADDITION)||"0";return b=I.getVariableName(b.getFieldValue("VAR")),b+" = (typeof "+b+" === 'number' ? "+b+" : 0) + "+L+`;
`},he=function(b,I){var L=b.getFieldValue("OP");switch(L){case"SUM":b=I.valueToCode(b,"LIST",P.MEMBER)||"[]",b+=".reduce(function(x, y) {return x + y;}, 0)";break;case"MIN":b=I.valueToCode(b,"LIST",P.NONE)||"[]",b="Math.min.apply(null, "+b+")";break;case"MAX":b=I.valueToCode(b,"LIST",P.NONE)||"[]",b="Math.max.apply(null, "+b+")";break;case"AVERAGE":L=I.provideFunction_("mathMean",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  return myList.reduce(function(x, y) {return x + y;}, 0) / myList.length;
}
`),b=I.valueToCode(b,"LIST",P.NONE)||"[]",b=L+"("+b+")";break;case"MEDIAN":L=I.provideFunction_("mathMedian",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(myList) {
  var localList = myList.filter(function (x) {return typeof x === 'number';});
  if (!localList.length) return null;
  localList.sort(function(a, b) {return b - a;});
  if (localList.length % 2 === 0) {
    return (localList[localList.length / 2 - 1] + localList[localList.length / 2]) / 2;
  } else {
    return localList[(localList.length - 1) / 2];
  }
}
`),b=I.valueToCode(b,"LIST",P.NONE)||"[]",b=L+"("+b+")";break;case"MODE":L=I.provideFunction_("mathModes",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(values) {
  var modes = [];
  var counts = [];
  var maxCount = 0;
  for (var i = 0; i < values.length; i++) {
    var value = values[i];
    var found = false;
    var thisCount;
    for (var j = 0; j < counts.length; j++) {
      if (counts[j][0] === value) {
        thisCount = ++counts[j][1];
        found = true;
        break;
      }
    }
    if (!found) {
      counts.push([value, 1]);
      thisCount = 1;
    }
    maxCount = Math.max(thisCount, maxCount);
  }
  for (var j = 0; j < counts.length; j++) {
    if (counts[j][1] === maxCount) {
      modes.push(counts[j][0]);
    }
  }
  return modes;
}
`),b=I.valueToCode(b,"LIST",P.NONE)||"[]",b=L+"("+b+")";break;case"STD_DEV":L=I.provideFunction_("mathStandardDeviation",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(numbers) {
  var n = numbers.length;
  if (!n) return null;
  var mean = numbers.reduce(function(x, y) {return x + y;}) / n;
  var variance = 0;
  for (var j = 0; j < n; j++) {
    variance += Math.pow(numbers[j] - mean, 2);
  }
  variance /= n;
  return Math.sqrt(variance);
}
`),b=I.valueToCode(b,"LIST",P.NONE)||"[]",b=L+"("+b+")";break;case"RANDOM":L=I.provideFunction_("mathRandomList",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(list) {
  var x = Math.floor(Math.random() * list.length);
  return list[x];
}
`),b=I.valueToCode(b,"LIST",P.NONE)||"[]",b=L+"("+b+")";break;default:throw Error("Unknown operator: "+L)}return[b,P.FUNCTION_CALL]},Ne=function(b,I){const L=I.valueToCode(b,"DIVIDEND",P.MODULUS)||"0";return b=I.valueToCode(b,"DIVISOR",P.MODULUS)||"0",[L+" % "+b,P.MODULUS]},pt=function(b,I){const L=I.valueToCode(b,"VALUE",P.NONE)||"0",H=I.valueToCode(b,"LOW",P.NONE)||"0";return b=I.valueToCode(b,"HIGH",P.NONE)||"Infinity",["Math.min(Math.max("+L+", "+H+"), "+b+")",P.FUNCTION_CALL]},Kt=function(b,I){const L=I.valueToCode(b,"FROM",P.NONE)||"0";return b=I.valueToCode(b,"TO",P.NONE)||"0",[I.provideFunction_("mathRandomInt",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(a, b) {
  if (a > b) {
    // Swap a and b to ensure a is smaller.
    var c = a;
    a = b;
    b = c;
  }
  return Math.floor(Math.random() * (b - a + 1) + a);
}
`)+"("+L+", "+b+")",P.FUNCTION_CALL]},ps=function(b,I){return["Math.random()",P.FUNCTION_CALL]},fs=function(b,I){const L=I.valueToCode(b,"X",P.NONE)||"0";return["Math.atan2("+(I.valueToCode(b,"Y",P.NONE)||"0")+", "+L+") / Math.PI * 180",P.DIVISION]},gt=function(b,I){const L=I.getProcedureName(b.getFieldValue("NAME"));var H="";I.STATEMENT_PREFIX&&(H+=I.injectId(I.STATEMENT_PREFIX,b)),I.STATEMENT_SUFFIX&&(H+=I.injectId(I.STATEMENT_SUFFIX,b)),H&&(H=I.prefixLines(H,I.INDENT));let J="";I.INFINITE_LOOP_TRAP&&(J=I.prefixLines(I.injectId(I.INFINITE_LOOP_TRAP,b),I.INDENT));let ce="";b.getInput("STACK")&&(ce=I.statementToCode(b,"STACK"));let ye="";b.getInput("RETURN")&&(ye=I.valueToCode(b,"RETURN",P.NONE)||"");let ls="";ce&&ye&&(ls=H),ye&&(ye=I.INDENT+"return "+ye+`;
`);const qi=[],yr=b.getVars();for(let Ji=0;Ji<yr.length;Ji++)qi[Ji]=I.getVariableName(yr[Ji]);return H="function "+L+"("+qi.join(", ")+`) {
`+H+J+ce+ls+ye+"}",H=I.scrub_(b,H),I.definitions_["%"+L]=H,null},Ft=function(b,I){const L=I.getProcedureName(b.getFieldValue("NAME")),H=[],J=b.getVars();for(let ce=0;ce<J.length;ce++)H[ce]=I.valueToCode(b,"ARG"+ce,P.NONE)||"null";return[L+"("+H.join(", ")+")",P.FUNCTION_CALL]},qe=function(b,I){return I.forBlock.procedures_callreturn(b,I)[0]+`;
`},xs=function(b,I){let L="if ("+(I.valueToCode(b,"CONDITION",P.NONE)||"false")+`) {
`;return I.STATEMENT_SUFFIX&&(L+=I.prefixLines(I.injectId(I.STATEMENT_SUFFIX,b),I.INDENT)),b.hasReturnValue_?(b=I.valueToCode(b,"VALUE",P.NONE)||"null",L+=I.INDENT+"return "+b+`;
`):L+=I.INDENT+`return;
`,L+`}
`},si=function(b,I){return[I.quote_(b.getFieldValue("TEXT")),P.ATOMIC]},kt=function(b,I){switch(b.itemCount_){case 0:return["''",P.ATOMIC];case 1:return b=I.valueToCode(b,"ADD0",P.NONE)||"''",B(b);case 2:var L=I.valueToCode(b,"ADD0",P.NONE)||"''";return b=I.valueToCode(b,"ADD1",P.NONE)||"''",[B(L)[0]+" + "+B(b)[0],P.ADDITION];default:L=Array(b.itemCount_);for(let H=0;H<b.itemCount_;H++)L[H]=I.valueToCode(b,"ADD"+H,P.NONE)||"''";return["["+L.join(",")+"].join('')",P.FUNCTION_CALL]}},os=function(b,I){const L=I.getVariableName(b.getFieldValue("VAR"));return b=I.valueToCode(b,"TEXT",P.NONE)||"''",L+" += "+B(b)[0]+`;
`},ii=function(b,I){return[(I.valueToCode(b,"VALUE",P.MEMBER)||"''")+".length",P.MEMBER]},jt=function(b,I){return["!"+(I.valueToCode(b,"VALUE",P.MEMBER)||"''")+".length",P.LOGICAL_NOT]},Ut=function(b,I){const L=b.getFieldValue("END")==="FIRST"?"indexOf":"lastIndexOf",H=I.valueToCode(b,"FIND",P.NONE)||"''";return I=(I.valueToCode(b,"VALUE",P.MEMBER)||"''")+"."+L+"("+H+")",b.workspace.options.oneBasedIndex?[I+" + 1",P.ADDITION]:[I,P.FUNCTION_CALL]},qt=function(b,I){const L=b.getFieldValue("WHERE")||"FROM_START",H=I.valueToCode(b,"VALUE",L==="RANDOM"?P.NONE:P.MEMBER)||"''";switch(L){case"FIRST":return[H+".charAt(0)",P.FUNCTION_CALL];case"LAST":return[H+".slice(-1)",P.FUNCTION_CALL];case"FROM_START":return b=I.getAdjusted(b,"AT"),[H+".charAt("+b+")",P.FUNCTION_CALL];case"FROM_END":return b=I.getAdjusted(b,"AT",1,!0),[H+".slice("+b+").charAt(0)",P.FUNCTION_CALL];case"RANDOM":return[I.provideFunction_("textRandomLetter",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(text) {
  var x = Math.floor(Math.random() * text.length);
  return text[x];
}
`)+"("+H+")",P.FUNCTION_CALL]}throw Error("Unhandled option (text_charAt).")},lt=function(b,I){var L={FIRST:"First",LAST:"Last",FROM_START:"FromStart",FROM_END:"FromEnd"};const H=b.getFieldValue("WHERE1"),J=b.getFieldValue("WHERE2");var ce=H!=="FROM_END"&&H!=="LAST"&&J!=="FROM_END"&&J!=="LAST",ye=I.valueToCode(b,"STRING",ce?P.MEMBER:P.NONE)||"''";if(H==="FIRST"&&J==="LAST")return[ye,P.NONE];if(ye.match(/^'?\w+'?$/)||ce){switch(H){case"FROM_START":L=I.getAdjusted(b,"AT1");break;case"FROM_END":L=I.getAdjusted(b,"AT1",1,!1,P.SUBTRACTION),L=ye+".length - "+L;break;case"FIRST":L="0";break;default:throw Error("Unhandled option (text_getSubstring).")}switch(J){case"FROM_START":I=I.getAdjusted(b,"AT2",1);break;case"FROM_END":I=I.getAdjusted(b,"AT2",0,!1,P.SUBTRACTION),I=ye+".length - "+I;break;case"LAST":I=ye+".length";break;default:throw Error("Unhandled option (text_getSubstring).")}ye=ye+".slice("+L+", "+I+")"}else ce=I.getAdjusted(b,"AT1"),b=I.getAdjusted(b,"AT2"),ye=I.provideFunction_("subsequence"+L[H]+L[J],`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(sequence${H==="FROM_END"||H==="FROM_START"?", at1":""}${J==="FROM_END"||J==="FROM_START"?", at2":""}) {
  var start = ${F("sequence",H,"at1")};
  var end = ${F("sequence",J,"at2")} + 1;
  return sequence.slice(start, end);
}
`)+"("+ye+(H==="FROM_END"||H==="FROM_START"?", "+ce:"")+(J==="FROM_END"||J==="FROM_START"?", "+b:"")+")";return[ye,P.FUNCTION_CALL]},It=function(b,I){const L={UPPERCASE:".toUpperCase()",LOWERCASE:".toLowerCase()",TITLECASE:null}[b.getFieldValue("CASE")];return b=I.valueToCode(b,"TEXT",L?P.MEMBER:P.NONE)||"''",[L?b+L:I.provideFunction_("textToTitleCase",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(str) {
  return str.replace(/\\S+/g,
      function(txt) {return txt[0].toUpperCase() + txt.substring(1).toLowerCase();});
}
`)+"("+b+")",P.FUNCTION_CALL]},Cs=function(b,I){const L={LEFT:".replace(/^[\\s\\xa0]+/, '')",RIGHT:".replace(/[\\s\\xa0]+$/, '')",BOTH:".trim()"}[b.getFieldValue("MODE")];return[(I.valueToCode(b,"TEXT",P.MEMBER)||"''")+L,P.FUNCTION_CALL]},ws=function(b,I){return"window.alert("+(I.valueToCode(b,"TEXT",P.NONE)||"''")+`);
`},vi=function(b,I){return I="window.prompt("+(b.getField("TEXT")?I.quote_(b.getFieldValue("TEXT")):I.valueToCode(b,"TEXT",P.NONE)||"''")+")",b.getFieldValue("TYPE")==="NUMBER"&&(I="Number("+I+")"),[I,P.FUNCTION_CALL]},fe=function(b,I){const L=I.valueToCode(b,"TEXT",P.NONE)||"''";return b=I.valueToCode(b,"SUB",P.NONE)||"''",[I.provideFunction_("textCount",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle) {
  if (needle.length === 0) {
    return haystack.length + 1;
  } else {
    return haystack.split(needle).length - 1;
  }
}
`)+"("+L+", "+b+")",P.FUNCTION_CALL]},Xe=function(b,I){const L=I.valueToCode(b,"TEXT",P.NONE)||"''",H=I.valueToCode(b,"FROM",P.NONE)||"''";return b=I.valueToCode(b,"TO",P.NONE)||"''",[I.provideFunction_("textReplace",`
function ${I.FUNCTION_NAME_PLACEHOLDER_}(haystack, needle, replacement) {
  needle = needle.replace(/([-()\\[\\]{}+?*.$\\^|,:#<!\\\\])/g, '\\\\$1')
                 .replace(/\\x08/g, '\\\\x08');
  return haystack.replace(new RegExp(needle, 'g'), replacement);
}
`)+"("+L+", "+H+", "+b+")",P.FUNCTION_CALL]},Ue=function(b,I){return[(I.valueToCode(b,"TEXT",P.MEMBER)||"''")+".split('').reverse().join('')",P.FUNCTION_CALL]},Fs=function(b,I){return[I.getVariableName(b.getFieldValue("VAR")),P.ATOMIC]},Jt=function(b,I){const L=I.valueToCode(b,"VALUE",P.ASSIGNMENT)||"0";return I.getVariableName(b.getFieldValue("VAR"))+" = "+L+`;
`},P;(function(b){b[b.ATOMIC=0]="ATOMIC",b[b.NEW=1.1]="NEW",b[b.MEMBER=1.2]="MEMBER",b[b.FUNCTION_CALL=2]="FUNCTION_CALL",b[b.INCREMENT=3]="INCREMENT",b[b.DECREMENT=3]="DECREMENT",b[b.BITWISE_NOT=4.1]="BITWISE_NOT",b[b.UNARY_PLUS=4.2]="UNARY_PLUS",b[b.UNARY_NEGATION=4.3]="UNARY_NEGATION",b[b.LOGICAL_NOT=4.4]="LOGICAL_NOT",b[b.TYPEOF=4.5]="TYPEOF",b[b.VOID=4.6]="VOID",b[b.DELETE=4.7]="DELETE",b[b.AWAIT=4.8]="AWAIT",b[b.EXPONENTIATION=5]="EXPONENTIATION",b[b.MULTIPLICATION=5.1]="MULTIPLICATION",b[b.DIVISION=5.2]="DIVISION",b[b.MODULUS=5.3]="MODULUS",b[b.SUBTRACTION=6.1]="SUBTRACTION",b[b.ADDITION=6.2]="ADDITION",b[b.BITWISE_SHIFT=7]="BITWISE_SHIFT",b[b.RELATIONAL=8]="RELATIONAL",b[b.IN=8]="IN",b[b.INSTANCEOF=8]="INSTANCEOF",b[b.EQUALITY=9]="EQUALITY",b[b.BITWISE_AND=10]="BITWISE_AND",b[b.BITWISE_XOR=11]="BITWISE_XOR",b[b.BITWISE_OR=12]="BITWISE_OR",b[b.LOGICAL_AND=13]="LOGICAL_AND",b[b.LOGICAL_OR=14]="LOGICAL_OR",b[b.CONDITIONAL=15]="CONDITIONAL",b[b.ASSIGNMENT=16]="ASSIGNMENT",b[b.YIELD=17]="YIELD",b[b.COMMA=18]="COMMA",b[b.NONE=99]="NONE"})(P||(P={}));var ri=class extends r.CodeGenerator$$module$build$src$core$generator{constructor(b="JavaScript"){super(b),this.ORDER_OVERRIDES=[[P.FUNCTION_CALL,P.MEMBER],[P.FUNCTION_CALL,P.FUNCTION_CALL],[P.MEMBER,P.MEMBER],[P.MEMBER,P.FUNCTION_CALL],[P.LOGICAL_NOT,P.LOGICAL_NOT],[P.MULTIPLICATION,P.MULTIPLICATION],[P.ADDITION,P.ADDITION],[P.LOGICAL_AND,P.LOGICAL_AND],[P.LOGICAL_OR,P.LOGICAL_OR]],this.isInitialized=!1;for(const I in P)b=P[I],typeof b!="string"&&(this["ORDER_"+I]=b);this.addReservedWords("break,case,catch,class,const,continue,debugger,default,delete,do,else,export,extends,finally,for,function,if,import,in,instanceof,new,return,super,switch,this,throw,try,typeof,var,void,while,with,yield,enum,implements,interface,let,package,private,protected,public,static,await,null,true,false,arguments,"+Object.getOwnPropertyNames(globalThis).join(","))}init(b){super.init(b),this.nameDB_?this.nameDB_.reset():this.nameDB_=new r.Names$$module$build$src$core$names(this.RESERVED_WORDS_),this.nameDB_.setVariableMap(b.getVariableMap()),this.nameDB_.populateVariables(b),this.nameDB_.populateProcedures(b);const I=[];var L=r.allDeveloperVariables$$module$build$src$core$variables(b);for(let H=0;H<L.length;H++)I.push(this.nameDB_.getName(L[H],r.NameType$$module$build$src$core$names.DEVELOPER_VARIABLE));for(b=r.allUsedVarModels$$module$build$src$core$variables(b),L=0;L<b.length;L++)I.push(this.nameDB_.getName(b[L].getId(),r.NameType$$module$build$src$core$names.VARIABLE));I.length&&(this.definitions_.variables="var "+I.join(", ")+";"),this.isInitialized=!0}finish(b){const I=Object.values(this.definitions_);return super.finish(b),this.isInitialized=!1,this.nameDB_.reset(),I.join(`

`)+`


`+b}scrubNakedValue(b){return b+`;
`}quote_(b){return b=b.replace(/\\/g,"\\\\").replace(/\n/g,`\\
`).replace(/'/g,"\\'"),"'"+b+"'"}multiline_quote_(b){return b.split(/\n/g).map(this.quote_).join(` + '\\n' +
`)}scrub_(b,I,L=!1){let H="";if(!b.outputConnection||!b.outputConnection.targetConnection){var J=b.getCommentText();J&&(J=r.wrap$$module$build$src$core$utils$string(J,this.COMMENT_WRAP-3),H+=this.prefixLines(J+`
`,"// "));for(let ce=0;ce<b.inputList.length;ce++)b.inputList[ce].type===r.inputTypes$$module$build$src$core$inputs$input_types.VALUE&&(J=b.inputList[ce].connection.targetBlock())&&(J=this.allNestedComments(J))&&(H+=this.prefixLines(J,"// "))}return b=b.nextConnection&&b.nextConnection.targetBlock(),L=L?"":this.blockToCode(b),H+I+L}getAdjusted(b,I,L=0,H=!1,J=P.NONE){b.workspace.options.oneBasedIndex&&L--;const ce=b.workspace.options.oneBasedIndex?"1":"0";let ye=J;return 0<L?ye=P.ADDITION:0>L?ye=P.SUBTRACTION:H&&(ye=P.UNARY_NEGATION),b=this.valueToCode(b,I,ye)||ce,L===0&&!H?b:r.isNumber$$module$build$src$core$utils$string(b)?(b=String(Number(b)+L),H&&(b=String(-Number(b))),b):(0<L?b=`${b} + ${L}`:0>L&&(b=`${b} - ${-L}`),H&&(b=L?`-(${b})`:`-${b}`),Math.floor(J)>=Math.floor(ye)&&(b=`(${b})`),b)}},$t=function(b,I,L){return I==="FIRST"?"0":I==="FROM_END"?b+".length - 1 - "+L:I==="LAST"?b+".length - 1":L},tt={};tt.lists_create_empty=o,tt.lists_create_with=a,tt.lists_getIndex=g,tt.lists_getSublist=$,tt.lists_indexOf=f,tt.lists_isEmpty=p,tt.lists_length=u,tt.lists_repeat=h,tt.lists_reverse=w,tt.lists_setIndex=_,tt.lists_sort=E,tt.lists_split=v;var Zt={};Zt.controls_if=x,Zt.controls_ifelse=x,Zt.logic_boolean=D,Zt.logic_compare=C,Zt.logic_negate=A,Zt.logic_null=G,Zt.logic_operation=R,Zt.logic_ternary=M;var Y={};Y.controls_flow_statements=ie,Y.controls_for=se,Y.controls_forEach=Q,Y.controls_repeat=k,Y.controls_repeat_ext=k,Y.controls_whileUntil=z;var re={};re.math_arithmetic=ge,re.math_atan2=fs,re.math_change=be,re.math_constant=St,re.math_constrain=pt,re.math_modulo=Ne,re.math_number=_e,re.math_number_property=pe,re.math_on_list=he,re.math_random_float=ps,re.math_random_int=Kt,re.math_round=ue,re.math_single=ue,re.math_trig=ue;var T={};T.procedures_callnoreturn=qe,T.procedures_callreturn=Ft,T.procedures_defnoreturn=gt,T.procedures_defreturn=gt,T.procedures_ifreturn=xs;var S=/^\s*'([^']|\\')*'\s*$/,B=function(b){return S.test(b)?[b,P.ATOMIC]:["String("+b+")",P.FUNCTION_CALL]},F=function(b,I,L){return I==="FIRST"?"0":I==="FROM_END"?b+".length - 1 - "+L:I==="LAST"?b+".length - 1":L},ee={};ee.text=si,ee.text_append=os,ee.text_changeCase=It,ee.text_charAt=qt,ee.text_count=fe,ee.text_getSubstring=lt,ee.text_indexOf=Ut,ee.text_isEmpty=jt,ee.text_join=kt,ee.text_length=ii,ee.text_print=ws,ee.text_prompt=vi,ee.text_prompt_ext=vi,ee.text_replace=Xe,ee.text_reverse=Ue,ee.text_trim=Cs;var Ye={};Ye.variables_get=Fs,Ye.variables_set=Jt;var Gt={};Gt.variables_get_dynamic=Fs,Gt.variables_set_dynamic=Jt;var ni=new ri,dn=Object.assign({},tt,Zt,Y,re,T,ee,Ye,Gt);for(const b in dn)ni.forBlock[b]=dn[b];var Us={};return Us.JavascriptGenerator=ri,Us.Order=P,Us.javascriptGenerator=ni,Us.__namespace__=r,Us})})(hv);var jC=hv.exports;const qC=co(jC),{JavascriptGenerator:zV,Order:XV,javascriptGenerator:Bt}=qC;var uv={exports:{}};(function(l,t){(function(s,r){l.exports=r(_g)})(nn,function(s){var r=s.__namespace__,o=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get_dynamic",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_dynamic_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableDynamicSetterGetter"]},{type:"variables_set_dynamic",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_dynamic_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableDynamicSetterGetter"]}]),a={customContextMenu:function(T){if(this.isInFlyout)(this.type==="variables_get_dynamic"||this.type==="variables_get_reporter_dynamic")&&(B={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:h(this)},F=this.getField("VAR").getText(),F={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",F),enabled:!0,callback:u(this)},T.unshift(B),T.unshift(F));else{if(this.type==="variables_get_dynamic")var S="variables_set_dynamic",B=r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else S="variables_get_dynamic",B=r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var F=this.getField("VAR");S={type:S,fields:{VAR:F.saveState(!0)}},T.push({enabled:0<this.workspace.remainingCapacity(),text:B.replace("%1",F.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,S)})}},onchange:function(T){T=this.getFieldValue("VAR"),T=r.getVariable$$module$build$src$core$variables(this.workspace,T),this.type==="variables_get_dynamic"?this.outputConnection.setCheck(T.type):this.getInput("VALUE").connection.setCheck(T.type)}},h=function(T){return function(){const S=T.workspace,B=T.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(S,B)}},u=function(T){return function(){const S=T.workspace,B=T.getField("VAR").getVariable();S.deleteVariableById(B.getId()),S.refreshToolboxSelection()}};r.registerMixin$$module$build$src$core$extensions("contextMenu_variableDynamicSetterGetter",a),r.defineBlocks$$module$build$src$core$common(o);var p={blocks:o},f=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"variables_get",message0:"%1",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"}],output:null,style:"variable_blocks",helpUrl:"%{BKY_VARIABLES_GET_HELPURL}",tooltip:"%{BKY_VARIABLES_GET_TOOLTIP}",extensions:["contextMenu_variableSetterGetter"]},{type:"variables_set",message0:"%{BKY_VARIABLES_SET}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_VARIABLES_DEFAULT_NAME}"},{type:"input_value",name:"VALUE"}],previousStatement:null,nextStatement:null,style:"variable_blocks",tooltip:"%{BKY_VARIABLES_SET_TOOLTIP}",helpUrl:"%{BKY_VARIABLES_SET_HELPURL}",extensions:["contextMenu_variableSetterGetter"]}]),g={customContextMenu:function(T){if(this.isInFlyout)(this.type==="variables_get"||this.type==="variables_get_reporter")&&(B={text:r.Msg$$module$build$src$core$msg.RENAME_VARIABLE,enabled:!0,callback:_(this)},F=this.getField("VAR").getText(),F={text:r.Msg$$module$build$src$core$msg.DELETE_VARIABLE.replace("%1",F),enabled:!0,callback:$(this)},T.unshift(B),T.unshift(F));else{if(this.type==="variables_get")var S="variables_set",B=r.Msg$$module$build$src$core$msg.VARIABLES_GET_CREATE_SET;else S="variables_get",B=r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET;var F=this.getField("VAR");S={type:S,fields:{VAR:F.saveState(!0)}},T.push({enabled:0<this.workspace.remainingCapacity(),text:B.replace("%1",F.getText()),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,S)})}}},_=function(T){return function(){const S=T.workspace,B=T.getField("VAR").getVariable();r.renameVariable$$module$build$src$core$variables(S,B)}},$=function(T){return function(){const S=T.workspace,B=T.getField("VAR").getVariable();S.deleteVariableById(B.getId()),S.refreshToolboxSelection()}};r.registerMixin$$module$build$src$core$extensions("contextMenu_variableSetterGetter",g),r.defineBlocks$$module$build$src$core$common(f);var E={blocks:f},v=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"text",message0:"%1",args0:[{type:"field_input",name:"TEXT",text:""}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_TEXT_HELPURL}",tooltip:"%{BKY_TEXT_TEXT_TOOLTIP}",extensions:["text_quotes","parent_tooltip_when_inline"]},{type:"text_join",message0:"",output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_JOIN_HELPURL}",tooltip:"%{BKY_TEXT_JOIN_TOOLTIP}",mutator:"text_join_mutator"},{type:"text_create_join_container",message0:"%{BKY_TEXT_CREATE_JOIN_TITLE_JOIN} %1 %2",args0:[{type:"input_dummy"},{type:"input_statement",name:"STACK"}],style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_TOOLTIP}",enableContextMenu:!1},{type:"text_create_join_item",message0:"%{BKY_TEXT_CREATE_JOIN_ITEM_TITLE_ITEM}",previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:"%{BKY_TEXT_CREATE_JOIN_ITEM_TOOLTIP}",enableContextMenu:!1},{type:"text_append",message0:"%{BKY_TEXT_APPEND_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_TEXT_APPEND_VARIABLE}"},{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",extensions:["text_append_tooltip"]},{type:"text_length",message0:"%{BKY_TEXT_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"text_blocks",tooltip:"%{BKY_TEXT_LENGTH_TOOLTIP}",helpUrl:"%{BKY_TEXT_LENGTH_HELPURL}"},{type:"text_isEmpty",message0:"%{BKY_TEXT_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"text_blocks",tooltip:"%{BKY_TEXT_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_TEXT_ISEMPTY_HELPURL}"},{type:"text_indexOf",message0:"%{BKY_TEXT_INDEXOF_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"END",options:[["%{BKY_TEXT_INDEXOF_OPERATOR_FIRST}","FIRST"],["%{BKY_TEXT_INDEXOF_OPERATOR_LAST}","LAST"]]},{type:"input_value",name:"FIND",check:"String"}],output:"Number",style:"text_blocks",helpUrl:"%{BKY_TEXT_INDEXOF_HELPURL}",inputsInline:!0,extensions:["text_indexOf_tooltip"]},{type:"text_charAt",message0:"%{BKY_TEXT_CHARAT_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"String"},{type:"field_dropdown",name:"WHERE",options:[["%{BKY_TEXT_CHARAT_FROM_START}","FROM_START"],["%{BKY_TEXT_CHARAT_FROM_END}","FROM_END"],["%{BKY_TEXT_CHARAT_FIRST}","FIRST"],["%{BKY_TEXT_CHARAT_LAST}","LAST"],["%{BKY_TEXT_CHARAT_RANDOM}","RANDOM"]]}],output:"String",style:"text_blocks",helpUrl:"%{BKY_TEXT_CHARAT_HELPURL}",inputsInline:!0,mutator:"text_charAt_mutator"}]),w={init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("STRING").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT);const T=S=>{const B=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+S]});return B.setValidator(function(F){const ee=this.getValue();F=F==="FROM_START"||F==="FROM_END",F!==(ee==="FROM_START"||ee==="FROM_END")&&this.getSourceBlock().updateAt_(S,F)}),B};this.appendDummyInput("WHERE1_INPUT").appendField(T(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(T(2),"WHERE2"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL),this.setInputsInline(!0),this.setOutput(!0,"String"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TOOLTIP)},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");var S=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return T.setAttribute("at1",`${S}`),S=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,T.setAttribute("at2",`${S}`),T},domToMutation:function(T){const S=T.getAttribute("at1")==="true";T=T.getAttribute("at2")==="true",this.updateAt_(1,S),this.updateAt_(2,T)},updateAt_:function(T,S){this.removeInput("AT"+T),this.removeInput("ORDINAL"+T,!0),S?(this.appendValueInput("AT"+T).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+T).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+T),T===2&&r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_GET_SUBSTRING_TAIL)),T===1&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT"))}};v.text_getSubstring=w,v.text_changeCase={init:function(){const T=[[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE,"UPPERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE,"LOWERCASE"],[r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_OPERATOR_TITLECASE,"TITLECASE"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),"CASE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_CHANGECASE_TOOLTIP)}},v.text_trim={init:function(){const T=[[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_BOTH,"BOTH"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_LEFT,"LEFT"],[r.Msg$$module$build$src$core$msg.TEXT_TRIM_OPERATOR_RIGHT,"RIGHT"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_TRIM_HELPURL),this.setStyle("text_blocks"),this.appendValueInput("TEXT").setCheck("String").appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),"MODE"),this.setOutput(!0,"String"),this.setTooltip(r.Msg$$module$build$src$core$msg.TEXT_TRIM_TOOLTIP)}},v.text_print={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TITLE,args0:[{type:"input_value",name:"TEXT"}],previousStatement:null,nextStatement:null,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_PRINT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_PRINT_HELPURL})}};var x={updateType_:function(T){this.outputConnection.setCheck(T==="NUMBER"?"Number":"String")},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("type",this.getFieldValue("TYPE")),T},domToMutation:function(T){this.updateType_(T.getAttribute("type"))}};v.text_prompt_ext=Object.assign({},x,{init:function(){var T=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),T.setValidator(S=>{this.updateType_(S)}),this.appendValueInput("TEXT").appendField(T,"TYPE"),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),v.text_prompt=Object.assign({},x,{init:function(){this.mixin(C);var T=[[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_TEXT,"TEXT"],[r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TYPE_NUMBER,"NUMBER"]];this.setHelpUrl(r.Msg$$module$build$src$core$msg.TEXT_PROMPT_HELPURL),this.setStyle("text_blocks"),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),T.setValidator(S=>{this.updateType_(S)}),this.appendDummyInput().appendField(T,"TYPE").appendField(this.newQuote_(!0)).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:""}),"TEXT").appendField(this.newQuote_(!1)),this.setOutput(!0,"String"),this.setTooltip(()=>this.getFieldValue("TYPE")==="TEXT"?r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_TEXT:r.Msg$$module$build$src$core$msg.TEXT_PROMPT_TOOLTIP_NUMBER)}}),v.text_count={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_COUNT_MESSAGE0,args0:[{type:"input_value",name:"SUB",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"Number",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_COUNT_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_COUNT_HELPURL})}},v.text_replace={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_MESSAGE0,args0:[{type:"input_value",name:"FROM",check:"String"},{type:"input_value",name:"TO",check:"String"},{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REPLACE_HELPURL})}},v.text_reverse={init:function(){this.jsonInit({message0:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_MESSAGE0,args0:[{type:"input_value",name:"TEXT",check:"String"}],output:"String",inputsInline:!0,style:"text_blocks",tooltip:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_TOOLTIP,helpUrl:r.Msg$$module$build$src$core$msg.TEXT_REVERSE_HELPURL})}};var C={QUOTE_IMAGE_LEFT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAn0lEQVQI1z3OMa5BURSF4f/cQhAKjUQhuQmFNwGJEUi0RKN5rU7FHKhpjEH3TEMtkdBSCY1EIv8r7nFX9e29V7EBAOvu7RPjwmWGH/VuF8CyN9/OAdvqIXYLvtRaNjx9mMTDyo+NjAN1HNcl9ZQ5oQMM3dgDUqDo1l8DzvwmtZN7mnD+PkmLa+4mhrxVA9fRowBWmVBhFy5gYEjKMfz9AylsaRRgGzvZAAAAAElFTkSuQmCC",QUOTE_IMAGE_RIGHT_DATAURI:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAKCAQAAAAqJXdxAAAAqUlEQVQI1z3KvUpCcRiA8ef9E4JNHhI0aFEacm1o0BsI0Slx8wa8gLauoDnoBhq7DcfWhggONDmJJgqCPA7neJ7p934EOOKOnM8Q7PDElo/4x4lFb2DmuUjcUzS3URnGib9qaPNbuXvBO3sGPHJDRG6fGVdMSeWDP2q99FQdFrz26Gu5Tq7dFMzUvbXy8KXeAj57cOklgA+u1B5AoslLtGIHQMaCVnwDnADZIFIrXsoXrgAAAABJRU5ErkJggg==",QUOTE_IMAGE_WIDTH:12,QUOTE_IMAGE_HEIGHT:12,quoteField_:function(T){for(let S=0,B;B=this.inputList[S];S++)for(let F=0,ee;ee=B.fieldRow[F];F++)if(T===ee.name){B.insertFieldAt(F,this.newQuote_(!0)),B.insertFieldAt(F+2,this.newQuote_(!1));return}console.warn('field named "'+T+'" not found in '+this.toDevString())},newQuote_:function(T){return T=this.RTL?!T:T,r.fromJson$$module$build$src$core$field_registry({type:"field_image",src:T?this.QUOTE_IMAGE_LEFT_DATAURI:this.QUOTE_IMAGE_RIGHT_DATAURI,width:this.QUOTE_IMAGE_WIDTH,height:this.QUOTE_IMAGE_HEIGHT,alt:T?"“":"”"})}},R=function(){this.mixin(C),this.quoteField_("TEXT")},A={itemCount_:0,mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("items",`${this.itemCount_}`),T},domToMutation:function(T){this.itemCount_=parseInt(T.getAttribute("items"),10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(T){this.itemCount_=T.itemCount,this.updateShape_()},decompose:function(T){const S=T.newBlock("text_create_join_container");S.initSvg();let B=S.getInput("STACK").connection;for(let F=0;F<this.itemCount_;F++){const ee=T.newBlock("text_create_join_item");ee.initSvg(),B.connect(ee.previousConnection),B=ee.nextConnection}return S},compose:function(T){var S=T.getInputTargetBlock("STACK");for(T=[];S;)S.isInsertionMarker()||T.push(S.valueConnection_),S=S.getNextBlock();for(S=0;S<this.itemCount_;S++){const B=this.getInput("ADD"+S).connection.targetConnection;B&&!T.includes(B)&&B.disconnect()}for(this.itemCount_=T.length,this.updateShape_(),S=0;S<this.itemCount_;S++){let B;(B=T[S])==null||B.reconnect(this,"ADD"+S)}},saveConnections:function(T){T=T.getInputTargetBlock("STACK");let S=0;for(;T;){if(T.isInsertionMarker()){T=T.getNextBlock();continue}const B=this.getInput("ADD"+S);T.valueConnection_=B&&B.connection.targetConnection,T=T.getNextBlock(),S++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(this.newQuote_(!0)).appendField(this.newQuote_(!1));for(var T=0;T<this.itemCount_;T++)if(!this.getInput("ADD"+T)){const S=this.appendValueInput("ADD"+T).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT);T===0&&S.appendField(r.Msg$$module$build$src$core$msg.TEXT_JOIN_TITLE_CREATEWITH)}for(T=this.itemCount_;this.getInput("ADD"+T);T++)this.removeInput("ADD"+T)}},D=function(){this.mixin(C),this.itemCount_=2,this.updateShape_(),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["text_create_join_item"],this))};r.register$$module$build$src$core$extensions("text_append_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_TEXT_APPEND_TOOLTIP}","VAR"));var G=function(){this.setTooltip(()=>r.Msg$$module$build$src$core$msg.TEXT_INDEXOF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))},M={isAt_:!1,mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("at",`${this.isAt_}`),T},domToMutation:function(T){T=T.getAttribute("at")!=="false",this.updateAt_(T)},updateAt_:function(T){this.removeInput("AT",!0),this.removeInput("ORDINAL",!0),T&&(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)),r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL&&(this.removeInput("TAIL",!0),this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TAIL)),this.isAt_=T}},k=function(){this.getField("WHERE").setValidator(function(T){T=T==="FROM_START"||T==="FROM_END";const S=this.getSourceBlock();T!==S.isAt_&&S.updateAt_(T)}),this.updateAt_(!0),this.setTooltip(()=>{var T=this.getFieldValue("WHERE");let S=r.Msg$$module$build$src$core$msg.TEXT_CHARAT_TOOLTIP;return(T==="FROM_START"||T==="FROM_END")&&(T=T==="FROM_START"?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP)&&(S+="  "+T.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),S})};r.register$$module$build$src$core$extensions("text_indexOf_tooltip",G),r.register$$module$build$src$core$extensions("text_quotes",R),r.registerMixin$$module$build$src$core$extensions("quote_image_mixin",C),r.registerMutator$$module$build$src$core$extensions("text_join_mutator",A,D),r.registerMutator$$module$build$src$core$extensions("text_charAt_mutator",M,k),r.defineBlocks$$module$build$src$core$common(v);var z={blocks:v},se={},Q={setStatements_:function(T){this.hasStatements_!==T&&(T?(this.appendStatementInput("STACK").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_DO),this.getInput("RETURN")&&this.moveInputBefore("STACK","RETURN")):this.removeInput("STACK",!0),this.hasStatements_=T)},updateParams_:function(){let T="";this.arguments_.length&&(T=r.Msg$$module$build$src$core$msg.PROCEDURES_BEFORE_PARAMS+" "+this.arguments_.join(", ")),r.disable$$module$build$src$core$events$utils();try{this.setFieldValue(T,"PARAMS")}finally{r.enable$$module$build$src$core$events$utils()}},mutationToDom:function(T){const S=r.createElement$$module$build$src$core$utils$xml("mutation");T&&S.setAttribute("name",this.getFieldValue("NAME"));for(let B=0;B<this.argumentVarModels_.length;B++){const F=r.createElement$$module$build$src$core$utils$xml("arg"),ee=this.argumentVarModels_[B];F.setAttribute("name",ee.name),F.setAttribute("varid",ee.getId()),T&&this.paramIds_&&F.setAttribute("paramId",this.paramIds_[B]),S.appendChild(F)}return this.hasStatements_||S.setAttribute("statements","false"),S},domToMutation:function(T){this.arguments_=[],this.argumentVarModels_=[];for(let B=0,F;F=T.childNodes[B];B++)if(F.nodeName.toLowerCase()==="arg"){var S=F;const ee=S.getAttribute("name");S=S.getAttribute("varid")||S.getAttribute("varId"),this.arguments_.push(ee),S=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,S,ee,""),S!==null?this.argumentVarModels_.push(S):console.log(`Failed to create a variable named "${ee}", ignoring.`)}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(T.getAttribute("statements")!=="false")},saveExtraState:function(){if(!this.argumentVarModels_.length&&this.hasStatements_)return null;const T=Object.create(null);if(this.argumentVarModels_.length){T.params=[];for(let S=0;S<this.argumentVarModels_.length;S++)T.params.push({name:this.argumentVarModels_[S].name,id:this.argumentVarModels_[S].getId()})}return this.hasStatements_||(T.hasStatements=!1),T},loadExtraState:function(T){if(this.arguments_=[],this.argumentVarModels_=[],T.params)for(let B=0;B<T.params.length;B++){var S=T.params[B];S=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,S.id,S.name,""),this.arguments_.push(S.name),this.argumentVarModels_.push(S)}this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),this.setStatements_(T.hasStatements!==!1)},decompose:function(T){const S=r.createElement$$module$build$src$core$utils$xml("block");S.setAttribute("type","procedures_mutatorcontainer");var B=r.createElement$$module$build$src$core$utils$xml("statement");B.setAttribute("name","STACK"),S.appendChild(B);for(let ee=0;ee<this.arguments_.length;ee++){const Ye=r.createElement$$module$build$src$core$utils$xml("block");Ye.setAttribute("type","procedures_mutatorarg");var F=r.createElement$$module$build$src$core$utils$xml("field");F.setAttribute("name","NAME");const Gt=r.createTextNode$$module$build$src$core$utils$xml(this.arguments_[ee]);F.appendChild(Gt),Ye.appendChild(F),F=r.createElement$$module$build$src$core$utils$xml("next"),Ye.appendChild(F),B.appendChild(Ye),B=F}return T=r.domToBlock$$module$build$src$core$xml(S,T),this.type==="procedures_defreturn"?T.setFieldValue(this.hasStatements_,"STATEMENTS"):T.removeInput("STATEMENT_INPUT"),r.mutateCallers$$module$build$src$core$procedures(this),T},compose:function(T){this.arguments_=[],this.paramIds_=[],this.argumentVarModels_=[];let S=T.getInputTargetBlock("STACK");for(;S&&!S.isInsertionMarker();){var B=S.getFieldValue("NAME");this.arguments_.push(B),B=this.workspace.getVariable(B,""),this.argumentVarModels_.push(B),this.paramIds_.push(S.id),S=S.nextConnection&&S.nextConnection.targetBlock()}if(this.updateParams_(),r.mutateCallers$$module$build$src$core$procedures(this),T=T.getFieldValue("STATEMENTS"),T!==null&&(T=T==="TRUE",this.hasStatements_!==T))if(T){this.setStatements_(!0);var F;(F=this.statementConnection_)==null||F.reconnect(this,"STACK"),this.statementConnection_=null}else F=this.getInput("STACK").connection,(this.statementConnection_=F.targetConnection)&&(F=F.targetBlock(),F.unplug(),F.bumpNeighbours()),this.setStatements_(!1)},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},renameVarById:function(T,S){var B=this.workspace.getVariableById(T);if(B.type===""){B=B.name,S=this.workspace.getVariableById(S);var F=!1;for(let ee=0;ee<this.argumentVarModels_.length;ee++)this.argumentVarModels_[ee].getId()===T&&(this.arguments_[ee]=S.name,this.argumentVarModels_[ee]=S,F=!0);F&&(this.displayRenamedVar_(B,S.name),r.mutateCallers$$module$build$src$core$procedures(this))}},updateVarName:function(T){const S=T.name;let B=!1,F;for(let ee=0;ee<this.argumentVarModels_.length;ee++)this.argumentVarModels_[ee].getId()===T.getId()&&(F=this.arguments_[ee],this.arguments_[ee]=S,B=!0);B&&(this.displayRenamedVar_(F,S),r.mutateCallers$$module$build$src$core$procedures(this))},displayRenamedVar_:function(T,S){this.updateParams_();var B=this.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE);if(B&&B.bubbleIsVisible()){B=B.getWorkspace().getAllBlocks(!1);for(let F=0,ee;ee=B[F];F++)ee.type==="procedures_mutatorarg"&&r.Names$$module$build$src$core$names.equals(T,ee.getFieldValue("NAME"))&&ee.setFieldValue(S,"NAME")}},customContextMenu:function(T){if(!this.isInFlyout){var S=this.getFieldValue("NAME"),B={type:this.callType_,extraState:{name:S,params:this.arguments_}};if(T.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_CREATE_DO.replace("%1",S),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,B)}),!this.isCollapsed())for(S=0;S<this.argumentVarModels_.length;S++){B=this.argumentVarModels_[S];const F={type:"variables_get",fields:{VAR:{name:B.name,id:B.getId(),type:B.type}}};T.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",B.name),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,F)})}}}};se.procedures_defnoreturn=Object.assign({},Q,{init:function(){var T=r.findLegalName$$module$build$src$core$procedures("",this);T=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:T}),T.setValidator(r.rename$$module$build$src$core$procedures),T.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TITLE).appendField(T,"NAME").appendField("","PARAMS"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!1]},callType_:"procedures_callnoreturn"}),se.procedures_defreturn=Object.assign({},Q,{init:function(){var T=r.findLegalName$$module$build$src$core$procedures("",this);T=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:T}),T.setValidator(r.rename$$module$build$src$core$procedures),T.setSpellcheck(!1),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TITLE).appendField(T,"NAME").appendField("","PARAMS"),this.appendValueInput("RETURN").setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["procedures_mutatorarg"],this)),(this.workspace.options.comments||this.workspace.options.parentWorkspace&&this.workspace.options.parentWorkspace.options.comments)&&r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT&&this.setCommentText(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_COMMENT),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.setStatements_(!0),this.statementConnection_=null},getProcedureDef:function(){return[this.getFieldValue("NAME"),this.arguments_,!0]},callType_:"procedures_callreturn"});var ie={init:function(){this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TITLE),this.appendStatementInput("STACK"),this.appendDummyInput("STATEMENT_INPUT").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_ALLOW_STATEMENTS).appendField(r.fromJson$$module$build$src$core$field_registry({type:"field_checkbox",checked:!0}),"STATEMENTS"),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP),this.contextMenu=!1}};se.procedures_mutatorcontainer=ie;var _e={init:function(){const T=r.fromJson$$module$build$src$core$field_registry({type:"field_input",text:r.DEFAULT_ARG$$module$build$src$core$procedures});T.setValidator(this.validator_),T.oldShowEditorFn_=T.showEditor_,T.showEditor_=function(){this.createdVariables_=[],this.oldShowEditorFn_()},this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TITLE).appendField(T,"NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_MUTATORARG_TOOLTIP),this.contextMenu=!1,T.onFinishEditing_=this.deleteIntermediateVars_,T.createdVariables_=[],T.onFinishEditing_("x")},validator_:function(T){var S=this.getSourceBlock();const B=S.workspace.getRootWorkspace();if(T=T.replace(/[\s\xa0]+/g," ").replace(/^ | $/g,""),!T)return null;const F=(S.workspace.targetWorkspace||S.workspace).getAllBlocks(!1),ee=T.toLowerCase();for(let Ye=0;Ye<F.length;Ye++){if(F[Ye].id===this.getSourceBlock().id)continue;const Gt=F[Ye].getFieldValue("NAME");if(Gt&&Gt.toLowerCase()===ee)return null}return S.isInFlyout||((S=B.getVariable(T,""))&&S.name!==T&&B.renameVariableById(S.getId(),T),S||(S=B.createVariable(T,""))&&this.createdVariables_&&this.createdVariables_.push(S)),T},deleteIntermediateVars_:function(T){const S=this.getSourceBlock().workspace.getRootWorkspace();if(S)for(let B=0;B<this.createdVariables_.length;B++){const F=this.createdVariables_[B];F.name!==T&&S.deleteVariableById(F.getId())}}};se.procedures_mutatorarg=_e;var ge="DISABLED_PROCEDURE_DEFINITION",ue={getProcedureCall:function(){return this.getFieldValue("NAME")},renameProcedure:function(T,S){r.Names$$module$build$src$core$names.equals(T,this.getProcedureCall())&&(this.setFieldValue(S,"NAME"),this.setTooltip((this.outputConnection?r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_TOOLTIP:r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_TOOLTIP).replace("%1",S)))},setProcedureParameters_:function(T,S){var B=r.getDefinition$$module$build$src$core$procedures(this.getProcedureCall(),this.workspace);if((B=(B=B&&B.getIcon(r.MutatorIcon$$module$build$src$core$icons$mutator_icon.TYPE))&&B.bubbleIsVisible())?this.setCollapsed(!1):(this.quarkConnections_={},this.quarkIds_=null),T.join(`
`)===this.arguments_.join(`
`))this.quarkIds_=S;else{if(S.length!==T.length)throw RangeError("paramNames and paramIds must be the same length.");this.quarkIds_||(this.quarkConnections_={},this.quarkIds_=[]);for(let ee=0;ee<this.arguments_.length;ee++){var F=this.getInput("ARG"+ee);F&&(F=F.connection.targetConnection,this.quarkConnections_[this.quarkIds_[ee]]=F,B&&F&&!S.includes(this.quarkIds_[ee])&&(F.disconnect(),F.getSourceBlock().bumpNeighbours()))}for(this.arguments_=[].concat(T),this.argumentVarModels_=[],T=0;T<this.arguments_.length;T++)B=r.getOrCreateVariablePackage$$module$build$src$core$variables(this.workspace,null,this.arguments_[T],""),this.argumentVarModels_.push(B);if(this.updateShape_(),this.quarkIds_=S){for(S=0;S<this.arguments_.length;S++)if(T=this.quarkIds_[S],T in this.quarkConnections_){let ee;(ee=this.quarkConnections_[T])!=null&&ee.reconnect(this,"ARG"+S)||delete this.quarkConnections_[T]}}}},updateShape_:function(){for(var T=0;T<this.arguments_.length;T++){var S=this.getField("ARGNAME"+T);if(S){r.disable$$module$build$src$core$events$utils();try{S.setValue(this.arguments_[T])}finally{r.enable$$module$build$src$core$events$utils()}}else S=r.fromJson$$module$build$src$core$field_registry({type:"field_label",text:this.arguments_[T]}),this.appendValueInput("ARG"+T).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT).appendField(S,"ARGNAME"+T)}for(T=this.arguments_.length;this.getInput("ARG"+T);T++)this.removeInput("ARG"+T);(T=this.getInput("TOPROW"))&&(this.arguments_.length?this.getField("WITH")||T.appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_BEFORE_PARAMS,"WITH"):this.getField("WITH")&&T.removeField("WITH"))},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");T.setAttribute("name",this.getProcedureCall());for(let S=0;S<this.arguments_.length;S++){const B=r.createElement$$module$build$src$core$utils$xml("arg");B.setAttribute("name",this.arguments_[S]),T.appendChild(B)}return T},domToMutation:function(T){var S=T.getAttribute("name");this.renameProcedure(this.getProcedureCall(),S),S=[];const B=[];for(let F=0,ee;ee=T.childNodes[F];F++)ee.nodeName.toLowerCase()==="arg"&&(S.push(ee.getAttribute("name")),B.push(ee.getAttribute("paramId")));this.setProcedureParameters_(S,B)},saveExtraState:function(){const T=Object.create(null);return T.name=this.getProcedureCall(),this.arguments_.length&&(T.params=this.arguments_),T},loadExtraState:function(T){if(this.renameProcedure(this.getProcedureCall(),T.name),T=T.params){const S=[];S.length=T.length,S.fill(null),this.setProcedureParameters_(T,S)}},getVars:function(){return this.arguments_},getVarModels:function(){return this.argumentVarModels_},onchange:function(T){if(this.workspace&&!this.workspace.isFlyout&&T.recordUndo)if(T.type===r.BLOCK_CREATE$$module$build$src$core$events$events&&T.ids.includes(this.id)){var S=this.getProcedureCall(),B=r.getDefinition$$module$build$src$core$procedures(S,this.workspace);if(!B||B.type===this.defType_&&JSON.stringify(B.getVars())===JSON.stringify(this.arguments_)||(B=null),B)B.isEnabled()||(this.setDisabledReason(!0,ge),this.setWarningText(r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",S)));else{r.setGroup$$module$build$src$core$events$utils(T.group),T=r.createElement$$module$build$src$core$utils$xml("xml"),S=r.createElement$$module$build$src$core$utils$xml("block"),S.setAttribute("type",this.defType_),B=this.getRelativeToSurfaceXY();var F=B.y+2*r.config$$module$build$src$core$config.snapRadius;S.setAttribute("x",`${B.x+r.config$$module$build$src$core$config.snapRadius*(this.RTL?-1:1)}`),S.setAttribute("y",`${F}`),B=this.mutationToDom(),S.appendChild(B),B=r.createElement$$module$build$src$core$utils$xml("field"),B.setAttribute("name","NAME"),F=this.getProcedureCall();const ee=r.findLegalName$$module$build$src$core$procedures(F,this);F!==ee&&this.renameProcedure(F,ee),B.appendChild(r.createTextNode$$module$build$src$core$utils$xml(F)),S.appendChild(B),T.appendChild(S),r.domToWorkspace$$module$build$src$core$xml(T,this.workspace),r.setGroup$$module$build$src$core$events$utils(!1)}}else T.type===r.BLOCK_DELETE$$module$build$src$core$events$events?(S=this.getProcedureCall(),r.getDefinition$$module$build$src$core$procedures(S,this.workspace)||(r.setGroup$$module$build$src$core$events$utils(T.group),this.dispose(!0),r.setGroup$$module$build$src$core$events$utils(!1))):T.type===r.BLOCK_CHANGE$$module$build$src$core$events$events&&T.element==="disabled"&&(S=this.getProcedureCall(),(F=r.getDefinition$$module$build$src$core$procedures(S,this.workspace))&&F.id===T.blockId&&((B=r.getGroup$$module$build$src$core$events$utils())&&console.log("Saw an existing group while responding to a definition change"),r.setGroup$$module$build$src$core$events$utils(T.group),T=F.isEnabled(),this.setDisabledReason(!T,ge),this.setWarningText(T?null:r.Msg$$module$build$src$core$msg.PROCEDURES_CALL_DISABLED_DEF_WARNING.replace("%1",S)),r.setGroup$$module$build$src$core$events$utils(B)))},customContextMenu:function(T){if(this.workspace.isMovable()){var S=this.getProcedureCall(),B=this.workspace;T.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.PROCEDURES_HIGHLIGHT_DEF,callback:function(){const F=r.getDefinition$$module$build$src$core$procedures(S,B);F&&(B.centerOnBlock(F.id),r.setSelected$$module$build$src$core$common(F))}})}}};se.procedures_callnoreturn=Object.assign({},ue,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLNORETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defnoreturn"}),se.procedures_callreturn=Object.assign({},ue,{init:function(){this.appendDummyInput("TOPROW").appendField("","NAME"),this.setOutput(!0),this.setStyle("procedure_blocks"),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_CALLRETURN_HELPURL),this.arguments_=[],this.argumentVarModels_=[],this.quarkConnections_={},this.quarkIds_=null},defType_:"procedures_defreturn"});var St="UNPARENTED_IFRETURN",pe={init:function(){this.appendValueInput("CONDITION").setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_IF),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setStyle("procedure_blocks"),this.setTooltip(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_TOOLTIP),this.setHelpUrl(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_HELPURL),this.hasReturnValue_=!0},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("value",String(Number(this.hasReturnValue_))),T},domToMutation:function(T){this.hasReturnValue_=T.getAttribute("value")==="1",this.hasReturnValue_||(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN))},onchange:function(T){if(!(this.workspace.isDragging&&this.workspace.isDragging()||T.type!==r.BLOCK_MOVE$$module$build$src$core$events$events&&T.type!==r.BLOCK_CREATE$$module$build$src$core$events$events)){T=!1;var S=this;do{if(this.FUNCTION_TYPES.includes(S.type)){T=!0;break}S=S.getSurroundParent()}while(S);if(T?(S.type==="procedures_defnoreturn"&&this.hasReturnValue_?(this.removeInput("VALUE"),this.appendDummyInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!1):S.type!=="procedures_defreturn"||this.hasReturnValue_||(this.removeInput("VALUE"),this.appendValueInput("VALUE").appendField(r.Msg$$module$build$src$core$msg.PROCEDURES_DEFRETURN_RETURN),this.hasReturnValue_=!0),this.setWarningText(null)):this.setWarningText(r.Msg$$module$build$src$core$msg.PROCEDURES_IFRETURN_WARNING),!this.isInFlyout)try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!T,St)}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}},FUNCTION_TYPES:["procedures_defnoreturn","procedures_defreturn"]};se.procedures_ifreturn=pe,r.defineBlocks$$module$build$src$core$common(se);var be={blocks:se},he=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"math_number",message0:"%1",args0:[{type:"field_number",name:"NUM",value:0}],output:"Number",helpUrl:"%{BKY_MATH_NUMBER_HELPURL}",style:"math_blocks",tooltip:"%{BKY_MATH_NUMBER_TOOLTIP}",extensions:["parent_tooltip_when_inline"]},{type:"math_arithmetic",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Number"},{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ADDITION_SYMBOL}","ADD"],["%{BKY_MATH_SUBTRACTION_SYMBOL}","MINUS"],["%{BKY_MATH_MULTIPLICATION_SYMBOL}","MULTIPLY"],["%{BKY_MATH_DIVISION_SYMBOL}","DIVIDE"],["%{BKY_MATH_POWER_SYMBOL}","POWER"]]},{type:"input_value",name:"B",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ARITHMETIC_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_single",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_SINGLE_OP_ROOT}","ROOT"],["%{BKY_MATH_SINGLE_OP_ABSOLUTE}","ABS"],["-","NEG"],["ln","LN"],["log10","LOG10"],["e^","EXP"],["10^","POW10"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_SINGLE_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_trig",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_TRIG_SIN}","SIN"],["%{BKY_MATH_TRIG_COS}","COS"],["%{BKY_MATH_TRIG_TAN}","TAN"],["%{BKY_MATH_TRIG_ASIN}","ASIN"],["%{BKY_MATH_TRIG_ACOS}","ACOS"],["%{BKY_MATH_TRIG_ATAN}","ATAN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_TRIG_HELPURL}",extensions:["math_op_tooltip"]},{type:"math_constant",message0:"%1",args0:[{type:"field_dropdown",name:"CONSTANT",options:[["π","PI"],["e","E"],["φ","GOLDEN_RATIO"],["sqrt(2)","SQRT2"],["sqrt(½)","SQRT1_2"],["∞","INFINITY"]]}],output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTANT_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTANT_HELPURL}"},{type:"math_number_property",message0:"%1 %2",args0:[{type:"input_value",name:"NUMBER_TO_CHECK",check:"Number"},{type:"field_dropdown",name:"PROPERTY",options:[["%{BKY_MATH_IS_EVEN}","EVEN"],["%{BKY_MATH_IS_ODD}","ODD"],["%{BKY_MATH_IS_PRIME}","PRIME"],["%{BKY_MATH_IS_WHOLE}","WHOLE"],["%{BKY_MATH_IS_POSITIVE}","POSITIVE"],["%{BKY_MATH_IS_NEGATIVE}","NEGATIVE"],["%{BKY_MATH_IS_DIVISIBLE_BY}","DIVISIBLE_BY"]]}],inputsInline:!0,output:"Boolean",style:"math_blocks",tooltip:"%{BKY_MATH_IS_TOOLTIP}",mutator:"math_is_divisibleby_mutator"},{type:"math_change",message0:"%{BKY_MATH_CHANGE_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:"%{BKY_MATH_CHANGE_TITLE_ITEM}"},{type:"input_value",name:"DELTA",check:"Number"}],previousStatement:null,nextStatement:null,style:"variable_blocks",helpUrl:"%{BKY_MATH_CHANGE_HELPURL}",extensions:["math_change_tooltip"]},{type:"math_round",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ROUND_OPERATOR_ROUND}","ROUND"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDUP}","ROUNDUP"],["%{BKY_MATH_ROUND_OPERATOR_ROUNDDOWN}","ROUNDDOWN"]]},{type:"input_value",name:"NUM",check:"Number"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ROUND_HELPURL}",tooltip:"%{BKY_MATH_ROUND_TOOLTIP}"},{type:"math_on_list",message0:"%1 %2",args0:[{type:"field_dropdown",name:"OP",options:[["%{BKY_MATH_ONLIST_OPERATOR_SUM}","SUM"],["%{BKY_MATH_ONLIST_OPERATOR_MIN}","MIN"],["%{BKY_MATH_ONLIST_OPERATOR_MAX}","MAX"],["%{BKY_MATH_ONLIST_OPERATOR_AVERAGE}","AVERAGE"],["%{BKY_MATH_ONLIST_OPERATOR_MEDIAN}","MEDIAN"],["%{BKY_MATH_ONLIST_OPERATOR_MODE}","MODE"],["%{BKY_MATH_ONLIST_OPERATOR_STD_DEV}","STD_DEV"],["%{BKY_MATH_ONLIST_OPERATOR_RANDOM}","RANDOM"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Number",style:"math_blocks",helpUrl:"%{BKY_MATH_ONLIST_HELPURL}",mutator:"math_modes_of_list_mutator",extensions:["math_op_tooltip"]},{type:"math_modulo",message0:"%{BKY_MATH_MODULO_TITLE}",args0:[{type:"input_value",name:"DIVIDEND",check:"Number"},{type:"input_value",name:"DIVISOR",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_MODULO_TOOLTIP}",helpUrl:"%{BKY_MATH_MODULO_HELPURL}"},{type:"math_constrain",message0:"%{BKY_MATH_CONSTRAIN_TITLE}",args0:[{type:"input_value",name:"VALUE",check:"Number"},{type:"input_value",name:"LOW",check:"Number"},{type:"input_value",name:"HIGH",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_CONSTRAIN_TOOLTIP}",helpUrl:"%{BKY_MATH_CONSTRAIN_HELPURL}"},{type:"math_random_int",message0:"%{BKY_MATH_RANDOM_INT_TITLE}",args0:[{type:"input_value",name:"FROM",check:"Number"},{type:"input_value",name:"TO",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_INT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_INT_HELPURL}"},{type:"math_random_float",message0:"%{BKY_MATH_RANDOM_FLOAT_TITLE_RANDOM}",output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_RANDOM_FLOAT_TOOLTIP}",helpUrl:"%{BKY_MATH_RANDOM_FLOAT_HELPURL}"},{type:"math_atan2",message0:"%{BKY_MATH_ATAN2_TITLE}",args0:[{type:"input_value",name:"X",check:"Number"},{type:"input_value",name:"Y",check:"Number"}],inputsInline:!0,output:"Number",style:"math_blocks",tooltip:"%{BKY_MATH_ATAN2_TOOLTIP}",helpUrl:"%{BKY_MATH_ATAN2_HELPURL}"}]),Ne={ADD:"%{BKY_MATH_ARITHMETIC_TOOLTIP_ADD}",MINUS:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MINUS}",MULTIPLY:"%{BKY_MATH_ARITHMETIC_TOOLTIP_MULTIPLY}",DIVIDE:"%{BKY_MATH_ARITHMETIC_TOOLTIP_DIVIDE}",POWER:"%{BKY_MATH_ARITHMETIC_TOOLTIP_POWER}",ROOT:"%{BKY_MATH_SINGLE_TOOLTIP_ROOT}",ABS:"%{BKY_MATH_SINGLE_TOOLTIP_ABS}",NEG:"%{BKY_MATH_SINGLE_TOOLTIP_NEG}",LN:"%{BKY_MATH_SINGLE_TOOLTIP_LN}",LOG10:"%{BKY_MATH_SINGLE_TOOLTIP_LOG10}",EXP:"%{BKY_MATH_SINGLE_TOOLTIP_EXP}",POW10:"%{BKY_MATH_SINGLE_TOOLTIP_POW10}",SIN:"%{BKY_MATH_TRIG_TOOLTIP_SIN}",COS:"%{BKY_MATH_TRIG_TOOLTIP_COS}",TAN:"%{BKY_MATH_TRIG_TOOLTIP_TAN}",ASIN:"%{BKY_MATH_TRIG_TOOLTIP_ASIN}",ACOS:"%{BKY_MATH_TRIG_TOOLTIP_ACOS}",ATAN:"%{BKY_MATH_TRIG_TOOLTIP_ATAN}",SUM:"%{BKY_MATH_ONLIST_TOOLTIP_SUM}",MIN:"%{BKY_MATH_ONLIST_TOOLTIP_MIN}",MAX:"%{BKY_MATH_ONLIST_TOOLTIP_MAX}",AVERAGE:"%{BKY_MATH_ONLIST_TOOLTIP_AVERAGE}",MEDIAN:"%{BKY_MATH_ONLIST_TOOLTIP_MEDIAN}",MODE:"%{BKY_MATH_ONLIST_TOOLTIP_MODE}",STD_DEV:"%{BKY_MATH_ONLIST_TOOLTIP_STD_DEV}",RANDOM:"%{BKY_MATH_ONLIST_TOOLTIP_RANDOM}"};r.register$$module$build$src$core$extensions("math_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",Ne));var pt={mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation"),S=this.getFieldValue("PROPERTY")==="DIVISIBLE_BY";return T.setAttribute("divisor_input",String(S)),T},domToMutation:function(T){T=T.getAttribute("divisor_input")==="true",this.updateShape_(T)},updateShape_:function(T){const S=this.getInput("DIVISOR");T?S||this.appendValueInput("DIVISOR").setCheck("Number"):S&&this.removeInput("DIVISOR")}},Kt=function(){this.getField("PROPERTY").setValidator(function(T){T=T==="DIVISIBLE_BY",this.getSourceBlock().updateShape_(T)})};r.registerMutator$$module$build$src$core$extensions("math_is_divisibleby_mutator",pt,Kt),r.register$$module$build$src$core$extensions("math_change_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_MATH_CHANGE_TOOLTIP}","VAR"));var ps={updateType_:function(T){T==="MODE"?this.outputConnection.setCheck("Array"):this.outputConnection.setCheck("Number")},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("op",this.getFieldValue("OP")),T},domToMutation:function(T){if(T=T.getAttribute("op"),T===null)throw new TypeError("xmlElement had no op attribute");this.updateType_(T)}},fs=function(){this.getField("OP").setValidator((function(T){this.updateType_(T)}).bind(this))};r.registerMutator$$module$build$src$core$extensions("math_modes_of_list_mutator",ps,fs),r.defineBlocks$$module$build$src$core$common(he);var gt={blocks:he},Ft=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"controls_repeat_ext",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"input_value",name:"TIMES",check:"Number"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_repeat",message0:"%{BKY_CONTROLS_REPEAT_TITLE}",args0:[{type:"field_number",name:"TIMES",value:10,min:0,precision:1}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",tooltip:"%{BKY_CONTROLS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_CONTROLS_REPEAT_HELPURL}"},{type:"controls_whileUntil",message0:"%1 %2",args0:[{type:"field_dropdown",name:"MODE",options:[["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_WHILE}","WHILE"],["%{BKY_CONTROLS_WHILEUNTIL_OPERATOR_UNTIL}","UNTIL"]]},{type:"input_value",name:"BOOL",check:"Boolean"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_WHILEUNTIL_HELPURL}",extensions:["controls_whileUntil_tooltip"]},{type:"controls_for",message0:"%{BKY_CONTROLS_FOR_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"FROM",check:"Number",align:"RIGHT"},{type:"input_value",name:"TO",check:"Number",align:"RIGHT"},{type:"input_value",name:"BY",check:"Number",align:"RIGHT"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],inputsInline:!0,previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOR_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_for_tooltip"]},{type:"controls_forEach",message0:"%{BKY_CONTROLS_FOREACH_TITLE}",args0:[{type:"field_variable",name:"VAR",variable:null},{type:"input_value",name:"LIST",check:"Array"}],message1:"%{BKY_CONTROLS_REPEAT_INPUT_DO} %1",args1:[{type:"input_statement",name:"DO"}],previousStatement:null,nextStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FOREACH_HELPURL}",extensions:["contextMenu_newGetVariableBlock","controls_forEach_tooltip"]},{type:"controls_flow_statements",message0:"%1",args0:[{type:"field_dropdown",name:"FLOW",options:[["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK}","BREAK"],["%{BKY_CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE}","CONTINUE"]]}],previousStatement:null,style:"loop_blocks",helpUrl:"%{BKY_CONTROLS_FLOW_STATEMENTS_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_flow_tooltip","controls_flow_in_loop_check"]}]),qe={WHILE:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_WHILE}",UNTIL:"%{BKY_CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL}"};r.register$$module$build$src$core$extensions("controls_whileUntil_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("MODE",qe));var xs={BREAK:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK}",CONTINUE:"%{BKY_CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE}"};r.register$$module$build$src$core$extensions("controls_flow_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("FLOW",xs));var si={customContextMenu:function(T){if(!this.isInFlyout){var S=this.getField("VAR"),B=S.getVariable().name;this.isCollapsed()||B===null||(S={type:"variables_get",fields:{VAR:S.saveState(!0)}},T.push({enabled:!0,text:r.Msg$$module$build$src$core$msg.VARIABLES_SET_CREATE_GET.replace("%1",B),callback:r.callbackFactory$$module$build$src$core$contextmenu(this,S)}))}}};r.registerMixin$$module$build$src$core$extensions("contextMenu_newGetVariableBlock",si),r.register$$module$build$src$core$extensions("controls_for_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOR_TOOLTIP}","VAR")),r.register$$module$build$src$core$extensions("controls_forEach_tooltip",r.buildTooltipWithFieldText$$module$build$src$core$extensions("%{BKY_CONTROLS_FOREACH_TOOLTIP}","VAR"));var kt=new Set(["controls_repeat","controls_repeat_ext","controls_forEach","controls_for","controls_whileUntil"]),os="CONTROL_FLOW_NOT_IN_LOOP",ii={getSurroundLoop:function(){let T=this;do{if(kt.has(T.type))return T;T=T.getSurroundParent()}while(T);return null},onchange:function(T){const S=this.workspace;if(S.isDragging&&!S.isDragging()&&(T.type===r.BLOCK_MOVE$$module$build$src$core$events$events||T.type===r.BLOCK_CREATE$$module$build$src$core$events$events)&&(T=!!this.getSurroundLoop(),this.setWarningText(T?null:r.Msg$$module$build$src$core$msg.CONTROLS_FLOW_STATEMENTS_WARNING),!this.isInFlyout))try{r.setRecordUndo$$module$build$src$core$events$utils(!1),this.setDisabledReason(!T,os)}finally{r.setRecordUndo$$module$build$src$core$events$utils(!0)}}};r.registerMixin$$module$build$src$core$extensions("controls_flow_in_loop_check",ii),r.defineBlocks$$module$build$src$core$common(Ft);var jt={blocks:Ft,loopTypes:kt},Ut=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"logic_boolean",message0:"%1",args0:[{type:"field_dropdown",name:"BOOL",options:[["%{BKY_LOGIC_BOOLEAN_TRUE}","TRUE"],["%{BKY_LOGIC_BOOLEAN_FALSE}","FALSE"]]}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_BOOLEAN_TOOLTIP}",helpUrl:"%{BKY_LOGIC_BOOLEAN_HELPURL}"},{type:"controls_if",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],previousStatement:null,nextStatement:null,style:"logic_blocks",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,mutator:"controls_if_mutator",extensions:["controls_if_tooltip"]},{type:"controls_ifelse",message0:"%{BKY_CONTROLS_IF_MSG_IF} %1",args0:[{type:"input_value",name:"IF0",check:"Boolean"}],message1:"%{BKY_CONTROLS_IF_MSG_THEN} %1",args1:[{type:"input_statement",name:"DO0"}],message2:"%{BKY_CONTROLS_IF_MSG_ELSE} %1",args2:[{type:"input_statement",name:"ELSE"}],previousStatement:null,nextStatement:null,style:"logic_blocks",tooltip:"%{BKYCONTROLS_IF_TOOLTIP_2}",helpUrl:"%{BKY_CONTROLS_IF_HELPURL}",suppressPrefixSuffix:!0,extensions:["controls_if_tooltip"]},{type:"logic_compare",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A"},{type:"field_dropdown",name:"OP",options:[["=","EQ"],["≠","NEQ"],["‏<","LT"],["‏≤","LTE"],["‏>","GT"],["‏≥","GTE"]]},{type:"input_value",name:"B"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_COMPARE_HELPURL}",extensions:["logic_compare","logic_op_tooltip"]},{type:"logic_operation",message0:"%1 %2 %3",args0:[{type:"input_value",name:"A",check:"Boolean"},{type:"field_dropdown",name:"OP",options:[["%{BKY_LOGIC_OPERATION_AND}","AND"],["%{BKY_LOGIC_OPERATION_OR}","OR"]]},{type:"input_value",name:"B",check:"Boolean"}],inputsInline:!0,output:"Boolean",style:"logic_blocks",helpUrl:"%{BKY_LOGIC_OPERATION_HELPURL}",extensions:["logic_op_tooltip"]},{type:"logic_negate",message0:"%{BKY_LOGIC_NEGATE_TITLE}",args0:[{type:"input_value",name:"BOOL",check:"Boolean"}],output:"Boolean",style:"logic_blocks",tooltip:"%{BKY_LOGIC_NEGATE_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NEGATE_HELPURL}"},{type:"logic_null",message0:"%{BKY_LOGIC_NULL}",output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_NULL_TOOLTIP}",helpUrl:"%{BKY_LOGIC_NULL_HELPURL}"},{type:"logic_ternary",message0:"%{BKY_LOGIC_TERNARY_CONDITION} %1",args0:[{type:"input_value",name:"IF",check:"Boolean"}],message1:"%{BKY_LOGIC_TERNARY_IF_TRUE} %1",args1:[{type:"input_value",name:"THEN"}],message2:"%{BKY_LOGIC_TERNARY_IF_FALSE} %1",args2:[{type:"input_value",name:"ELSE"}],output:null,style:"logic_blocks",tooltip:"%{BKY_LOGIC_TERNARY_TOOLTIP}",helpUrl:"%{BKY_LOGIC_TERNARY_HELPURL}",extensions:["logic_ternary"]},{type:"controls_if_if",message0:"%{BKY_CONTROLS_IF_IF_TITLE_IF}",nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_IF_TOOLTIP}"},{type:"controls_if_elseif",message0:"%{BKY_CONTROLS_IF_ELSEIF_TITLE_ELSEIF}",previousStatement:null,nextStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSEIF_TOOLTIP}"},{type:"controls_if_else",message0:"%{BKY_CONTROLS_IF_ELSE_TITLE_ELSE}",previousStatement:null,enableContextMenu:!1,style:"logic_blocks",tooltip:"%{BKY_CONTROLS_IF_ELSE_TOOLTIP}"}]),qt={EQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_EQ}",NEQ:"%{BKY_LOGIC_COMPARE_TOOLTIP_NEQ}",LT:"%{BKY_LOGIC_COMPARE_TOOLTIP_LT}",LTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_LTE}",GT:"%{BKY_LOGIC_COMPARE_TOOLTIP_GT}",GTE:"%{BKY_LOGIC_COMPARE_TOOLTIP_GTE}",AND:"%{BKY_LOGIC_OPERATION_TOOLTIP_AND}",OR:"%{BKY_LOGIC_OPERATION_TOOLTIP_OR}"};r.register$$module$build$src$core$extensions("logic_op_tooltip",r.buildTooltipForDropdown$$module$build$src$core$extensions("OP",qt));var lt={elseifCount_:0,elseCount_:0,mutationToDom:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const T=r.createElement$$module$build$src$core$utils$xml("mutation");return this.elseifCount_&&T.setAttribute("elseif",String(this.elseifCount_)),this.elseCount_&&T.setAttribute("else","1"),T},domToMutation:function(T){this.elseifCount_=parseInt(T.getAttribute("elseif"),10)||0,this.elseCount_=parseInt(T.getAttribute("else"),10)||0,this.rebuildShape_()},saveExtraState:function(){if(!this.elseifCount_&&!this.elseCount_)return null;const T=Object.create(null);return this.elseifCount_&&(T.elseIfCount=this.elseifCount_),this.elseCount_&&(T.hasElse=!0),T},loadExtraState:function(T){this.elseifCount_=T.elseIfCount||0,this.elseCount_=T.hasElse?1:0,this.updateShape_()},decompose:function(T){const S=T.newBlock("controls_if_if");S.initSvg();let B=S.nextConnection;for(let F=1;F<=this.elseifCount_;F++){const ee=T.newBlock("controls_if_elseif");ee.initSvg(),B.connect(ee.previousConnection),B=ee.nextConnection}return this.elseCount_&&(T=T.newBlock("controls_if_else"),T.initSvg(),B.connect(T.previousConnection)),S},compose:function(T){T=T.nextConnection.targetBlock(),this.elseCount_=this.elseifCount_=0;const S=[null],B=[null];let F=null;for(;T;){if(!T.isInsertionMarker())switch(T.type){case"controls_if_elseif":this.elseifCount_++,S.push(T.valueConnection_),B.push(T.statementConnection_);break;case"controls_if_else":this.elseCount_++,F=T.statementConnection_;break;default:throw TypeError("Unknown block type: "+T.type)}T=T.getNextBlock()}this.updateShape_(),this.reconnectChildBlocks_(S,B,F)},saveConnections:function(T){T=T.nextConnection.targetBlock();let S=1;for(;T;){if(!T.isInsertionMarker())switch(T.type){case"controls_if_elseif":var B=this.getInput("IF"+S);const F=this.getInput("DO"+S);T.valueConnection_=B&&B.connection.targetConnection,T.statementConnection_=F&&F.connection.targetConnection,S++;break;case"controls_if_else":B=this.getInput("ELSE"),T.statementConnection_=B&&B.connection.targetConnection;break;default:throw TypeError("Unknown block type: "+T.type)}T=T.getNextBlock()}},rebuildShape_:function(){const T=[null],S=[null];let B=null;this.getInput("ELSE")&&(B=this.getInput("ELSE").connection.targetConnection);for(let F=1;this.getInput("IF"+F);F++){const ee=this.getInput("IF"+F),Ye=this.getInput("DO"+F);T.push(ee.connection.targetConnection),S.push(Ye.connection.targetConnection)}this.updateShape_(),this.reconnectChildBlocks_(T,S,B)},updateShape_:function(){this.getInput("ELSE")&&this.removeInput("ELSE");for(var T=1;this.getInput("IF"+T);T++)this.removeInput("IF"+T),this.removeInput("DO"+T);for(T=1;T<=this.elseifCount_;T++)this.appendValueInput("IF"+T).setCheck("Boolean").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSEIF),this.appendStatementInput("DO"+T).appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_THEN);this.elseCount_&&this.appendStatementInput("ELSE").appendField(r.Msg$$module$build$src$core$msg.CONTROLS_IF_MSG_ELSE)},reconnectChildBlocks_:function(T,S,B){for(let F=1;F<=this.elseifCount_;F++){let ee;(ee=T[F])==null||ee.reconnect(this,"IF"+F);let Ye;(Ye=S[F])==null||Ye.reconnect(this,"DO"+F)}B==null||B.reconnect(this,"ELSE")}};r.registerMutator$$module$build$src$core$extensions("controls_if_mutator",lt,null,["controls_if_elseif","controls_if_else"]);var It=function(){this.setTooltip((function(){if(this.elseifCount_||this.elseCount_){if(!this.elseifCount_&&this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_2;if(this.elseifCount_&&!this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_3;if(this.elseifCount_&&this.elseCount_)return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_4}else return r.Msg$$module$build$src$core$msg.CONTROLS_IF_TOOLTIP_1;return""}).bind(this))};r.register$$module$build$src$core$extensions("controls_if_tooltip",It);var Cs={onchange:function(T){this.prevBlocks_||(this.prevBlocks_=[null,null]);var S=this.getInputTargetBlock("A");const B=this.getInputTargetBlock("B");S&&B&&!this.workspace.connectionChecker.doTypeChecks(S.outputConnection,B.outputConnection)&&(r.setGroup$$module$build$src$core$events$utils(T.group),T=this.prevBlocks_[0],T!==S&&(S.unplug(),!T||T.isDisposed()||T.isShadow()||this.getInput("A").connection.connect(T.outputConnection)),S=this.prevBlocks_[1],S!==B&&(B.unplug(),!S||S.isDisposed()||S.isShadow()||this.getInput("B").connection.connect(S.outputConnection)),this.bumpNeighbours(),r.setGroup$$module$build$src$core$events$utils(!1)),this.prevBlocks_[0]=this.getInputTargetBlock("A"),this.prevBlocks_[1]=this.getInputTargetBlock("B")}},ws=function(){this.mixin(Cs)};r.register$$module$build$src$core$extensions("logic_compare",ws);var vi={prevParentConnection_:null,onchange:function(T){const S=this.getInputTargetBlock("THEN"),B=this.getInputTargetBlock("ELSE"),F=this.outputConnection.targetConnection;if((S||B)&&F)for(let ee=0;2>ee;ee++){const Ye=ee===1?S:B;Ye&&!Ye.workspace.connectionChecker.doTypeChecks(Ye.outputConnection,F)&&(r.setGroup$$module$build$src$core$events$utils(T.group),F===this.prevParentConnection_?(this.unplug(),F.getSourceBlock().bumpNeighbours()):(Ye.unplug(),Ye.bumpNeighbours()),r.setGroup$$module$build$src$core$events$utils(!1))}this.prevParentConnection_=F}};r.registerMixin$$module$build$src$core$extensions("logic_ternary",vi),r.defineBlocks$$module$build$src$core$common(Ut);var fe={blocks:Ut},Xe=r.createBlockDefinitionsFromJsonArray$$module$build$src$core$common([{type:"lists_create_empty",message0:"%{BKY_LISTS_CREATE_EMPTY_TITLE}",output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_CREATE_EMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_CREATE_EMPTY_HELPURL}"},{type:"lists_repeat",message0:"%{BKY_LISTS_REPEAT_TITLE}",args0:[{type:"input_value",name:"ITEM"},{type:"input_value",name:"NUM",check:"Number"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_REPEAT_TOOLTIP}",helpUrl:"%{BKY_LISTS_REPEAT_HELPURL}"},{type:"lists_reverse",message0:"%{BKY_LISTS_REVERSE_MESSAGE0}",args0:[{type:"input_value",name:"LIST",check:"Array"}],output:"Array",inputsInline:!0,style:"list_blocks",tooltip:"%{BKY_LISTS_REVERSE_TOOLTIP}",helpUrl:"%{BKY_LISTS_REVERSE_HELPURL}"},{type:"lists_isEmpty",message0:"%{BKY_LISTS_ISEMPTY_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Boolean",style:"list_blocks",tooltip:"%{BKY_LISTS_ISEMPTY_TOOLTIP}",helpUrl:"%{BKY_LISTS_ISEMPTY_HELPURL}"},{type:"lists_length",message0:"%{BKY_LISTS_LENGTH_TITLE}",args0:[{type:"input_value",name:"VALUE",check:["String","Array"]}],output:"Number",style:"list_blocks",tooltip:"%{BKY_LISTS_LENGTH_TOOLTIP}",helpUrl:"%{BKY_LISTS_LENGTH_HELPURL}"}]),Ue={init:function(){this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_HELPURL),this.setStyle("list_blocks"),this.itemCount_=3,this.updateShape_(),this.setOutput(!0,"Array"),this.setMutator(new r.MutatorIcon$$module$build$src$core$icons$mutator_icon(["lists_create_with_item"],this)),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_TOOLTIP)},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("items",String(this.itemCount_)),T},domToMutation:function(T){if(T=T.getAttribute("items"),!T)throw new TypeError("element did not have items");this.itemCount_=parseInt(T,10),this.updateShape_()},saveExtraState:function(){return{itemCount:this.itemCount_}},loadExtraState:function(T){this.itemCount_=T.itemCount,this.updateShape_()},decompose:function(T){const S=T.newBlock("lists_create_with_container");S.initSvg();let B=S.getInput("STACK").connection;for(let F=0;F<this.itemCount_;F++){const ee=T.newBlock("lists_create_with_item");if(ee.initSvg(),!ee.previousConnection)throw Error("itemBlock has no previousConnection");B.connect(ee.previousConnection),B=ee.nextConnection}return S},compose:function(T){var S=T.getInputTargetBlock("STACK");for(T=[];S;)S.isInsertionMarker()||T.push(S.valueConnection_),S=S.getNextBlock();for(S=0;S<this.itemCount_;S++){const B=this.getInput("ADD"+S).connection.targetConnection;B&&!T.includes(B)&&B.disconnect()}for(this.itemCount_=T.length,this.updateShape_(),S=0;S<this.itemCount_;S++){let B;(B=T[S])==null||B.reconnect(this,"ADD"+S)}},saveConnections:function(T){T=T.getInputTargetBlock("STACK");let S=0;for(;T;){if(T.isInsertionMarker()){T=T.getNextBlock();continue}const B=this.getInput("ADD"+S);let F;T.valueConnection_=(F=B)==null?void 0:F.connection.targetConnection,T=T.getNextBlock(),S++}},updateShape_:function(){this.itemCount_&&this.getInput("EMPTY")?this.removeInput("EMPTY"):this.itemCount_||this.getInput("EMPTY")||this.appendDummyInput("EMPTY").appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_EMPTY_TITLE);for(var T=0;T<this.itemCount_;T++)if(!this.getInput("ADD"+T)){const S=this.appendValueInput("ADD"+T).setAlign(r.Align$$module$build$src$core$inputs$align.RIGHT);T===0&&S.appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_INPUT_WITH)}for(T=this.itemCount_;this.getInput("ADD"+T);T++)this.removeInput("ADD"+T)}};Xe.lists_create_with=Ue;var Fs={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD),this.appendStatementInput("STACK"),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP),this.contextMenu=!1}};Xe.lists_create_with_container=Fs;var Jt={init:function(){this.setStyle("list_blocks"),this.appendDummyInput().appendField(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TITLE),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_CREATE_WITH_ITEM_TOOLTIP),this.contextMenu=!1}};Xe.lists_create_with_item=Jt;var P={init:function(){var T=[[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_LAST,"LAST"]];if(this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_HELPURL),this.setStyle("list_blocks"),this.setOutput(!0,"Number"),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_INPUT_IN_LIST),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),!T)throw Error("field_dropdown not found");this.appendValueInput("FIND").appendField(T,"END"),this.setInputsInline(!0),this.setTooltip(()=>r.Msg$$module$build$src$core$msg.LISTS_INDEX_OF_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"0":"-1"))}};Xe.lists_indexOf=P;var ri={init:function(){var T=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET,"GET"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_GET_REMOVE,"GET_REMOVE"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_REMOVE,"REMOVE"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_HELPURL),this.setStyle("list_blocks"),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),T.setValidator(function(S){S=S==="REMOVE",this.getSourceBlock().updateStatement_(S)}),this.appendValueInput("VALUE").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_INPUT_IN_LIST),this.appendDummyInput().appendField(T,"MODE").appendField("","SPACE"),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS}),T.setValidator(function(S){const B=this.getValue();S=S==="FROM_START"||S==="FROM_END",S!==(B==="FROM_START"||B==="FROM_END")&&this.getSourceBlock().updateAt_(S)}),this.appendDummyInput().appendField(T,"WHERE"),this.appendDummyInput("AT"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL),this.setInputsInline(!0),this.setOutput(!0),this.updateAt_(!0),this.setTooltip(()=>{const S=this.getFieldValue("MODE"),B=this.getFieldValue("WHERE");let F="";switch(S+" "+B){case"GET FROM_START":case"GET FROM_END":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM;break;case"GET FIRST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST;break;case"GET LAST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST;break;case"GET RANDOM":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM;break;case"GET_REMOVE FROM_START":case"GET_REMOVE FROM_END":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM;break;case"GET_REMOVE FIRST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST;break;case"GET_REMOVE LAST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST;break;case"GET_REMOVE RANDOM":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM;break;case"REMOVE FROM_START":case"REMOVE FROM_END":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM;break;case"REMOVE FIRST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST;break;case"REMOVE LAST":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST;break;case"REMOVE RANDOM":F=r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM}return(B==="FROM_START"||B==="FROM_END")&&(F+="  "+(B==="FROM_START"?r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP:r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_END_TOOLTIP).replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),F})},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");T.setAttribute("statement",String(!this.outputConnection));const S=this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return T.setAttribute("at",String(S)),T},domToMutation:function(T){const S=T.getAttribute("statement")==="true";this.updateStatement_(S),T=T.getAttribute("at")!=="false",this.updateAt_(T)},saveExtraState:function(){return this.outputConnection?null:{isStatement:!0}},loadExtraState:function(T){T.isStatement?this.updateStatement_(!0):typeof T=="string"&&this.domToMutation(r.textToDom$$module$build$src$core$utils$xml(T))},updateStatement_:function(T){T!==!this.outputConnection&&(this.unplug(!0,!0),T?(this.setOutput(!1),this.setPreviousStatement(!0),this.setNextStatement(!0)):(this.setPreviousStatement(!1),this.setNextStatement(!1),this.setOutput(!0)))},updateAt_:function(T){this.removeInput("AT"),this.removeInput("ORDINAL",!0),T?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_TAIL&&this.moveInputBefore("TAIL",null)}};Xe.lists_getIndex=ri;var $t={init:function(){var T=[[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_SET,"SET"],[r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INSERT,"INSERT"]];this.WHERE_OPTIONS=[[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_FIRST,"FIRST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_LAST,"LAST"],[r.Msg$$module$build$src$core$msg.LISTS_GET_INDEX_RANDOM,"RANDOM"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_IN_LIST),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:T}),this.appendDummyInput().appendField(T,"MODE").appendField("","SPACE"),T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this.WHERE_OPTIONS}),T.setValidator(function(S){const B=this.getValue();S=S==="FROM_START"||S==="FROM_END",S!==(B==="FROM_START"||B==="FROM_END")&&this.getSourceBlock().updateAt_(S)}),this.appendDummyInput().appendField(T,"WHERE"),this.appendDummyInput("AT"),this.appendValueInput("TO").appendField(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_INPUT_TO),this.setInputsInline(!0),this.setPreviousStatement(!0),this.setNextStatement(!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP),this.updateAt_(!0),this.setTooltip(()=>{const S=this.getFieldValue("MODE"),B=this.getFieldValue("WHERE");let F="";switch(S+" "+B){case"SET FROM_START":case"SET FROM_END":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM;break;case"SET FIRST":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST;break;case"SET LAST":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST;break;case"SET RANDOM":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM;break;case"INSERT FROM_START":case"INSERT FROM_END":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM;break;case"INSERT FIRST":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST;break;case"INSERT LAST":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST;break;case"INSERT RANDOM":F=r.Msg$$module$build$src$core$msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM}return(B==="FROM_START"||B==="FROM_END")&&(F+="  "+r.Msg$$module$build$src$core$msg.LISTS_INDEX_FROM_START_TOOLTIP.replace("%1",this.workspace.options.oneBasedIndex?"#1":"#0")),F})},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation"),S=this.getInput("AT")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return T.setAttribute("at",String(S)),T},domToMutation:function(T){T=T.getAttribute("at")!=="false",this.updateAt_(T)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(T){this.removeInput("AT"),this.removeInput("ORDINAL",!0),T?(this.appendValueInput("AT").setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL").appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"),this.moveInputBefore("AT","TO"),this.getInput("ORDINAL")&&this.moveInputBefore("ORDINAL","TO")}};Xe.lists_setIndex=$t;var tt={init:function(){this.WHERE_OPTIONS_1=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_START_FIRST,"FIRST"]],this.WHERE_OPTIONS_2=[[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_START,"FROM_START"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_FROM_END,"FROM_END"],[r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_END_LAST,"LAST"]],this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("LIST").setCheck("Array").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_INPUT_IN_LIST);const T=S=>{const B=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:this["WHERE_OPTIONS_"+S]});return B.setValidator(function(F){const ee=this.getValue();F=F==="FROM_START"||F==="FROM_END",F!==(ee==="FROM_START"||ee==="FROM_END")&&this.getSourceBlock().updateAt_(S,F)}),B};this.appendDummyInput("WHERE1_INPUT").appendField(T(1),"WHERE1"),this.appendDummyInput("AT1"),this.appendDummyInput("WHERE2_INPUT").appendField(T(2),"WHERE2"),this.appendDummyInput("AT2"),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.appendDummyInput("TAIL").appendField(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.updateAt_(1,!0),this.updateAt_(2,!0),this.setTooltip(r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TOOLTIP)},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");var S=this.getInput("AT1")instanceof r.ValueInput$$module$build$src$core$inputs$value_input;return T.setAttribute("at1",String(S)),S=this.getInput("AT2")instanceof r.ValueInput$$module$build$src$core$inputs$value_input,T.setAttribute("at2",String(S)),T},domToMutation:function(T){const S=T.getAttribute("at1")==="true";T=T.getAttribute("at2")==="true",this.updateAt_(1,S),this.updateAt_(2,T)},saveExtraState:function(){return null},loadExtraState:function(){},updateAt_:function(T,S){this.removeInput("AT"+T),this.removeInput("ORDINAL"+T,!0),S?(this.appendValueInput("AT"+T).setCheck("Number"),r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX&&this.appendDummyInput("ORDINAL"+T).appendField(r.Msg$$module$build$src$core$msg.ORDINAL_NUMBER_SUFFIX)):this.appendDummyInput("AT"+T),T===1&&(this.moveInputBefore("AT1","WHERE2_INPUT"),this.getInput("ORDINAL1")&&this.moveInputBefore("ORDINAL1","WHERE2_INPUT")),r.Msg$$module$build$src$core$msg.LISTS_GET_SUBLIST_TAIL&&this.moveInputBefore("TAIL",null)}};Xe.lists_getSublist=tt,Xe.lists_sort={init:function(){this.jsonInit({message0:"%{BKY_LISTS_SORT_TITLE}",args0:[{type:"field_dropdown",name:"TYPE",options:[["%{BKY_LISTS_SORT_TYPE_NUMERIC}","NUMERIC"],["%{BKY_LISTS_SORT_TYPE_TEXT}","TEXT"],["%{BKY_LISTS_SORT_TYPE_IGNORECASE}","IGNORE_CASE"]]},{type:"field_dropdown",name:"DIRECTION",options:[["%{BKY_LISTS_SORT_ORDER_ASCENDING}","1"],["%{BKY_LISTS_SORT_ORDER_DESCENDING}","-1"]]},{type:"input_value",name:"LIST",check:"Array"}],output:"Array",style:"list_blocks",tooltip:"%{BKY_LISTS_SORT_TOOLTIP}",helpUrl:"%{BKY_LISTS_SORT_HELPURL}"})}},Xe.lists_split={init:function(){const T=r.fromJson$$module$build$src$core$field_registry({type:"field_dropdown",options:[[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_LIST_FROM_TEXT,"SPLIT"],[r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TEXT_FROM_LIST,"JOIN"]]});if(!T)throw Error("field_dropdown not found");T.setValidator(S=>{this.updateType_(S)}),this.setHelpUrl(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_HELPURL),this.setStyle("list_blocks"),this.appendValueInput("INPUT").setCheck("String").appendField(T,"MODE"),this.appendValueInput("DELIM").setCheck("String").appendField(r.Msg$$module$build$src$core$msg.LISTS_SPLIT_WITH_DELIMITER),this.setInputsInline(!0),this.setOutput(!0,"Array"),this.setTooltip(()=>{const S=this.getFieldValue("MODE");if(S==="SPLIT")return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_SPLIT;if(S==="JOIN")return r.Msg$$module$build$src$core$msg.LISTS_SPLIT_TOOLTIP_JOIN;throw Error("Unknown mode: "+S)})},updateType_:function(T){if(this.getFieldValue("MODE")!==T){const S=this.getInput("INPUT").connection;S.setShadowDom(null);const B=S.targetBlock();B&&(S.disconnect(),B.isShadow()?B.dispose(!1):this.bumpNeighbours())}T==="SPLIT"?(this.outputConnection.setCheck("Array"),this.getInput("INPUT").setCheck("String")):(this.outputConnection.setCheck("String"),this.getInput("INPUT").setCheck("Array"))},mutationToDom:function(){const T=r.createElement$$module$build$src$core$utils$xml("mutation");return T.setAttribute("mode",this.getFieldValue("MODE")),T},domToMutation:function(T){this.updateType_(T.getAttribute("mode"))},saveExtraState:function(){return{mode:this.getFieldValue("MODE")}},loadExtraState:function(T){this.updateType_(T.mode)}},r.defineBlocks$$module$build$src$core$common(Xe);var Zt={blocks:Xe},Y=Object.assign({},Xe,Ut,Ft,he,se,v,f,o),re={blocks:Y,lists:Zt,logic:fe,loops:jt,math:gt,procedures:be,texts:z,variables:E,variablesDynamic:p};return re.__namespace__=r,re})})(uv);var JC=uv.exports;const ZC=co(JC),{blocks:YV,lists:KV,logic:jV,loops:qV,math:JV,procedures:ZV,texts:QV,variables:eW,variablesDynamic:tW}=ZC;var dv={exports:{}};(function(l,t){(function(s,r){l.exports=r()})(nn,function(){var s=s||{Msg:Object.create(null)};return s.Msg.ADD_COMMENT="添加注释",s.Msg.CANNOT_DELETE_VARIABLE_PROCEDURE="不能删除变量“%1”，因为它是函数“%2”定义的一部分",s.Msg.CHANGE_VALUE_TITLE="更改值：",s.Msg.CLEAN_UP="整理块",s.Msg.COLLAPSED_WARNINGS_WARNING="已收起的信息块内包含警告。",s.Msg.COLLAPSE_ALL="折叠块",s.Msg.COLLAPSE_BLOCK="折叠块",s.Msg.COLOUR_BLEND_COLOUR1="颜色1",s.Msg.COLOUR_BLEND_COLOUR2="颜色2",s.Msg.COLOUR_BLEND_HELPURL="https://meyerweb.com/eric/tools/color-blend/#:::rgbp",s.Msg.COLOUR_BLEND_RATIO="比例",s.Msg.COLOUR_BLEND_TITLE="混合",s.Msg.COLOUR_BLEND_TOOLTIP="把两种颜色以一个给定的比例(0.0-1.0)进行混合。",s.Msg.COLOUR_PICKER_HELPURL="https://zh.wikipedia.org/wiki/颜色",s.Msg.COLOUR_PICKER_TOOLTIP="从调色板中选择一种颜色。",s.Msg.COLOUR_RANDOM_HELPURL="http://randomcolour.com",s.Msg.COLOUR_RANDOM_TITLE="随机颜色",s.Msg.COLOUR_RANDOM_TOOLTIP="随机选择一种颜色。",s.Msg.COLOUR_RGB_BLUE="蓝色",s.Msg.COLOUR_RGB_GREEN="绿色",s.Msg.COLOUR_RGB_HELPURL="https://www.december.com/html/spec/colorpercompact.html",s.Msg.COLOUR_RGB_RED="红色",s.Msg.COLOUR_RGB_TITLE="颜色",s.Msg.COLOUR_RGB_TOOLTIP="通过指定红色、绿色和蓝色的量创建一种颜色。所有的值必须在0和100之间。",s.Msg.CONTROLS_FLOW_STATEMENTS_HELPURL="https://github.com/google/blockly/wiki/Loops#loop-termination-blocks",s.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK="跳出循环",s.Msg.CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE="继续下一轮循环",s.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK="跳出包含它的循环。",s.Msg.CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE="跳过本轮循环的剩余部分，并继进行续下一轮循环。",s.Msg.CONTROLS_FLOW_STATEMENTS_WARNING="警告：这个块只能在循环内使用。",s.Msg.CONTROLS_FOREACH_HELPURL="https://github.com/google/blockly/wiki/Loops#for-each",s.Msg.CONTROLS_FOREACH_TITLE="遍历列表 %2 里的每一项 %1",s.Msg.CONTROLS_FOREACH_TOOLTIP="遍历列表中的每一项，将变量“%1”设为所选项，并执行一些语句。",s.Msg.CONTROLS_FOR_HELPURL="https://github.com/google/blockly/wiki/Loops#count-with",s.Msg.CONTROLS_FOR_TITLE="变量 %1 从 %2 数到 %3 每次增加 %4",s.Msg.CONTROLS_FOR_TOOLTIP="让变量“%1”记录开始数到结束数之间指定间隔的值，并执行指定的块。",s.Msg.CONTROLS_IF_ELSEIF_TOOLTIP="在这个if语句块中增加一个条件。",s.Msg.CONTROLS_IF_ELSE_TOOLTIP="在这个if语句块中添加一个最终的，包括所有其余情况的条件。",s.Msg.CONTROLS_IF_HELPURL="https://github.com/google/blockly/wiki/IfElse",s.Msg.CONTROLS_IF_IF_TOOLTIP="增加、删除或重新排列各节来重新配置这个if语句块。",s.Msg.CONTROLS_IF_MSG_ELSE="否则",s.Msg.CONTROLS_IF_MSG_ELSEIF="否则如果",s.Msg.CONTROLS_IF_MSG_IF="如果",s.Msg.CONTROLS_IF_TOOLTIP_1="如果值为真，执行一些语句。",s.Msg.CONTROLS_IF_TOOLTIP_2="如果值为真，则执行第一块语句。否则，则执行第二块语句。",s.Msg.CONTROLS_IF_TOOLTIP_3="如果第一个值为真，则执行第一块的语句。否则，如果第二个值为真，则执行第二块的语句。",s.Msg.CONTROLS_IF_TOOLTIP_4="如果第一个值为真，则执行第一块对语句。否则，如果第二个值为真，则执行语句的第二块。如果没有值为真，则执行最后一块的语句。",s.Msg.CONTROLS_REPEAT_HELPURL="https://zh.wikipedia.org/wiki/For循环",s.Msg.CONTROLS_REPEAT_INPUT_DO="执行",s.Msg.CONTROLS_REPEAT_TITLE="重复 %1 次",s.Msg.CONTROLS_REPEAT_TOOLTIP="多次执行一些语句。",s.Msg.CONTROLS_WHILEUNTIL_HELPURL="https://github.com/google/blockly/wiki/Loops#repeat",s.Msg.CONTROLS_WHILEUNTIL_OPERATOR_UNTIL="重复直到条件满足",s.Msg.CONTROLS_WHILEUNTIL_OPERATOR_WHILE="当条件满足时重复",s.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL="只要值为假，就一直循环执行一些语句。",s.Msg.CONTROLS_WHILEUNTIL_TOOLTIP_WHILE="只要值为真，就一直循环执行一些语句。",s.Msg.DELETE_ALL_BLOCKS="删除所有 %1 个块吗？",s.Msg.DELETE_BLOCK="删除块",s.Msg.DELETE_VARIABLE="删除变量“%1”",s.Msg.DELETE_VARIABLE_CONFIRMATION="要删除对变量“%2”的%1个引用吗？",s.Msg.DELETE_X_BLOCKS="删除 %1 个块",s.Msg.DIALOG_CANCEL="取消",s.Msg.DIALOG_OK="确认",s.Msg.DISABLE_BLOCK="禁用块",s.Msg.DUPLICATE_BLOCK="复制",s.Msg.DUPLICATE_COMMENT="复制注释",s.Msg.ENABLE_BLOCK="启用块",s.Msg.EXPAND_ALL="展开块",s.Msg.EXPAND_BLOCK="展开块",s.Msg.EXTERNAL_INPUTS="外部输入",s.Msg.HELP="帮助",s.Msg.INLINE_INPUTS="单行输入",s.Msg.LISTS_CREATE_EMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#create-empty-list",s.Msg.LISTS_CREATE_EMPTY_TITLE="创建空列表",s.Msg.LISTS_CREATE_EMPTY_TOOLTIP="返回一个列表，长度为 0，不包含任何数据记录",s.Msg.LISTS_CREATE_WITH_CONTAINER_TITLE_ADD="列表",s.Msg.LISTS_CREATE_WITH_CONTAINER_TOOLTIP="增加、删除或重新排列各部分以此重新配置这个列表块。",s.Msg.LISTS_CREATE_WITH_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",s.Msg.LISTS_CREATE_WITH_INPUT_WITH="创建列表，内容：",s.Msg.LISTS_CREATE_WITH_ITEM_TOOLTIP="将一个项添加到列表中。",s.Msg.LISTS_CREATE_WITH_TOOLTIP="建立一个具有任意数量项目的列表。",s.Msg.LISTS_GET_INDEX_FIRST="第一项",s.Msg.LISTS_GET_INDEX_FROM_END="倒数第#项",s.Msg.LISTS_GET_INDEX_FROM_START="#",s.Msg.LISTS_GET_INDEX_GET="取得",s.Msg.LISTS_GET_INDEX_GET_REMOVE="取得并移除",s.Msg.LISTS_GET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-items-from-a-list",s.Msg.LISTS_GET_INDEX_LAST="最后一项",s.Msg.LISTS_GET_INDEX_RANDOM="随机的一项",s.Msg.LISTS_GET_INDEX_REMOVE="移除",s.Msg.LISTS_GET_INDEX_TAIL="",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FIRST="返回列表中的第一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_FROM="返回在列表中的指定位置的项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_LAST="返回列表中的最后一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_RANDOM="返回列表中的随机一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST="移除并返回列表中的第一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM="移除并返回列表中的指定位置的项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST="移除并返回列表中的最后一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM="移除并返回列表中的随机一项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST="移除列表中的第一项",s.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM="移除在列表中的指定位置的项。",s.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST="移除列表中的最后一项",s.Msg.LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM="删除列表中的随机一项。",s.Msg.LISTS_GET_SUBLIST_END_FROM_END="到倒数第#项",s.Msg.LISTS_GET_SUBLIST_END_FROM_START="到第#项",s.Msg.LISTS_GET_SUBLIST_END_LAST="到最后一项",s.Msg.LISTS_GET_SUBLIST_HELPURL="https://github.com/google/blockly/wiki/Lists#getting-a-sublist",s.Msg.LISTS_GET_SUBLIST_START_FIRST="获取子列表，从第一项",s.Msg.LISTS_GET_SUBLIST_START_FROM_END="获取子列表，从倒数第#项",s.Msg.LISTS_GET_SUBLIST_START_FROM_START="获取子列表，从第#项",s.Msg.LISTS_GET_SUBLIST_TAIL="",s.Msg.LISTS_GET_SUBLIST_TOOLTIP="复制列表中指定的部分。",s.Msg.LISTS_INDEX_FROM_END_TOOLTIP="%1是最后一项。",s.Msg.LISTS_INDEX_FROM_START_TOOLTIP="%1是第一项。",s.Msg.LISTS_INDEX_OF_FIRST="寻找第一次出现的项",s.Msg.LISTS_INDEX_OF_HELPURL="https://github.com/google/blockly/wiki/Lists#finding-items-in-a-list",s.Msg.LISTS_INDEX_OF_LAST="寻找最后一次出现的项",s.Msg.LISTS_INDEX_OF_TOOLTIP="返回在列表中的第一/最后一个匹配项的索引值。如果找不到项目则返回%1。",s.Msg.LISTS_INLIST="在列表中",s.Msg.LISTS_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Lists#is-empty",s.Msg.LISTS_ISEMPTY_TITLE="%1是空的",s.Msg.LISTS_ISEMPTY_TOOLTIP="如果改列表为空，则返回真。",s.Msg.LISTS_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Lists#length-of",s.Msg.LISTS_LENGTH_TITLE="%1的长度",s.Msg.LISTS_LENGTH_TOOLTIP="返回列表的长度。",s.Msg.LISTS_REPEAT_HELPURL="https://github.com/google/blockly/wiki/Lists#create-list-with",s.Msg.LISTS_REPEAT_TITLE="建立列表使用项 %1 重复 %2 次",s.Msg.LISTS_REPEAT_TOOLTIP="建立包含指定重复次数的值的列表。",s.Msg.LISTS_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Lists#reversing-a-list",s.Msg.LISTS_REVERSE_MESSAGE0="倒转%1",s.Msg.LISTS_REVERSE_TOOLTIP="倒转一个列表，返回副本。",s.Msg.LISTS_SET_INDEX_HELPURL="https://github.com/google/blockly/wiki/Lists#in-list--set",s.Msg.LISTS_SET_INDEX_INPUT_TO="值为",s.Msg.LISTS_SET_INDEX_INSERT="插入在",s.Msg.LISTS_SET_INDEX_SET="设置",s.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST="在列表的起始处添加该项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_FROM="在列表中指定位置插入项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_LAST="在列表的末尾处添加该项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM="在列表的随机位置插入该项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FIRST="设置列表中的第一项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_SET_FROM="设置在列表中指定位置的项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_SET_LAST="设置列表中的最后一项。",s.Msg.LISTS_SET_INDEX_TOOLTIP_SET_RANDOM="设置列表中的随机一项。",s.Msg.LISTS_SORT_HELPURL="https://github.com/google/blockly/wiki/Lists#sorting-a-list",s.Msg.LISTS_SORT_ORDER_ASCENDING="升序",s.Msg.LISTS_SORT_ORDER_DESCENDING="降序",s.Msg.LISTS_SORT_TITLE="排序%1 %2 %3",s.Msg.LISTS_SORT_TOOLTIP="排序一个列表，返回副本。",s.Msg.LISTS_SORT_TYPE_IGNORECASE="按字母（忽略大小写）",s.Msg.LISTS_SORT_TYPE_NUMERIC="按数字",s.Msg.LISTS_SORT_TYPE_TEXT="按字母",s.Msg.LISTS_SPLIT_HELPURL="https://github.com/google/blockly/wiki/Lists#splitting-strings-and-joining-lists",s.Msg.LISTS_SPLIT_LIST_FROM_TEXT="从文本制作列表",s.Msg.LISTS_SPLIT_TEXT_FROM_LIST="将列表合并为文本",s.Msg.LISTS_SPLIT_TOOLTIP_JOIN="加入文本列表至一个文本，由分隔符分隔。",s.Msg.LISTS_SPLIT_TOOLTIP_SPLIT="将文本按指定的分隔符拆分为文本组成的列表。",s.Msg.LISTS_SPLIT_WITH_DELIMITER="分隔符：",s.Msg.LOGIC_BOOLEAN_FALSE="false",s.Msg.LOGIC_BOOLEAN_HELPURL="https://github.com/google/blockly/wiki/Logic#values",s.Msg.LOGIC_BOOLEAN_TOOLTIP="返回 true 或 false。",s.Msg.LOGIC_BOOLEAN_TRUE="true",s.Msg.LOGIC_COMPARE_HELPURL="https://zh.wikipedia.org/wiki/不等",s.Msg.LOGIC_COMPARE_TOOLTIP_EQ="如果两个输入结果相等，则返回真。",s.Msg.LOGIC_COMPARE_TOOLTIP_GT="如果第一个输入结果比第二个大，则返回真。",s.Msg.LOGIC_COMPARE_TOOLTIP_GTE="如果第一个输入结果大于或等于第二个输入结果，则返回真。",s.Msg.LOGIC_COMPARE_TOOLTIP_LT="如果第一个输入结果比第二个小，则返回真。",s.Msg.LOGIC_COMPARE_TOOLTIP_LTE="如果第一个输入结果小于或等于第二个输入结果，则返回真。",s.Msg.LOGIC_COMPARE_TOOLTIP_NEQ="如果两个输入结果不相等，则返回真。",s.Msg.LOGIC_NEGATE_HELPURL="https://github.com/google/blockly/wiki/Logic#not",s.Msg.LOGIC_NEGATE_TITLE="非 %1",s.Msg.LOGIC_NEGATE_TOOLTIP="如果输入结果为false，则返回true；如果输入结果为true，则返回false。",s.Msg.LOGIC_NULL="空",s.Msg.LOGIC_NULL_HELPURL="https://en.wikipedia.org/wiki/Nullable_type",s.Msg.LOGIC_NULL_TOOLTIP="返回空值。",s.Msg.LOGIC_OPERATION_AND="并且",s.Msg.LOGIC_OPERATION_HELPURL="https://github.com/google/blockly/wiki/Logic#logical-operations",s.Msg.LOGIC_OPERATION_OR="或",s.Msg.LOGIC_OPERATION_TOOLTIP_AND="如果两个输入结果都为真，则返回真。",s.Msg.LOGIC_OPERATION_TOOLTIP_OR="如果至少有一个输入结果为真，则返回真。",s.Msg.LOGIC_TERNARY_CONDITION="断言",s.Msg.LOGIC_TERNARY_HELPURL="https://zh.wikipedia.org/wiki/条件运算符%3F:",s.Msg.LOGIC_TERNARY_IF_FALSE="如果为 false",s.Msg.LOGIC_TERNARY_IF_TRUE="如果为 true",s.Msg.LOGIC_TERNARY_TOOLTIP="检查“断言”里的条件语句。如果条件为真，则返回“如果为真”的值，否则，则返回“如果为假”的值。",s.Msg.MATH_ADDITION_SYMBOL="+",s.Msg.MATH_ARITHMETIC_HELPURL="https://zh.wikipedia.org/wiki/算术",s.Msg.MATH_ARITHMETIC_TOOLTIP_ADD="返回两个数的和。",s.Msg.MATH_ARITHMETIC_TOOLTIP_DIVIDE="返回两个数的商。",s.Msg.MATH_ARITHMETIC_TOOLTIP_MINUS="返回两个数的差。",s.Msg.MATH_ARITHMETIC_TOOLTIP_MULTIPLY="返回两个数的积。",s.Msg.MATH_ARITHMETIC_TOOLTIP_POWER="返回第一个数的第二个数次幂。",s.Msg.MATH_ATAN2_HELPURL="https://zh.wikipedia.org/wiki/反正切2",s.Msg.MATH_ATAN2_TITLE="点(x:%1,y:%2)的方位角",s.Msg.MATH_ATAN2_TOOLTIP="返回点（X，Y）的反正切值，范围为-180到180度。",s.Msg.MATH_CHANGE_HELPURL="https://zh.wikipedia.org/wiki/加法",s.Msg.MATH_CHANGE_TITLE="给 %1 加 %2",s.Msg.MATH_CHANGE_TOOLTIP="把数加到变量“%1”。",s.Msg.MATH_CONSTANT_HELPURL="https://zh.wikipedia.org/wiki/数学常数",s.Msg.MATH_CONSTANT_TOOLTIP="返回一个以下常见常数：π (3.141…)、e (2.718…)、φ (1.618…)、根号2 (1.414…)、根号½ (0.707…)或∞ (无穷)。",s.Msg.MATH_CONSTRAIN_HELPURL="https://en.wikipedia.org/wiki/Clamping_(graphics)",s.Msg.MATH_CONSTRAIN_TITLE="将 %1 限制在 最低 %2 到最高 %3 之间",s.Msg.MATH_CONSTRAIN_TOOLTIP="把一个数限制在指定的极限（含）之间。",s.Msg.MATH_DIVISION_SYMBOL="÷",s.Msg.MATH_IS_DIVISIBLE_BY="可整除被",s.Msg.MATH_IS_EVEN="是偶数",s.Msg.MATH_IS_NEGATIVE="是负数",s.Msg.MATH_IS_ODD="是奇数",s.Msg.MATH_IS_POSITIVE="是正数",s.Msg.MATH_IS_PRIME="是质数",s.Msg.MATH_IS_TOOLTIP="检查一个数是否是偶数、奇数、质数、整数、正数、负数，或者是否能被某数整除。返回真或假。",s.Msg.MATH_IS_WHOLE="是整数",s.Msg.MATH_MODULO_HELPURL="https://zh.wikipedia.org/wiki/模除",s.Msg.MATH_MODULO_TITLE="%1 ÷ %2 的余数",s.Msg.MATH_MODULO_TOOLTIP="返回两个数相除的余数。",s.Msg.MATH_MULTIPLICATION_SYMBOL="×",s.Msg.MATH_NUMBER_HELPURL="https://zh.wikipedia.org/wiki/数",s.Msg.MATH_NUMBER_TOOLTIP="一个数。",s.Msg.MATH_ONLIST_HELPURL="",s.Msg.MATH_ONLIST_OPERATOR_AVERAGE="列表的平均",s.Msg.MATH_ONLIST_OPERATOR_MAX="列表的最大数",s.Msg.MATH_ONLIST_OPERATOR_MEDIAN="列表的中位数",s.Msg.MATH_ONLIST_OPERATOR_MIN="列表的最小数",s.Msg.MATH_ONLIST_OPERATOR_MODE="列表的众数",s.Msg.MATH_ONLIST_OPERATOR_RANDOM="列表的随机项",s.Msg.MATH_ONLIST_OPERATOR_STD_DEV="列表的标准差",s.Msg.MATH_ONLIST_OPERATOR_SUM="列表的和",s.Msg.MATH_ONLIST_TOOLTIP_AVERAGE="返回列表内数值的平均（算术平均）。",s.Msg.MATH_ONLIST_TOOLTIP_MAX="返回列表内的最大数。",s.Msg.MATH_ONLIST_TOOLTIP_MEDIAN="返回列表内数的中位数。",s.Msg.MATH_ONLIST_TOOLTIP_MIN="返回列表内的最小数。",s.Msg.MATH_ONLIST_TOOLTIP_MODE="返回列表中的出现次数最多的项的列表。",s.Msg.MATH_ONLIST_TOOLTIP_RANDOM="返回列表内的一个随机元素。",s.Msg.MATH_ONLIST_TOOLTIP_STD_DEV="返回列表的标准差。",s.Msg.MATH_ONLIST_TOOLTIP_SUM="返回列表内的所有数的和。",s.Msg.MATH_POWER_SYMBOL="^",s.Msg.MATH_RANDOM_FLOAT_HELPURL="https://zh.wikipedia.org/wiki/随机数生成器",s.Msg.MATH_RANDOM_FLOAT_TITLE_RANDOM="随机小数",s.Msg.MATH_RANDOM_FLOAT_TOOLTIP="返回一个从0.0（含）到1.0（不含）之间的随机数。",s.Msg.MATH_RANDOM_INT_HELPURL="https://zh.wikipedia.org/wiki/随机数生成器",s.Msg.MATH_RANDOM_INT_TITLE="从 %1 到 %2 范围内的随机整数",s.Msg.MATH_RANDOM_INT_TOOLTIP="返回两个指定的极限（含）之间的随机整数。",s.Msg.MATH_ROUND_HELPURL="https://zh.wikipedia.org/wiki/数值修约",s.Msg.MATH_ROUND_OPERATOR_ROUND="四舍五入",s.Msg.MATH_ROUND_OPERATOR_ROUNDDOWN="向下舍入",s.Msg.MATH_ROUND_OPERATOR_ROUNDUP="向上舍入",s.Msg.MATH_ROUND_TOOLTIP="数向上或向下取整。",s.Msg.MATH_SINGLE_HELPURL="https://zh.wikipedia.org/wiki/平方根",s.Msg.MATH_SINGLE_OP_ABSOLUTE="绝对值",s.Msg.MATH_SINGLE_OP_ROOT="平方根",s.Msg.MATH_SINGLE_TOOLTIP_ABS="返回一个数的绝对值。",s.Msg.MATH_SINGLE_TOOLTIP_EXP="返回e的一个数次幂。",s.Msg.MATH_SINGLE_TOOLTIP_LN="返回一个数的自然对数。",s.Msg.MATH_SINGLE_TOOLTIP_LOG10="返回一个数的以10为底的对数。",s.Msg.MATH_SINGLE_TOOLTIP_NEG="返回一个数的相反数。",s.Msg.MATH_SINGLE_TOOLTIP_POW10="返回10的一个数次幂。",s.Msg.MATH_SINGLE_TOOLTIP_ROOT="返回一个数的平方根。",s.Msg.MATH_SUBTRACTION_SYMBOL="-",s.Msg.MATH_TRIG_ACOS="反余弦",s.Msg.MATH_TRIG_ASIN="反正弦",s.Msg.MATH_TRIG_ATAN="反正切",s.Msg.MATH_TRIG_COS="余弦",s.Msg.MATH_TRIG_HELPURL="https://zh.wikipedia.org/wiki/三角函数",s.Msg.MATH_TRIG_SIN="正弦",s.Msg.MATH_TRIG_TAN="正切",s.Msg.MATH_TRIG_TOOLTIP_ACOS="返回一个数的反余弦。",s.Msg.MATH_TRIG_TOOLTIP_ASIN="返回一个数的反正弦。",s.Msg.MATH_TRIG_TOOLTIP_ATAN="返回一个数的反正切。",s.Msg.MATH_TRIG_TOOLTIP_COS="返回角度（非弧度）的余弦。",s.Msg.MATH_TRIG_TOOLTIP_SIN="返回角度（非弧度）的正弦。",s.Msg.MATH_TRIG_TOOLTIP_TAN="返回角度（非弧度）的正切。",s.Msg.NEW_COLOUR_VARIABLE="创建颜色变量...",s.Msg.NEW_NUMBER_VARIABLE="创建数变量...",s.Msg.NEW_STRING_VARIABLE="创建字符串变量...",s.Msg.NEW_VARIABLE="创建变量...",s.Msg.NEW_VARIABLE_TITLE="新变量的名称：",s.Msg.NEW_VARIABLE_TYPE_TITLE="新变量的类型：",s.Msg.ORDINAL_NUMBER_SUFFIX="",s.Msg.PROCEDURES_ALLOW_STATEMENTS="允许声明",s.Msg.PROCEDURES_BEFORE_PARAMS="与：",s.Msg.PROCEDURES_CALLNORETURN_HELPURL="https://zh.wikipedia.org/wiki/子程序",s.Msg.PROCEDURES_CALLNORETURN_TOOLTIP="运行用户定义的函数“%1”。",s.Msg.PROCEDURES_CALLRETURN_HELPURL="https://zh.wikipedia.org/wiki/子程序",s.Msg.PROCEDURES_CALLRETURN_TOOLTIP="运行用户定义的函数“%1”，并使用它的输出值。",s.Msg.PROCEDURES_CALL_BEFORE_PARAMS="与：",s.Msg.PROCEDURES_CALL_DISABLED_DEF_WARNING="Can't run the user-defined function '%1' because the definition block is disabled.",s.Msg.PROCEDURES_CREATE_DO="创建“%1”",s.Msg.PROCEDURES_DEFNORETURN_COMMENT="描述该功能...",s.Msg.PROCEDURES_DEFNORETURN_DO="",s.Msg.PROCEDURES_DEFNORETURN_HELPURL="https://zh.wikipedia.org/wiki/子程序",s.Msg.PROCEDURES_DEFNORETURN_PROCEDURE="做点什么",s.Msg.PROCEDURES_DEFNORETURN_TITLE="至",s.Msg.PROCEDURES_DEFNORETURN_TOOLTIP="创建一个不带输出值的函数。",s.Msg.PROCEDURES_DEFRETURN_HELPURL="https://zh.wikipedia.org/wiki/子程序",s.Msg.PROCEDURES_DEFRETURN_RETURN="返回",s.Msg.PROCEDURES_DEFRETURN_TOOLTIP="创建一个有输出值的函数。",s.Msg.PROCEDURES_DEF_DUPLICATE_WARNING="警告：此函数具有重复参数。",s.Msg.PROCEDURES_HIGHLIGHT_DEF="突出显示函数定义",s.Msg.PROCEDURES_IFRETURN_HELPURL="https://c2.com/cgi/wiki?GuardClause",s.Msg.PROCEDURES_IFRETURN_TOOLTIP="如果值为真，则返回第二个值。",s.Msg.PROCEDURES_IFRETURN_WARNING="警告：这个块只能在函数内部使用。",s.Msg.PROCEDURES_MUTATORARG_TITLE="输入名称：",s.Msg.PROCEDURES_MUTATORARG_TOOLTIP="添加函数输入。",s.Msg.PROCEDURES_MUTATORCONTAINER_TITLE="输入",s.Msg.PROCEDURES_MUTATORCONTAINER_TOOLTIP="添加、移除或重新排此函数的输入。",s.Msg.REDO="重做",s.Msg.REMOVE_COMMENT="删除注释",s.Msg.RENAME_VARIABLE="重命名变量...",s.Msg.RENAME_VARIABLE_TITLE="将所有“%1”变量重命名为:",s.Msg.TEXT_APPEND_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",s.Msg.TEXT_APPEND_TITLE="在%1之后加上文本%2",s.Msg.TEXT_APPEND_TOOLTIP="将一些文本追加到变量“%1”里。",s.Msg.TEXT_CHANGECASE_HELPURL="https://github.com/google/blockly/wiki/Text#adjusting-text-case",s.Msg.TEXT_CHANGECASE_OPERATOR_LOWERCASE="转为小写",s.Msg.TEXT_CHANGECASE_OPERATOR_TITLECASE="转为首字母大写",s.Msg.TEXT_CHANGECASE_OPERATOR_UPPERCASE="转为大写",s.Msg.TEXT_CHANGECASE_TOOLTIP="用不同的大小写模式复制并返回这段文字。",s.Msg.TEXT_CHARAT_FIRST="获取第一个字符",s.Msg.TEXT_CHARAT_FROM_END="获取倒数第#个字符",s.Msg.TEXT_CHARAT_FROM_START="获取第#个字符",s.Msg.TEXT_CHARAT_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-text",s.Msg.TEXT_CHARAT_LAST="获取最后一个字符",s.Msg.TEXT_CHARAT_RANDOM="获取随机一个字符",s.Msg.TEXT_CHARAT_TAIL="",s.Msg.TEXT_CHARAT_TITLE="在文本%1 里 %2",s.Msg.TEXT_CHARAT_TOOLTIP="返回位于指定位置的字符。",s.Msg.TEXT_COUNT_HELPURL="https://github.com/google/blockly/wiki/Text#counting-substrings",s.Msg.TEXT_COUNT_MESSAGE0="计算%1在%2里出现的次数",s.Msg.TEXT_COUNT_TOOLTIP="计算在一段文本中，某个部分文本重复出现了多少次。",s.Msg.TEXT_CREATE_JOIN_ITEM_TOOLTIP="将一个项添加到文本中。",s.Msg.TEXT_CREATE_JOIN_TITLE_JOIN="拼接",s.Msg.TEXT_CREATE_JOIN_TOOLTIP="添加、移除或重新排列各节来重新配置这个文本块。",s.Msg.TEXT_GET_SUBSTRING_END_FROM_END="到倒数第#个字符",s.Msg.TEXT_GET_SUBSTRING_END_FROM_START="到第#个字符",s.Msg.TEXT_GET_SUBSTRING_END_LAST="到最后一个字符",s.Msg.TEXT_GET_SUBSTRING_HELPURL="https://github.com/google/blockly/wiki/Text#extracting-a-region-of-text",s.Msg.TEXT_GET_SUBSTRING_INPUT_IN_TEXT="从文本",s.Msg.TEXT_GET_SUBSTRING_START_FIRST="获取子串，从第一个字符",s.Msg.TEXT_GET_SUBSTRING_START_FROM_END="获取子串，从倒数第#个字符",s.Msg.TEXT_GET_SUBSTRING_START_FROM_START="获取子串，从第#个字符",s.Msg.TEXT_GET_SUBSTRING_TAIL="",s.Msg.TEXT_GET_SUBSTRING_TOOLTIP="返回文本中指定的一部分。",s.Msg.TEXT_INDEXOF_HELPURL="https://github.com/google/blockly/wiki/Text#finding-text",s.Msg.TEXT_INDEXOF_OPERATOR_FIRST="寻找第一次出现的文本",s.Msg.TEXT_INDEXOF_OPERATOR_LAST="寻找最后一次出现的文本",s.Msg.TEXT_INDEXOF_TITLE="在文本 %1 里 %2 %3",s.Msg.TEXT_INDEXOF_TOOLTIP="返回第一个文本段在第二个文本段中的第一/最后一个匹配项的起始位置。如果未找到，则返回%1。",s.Msg.TEXT_ISEMPTY_HELPURL="https://github.com/google/blockly/wiki/Text#checking-for-empty-text",s.Msg.TEXT_ISEMPTY_TITLE="%1是空的",s.Msg.TEXT_ISEMPTY_TOOLTIP="如果给定的文本为空，则返回真。",s.Msg.TEXT_JOIN_HELPURL="https://github.com/google/blockly/wiki/Text#text-creation",s.Msg.TEXT_JOIN_TITLE_CREATEWITH="创建文本，内容：",s.Msg.TEXT_JOIN_TOOLTIP="通过串起任意数量的项以建立一段文本。",s.Msg.TEXT_LENGTH_HELPURL="https://github.com/google/blockly/wiki/Text#text-modification",s.Msg.TEXT_LENGTH_TITLE="%1的长度",s.Msg.TEXT_LENGTH_TOOLTIP="返回给定文本的字母数（包括空格）。",s.Msg.TEXT_PRINT_HELPURL="https://github.com/google/blockly/wiki/Text#printing-text",s.Msg.TEXT_PRINT_TITLE="输出%1",s.Msg.TEXT_PRINT_TOOLTIP="打印指定的文字、数或其他值。",s.Msg.TEXT_PROMPT_HELPURL="https://github.com/google/blockly/wiki/Text#getting-input-from-the-user",s.Msg.TEXT_PROMPT_TOOLTIP_NUMBER="提示用户输入一个数。",s.Msg.TEXT_PROMPT_TOOLTIP_TEXT="要求用户输入一些文本。",s.Msg.TEXT_PROMPT_TYPE_NUMBER="提示输入数并显示消息",s.Msg.TEXT_PROMPT_TYPE_TEXT="要求输入文本，并显示提示消息",s.Msg.TEXT_REPLACE_HELPURL="https://github.com/google/blockly/wiki/Text#replacing-substrings",s.Msg.TEXT_REPLACE_MESSAGE0="把%3中的%1替换为%2",s.Msg.TEXT_REPLACE_TOOLTIP="在一段文本中，将出现过的某部分文本都替换掉。",s.Msg.TEXT_REVERSE_HELPURL="https://github.com/google/blockly/wiki/Text#reversing-text",s.Msg.TEXT_REVERSE_MESSAGE0="倒转文本%1",s.Msg.TEXT_REVERSE_TOOLTIP="将文本中各个字符的顺序倒转。",s.Msg.TEXT_TEXT_HELPURL="https://zh.wikipedia.org/wiki/字符串",s.Msg.TEXT_TEXT_TOOLTIP="一个字、词或一行文本。",s.Msg.TEXT_TRIM_HELPURL="https://github.com/google/blockly/wiki/Text#trimming-removing-spaces",s.Msg.TEXT_TRIM_OPERATOR_BOTH="消除其两侧的空格",s.Msg.TEXT_TRIM_OPERATOR_LEFT="消除其左侧的空格",s.Msg.TEXT_TRIM_OPERATOR_RIGHT="消除其右侧的空格",s.Msg.TEXT_TRIM_TOOLTIP="从某一端或同时从两端删除多余的空白，并返回这段文字的一个副本。",s.Msg.TODAY="今天",s.Msg.UNDO="撤销",s.Msg.UNNAMED_KEY="未命名",s.Msg.VARIABLES_DEFAULT_NAME="项目",s.Msg.VARIABLES_GET_CREATE_SET="创建“设定%1”",s.Msg.VARIABLES_GET_HELPURL="https://github.com/google/blockly/wiki/Variables#get",s.Msg.VARIABLES_GET_TOOLTIP="返回此变量的值。",s.Msg.VARIABLES_SET="赋值 %1 为 %2",s.Msg.VARIABLES_SET_CREATE_GET="创建“获得%1”",s.Msg.VARIABLES_SET_HELPURL="https://github.com/google/blockly/wiki/Variables#set",s.Msg.VARIABLES_SET_TOOLTIP="设置此变量，以使它和输入值相等。",s.Msg.VARIABLE_ALREADY_EXISTS="名字叫“%1”的变量已经存在了。",s.Msg.VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE="名字叫“%1”的变量已经有了另一个类型：“%2”。",s.Msg.VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER="名为“%1”的变量已经作为参数存在于流程“%2”中。",s.Msg.WORKSPACE_ARIA_LABEL="Blockly工作区",s.Msg.WORKSPACE_COMMENT_DEFAULT_TEXT="说点什么...",s.Msg.CONTROLS_FOREACH_INPUT_DO=s.Msg.CONTROLS_REPEAT_INPUT_DO,s.Msg.CONTROLS_FOR_INPUT_DO=s.Msg.CONTROLS_REPEAT_INPUT_DO,s.Msg.CONTROLS_IF_ELSEIF_TITLE_ELSEIF=s.Msg.CONTROLS_IF_MSG_ELSEIF,s.Msg.CONTROLS_IF_ELSE_TITLE_ELSE=s.Msg.CONTROLS_IF_MSG_ELSE,s.Msg.CONTROLS_IF_IF_TITLE_IF=s.Msg.CONTROLS_IF_MSG_IF,s.Msg.CONTROLS_IF_MSG_THEN=s.Msg.CONTROLS_REPEAT_INPUT_DO,s.Msg.CONTROLS_WHILEUNTIL_INPUT_DO=s.Msg.CONTROLS_REPEAT_INPUT_DO,s.Msg.LISTS_CREATE_WITH_ITEM_TITLE=s.Msg.VARIABLES_DEFAULT_NAME,s.Msg.LISTS_GET_INDEX_INPUT_IN_LIST=s.Msg.LISTS_INLIST,s.Msg.LISTS_GET_SUBLIST_INPUT_IN_LIST=s.Msg.LISTS_INLIST,s.Msg.LISTS_INDEX_OF_INPUT_IN_LIST=s.Msg.LISTS_INLIST,s.Msg.LISTS_SET_INDEX_INPUT_IN_LIST=s.Msg.LISTS_INLIST,s.Msg.MATH_CHANGE_TITLE_ITEM=s.Msg.VARIABLES_DEFAULT_NAME,s.Msg.PROCEDURES_DEFRETURN_COMMENT=s.Msg.PROCEDURES_DEFNORETURN_COMMENT,s.Msg.PROCEDURES_DEFRETURN_DO=s.Msg.PROCEDURES_DEFNORETURN_DO,s.Msg.PROCEDURES_DEFRETURN_PROCEDURE=s.Msg.PROCEDURES_DEFNORETURN_PROCEDURE,s.Msg.PROCEDURES_DEFRETURN_TITLE=s.Msg.PROCEDURES_DEFNORETURN_TITLE,s.Msg.TEXT_APPEND_VARIABLE=s.Msg.VARIABLES_DEFAULT_NAME,s.Msg.TEXT_CREATE_JOIN_ITEM_TITLE_ITEM=s.Msg.VARIABLES_DEFAULT_NAME,s.Msg.COLOUR_HUE="20",s.Msg.LISTS_HUE="260",s.Msg.LOGIC_HUE="210",s.Msg.LOOPS_HUE="120",s.Msg.MATH_HUE="230",s.Msg.PROCEDURES_HUE="290",s.Msg.TEXTS_HUE="160",s.Msg.VARIABLES_DYNAMIC_HUE="310",s.Msg.VARIABLES_HUE="330",s.Msg})})(dv);var QC=dv.exports;const ew=co(QC),{LOGIC_HUE:tw,LOOPS_HUE:sw,MATH_HUE:iw,TEXTS_HUE:rw,LISTS_HUE:nw,COLOUR_HUE:ow,VARIABLES_HUE:lw,VARIABLES_DYNAMIC_HUE:aw,PROCEDURES_HUE:cw,VARIABLES_DEFAULT_NAME:hw,UNNAMED_KEY:uw,TODAY:dw,DUPLICATE_BLOCK:pw,ADD_COMMENT:fw,REMOVE_COMMENT:gw,DUPLICATE_COMMENT:mw,EXTERNAL_INPUTS:_w,INLINE_INPUTS:$w,DELETE_BLOCK:Tw,DELETE_X_BLOCKS:bw,DELETE_ALL_BLOCKS:Ew,CLEAN_UP:yw,COLLAPSE_BLOCK:vw,COLLAPSE_ALL:Sw,EXPAND_BLOCK:Iw,EXPAND_ALL:xw,DISABLE_BLOCK:Cw,ENABLE_BLOCK:ww,HELP:Rw,UNDO:kw,REDO:Ow,CHANGE_VALUE_TITLE:Aw,RENAME_VARIABLE:Mw,RENAME_VARIABLE_TITLE:Lw,NEW_VARIABLE:Pw,NEW_STRING_VARIABLE:Nw,NEW_NUMBER_VARIABLE:Dw,NEW_COLOUR_VARIABLE:Bw,NEW_VARIABLE_TYPE_TITLE:Fw,NEW_VARIABLE_TITLE:Uw,VARIABLE_ALREADY_EXISTS:Gw,VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE:Hw,VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER:Vw,DELETE_VARIABLE_CONFIRMATION:Ww,CANNOT_DELETE_VARIABLE_PROCEDURE:zw,DELETE_VARIABLE:Xw,COLOUR_PICKER_HELPURL:Yw,COLOUR_PICKER_TOOLTIP:Kw,COLOUR_RANDOM_HELPURL:jw,COLOUR_RANDOM_TITLE:qw,COLOUR_RANDOM_TOOLTIP:Jw,COLOUR_RGB_HELPURL:Zw,COLOUR_RGB_TITLE:Qw,COLOUR_RGB_RED:eR,COLOUR_RGB_GREEN:tR,COLOUR_RGB_BLUE:sR,COLOUR_RGB_TOOLTIP:iR,COLOUR_BLEND_HELPURL:rR,COLOUR_BLEND_TITLE:nR,COLOUR_BLEND_COLOUR1:oR,COLOUR_BLEND_COLOUR2:lR,COLOUR_BLEND_RATIO:aR,COLOUR_BLEND_TOOLTIP:cR,CONTROLS_REPEAT_HELPURL:hR,CONTROLS_REPEAT_TITLE:uR,CONTROLS_REPEAT_INPUT_DO:dR,CONTROLS_REPEAT_TOOLTIP:pR,CONTROLS_WHILEUNTIL_HELPURL:fR,CONTROLS_WHILEUNTIL_INPUT_DO:gR,CONTROLS_WHILEUNTIL_OPERATOR_WHILE:mR,CONTROLS_WHILEUNTIL_OPERATOR_UNTIL:_R,CONTROLS_WHILEUNTIL_TOOLTIP_WHILE:$R,CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL:TR,CONTROLS_FOR_HELPURL:bR,CONTROLS_FOR_TOOLTIP:ER,CONTROLS_FOR_TITLE:yR,CONTROLS_FOR_INPUT_DO:vR,CONTROLS_FOREACH_HELPURL:SR,CONTROLS_FOREACH_TITLE:IR,CONTROLS_FOREACH_INPUT_DO:xR,CONTROLS_FOREACH_TOOLTIP:CR,CONTROLS_FLOW_STATEMENTS_HELPURL:wR,CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK:RR,CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE:kR,CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK:OR,CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE:AR,CONTROLS_FLOW_STATEMENTS_WARNING:MR,CONTROLS_IF_HELPURL:LR,CONTROLS_IF_TOOLTIP_1:PR,CONTROLS_IF_TOOLTIP_2:NR,CONTROLS_IF_TOOLTIP_3:DR,CONTROLS_IF_TOOLTIP_4:BR,CONTROLS_IF_MSG_IF:FR,CONTROLS_IF_MSG_ELSEIF:UR,CONTROLS_IF_MSG_ELSE:GR,CONTROLS_IF_MSG_THEN:HR,CONTROLS_IF_IF_TITLE_IF:VR,CONTROLS_IF_IF_TOOLTIP:WR,CONTROLS_IF_ELSEIF_TITLE_ELSEIF:zR,CONTROLS_IF_ELSEIF_TOOLTIP:XR,CONTROLS_IF_ELSE_TITLE_ELSE:YR,CONTROLS_IF_ELSE_TOOLTIP:KR,LOGIC_COMPARE_HELPURL:jR,LOGIC_COMPARE_TOOLTIP_EQ:qR,LOGIC_COMPARE_TOOLTIP_NEQ:JR,LOGIC_COMPARE_TOOLTIP_LT:ZR,LOGIC_COMPARE_TOOLTIP_LTE:QR,LOGIC_COMPARE_TOOLTIP_GT:ek,LOGIC_COMPARE_TOOLTIP_GTE:tk,LOGIC_OPERATION_HELPURL:sk,LOGIC_OPERATION_TOOLTIP_AND:ik,LOGIC_OPERATION_AND:rk,LOGIC_OPERATION_TOOLTIP_OR:nk,LOGIC_OPERATION_OR:ok,LOGIC_NEGATE_HELPURL:lk,LOGIC_NEGATE_TITLE:ak,LOGIC_NEGATE_TOOLTIP:ck,LOGIC_BOOLEAN_HELPURL:hk,LOGIC_BOOLEAN_TRUE:uk,LOGIC_BOOLEAN_FALSE:dk,LOGIC_BOOLEAN_TOOLTIP:pk,LOGIC_NULL_HELPURL:fk,LOGIC_NULL:gk,LOGIC_NULL_TOOLTIP:mk,LOGIC_TERNARY_HELPURL:_k,LOGIC_TERNARY_CONDITION:$k,LOGIC_TERNARY_IF_TRUE:Tk,LOGIC_TERNARY_IF_FALSE:bk,LOGIC_TERNARY_TOOLTIP:Ek,MATH_NUMBER_HELPURL:yk,MATH_NUMBER_TOOLTIP:vk,MATH_ADDITION_SYMBOL:Sk,MATH_SUBTRACTION_SYMBOL:Ik,MATH_DIVISION_SYMBOL:xk,MATH_MULTIPLICATION_SYMBOL:Ck,MATH_POWER_SYMBOL:wk,MATH_TRIG_SIN:Rk,MATH_TRIG_COS:kk,MATH_TRIG_TAN:Ok,MATH_TRIG_ASIN:Ak,MATH_TRIG_ACOS:Mk,MATH_TRIG_ATAN:Lk,MATH_ARITHMETIC_HELPURL:Pk,MATH_ARITHMETIC_TOOLTIP_ADD:Nk,MATH_ARITHMETIC_TOOLTIP_MINUS:Dk,MATH_ARITHMETIC_TOOLTIP_MULTIPLY:Bk,MATH_ARITHMETIC_TOOLTIP_DIVIDE:Fk,MATH_ARITHMETIC_TOOLTIP_POWER:Uk,MATH_SINGLE_HELPURL:Gk,MATH_SINGLE_OP_ROOT:Hk,MATH_SINGLE_TOOLTIP_ROOT:Vk,MATH_SINGLE_OP_ABSOLUTE:Wk,MATH_SINGLE_TOOLTIP_ABS:zk,MATH_SINGLE_TOOLTIP_NEG:Xk,MATH_SINGLE_TOOLTIP_LN:Yk,MATH_SINGLE_TOOLTIP_LOG10:Kk,MATH_SINGLE_TOOLTIP_EXP:jk,MATH_SINGLE_TOOLTIP_POW10:qk,MATH_TRIG_HELPURL:Jk,MATH_TRIG_TOOLTIP_SIN:Zk,MATH_TRIG_TOOLTIP_COS:Qk,MATH_TRIG_TOOLTIP_TAN:eO,MATH_TRIG_TOOLTIP_ASIN:tO,MATH_TRIG_TOOLTIP_ACOS:sO,MATH_TRIG_TOOLTIP_ATAN:iO,MATH_CONSTANT_HELPURL:rO,MATH_CONSTANT_TOOLTIP:nO,MATH_IS_EVEN:oO,MATH_IS_ODD:lO,MATH_IS_PRIME:aO,MATH_IS_WHOLE:cO,MATH_IS_POSITIVE:hO,MATH_IS_NEGATIVE:uO,MATH_IS_DIVISIBLE_BY:dO,MATH_IS_TOOLTIP:pO,MATH_CHANGE_HELPURL:fO,MATH_CHANGE_TITLE:gO,MATH_CHANGE_TITLE_ITEM:mO,MATH_CHANGE_TOOLTIP:_O,MATH_ROUND_HELPURL:$O,MATH_ROUND_TOOLTIP:TO,MATH_ROUND_OPERATOR_ROUND:bO,MATH_ROUND_OPERATOR_ROUNDUP:EO,MATH_ROUND_OPERATOR_ROUNDDOWN:yO,MATH_ONLIST_HELPURL:vO,MATH_ONLIST_OPERATOR_SUM:SO,MATH_ONLIST_TOOLTIP_SUM:IO,MATH_ONLIST_OPERATOR_MIN:xO,MATH_ONLIST_TOOLTIP_MIN:CO,MATH_ONLIST_OPERATOR_MAX:wO,MATH_ONLIST_TOOLTIP_MAX:RO,MATH_ONLIST_OPERATOR_AVERAGE:kO,MATH_ONLIST_TOOLTIP_AVERAGE:OO,MATH_ONLIST_OPERATOR_MEDIAN:AO,MATH_ONLIST_TOOLTIP_MEDIAN:MO,MATH_ONLIST_OPERATOR_MODE:LO,MATH_ONLIST_TOOLTIP_MODE:PO,MATH_ONLIST_OPERATOR_STD_DEV:NO,MATH_ONLIST_TOOLTIP_STD_DEV:DO,MATH_ONLIST_OPERATOR_RANDOM:BO,MATH_ONLIST_TOOLTIP_RANDOM:FO,MATH_MODULO_HELPURL:UO,MATH_MODULO_TITLE:GO,MATH_MODULO_TOOLTIP:HO,MATH_CONSTRAIN_HELPURL:VO,MATH_CONSTRAIN_TITLE:WO,MATH_CONSTRAIN_TOOLTIP:zO,MATH_RANDOM_INT_HELPURL:XO,MATH_RANDOM_INT_TITLE:YO,MATH_RANDOM_INT_TOOLTIP:KO,MATH_RANDOM_FLOAT_HELPURL:jO,MATH_RANDOM_FLOAT_TITLE_RANDOM:qO,MATH_RANDOM_FLOAT_TOOLTIP:JO,MATH_ATAN2_HELPURL:ZO,MATH_ATAN2_TITLE:QO,MATH_ATAN2_TOOLTIP:eA,TEXT_TEXT_HELPURL:tA,TEXT_TEXT_TOOLTIP:sA,TEXT_JOIN_HELPURL:iA,TEXT_JOIN_TITLE_CREATEWITH:rA,TEXT_JOIN_TOOLTIP:nA,TEXT_CREATE_JOIN_TITLE_JOIN:oA,TEXT_CREATE_JOIN_TOOLTIP:lA,TEXT_CREATE_JOIN_ITEM_TITLE_ITEM:aA,TEXT_CREATE_JOIN_ITEM_TOOLTIP:cA,TEXT_APPEND_HELPURL:hA,TEXT_APPEND_TITLE:uA,TEXT_APPEND_VARIABLE:dA,TEXT_APPEND_TOOLTIP:pA,TEXT_LENGTH_HELPURL:fA,TEXT_LENGTH_TITLE:gA,TEXT_LENGTH_TOOLTIP:mA,TEXT_ISEMPTY_HELPURL:_A,TEXT_ISEMPTY_TITLE:$A,TEXT_ISEMPTY_TOOLTIP:TA,TEXT_INDEXOF_HELPURL:bA,TEXT_INDEXOF_TOOLTIP:EA,TEXT_INDEXOF_TITLE:yA,TEXT_INDEXOF_OPERATOR_FIRST:vA,TEXT_INDEXOF_OPERATOR_LAST:SA,TEXT_CHARAT_HELPURL:IA,TEXT_CHARAT_TITLE:xA,TEXT_CHARAT_FROM_START:CA,TEXT_CHARAT_FROM_END:wA,TEXT_CHARAT_FIRST:RA,TEXT_CHARAT_LAST:kA,TEXT_CHARAT_RANDOM:OA,TEXT_CHARAT_TAIL:AA,TEXT_CHARAT_TOOLTIP:MA,TEXT_GET_SUBSTRING_TOOLTIP:LA,TEXT_GET_SUBSTRING_HELPURL:PA,TEXT_GET_SUBSTRING_INPUT_IN_TEXT:NA,TEXT_GET_SUBSTRING_START_FROM_START:DA,TEXT_GET_SUBSTRING_START_FROM_END:BA,TEXT_GET_SUBSTRING_START_FIRST:FA,TEXT_GET_SUBSTRING_END_FROM_START:UA,TEXT_GET_SUBSTRING_END_FROM_END:GA,TEXT_GET_SUBSTRING_END_LAST:HA,TEXT_GET_SUBSTRING_TAIL:VA,TEXT_CHANGECASE_HELPURL:WA,TEXT_CHANGECASE_TOOLTIP:zA,TEXT_CHANGECASE_OPERATOR_UPPERCASE:XA,TEXT_CHANGECASE_OPERATOR_LOWERCASE:YA,TEXT_CHANGECASE_OPERATOR_TITLECASE:KA,TEXT_TRIM_HELPURL:jA,TEXT_TRIM_TOOLTIP:qA,TEXT_TRIM_OPERATOR_BOTH:JA,TEXT_TRIM_OPERATOR_LEFT:ZA,TEXT_TRIM_OPERATOR_RIGHT:QA,TEXT_PRINT_HELPURL:eM,TEXT_PRINT_TITLE:tM,TEXT_PRINT_TOOLTIP:sM,TEXT_PROMPT_HELPURL:iM,TEXT_PROMPT_TYPE_TEXT:rM,TEXT_PROMPT_TYPE_NUMBER:nM,TEXT_PROMPT_TOOLTIP_NUMBER:oM,TEXT_PROMPT_TOOLTIP_TEXT:lM,TEXT_COUNT_MESSAGE0:aM,TEXT_COUNT_HELPURL:cM,TEXT_COUNT_TOOLTIP:hM,TEXT_REPLACE_MESSAGE0:uM,TEXT_REPLACE_HELPURL:dM,TEXT_REPLACE_TOOLTIP:pM,TEXT_REVERSE_MESSAGE0:fM,TEXT_REVERSE_HELPURL:gM,TEXT_REVERSE_TOOLTIP:mM,LISTS_CREATE_EMPTY_HELPURL:_M,LISTS_CREATE_EMPTY_TITLE:$M,LISTS_CREATE_EMPTY_TOOLTIP:TM,LISTS_CREATE_WITH_HELPURL:bM,LISTS_CREATE_WITH_TOOLTIP:EM,LISTS_CREATE_WITH_INPUT_WITH:yM,LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:vM,LISTS_CREATE_WITH_CONTAINER_TOOLTIP:SM,LISTS_CREATE_WITH_ITEM_TITLE:IM,LISTS_CREATE_WITH_ITEM_TOOLTIP:xM,LISTS_REPEAT_HELPURL:CM,LISTS_REPEAT_TOOLTIP:wM,LISTS_REPEAT_TITLE:RM,LISTS_LENGTH_HELPURL:kM,LISTS_LENGTH_TITLE:OM,LISTS_LENGTH_TOOLTIP:AM,LISTS_ISEMPTY_HELPURL:MM,LISTS_ISEMPTY_TITLE:LM,LISTS_ISEMPTY_TOOLTIP:PM,LISTS_INLIST:NM,LISTS_INDEX_OF_HELPURL:DM,LISTS_INDEX_OF_INPUT_IN_LIST:BM,LISTS_INDEX_OF_FIRST:FM,LISTS_INDEX_OF_LAST:UM,LISTS_INDEX_OF_TOOLTIP:GM,LISTS_GET_INDEX_HELPURL:HM,LISTS_GET_INDEX_GET:VM,LISTS_GET_INDEX_GET_REMOVE:WM,LISTS_GET_INDEX_REMOVE:zM,LISTS_GET_INDEX_FROM_START:XM,LISTS_GET_INDEX_FROM_END:YM,LISTS_GET_INDEX_FIRST:KM,LISTS_GET_INDEX_LAST:jM,LISTS_GET_INDEX_RANDOM:qM,LISTS_GET_INDEX_TAIL:JM,LISTS_GET_INDEX_INPUT_IN_LIST:ZM,LISTS_INDEX_FROM_START_TOOLTIP:QM,LISTS_INDEX_FROM_END_TOOLTIP:eL,LISTS_GET_INDEX_TOOLTIP_GET_FROM:tL,LISTS_GET_INDEX_TOOLTIP_GET_FIRST:sL,LISTS_GET_INDEX_TOOLTIP_GET_LAST:iL,LISTS_GET_INDEX_TOOLTIP_GET_RANDOM:rL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM:nL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST:oL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST:lL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM:aL,LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM:cL,LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST:hL,LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST:uL,LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM:dL,LISTS_SET_INDEX_HELPURL:pL,LISTS_SET_INDEX_INPUT_IN_LIST:fL,LISTS_SET_INDEX_SET:gL,LISTS_SET_INDEX_INSERT:mL,LISTS_SET_INDEX_INPUT_TO:_L,LISTS_SET_INDEX_TOOLTIP_SET_FROM:$L,LISTS_SET_INDEX_TOOLTIP_SET_FIRST:TL,LISTS_SET_INDEX_TOOLTIP_SET_LAST:bL,LISTS_SET_INDEX_TOOLTIP_SET_RANDOM:EL,LISTS_SET_INDEX_TOOLTIP_INSERT_FROM:yL,LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST:vL,LISTS_SET_INDEX_TOOLTIP_INSERT_LAST:SL,LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM:IL,LISTS_GET_SUBLIST_HELPURL:xL,LISTS_GET_SUBLIST_INPUT_IN_LIST:CL,LISTS_GET_SUBLIST_START_FROM_START:wL,LISTS_GET_SUBLIST_START_FROM_END:RL,LISTS_GET_SUBLIST_START_FIRST:kL,LISTS_GET_SUBLIST_END_FROM_START:OL,LISTS_GET_SUBLIST_END_FROM_END:AL,LISTS_GET_SUBLIST_END_LAST:ML,LISTS_GET_SUBLIST_TAIL:LL,LISTS_GET_SUBLIST_TOOLTIP:PL,LISTS_SORT_HELPURL:NL,LISTS_SORT_TITLE:DL,LISTS_SORT_TOOLTIP:BL,LISTS_SORT_ORDER_ASCENDING:FL,LISTS_SORT_ORDER_DESCENDING:UL,LISTS_SORT_TYPE_NUMERIC:GL,LISTS_SORT_TYPE_TEXT:HL,LISTS_SORT_TYPE_IGNORECASE:VL,LISTS_SPLIT_HELPURL:WL,LISTS_SPLIT_LIST_FROM_TEXT:zL,LISTS_SPLIT_TEXT_FROM_LIST:XL,LISTS_SPLIT_WITH_DELIMITER:YL,LISTS_SPLIT_TOOLTIP_SPLIT:KL,LISTS_SPLIT_TOOLTIP_JOIN:jL,LISTS_REVERSE_HELPURL:qL,LISTS_REVERSE_MESSAGE0:JL,LISTS_REVERSE_TOOLTIP:ZL,ORDINAL_NUMBER_SUFFIX:QL,VARIABLES_GET_HELPURL:e0,VARIABLES_GET_TOOLTIP:t0,VARIABLES_GET_CREATE_SET:s0,VARIABLES_SET_HELPURL:i0,VARIABLES_SET:r0,VARIABLES_SET_TOOLTIP:n0,VARIABLES_SET_CREATE_GET:o0,PROCEDURES_DEFNORETURN_HELPURL:l0,PROCEDURES_DEFNORETURN_TITLE:a0,PROCEDURES_DEFNORETURN_PROCEDURE:c0,PROCEDURES_BEFORE_PARAMS:h0,PROCEDURES_CALL_BEFORE_PARAMS:u0,PROCEDURES_CALL_DISABLED_DEF_WARNING:d0,PROCEDURES_DEFNORETURN_DO:p0,PROCEDURES_DEFNORETURN_TOOLTIP:f0,PROCEDURES_DEFNORETURN_COMMENT:g0,PROCEDURES_DEFRETURN_HELPURL:m0,PROCEDURES_DEFRETURN_TITLE:_0,PROCEDURES_DEFRETURN_PROCEDURE:$0,PROCEDURES_DEFRETURN_DO:T0,PROCEDURES_DEFRETURN_COMMENT:b0,PROCEDURES_DEFRETURN_RETURN:E0,PROCEDURES_DEFRETURN_TOOLTIP:y0,PROCEDURES_ALLOW_STATEMENTS:v0,PROCEDURES_DEF_DUPLICATE_WARNING:S0,PROCEDURES_CALLNORETURN_HELPURL:I0,PROCEDURES_CALLNORETURN_TOOLTIP:x0,PROCEDURES_CALLRETURN_HELPURL:C0,PROCEDURES_CALLRETURN_TOOLTIP:w0,PROCEDURES_MUTATORCONTAINER_TITLE:R0,PROCEDURES_MUTATORCONTAINER_TOOLTIP:k0,PROCEDURES_MUTATORARG_TITLE:O0,PROCEDURES_MUTATORARG_TOOLTIP:A0,PROCEDURES_HIGHLIGHT_DEF:M0,PROCEDURES_CREATE_DO:L0,PROCEDURES_IFRETURN_TOOLTIP:P0,PROCEDURES_IFRETURN_HELPURL:N0,PROCEDURES_IFRETURN_WARNING:D0,WORKSPACE_COMMENT_DEFAULT_TEXT:B0,WORKSPACE_ARIA_LABEL:F0,COLLAPSED_WARNINGS_WARNING:U0,DIALOG_OK:G0,DIALOG_CANCEL:H0}=ew,V0=Object.freeze(Object.defineProperty({__proto__:null,ADD_COMMENT:fw,CANNOT_DELETE_VARIABLE_PROCEDURE:zw,CHANGE_VALUE_TITLE:Aw,CLEAN_UP:yw,COLLAPSED_WARNINGS_WARNING:U0,COLLAPSE_ALL:Sw,COLLAPSE_BLOCK:vw,COLOUR_BLEND_COLOUR1:oR,COLOUR_BLEND_COLOUR2:lR,COLOUR_BLEND_HELPURL:rR,COLOUR_BLEND_RATIO:aR,COLOUR_BLEND_TITLE:nR,COLOUR_BLEND_TOOLTIP:cR,COLOUR_HUE:ow,COLOUR_PICKER_HELPURL:Yw,COLOUR_PICKER_TOOLTIP:Kw,COLOUR_RANDOM_HELPURL:jw,COLOUR_RANDOM_TITLE:qw,COLOUR_RANDOM_TOOLTIP:Jw,COLOUR_RGB_BLUE:sR,COLOUR_RGB_GREEN:tR,COLOUR_RGB_HELPURL:Zw,COLOUR_RGB_RED:eR,COLOUR_RGB_TITLE:Qw,COLOUR_RGB_TOOLTIP:iR,CONTROLS_FLOW_STATEMENTS_HELPURL:wR,CONTROLS_FLOW_STATEMENTS_OPERATOR_BREAK:RR,CONTROLS_FLOW_STATEMENTS_OPERATOR_CONTINUE:kR,CONTROLS_FLOW_STATEMENTS_TOOLTIP_BREAK:OR,CONTROLS_FLOW_STATEMENTS_TOOLTIP_CONTINUE:AR,CONTROLS_FLOW_STATEMENTS_WARNING:MR,CONTROLS_FOREACH_HELPURL:SR,CONTROLS_FOREACH_INPUT_DO:xR,CONTROLS_FOREACH_TITLE:IR,CONTROLS_FOREACH_TOOLTIP:CR,CONTROLS_FOR_HELPURL:bR,CONTROLS_FOR_INPUT_DO:vR,CONTROLS_FOR_TITLE:yR,CONTROLS_FOR_TOOLTIP:ER,CONTROLS_IF_ELSEIF_TITLE_ELSEIF:zR,CONTROLS_IF_ELSEIF_TOOLTIP:XR,CONTROLS_IF_ELSE_TITLE_ELSE:YR,CONTROLS_IF_ELSE_TOOLTIP:KR,CONTROLS_IF_HELPURL:LR,CONTROLS_IF_IF_TITLE_IF:VR,CONTROLS_IF_IF_TOOLTIP:WR,CONTROLS_IF_MSG_ELSE:GR,CONTROLS_IF_MSG_ELSEIF:UR,CONTROLS_IF_MSG_IF:FR,CONTROLS_IF_MSG_THEN:HR,CONTROLS_IF_TOOLTIP_1:PR,CONTROLS_IF_TOOLTIP_2:NR,CONTROLS_IF_TOOLTIP_3:DR,CONTROLS_IF_TOOLTIP_4:BR,CONTROLS_REPEAT_HELPURL:hR,CONTROLS_REPEAT_INPUT_DO:dR,CONTROLS_REPEAT_TITLE:uR,CONTROLS_REPEAT_TOOLTIP:pR,CONTROLS_WHILEUNTIL_HELPURL:fR,CONTROLS_WHILEUNTIL_INPUT_DO:gR,CONTROLS_WHILEUNTIL_OPERATOR_UNTIL:_R,CONTROLS_WHILEUNTIL_OPERATOR_WHILE:mR,CONTROLS_WHILEUNTIL_TOOLTIP_UNTIL:TR,CONTROLS_WHILEUNTIL_TOOLTIP_WHILE:$R,DELETE_ALL_BLOCKS:Ew,DELETE_BLOCK:Tw,DELETE_VARIABLE:Xw,DELETE_VARIABLE_CONFIRMATION:Ww,DELETE_X_BLOCKS:bw,DIALOG_CANCEL:H0,DIALOG_OK:G0,DISABLE_BLOCK:Cw,DUPLICATE_BLOCK:pw,DUPLICATE_COMMENT:mw,ENABLE_BLOCK:ww,EXPAND_ALL:xw,EXPAND_BLOCK:Iw,EXTERNAL_INPUTS:_w,HELP:Rw,INLINE_INPUTS:$w,LISTS_CREATE_EMPTY_HELPURL:_M,LISTS_CREATE_EMPTY_TITLE:$M,LISTS_CREATE_EMPTY_TOOLTIP:TM,LISTS_CREATE_WITH_CONTAINER_TITLE_ADD:vM,LISTS_CREATE_WITH_CONTAINER_TOOLTIP:SM,LISTS_CREATE_WITH_HELPURL:bM,LISTS_CREATE_WITH_INPUT_WITH:yM,LISTS_CREATE_WITH_ITEM_TITLE:IM,LISTS_CREATE_WITH_ITEM_TOOLTIP:xM,LISTS_CREATE_WITH_TOOLTIP:EM,LISTS_GET_INDEX_FIRST:KM,LISTS_GET_INDEX_FROM_END:YM,LISTS_GET_INDEX_FROM_START:XM,LISTS_GET_INDEX_GET:VM,LISTS_GET_INDEX_GET_REMOVE:WM,LISTS_GET_INDEX_HELPURL:HM,LISTS_GET_INDEX_INPUT_IN_LIST:ZM,LISTS_GET_INDEX_LAST:jM,LISTS_GET_INDEX_RANDOM:qM,LISTS_GET_INDEX_REMOVE:zM,LISTS_GET_INDEX_TAIL:JM,LISTS_GET_INDEX_TOOLTIP_GET_FIRST:sL,LISTS_GET_INDEX_TOOLTIP_GET_FROM:tL,LISTS_GET_INDEX_TOOLTIP_GET_LAST:iL,LISTS_GET_INDEX_TOOLTIP_GET_RANDOM:rL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FIRST:oL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_FROM:nL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_LAST:lL,LISTS_GET_INDEX_TOOLTIP_GET_REMOVE_RANDOM:aL,LISTS_GET_INDEX_TOOLTIP_REMOVE_FIRST:hL,LISTS_GET_INDEX_TOOLTIP_REMOVE_FROM:cL,LISTS_GET_INDEX_TOOLTIP_REMOVE_LAST:uL,LISTS_GET_INDEX_TOOLTIP_REMOVE_RANDOM:dL,LISTS_GET_SUBLIST_END_FROM_END:AL,LISTS_GET_SUBLIST_END_FROM_START:OL,LISTS_GET_SUBLIST_END_LAST:ML,LISTS_GET_SUBLIST_HELPURL:xL,LISTS_GET_SUBLIST_INPUT_IN_LIST:CL,LISTS_GET_SUBLIST_START_FIRST:kL,LISTS_GET_SUBLIST_START_FROM_END:RL,LISTS_GET_SUBLIST_START_FROM_START:wL,LISTS_GET_SUBLIST_TAIL:LL,LISTS_GET_SUBLIST_TOOLTIP:PL,LISTS_HUE:nw,LISTS_INDEX_FROM_END_TOOLTIP:eL,LISTS_INDEX_FROM_START_TOOLTIP:QM,LISTS_INDEX_OF_FIRST:FM,LISTS_INDEX_OF_HELPURL:DM,LISTS_INDEX_OF_INPUT_IN_LIST:BM,LISTS_INDEX_OF_LAST:UM,LISTS_INDEX_OF_TOOLTIP:GM,LISTS_INLIST:NM,LISTS_ISEMPTY_HELPURL:MM,LISTS_ISEMPTY_TITLE:LM,LISTS_ISEMPTY_TOOLTIP:PM,LISTS_LENGTH_HELPURL:kM,LISTS_LENGTH_TITLE:OM,LISTS_LENGTH_TOOLTIP:AM,LISTS_REPEAT_HELPURL:CM,LISTS_REPEAT_TITLE:RM,LISTS_REPEAT_TOOLTIP:wM,LISTS_REVERSE_HELPURL:qL,LISTS_REVERSE_MESSAGE0:JL,LISTS_REVERSE_TOOLTIP:ZL,LISTS_SET_INDEX_HELPURL:pL,LISTS_SET_INDEX_INPUT_IN_LIST:fL,LISTS_SET_INDEX_INPUT_TO:_L,LISTS_SET_INDEX_INSERT:mL,LISTS_SET_INDEX_SET:gL,LISTS_SET_INDEX_TOOLTIP_INSERT_FIRST:vL,LISTS_SET_INDEX_TOOLTIP_INSERT_FROM:yL,LISTS_SET_INDEX_TOOLTIP_INSERT_LAST:SL,LISTS_SET_INDEX_TOOLTIP_INSERT_RANDOM:IL,LISTS_SET_INDEX_TOOLTIP_SET_FIRST:TL,LISTS_SET_INDEX_TOOLTIP_SET_FROM:$L,LISTS_SET_INDEX_TOOLTIP_SET_LAST:bL,LISTS_SET_INDEX_TOOLTIP_SET_RANDOM:EL,LISTS_SORT_HELPURL:NL,LISTS_SORT_ORDER_ASCENDING:FL,LISTS_SORT_ORDER_DESCENDING:UL,LISTS_SORT_TITLE:DL,LISTS_SORT_TOOLTIP:BL,LISTS_SORT_TYPE_IGNORECASE:VL,LISTS_SORT_TYPE_NUMERIC:GL,LISTS_SORT_TYPE_TEXT:HL,LISTS_SPLIT_HELPURL:WL,LISTS_SPLIT_LIST_FROM_TEXT:zL,LISTS_SPLIT_TEXT_FROM_LIST:XL,LISTS_SPLIT_TOOLTIP_JOIN:jL,LISTS_SPLIT_TOOLTIP_SPLIT:KL,LISTS_SPLIT_WITH_DELIMITER:YL,LOGIC_BOOLEAN_FALSE:dk,LOGIC_BOOLEAN_HELPURL:hk,LOGIC_BOOLEAN_TOOLTIP:pk,LOGIC_BOOLEAN_TRUE:uk,LOGIC_COMPARE_HELPURL:jR,LOGIC_COMPARE_TOOLTIP_EQ:qR,LOGIC_COMPARE_TOOLTIP_GT:ek,LOGIC_COMPARE_TOOLTIP_GTE:tk,LOGIC_COMPARE_TOOLTIP_LT:ZR,LOGIC_COMPARE_TOOLTIP_LTE:QR,LOGIC_COMPARE_TOOLTIP_NEQ:JR,LOGIC_HUE:tw,LOGIC_NEGATE_HELPURL:lk,LOGIC_NEGATE_TITLE:ak,LOGIC_NEGATE_TOOLTIP:ck,LOGIC_NULL:gk,LOGIC_NULL_HELPURL:fk,LOGIC_NULL_TOOLTIP:mk,LOGIC_OPERATION_AND:rk,LOGIC_OPERATION_HELPURL:sk,LOGIC_OPERATION_OR:ok,LOGIC_OPERATION_TOOLTIP_AND:ik,LOGIC_OPERATION_TOOLTIP_OR:nk,LOGIC_TERNARY_CONDITION:$k,LOGIC_TERNARY_HELPURL:_k,LOGIC_TERNARY_IF_FALSE:bk,LOGIC_TERNARY_IF_TRUE:Tk,LOGIC_TERNARY_TOOLTIP:Ek,LOOPS_HUE:sw,MATH_ADDITION_SYMBOL:Sk,MATH_ARITHMETIC_HELPURL:Pk,MATH_ARITHMETIC_TOOLTIP_ADD:Nk,MATH_ARITHMETIC_TOOLTIP_DIVIDE:Fk,MATH_ARITHMETIC_TOOLTIP_MINUS:Dk,MATH_ARITHMETIC_TOOLTIP_MULTIPLY:Bk,MATH_ARITHMETIC_TOOLTIP_POWER:Uk,MATH_ATAN2_HELPURL:ZO,MATH_ATAN2_TITLE:QO,MATH_ATAN2_TOOLTIP:eA,MATH_CHANGE_HELPURL:fO,MATH_CHANGE_TITLE:gO,MATH_CHANGE_TITLE_ITEM:mO,MATH_CHANGE_TOOLTIP:_O,MATH_CONSTANT_HELPURL:rO,MATH_CONSTANT_TOOLTIP:nO,MATH_CONSTRAIN_HELPURL:VO,MATH_CONSTRAIN_TITLE:WO,MATH_CONSTRAIN_TOOLTIP:zO,MATH_DIVISION_SYMBOL:xk,MATH_HUE:iw,MATH_IS_DIVISIBLE_BY:dO,MATH_IS_EVEN:oO,MATH_IS_NEGATIVE:uO,MATH_IS_ODD:lO,MATH_IS_POSITIVE:hO,MATH_IS_PRIME:aO,MATH_IS_TOOLTIP:pO,MATH_IS_WHOLE:cO,MATH_MODULO_HELPURL:UO,MATH_MODULO_TITLE:GO,MATH_MODULO_TOOLTIP:HO,MATH_MULTIPLICATION_SYMBOL:Ck,MATH_NUMBER_HELPURL:yk,MATH_NUMBER_TOOLTIP:vk,MATH_ONLIST_HELPURL:vO,MATH_ONLIST_OPERATOR_AVERAGE:kO,MATH_ONLIST_OPERATOR_MAX:wO,MATH_ONLIST_OPERATOR_MEDIAN:AO,MATH_ONLIST_OPERATOR_MIN:xO,MATH_ONLIST_OPERATOR_MODE:LO,MATH_ONLIST_OPERATOR_RANDOM:BO,MATH_ONLIST_OPERATOR_STD_DEV:NO,MATH_ONLIST_OPERATOR_SUM:SO,MATH_ONLIST_TOOLTIP_AVERAGE:OO,MATH_ONLIST_TOOLTIP_MAX:RO,MATH_ONLIST_TOOLTIP_MEDIAN:MO,MATH_ONLIST_TOOLTIP_MIN:CO,MATH_ONLIST_TOOLTIP_MODE:PO,MATH_ONLIST_TOOLTIP_RANDOM:FO,MATH_ONLIST_TOOLTIP_STD_DEV:DO,MATH_ONLIST_TOOLTIP_SUM:IO,MATH_POWER_SYMBOL:wk,MATH_RANDOM_FLOAT_HELPURL:jO,MATH_RANDOM_FLOAT_TITLE_RANDOM:qO,MATH_RANDOM_FLOAT_TOOLTIP:JO,MATH_RANDOM_INT_HELPURL:XO,MATH_RANDOM_INT_TITLE:YO,MATH_RANDOM_INT_TOOLTIP:KO,MATH_ROUND_HELPURL:$O,MATH_ROUND_OPERATOR_ROUND:bO,MATH_ROUND_OPERATOR_ROUNDDOWN:yO,MATH_ROUND_OPERATOR_ROUNDUP:EO,MATH_ROUND_TOOLTIP:TO,MATH_SINGLE_HELPURL:Gk,MATH_SINGLE_OP_ABSOLUTE:Wk,MATH_SINGLE_OP_ROOT:Hk,MATH_SINGLE_TOOLTIP_ABS:zk,MATH_SINGLE_TOOLTIP_EXP:jk,MATH_SINGLE_TOOLTIP_LN:Yk,MATH_SINGLE_TOOLTIP_LOG10:Kk,MATH_SINGLE_TOOLTIP_NEG:Xk,MATH_SINGLE_TOOLTIP_POW10:qk,MATH_SINGLE_TOOLTIP_ROOT:Vk,MATH_SUBTRACTION_SYMBOL:Ik,MATH_TRIG_ACOS:Mk,MATH_TRIG_ASIN:Ak,MATH_TRIG_ATAN:Lk,MATH_TRIG_COS:kk,MATH_TRIG_HELPURL:Jk,MATH_TRIG_SIN:Rk,MATH_TRIG_TAN:Ok,MATH_TRIG_TOOLTIP_ACOS:sO,MATH_TRIG_TOOLTIP_ASIN:tO,MATH_TRIG_TOOLTIP_ATAN:iO,MATH_TRIG_TOOLTIP_COS:Qk,MATH_TRIG_TOOLTIP_SIN:Zk,MATH_TRIG_TOOLTIP_TAN:eO,NEW_COLOUR_VARIABLE:Bw,NEW_NUMBER_VARIABLE:Dw,NEW_STRING_VARIABLE:Nw,NEW_VARIABLE:Pw,NEW_VARIABLE_TITLE:Uw,NEW_VARIABLE_TYPE_TITLE:Fw,ORDINAL_NUMBER_SUFFIX:QL,PROCEDURES_ALLOW_STATEMENTS:v0,PROCEDURES_BEFORE_PARAMS:h0,PROCEDURES_CALLNORETURN_HELPURL:I0,PROCEDURES_CALLNORETURN_TOOLTIP:x0,PROCEDURES_CALLRETURN_HELPURL:C0,PROCEDURES_CALLRETURN_TOOLTIP:w0,PROCEDURES_CALL_BEFORE_PARAMS:u0,PROCEDURES_CALL_DISABLED_DEF_WARNING:d0,PROCEDURES_CREATE_DO:L0,PROCEDURES_DEFNORETURN_COMMENT:g0,PROCEDURES_DEFNORETURN_DO:p0,PROCEDURES_DEFNORETURN_HELPURL:l0,PROCEDURES_DEFNORETURN_PROCEDURE:c0,PROCEDURES_DEFNORETURN_TITLE:a0,PROCEDURES_DEFNORETURN_TOOLTIP:f0,PROCEDURES_DEFRETURN_COMMENT:b0,PROCEDURES_DEFRETURN_DO:T0,PROCEDURES_DEFRETURN_HELPURL:m0,PROCEDURES_DEFRETURN_PROCEDURE:$0,PROCEDURES_DEFRETURN_RETURN:E0,PROCEDURES_DEFRETURN_TITLE:_0,PROCEDURES_DEFRETURN_TOOLTIP:y0,PROCEDURES_DEF_DUPLICATE_WARNING:S0,PROCEDURES_HIGHLIGHT_DEF:M0,PROCEDURES_HUE:cw,PROCEDURES_IFRETURN_HELPURL:N0,PROCEDURES_IFRETURN_TOOLTIP:P0,PROCEDURES_IFRETURN_WARNING:D0,PROCEDURES_MUTATORARG_TITLE:O0,PROCEDURES_MUTATORARG_TOOLTIP:A0,PROCEDURES_MUTATORCONTAINER_TITLE:R0,PROCEDURES_MUTATORCONTAINER_TOOLTIP:k0,REDO:Ow,REMOVE_COMMENT:gw,RENAME_VARIABLE:Mw,RENAME_VARIABLE_TITLE:Lw,TEXTS_HUE:rw,TEXT_APPEND_HELPURL:hA,TEXT_APPEND_TITLE:uA,TEXT_APPEND_TOOLTIP:pA,TEXT_APPEND_VARIABLE:dA,TEXT_CHANGECASE_HELPURL:WA,TEXT_CHANGECASE_OPERATOR_LOWERCASE:YA,TEXT_CHANGECASE_OPERATOR_TITLECASE:KA,TEXT_CHANGECASE_OPERATOR_UPPERCASE:XA,TEXT_CHANGECASE_TOOLTIP:zA,TEXT_CHARAT_FIRST:RA,TEXT_CHARAT_FROM_END:wA,TEXT_CHARAT_FROM_START:CA,TEXT_CHARAT_HELPURL:IA,TEXT_CHARAT_LAST:kA,TEXT_CHARAT_RANDOM:OA,TEXT_CHARAT_TAIL:AA,TEXT_CHARAT_TITLE:xA,TEXT_CHARAT_TOOLTIP:MA,TEXT_COUNT_HELPURL:cM,TEXT_COUNT_MESSAGE0:aM,TEXT_COUNT_TOOLTIP:hM,TEXT_CREATE_JOIN_ITEM_TITLE_ITEM:aA,TEXT_CREATE_JOIN_ITEM_TOOLTIP:cA,TEXT_CREATE_JOIN_TITLE_JOIN:oA,TEXT_CREATE_JOIN_TOOLTIP:lA,TEXT_GET_SUBSTRING_END_FROM_END:GA,TEXT_GET_SUBSTRING_END_FROM_START:UA,TEXT_GET_SUBSTRING_END_LAST:HA,TEXT_GET_SUBSTRING_HELPURL:PA,TEXT_GET_SUBSTRING_INPUT_IN_TEXT:NA,TEXT_GET_SUBSTRING_START_FIRST:FA,TEXT_GET_SUBSTRING_START_FROM_END:BA,TEXT_GET_SUBSTRING_START_FROM_START:DA,TEXT_GET_SUBSTRING_TAIL:VA,TEXT_GET_SUBSTRING_TOOLTIP:LA,TEXT_INDEXOF_HELPURL:bA,TEXT_INDEXOF_OPERATOR_FIRST:vA,TEXT_INDEXOF_OPERATOR_LAST:SA,TEXT_INDEXOF_TITLE:yA,TEXT_INDEXOF_TOOLTIP:EA,TEXT_ISEMPTY_HELPURL:_A,TEXT_ISEMPTY_TITLE:$A,TEXT_ISEMPTY_TOOLTIP:TA,TEXT_JOIN_HELPURL:iA,TEXT_JOIN_TITLE_CREATEWITH:rA,TEXT_JOIN_TOOLTIP:nA,TEXT_LENGTH_HELPURL:fA,TEXT_LENGTH_TITLE:gA,TEXT_LENGTH_TOOLTIP:mA,TEXT_PRINT_HELPURL:eM,TEXT_PRINT_TITLE:tM,TEXT_PRINT_TOOLTIP:sM,TEXT_PROMPT_HELPURL:iM,TEXT_PROMPT_TOOLTIP_NUMBER:oM,TEXT_PROMPT_TOOLTIP_TEXT:lM,TEXT_PROMPT_TYPE_NUMBER:nM,TEXT_PROMPT_TYPE_TEXT:rM,TEXT_REPLACE_HELPURL:dM,TEXT_REPLACE_MESSAGE0:uM,TEXT_REPLACE_TOOLTIP:pM,TEXT_REVERSE_HELPURL:gM,TEXT_REVERSE_MESSAGE0:fM,TEXT_REVERSE_TOOLTIP:mM,TEXT_TEXT_HELPURL:tA,TEXT_TEXT_TOOLTIP:sA,TEXT_TRIM_HELPURL:jA,TEXT_TRIM_OPERATOR_BOTH:JA,TEXT_TRIM_OPERATOR_LEFT:ZA,TEXT_TRIM_OPERATOR_RIGHT:QA,TEXT_TRIM_TOOLTIP:qA,TODAY:dw,UNDO:kw,UNNAMED_KEY:uw,VARIABLES_DEFAULT_NAME:hw,VARIABLES_DYNAMIC_HUE:aw,VARIABLES_GET_CREATE_SET:s0,VARIABLES_GET_HELPURL:e0,VARIABLES_GET_TOOLTIP:t0,VARIABLES_HUE:lw,VARIABLES_SET:r0,VARIABLES_SET_CREATE_GET:o0,VARIABLES_SET_HELPURL:i0,VARIABLES_SET_TOOLTIP:n0,VARIABLE_ALREADY_EXISTS:Gw,VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE:Hw,VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER:Vw,WORKSPACE_ARIA_LABEL:F0,WORKSPACE_COMMENT_DEFAULT_TEXT:B0},Symbol.toStringTag,{value:"Module"})),W0=WC.defineTheme("cyberpunk",{name:"cyberpunk",base:zC.Classic,componentStyles:{workspaceBackgroundColour:"#0a0f1a",toolboxBackgroundColour:"#121a2e",toolboxForegroundColour:"#e0e0ff",flyoutBackgroundColour:"#0c1424",flyoutForegroundColour:"#e0e0ff",flyoutOpacity:.9,scrollbarColour:"#00eeff",scrollbarOpacity:.5,insertionMarkerColour:"#ff2a6d",insertionMarkerOpacity:.3,markerColour:"#00eeff",cursorColour:"#ff2a6d",selectedGlowColour:"#00eeff",replacementGlowColour:"#ff2a6d"},categoryStyles:{logic_category:{colour:"#00eeff"},loop_category:{colour:"#ff2a6d"},math_category:{colour:"#ffdd57"},text_category:{colour:"#00d26a"},list_category:{colour:"#9d4edd"},variable_category:{colour:"#55aaff"},procedure_category:{colour:"#ff9500"}},blockStyles:{logic_blocks:{colourPrimary:"#00eeff",colourSecondary:"#00bbdd",colourTertiary:"#0088aa"},loop_blocks:{colourPrimary:"#ff2a6d",colourSecondary:"#cc2255",colourTertiary:"#991133"},math_blocks:{colourPrimary:"#ffdd57",colourSecondary:"#ccaa33",colourTertiary:"#997711"},text_blocks:{colourPrimary:"#00d26a",colourSecondary:"#00aa55",colourTertiary:"#007733"},list_blocks:{colourPrimary:"#9d4edd",colourSecondary:"#7a2ec4",colourTertiary:"#57119b"},variable_blocks:{colourPrimary:"#55aaff",colourSecondary:"#3388dd",colourTertiary:"#1155aa"},procedure_blocks:{colourPrimary:"#ff9500",colourSecondary:"#cc7700",colourTertiary:"#995500"}}});class z0 extends cv.ConstantProvider{constructor(){super()}makeOutsideCorners(){return super.makeOutsideCorners()}makeInsideCorners(){return super.makeInsideCorners()}makePuzzleTab(){return super.makePuzzleTab()}makeNotch(){return super.makeNotch()}getCSS_(t){return super.getCSS_(t)}}class X0 extends cv.Renderer{constructor(t){super(t)}makeConstants_(){return new z0}}YC.register("renderer","custom",X0);KC(V0);const Y0=Object.getPrototypeOf(async function(){}).constructor;Dt.move_forward={init:function(){this.appendDummyInput().appendField("向前移动"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("使机器人向前移动一步"),this.setHelpUrl("")}};Dt.turn_left={init:function(){this.appendDummyInput().appendField("向左转"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("使机器人向左转90度"),this.setHelpUrl("")}};Dt.turn_right={init:function(){this.appendDummyInput().appendField("向右转"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("使机器人向右转90度"),this.setHelpUrl("")}};Dt.attack={init:function(){this.appendDummyInput().appendField("攻击"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("攻击面前的敌人"),this.setHelpUrl("")}};Dt.face_enemy={init:function(){this.appendDummyInput().appendField("面向敌人"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("面向相邻的敌人"),this.setHelpUrl("")}};Dt.move_to_position={init:function(){this.appendValueInput("X").setCheck("Number").appendField("前往 X"),this.appendValueInput("Y").setCheck("Number").appendField("Y"),this.setInputsInline(!0),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("前往指定坐标位置（自动寻路）"),this.setHelpUrl("")}};Dt.move_to_position.onchange=function(l){if(l.type==="create"){const t=this.getInput("X"),s=this.getInput("Y");if(t&&!t.connection.targetBlock()){const r=this.workspace.newBlock("math_number");r.setFieldValue("0","NUM"),r.setShadow(!0),t.connection.connect(r.outputConnection)}if(s&&!s.connection.targetBlock()){const r=this.workspace.newBlock("math_number");r.setFieldValue("0","NUM"),r.setShadow(!0),s.connection.connect(r.outputConnection)}}};Dt.move_to_nearest_enemy={init:function(){this.appendDummyInput().appendField("前往最近敌人位置"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("前往最近的敌人位置"),this.setHelpUrl("")}};Dt.is_enemy_adjacent={init:function(){this.appendDummyInput().appendField("旁边是否有敌人"),this.setOutput(!0,"Boolean"),this.setColour(230),this.setTooltip("检查旁边是否有敌人"),this.setHelpUrl("")}};Dt.get_enemy_x={init:function(){this.appendDummyInput().appendField("敌人X坐标"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取最近敌人的X坐标"),this.setHelpUrl("")}};Dt.get_enemy_y={init:function(){this.appendDummyInput().appendField("敌人Y坐标"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取最近敌人的Y坐标"),this.setHelpUrl("")}};Dt.get_position={init:function(){this.appendDummyInput().appendField("获取当前位置"),this.setOutput(!0,"Position"),this.setColour(230),this.setTooltip("获取机器人的当前位置坐标"),this.setHelpUrl("")}};Dt.get_x_position={init:function(){this.appendDummyInput().appendField("获取X坐标"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取机器人的当前X坐标"),this.setHelpUrl("")}};Dt.get_y_position={init:function(){this.appendDummyInput().appendField("获取Y坐标"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取机器人的当前Y坐标"),this.setHelpUrl("")}};Dt.get_player_health={init:function(){this.appendDummyInput().appendField("获取玩家血量"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取玩家当前血量"),this.setHelpUrl("")}};Dt.get_player_max_health={init:function(){this.appendDummyInput().appendField("获取玩家最大血量"),this.setOutput(!0,"Number"),this.setColour(230),this.setTooltip("获取玩家最大血量"),this.setHelpUrl("")}};Dt.say_message={init:function(){this.appendValueInput("MESSAGE").setCheck("String").appendField("说"),this.appendValueInput("DURATION").setCheck("Number").appendField("持续"),this.appendDummyInput().appendField("秒"),this.setPreviousStatement(!0,null),this.setNextStatement(!0,null),this.setColour(230),this.setTooltip("让机器人说话"),this.setHelpUrl("")}};Bt.forBlock.move_forward=function(l,t){return`await moveForward();
`};Bt.forBlock.turn_left=function(l,t){return`await turnLeft();
`};Bt.forBlock.turn_right=function(l,t){return`await turnRight();
`};Bt.forBlock.attack=function(l,t){return`await attack();
`};Bt.forBlock.face_enemy=function(l,t){return`await faceEnemy();
`};Bt.forBlock.move_to_position=function(l,t){const s=t.valueToCode(l,"X",0)||"0",r=t.valueToCode(l,"Y",0)||"0";return`await moveToPosition(${s}, ${r});
`};Bt.forBlock.move_to_nearest_enemy=function(l,t){return`await moveToNearestEnemy();
`};Bt.forBlock.is_enemy_adjacent=function(l,t){return["isEnemyAdjacent()",0]};Bt.forBlock.get_enemy_x=function(l,t){return["getEnemyX()",0]};Bt.forBlock.get_enemy_y=function(l,t){return["getEnemyY()",0]};Bt.forBlock.get_position=function(l,t){return["getPosition()",0]};Bt.forBlock.get_x_position=function(l,t){return["getXPosition()",0]};Bt.forBlock.get_y_position=function(l,t){return["getYPosition()",0]};Bt.forBlock.get_player_health=function(l,t){return["getPlayerHealth()",0]};Bt.forBlock.get_player_max_health=function(l,t){return["getPlayerMaxHealth()",0]};Bt.forBlock.say_message=function(l,t){const s=t.valueToCode(l,"MESSAGE",0)||'""',r=t.valueToCode(l,"DURATION",0)||"3";return`await sayMessage(${s}, ${r});
`};function K0(l,t){return XC(l,{toolbox:{kind:"categoryToolbox",contents:[{kind:"category",name:"逻辑",categorystyle:"logic_category",contents:[{kind:"block",type:"controls_if"},{kind:"block",type:"logic_compare"},{kind:"block",type:"logic_operation"},{kind:"block",type:"logic_boolean"},{kind:"block",type:"logic_negate"}]},{kind:"category",name:"循环",categorystyle:"loop_category",contents:[{kind:"block",type:"controls_repeat_ext"},{kind:"block",type:"controls_whileUntil"},{kind:"block",type:"controls_for"},{kind:"block",type:"controls_forEach"}]},{kind:"category",name:"数学",categorystyle:"math_category",contents:[{kind:"block",type:"math_number"},{kind:"block",type:"math_arithmetic"},{kind:"block",type:"math_single"},{kind:"block",type:"math_trig"},{kind:"block",type:"math_constant"},{kind:"block",type:"math_number_property"},{kind:"block",type:"math_round"},{kind:"block",type:"math_on_list"},{kind:"block",type:"math_modulo"},{kind:"block",type:"math_constrain"},{kind:"block",type:"math_random_int"},{kind:"block",type:"math_random_float"}]},{kind:"category",name:"文本",categorystyle:"text_category",contents:[{kind:"block",type:"text"},{kind:"block",type:"text_join"},{kind:"block",type:"text_append"},{kind:"block",type:"text_length"},{kind:"block",type:"text_isEmpty"},{kind:"block",type:"text_indexOf"},{kind:"block",type:"text_charAt"},{kind:"block",type:"text_getSubstring"},{kind:"block",type:"text_changeCase"},{kind:"block",type:"text_trim"}]},{kind:"category",name:"列表",categorystyle:"list_category",contents:[{kind:"block",type:"lists_create_with"},{kind:"block",type:"lists_create_with_item"},{kind:"block",type:"lists_repeat"},{kind:"block",type:"lists_length"},{kind:"block",type:"lists_isEmpty"},{kind:"block",type:"lists_indexOf"},{kind:"block",type:"lists_getIndex"},{kind:"block",type:"lists_setIndex"},{kind:"block",type:"lists_getSublist"},{kind:"block",type:"lists_split"},{kind:"block",type:"lists_sort"}]},{kind:"category",name:"变量",categorystyle:"variable_category",custom:"VARIABLE"},{kind:"category",name:"函数",categorystyle:"procedure_category",custom:"PROCEDURE"},{kind:"sep"},{kind:"category",name:"机器人",categorystyle:"variable_category",contents:[{kind:"block",type:"move_forward"},{kind:"block",type:"turn_left"},{kind:"block",type:"turn_right"},{kind:"block",type:"attack"},{kind:"block",type:"face_enemy"},{kind:"block",type:"move_to_position"},{kind:"block",type:"move_to_nearest_enemy"},{kind:"block",type:"is_enemy_adjacent"},{kind:"block",type:"get_enemy_x"},{kind:"block",type:"get_enemy_y"},{kind:"block",type:"get_x_position"},{kind:"block",type:"get_y_position"},{kind:"block",type:"get_player_health"},{kind:"block",type:"get_player_max_health"},{kind:"block",type:"say_message"}]}]},grid:{spacing:20,length:3,colour:"#2a3a5a",snap:!0},trashcan:!0,zoom:{controls:!0,wheel:!0,startScale:1,maxScale:3,minScale:.3,scaleSpeed:1.2},theme:W0,media:"https://esm.sh/blockly/media/",renderer:"custom"})}function tn(l,t){const s=Bt.workspaceToCode(l);console.log("Generated JavaScript code:"),console.log(s);const r=new AbortController,{signal:o}=r;return tn.currentController=r,new Promise((a,h)=>{o.addEventListener("abort",()=>{h(new Error("用户已停止执行"))});try{new Y0(...Object.keys(t),s)(...Object.values(t)).then(()=>{o.aborted||(console.log("Blockly code executed successfully"),a())}).catch(p=>{o.aborted||(console.error("Error executing Blockly code:",p),h(p))})}catch(u){o.aborted||(console.error("Error preparing Blockly code execution:",u),h(u))}})}tn.abort=function(){const l=tn.currentController;l&&l.abort()};const j0="modulepreload",q0=function(l,t){return new URL(l,t).href},$E={},th=function(t,s,r){let o=Promise.resolve();if(s&&s.length>0){const h=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),p=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));o=Promise.allSettled(s.map(f=>{if(f=q0(f,r),f in $E)return;$E[f]=!0;const g=f.endsWith(".css"),_=g?'[rel="stylesheet"]':"";if(!!r)for(let v=h.length-1;v>=0;v--){const w=h[v];if(w.href===f&&(!g||w.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${f}"]${_}`))return;const E=document.createElement("link");if(E.rel=g?"stylesheet":j0,g||(E.as="script"),E.crossOrigin="",E.href=f,p&&E.setAttribute("nonce",p),document.head.appendChild(E),g)return new Promise((v,w)=>{E.addEventListener("load",v),E.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${f}`)))})}))}function a(h){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=h,window.dispatchEvent(u),!u.defaultPrevented)throw h}return o.then(h=>{for(const u of h||[])u.status==="rejected"&&a(u.reason);return t().catch(a)})};var V=(l=>(l.Application="application",l.WebGLPipes="webgl-pipes",l.WebGLPipesAdaptor="webgl-pipes-adaptor",l.WebGLSystem="webgl-system",l.WebGPUPipes="webgpu-pipes",l.WebGPUPipesAdaptor="webgpu-pipes-adaptor",l.WebGPUSystem="webgpu-system",l.CanvasSystem="canvas-system",l.CanvasPipesAdaptor="canvas-pipes-adaptor",l.CanvasPipes="canvas-pipes",l.Asset="asset",l.LoadParser="load-parser",l.ResolveParser="resolve-parser",l.CacheParser="cache-parser",l.DetectionParser="detection-parser",l.MaskEffect="mask-effect",l.BlendMode="blend-mode",l.TextureSource="texture-source",l.Environment="environment",l.ShapeBuilder="shape-builder",l.Batcher="batcher",l))(V||{});const Gf=l=>{if(typeof l=="function"||typeof l=="object"&&l.extension){if(!l.extension)throw new Error("Extension class must have an extension object");l={...typeof l.extension!="object"?{type:l.extension}:l.extension,ref:l}}if(typeof l=="object")l={...l};else throw new Error("Invalid extension type");return typeof l.type=="string"&&(l.type=[l.type]),l},wc=(l,t)=>Gf(l).priority??t,Se={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...l){return l.map(Gf).forEach(t=>{t.type.forEach(s=>{var r,o;return(o=(r=this._removeHandlers)[s])==null?void 0:o.call(r,t)})}),this},add(...l){return l.map(Gf).forEach(t=>{t.type.forEach(s=>{var a,h;const r=this._addHandlers,o=this._queue;r[s]?(h=r[s])==null||h.call(r,t):(o[s]=o[s]||[],(a=o[s])==null||a.push(t))})}),this},handle(l,t,s){var h;const r=this._addHandlers,o=this._removeHandlers;if(r[l]||o[l])throw new Error(`Extension type ${l} already has a handler`);r[l]=t,o[l]=s;const a=this._queue;return a[l]&&((h=a[l])==null||h.forEach(u=>t(u)),delete a[l]),this},handleByMap(l,t){return this.handle(l,s=>{s.name&&(t[s.name]=s.ref)},s=>{s.name&&delete t[s.name]})},handleByNamedList(l,t,s=-1){return this.handle(l,r=>{t.findIndex(a=>a.name===r.name)>=0||(t.push({name:r.name,value:r.ref}),t.sort((a,h)=>wc(h.value,s)-wc(a.value,s)))},r=>{const o=t.findIndex(a=>a.name===r.name);o!==-1&&t.splice(o,1)})},handleByList(l,t,s=-1){return this.handle(l,r=>{t.includes(r.ref)||(t.push(r.ref),t.sort((o,a)=>wc(a,s)-wc(o,s)))},r=>{const o=t.indexOf(r.ref);o!==-1&&t.splice(o,1)})},mixin(l,...t){for(const s of t)Object.defineProperties(l.prototype,Object.getOwnPropertyDescriptors(s))}},J0={extension:{type:V.Environment,name:"browser",priority:-1},test:()=>!0,load:async()=>{await th(()=>Promise.resolve().then(()=>$H),void 0,import.meta.url)}},Z0={extension:{type:V.Environment,name:"webworker",priority:0},test:()=>typeof self<"u"&&self.WorkerGlobalScope!==void 0,load:async()=>{await th(()=>Promise.resolve().then(()=>TH),void 0,import.meta.url)}};class Wt{constructor(t,s,r){this._x=s||0,this._y=r||0,this._observer=t}clone(t){return new Wt(t??this._observer,this._x,this._y)}set(t=0,s=t){return(this._x!==t||this._y!==s)&&(this._x=t,this._y=s,this._observer._onUpdate(this)),this}copyFrom(t){return(this._x!==t.x||this._y!==t.y)&&(this._x=t.x,this._y=t.y,this._observer._onUpdate(this)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[pixi.js/math:ObservablePoint x=${this._x} y=${this._y} scope=${this._observer}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this._observer._onUpdate(this))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this._observer._onUpdate(this))}}var pv={exports:{}};(function(l){var t=Object.prototype.hasOwnProperty,s="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(s=!1));function o(p,f,g){this.fn=p,this.context=f,this.once=g||!1}function a(p,f,g,_,$){if(typeof g!="function")throw new TypeError("The listener must be a function");var E=new o(g,_||p,$),v=s?s+f:f;return p._events[v]?p._events[v].fn?p._events[v]=[p._events[v],E]:p._events[v].push(E):(p._events[v]=E,p._eventsCount++),p}function h(p,f){--p._eventsCount===0?p._events=new r:delete p._events[f]}function u(){this._events=new r,this._eventsCount=0}u.prototype.eventNames=function(){var f=[],g,_;if(this._eventsCount===0)return f;for(_ in g=this._events)t.call(g,_)&&f.push(s?_.slice(1):_);return Object.getOwnPropertySymbols?f.concat(Object.getOwnPropertySymbols(g)):f},u.prototype.listeners=function(f){var g=s?s+f:f,_=this._events[g];if(!_)return[];if(_.fn)return[_.fn];for(var $=0,E=_.length,v=new Array(E);$<E;$++)v[$]=_[$].fn;return v},u.prototype.listenerCount=function(f){var g=s?s+f:f,_=this._events[g];return _?_.fn?1:_.length:0},u.prototype.emit=function(f,g,_,$,E,v){var w=s?s+f:f;if(!this._events[w])return!1;var x=this._events[w],C=arguments.length,R,A;if(x.fn){switch(x.once&&this.removeListener(f,x.fn,void 0,!0),C){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,g),!0;case 3:return x.fn.call(x.context,g,_),!0;case 4:return x.fn.call(x.context,g,_,$),!0;case 5:return x.fn.call(x.context,g,_,$,E),!0;case 6:return x.fn.call(x.context,g,_,$,E,v),!0}for(A=1,R=new Array(C-1);A<C;A++)R[A-1]=arguments[A];x.fn.apply(x.context,R)}else{var D=x.length,G;for(A=0;A<D;A++)switch(x[A].once&&this.removeListener(f,x[A].fn,void 0,!0),C){case 1:x[A].fn.call(x[A].context);break;case 2:x[A].fn.call(x[A].context,g);break;case 3:x[A].fn.call(x[A].context,g,_);break;case 4:x[A].fn.call(x[A].context,g,_,$);break;default:if(!R)for(G=1,R=new Array(C-1);G<C;G++)R[G-1]=arguments[G];x[A].fn.apply(x[A].context,R)}}return!0},u.prototype.on=function(f,g,_){return a(this,f,g,_,!1)},u.prototype.once=function(f,g,_){return a(this,f,g,_,!0)},u.prototype.removeListener=function(f,g,_,$){var E=s?s+f:f;if(!this._events[E])return this;if(!g)return h(this,E),this;var v=this._events[E];if(v.fn)v.fn===g&&(!$||v.once)&&(!_||v.context===_)&&h(this,E);else{for(var w=0,x=[],C=v.length;w<C;w++)(v[w].fn!==g||$&&!v[w].once||_&&v[w].context!==_)&&x.push(v[w]);x.length?this._events[E]=x.length===1?x[0]:x:h(this,E)}return this},u.prototype.removeAllListeners=function(f){var g;return f?(g=s?s+f:f,this._events[g]&&h(this,g)):(this._events=new r,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=s,u.EventEmitter=u,l.exports=u})(pv);var Q0=pv.exports;const Is=co(Q0),eP=Math.PI*2,tP=180/Math.PI,sP=Math.PI/180;class ve{constructor(t=0,s=0){this.x=0,this.y=0,this.x=t,this.y=s}clone(){return new ve(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,s=t){return this.x=t,this.y=s,this}toString(){return`[pixi.js/math:Point x=${this.x} y=${this.y}]`}static get shared(){return ef.x=0,ef.y=0,ef}}const ef=new ve;class Te{constructor(t=1,s=0,r=0,o=1,a=0,h=0){this.array=null,this.a=t,this.b=s,this.c=r,this.d=o,this.tx=a,this.ty=h}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,s,r,o,a,h){return this.a=t,this.b=s,this.c=r,this.d=o,this.tx=a,this.ty=h,this}toArray(t,s){this.array||(this.array=new Float32Array(9));const r=s||this.array;return t?(r[0]=this.a,r[1]=this.b,r[2]=0,r[3]=this.c,r[4]=this.d,r[5]=0,r[6]=this.tx,r[7]=this.ty,r[8]=1):(r[0]=this.a,r[1]=this.c,r[2]=this.tx,r[3]=this.b,r[4]=this.d,r[5]=this.ty,r[6]=0,r[7]=0,r[8]=1),r}apply(t,s){s=s||new ve;const r=t.x,o=t.y;return s.x=this.a*r+this.c*o+this.tx,s.y=this.b*r+this.d*o+this.ty,s}applyInverse(t,s){s=s||new ve;const r=this.a,o=this.b,a=this.c,h=this.d,u=this.tx,p=this.ty,f=1/(r*h+a*-o),g=t.x,_=t.y;return s.x=h*f*g+-a*f*_+(p*a-u*h)*f,s.y=r*f*_+-o*f*g+(-p*r+u*o)*f,s}translate(t,s){return this.tx+=t,this.ty+=s,this}scale(t,s){return this.a*=t,this.d*=s,this.c*=t,this.b*=s,this.tx*=t,this.ty*=s,this}rotate(t){const s=Math.cos(t),r=Math.sin(t),o=this.a,a=this.c,h=this.tx;return this.a=o*s-this.b*r,this.b=o*r+this.b*s,this.c=a*s-this.d*r,this.d=a*r+this.d*s,this.tx=h*s-this.ty*r,this.ty=h*r+this.ty*s,this}append(t){const s=this.a,r=this.b,o=this.c,a=this.d;return this.a=t.a*s+t.b*o,this.b=t.a*r+t.b*a,this.c=t.c*s+t.d*o,this.d=t.c*r+t.d*a,this.tx=t.tx*s+t.ty*o+this.tx,this.ty=t.tx*r+t.ty*a+this.ty,this}appendFrom(t,s){const r=t.a,o=t.b,a=t.c,h=t.d,u=t.tx,p=t.ty,f=s.a,g=s.b,_=s.c,$=s.d;return this.a=r*f+o*_,this.b=r*g+o*$,this.c=a*f+h*_,this.d=a*g+h*$,this.tx=u*f+p*_+s.tx,this.ty=u*g+p*$+s.ty,this}setTransform(t,s,r,o,a,h,u,p,f){return this.a=Math.cos(u+f)*a,this.b=Math.sin(u+f)*a,this.c=-Math.sin(u-p)*h,this.d=Math.cos(u-p)*h,this.tx=t-(r*this.a+o*this.c),this.ty=s-(r*this.b+o*this.d),this}prepend(t){const s=this.tx;if(t.a!==1||t.b!==0||t.c!==0||t.d!==1){const r=this.a,o=this.c;this.a=r*t.a+this.b*t.c,this.b=r*t.b+this.b*t.d,this.c=o*t.a+this.d*t.c,this.d=o*t.b+this.d*t.d}return this.tx=s*t.a+this.ty*t.c+t.tx,this.ty=s*t.b+this.ty*t.d+t.ty,this}decompose(t){const s=this.a,r=this.b,o=this.c,a=this.d,h=t.pivot,u=-Math.atan2(-o,a),p=Math.atan2(r,s),f=Math.abs(u+p);return f<1e-5||Math.abs(eP-f)<1e-5?(t.rotation=p,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=u,t.skew.y=p),t.scale.x=Math.sqrt(s*s+r*r),t.scale.y=Math.sqrt(o*o+a*a),t.position.x=this.tx+(h.x*s+h.y*o),t.position.y=this.ty+(h.x*r+h.y*a),t}invert(){const t=this.a,s=this.b,r=this.c,o=this.d,a=this.tx,h=t*o-s*r;return this.a=o/h,this.b=-s/h,this.c=-r/h,this.d=t/h,this.tx=(r*this.ty-o*a)/h,this.ty=-(t*this.ty-s*a)/h,this}isIdentity(){return this.a===1&&this.b===0&&this.c===0&&this.d===1&&this.tx===0&&this.ty===0}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new Te;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}equals(t){return t.a===this.a&&t.b===this.b&&t.c===this.c&&t.d===this.d&&t.tx===this.tx&&t.ty===this.ty}toString(){return`[pixi.js:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return rP.identity()}static get shared(){return iP.identity()}}const iP=new Te,rP=new Te,Jr=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],Zr=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],Qr=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],en=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],Hf=[],fv=[],Rc=Math.sign;function nP(){for(let l=0;l<16;l++){const t=[];Hf.push(t);for(let s=0;s<16;s++){const r=Rc(Jr[l]*Jr[s]+Qr[l]*Zr[s]),o=Rc(Zr[l]*Jr[s]+en[l]*Zr[s]),a=Rc(Jr[l]*Qr[s]+Qr[l]*en[s]),h=Rc(Zr[l]*Qr[s]+en[l]*en[s]);for(let u=0;u<16;u++)if(Jr[u]===r&&Zr[u]===o&&Qr[u]===a&&en[u]===h){t.push(u);break}}}for(let l=0;l<16;l++){const t=new Te;t.set(Jr[l],Zr[l],Qr[l],en[l],0,0),fv.push(t)}}nP();const nt={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:l=>Jr[l],uY:l=>Zr[l],vX:l=>Qr[l],vY:l=>en[l],inv:l=>l&8?l&15:-l&7,add:(l,t)=>Hf[l][t],sub:(l,t)=>Hf[l][nt.inv(t)],rotate180:l=>l^4,isVertical:l=>(l&3)===2,byDirection:(l,t)=>Math.abs(l)*2<=Math.abs(t)?t>=0?nt.S:nt.N:Math.abs(t)*2<=Math.abs(l)?l>0?nt.E:nt.W:t>0?l>0?nt.SE:nt.SW:l>0?nt.NE:nt.NW,matrixAppendRotationInv:(l,t,s=0,r=0)=>{const o=fv[nt.inv(t)];o.tx=s,o.ty=r,l.append(o)}},kc=[new ve,new ve,new ve,new ve];class Fe{constructor(t=0,s=0,r=0,o=0){this.type="rectangle",this.x=Number(t),this.y=Number(s),this.width=Number(r),this.height=Number(o)}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}isEmpty(){return this.left===this.right||this.top===this.bottom}static get EMPTY(){return new Fe(0,0,0,0)}clone(){return new Fe(this.x,this.y,this.width,this.height)}copyFromBounds(t){return this.x=t.minX,this.y=t.minY,this.width=t.maxX-t.minX,this.height=t.maxY-t.minY,this}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,s){return this.width<=0||this.height<=0?!1:t>=this.x&&t<this.x+this.width&&s>=this.y&&s<this.y+this.height}strokeContains(t,s,r,o=.5){const{width:a,height:h}=this;if(a<=0||h<=0)return!1;const u=this.x,p=this.y,f=r*(1-o),g=r-f,_=u-f,$=u+a+f,E=p-f,v=p+h+f,w=u+g,x=u+a-g,C=p+g,R=p+h-g;return t>=_&&t<=$&&s>=E&&s<=v&&!(t>w&&t<x&&s>C&&s<R)}intersects(t,s){if(!s){const z=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=z)return!1;const Q=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>Q}const r=this.left,o=this.right,a=this.top,h=this.bottom;if(o<=r||h<=a)return!1;const u=kc[0].set(t.left,t.top),p=kc[1].set(t.left,t.bottom),f=kc[2].set(t.right,t.top),g=kc[3].set(t.right,t.bottom);if(f.x<=u.x||p.y<=u.y)return!1;const _=Math.sign(s.a*s.d-s.b*s.c);if(_===0||(s.apply(u,u),s.apply(p,p),s.apply(f,f),s.apply(g,g),Math.max(u.x,p.x,f.x,g.x)<=r||Math.min(u.x,p.x,f.x,g.x)>=o||Math.max(u.y,p.y,f.y,g.y)<=a||Math.min(u.y,p.y,f.y,g.y)>=h))return!1;const $=_*(p.y-u.y),E=_*(u.x-p.x),v=$*r+E*a,w=$*o+E*a,x=$*r+E*h,C=$*o+E*h;if(Math.max(v,w,x,C)<=$*u.x+E*u.y||Math.min(v,w,x,C)>=$*g.x+E*g.y)return!1;const R=_*(u.y-f.y),A=_*(f.x-u.x),D=R*r+A*a,G=R*o+A*a,M=R*r+A*h,k=R*o+A*h;return!(Math.max(D,G,M,k)<=R*u.x+A*u.y||Math.min(D,G,M,k)>=R*g.x+A*g.y)}pad(t=0,s=t){return this.x-=t,this.y-=s,this.width+=t*2,this.height+=s*2,this}fit(t){const s=Math.max(this.x,t.x),r=Math.min(this.x+this.width,t.x+t.width),o=Math.max(this.y,t.y),a=Math.min(this.y+this.height,t.y+t.height);return this.x=s,this.width=Math.max(r-s,0),this.y=o,this.height=Math.max(a-o,0),this}ceil(t=1,s=.001){const r=Math.ceil((this.x+this.width-s)*t)/t,o=Math.ceil((this.y+this.height-s)*t)/t;return this.x=Math.floor((this.x+s)*t)/t,this.y=Math.floor((this.y+s)*t)/t,this.width=r-this.x,this.height=o-this.y,this}enlarge(t){const s=Math.min(this.x,t.x),r=Math.max(this.x+this.width,t.x+t.width),o=Math.min(this.y,t.y),a=Math.max(this.y+this.height,t.y+t.height);return this.x=s,this.width=r-s,this.y=o,this.height=a-o,this}getBounds(t){return t||(t=new Fe),t.copyFrom(this),t}containsRect(t){if(this.width<=0||this.height<=0)return!1;const s=t.x,r=t.y,o=t.x+t.width,a=t.y+t.height;return s>=this.x&&s<this.x+this.width&&r>=this.y&&r<this.y+this.height&&o>=this.x&&o<this.x+this.width&&a>=this.y&&a<this.y+this.height}set(t,s,r,o){return this.x=t,this.y=s,this.width=r,this.height=o,this}toString(){return`[pixi.js/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}const tf={default:-1};function st(l="default"){return tf[l]===void 0&&(tf[l]=-1),++tf[l]}const TE={},He="8.0.0",oP="8.3.4";function ke(l,t,s=3){if(TE[t])return;let r=new Error().stack;typeof r>"u"?console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${l}`):(r=r.split(`
`).splice(s).join(`
`),console.groupCollapsed?(console.groupCollapsed("%cPixiJS Deprecation Warning: %c%s","color:#614108;background:#fffbe6","font-weight:normal;color:#614108;background:#fffbe6",`${t}
Deprecated since v${l}`),console.warn(r),console.groupEnd()):(console.warn("PixiJS Deprecation Warning: ",`${t}
Deprecated since v${l}`),console.warn(r))),TE[t]=!0}const gv=()=>{};function ro(l){return l+=l===0?1:0,--l,l|=l>>>1,l|=l>>>2,l|=l>>>4,l|=l>>>8,l|=l>>>16,l+1}function bE(l){return!(l&l-1)&&!!l}function mv(l){const t={};for(const s in l)l[s]!==void 0&&(t[s]=l[s]);return t}const EE=Object.create(null);function lP(l){const t=EE[l];return t===void 0&&(EE[l]=st("resource")),t}const _v=class $v extends Is{constructor(t={}){super(),this._resourceType="textureSampler",this._touched=0,this._maxAnisotropy=1,this.destroyed=!1,t={...$v.defaultOptions,...t},this.addressMode=t.addressMode,this.addressModeU=t.addressModeU??this.addressModeU,this.addressModeV=t.addressModeV??this.addressModeV,this.addressModeW=t.addressModeW??this.addressModeW,this.scaleMode=t.scaleMode,this.magFilter=t.magFilter??this.magFilter,this.minFilter=t.minFilter??this.minFilter,this.mipmapFilter=t.mipmapFilter??this.mipmapFilter,this.lodMinClamp=t.lodMinClamp,this.lodMaxClamp=t.lodMaxClamp,this.compare=t.compare,this.maxAnisotropy=t.maxAnisotropy??1}set addressMode(t){this.addressModeU=t,this.addressModeV=t,this.addressModeW=t}get addressMode(){return this.addressModeU}set wrapMode(t){ke(He,"TextureStyle.wrapMode is now TextureStyle.addressMode"),this.addressMode=t}get wrapMode(){return this.addressMode}set scaleMode(t){this.magFilter=t,this.minFilter=t,this.mipmapFilter=t}get scaleMode(){return this.magFilter}set maxAnisotropy(t){this._maxAnisotropy=Math.min(t,16),this._maxAnisotropy>1&&(this.scaleMode="linear")}get maxAnisotropy(){return this._maxAnisotropy}get _resourceId(){return this._sharedResourceId||this._generateResourceId()}update(){this.emit("change",this),this._sharedResourceId=null}_generateResourceId(){const t=`${this.addressModeU}-${this.addressModeV}-${this.addressModeW}-${this.magFilter}-${this.minFilter}-${this.mipmapFilter}-${this.lodMinClamp}-${this.lodMaxClamp}-${this.compare}-${this._maxAnisotropy}`;return this._sharedResourceId=lP(t),this._resourceId}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this.removeAllListeners()}};_v.defaultOptions={addressMode:"clamp-to-edge",scaleMode:"linear"};let ln=_v;const Tv=class bv extends Is{constructor(t={}){super(),this.options=t,this.uid=st("textureSource"),this._resourceType="textureSource",this._resourceId=st("resource"),this.uploadMethodId="unknown",this._resolution=1,this.pixelWidth=1,this.pixelHeight=1,this.width=1,this.height=1,this.sampleCount=1,this.mipLevelCount=1,this.autoGenerateMipmaps=!1,this.format="rgba8unorm",this.dimension="2d",this.antialias=!1,this._touched=0,this._batchTick=-1,this._textureBindLocation=-1,t={...bv.defaultOptions,...t},this.label=t.label??"",this.resource=t.resource,this.autoGarbageCollect=t.autoGarbageCollect,this._resolution=t.resolution,t.width?this.pixelWidth=t.width*this._resolution:this.pixelWidth=this.resource?this.resourceWidth??1:1,t.height?this.pixelHeight=t.height*this._resolution:this.pixelHeight=this.resource?this.resourceHeight??1:1,this.width=this.pixelWidth/this._resolution,this.height=this.pixelHeight/this._resolution,this.format=t.format,this.dimension=t.dimensions,this.mipLevelCount=t.mipLevelCount,this.autoGenerateMipmaps=t.autoGenerateMipmaps,this.sampleCount=t.sampleCount,this.antialias=t.antialias,this.alphaMode=t.alphaMode,this.style=new ln(mv(t)),this.destroyed=!1,this._refreshPOT()}get source(){return this}get style(){return this._style}set style(t){var s,r;this.style!==t&&((s=this._style)==null||s.off("change",this._onStyleChange,this),this._style=t,(r=this._style)==null||r.on("change",this._onStyleChange,this),this._onStyleChange())}get addressMode(){return this._style.addressMode}set addressMode(t){this._style.addressMode=t}get repeatMode(){return this._style.addressMode}set repeatMode(t){this._style.addressMode=t}get magFilter(){return this._style.magFilter}set magFilter(t){this._style.magFilter=t}get minFilter(){return this._style.minFilter}set minFilter(t){this._style.minFilter=t}get mipmapFilter(){return this._style.mipmapFilter}set mipmapFilter(t){this._style.mipmapFilter=t}get lodMinClamp(){return this._style.lodMinClamp}set lodMinClamp(t){this._style.lodMinClamp=t}get lodMaxClamp(){return this._style.lodMaxClamp}set lodMaxClamp(t){this._style.lodMaxClamp=t}_onStyleChange(){this.emit("styleChange",this)}update(){if(this.resource){const t=this._resolution;if(this.resize(this.resourceWidth/t,this.resourceHeight/t))return}this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._style&&(this._style.destroy(),this._style=null),this.uploadMethodId=null,this.resource=null,this.removeAllListeners()}unload(){this._resourceId=st("resource"),this.emit("change",this),this.emit("unload",this)}get resourceWidth(){const{resource:t}=this;return t.naturalWidth||t.videoWidth||t.displayWidth||t.width}get resourceHeight(){const{resource:t}=this;return t.naturalHeight||t.videoHeight||t.displayHeight||t.height}get resolution(){return this._resolution}set resolution(t){this._resolution!==t&&(this._resolution=t,this.width=this.pixelWidth/t,this.height=this.pixelHeight/t)}resize(t,s,r){r||(r=this._resolution),t||(t=this.width),s||(s=this.height);const o=Math.round(t*r),a=Math.round(s*r);return this.width=o/r,this.height=a/r,this._resolution=r,this.pixelWidth===o&&this.pixelHeight===a?!1:(this._refreshPOT(),this.pixelWidth=o,this.pixelHeight=a,this.emit("resize",this),this._resourceId=st("resource"),this.emit("change",this),!0)}updateMipmaps(){this.autoGenerateMipmaps&&this.mipLevelCount>1&&this.emit("updateMipmaps",this)}set wrapMode(t){this._style.wrapMode=t}get wrapMode(){return this._style.wrapMode}set scaleMode(t){this._style.scaleMode=t}get scaleMode(){return this._style.scaleMode}_refreshPOT(){this.isPowerOfTwo=bE(this.pixelWidth)&&bE(this.pixelHeight)}static test(t){throw new Error("Unimplemented")}};Tv.defaultOptions={resolution:1,format:"bgra8unorm",alphaMode:"premultiply-alpha-on-upload",dimensions:"2d",mipLevelCount:1,autoGenerateMipmaps:!1,sampleCount:1,antialias:!1,autoGarbageCollect:!1};let vt=Tv;class $g extends vt{constructor(t){const s=t.resource||new Float32Array(t.width*t.height*4);let r=t.format;r||(s instanceof Float32Array?r="rgba32float":s instanceof Int32Array||s instanceof Uint32Array?r="rgba32uint":s instanceof Int16Array||s instanceof Uint16Array?r="rgba16uint":(s instanceof Int8Array,r="bgra8unorm")),super({...t,resource:s,format:r}),this.uploadMethodId="buffer"}static test(t){return t instanceof Int8Array||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Int16Array||t instanceof Uint16Array||t instanceof Int32Array||t instanceof Uint32Array||t instanceof Float32Array}}$g.extension=V.TextureSource;const yE=new Te;class Ev{constructor(t,s){this.mapCoord=new Te,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,typeof s>"u"?this.clampMargin=t.width<10?0:.5:this.clampMargin=s,this.isSimple=!1,this.texture=t}get texture(){return this._texture}set texture(t){var s;this.texture!==t&&((s=this._texture)==null||s.removeListener("update",this.update,this),this._texture=t,this._texture.addListener("update",this.update,this),this.update())}multiplyUvs(t,s){s===void 0&&(s=t);const r=this.mapCoord;for(let o=0;o<t.length;o+=2){const a=t[o],h=t[o+1];s[o]=a*r.a+h*r.c+r.tx,s[o+1]=a*r.b+h*r.d+r.ty}return s}update(){const t=this._texture;this._updateID++;const s=t.uvs;this.mapCoord.set(s.x1-s.x0,s.y1-s.y0,s.x3-s.x0,s.y3-s.y0,s.x0,s.y0);const r=t.orig,o=t.trim;o&&(yE.set(r.width/o.width,0,0,r.height/o.height,-o.x/o.width,-o.y/o.height),this.mapCoord.append(yE));const a=t.source,h=this.uClampFrame,u=this.clampMargin/a._resolution,p=this.clampOffset/a._resolution;return h[0]=(t.frame.x+u+p)/a.width,h[1]=(t.frame.y+u+p)/a.height,h[2]=(t.frame.x+t.frame.width-u+p)/a.width,h[3]=(t.frame.y+t.frame.height-u+p)/a.height,this.uClampOffset[0]=this.clampOffset/a.pixelWidth,this.uClampOffset[1]=this.clampOffset/a.pixelHeight,this.isSimple=t.frame.width===a.width&&t.frame.height===a.height&&t.rotate===0,!0}}class me extends Is{constructor({source:t,label:s,frame:r,orig:o,trim:a,defaultAnchor:h,defaultBorders:u,rotate:p,dynamic:f}={}){if(super(),this.uid=st("texture"),this.uvs={x0:0,y0:0,x1:0,y1:0,x2:0,y2:0,x3:0,y3:0},this.frame=new Fe,this.noFrame=!1,this.dynamic=!1,this.isTexture=!0,this.label=s,this.source=(t==null?void 0:t.source)??new vt,this.noFrame=!r,r)this.frame.copyFrom(r);else{const{width:g,height:_}=this._source;this.frame.width=g,this.frame.height=_}this.orig=o||this.frame,this.trim=a,this.rotate=p??0,this.defaultAnchor=h,this.defaultBorders=u,this.destroyed=!1,this.dynamic=f||!1,this.updateUvs()}set source(t){this._source&&this._source.off("resize",this.update,this),this._source=t,t.on("resize",this.update,this),this.emit("update",this)}get source(){return this._source}get textureMatrix(){return this._textureMatrix||(this._textureMatrix=new Ev(this)),this._textureMatrix}get width(){return this.orig.width}get height(){return this.orig.height}updateUvs(){const{uvs:t,frame:s}=this,{width:r,height:o}=this._source,a=s.x/r,h=s.y/o,u=s.width/r,p=s.height/o;let f=this.rotate;if(f){const g=u/2,_=p/2,$=a+g,E=h+_;f=nt.add(f,nt.NW),t.x0=$+g*nt.uX(f),t.y0=E+_*nt.uY(f),f=nt.add(f,2),t.x1=$+g*nt.uX(f),t.y1=E+_*nt.uY(f),f=nt.add(f,2),t.x2=$+g*nt.uX(f),t.y2=E+_*nt.uY(f),f=nt.add(f,2),t.x3=$+g*nt.uX(f),t.y3=E+_*nt.uY(f)}else t.x0=a,t.y0=h,t.x1=a+u,t.y1=h,t.x2=a+u,t.y2=h+p,t.x3=a,t.y3=h+p}destroy(t=!1){this._source&&t&&(this._source.destroy(),this._source=null),this._textureMatrix=null,this.destroyed=!0,this.emit("destroy",this),this.removeAllListeners()}update(){this.noFrame&&(this.frame.width=this._source.width,this.frame.height=this._source.height),this.updateUvs(),this.emit("update",this)}get baseTexture(){return ke(He,"Texture.baseTexture is now Texture.source"),this._source}}me.EMPTY=new me({label:"EMPTY",source:new vt({label:"EMPTY"})});me.EMPTY.destroy=gv;me.WHITE=new me({source:new $g({resource:new Uint8Array([255,255,255,255]),width:1,height:1,alphaMode:"premultiply-alpha-on-upload",label:"WHITE"}),label:"WHITE"});me.WHITE.destroy=gv;function yv(l,t,s){const{width:r,height:o}=s.orig,a=s.trim;if(a){const h=a.width,u=a.height;l.minX=a.x-t._x*r,l.maxX=l.minX+h,l.minY=a.y-t._y*o,l.maxY=l.minY+u}else l.minX=-t._x*r,l.maxX=l.minX+r,l.minY=-t._y*o,l.maxY=l.minY+o}const vE=new Te;class Yt{constructor(t=1/0,s=1/0,r=-1/0,o=-1/0){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=vE,this.minX=t,this.minY=s,this.maxX=r,this.maxY=o}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}get rectangle(){this._rectangle||(this._rectangle=new Fe);const t=this._rectangle;return this.minX>this.maxX||this.minY>this.maxY?(t.x=0,t.y=0,t.width=0,t.height=0):t.copyFromBounds(this),t}clear(){return this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.matrix=vE,this}set(t,s,r,o){this.minX=t,this.minY=s,this.maxX=r,this.maxY=o}addFrame(t,s,r,o,a){a||(a=this.matrix);const h=a.a,u=a.b,p=a.c,f=a.d,g=a.tx,_=a.ty;let $=this.minX,E=this.minY,v=this.maxX,w=this.maxY,x=h*t+p*s+g,C=u*t+f*s+_;x<$&&($=x),C<E&&(E=C),x>v&&(v=x),C>w&&(w=C),x=h*r+p*s+g,C=u*r+f*s+_,x<$&&($=x),C<E&&(E=C),x>v&&(v=x),C>w&&(w=C),x=h*t+p*o+g,C=u*t+f*o+_,x<$&&($=x),C<E&&(E=C),x>v&&(v=x),C>w&&(w=C),x=h*r+p*o+g,C=u*r+f*o+_,x<$&&($=x),C<E&&(E=C),x>v&&(v=x),C>w&&(w=C),this.minX=$,this.minY=E,this.maxX=v,this.maxY=w}addRect(t,s){this.addFrame(t.x,t.y,t.x+t.width,t.y+t.height,s)}addBounds(t,s){this.addFrame(t.minX,t.minY,t.maxX,t.maxY,s)}addBoundsMask(t){this.minX=this.minX>t.minX?this.minX:t.minX,this.minY=this.minY>t.minY?this.minY:t.minY,this.maxX=this.maxX<t.maxX?this.maxX:t.maxX,this.maxY=this.maxY<t.maxY?this.maxY:t.maxY}applyMatrix(t){const s=this.minX,r=this.minY,o=this.maxX,a=this.maxY,{a:h,b:u,c:p,d:f,tx:g,ty:_}=t;let $=h*s+p*r+g,E=u*s+f*r+_;this.minX=$,this.minY=E,this.maxX=$,this.maxY=E,$=h*o+p*r+g,E=u*o+f*r+_,this.minX=$<this.minX?$:this.minX,this.minY=E<this.minY?E:this.minY,this.maxX=$>this.maxX?$:this.maxX,this.maxY=E>this.maxY?E:this.maxY,$=h*s+p*a+g,E=u*s+f*a+_,this.minX=$<this.minX?$:this.minX,this.minY=E<this.minY?E:this.minY,this.maxX=$>this.maxX?$:this.maxX,this.maxY=E>this.maxY?E:this.maxY,$=h*o+p*a+g,E=u*o+f*a+_,this.minX=$<this.minX?$:this.minX,this.minY=E<this.minY?E:this.minY,this.maxX=$>this.maxX?$:this.maxX,this.maxY=E>this.maxY?E:this.maxY}fit(t){return this.minX<t.left&&(this.minX=t.left),this.maxX>t.right&&(this.maxX=t.right),this.minY<t.top&&(this.minY=t.top),this.maxY>t.bottom&&(this.maxY=t.bottom),this}fitBounds(t,s,r,o){return this.minX<t&&(this.minX=t),this.maxX>s&&(this.maxX=s),this.minY<r&&(this.minY=r),this.maxY>o&&(this.maxY=o),this}pad(t,s=t){return this.minX-=t,this.maxX+=t,this.minY-=s,this.maxY+=s,this}ceil(){return this.minX=Math.floor(this.minX),this.minY=Math.floor(this.minY),this.maxX=Math.ceil(this.maxX),this.maxY=Math.ceil(this.maxY),this}clone(){return new Yt(this.minX,this.minY,this.maxX,this.maxY)}scale(t,s=t){return this.minX*=t,this.minY*=s,this.maxX*=t,this.maxY*=s,this}get x(){return this.minX}set x(t){const s=this.maxX-this.minX;this.minX=t,this.maxX=t+s}get y(){return this.minY}set y(t){const s=this.maxY-this.minY;this.minY=t,this.maxY=t+s}get width(){return this.maxX-this.minX}set width(t){this.maxX=this.minX+t}get height(){return this.maxY-this.minY}set height(t){this.maxY=this.minY+t}get left(){return this.minX}get right(){return this.maxX}get top(){return this.minY}get bottom(){return this.maxY}get isPositive(){return this.maxX-this.minX>0&&this.maxY-this.minY>0}get isValid(){return this.minX+this.minY!==1/0}addVertexData(t,s,r,o){let a=this.minX,h=this.minY,u=this.maxX,p=this.maxY;o||(o=this.matrix);const f=o.a,g=o.b,_=o.c,$=o.d,E=o.tx,v=o.ty;for(let w=s;w<r;w+=2){const x=t[w],C=t[w+1],R=f*x+_*C+E,A=g*x+$*C+v;a=R<a?R:a,h=A<h?A:h,u=R>u?R:u,p=A>p?A:p}this.minX=a,this.minY=h,this.maxX=u,this.maxY=p}containsPoint(t,s){return this.minX<=t&&this.minY<=s&&this.maxX>=t&&this.maxY>=s}toString(){return`[pixi.js:Bounds minX=${this.minX} minY=${this.minY} maxX=${this.maxX} maxY=${this.maxY} width=${this.width} height=${this.height}]`}copyFrom(t){return this.minX=t.minX,this.minY=t.minY,this.maxX=t.maxX,this.maxY=t.maxY,this}}var aP={grad:.9,turn:360,rad:360/(2*Math.PI)},Gi=function(l){return typeof l=="string"?l.length>0:typeof l=="number"},Rt=function(l,t,s){return t===void 0&&(t=0),s===void 0&&(s=Math.pow(10,t)),Math.round(s*l)/s+0},Ns=function(l,t,s){return t===void 0&&(t=0),s===void 0&&(s=1),l>s?s:l>t?l:t},vv=function(l){return(l=isFinite(l)?l%360:0)>0?l:l+360},SE=function(l){return{r:Ns(l.r,0,255),g:Ns(l.g,0,255),b:Ns(l.b,0,255),a:Ns(l.a)}},sf=function(l){return{r:Rt(l.r),g:Rt(l.g),b:Rt(l.b),a:Rt(l.a,3)}},cP=/^#([0-9a-f]{3,8})$/i,Oc=function(l){var t=l.toString(16);return t.length<2?"0"+t:t},Sv=function(l){var t=l.r,s=l.g,r=l.b,o=l.a,a=Math.max(t,s,r),h=a-Math.min(t,s,r),u=h?a===t?(s-r)/h:a===s?2+(r-t)/h:4+(t-s)/h:0;return{h:60*(u<0?u+6:u),s:a?h/a*100:0,v:a/255*100,a:o}},Iv=function(l){var t=l.h,s=l.s,r=l.v,o=l.a;t=t/360*6,s/=100,r/=100;var a=Math.floor(t),h=r*(1-s),u=r*(1-(t-a)*s),p=r*(1-(1-t+a)*s),f=a%6;return{r:255*[r,u,h,h,p,r][f],g:255*[p,r,r,u,h,h][f],b:255*[h,h,p,r,r,u][f],a:o}},IE=function(l){return{h:vv(l.h),s:Ns(l.s,0,100),l:Ns(l.l,0,100),a:Ns(l.a)}},xE=function(l){return{h:Rt(l.h),s:Rt(l.s),l:Rt(l.l),a:Rt(l.a,3)}},CE=function(l){return Iv((s=(t=l).s,{h:t.h,s:(s*=((r=t.l)<50?r:100-r)/100)>0?2*s/(r+s)*100:0,v:r+s,a:t.a}));var t,s,r},yl=function(l){return{h:(t=Sv(l)).h,s:(o=(200-(s=t.s))*(r=t.v)/100)>0&&o<200?s*r/100/(o<=100?o:200-o)*100:0,l:o/2,a:t.a};var t,s,r,o},hP=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s*,\s*([+-]?\d*\.?\d+)%\s*,\s*([+-]?\d*\.?\d+)%\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,uP=/^hsla?\(\s*([+-]?\d*\.?\d+)(deg|rad|grad|turn)?\s+([+-]?\d*\.?\d+)%\s+([+-]?\d*\.?\d+)%\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,dP=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*,\s*([+-]?\d*\.?\d+)(%)?\s*(?:,\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,pP=/^rgba?\(\s*([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s+([+-]?\d*\.?\d+)(%)?\s*(?:\/\s*([+-]?\d*\.?\d+)(%)?\s*)?\)$/i,Vf={string:[[function(l){var t=cP.exec(l);return t?(l=t[1]).length<=4?{r:parseInt(l[0]+l[0],16),g:parseInt(l[1]+l[1],16),b:parseInt(l[2]+l[2],16),a:l.length===4?Rt(parseInt(l[3]+l[3],16)/255,2):1}:l.length===6||l.length===8?{r:parseInt(l.substr(0,2),16),g:parseInt(l.substr(2,2),16),b:parseInt(l.substr(4,2),16),a:l.length===8?Rt(parseInt(l.substr(6,2),16)/255,2):1}:null:null},"hex"],[function(l){var t=dP.exec(l)||pP.exec(l);return t?t[2]!==t[4]||t[4]!==t[6]?null:SE({r:Number(t[1])/(t[2]?100/255:1),g:Number(t[3])/(t[4]?100/255:1),b:Number(t[5])/(t[6]?100/255:1),a:t[7]===void 0?1:Number(t[7])/(t[8]?100:1)}):null},"rgb"],[function(l){var t=hP.exec(l)||uP.exec(l);if(!t)return null;var s,r,o=IE({h:(s=t[1],r=t[2],r===void 0&&(r="deg"),Number(s)*(aP[r]||1)),s:Number(t[3]),l:Number(t[4]),a:t[5]===void 0?1:Number(t[5])/(t[6]?100:1)});return CE(o)},"hsl"]],object:[[function(l){var t=l.r,s=l.g,r=l.b,o=l.a,a=o===void 0?1:o;return Gi(t)&&Gi(s)&&Gi(r)?SE({r:Number(t),g:Number(s),b:Number(r),a:Number(a)}):null},"rgb"],[function(l){var t=l.h,s=l.s,r=l.l,o=l.a,a=o===void 0?1:o;if(!Gi(t)||!Gi(s)||!Gi(r))return null;var h=IE({h:Number(t),s:Number(s),l:Number(r),a:Number(a)});return CE(h)},"hsl"],[function(l){var t=l.h,s=l.s,r=l.v,o=l.a,a=o===void 0?1:o;if(!Gi(t)||!Gi(s)||!Gi(r))return null;var h=function(u){return{h:vv(u.h),s:Ns(u.s,0,100),v:Ns(u.v,0,100),a:Ns(u.a)}}({h:Number(t),s:Number(s),v:Number(r),a:Number(a)});return Iv(h)},"hsv"]]},wE=function(l,t){for(var s=0;s<t.length;s++){var r=t[s][0](l);if(r)return[r,t[s][1]]}return[null,void 0]},fP=function(l){return typeof l=="string"?wE(l.trim(),Vf.string):typeof l=="object"&&l!==null?wE(l,Vf.object):[null,void 0]},rf=function(l,t){var s=yl(l);return{h:s.h,s:Ns(s.s+100*t,0,100),l:s.l,a:s.a}},nf=function(l){return(299*l.r+587*l.g+114*l.b)/1e3/255},RE=function(l,t){var s=yl(l);return{h:s.h,s:s.s,l:Ns(s.l+100*t,0,100),a:s.a}},Wf=function(){function l(t){this.parsed=fP(t)[0],this.rgba=this.parsed||{r:0,g:0,b:0,a:1}}return l.prototype.isValid=function(){return this.parsed!==null},l.prototype.brightness=function(){return Rt(nf(this.rgba),2)},l.prototype.isDark=function(){return nf(this.rgba)<.5},l.prototype.isLight=function(){return nf(this.rgba)>=.5},l.prototype.toHex=function(){return t=sf(this.rgba),s=t.r,r=t.g,o=t.b,h=(a=t.a)<1?Oc(Rt(255*a)):"","#"+Oc(s)+Oc(r)+Oc(o)+h;var t,s,r,o,a,h},l.prototype.toRgb=function(){return sf(this.rgba)},l.prototype.toRgbString=function(){return t=sf(this.rgba),s=t.r,r=t.g,o=t.b,(a=t.a)<1?"rgba("+s+", "+r+", "+o+", "+a+")":"rgb("+s+", "+r+", "+o+")";var t,s,r,o,a},l.prototype.toHsl=function(){return xE(yl(this.rgba))},l.prototype.toHslString=function(){return t=xE(yl(this.rgba)),s=t.h,r=t.s,o=t.l,(a=t.a)<1?"hsla("+s+", "+r+"%, "+o+"%, "+a+")":"hsl("+s+", "+r+"%, "+o+"%)";var t,s,r,o,a},l.prototype.toHsv=function(){return t=Sv(this.rgba),{h:Rt(t.h),s:Rt(t.s),v:Rt(t.v),a:Rt(t.a,3)};var t},l.prototype.invert=function(){return $i({r:255-(t=this.rgba).r,g:255-t.g,b:255-t.b,a:t.a});var t},l.prototype.saturate=function(t){return t===void 0&&(t=.1),$i(rf(this.rgba,t))},l.prototype.desaturate=function(t){return t===void 0&&(t=.1),$i(rf(this.rgba,-t))},l.prototype.grayscale=function(){return $i(rf(this.rgba,-1))},l.prototype.lighten=function(t){return t===void 0&&(t=.1),$i(RE(this.rgba,t))},l.prototype.darken=function(t){return t===void 0&&(t=.1),$i(RE(this.rgba,-t))},l.prototype.rotate=function(t){return t===void 0&&(t=15),this.hue(this.hue()+t)},l.prototype.alpha=function(t){return typeof t=="number"?$i({r:(s=this.rgba).r,g:s.g,b:s.b,a:t}):Rt(this.rgba.a,3);var s},l.prototype.hue=function(t){var s=yl(this.rgba);return typeof t=="number"?$i({h:t,s:s.s,l:s.l,a:s.a}):Rt(s.h)},l.prototype.isEqual=function(t){return this.toHex()===$i(t).toHex()},l}(),$i=function(l){return l instanceof Wf?l:new Wf(l)},kE=[],gP=function(l){l.forEach(function(t){kE.indexOf(t)<0&&(t(Wf,Vf),kE.push(t))})};function mP(l,t){var s={white:"#ffffff",bisque:"#ffe4c4",blue:"#0000ff",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",antiquewhite:"#faebd7",aqua:"#00ffff",azure:"#f0ffff",whitesmoke:"#f5f5f5",papayawhip:"#ffefd5",plum:"#dda0dd",blanchedalmond:"#ffebcd",black:"#000000",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",cornsilk:"#fff8dc",cornflowerblue:"#6495ed",burlywood:"#deb887",aquamarine:"#7fffd4",beige:"#f5f5dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkkhaki:"#bdb76b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",peachpuff:"#ffdab9",darkmagenta:"#8b008b",darkred:"#8b0000",darkorchid:"#9932cc",darkorange:"#ff8c00",darkslateblue:"#483d8b",gray:"#808080",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",deeppink:"#ff1493",deepskyblue:"#00bfff",wheat:"#f5deb3",firebrick:"#b22222",floralwhite:"#fffaf0",ghostwhite:"#f8f8ff",darkviolet:"#9400d3",magenta:"#ff00ff",green:"#008000",dodgerblue:"#1e90ff",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",blueviolet:"#8a2be2",forestgreen:"#228b22",lawngreen:"#7cfc00",indianred:"#cd5c5c",indigo:"#4b0082",fuchsia:"#ff00ff",brown:"#a52a2a",maroon:"#800000",mediumblue:"#0000cd",lightcoral:"#f08080",darkturquoise:"#00ced1",lightcyan:"#e0ffff",ivory:"#fffff0",lightyellow:"#ffffe0",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",linen:"#faf0e6",mediumaquamarine:"#66cdaa",lemonchiffon:"#fffacd",lime:"#00ff00",khaki:"#f0e68c",mediumseagreen:"#3cb371",limegreen:"#32cd32",mediumspringgreen:"#00fa9a",lightskyblue:"#87cefa",lightblue:"#add8e6",midnightblue:"#191970",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",mintcream:"#f5fffa",lightslategray:"#778899",lightslategrey:"#778899",navajowhite:"#ffdead",navy:"#000080",mediumvioletred:"#c71585",powderblue:"#b0e0e6",palegoldenrod:"#eee8aa",oldlace:"#fdf5e6",paleturquoise:"#afeeee",mediumturquoise:"#48d1cc",mediumorchid:"#ba55d3",rebeccapurple:"#663399",lightsteelblue:"#b0c4de",mediumslateblue:"#7b68ee",thistle:"#d8bfd8",tan:"#d2b48c",orchid:"#da70d6",mediumpurple:"#9370db",purple:"#800080",pink:"#ffc0cb",skyblue:"#87ceeb",springgreen:"#00ff7f",palegreen:"#98fb98",red:"#ff0000",yellow:"#ffff00",slateblue:"#6a5acd",lavenderblush:"#fff0f5",peru:"#cd853f",palevioletred:"#db7093",violet:"#ee82ee",teal:"#008080",slategray:"#708090",slategrey:"#708090",aliceblue:"#f0f8ff",darkseagreen:"#8fbc8f",darkolivegreen:"#556b2f",greenyellow:"#adff2f",seagreen:"#2e8b57",seashell:"#fff5ee",tomato:"#ff6347",silver:"#c0c0c0",sienna:"#a0522d",lavender:"#e6e6fa",lightgreen:"#90ee90",orange:"#ffa500",orangered:"#ff4500",steelblue:"#4682b4",royalblue:"#4169e1",turquoise:"#40e0d0",yellowgreen:"#9acd32",salmon:"#fa8072",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",darksalmon:"#e9967a",lightgoldenrodyellow:"#fafad2",snow:"#fffafa",lightgrey:"#d3d3d3",lightgray:"#d3d3d3",dimgray:"#696969",dimgrey:"#696969",olivedrab:"#6b8e23",olive:"#808000"},r={};for(var o in s)r[s[o]]=o;var a={};l.prototype.toName=function(h){if(!(this.rgba.a||this.rgba.r||this.rgba.g||this.rgba.b))return"transparent";var u,p,f=r[this.toHex()];if(f)return f;if(h!=null&&h.closest){var g=this.toRgb(),_=1/0,$="black";if(!a.length)for(var E in s)a[E]=new l(s[E]).toRgb();for(var v in s){var w=(u=g,p=a[v],Math.pow(u.r-p.r,2)+Math.pow(u.g-p.g,2)+Math.pow(u.b-p.b,2));w<_&&(_=w,$=v)}return $}},t.string.push([function(h){var u=h.toLowerCase(),p=u==="transparent"?"#0000":s[u];return p?new l(p).toRgb():null},"name"])}gP([mP]);const no=class $l{constructor(t=16777215){this._value=null,this._components=new Float32Array(4),this._components.fill(1),this._int=16777215,this.value=t}get red(){return this._components[0]}get green(){return this._components[1]}get blue(){return this._components[2]}get alpha(){return this._components[3]}setValue(t){return this.value=t,this}set value(t){if(t instanceof $l)this._value=this._cloneSource(t._value),this._int=t._int,this._components.set(t._components);else{if(t===null)throw new Error("Cannot set Color#value to null");(this._value===null||!this._isSourceEqual(this._value,t))&&(this._value=this._cloneSource(t),this._normalize(this._value))}}get value(){return this._value}_cloneSource(t){return typeof t=="string"||typeof t=="number"||t instanceof Number||t===null?t:Array.isArray(t)||ArrayBuffer.isView(t)?t.slice(0):typeof t=="object"&&t!==null?{...t}:t}_isSourceEqual(t,s){const r=typeof t;if(r!==typeof s)return!1;if(r==="number"||r==="string"||t instanceof Number)return t===s;if(Array.isArray(t)&&Array.isArray(s)||ArrayBuffer.isView(t)&&ArrayBuffer.isView(s))return t.length!==s.length?!1:t.every((a,h)=>a===s[h]);if(t!==null&&s!==null){const a=Object.keys(t),h=Object.keys(s);return a.length!==h.length?!1:a.every(u=>t[u]===s[u])}return t===s}toRgba(){const[t,s,r,o]=this._components;return{r:t,g:s,b:r,a:o}}toRgb(){const[t,s,r]=this._components;return{r:t,g:s,b:r}}toRgbaString(){const[t,s,r]=this.toUint8RgbArray();return`rgba(${t},${s},${r},${this.alpha})`}toUint8RgbArray(t){const[s,r,o]=this._components;return this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb),t[0]=Math.round(s*255),t[1]=Math.round(r*255),t[2]=Math.round(o*255),t}toArray(t){this._arrayRgba||(this._arrayRgba=[]),t||(t=this._arrayRgba);const[s,r,o,a]=this._components;return t[0]=s,t[1]=r,t[2]=o,t[3]=a,t}toRgbArray(t){this._arrayRgb||(this._arrayRgb=[]),t||(t=this._arrayRgb);const[s,r,o]=this._components;return t[0]=s,t[1]=r,t[2]=o,t}toNumber(){return this._int}toBgrNumber(){const[t,s,r]=this.toUint8RgbArray();return(r<<16)+(s<<8)+t}toLittleEndianNumber(){const t=this._int;return(t>>16)+(t&65280)+((t&255)<<16)}multiply(t){const[s,r,o,a]=$l._temp.setValue(t)._components;return this._components[0]*=s,this._components[1]*=r,this._components[2]*=o,this._components[3]*=a,this._refreshInt(),this._value=null,this}premultiply(t,s=!0){return s&&(this._components[0]*=t,this._components[1]*=t,this._components[2]*=t),this._components[3]=t,this._refreshInt(),this._value=null,this}toPremultiplied(t,s=!0){if(t===1)return(255<<24)+this._int;if(t===0)return s?0:this._int;let r=this._int>>16&255,o=this._int>>8&255,a=this._int&255;return s&&(r=r*t+.5|0,o=o*t+.5|0,a=a*t+.5|0),(t*255<<24)+(r<<16)+(o<<8)+a}toHex(){const t=this._int.toString(16);return`#${"000000".substring(0,6-t.length)+t}`}toHexa(){const s=Math.round(this._components[3]*255).toString(16);return this.toHex()+"00".substring(0,2-s.length)+s}setAlpha(t){return this._components[3]=this._clamp(t),this}_normalize(t){let s,r,o,a;if((typeof t=="number"||t instanceof Number)&&t>=0&&t<=16777215){const h=t;s=(h>>16&255)/255,r=(h>>8&255)/255,o=(h&255)/255,a=1}else if((Array.isArray(t)||t instanceof Float32Array)&&t.length>=3&&t.length<=4)t=this._clamp(t),[s,r,o,a=1]=t;else if((t instanceof Uint8Array||t instanceof Uint8ClampedArray)&&t.length>=3&&t.length<=4)t=this._clamp(t,0,255),[s,r,o,a=255]=t,s/=255,r/=255,o/=255,a/=255;else if(typeof t=="string"||typeof t=="object"){if(typeof t=="string"){const u=$l.HEX_PATTERN.exec(t);u&&(t=`#${u[2]}`)}const h=$i(t);h.isValid()&&({r:s,g:r,b:o,a}=h.rgba,s/=255,r/=255,o/=255)}if(s!==void 0)this._components[0]=s,this._components[1]=r,this._components[2]=o,this._components[3]=a,this._refreshInt();else throw new Error(`Unable to convert color ${t}`)}_refreshInt(){this._clamp(this._components);const[t,s,r]=this._components;this._int=(t*255<<16)+(s*255<<8)+(r*255|0)}_clamp(t,s=0,r=1){return typeof t=="number"?Math.min(Math.max(t,s),r):(t.forEach((o,a)=>{t[a]=Math.min(Math.max(o,s),r)}),t)}static isColorLike(t){return typeof t=="number"||typeof t=="string"||t instanceof Number||t instanceof $l||Array.isArray(t)||t instanceof Uint8Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t.r!==void 0&&t.g!==void 0&&t.b!==void 0||t.r!==void 0&&t.g!==void 0&&t.b!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0||t.h!==void 0&&t.s!==void 0&&t.l!==void 0&&t.a!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0||t.h!==void 0&&t.s!==void 0&&t.v!==void 0&&t.a!==void 0}};no.shared=new no;no._temp=new no;no.HEX_PATTERN=/^(#|0x)?(([a-f0-9]{3}){1,2}([a-f0-9]{2})?)$/i;let We=no;const _P={cullArea:null,cullable:!1,cullableChildren:!0};let of=0;const OE=500;function we(...l){of!==OE&&(of++,of===OE?console.warn("PixiJS Warning: too many warnings, no more warnings will be reported to the console by PixiJS."):console.warn("PixiJS Warning: ",...l))}class Tg{constructor(t,s){this._pool=[],this._count=0,this._index=0,this._classType=t,s&&this.prepopulate(s)}prepopulate(t){for(let s=0;s<t;s++)this._pool[this._index++]=new this._classType;this._count+=t}get(t){var r;let s;return this._index>0?s=this._pool[--this._index]:s=new this._classType,(r=s.init)==null||r.call(s,t),s}return(t){var s;(s=t.reset)==null||s.call(t),this._pool[this._index++]=t}get totalSize(){return this._count}get totalFree(){return this._index}get totalUsed(){return this._count-this._index}clear(){this._pool.length=0,this._index=0}}class $P{constructor(){this._poolsByClass=new Map}prepopulate(t,s){this.getPool(t).prepopulate(s)}get(t,s){return this.getPool(t).get(s)}return(t){this.getPool(t.constructor).return(t)}getPool(t){return this._poolsByClass.has(t)||this._poolsByClass.set(t,new Tg(t)),this._poolsByClass.get(t)}stats(){const t={};return this._poolsByClass.forEach(s=>{const r=t[s._classType.name]?s._classType.name+s._classType.ID:s._classType.name;t[r]={free:s.totalFree,used:s.totalUsed,size:s.totalSize}}),t}}const Pt=new $P,TP={get isCachedAsTexture(){var l;return!!((l=this.renderGroup)!=null&&l.isCachedAsTexture)},cacheAsTexture(l){typeof l=="boolean"&&l===!1?this.disableRenderGroup():(this.enableRenderGroup(),this.renderGroup.enableCacheAsTexture(l===!0?{}:l))},updateCacheTexture(){var l;(l=this.renderGroup)==null||l.updateCacheTexture()},get cacheAsBitmap(){return this.isCachedAsTexture},set cacheAsBitmap(l){ke("v8.6.0","cacheAsBitmap is deprecated, use cacheAsTexture instead."),this.cacheAsTexture(l)}};function xv(l,t,s){const r=l.length;let o;if(t>=r||s===0)return;s=t+s>r?r-t:s;const a=r-s;for(o=t;o<a;++o)l[o]=l[o+s];l.length=a}const bP={allowChildren:!0,removeChildren(l=0,t){var a;const s=t??this.children.length,r=s-l,o=[];if(r>0&&r<=s){for(let u=s-1;u>=l;u--){const p=this.children[u];p&&(o.push(p),p.parent=null)}xv(this.children,l,s);const h=this.renderGroup||this.parentRenderGroup;h&&h.removeChildren(o);for(let u=0;u<o.length;++u){const p=o[u];(a=p.parentRenderLayer)==null||a.detach(p),this.emit("childRemoved",p,this,u),o[u].emit("removed",this)}return o.length>0&&this._didViewChangeTick++,o}else if(r===0&&this.children.length===0)return o;throw new RangeError("removeChildren: numeric values are outside the acceptable range.")},removeChildAt(l){const t=this.getChildAt(l);return this.removeChild(t)},getChildAt(l){if(l<0||l>=this.children.length)throw new Error(`getChildAt: Index (${l}) does not exist.`);return this.children[l]},setChildIndex(l,t){if(t<0||t>=this.children.length)throw new Error(`The index ${t} supplied is out of bounds ${this.children.length}`);this.getChildIndex(l),this.addChildAt(l,t)},getChildIndex(l){const t=this.children.indexOf(l);if(t===-1)throw new Error("The supplied Container must be a child of the caller");return t},addChildAt(l,t){this.allowChildren||ke(He,"addChildAt: Only Containers will be allowed to add children in v8.0.0");const{children:s}=this;if(t<0||t>s.length)throw new Error(`${l}addChildAt: The index ${t} supplied is out of bounds ${s.length}`);if(l.parent){const o=l.parent.children.indexOf(l);if(l.parent===this&&o===t)return l;o!==-1&&l.parent.children.splice(o,1)}t===s.length?s.push(l):s.splice(t,0,l),l.parent=this,l.didChange=!0,l._updateFlags=15;const r=this.renderGroup||this.parentRenderGroup;return r&&r.addChild(l),this.sortableChildren&&(this.sortDirty=!0),this.emit("childAdded",l,this,t),l.emit("added",this),l},swapChildren(l,t){if(l===t)return;const s=this.getChildIndex(l),r=this.getChildIndex(t);this.children[s]=t,this.children[r]=l;const o=this.renderGroup||this.parentRenderGroup;o&&(o.structureDidChange=!0),this._didContainerChangeTick++},removeFromParent(){var l;(l=this.parent)==null||l.removeChild(this)},reparentChild(...l){return l.length===1?this.reparentChildAt(l[0],this.children.length):(l.forEach(t=>this.reparentChildAt(t,this.children.length)),l[0])},reparentChildAt(l,t){if(l.parent===this)return this.setChildIndex(l,t),l;const s=l.worldTransform.clone();l.removeFromParent(),this.addChildAt(l,t);const r=this.worldTransform.clone();return r.invert(),s.prepend(r),l.setFromMatrix(s),l},replaceChild(l,t){l.updateLocalTransform(),this.addChildAt(t,this.getChildIndex(l)),t.setFromMatrix(l.localTransform),t.updateLocalTransform(),this.removeChild(l)}},EP={collectRenderables(l,t,s){this.parentRenderLayer&&this.parentRenderLayer!==s||this.globalDisplayStatus<7||!this.includeInBuild||(this.sortableChildren&&this.sortChildren(),this.isSimple?this.collectRenderablesSimple(l,t,s):this.renderGroup?t.renderPipes.renderGroup.addRenderGroup(this.renderGroup,l):this.collectRenderablesWithEffects(l,t,s))},collectRenderablesSimple(l,t,s){const r=this.children,o=r.length;for(let a=0;a<o;a++)r[a].collectRenderables(l,t,s)},collectRenderablesWithEffects(l,t,s){const{renderPipes:r}=t;for(let o=0;o<this.effects.length;o++){const a=this.effects[o];r[a.pipe].push(a,this,l)}this.collectRenderablesSimple(l,t,s);for(let o=this.effects.length-1;o>=0;o--){const a=this.effects[o];r[a.pipe].pop(a,this,l)}}};class sh{constructor(){this.pipe="filter",this.priority=1}destroy(){for(let t=0;t<this.filters.length;t++)this.filters[t].destroy();this.filters=null,this.filterArea=null}}class yP{constructor(){this._effectClasses=[],this._tests=[],this._initialized=!1}init(){this._initialized||(this._initialized=!0,this._effectClasses.forEach(t=>{this.add({test:t.test,maskClass:t})}))}add(t){this._tests.push(t)}getMaskEffect(t){this._initialized||this.init();for(let s=0;s<this._tests.length;s++){const r=this._tests[s];if(r.test(t))return Pt.get(r.maskClass,t)}return t}returnMaskEffect(t){Pt.return(t)}}const zf=new yP;Se.handleByList(V.MaskEffect,zf._effectClasses);const vP={_maskEffect:null,_maskOptions:{inverse:!1},_filterEffect:null,effects:[],_markStructureAsChanged(){const l=this.renderGroup||this.parentRenderGroup;l&&(l.structureDidChange=!0)},addEffect(l){this.effects.indexOf(l)===-1&&(this.effects.push(l),this.effects.sort((s,r)=>s.priority-r.priority),this._markStructureAsChanged(),this._updateIsSimple())},removeEffect(l){const t=this.effects.indexOf(l);t!==-1&&(this.effects.splice(t,1),this._markStructureAsChanged(),this._updateIsSimple())},set mask(l){const t=this._maskEffect;(t==null?void 0:t.mask)!==l&&(t&&(this.removeEffect(t),zf.returnMaskEffect(t),this._maskEffect=null),l!=null&&(this._maskEffect=zf.getMaskEffect(l),this.addEffect(this._maskEffect)))},get mask(){var l;return(l=this._maskEffect)==null?void 0:l.mask},setMask(l){this._maskOptions={...this._maskOptions,...l},l.mask&&(this.mask=l.mask),this._markStructureAsChanged()},set filters(l){var a;!Array.isArray(l)&&l&&(l=[l]);const t=this._filterEffect||(this._filterEffect=new sh);l=l;const s=(l==null?void 0:l.length)>0,r=((a=t.filters)==null?void 0:a.length)>0,o=s!==r;l=Array.isArray(l)?l.slice(0):l,t.filters=Object.freeze(l),o&&(s?this.addEffect(t):(this.removeEffect(t),t.filters=l??null))},get filters(){var l;return(l=this._filterEffect)==null?void 0:l.filters},set filterArea(l){this._filterEffect||(this._filterEffect=new sh),this._filterEffect.filterArea=l},get filterArea(){var l;return(l=this._filterEffect)==null?void 0:l.filterArea}},SP={label:null,get name(){return ke(He,"Container.name property has been removed, use Container.label instead"),this.label},set name(l){ke(He,"Container.name property has been removed, use Container.label instead"),this.label=l},getChildByName(l,t=!1){return this.getChildByLabel(l,t)},getChildByLabel(l,t=!1){const s=this.children;for(let r=0;r<s.length;r++){const o=s[r];if(o.label===l||l instanceof RegExp&&l.test(o.label))return o}if(t)for(let r=0;r<s.length;r++){const a=s[r].getChildByLabel(l,!0);if(a)return a}return null},getChildrenByLabel(l,t=!1,s=[]){const r=this.children;for(let o=0;o<r.length;o++){const a=r[o];(a.label===l||l instanceof RegExp&&l.test(a.label))&&s.push(a)}if(t)for(let o=0;o<r.length;o++)r[o].getChildrenByLabel(l,!0,s);return s}},is=new Tg(Te),Xi=new Tg(Yt),IP=new Te,xP={getFastGlobalBounds(l,t){t||(t=new Yt),t.clear(),this._getGlobalBoundsRecursive(!!l,t,this.parentRenderLayer),t.isValid||t.set(0,0,0,0);const s=this.renderGroup||this.parentRenderGroup;return t.applyMatrix(s.worldTransform),t},_getGlobalBoundsRecursive(l,t,s){let r=t;if(l&&this.parentRenderLayer&&this.parentRenderLayer!==s||this.localDisplayStatus!==7||!this.measurable)return;const o=!!this.effects.length;if((this.renderGroup||o)&&(r=Xi.get().clear()),this.boundsArea)t.addRect(this.boundsArea,this.worldTransform);else{if(this.renderPipeId){const h=this.bounds;r.addFrame(h.minX,h.minY,h.maxX,h.maxY,this.groupTransform)}const a=this.children;for(let h=0;h<a.length;h++)a[h]._getGlobalBoundsRecursive(l,r,s)}if(o){let a=!1;const h=this.renderGroup||this.parentRenderGroup;for(let u=0;u<this.effects.length;u++)this.effects[u].addBounds&&(a||(a=!0,r.applyMatrix(h.worldTransform)),this.effects[u].addBounds(r,!0));a&&(r.applyMatrix(h.worldTransform.copyTo(IP).invert()),t.addBounds(r,this.relativeGroupTransform)),t.addBounds(r),Xi.return(r)}else this.renderGroup&&(t.addBounds(r,this.relativeGroupTransform),Xi.return(r))}};function bg(l,t,s){s.clear();let r,o;return l.parent?t?r=l.parent.worldTransform:(o=is.get().identity(),r=Eg(l,o)):r=Te.IDENTITY,Cv(l,s,r,t),o&&is.return(o),s.isValid||s.set(0,0,0,0),s}function Cv(l,t,s,r){var u,p;if(!l.visible||!l.measurable)return;let o;r?o=l.worldTransform:(l.updateLocalTransform(),o=is.get(),o.appendFrom(l.localTransform,s));const a=t,h=!!l.effects.length;if(h&&(t=Xi.get().clear()),l.boundsArea)t.addRect(l.boundsArea,o);else{l.bounds&&(t.matrix=o,t.addBounds(l.bounds));for(let f=0;f<l.children.length;f++)Cv(l.children[f],t,o,r)}if(h){for(let f=0;f<l.effects.length;f++)(p=(u=l.effects[f]).addBounds)==null||p.call(u,t);a.addBounds(t,Te.IDENTITY),Xi.return(t)}r||is.return(o)}function Eg(l,t){const s=l.parent;return s&&(Eg(s,t),s.updateLocalTransform(),t.append(s.localTransform)),t}function wv(l,t){if(l===16777215||!t)return t;if(t===16777215||!l)return l;const s=l>>16&255,r=l>>8&255,o=l&255,a=t>>16&255,h=t>>8&255,u=t&255,p=s*a/255|0,f=r*h/255|0,g=o*u/255|0;return(p<<16)+(f<<8)+g}const AE=16777215;function ih(l,t){return l===AE?t:t===AE?l:wv(l,t)}function jc(l){return((l&255)<<16)+(l&65280)+(l>>16&255)}const CP={getGlobalAlpha(l){if(l)return this.renderGroup?this.renderGroup.worldAlpha:this.parentRenderGroup?this.parentRenderGroup.worldAlpha*this.alpha:this.alpha;let t=this.alpha,s=this.parent;for(;s;)t*=s.alpha,s=s.parent;return t},getGlobalTransform(l,t){if(t)return l.copyFrom(this.worldTransform);this.updateLocalTransform();const s=Eg(this,is.get().identity());return l.appendFrom(this.localTransform,s),is.return(s),l},getGlobalTint(l){if(l)return this.renderGroup?jc(this.renderGroup.worldColor):this.parentRenderGroup?jc(ih(this.localColor,this.parentRenderGroup.worldColor)):this.tint;let t=this.localColor,s=this.parent;for(;s;)t=ih(t,s.localColor),s=s.parent;return jc(t)}};function yg(l,t,s){return t.clear(),s||(s=Te.IDENTITY),Rv(l,t,s,l,!0),t.isValid||t.set(0,0,0,0),t}function Rv(l,t,s,r,o){var p,f;let a;if(o)a=is.get(),a=s.copyTo(a);else{if(!l.visible||!l.measurable)return;l.updateLocalTransform();const g=l.localTransform;a=is.get(),a.appendFrom(g,s)}const h=t,u=!!l.effects.length;if(u&&(t=Xi.get().clear()),l.boundsArea)t.addRect(l.boundsArea,a);else{l.renderPipeId&&(t.matrix=a,t.addBounds(l.bounds));const g=l.children;for(let _=0;_<g.length;_++)Rv(g[_],t,a,r,!1)}if(u){for(let g=0;g<l.effects.length;g++)(f=(p=l.effects[g]).addLocalBounds)==null||f.call(p,t,r);h.addBounds(t,Te.IDENTITY),Xi.return(t)}is.return(a)}function kv(l,t){const s=l.children;for(let r=0;r<s.length;r++){const o=s[r],a=o.uid,h=(o._didViewChangeTick&65535)<<16|o._didContainerChangeTick&65535,u=t.index;(t.data[u]!==a||t.data[u+1]!==h)&&(t.data[t.index]=a,t.data[t.index+1]=h,t.didChange=!0),t.index=u+2,o.children.length&&kv(o,t)}return t.didChange}const wP=new Te,RP={_localBoundsCacheId:-1,_localBoundsCacheData:null,_setWidth(l,t){const s=Math.sign(this.scale.x)||1;t!==0?this.scale.x=l/t*s:this.scale.x=s},_setHeight(l,t){const s=Math.sign(this.scale.y)||1;t!==0?this.scale.y=l/t*s:this.scale.y=s},getLocalBounds(){this._localBoundsCacheData||(this._localBoundsCacheData={data:[],index:1,didChange:!1,localBounds:new Yt});const l=this._localBoundsCacheData;return l.index=1,l.didChange=!1,l.data[0]!==this._didViewChangeTick&&(l.didChange=!0,l.data[0]=this._didViewChangeTick),kv(this,l),l.didChange&&yg(this,l.localBounds,wP),l.localBounds},getBounds(l,t){return bg(this,l,t||new Yt)}},kP={_onRender:null,set onRender(l){const t=this.renderGroup||this.parentRenderGroup;if(!l){this._onRender&&(t==null||t.removeOnRender(this)),this._onRender=null;return}this._onRender||t==null||t.addOnRender(this),this._onRender=l},get onRender(){return this._onRender}},OP={_zIndex:0,sortDirty:!1,sortableChildren:!1,get zIndex(){return this._zIndex},set zIndex(l){this._zIndex!==l&&(this._zIndex=l,this.depthOfChildModified())},depthOfChildModified(){this.parent&&(this.parent.sortableChildren=!0,this.parent.sortDirty=!0),this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0)},sortChildren(){this.sortDirty&&(this.sortDirty=!1,this.children.sort(AP))}};function AP(l,t){return l._zIndex-t._zIndex}const MP={getGlobalPosition(l=new ve,t=!1){return this.parent?this.parent.toGlobal(this._position,l,t):(l.x=this._position.x,l.y=this._position.y),l},toGlobal(l,t,s=!1){const r=this.getGlobalTransform(is.get(),s);return t=r.apply(l,t),is.return(r),t},toLocal(l,t,s,r){t&&(l=t.toGlobal(l,s,r));const o=this.getGlobalTransform(is.get(),r);return s=o.applyInverse(l,s),is.return(o),s}};class Ov{constructor(){this.uid=st("instructionSet"),this.instructions=[],this.instructionSize=0,this.renderables=[],this.gcTick=0}reset(){this.instructionSize=0}add(t){this.instructions[this.instructionSize++]=t}log(){this.instructions.length=this.instructionSize,console.table(this.instructions,["type","action"])}}let LP=0;class PP{constructor(t){this._poolKeyHash=Object.create(null),this._texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this.textureStyle=new ln(this.textureOptions)}createTexture(t,s,r){const o=new vt({...this.textureOptions,width:t,height:s,resolution:1,antialias:r,autoGarbageCollect:!1});return new me({source:o,label:`texturePool_${LP++}`})}getOptimalTexture(t,s,r=1,o){let a=Math.ceil(t*r-1e-6),h=Math.ceil(s*r-1e-6);a=ro(a),h=ro(h);const u=(a<<17)+(h<<1)+(o?1:0);this._texturePool[u]||(this._texturePool[u]=[]);let p=this._texturePool[u].pop();return p||(p=this.createTexture(a,h,o)),p.source._resolution=r,p.source.width=a/r,p.source.height=h/r,p.source.pixelWidth=a,p.source.pixelHeight=h,p.frame.x=0,p.frame.y=0,p.frame.width=t,p.frame.height=s,p.updateUvs(),this._poolKeyHash[p.uid]=u,p}getSameSizeTexture(t,s=!1){const r=t.source;return this.getOptimalTexture(t.width,t.height,r._resolution,s)}returnTexture(t,s=!1){const r=this._poolKeyHash[t.uid];s&&(t.source.style=this.textureStyle),this._texturePool[r].push(t)}clear(t){if(t=t!==!1,t)for(const s in this._texturePool){const r=this._texturePool[s];if(r)for(let o=0;o<r.length;o++)r[o].destroy(!0)}this._texturePool={}}}const zt=new PP;class NP{constructor(){this.renderPipeId="renderGroup",this.root=null,this.canBundle=!1,this.renderGroupParent=null,this.renderGroupChildren=[],this.worldTransform=new Te,this.worldColorAlpha=4294967295,this.worldColor=16777215,this.worldAlpha=1,this.childrenToUpdate=Object.create(null),this.updateTick=0,this.gcTick=0,this.childrenRenderablesToUpdate={list:[],index:0},this.structureDidChange=!0,this.instructionSet=new Ov,this._onRenderContainers=[],this.textureNeedsUpdate=!0,this.isCachedAsTexture=!1,this._matrixDirty=7}init(t){this.root=t,t._onRender&&this.addOnRender(t),t.didChange=!0;const s=t.children;for(let r=0;r<s.length;r++){const o=s[r];o._updateFlags=15,this.addChild(o)}}enableCacheAsTexture(t={}){this.textureOptions=t,this.isCachedAsTexture=!0,this.textureNeedsUpdate=!0}disableCacheAsTexture(){this.isCachedAsTexture=!1,this.texture&&(zt.returnTexture(this.texture),this.texture=null)}updateCacheTexture(){this.textureNeedsUpdate=!0}reset(){this.renderGroupChildren.length=0;for(const t in this.childrenToUpdate){const s=this.childrenToUpdate[t];s.list.fill(null),s.index=0}this.childrenRenderablesToUpdate.index=0,this.childrenRenderablesToUpdate.list.fill(null),this.root=null,this.updateTick=0,this.structureDidChange=!0,this._onRenderContainers.length=0,this.renderGroupParent=null,this.disableCacheAsTexture()}get localTransform(){return this.root.localTransform}addRenderGroupChild(t){t.renderGroupParent&&t.renderGroupParent._removeRenderGroupChild(t),t.renderGroupParent=this,this.renderGroupChildren.push(t)}_removeRenderGroupChild(t){const s=this.renderGroupChildren.indexOf(t);s>-1&&this.renderGroupChildren.splice(s,1),t.renderGroupParent=null}addChild(t){if(this.structureDidChange=!0,t.parentRenderGroup=this,t.updateTick=-1,t.parent===this.root?t.relativeRenderGroupDepth=1:t.relativeRenderGroupDepth=t.parent.relativeRenderGroupDepth+1,t.didChange=!0,this.onChildUpdate(t),t.renderGroup){this.addRenderGroupChild(t.renderGroup);return}t._onRender&&this.addOnRender(t);const s=t.children;for(let r=0;r<s.length;r++)this.addChild(s[r])}removeChild(t){if(this.structureDidChange=!0,t._onRender&&(t.renderGroup||this.removeOnRender(t)),t.parentRenderGroup=null,t.renderGroup){this._removeRenderGroupChild(t.renderGroup);return}const s=t.children;for(let r=0;r<s.length;r++)this.removeChild(s[r])}removeChildren(t){for(let s=0;s<t.length;s++)this.removeChild(t[s])}onChildUpdate(t){let s=this.childrenToUpdate[t.relativeRenderGroupDepth];s||(s=this.childrenToUpdate[t.relativeRenderGroupDepth]={index:0,list:[]}),s.list[s.index++]=t}updateRenderable(t){t.globalDisplayStatus<7||(this.instructionSet.renderPipes[t.renderPipeId].updateRenderable(t),t.didViewUpdate=!1)}onChildViewUpdate(t){this.childrenRenderablesToUpdate.list[this.childrenRenderablesToUpdate.index++]=t}get isRenderable(){return this.root.localDisplayStatus===7&&this.worldAlpha>0}addOnRender(t){this._onRenderContainers.push(t)}removeOnRender(t){this._onRenderContainers.splice(this._onRenderContainers.indexOf(t),1)}runOnRender(t){for(let s=0;s<this._onRenderContainers.length;s++)this._onRenderContainers[s]._onRender(t)}destroy(){this.disableCacheAsTexture(),this.renderGroupParent=null,this.root=null,this.childrenRenderablesToUpdate=null,this.childrenToUpdate=null,this.renderGroupChildren=null,this._onRenderContainers=null,this.instructionSet=null}getChildren(t=[]){const s=this.root.children;for(let r=0;r<s.length;r++)this._getChildren(s[r],t);return t}_getChildren(t,s=[]){if(s.push(t),t.renderGroup)return s;const r=t.children;for(let o=0;o<r.length;o++)this._getChildren(r[o],s);return s}invalidateMatrices(){this._matrixDirty=7}get inverseWorldTransform(){return this._matrixDirty&1?(this._matrixDirty&=-2,this._inverseWorldTransform||(this._inverseWorldTransform=new Te),this._inverseWorldTransform.copyFrom(this.worldTransform).invert()):this._inverseWorldTransform}get textureOffsetInverseTransform(){return this._matrixDirty&2?(this._matrixDirty&=-3,this._textureOffsetInverseTransform||(this._textureOffsetInverseTransform=new Te),this._textureOffsetInverseTransform.copyFrom(this.inverseWorldTransform).translate(-this._textureBounds.x,-this._textureBounds.y)):this._textureOffsetInverseTransform}get inverseParentTextureTransform(){if(!(this._matrixDirty&4))return this._inverseParentTextureTransform;this._matrixDirty&=-5;const t=this._parentCacheAsTextureRenderGroup;return t?(this._inverseParentTextureTransform||(this._inverseParentTextureTransform=new Te),this._inverseParentTextureTransform.copyFrom(this.worldTransform).prepend(t.inverseWorldTransform).translate(-t._textureBounds.x,-t._textureBounds.y)):this.worldTransform}get cacheToLocalTransform(){return this._parentCacheAsTextureRenderGroup?this._parentCacheAsTextureRenderGroup.textureOffsetInverseTransform:null}}function DP(l,t,s={}){for(const r in t)!s[r]&&t[r]!==void 0&&(l[r]=t[r])}const lf=new Wt(null),Ac=new Wt(null),af=new Wt(null,1,1),Mc=new Wt(null),rh=1,vg=2,vl=4;class Nt extends Is{constructor(t={}){var s,r;super(),this.uid=st("renderable"),this._updateFlags=15,this.renderGroup=null,this.parentRenderGroup=null,this.parentRenderGroupIndex=0,this.didChange=!1,this.didViewUpdate=!1,this.relativeRenderGroupDepth=0,this.children=[],this.parent=null,this.includeInBuild=!0,this.measurable=!0,this.isSimple=!0,this.updateTick=-1,this.localTransform=new Te,this.relativeGroupTransform=new Te,this.groupTransform=this.relativeGroupTransform,this.destroyed=!1,this._position=new Wt(this,0,0),this._scale=af,this._pivot=Ac,this._origin=Mc,this._skew=lf,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._rotation=0,this.localColor=16777215,this.localAlpha=1,this.groupAlpha=1,this.groupColor=16777215,this.groupColorAlpha=4294967295,this.localBlendMode="inherit",this.groupBlendMode="normal",this.localDisplayStatus=7,this.globalDisplayStatus=7,this._didContainerChangeTick=0,this._didViewChangeTick=0,this._didLocalTransformChangeId=-1,this.effects=[],DP(this,t,{children:!0,parent:!0,effects:!0}),(s=t.children)==null||s.forEach(o=>this.addChild(o)),(r=t.parent)==null||r.addChild(this)}static mixin(t){ke("8.8.0","Container.mixin is deprecated, please use extensions.mixin instead."),Se.mixin(Nt,t)}set _didChangeId(t){this._didViewChangeTick=t>>12&4095,this._didContainerChangeTick=t&4095}get _didChangeId(){return this._didContainerChangeTick&4095|(this._didViewChangeTick&4095)<<12}addChild(...t){if(this.allowChildren||ke(He,"addChild: Only Containers will be allowed to add children in v8.0.0"),t.length>1){for(let o=0;o<t.length;o++)this.addChild(t[o]);return t[0]}const s=t[0],r=this.renderGroup||this.parentRenderGroup;return s.parent===this?(this.children.splice(this.children.indexOf(s),1),this.children.push(s),r&&(r.structureDidChange=!0),s):(s.parent&&s.parent.removeChild(s),this.children.push(s),this.sortableChildren&&(this.sortDirty=!0),s.parent=this,s.didChange=!0,s._updateFlags=15,r&&r.addChild(s),this.emit("childAdded",s,this,this.children.length-1),s.emit("added",this),this._didViewChangeTick++,s._zIndex!==0&&s.depthOfChildModified(),s)}removeChild(...t){if(t.length>1){for(let o=0;o<t.length;o++)this.removeChild(t[o]);return t[0]}const s=t[0],r=this.children.indexOf(s);return r>-1&&(this._didViewChangeTick++,this.children.splice(r,1),this.renderGroup?this.renderGroup.removeChild(s):this.parentRenderGroup&&this.parentRenderGroup.removeChild(s),s.parentRenderLayer&&s.parentRenderLayer.detach(s),s.parent=null,this.emit("childRemoved",s,this,r),s.emit("removed",this)),s}_onUpdate(t){t&&t===this._skew&&this._updateSkew(),this._didContainerChangeTick++,!this.didChange&&(this.didChange=!0,this.parentRenderGroup&&this.parentRenderGroup.onChildUpdate(this))}set isRenderGroup(t){!!this.renderGroup!==t&&(t?this.enableRenderGroup():this.disableRenderGroup())}get isRenderGroup(){return!!this.renderGroup}enableRenderGroup(){if(this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),this.renderGroup=Pt.get(NP,this),this.groupTransform=Te.IDENTITY,t==null||t.addChild(this),this._updateIsSimple()}disableRenderGroup(){if(!this.renderGroup)return;const t=this.parentRenderGroup;t==null||t.removeChild(this),Pt.return(this.renderGroup),this.renderGroup=null,this.groupTransform=this.relativeGroupTransform,t==null||t.addChild(this),this._updateIsSimple()}_updateIsSimple(){this.isSimple=!this.renderGroup&&this.effects.length===0}get worldTransform(){return this._worldTransform||(this._worldTransform=new Te),this.renderGroup?this._worldTransform.copyFrom(this.renderGroup.worldTransform):this.parentRenderGroup&&this._worldTransform.appendFrom(this.relativeGroupTransform,this.parentRenderGroup.worldTransform),this._worldTransform}get x(){return this._position.x}set x(t){this._position.x=t}get y(){return this._position.y}set y(t){this._position.y=t}get position(){return this._position}set position(t){this._position.copyFrom(t)}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this._onUpdate(this._skew))}get angle(){return this.rotation*tP}set angle(t){this.rotation=t*sP}get pivot(){return this._pivot===Ac&&(this._pivot=new Wt(this,0,0)),this._pivot}set pivot(t){this._pivot===Ac&&(this._pivot=new Wt(this,0,0),this._origin!==Mc&&we("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._pivot.set(t):this._pivot.copyFrom(t)}get skew(){return this._skew===lf&&(this._skew=new Wt(this,0,0)),this._skew}set skew(t){this._skew===lf&&(this._skew=new Wt(this,0,0)),this._skew.copyFrom(t)}get scale(){return this._scale===af&&(this._scale=new Wt(this,1,1)),this._scale}set scale(t){this._scale===af&&(this._scale=new Wt(this,0,0)),typeof t=="string"&&(t=parseFloat(t)),typeof t=="number"?this._scale.set(t):this._scale.copyFrom(t)}get origin(){return this._origin===Mc&&(this._origin=new Wt(this,0,0)),this._origin}set origin(t){this._origin===Mc&&(this._origin=new Wt(this,0,0),this._pivot!==Ac&&we("Setting both a pivot and origin on a Container is not recommended. This can lead to unexpected behavior if not handled carefully.")),typeof t=="number"?this._origin.set(t):this._origin.copyFrom(t)}get width(){return Math.abs(this.scale.x*this.getLocalBounds().width)}set width(t){const s=this.getLocalBounds().width;this._setWidth(t,s)}get height(){return Math.abs(this.scale.y*this.getLocalBounds().height)}set height(t){const s=this.getLocalBounds().height;this._setHeight(t,s)}getSize(t){t||(t={});const s=this.getLocalBounds();return t.width=Math.abs(this.scale.x*s.width),t.height=Math.abs(this.scale.y*s.height),t}setSize(t,s){const r=this.getLocalBounds();typeof t=="object"?(s=t.height??t.width,t=t.width):s??(s=t),t!==void 0&&this._setWidth(t,r.width),s!==void 0&&this._setHeight(s,r.height)}_updateSkew(){const t=this._rotation,s=this._skew;this._cx=Math.cos(t+s._y),this._sx=Math.sin(t+s._y),this._cy=-Math.sin(t-s._x),this._sy=Math.cos(t-s._x)}updateTransform(t){return this.position.set(typeof t.x=="number"?t.x:this.position.x,typeof t.y=="number"?t.y:this.position.y),this.scale.set(typeof t.scaleX=="number"?t.scaleX||1:this.scale.x,typeof t.scaleY=="number"?t.scaleY||1:this.scale.y),this.rotation=typeof t.rotation=="number"?t.rotation:this.rotation,this.skew.set(typeof t.skewX=="number"?t.skewX:this.skew.x,typeof t.skewY=="number"?t.skewY:this.skew.y),this.pivot.set(typeof t.pivotX=="number"?t.pivotX:this.pivot.x,typeof t.pivotY=="number"?t.pivotY:this.pivot.y),this.origin.set(typeof t.originX=="number"?t.originX:this.origin.x,typeof t.originY=="number"?t.originY:this.origin.y),this}setFromMatrix(t){t.decompose(this)}updateLocalTransform(){const t=this._didContainerChangeTick;if(this._didLocalTransformChangeId===t)return;this._didLocalTransformChangeId=t;const s=this.localTransform,r=this._scale,o=this._pivot,a=this._origin,h=this._position,u=r._x,p=r._y,f=o._x,g=o._y,_=-a._x,$=-a._y;s.a=this._cx*u,s.b=this._sx*u,s.c=this._cy*p,s.d=this._sy*p,s.tx=h._x-(f*s.a+g*s.c)+(_*s.a+$*s.c)-_*u,s.ty=h._y-(f*s.b+g*s.d)+(_*s.b+$*s.d)-$*p}set alpha(t){t!==this.localAlpha&&(this.localAlpha=t,this._updateFlags|=rh,this._onUpdate())}get alpha(){return this.localAlpha}set tint(t){const r=We.shared.setValue(t??16777215).toBgrNumber();r!==this.localColor&&(this.localColor=r,this._updateFlags|=rh,this._onUpdate())}get tint(){return jc(this.localColor)}set blendMode(t){this.localBlendMode!==t&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=vg,this.localBlendMode=t,this._onUpdate())}get blendMode(){return this.localBlendMode}get visible(){return!!(this.localDisplayStatus&2)}set visible(t){const s=t?2:0;(this.localDisplayStatus&2)!==s&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=vl,this.localDisplayStatus^=2,this._onUpdate())}get culled(){return!(this.localDisplayStatus&4)}set culled(t){const s=t?0:4;(this.localDisplayStatus&4)!==s&&(this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._updateFlags|=vl,this.localDisplayStatus^=4,this._onUpdate())}get renderable(){return!!(this.localDisplayStatus&1)}set renderable(t){const s=t?1:0;(this.localDisplayStatus&1)!==s&&(this._updateFlags|=vl,this.localDisplayStatus^=1,this.parentRenderGroup&&(this.parentRenderGroup.structureDidChange=!0),this._onUpdate())}get isRenderable(){return this.localDisplayStatus===7&&this.groupAlpha>0}destroy(t=!1){var o;if(this.destroyed)return;this.destroyed=!0;let s;if(this.children.length&&(s=this.removeChildren(0,this.children.length)),this.removeFromParent(),this.parent=null,this._maskEffect=null,this._filterEffect=null,this.effects=null,this._position=null,this._scale=null,this._pivot=null,this._origin=null,this._skew=null,this.emit("destroyed",this),this.removeAllListeners(),(typeof t=="boolean"?t:t==null?void 0:t.children)&&s)for(let a=0;a<s.length;++a)s[a].destroy(t);(o=this.renderGroup)==null||o.destroy(),this.renderGroup=null}}Se.mixin(Nt,bP,xP,MP,kP,RP,vP,SP,OP,_P,TP,CP,EP);class Av extends Nt{constructor(t){super(t),this.canBundle=!0,this.allowChildren=!1,this._roundPixels=0,this._lastUsed=-1,this._gpuData=Object.create(null),this._bounds=new Yt(0,1,0,0),this._boundsDirty=!0}get bounds(){return this._boundsDirty?(this.updateBounds(),this._boundsDirty=!1,this._bounds):this._bounds}get roundPixels(){return!!this._roundPixels}set roundPixels(t){this._roundPixels=t?1:0}containsPoint(t){const s=this.bounds,{x:r,y:o}=t;return r>=s.minX&&r<=s.maxX&&o>=s.minY&&o<=s.maxY}onViewUpdate(){if(this._didViewChangeTick++,this._boundsDirty=!0,this.didViewUpdate)return;this.didViewUpdate=!0;const t=this.renderGroup||this.parentRenderGroup;t&&t.onChildViewUpdate(this)}destroy(t){var s,r;super.destroy(t),this._bounds=null;for(const o in this._gpuData)(r=(s=this._gpuData[o]).destroy)==null||r.call(s);this._gpuData=null}collectRenderablesSimple(t,s,r){const{renderPipes:o}=s;o.blendMode.setBlendMode(this,this.groupBlendMode,t),o[this.renderPipeId].addRenderable(this,t),this.didViewUpdate=!1;const h=this.children,u=h.length;for(let p=0;p<u;p++)h[p].collectRenderables(t,s,r)}}class Mt extends Av{constructor(t=me.EMPTY){t instanceof me&&(t={texture:t});const{texture:s=me.EMPTY,anchor:r,roundPixels:o,width:a,height:h,...u}=t;super({label:"Sprite",...u}),this.renderPipeId="sprite",this.batched=!0,this._visualBounds={minX:0,maxX:1,minY:0,maxY:0},this._anchor=new Wt({_onUpdate:()=>{this.onViewUpdate()}}),r?this.anchor=r:s.defaultAnchor&&(this.anchor=s.defaultAnchor),this.texture=s,this.allowChildren=!1,this.roundPixels=o??!1,a!==void 0&&(this.width=a),h!==void 0&&(this.height=h)}static from(t,s=!1){return t instanceof me?new Mt(t):new Mt(me.from(t,s))}set texture(t){t||(t=me.EMPTY);const s=this._texture;s!==t&&(s&&s.dynamic&&s.off("update",this.onViewUpdate,this),t.dynamic&&t.on("update",this.onViewUpdate,this),this._texture=t,this._width&&this._setWidth(this._width,this._texture.orig.width),this._height&&this._setHeight(this._height,this._texture.orig.height),this.onViewUpdate())}get texture(){return this._texture}get visualBounds(){return yv(this._visualBounds,this._anchor,this._texture),this._visualBounds}get sourceBounds(){return ke("8.6.1","Sprite.sourceBounds is deprecated, use visualBounds instead."),this.visualBounds}updateBounds(){const t=this._anchor,s=this._texture,r=this._bounds,{width:o,height:a}=s.orig;r.minX=-t._x*o,r.maxX=r.minX+o,r.minY=-t._y*a,r.maxY=r.minY+a}destroy(t=!1){if(super.destroy(t),typeof t=="boolean"?t:t==null?void 0:t.texture){const r=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._texture.destroy(r)}this._texture=null,this._visualBounds=null,this._bounds=null,this._anchor=null,this._gpuData=null}get anchor(){return this._anchor}set anchor(t){typeof t=="number"?this._anchor.set(t):this._anchor.copyFrom(t)}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this._setWidth(t,this._texture.orig.width),this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this._setHeight(t,this._texture.orig.height),this._height=t}getSize(t){return t||(t={}),t.width=Math.abs(this.scale.x)*this._texture.orig.width,t.height=Math.abs(this.scale.y)*this._texture.orig.height,t}setSize(t,s){typeof t=="object"?(s=t.height??t.width,t=t.width):s??(s=t),t!==void 0&&this._setWidth(t,this._texture.orig.width),s!==void 0&&this._setHeight(s,this._texture.orig.height)}}const BP=new Yt;function Mv(l,t,s){const r=BP;l.measurable=!0,bg(l,s,r),t.addBoundsMask(r),l.measurable=!1}function Lv(l,t,s){const r=Xi.get();l.measurable=!0;const o=is.get().identity(),a=Pv(l,s,o);yg(l,r,a),l.measurable=!1,t.addBoundsMask(r),is.return(o),Xi.return(r)}function Pv(l,t,s){return l?(l!==t&&(Pv(l.parent,t,s),l.updateLocalTransform(),s.append(l.localTransform)),s):(we("Mask bounds, renderable is not inside the root container"),s)}class Nv{constructor(t){this.priority=0,this.inverse=!1,this.pipe="alphaMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.renderMaskToTexture=!(t instanceof Mt),this.mask.renderable=this.renderMaskToTexture,this.mask.includeInBuild=!this.renderMaskToTexture,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask=null}addBounds(t,s){this.inverse||Mv(this.mask,t,s)}addLocalBounds(t,s){Lv(this.mask,t,s)}containsPoint(t,s){const r=this.mask;return s(r,t)}destroy(){this.reset()}static test(t){return t instanceof Mt}}Nv.extension=V.MaskEffect;class Dv{constructor(t){this.priority=0,this.pipe="colorMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t}destroy(){}static test(t){return typeof t=="number"}}Dv.extension=V.MaskEffect;class Bv{constructor(t){this.priority=0,this.pipe="stencilMask",t!=null&&t.mask&&this.init(t.mask)}init(t){this.mask=t,this.mask.includeInBuild=!1,this.mask.measurable=!1}reset(){this.mask.measurable=!0,this.mask.includeInBuild=!0,this.mask=null}addBounds(t,s){Mv(this.mask,t,s)}addLocalBounds(t,s){Lv(this.mask,t,s)}containsPoint(t,s){const r=this.mask;return s(r,t)}destroy(){this.reset()}static test(t){return t instanceof Nt}}Bv.extension=V.MaskEffect;const FP={createCanvas:(l,t)=>{const s=document.createElement("canvas");return s.width=l,s.height=t,s},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(l,t)=>fetch(l,t),parseXML:l=>new DOMParser().parseFromString(l,"text/xml")};let ME=FP;const it={get(){return ME},set(l){ME=l}};class Yi extends vt{constructor(t){t.resource||(t.resource=it.get().createCanvas()),t.width||(t.width=t.resource.width,t.autoDensity||(t.width/=t.resolution)),t.height||(t.height=t.resource.height,t.autoDensity||(t.height/=t.resolution)),super(t),this.uploadMethodId="image",this.autoDensity=t.autoDensity,this.resizeCanvas(),this.transparent=!!t.transparent}resizeCanvas(){this.autoDensity&&"style"in this.resource&&(this.resource.style.width=`${this.width}px`,this.resource.style.height=`${this.height}px`),(this.resource.width!==this.pixelWidth||this.resource.height!==this.pixelHeight)&&(this.resource.width=this.pixelWidth,this.resource.height=this.pixelHeight)}resize(t=this.width,s=this.height,r=this._resolution){const o=super.resize(t,s,r);return o&&this.resizeCanvas(),o}static test(t){return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement||globalThis.OffscreenCanvas&&t instanceof OffscreenCanvas}get context2D(){return this._context2D||(this._context2D=this.resource.getContext("2d"))}}Yi.extension=V.TextureSource;class Rl extends vt{constructor(t){super(t),this.uploadMethodId="image",this.autoGarbageCollect=!0}static test(t){return globalThis.HTMLImageElement&&t instanceof HTMLImageElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap||globalThis.VideoFrame&&t instanceof VideoFrame}}Rl.extension=V.TextureSource;var kl=(l=>(l[l.INTERACTION=50]="INTERACTION",l[l.HIGH=25]="HIGH",l[l.NORMAL=0]="NORMAL",l[l.LOW=-25]="LOW",l[l.UTILITY=-50]="UTILITY",l))(kl||{});class cf{constructor(t,s=null,r=0,o=!1){this.next=null,this.previous=null,this._destroyed=!1,this._fn=t,this._context=s,this.priority=r,this._once=o}match(t,s=null){return this._fn===t&&this._context===s}emit(t){this._fn&&(this._context?this._fn.call(this._context,t):this._fn(t));const s=this.next;return this._once&&this.destroy(!0),this._destroyed&&(this.next=null),s}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this._fn=null,this._context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const s=this.next;return this.next=t?null:s,this.previous=null,s}}const Fv=class ys{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new cf(null,null,1/0),this.deltaMS=1/ys.targetFPMS,this.elapsedMS=1/ys.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&this._requestId===null&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){this._requestId===null&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){this._requestId!==null&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,s,r=kl.NORMAL){return this._addListener(new cf(t,s,r))}addOnce(t,s,r=kl.NORMAL){return this._addListener(new cf(t,s,r,!0))}_addListener(t){let s=this._head.next,r=this._head;if(!s)t.connect(r);else{for(;s;){if(t.priority>s.priority){t.connect(r);break}r=s,s=s.next}t.previous||t.connect(r)}return this._startIfPossible(),this}remove(t,s){let r=this._head.next;for(;r;)r.match(t,s)?r=r.destroy():r=r.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,s=this._head;for(;s=s.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let s;if(t>this.lastTime){if(s=this.elapsedMS=t-this.lastTime,s>this._maxElapsedMS&&(s=this._maxElapsedMS),s*=this.speed,this._minElapsedMS){const a=t-this._lastFrame|0;if(a<this._minElapsedMS)return;this._lastFrame=t-a%this._minElapsedMS}this.deltaMS=s,this.deltaTime=this.deltaMS*ys.targetFPMS;const r=this._head;let o=r.next;for(;o;)o=o.emit(this);r.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const s=Math.min(this.maxFPS,t),r=Math.min(Math.max(0,s)/1e3,ys.targetFPMS);this._maxElapsedMS=1/r}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(t===0)this._minElapsedMS=0;else{const s=Math.max(this.minFPS,t);this._minElapsedMS=1/(s/1e3)}}static get shared(){if(!ys._shared){const t=ys._shared=new ys;t.autoStart=!0,t._protected=!0}return ys._shared}static get system(){if(!ys._system){const t=ys._system=new ys;t.autoStart=!0,t._protected=!0}return ys._system}};Fv.targetFPMS=.06;let Qs=Fv,hf;async function UP(){return hf??(hf=(async()=>{var h;const t=document.createElement("canvas").getContext("webgl");if(!t)return"premultiply-alpha-on-upload";const s=await new Promise(u=>{const p=document.createElement("video");p.onloadeddata=()=>u(p),p.onerror=()=>u(null),p.autoplay=!1,p.crossOrigin="anonymous",p.preload="auto",p.src="data:video/webm;base64,GkXfo59ChoEBQveBAULygQRC84EIQoKEd2VibUKHgQJChYECGFOAZwEAAAAAAAHTEU2bdLpNu4tTq4QVSalmU6yBoU27i1OrhBZUrmtTrIHGTbuMU6uEElTDZ1OsggEXTbuMU6uEHFO7a1OsggG97AEAAAAAAABZAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmoCrXsYMPQkBNgIRMYXZmV0GETGF2ZkSJiEBEAAAAAAAAFlSua8yuAQAAAAAAAEPXgQFzxYgAAAAAAAAAAZyBACK1nIN1bmSIgQCGhVZfVlA5g4EBI+ODhAJiWgDglLCBArqBApqBAlPAgQFVsIRVuYEBElTDZ9Vzc9JjwItjxYgAAAAAAAAAAWfInEWjh0VOQ09ERVJEh49MYXZjIGxpYnZweC12cDlnyKJFo4hEVVJBVElPTkSHlDAwOjAwOjAwLjA0MDAwMDAwMAAAH0O2dcfngQCgwqGggQAAAIJJg0IAABAAFgA4JBwYSgAAICAAEb///4r+AAB1oZ2mm+6BAaWWgkmDQgAAEAAWADgkHBhKAAAgIABIQBxTu2uRu4+zgQC3iveBAfGCAXHwgQM=",p.load()});if(!s)return"premultiply-alpha-on-upload";const r=t.createTexture();t.bindTexture(t.TEXTURE_2D,r);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.NONE),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,s);const a=new Uint8Array(4);return t.readPixels(0,0,1,1,t.RGBA,t.UNSIGNED_BYTE,a),t.deleteFramebuffer(o),t.deleteTexture(r),(h=t.getExtension("WEBGL_lose_context"))==null||h.loseContext(),a[0]<=a[3]?"premultiplied-alpha":"premultiply-alpha-on-upload"})()),hf}const ph=class Uv extends vt{constructor(t){super(t),this.isReady=!1,this.uploadMethodId="video",t={...Uv.defaultOptions,...t},this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=t.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=t.autoPlay!==!1,this.alphaMode=t.alphaMode??"premultiply-alpha-on-upload",this._videoFrameRequestCallback=this._videoFrameRequestCallback.bind(this),this._videoFrameRequestCallbackHandle=null,this._load=null,this._resolve=null,this._reject=null,this._onCanPlay=this._onCanPlay.bind(this),this._onCanPlayThrough=this._onCanPlayThrough.bind(this),this._onError=this._onError.bind(this),this._onPlayStart=this._onPlayStart.bind(this),this._onPlayStop=this._onPlayStop.bind(this),this._onSeeked=this._onSeeked.bind(this),t.autoLoad!==!1&&this.load()}updateFrame(){if(!this.destroyed){if(this._updateFPS){const t=Qs.shared.elapsedMS*this.resource.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t)}(!this._updateFPS||this._msToNextUpdate<=0)&&(this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0),this.isValid&&this.update()}}_videoFrameRequestCallback(){this.updateFrame(),this.destroyed?this._videoFrameRequestCallbackHandle=null:this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback)}get isValid(){return!!this.resource.videoWidth&&!!this.resource.videoHeight}async load(){if(this._load)return this._load;const t=this.resource,s=this.options;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart),t.addEventListener("pause",this._onPlayStop),t.addEventListener("seeked",this._onSeeked),this._isSourceReady()?this._mediaReady():(s.preload||t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlayThrough),t.addEventListener("error",this._onError,!0)),this.alphaMode=await UP(),this._load=new Promise((r,o)=>{this.isValid?r(this):(this._resolve=r,this._reject=o,s.preloadTimeoutMs!==void 0&&(this._preloadTimeout=setTimeout(()=>{this._onError(new ErrorEvent(`Preload exceeded timeout of ${s.preloadTimeoutMs}ms`))})),t.load())}),this._load}_onError(t){this.resource.removeEventListener("error",this._onError,!0),this.emit("error",t),this._reject&&(this._reject(t),this._reject=null,this._resolve=null)}_isSourcePlaying(){const t=this.resource;return!t.paused&&!t.ended}_isSourceReady(){return this.resource.readyState>2}_onPlayStart(){this.isValid||this._mediaReady(),this._configureAutoUpdate()}_onPlayStop(){this._configureAutoUpdate()}_onSeeked(){this._autoUpdate&&!this._isSourcePlaying()&&(this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0)}_onCanPlay(){this.resource.removeEventListener("canplay",this._onCanPlay),this._mediaReady()}_onCanPlayThrough(){this.resource.removeEventListener("canplaythrough",this._onCanPlay),this._preloadTimeout&&(clearTimeout(this._preloadTimeout),this._preloadTimeout=void 0),this._mediaReady()}_mediaReady(){const t=this.resource;this.isValid&&(this.isReady=!0,this.resize(t.videoWidth,t.videoHeight)),this._msToNextUpdate=0,this.updateFrame(),this._msToNextUpdate=0,this._resolve&&(this._resolve(this),this._resolve=null,this._reject=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&this.resource.play()}destroy(){this._configureAutoUpdate();const t=this.resource;t&&(t.removeEventListener("play",this._onPlayStart),t.removeEventListener("pause",this._onPlayStop),t.removeEventListener("seeked",this._onSeeked),t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlayThrough),t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.destroy()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this._configureAutoUpdate())}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t,this._configureAutoUpdate())}_configureAutoUpdate(){this._autoUpdate&&this._isSourcePlaying()?!this._updateFPS&&this.resource.requestVideoFrameCallback?(this._isConnectedToTicker&&(Qs.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0),this._videoFrameRequestCallbackHandle===null&&(this._videoFrameRequestCallbackHandle=this.resource.requestVideoFrameCallback(this._videoFrameRequestCallback))):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker||(Qs.shared.add(this.updateFrame,this),this._isConnectedToTicker=!0,this._msToNextUpdate=0)):(this._videoFrameRequestCallbackHandle!==null&&(this.resource.cancelVideoFrameCallback(this._videoFrameRequestCallbackHandle),this._videoFrameRequestCallbackHandle=null),this._isConnectedToTicker&&(Qs.shared.remove(this.updateFrame,this),this._isConnectedToTicker=!1,this._msToNextUpdate=0))}static test(t){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement}};ph.extension=V.TextureSource;ph.defaultOptions={...vt.defaultOptions,autoLoad:!0,autoPlay:!0,updateFPS:0,crossorigin:!0,loop:!1,muted:!0,playsinline:!0,preload:!1};ph.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"};let GP=ph;const to=(l,t,s=!1)=>(Array.isArray(l)||(l=[l]),t?l.map(r=>typeof r=="string"||s?t(r):r):l);class HP{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const s=this._cache.get(t);return s||we(`[Assets] Asset id ${t} was not found in the Cache`),s}set(t,s){const r=to(t);let o;for(let p=0;p<this.parsers.length;p++){const f=this.parsers[p];if(f.test(s)){o=f.getCacheableAssets(r,s);break}}const a=new Map(Object.entries(o||{}));o||r.forEach(p=>{a.set(p,s)});const h=[...a.keys()],u={cacheKeys:h,keys:r};r.forEach(p=>{this._cacheMap.set(p,u)}),h.forEach(p=>{const f=o?o[p]:s;this._cache.has(p)&&this._cache.get(p)!==f&&we("[Cache] already has key:",p),this._cache.set(p,a.get(p))})}remove(t){if(!this._cacheMap.has(t)){we(`[Assets] Asset id ${t} was not found in the Cache`);return}const s=this._cacheMap.get(t);s.cacheKeys.forEach(o=>{this._cache.delete(o)}),s.keys.forEach(o=>{this._cacheMap.delete(o)})}get parsers(){return this._parsers}}const Xt=new HP,Xf=[];Se.handleByList(V.TextureSource,Xf);function Gv(l={}){const t=l&&l.resource,s=t?l.resource:l,r=t?l:{resource:l};for(let o=0;o<Xf.length;o++){const a=Xf[o];if(a.test(s))return new a(r)}throw new Error(`Could not find a source type for resource: ${r.resource}`)}function VP(l={},t=!1){const s=l&&l.resource,r=s?l.resource:l,o=s?l:{resource:l};if(!t&&Xt.has(r))return Xt.get(r);const a=new me({source:Gv(o)});return a.on("destroy",()=>{Xt.has(r)&&Xt.remove(r)}),t||Xt.set(r,a),a}function WP(l,t=!1){return typeof l=="string"?Xt.get(l):l instanceof vt?new me({source:l}):VP(l,t)}me.from=WP;vt.from=Gv;Se.add(Nv,Dv,Bv,GP,Rl,Yi,$g);var Hv=(l=>(l[l.Low=0]="Low",l[l.Normal=1]="Normal",l[l.High=2]="High",l))(Hv||{});function qs(l){if(typeof l!="string")throw new TypeError(`Path must be a string. Received ${JSON.stringify(l)}`)}function cl(l){return l.split("?")[0].split("#")[0]}function zP(l){return l.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function XP(l,t,s){return l.replace(new RegExp(zP(t),"g"),s)}function YP(l,t){let s="",r=0,o=-1,a=0,h=-1;for(let u=0;u<=l.length;++u){if(u<l.length)h=l.charCodeAt(u);else{if(h===47)break;h=47}if(h===47){if(!(o===u-1||a===1))if(o!==u-1&&a===2){if(s.length<2||r!==2||s.charCodeAt(s.length-1)!==46||s.charCodeAt(s.length-2)!==46){if(s.length>2){const p=s.lastIndexOf("/");if(p!==s.length-1){p===-1?(s="",r=0):(s=s.slice(0,p),r=s.length-1-s.lastIndexOf("/")),o=u,a=0;continue}}else if(s.length===2||s.length===1){s="",r=0,o=u,a=0;continue}}}else s.length>0?s+=`/${l.slice(o+1,u)}`:s=l.slice(o+1,u),r=u-o-1;o=u,a=0}else h===46&&a!==-1?++a:a=-1}return s}const Ol={toPosix(l){return XP(l,"\\","/")},isUrl(l){return/^https?:/.test(this.toPosix(l))},isDataUrl(l){return/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(l)},isBlobUrl(l){return l.startsWith("blob:")},hasProtocol(l){return/^[^/:]+:/.test(this.toPosix(l))},getProtocol(l){qs(l),l=this.toPosix(l);const t=/^file:\/\/\//.exec(l);if(t)return t[0];const s=/^[^/:]+:\/{0,2}/.exec(l);return s?s[0]:""},toAbsolute(l,t,s){if(qs(l),this.isDataUrl(l)||this.isBlobUrl(l))return l;const r=cl(this.toPosix(t??it.get().getBaseUrl())),o=cl(this.toPosix(s??this.rootname(r)));return l=this.toPosix(l),l.startsWith("/")?Ol.join(o,l.slice(1)):this.isAbsolute(l)?l:this.join(r,l)},normalize(l){if(qs(l),l.length===0)return".";if(this.isDataUrl(l)||this.isBlobUrl(l))return l;l=this.toPosix(l);let t="";const s=l.startsWith("/");this.hasProtocol(l)&&(t=this.rootname(l),l=l.slice(t.length));const r=l.endsWith("/");return l=YP(l),l.length>0&&r&&(l+="/"),s?`/${l}`:t+l},isAbsolute(l){return qs(l),l=this.toPosix(l),this.hasProtocol(l)?!0:l.startsWith("/")},join(...l){if(l.length===0)return".";let t;for(let s=0;s<l.length;++s){const r=l[s];if(qs(r),r.length>0)if(t===void 0)t=r;else{const o=l[s-1]??"";this.joinExtensions.includes(this.extname(o).toLowerCase())?t+=`/../${r}`:t+=`/${r}`}}return t===void 0?".":this.normalize(t)},dirname(l){if(qs(l),l.length===0)return".";l=this.toPosix(l);let t=l.charCodeAt(0);const s=t===47;let r=-1,o=!0;const a=this.getProtocol(l),h=l;l=l.slice(a.length);for(let u=l.length-1;u>=1;--u)if(t=l.charCodeAt(u),t===47){if(!o){r=u;break}}else o=!1;return r===-1?s?"/":this.isUrl(h)?a+l:a:s&&r===1?"//":a+l.slice(0,r)},rootname(l){qs(l),l=this.toPosix(l);let t="";if(l.startsWith("/")?t="/":t=this.getProtocol(l),this.isUrl(l)){const s=l.indexOf("/",t.length);s!==-1?t=l.slice(0,s):t=l,t.endsWith("/")||(t+="/")}return t},basename(l,t){qs(l),t&&qs(t),l=cl(this.toPosix(l));let s=0,r=-1,o=!0,a;if(t!==void 0&&t.length>0&&t.length<=l.length){if(t.length===l.length&&t===l)return"";let h=t.length-1,u=-1;for(a=l.length-1;a>=0;--a){const p=l.charCodeAt(a);if(p===47){if(!o){s=a+1;break}}else u===-1&&(o=!1,u=a+1),h>=0&&(p===t.charCodeAt(h)?--h===-1&&(r=a):(h=-1,r=u))}return s===r?r=u:r===-1&&(r=l.length),l.slice(s,r)}for(a=l.length-1;a>=0;--a)if(l.charCodeAt(a)===47){if(!o){s=a+1;break}}else r===-1&&(o=!1,r=a+1);return r===-1?"":l.slice(s,r)},extname(l){qs(l),l=cl(this.toPosix(l));let t=-1,s=0,r=-1,o=!0,a=0;for(let h=l.length-1;h>=0;--h){const u=l.charCodeAt(h);if(u===47){if(!o){s=h+1;break}continue}r===-1&&(o=!1,r=h+1),u===46?t===-1?t=h:a!==1&&(a=1):t!==-1&&(a=-1)}return t===-1||r===-1||a===0||a===1&&t===r-1&&t===s+1?"":l.slice(t,r)},parse(l){qs(l);const t={root:"",dir:"",base:"",ext:"",name:""};if(l.length===0)return t;l=cl(this.toPosix(l));let s=l.charCodeAt(0);const r=this.isAbsolute(l);let o;t.root=this.rootname(l),r||this.hasProtocol(l)?o=1:o=0;let a=-1,h=0,u=-1,p=!0,f=l.length-1,g=0;for(;f>=o;--f){if(s=l.charCodeAt(f),s===47){if(!p){h=f+1;break}continue}u===-1&&(p=!1,u=f+1),s===46?a===-1?a=f:g!==1&&(g=1):a!==-1&&(g=-1)}return a===-1||u===-1||g===0||g===1&&a===u-1&&a===h+1?u!==-1&&(h===0&&r?t.base=t.name=l.slice(1,u):t.base=t.name=l.slice(h,u)):(h===0&&r?(t.name=l.slice(1,a),t.base=l.slice(1,u)):(t.name=l.slice(h,a),t.base=l.slice(h,u)),t.ext=l.slice(a,u)),t.dir=this.dirname(l),t},sep:"/",delimiter:":",joinExtensions:[".html"]};function Vv(l,t,s,r,o){const a=t[s];for(let h=0;h<a.length;h++){const u=a[h];s<t.length-1?Vv(l.replace(r[s],u),t,s+1,r,o):o.push(l.replace(r[s],u))}}function KP(l){const t=/\{(.*?)\}/g,s=l.match(t),r=[];if(s){const o=[];s.forEach(a=>{const h=a.substring(1,a.length-1).split(",");o.push(h)}),Vv(l,o,0,s,r)}else r.push(l);return r}const LE=l=>!Array.isArray(l);class Wv{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,s)=>`${t}${this._bundleIdConnector}${s}`,extractAssetIdFromBundle:(t,s)=>s.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar"))!=="bar")throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach(s=>{this._preferredOrder.push(s),s.priority||(s.priority=Object.keys(s.params))}),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if(typeof t=="string")this._defaultSearchParams=t;else{const s=t;this._defaultSearchParams=Object.keys(s).map(r=>`${encodeURIComponent(r)}=${encodeURIComponent(s[r])}`).join("&")}}getAlias(t){const{alias:s,src:r}=t;return to(s||r,a=>typeof a=="string"?a:Array.isArray(a)?a.map(h=>(h==null?void 0:h.src)??h):a!=null&&a.src?a.src:a,!0)}addManifest(t){this._manifest&&we("[Resolver] Manifest already exists, this will be overwritten"),this._manifest=t,t.bundles.forEach(s=>{this.addBundle(s.name,s.assets)})}addBundle(t,s){const r=[];let o=s;Array.isArray(s)||(o=Object.entries(s).map(([a,h])=>typeof h=="string"||Array.isArray(h)?{alias:a,src:h}:{alias:a,...h})),o.forEach(a=>{const h=a.src,u=a.alias;let p;if(typeof u=="string"){const f=this._createBundleAssetId(t,u);r.push(f),p=[u,f]}else{const f=u.map(g=>this._createBundleAssetId(t,g));r.push(...f),p=[...u,...f]}this.add({...a,alias:p,src:h})}),this._bundles[t]=r}add(t){const s=[];Array.isArray(t)?s.push(...t):s.push(t);let r;r=a=>{this.hasKey(a)&&we(`[Resolver] already has key: ${a} overwriting`)},to(s).forEach(a=>{const{src:h}=a;let{data:u,format:p,loadParser:f}=a;const g=to(h).map(E=>typeof E=="string"?KP(E):Array.isArray(E)?E:[E]),_=this.getAlias(a);Array.isArray(_)?_.forEach(r):r(_);const $=[];g.forEach(E=>{E.forEach(v=>{let w={};if(typeof v!="object"){w.src=v;for(let x=0;x<this._parsers.length;x++){const C=this._parsers[x];if(C.test(v)){w=C.parse(v);break}}}else u=v.data??u,p=v.format??p,f=v.loadParser??f,w={...w,...v};if(!_)throw new Error(`[Resolver] alias is undefined for this asset: ${w.src}`);w=this._buildResolvedAsset(w,{aliases:_,data:u,format:p,loadParser:f}),$.push(w)})}),_.forEach(E=>{this._assetMap[E]=$})})}resolveBundle(t){const s=LE(t);t=to(t);const r={};return t.forEach(o=>{const a=this._bundles[o];if(a){const h=this.resolve(a),u={};for(const p in h){const f=h[p];u[this._extractAssetIdFromBundle(o,p)]=f}r[o]=u}}),s?r[t[0]]:r}resolveUrl(t){const s=this.resolve(t);if(typeof t!="string"){const r={};for(const o in s)r[o]=s[o].src;return r}return s.src}resolve(t){const s=LE(t);t=to(t);const r={};return t.forEach(o=>{if(!this._resolverHash[o])if(this._assetMap[o]){let a=this._assetMap[o];const h=this._getPreferredOrder(a);h==null||h.priority.forEach(u=>{h.params[u].forEach(p=>{const f=a.filter(g=>g[u]?g[u]===p:!1);f.length&&(a=f)})}),this._resolverHash[o]=a[0]}else this._resolverHash[o]=this._buildResolvedAsset({alias:[o],src:o},{});r[o]=this._resolverHash[o]}),s?r[t[0]]:r}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let s=0;s<t.length;s++){const r=t[s],o=this._preferredOrder.find(a=>a.params.format.includes(r.format));if(o)return o}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;const s=/\?/.test(t)?"&":"?";return`${t}${s}${this._defaultSearchParams}`}_buildResolvedAsset(t,s){const{aliases:r,data:o,loadParser:a,format:h}=s;return(this._basePath||this._rootPath)&&(t.src=Ol.toAbsolute(t.src,this._basePath,this._rootPath)),t.alias=r??t.alias??[t.src],t.src=this._appendDefaultSearchParams(t.src),t.data={...o||{},...t.data},t.loadParser=a??t.loadParser,t.format=h??t.format??jP(t.src),t}}Wv.RETINA_PREFIX=/@([0-9\.]+)x/;function jP(l){return l.split(".").pop().split("?").shift().split("#").shift()}const PE=(l,t)=>{const s=t.split("?")[1];return s&&(l+=`?${s}`),l},zv=class Tl{constructor(t,s){this.linkedSheets=[];let r=t;(t==null?void 0:t.source)instanceof vt&&(r={texture:t,data:s});const{texture:o,data:a,cachePrefix:h=""}=r;this.cachePrefix=h,this._texture=o instanceof me?o:null,this.textureSource=o.source,this.textures={},this.animations={},this.data=a;const u=parseFloat(a.meta.scale);u?(this.resolution=u,o.source.resolution=this.resolution):this.resolution=o.source._resolution,this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}parse(){return new Promise(t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=Tl.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()})}_processFrames(t){let s=t;const r=Tl.BATCH_SIZE;for(;s-t<r&&s<this._frameKeys.length;){const o=this._frameKeys[s],a=this._frames[o],h=a.frame;if(h){let u=null,p=null;const f=a.trimmed!==!1&&a.sourceSize?a.sourceSize:a.frame,g=new Fe(0,0,Math.floor(f.w)/this.resolution,Math.floor(f.h)/this.resolution);a.rotated?u=new Fe(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.h)/this.resolution,Math.floor(h.w)/this.resolution):u=new Fe(Math.floor(h.x)/this.resolution,Math.floor(h.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution),a.trimmed!==!1&&a.spriteSourceSize&&(p=new Fe(Math.floor(a.spriteSourceSize.x)/this.resolution,Math.floor(a.spriteSourceSize.y)/this.resolution,Math.floor(h.w)/this.resolution,Math.floor(h.h)/this.resolution)),this.textures[o]=new me({source:this.textureSource,frame:u,orig:g,trim:p,rotate:a.rotated?2:0,defaultAnchor:a.anchor,defaultBorders:a.borders,label:o.toString()})}s++}}_processAnimations(){const t=this.data.animations||{};for(const s in t){this.animations[s]=[];for(let r=0;r<t[s].length;r++){const o=t[s][r];this.animations[s].push(this.textures[o])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*Tl.BATCH_SIZE),this._batchIndex++,setTimeout(()=>{this._batchIndex*Tl.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())},0)}destroy(t=!1){var s;for(const r in this.textures)this.textures[r].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&((s=this._texture)==null||s.destroy(),this.textureSource.destroy()),this._texture=null,this.textureSource=null,this.linkedSheets=[]}};zv.BATCH_SIZE=1e3;let NE=zv;const qP=["jpg","png","jpeg","avif","webp","basis","etc2","bc7","bc6h","bc5","bc4","bc3","bc2","bc1","eac","astc"];function Xv(l,t,s){const r={};if(l.forEach(o=>{r[o]=t}),Object.keys(t.textures).forEach(o=>{r[`${t.cachePrefix}${o}`]=t.textures[o]}),!s){const o=Ol.dirname(l[0]);t.linkedSheets.forEach((a,h)=>{const u=Xv([`${o}/${t.data.meta.related_multi_packs[h]}`],a,!0);Object.assign(r,u)})}return r}const JP={extension:V.Asset,cache:{test:l=>l instanceof NE,getCacheableAssets:(l,t)=>Xv(l,t,!1)},resolver:{extension:{type:V.ResolveParser,name:"resolveSpritesheet"},test:l=>{const s=l.split("?")[0].split("."),r=s.pop(),o=s.pop();return r==="json"&&qP.includes(o)},parse:l=>{var s;const t=l.split(".");return{resolution:parseFloat(((s=Wv.RETINA_PREFIX.exec(l))==null?void 0:s[1])??"1"),format:t[t.length-2],src:l}}},loader:{name:"spritesheetLoader",extension:{type:V.LoadParser,priority:Hv.Normal,name:"spritesheetLoader"},async testParse(l,t){return Ol.extname(t.src).toLowerCase()===".json"&&!!l.frames},async parse(l,t,s){var _,$;const{texture:r,imageFilename:o,textureOptions:a,cachePrefix:h}=(t==null?void 0:t.data)??{};let u=Ol.dirname(t.src);u&&u.lastIndexOf("/")!==u.length-1&&(u+="/");let p;if(r instanceof me)p=r;else{const E=PE(u+(o??l.meta.image),t.src);p=(await s.load([{src:E,data:a}]))[E]}const f=new NE({texture:p.source,data:l,cachePrefix:h});await f.parse();const g=(_=l==null?void 0:l.meta)==null?void 0:_.related_multi_packs;if(Array.isArray(g)){const E=[];for(const w of g){if(typeof w!="string")continue;let x=u+w;($=t.data)!=null&&$.ignoreMultiPack||(x=PE(x,t.src),E.push(s.load({src:x,data:{textureOptions:a,ignoreMultiPack:!0}})))}const v=await Promise.all(E);f.linkedSheets=v,v.forEach(w=>{w.linkedSheets=[f].concat(f.linkedSheets.filter(x=>x!==w))})}return f},async unload(l,t,s){await s.unload(l.textureSource._sourceOrigin),l.destroy(!1)}}};Se.add(JP);class Fl{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=Fl.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new ve,this.page=new ve,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return this.manager&&(!this.path||this.path[this.path.length-1]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,s,r){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,s,r,o,a){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}var uf=/iPhone/i,DE=/iPod/i,BE=/iPad/i,FE=/\biOS-universal(?:.+)Mac\b/i,df=/\bAndroid(?:.+)Mobile\b/i,UE=/Android/i,Jn=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,Lc=/Silk/i,Hi=/Windows Phone/i,GE=/\bWindows(?:.+)ARM\b/i,HE=/BlackBerry/i,VE=/BB10/i,WE=/Opera Mini/i,zE=/\b(CriOS|Chrome)(?:.+)Mobile/i,XE=/Mobile(?:.+)Firefox\b/i,YE=function(l){return typeof l<"u"&&l.platform==="MacIntel"&&typeof l.maxTouchPoints=="number"&&l.maxTouchPoints>1&&typeof MSStream>"u"};function ZP(l){return function(t){return t.test(l)}}function KE(l){var t={userAgent:"",platform:"",maxTouchPoints:0};!l&&typeof navigator<"u"?t={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0}:typeof l=="string"?t.userAgent=l:l&&l.userAgent&&(t={userAgent:l.userAgent,platform:l.platform,maxTouchPoints:l.maxTouchPoints||0});var s=t.userAgent,r=s.split("[FBAN");typeof r[1]<"u"&&(s=r[0]),r=s.split("Twitter"),typeof r[1]<"u"&&(s=r[0]);var o=ZP(s),a={apple:{phone:o(uf)&&!o(Hi),ipod:o(DE),tablet:!o(uf)&&(o(BE)||YE(t))&&!o(Hi),universal:o(FE),device:(o(uf)||o(DE)||o(BE)||o(FE)||YE(t))&&!o(Hi)},amazon:{phone:o(Jn),tablet:!o(Jn)&&o(Lc),device:o(Jn)||o(Lc)},android:{phone:!o(Hi)&&o(Jn)||!o(Hi)&&o(df),tablet:!o(Hi)&&!o(Jn)&&!o(df)&&(o(Lc)||o(UE)),device:!o(Hi)&&(o(Jn)||o(Lc)||o(df)||o(UE))||o(/\bokhttp\b/i)},windows:{phone:o(Hi),tablet:o(GE),device:o(Hi)||o(GE)},other:{blackberry:o(HE),blackberry10:o(VE),opera:o(WE),firefox:o(XE),chrome:o(zE),device:o(HE)||o(VE)||o(WE)||o(XE)||o(zE)},any:!1,phone:!1,tablet:!1};return a.any=a.apple.device||a.android.device||a.windows.device||a.other.device,a.phone=a.apple.phone||a.android.phone||a.windows.phone,a.tablet=a.apple.tablet||a.android.tablet||a.windows.tablet,a}const QP=KE.default??KE,eN=QP(globalThis.navigator),tN=9,Pc=100,sN=0,iN=0,jE=2,qE=1,rN=-1e3,nN=-1e3,oN=2,Sg=class Yv{constructor(t,s=eN){this._mobileInfo=s,this.debug=!1,this._activateOnTab=!0,this._deactivateOnMouseMove=!0,this._isActive=!1,this._isMobileAccessibility=!1,this._div=null,this._pool=[],this._renderId=0,this._children=[],this._androidUpdateCount=0,this._androidUpdateFrequency=500,this._hookDiv=null,(s.tablet||s.phone)&&this._createTouchHook(),this._renderer=t}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}get hookDiv(){return this._hookDiv}_createTouchHook(){const t=document.createElement("button");t.style.width=`${qE}px`,t.style.height=`${qE}px`,t.style.position="absolute",t.style.top=`${rN}px`,t.style.left=`${nN}px`,t.style.zIndex=oN.toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",()=>{this._isMobileAccessibility=!0,this._activate(),this._destroyTouchHook()}),document.body.appendChild(t),this._hookDiv=t}_destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}_activate(){if(this._isActive)return;this._isActive=!0,this._div||(this._div=document.createElement("div"),this._div.style.width=`${Pc}px`,this._div.style.height=`${Pc}px`,this._div.style.position="absolute",this._div.style.top=`${sN}px`,this._div.style.left=`${iN}px`,this._div.style.zIndex=jE.toString(),this._div.style.pointerEvents="none"),this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._deactivateOnMouseMove&&(this._onMouseMove=this._onMouseMove.bind(this),globalThis.document.addEventListener("mousemove",this._onMouseMove,!0));const t=this._renderer.view.canvas;if(t.parentNode)t.parentNode.appendChild(this._div),this._initAccessibilitySetup();else{const s=new MutationObserver(()=>{t.parentNode&&(t.parentNode.appendChild(this._div),s.disconnect(),this._initAccessibilitySetup())});s.observe(document.body,{childList:!0,subtree:!0})}}_initAccessibilitySetup(){this._renderer.runners.postrender.add(this),this._renderer.lastObjectRendered&&this._updateAccessibleObjects(this._renderer.lastObjectRendered)}_deactivate(){if(!(!this._isActive||this._isMobileAccessibility)){this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),this._activateOnTab&&globalThis.addEventListener("keydown",this._onKeyDown,!1),this._renderer.runners.postrender.remove(this);for(const t of this._children)t._accessibleDiv&&t._accessibleDiv.parentNode&&(t._accessibleDiv.parentNode.removeChild(t._accessibleDiv),t._accessibleDiv=null),t._accessibleActive=!1;this._pool.forEach(t=>{t.parentNode&&t.parentNode.removeChild(t)}),this._div&&this._div.parentNode&&this._div.parentNode.removeChild(this._div),this._pool=[],this._children=[]}}_updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&(t._accessibleActive||this._addChild(t),t._renderId=this._renderId);const s=t.children;if(s)for(let r=0;r<s.length;r++)this._updateAccessibleObjects(s[r])}init(t){const r={accessibilityOptions:{...Yv.defaultOptions,...(t==null?void 0:t.accessibilityOptions)||{}}};this.debug=r.accessibilityOptions.debug,this._activateOnTab=r.accessibilityOptions.activateOnTab,this._deactivateOnMouseMove=r.accessibilityOptions.deactivateOnMouseMove,r.accessibilityOptions.enabledByDefault?this._activate():this._activateOnTab&&(this._onKeyDown=this._onKeyDown.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)),this._renderer.runners.postrender.remove(this)}postrender(){const t=performance.now();if(this._mobileInfo.android.device&&t<this._androidUpdateCount||(this._androidUpdateCount=t+this._androidUpdateFrequency,!this._renderer.renderingToScreen||!this._renderer.view.canvas))return;const s=new Set;if(this._renderer.lastObjectRendered){this._updateAccessibleObjects(this._renderer.lastObjectRendered);for(const r of this._children)r._renderId===this._renderId&&s.add(this._children.indexOf(r))}for(let r=this._children.length-1;r>=0;r--){const o=this._children[r];s.has(r)||(o._accessibleDiv&&o._accessibleDiv.parentNode&&(o._accessibleDiv.parentNode.removeChild(o._accessibleDiv),this._pool.push(o._accessibleDiv),o._accessibleDiv=null),o._accessibleActive=!1,xv(this._children,r,1))}if(this._renderer.renderingToScreen){const{x:r,y:o,width:a,height:h}=this._renderer.screen,u=this._div;u.style.left=`${r}px`,u.style.top=`${o}px`,u.style.width=`${a}px`,u.style.height=`${h}px`}for(let r=0;r<this._children.length;r++){const o=this._children[r];if(!o._accessibleActive||!o._accessibleDiv)continue;const a=o._accessibleDiv,h=o.hitArea||o.getBounds().rectangle;if(o.hitArea){const u=o.worldTransform,p=this._renderer.resolution,f=this._renderer.resolution;a.style.left=`${(u.tx+h.x*u.a)*p}px`,a.style.top=`${(u.ty+h.y*u.d)*f}px`,a.style.width=`${h.width*u.a*p}px`,a.style.height=`${h.height*u.d*f}px`}else{this._capHitArea(h);const u=this._renderer.resolution,p=this._renderer.resolution;a.style.left=`${h.x*u}px`,a.style.top=`${h.y*p}px`,a.style.width=`${h.width*u}px`,a.style.height=`${h.height*p}px`}}this._renderId++}_updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}_capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:s,height:r}=this._renderer;t.x+t.width>s&&(t.width=s-t.x),t.y+t.height>r&&(t.height=r-t.y)}_addChild(t){let s=this._pool.pop();s||(t.accessibleType==="button"?s=document.createElement("button"):(s=document.createElement(t.accessibleType),s.style.cssText=`
                        color: transparent;
                        pointer-events: none;
                        padding: 0;
                        margin: 0;
                        border: 0;
                        outline: 0;
                        background: transparent;
                        box-sizing: border-box;
                        user-select: none;
                        -webkit-user-select: none;
                        -moz-user-select: none;
                        -ms-user-select: none;
                    `,t.accessibleText&&(s.innerText=t.accessibleText)),s.style.width=`${Pc}px`,s.style.height=`${Pc}px`,s.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",s.style.position="absolute",s.style.zIndex=jE.toString(),s.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?s.setAttribute("aria-live","off"):s.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?s.setAttribute("aria-relevant","additions"):s.setAttribute("aria-relevant","text"),s.addEventListener("click",this._onClick.bind(this)),s.addEventListener("focus",this._onFocus.bind(this)),s.addEventListener("focusout",this._onFocusOut.bind(this))),s.style.pointerEvents=t.accessiblePointerEvents,s.type=t.accessibleType,t.accessibleTitle&&t.accessibleTitle!==null?s.title=t.accessibleTitle:(!t.accessibleHint||t.accessibleHint===null)&&(s.title=`container ${t.tabIndex}`),t.accessibleHint&&t.accessibleHint!==null&&s.setAttribute("aria-label",t.accessibleHint),this.debug&&this._updateDebugHTML(s),t._accessibleActive=!0,t._accessibleDiv=s,s.container=t,this._children.push(t),this._div.appendChild(t._accessibleDiv),t.interactive&&(t._accessibleDiv.tabIndex=t.tabIndex)}_dispatchEvent(t,s){const{container:r}=t.target,o=this._renderer.events.rootBoundary,a=Object.assign(new Fl(o),{target:r});o.rootTarget=this._renderer.lastObjectRendered,s.forEach(h=>o.dispatchEvent(a,h))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){t.keyCode!==tN||!this._activateOnTab||this._activate()}_onMouseMove(t){t.movementX===0&&t.movementY===0||this._deactivate()}destroy(){this._deactivate(),this._destroyTouchHook(),this._div=null,this._pool=null,this._children=null,this._renderer=null,this._activateOnTab&&globalThis.removeEventListener("keydown",this._onKeyDown)}setAccessibilityEnabled(t){t?this._activate():this._deactivate()}};Sg.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"accessibility"};Sg.defaultOptions={enabledByDefault:!1,debug:!1,activateOnTab:!0,deactivateOnMouseMove:!0};let lN=Sg;const aN={accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,accessibleType:"button",accessibleText:null,accessiblePointerEvents:"auto",accessibleChildren:!0,_accessibleActive:!1,_accessibleDiv:null,_renderId:-1},pf=Object.create(null),JE=Object.create(null);function Al(l,t){let s=JE[l];return s===void 0&&(pf[t]===void 0&&(pf[t]=1),JE[l]=s=pf[t]++),s}let Zn;function Kv(){return(!Zn||Zn!=null&&Zn.isContextLost())&&(Zn=it.get().createCanvas().getContext("webgl",{})),Zn}let Nc;function cN(){if(!Nc){Nc="mediump";const l=Kv();l&&l.getShaderPrecisionFormat&&(Nc=l.getShaderPrecisionFormat(l.FRAGMENT_SHADER,l.HIGH_FLOAT).precision?"highp":"mediump")}return Nc}function hN(l,t,s){return t?l:s?(l=l.replace("out vec4 finalColor;",""),`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in varying
        #define finalColor gl_FragColor
        #define texture texture2D
        #endif
        ${l}
        `):`

        #ifdef GL_ES // This checks if it is WebGL1
        #define in attribute
        #define out varying
        #endif
        ${l}
        `}function uN(l,t,s){const r=s?t.maxSupportedFragmentPrecision:t.maxSupportedVertexPrecision;if(l.substring(0,9)!=="precision"){let o=s?t.requestedFragmentPrecision:t.requestedVertexPrecision;return o==="highp"&&r!=="highp"&&(o="mediump"),`precision ${o} float;
${l}`}else if(r!=="highp"&&l.substring(0,15)==="precision highp")return l.replace("precision highp","precision mediump");return l}function dN(l,t){return t?`#version 300 es
${l}`:l}const pN={},fN={};function gN(l,{name:t="pixi-program"},s=!0){t=t.replace(/\s+/g,"-"),t+=s?"-fragment":"-vertex";const r=s?pN:fN;return r[t]?(r[t]++,t+=`-${r[t]}`):r[t]=1,l.indexOf("#define SHADER_NAME")!==-1?l:`${`#define SHADER_NAME ${t}`}
${l}`}function mN(l,t){return t?l.replace("#version 300 es",""):l}const ff={stripVersion:mN,ensurePrecision:uN,addProgramDefines:hN,setProgramName:gN,insertVersion:dN},gf=Object.create(null),jv=class Yf{constructor(t){t={...Yf.defaultOptions,...t};const s=t.fragment.indexOf("#version 300 es")!==-1,r={stripVersion:s,ensurePrecision:{requestedFragmentPrecision:t.preferredFragmentPrecision,requestedVertexPrecision:t.preferredVertexPrecision,maxSupportedVertexPrecision:"highp",maxSupportedFragmentPrecision:cN()},setProgramName:{name:t.name},addProgramDefines:s,insertVersion:s};let o=t.fragment,a=t.vertex;Object.keys(ff).forEach(h=>{const u=r[h];o=ff[h](o,u,!0),a=ff[h](a,u,!1)}),this.fragment=o,this.vertex=a,this.transformFeedbackVaryings=t.transformFeedbackVaryings,this._key=Al(`${this.vertex}:${this.fragment}`,"gl-program")}destroy(){this.fragment=null,this.vertex=null,this._attributeData=null,this._uniformData=null,this._uniformBlockData=null,this.transformFeedbackVaryings=null}static from(t){const s=`${t.vertex}:${t.fragment}`;return gf[s]||(gf[s]=new Yf(t)),gf[s]}};jv.defaultOptions={preferredVertexPrecision:"highp",preferredFragmentPrecision:"mediump"};let ho=jv;const ZE={uint8x2:{size:2,stride:2,normalised:!1},uint8x4:{size:4,stride:4,normalised:!1},sint8x2:{size:2,stride:2,normalised:!1},sint8x4:{size:4,stride:4,normalised:!1},unorm8x2:{size:2,stride:2,normalised:!0},unorm8x4:{size:4,stride:4,normalised:!0},snorm8x2:{size:2,stride:2,normalised:!0},snorm8x4:{size:4,stride:4,normalised:!0},uint16x2:{size:2,stride:4,normalised:!1},uint16x4:{size:4,stride:8,normalised:!1},sint16x2:{size:2,stride:4,normalised:!1},sint16x4:{size:4,stride:8,normalised:!1},unorm16x2:{size:2,stride:4,normalised:!0},unorm16x4:{size:4,stride:8,normalised:!0},snorm16x2:{size:2,stride:4,normalised:!0},snorm16x4:{size:4,stride:8,normalised:!0},float16x2:{size:2,stride:4,normalised:!1},float16x4:{size:4,stride:8,normalised:!1},float32:{size:1,stride:4,normalised:!1},float32x2:{size:2,stride:8,normalised:!1},float32x3:{size:3,stride:12,normalised:!1},float32x4:{size:4,stride:16,normalised:!1},uint32:{size:1,stride:4,normalised:!1},uint32x2:{size:2,stride:8,normalised:!1},uint32x3:{size:3,stride:12,normalised:!1},uint32x4:{size:4,stride:16,normalised:!1},sint32:{size:1,stride:4,normalised:!1},sint32x2:{size:2,stride:8,normalised:!1},sint32x3:{size:3,stride:12,normalised:!1},sint32x4:{size:4,stride:16,normalised:!1}};function $r(l){return ZE[l]??ZE.float32}const _N={f32:"float32","vec2<f32>":"float32x2","vec3<f32>":"float32x3","vec4<f32>":"float32x4",vec2f:"float32x2",vec3f:"float32x3",vec4f:"float32x4",i32:"sint32","vec2<i32>":"sint32x2","vec3<i32>":"sint32x3","vec4<i32>":"sint32x4",u32:"uint32","vec2<u32>":"uint32x2","vec3<u32>":"uint32x3","vec4<u32>":"uint32x4",bool:"uint32","vec2<bool>":"uint32x2","vec3<bool>":"uint32x3","vec4<bool>":"uint32x4"};function $N({source:l,entryPoint:t}){const s={},r=l.indexOf(`fn ${t}`);if(r!==-1){const o=l.indexOf("->",r);if(o!==-1){const a=l.substring(r,o),h=/@location\((\d+)\)\s+([a-zA-Z0-9_]+)\s*:\s*([a-zA-Z0-9_<>]+)(?:,|\s|$)/g;let u;for(;(u=h.exec(a))!==null;){const p=_N[u[3]]??"float32";s[u[2]]={location:parseInt(u[1],10),format:p,stride:$r(p).stride,offset:0,instance:!1,start:0}}}}return s}function mf(l){var _,$;const t=/(^|[^/])@(group|binding)\(\d+\)[^;]+;/g,s=/@group\((\d+)\)/,r=/@binding\((\d+)\)/,o=/var(<[^>]+>)? (\w+)/,a=/:\s*(\w+)/,h=/struct\s+(\w+)\s*{([^}]+)}/g,u=/(\w+)\s*:\s*([\w\<\>]+)/g,p=/struct\s+(\w+)/,f=(_=l.match(t))==null?void 0:_.map(E=>({group:parseInt(E.match(s)[1],10),binding:parseInt(E.match(r)[1],10),name:E.match(o)[2],isUniform:E.match(o)[1]==="<uniform>",type:E.match(a)[1]}));if(!f)return{groups:[],structs:[]};const g=(($=l.match(h))==null?void 0:$.map(E=>{const v=E.match(p)[1],w=E.match(u).reduce((x,C)=>{const[R,A]=C.split(":");return x[R.trim()]=A.trim(),x},{});return w?{name:v,members:w}:null}).filter(({name:E})=>f.some(v=>v.type===E)))??[];return{groups:f,structs:g}}var bl=(l=>(l[l.VERTEX=1]="VERTEX",l[l.FRAGMENT=2]="FRAGMENT",l[l.COMPUTE=4]="COMPUTE",l))(bl||{});function TN({groups:l}){const t=[];for(let s=0;s<l.length;s++){const r=l[s];t[r.group]||(t[r.group]=[]),r.isUniform?t[r.group].push({binding:r.binding,visibility:bl.VERTEX|bl.FRAGMENT,buffer:{type:"uniform"}}):r.type==="sampler"?t[r.group].push({binding:r.binding,visibility:bl.FRAGMENT,sampler:{type:"filtering"}}):r.type==="texture_2d"&&t[r.group].push({binding:r.binding,visibility:bl.FRAGMENT,texture:{sampleType:"float",viewDimension:"2d",multisampled:!1}})}return t}function bN({groups:l}){const t=[];for(let s=0;s<l.length;s++){const r=l[s];t[r.group]||(t[r.group]={}),t[r.group][r.name]=r.binding}return t}function EN(l,t){const s=new Set,r=new Set,o=[...l.structs,...t.structs].filter(h=>s.has(h.name)?!1:(s.add(h.name),!0)),a=[...l.groups,...t.groups].filter(h=>{const u=`${h.name}-${h.binding}`;return r.has(u)?!1:(r.add(u),!0)});return{structs:o,groups:a}}const _f=Object.create(null);class hn{constructor(t){var u,p;this._layoutKey=0,this._attributeLocationsKey=0;const{fragment:s,vertex:r,layout:o,gpuLayout:a,name:h}=t;if(this.name=h,this.fragment=s,this.vertex=r,s.source===r.source){const f=mf(s.source);this.structsAndGroups=f}else{const f=mf(r.source),g=mf(s.source);this.structsAndGroups=EN(f,g)}this.layout=o??bN(this.structsAndGroups),this.gpuLayout=a??TN(this.structsAndGroups),this.autoAssignGlobalUniforms=((u=this.layout[0])==null?void 0:u.globalUniforms)!==void 0,this.autoAssignLocalUniforms=((p=this.layout[1])==null?void 0:p.localUniforms)!==void 0,this._generateProgramKey()}_generateProgramKey(){const{vertex:t,fragment:s}=this,r=t.source+s.source+t.entryPoint+s.entryPoint;this._layoutKey=Al(r,"program")}get attributeData(){return this._attributeData??(this._attributeData=$N(this.vertex)),this._attributeData}destroy(){this.gpuLayout=null,this.layout=null,this.structsAndGroups=null,this.fragment=null,this.vertex=null}static from(t){const s=`${t.vertex.source}:${t.fragment.source}:${t.fragment.entryPoint}:${t.vertex.entryPoint}`;return _f[s]||(_f[s]=new hn(t)),_f[s]}}const qv=["f32","i32","vec2<f32>","vec3<f32>","vec4<f32>","mat2x2<f32>","mat3x3<f32>","mat4x4<f32>","mat3x2<f32>","mat4x2<f32>","mat2x3<f32>","mat4x3<f32>","mat2x4<f32>","mat3x4<f32>","vec2<i32>","vec3<i32>","vec4<i32>"],yN=qv.reduce((l,t)=>(l[t]=!0,l),{});function vN(l,t){switch(l){case"f32":return 0;case"vec2<f32>":return new Float32Array(2*t);case"vec3<f32>":return new Float32Array(3*t);case"vec4<f32>":return new Float32Array(4*t);case"mat2x2<f32>":return new Float32Array([1,0,0,1]);case"mat3x3<f32>":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4x4<f32>":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const Jv=class Zv{constructor(t,s){this._touched=0,this.uid=st("uniform"),this._resourceType="uniformGroup",this._resourceId=st("resource"),this.isUniformGroup=!0,this._dirtyId=0,this.destroyed=!1,s={...Zv.defaultOptions,...s},this.uniformStructures=t;const r={};for(const o in t){const a=t[o];if(a.name=o,a.size=a.size??1,!yN[a.type])throw new Error(`Uniform type ${a.type} is not supported. Supported uniform types are: ${qv.join(", ")}`);a.value??(a.value=vN(a.type,a.size)),r[o]=a.value}this.uniforms=r,this._dirtyId=1,this.ubo=s.ubo,this.isStatic=s.isStatic,this._signature=Al(Object.keys(r).map(o=>`${o}-${t[o].type}`).join("-"),"uniform-group")}update(){this._dirtyId++}};Jv.defaultOptions={ubo:!1,isStatic:!1};let ns=Jv;class Ki{constructor(t){this.resources=Object.create(null),this._dirty=!0;let s=0;for(const r in t){const o=t[r];this.setResource(o,s++)}this._updateKey()}_updateKey(){if(!this._dirty)return;this._dirty=!1;const t=[];let s=0;for(const r in this.resources)t[s++]=this.resources[r]._resourceId;this._key=t.join("|")}setResource(t,s){var o,a;const r=this.resources[s];t!==r&&(r&&((o=t.off)==null||o.call(t,"change",this.onResourceChange,this)),(a=t.on)==null||a.call(t,"change",this.onResourceChange,this),this.resources[s]=t,this._dirty=!0)}getResource(t){return this.resources[t]}_touch(t){const s=this.resources;for(const r in s)s[r]._touched=t}destroy(){var s;const t=this.resources;for(const r in t){const o=t[r];(s=o.off)==null||s.call(o,"change",this.onResourceChange,this)}this.resources=null}onResourceChange(t){if(this._dirty=!0,t.destroyed){const s=this.resources;for(const r in s)s[r]===t&&(s[r]=null)}else this._updateKey()}}var ei=(l=>(l[l.WEBGL=1]="WEBGL",l[l.WEBGPU=2]="WEBGPU",l[l.BOTH=3]="BOTH",l))(ei||{});class Ds extends Is{constructor(t){super(),this.uid=st("shader"),this._uniformBindMap=Object.create(null),this._ownedBindGroups=[];let{gpuProgram:s,glProgram:r,groups:o,resources:a,compatibleRenderers:h,groupMap:u}=t;this.gpuProgram=s,this.glProgram=r,h===void 0&&(h=0,s&&(h|=ei.WEBGPU),r&&(h|=ei.WEBGL)),this.compatibleRenderers=h;const p={};if(!a&&!o&&(a={}),a&&o)throw new Error("[Shader] Cannot have both resources and groups");if(!s&&o&&!u)throw new Error("[Shader] No group map or WebGPU shader provided - consider using resources instead.");if(!s&&o&&u)for(const f in u)for(const g in u[f]){const _=u[f][g];p[_]={group:f,binding:g,name:_}}else if(s&&o&&!u){const f=s.structsAndGroups.groups;u={},f.forEach(g=>{u[g.group]=u[g.group]||{},u[g.group][g.binding]=g.name,p[g.name]=g})}else if(a){o={},u={},s&&s.structsAndGroups.groups.forEach(_=>{u[_.group]=u[_.group]||{},u[_.group][_.binding]=_.name,p[_.name]=_});let f=0;for(const g in a)p[g]||(o[99]||(o[99]=new Ki,this._ownedBindGroups.push(o[99])),p[g]={group:99,binding:f,name:g},u[99]=u[99]||{},u[99][f]=g,f++);for(const g in a){const _=g;let $=a[g];!$.source&&!$._resourceType&&($=new ns($));const E=p[_];E&&(o[E.group]||(o[E.group]=new Ki,this._ownedBindGroups.push(o[E.group])),o[E.group].setResource($,E.binding))}}this.groups=o,this._uniformBindMap=u,this.resources=this._buildResourceAccessor(o,p)}addResource(t,s,r){var o,a;(o=this._uniformBindMap)[s]||(o[s]={}),(a=this._uniformBindMap[s])[r]||(a[r]=t),this.groups[s]||(this.groups[s]=new Ki,this._ownedBindGroups.push(this.groups[s]))}_buildResourceAccessor(t,s){const r={};for(const o in s){const a=s[o];Object.defineProperty(r,a.name,{get(){return t[a.group].getResource(a.binding)},set(h){t[a.group].setResource(h,a.binding)}})}return r}destroy(t=!1){var s,r;this.emit("destroy",this),t&&((s=this.gpuProgram)==null||s.destroy(),(r=this.glProgram)==null||r.destroy()),this.gpuProgram=null,this.glProgram=null,this.removeAllListeners(),this._uniformBindMap=null,this._ownedBindGroups.forEach(o=>{o.destroy()}),this._ownedBindGroups=null,this.resources=null,this.groups=null}static from(t){const{gpu:s,gl:r,...o}=t;let a,h;return s&&(a=hn.from(s)),r&&(h=ho.from(r)),new Ds({gpuProgram:a,glProgram:h,...o})}}const SN={normal:0,add:1,multiply:2,screen:3,overlay:4,erase:5,"normal-npm":6,"add-npm":7,"screen-npm":8,min:9,max:10},$f=0,Tf=1,bf=2,Ef=3,yf=4,vf=5,Kf=class Qv{constructor(){this.data=0,this.blendMode="normal",this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(this.data&1<<$f)}set blend(t){!!(this.data&1<<$f)!==t&&(this.data^=1<<$f)}get offsets(){return!!(this.data&1<<Tf)}set offsets(t){!!(this.data&1<<Tf)!==t&&(this.data^=1<<Tf)}set cullMode(t){if(t==="none"){this.culling=!1;return}this.culling=!0,this.clockwiseFrontFace=t==="front"}get cullMode(){return this.culling?this.clockwiseFrontFace?"front":"back":"none"}get culling(){return!!(this.data&1<<bf)}set culling(t){!!(this.data&1<<bf)!==t&&(this.data^=1<<bf)}get depthTest(){return!!(this.data&1<<Ef)}set depthTest(t){!!(this.data&1<<Ef)!==t&&(this.data^=1<<Ef)}get depthMask(){return!!(this.data&1<<vf)}set depthMask(t){!!(this.data&1<<vf)!==t&&(this.data^=1<<vf)}get clockwiseFrontFace(){return!!(this.data&1<<yf)}set clockwiseFrontFace(t){!!(this.data&1<<yf)!==t&&(this.data^=1<<yf)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!=="none",this._blendMode=t,this._blendModeId=SN[t]||0}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[pixi.js/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new Qv;return t.depthTest=!1,t.blend=!0,t}};Kf.default2d=Kf.for2d();let ti=Kf;const eS=class jf extends Ds{constructor(t){t={...jf.defaultOptions,...t},super(t),this.enabled=!0,this._state=ti.for2d(),this.blendMode=t.blendMode,this.padding=t.padding,typeof t.antialias=="boolean"?this.antialias=t.antialias?"on":"off":this.antialias=t.antialias,this.resolution=t.resolution,this.blendRequired=t.blendRequired,this.clipToViewport=t.clipToViewport,this.addResource("uTexture",0,1)}apply(t,s,r,o){t.applyFilter(this,s,r,o)}get blendMode(){return this._state.blendMode}set blendMode(t){this._state.blendMode=t}static from(t){const{gpu:s,gl:r,...o}=t;let a,h;return s&&(a=hn.from(s)),r&&(h=ho.from(r)),new jf({gpuProgram:a,glProgram:h,...o})}};eS.defaultOptions={blendMode:"normal",resolution:1,padding:0,antialias:"off",blendRequired:!1,clipToViewport:!0};let IN=eS;const qf=[];Se.handleByNamedList(V.Environment,qf);async function xN(l){if(!l)for(let t=0;t<qf.length;t++){const s=qf[t];if(s.value.test()){await s.value.load();return}}}let hl;function tS(){if(typeof hl=="boolean")return hl;try{hl=new Function("param1","param2","param3","return param1[param2] === param3;")({a:"b"},"a","b")===!0}catch{hl=!1}return hl}function QE(l,t,s=2){const r=t&&t.length,o=r?t[0]*s:l.length;let a=sS(l,0,o,s,!0);const h=[];if(!a||a.next===a.prev)return h;let u,p,f;if(r&&(a=ON(l,t,a,s)),l.length>80*s){u=l[0],p=l[1];let g=u,_=p;for(let $=s;$<o;$+=s){const E=l[$],v=l[$+1];E<u&&(u=E),v<p&&(p=v),E>g&&(g=E),v>_&&(_=v)}f=Math.max(g-u,_-p),f=f!==0?32767/f:0}return Ml(a,h,s,u,p,f,0),h}function sS(l,t,s,r,o){let a;if(o===HN(l,t,s,r)>0)for(let h=t;h<s;h+=r)a=ey(h/r|0,l[h],l[h+1],a);else for(let h=s-r;h>=t;h-=r)a=ey(h/r|0,l[h],l[h+1],a);return a&&oo(a,a.next)&&(Pl(a),a=a.next),a}function an(l,t){if(!l)return l;t||(t=l);let s=l,r;do if(r=!1,!s.steiner&&(oo(s,s.next)||ot(s.prev,s,s.next)===0)){if(Pl(s),s=t=s.prev,s===s.next)break;r=!0}else s=s.next;while(r||s!==t);return t}function Ml(l,t,s,r,o,a,h){if(!l)return;!h&&a&&NN(l,r,o,a);let u=l;for(;l.prev!==l.next;){const p=l.prev,f=l.next;if(a?wN(l,r,o,a):CN(l)){t.push(p.i,l.i,f.i),Pl(l),l=f.next,u=f.next;continue}if(l=f,l===u){h?h===1?(l=RN(an(l),t),Ml(l,t,s,r,o,a,2)):h===2&&kN(l,t,s,r,o,a):Ml(an(l),t,s,r,o,a,1);break}}}function CN(l){const t=l.prev,s=l,r=l.next;if(ot(t,s,r)>=0)return!1;const o=t.x,a=s.x,h=r.x,u=t.y,p=s.y,f=r.y,g=Math.min(o,a,h),_=Math.min(u,p,f),$=Math.max(o,a,h),E=Math.max(u,p,f);let v=r.next;for(;v!==t;){if(v.x>=g&&v.x<=$&&v.y>=_&&v.y<=E&&El(o,u,a,p,h,f,v.x,v.y)&&ot(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function wN(l,t,s,r){const o=l.prev,a=l,h=l.next;if(ot(o,a,h)>=0)return!1;const u=o.x,p=a.x,f=h.x,g=o.y,_=a.y,$=h.y,E=Math.min(u,p,f),v=Math.min(g,_,$),w=Math.max(u,p,f),x=Math.max(g,_,$),C=Jf(E,v,t,s,r),R=Jf(w,x,t,s,r);let A=l.prevZ,D=l.nextZ;for(;A&&A.z>=C&&D&&D.z<=R;){if(A.x>=E&&A.x<=w&&A.y>=v&&A.y<=x&&A!==o&&A!==h&&El(u,g,p,_,f,$,A.x,A.y)&&ot(A.prev,A,A.next)>=0||(A=A.prevZ,D.x>=E&&D.x<=w&&D.y>=v&&D.y<=x&&D!==o&&D!==h&&El(u,g,p,_,f,$,D.x,D.y)&&ot(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;A&&A.z>=C;){if(A.x>=E&&A.x<=w&&A.y>=v&&A.y<=x&&A!==o&&A!==h&&El(u,g,p,_,f,$,A.x,A.y)&&ot(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;D&&D.z<=R;){if(D.x>=E&&D.x<=w&&D.y>=v&&D.y<=x&&D!==o&&D!==h&&El(u,g,p,_,f,$,D.x,D.y)&&ot(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function RN(l,t){let s=l;do{const r=s.prev,o=s.next.next;!oo(r,o)&&rS(r,s,s.next,o)&&Ll(r,o)&&Ll(o,r)&&(t.push(r.i,s.i,o.i),Pl(s),Pl(s.next),s=l=o),s=s.next}while(s!==l);return an(s)}function kN(l,t,s,r,o,a){let h=l;do{let u=h.next.next;for(;u!==h.prev;){if(h.i!==u.i&&FN(h,u)){let p=nS(h,u);h=an(h,h.next),p=an(p,p.next),Ml(h,t,s,r,o,a,0),Ml(p,t,s,r,o,a,0);return}u=u.next}h=h.next}while(h!==l)}function ON(l,t,s,r){const o=[];for(let a=0,h=t.length;a<h;a++){const u=t[a]*r,p=a<h-1?t[a+1]*r:l.length,f=sS(l,u,p,r,!1);f===f.next&&(f.steiner=!0),o.push(BN(f))}o.sort(AN);for(let a=0;a<o.length;a++)s=MN(o[a],s);return s}function AN(l,t){let s=l.x-t.x;if(s===0&&(s=l.y-t.y,s===0)){const r=(l.next.y-l.y)/(l.next.x-l.x),o=(t.next.y-t.y)/(t.next.x-t.x);s=r-o}return s}function MN(l,t){const s=LN(l,t);if(!s)return t;const r=nS(s,l);return an(r,r.next),an(s,s.next)}function LN(l,t){let s=t;const r=l.x,o=l.y;let a=-1/0,h;if(oo(l,s))return s;do{if(oo(l,s.next))return s.next;if(o<=s.y&&o>=s.next.y&&s.next.y!==s.y){const _=s.x+(o-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(_<=r&&_>a&&(a=_,h=s.x<s.next.x?s:s.next,_===r))return h}s=s.next}while(s!==t);if(!h)return null;const u=h,p=h.x,f=h.y;let g=1/0;s=h;do{if(r>=s.x&&s.x>=p&&r!==s.x&&iS(o<f?r:a,o,p,f,o<f?a:r,o,s.x,s.y)){const _=Math.abs(o-s.y)/(r-s.x);Ll(s,l)&&(_<g||_===g&&(s.x>h.x||s.x===h.x&&PN(h,s)))&&(h=s,g=_)}s=s.next}while(s!==u);return h}function PN(l,t){return ot(l.prev,l,t.prev)<0&&ot(t.next,l,l.next)<0}function NN(l,t,s,r){let o=l;do o.z===0&&(o.z=Jf(o.x,o.y,t,s,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next;while(o!==l);o.prevZ.nextZ=null,o.prevZ=null,DN(o)}function DN(l){let t,s=1;do{let r=l,o;l=null;let a=null;for(t=0;r;){t++;let h=r,u=0;for(let f=0;f<s&&(u++,h=h.nextZ,!!h);f++);let p=s;for(;u>0||p>0&&h;)u!==0&&(p===0||!h||r.z<=h.z)?(o=r,r=r.nextZ,u--):(o=h,h=h.nextZ,p--),a?a.nextZ=o:l=o,o.prevZ=a,a=o;r=h}a.nextZ=null,s*=2}while(t>1);return l}function Jf(l,t,s,r,o){return l=(l-s)*o|0,t=(t-r)*o|0,l=(l|l<<8)&16711935,l=(l|l<<4)&252645135,l=(l|l<<2)&858993459,l=(l|l<<1)&1431655765,t=(t|t<<8)&16711935,t=(t|t<<4)&252645135,t=(t|t<<2)&858993459,t=(t|t<<1)&1431655765,l|t<<1}function BN(l){let t=l,s=l;do(t.x<s.x||t.x===s.x&&t.y<s.y)&&(s=t),t=t.next;while(t!==l);return s}function iS(l,t,s,r,o,a,h,u){return(o-h)*(t-u)>=(l-h)*(a-u)&&(l-h)*(r-u)>=(s-h)*(t-u)&&(s-h)*(a-u)>=(o-h)*(r-u)}function El(l,t,s,r,o,a,h,u){return!(l===h&&t===u)&&iS(l,t,s,r,o,a,h,u)}function FN(l,t){return l.next.i!==t.i&&l.prev.i!==t.i&&!UN(l,t)&&(Ll(l,t)&&Ll(t,l)&&GN(l,t)&&(ot(l.prev,l,t.prev)||ot(l,t.prev,t))||oo(l,t)&&ot(l.prev,l,l.next)>0&&ot(t.prev,t,t.next)>0)}function ot(l,t,s){return(t.y-l.y)*(s.x-t.x)-(t.x-l.x)*(s.y-t.y)}function oo(l,t){return l.x===t.x&&l.y===t.y}function rS(l,t,s,r){const o=Bc(ot(l,t,s)),a=Bc(ot(l,t,r)),h=Bc(ot(s,r,l)),u=Bc(ot(s,r,t));return!!(o!==a&&h!==u||o===0&&Dc(l,s,t)||a===0&&Dc(l,r,t)||h===0&&Dc(s,l,r)||u===0&&Dc(s,t,r))}function Dc(l,t,s){return t.x<=Math.max(l.x,s.x)&&t.x>=Math.min(l.x,s.x)&&t.y<=Math.max(l.y,s.y)&&t.y>=Math.min(l.y,s.y)}function Bc(l){return l>0?1:l<0?-1:0}function UN(l,t){let s=l;do{if(s.i!==l.i&&s.next.i!==l.i&&s.i!==t.i&&s.next.i!==t.i&&rS(s,s.next,l,t))return!0;s=s.next}while(s!==l);return!1}function Ll(l,t){return ot(l.prev,l,l.next)<0?ot(l,t,l.next)>=0&&ot(l,l.prev,t)>=0:ot(l,t,l.prev)<0||ot(l,l.next,t)<0}function GN(l,t){let s=l,r=!1;const o=(l.x+t.x)/2,a=(l.y+t.y)/2;do s.y>a!=s.next.y>a&&s.next.y!==s.y&&o<(s.next.x-s.x)*(a-s.y)/(s.next.y-s.y)+s.x&&(r=!r),s=s.next;while(s!==l);return r}function nS(l,t){const s=Zf(l.i,l.x,l.y),r=Zf(t.i,t.x,t.y),o=l.next,a=t.prev;return l.next=t,t.prev=l,s.next=o,o.prev=s,r.next=s,s.prev=r,a.next=r,r.prev=a,r}function ey(l,t,s,r){const o=Zf(l,t,s);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function Pl(l){l.next.prev=l.prev,l.prev.next=l.next,l.prevZ&&(l.prevZ.nextZ=l.nextZ),l.nextZ&&(l.nextZ.prevZ=l.prevZ)}function Zf(l,t,s){return{i:l,x:t,y:s,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function HN(l,t,s,r){let o=0;for(let a=t,h=s-r;a<s;a+=r)o+=(l[h]-l[a])*(l[a+1]+l[h+1]),h=a;return o}const VN=QE.default||QE;var vs=(l=>(l[l.NONE=0]="NONE",l[l.COLOR=16384]="COLOR",l[l.STENCIL=1024]="STENCIL",l[l.DEPTH=256]="DEPTH",l[l.COLOR_DEPTH=16640]="COLOR_DEPTH",l[l.COLOR_STENCIL=17408]="COLOR_STENCIL",l[l.DEPTH_STENCIL=1280]="DEPTH_STENCIL",l[l.ALL=17664]="ALL",l))(vs||{});class oS{constructor(t){this.items=[],this._name=t}emit(t,s,r,o,a,h,u,p){const{name:f,items:g}=this;for(let _=0,$=g.length;_<$;_++)g[_][f](t,s,r,o,a,h,u,p);return this}add(t){return t[this._name]&&(this.remove(t),this.items.push(t)),this}remove(t){const s=this.items.indexOf(t);return s!==-1&&this.items.splice(s,1),this}contains(t){return this.items.indexOf(t)!==-1}removeAll(){return this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return this.items.length===0}get name(){return this._name}}const WN=["init","destroy","contextChange","resolutionChange","resetState","renderEnd","renderStart","render","update","postrender","prerender"],lS=class aS extends Is{constructor(t){super(),this.uid=st("renderer"),this.runners=Object.create(null),this.renderPipes=Object.create(null),this._initOptions={},this._systemsHash=Object.create(null),this.type=t.type,this.name=t.name,this.config=t;const s=[...WN,...this.config.runners??[]];this._addRunners(...s),this._unsafeEvalCheck()}async init(t={}){const s=t.skipExtensionImports===!0?!0:t.manageImports===!1;await xN(s),this._addSystems(this.config.systems),this._addPipes(this.config.renderPipes,this.config.renderPipeAdaptors);for(const r in this._systemsHash)t={...this._systemsHash[r].constructor.defaultOptions,...t};t={...aS.defaultOptions,...t},this._roundPixels=t.roundPixels?1:0;for(let r=0;r<this.runners.init.items.length;r++)await this.runners.init.items[r].init(t);this._initOptions=t}render(t,s){let r=t;if(r instanceof Nt&&(r={container:r},s&&(ke(He,"passing a second argument is deprecated, please use render options instead"),r.target=s.renderTexture)),r.target||(r.target=this.view.renderTarget),r.target===this.view.renderTarget&&(this._lastObjectRendered=r.container,r.clearColor??(r.clearColor=this.background.colorRgba),r.clear??(r.clear=this.background.clearBeforeRender)),r.clearColor){const o=Array.isArray(r.clearColor)&&r.clearColor.length===4;r.clearColor=o?r.clearColor:We.shared.setValue(r.clearColor).toArray()}r.transform||(r.container.updateLocalTransform(),r.transform=r.container.localTransform),r.container.enableRenderGroup(),this.runners.prerender.emit(r),this.runners.renderStart.emit(r),this.runners.render.emit(r),this.runners.renderEnd.emit(r),this.runners.postrender.emit(r)}resize(t,s,r){const o=this.view.resolution;this.view.resize(t,s,r),this.emit("resize",this.view.screen.width,this.view.screen.height,this.view.resolution),r!==void 0&&r!==o&&this.runners.resolutionChange.emit(r)}clear(t={}){const s=this;t.target||(t.target=s.renderTarget.renderTarget),t.clearColor||(t.clearColor=this.background.colorRgba),t.clear??(t.clear=vs.ALL);const{clear:r,clearColor:o,target:a}=t;We.shared.setValue(o??this.background.colorRgba),s.renderTarget.clear(a,r,We.shared.toArray())}get resolution(){return this.view.resolution}set resolution(t){this.view.resolution=t,this.runners.resolutionChange.emit(t)}get width(){return this.view.texture.frame.width}get height(){return this.view.texture.frame.height}get canvas(){return this.view.canvas}get lastObjectRendered(){return this._lastObjectRendered}get renderingToScreen(){return this.renderTarget.renderingToScreen}get screen(){return this.view.screen}_addRunners(...t){t.forEach(s=>{this.runners[s]=new oS(s)})}_addSystems(t){let s;for(s in t){const r=t[s];this._addSystem(r.value,r.name)}}_addSystem(t,s){const r=new t(this);if(this[s])throw new Error(`Whoops! The name "${s}" is already in use`);this[s]=r,this._systemsHash[s]=r;for(const o in this.runners)this.runners[o].add(r);return this}_addPipes(t,s){const r=s.reduce((o,a)=>(o[a.name]=a.value,o),{});t.forEach(o=>{const a=o.value,h=o.name,u=r[h];this.renderPipes[h]=new a(this,u?new u:null)})}destroy(t=!1){this.runners.destroy.items.reverse(),this.runners.destroy.emit(t),Object.values(this.runners).forEach(s=>{s.destroy()}),this._systemsHash=null,this.renderPipes=null}generateTexture(t){return this.textureGenerator.generateTexture(t)}get roundPixels(){return!!this._roundPixels}_unsafeEvalCheck(){if(!tS())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}resetState(){this.runners.resetState.emit()}};lS.defaultOptions={resolution:1,failIfMajorPerformanceCaveat:!1,roundPixels:!1};let fh=lS,Fc;function zN(l){return Fc!==void 0||(Fc=(()=>{var s;const t={stencil:!0,failIfMajorPerformanceCaveat:l??fh.defaultOptions.failIfMajorPerformanceCaveat};try{if(!it.get().getWebGLRenderingContext())return!1;let o=it.get().createCanvas().getContext("webgl",t);const a=!!((s=o==null?void 0:o.getContextAttributes())!=null&&s.stencil);if(o){const h=o.getExtension("WEBGL_lose_context");h&&h.loseContext()}return o=null,a}catch{return!1}})()),Fc}let Uc;async function XN(l={}){return Uc!==void 0||(Uc=await(async()=>{const t=it.get().getNavigator().gpu;if(!t)return!1;try{return await(await t.requestAdapter(l)).requestDevice(),!0}catch{return!1}})()),Uc}const ty=["webgl","webgpu","canvas"];async function YN(l){let t=[];l.preference?(t.push(l.preference),ty.forEach(a=>{a!==l.preference&&t.push(a)})):t=ty.slice();let s,r={};for(let a=0;a<t.length;a++){const h=t[a];if(h==="webgpu"&&await XN()){const{WebGPURenderer:u}=await th(async()=>{const{WebGPURenderer:p}=await Promise.resolve().then(()=>YF);return{WebGPURenderer:p}},void 0,import.meta.url);s=u,r={...l,...l.webgpu};break}else if(h==="webgl"&&zN(l.failIfMajorPerformanceCaveat??fh.defaultOptions.failIfMajorPerformanceCaveat)){const{WebGLRenderer:u}=await th(async()=>{const{WebGLRenderer:p}=await Promise.resolve().then(()=>wF);return{WebGLRenderer:p}},void 0,import.meta.url);s=u,r={...l,...l.webgl};break}else if(h==="canvas")throw r={...l},new Error("CanvasRenderer is not yet implemented")}if(delete r.webgpu,delete r.webgl,!s)throw new Error("No available renderer for the current environment");const o=new s;return await o.init(r),o}const nh="8.11.0";class cS{static init(){var t;(t=globalThis.__PIXI_APP_INIT__)==null||t.call(globalThis,this,nh)}static destroy(){}}cS.extension=V.Application;class hS{constructor(t){this._renderer=t}init(){var t;(t=globalThis.__PIXI_RENDERER_INIT__)==null||t.call(globalThis,this._renderer,nh)}destroy(){this._renderer=null}}hS.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"initHook",priority:-10};const uS=class Qf{constructor(...t){this.stage=new Nt,t[0]!==void 0&&ke(He,"Application constructor options are deprecated, please use Application.init() instead.")}async init(t){t={...t},this.renderer=await YN(t),Qf._plugins.forEach(s=>{s.init.call(this,t)})}render(){this.renderer.render({container:this.stage})}get canvas(){return this.renderer.canvas}get view(){return ke(He,"Application.view is deprecated, please use Application.canvas instead."),this.renderer.canvas}get screen(){return this.renderer.screen}destroy(t=!1,s=!1){const r=Qf._plugins.slice(0);r.reverse(),r.forEach(o=>{o.destroy.call(this)}),this.stage.destroy(s),this.stage=null,this.renderer.destroy(t),this.renderer=null}};uS._plugins=[];let dS=uS;Se.handleByList(V.Application,dS._plugins);Se.add(cS);class pS{static init(t){Object.defineProperty(this,"resizeTo",{set(s){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=s,s&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this._cancelResize(),this._resizeId=requestAnimationFrame(()=>this.resize()))},this._cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;this._cancelResize();let s,r;if(this._resizeTo===globalThis.window)s=globalThis.innerWidth,r=globalThis.innerHeight;else{const{clientWidth:o,clientHeight:a}=this._resizeTo;s=o,r=a}this.renderer.resize(s,r),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this._cancelResize(),this._cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}pS.extension=V.Application;class fS{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(s){this._ticker&&this._ticker.remove(this.render,this),this._ticker=s,s&&s.add(this.render,this,kl.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?Qs.shared:new Qs,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}fS.extension=V.Application;class KN extends Is{constructor(){super(...arguments),this.chars=Object.create(null),this.lineHeight=0,this.fontFamily="",this.fontMetrics={fontSize:0,ascent:0,descent:0},this.baseLineOffset=0,this.distanceField={type:"none",range:0},this.pages=[],this.applyFillAsTint=!0,this.baseMeasurementFontSize=100,this.baseRenderedFontSize=100}get font(){return ke(He,"BitmapFont.font is deprecated, please use BitmapFont.fontFamily instead."),this.fontFamily}get pageTextures(){return ke(He,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}get size(){return ke(He,"BitmapFont.size is deprecated, please use BitmapFont.fontMetrics.fontSize instead."),this.fontMetrics.fontSize}get distanceFieldRange(){return ke(He,"BitmapFont.distanceFieldRange is deprecated, please use BitmapFont.distanceField.range instead."),this.distanceField.range}get distanceFieldType(){return ke(He,"BitmapFont.distanceFieldType is deprecated, please use BitmapFont.distanceField.type instead."),this.distanceField.type}destroy(t=!1){var s;this.emit("destroy",this),this.removeAllListeners();for(const r in this.chars)(s=this.chars[r].texture)==null||s.destroy();this.chars=null,t&&(this.pages.forEach(r=>r.texture.destroy(!0)),this.pages=null)}}const jN=["serif","sans-serif","monospace","cursive","fantasy","system-ui"];function oh(l){const t=typeof l.fontSize=="number"?`${l.fontSize}px`:l.fontSize;let s=l.fontFamily;Array.isArray(l.fontFamily)||(s=l.fontFamily.split(","));for(let r=s.length-1;r>=0;r--){let o=s[r].trim();!/([\"\'])[^\'\"]+\1/.test(o)&&!jN.includes(o)&&(o=`"${o}"`),s[r]=o}return`${l.fontStyle} ${l.fontVariant} ${l.fontWeight} ${t} ${s.join(",")}`}const Sf={willReadFrequently:!0},yi=class $e{static get experimentalLetterSpacingSupported(){let t=$e._experimentalLetterSpacingSupported;if(t===void 0){const s=it.get().getCanvasRenderingContext2D().prototype;t=$e._experimentalLetterSpacingSupported="letterSpacing"in s||"textLetterSpacing"in s}return t}constructor(t,s,r,o,a,h,u,p,f){this.text=t,this.style=s,this.width=r,this.height=o,this.lines=a,this.lineWidths=h,this.lineHeight=u,this.maxLineWidth=p,this.fontProperties=f}static measureText(t=" ",s,r=$e._canvas,o=s.wordWrap){var C;const a=oh(s),h=$e.measureFont(a);h.fontSize===0&&(h.fontSize=s.fontSize,h.ascent=s.fontSize);const u=$e.__context;u.font=a;const f=(o?$e._wordWrap(t,s,r):t).split(/(?:\r\n|\r|\n)/),g=new Array(f.length);let _=0;for(let R=0;R<f.length;R++){const A=$e._measureText(f[R],s.letterSpacing,u);g[R]=A,_=Math.max(_,A)}const $=((C=s._stroke)==null?void 0:C.width)||0;let E=_+$;s.dropShadow&&(E+=s.dropShadow.distance);const v=s.lineHeight||h.fontSize;let w=Math.max(v,h.fontSize+$)+(f.length-1)*(v+s.leading);return s.dropShadow&&(w+=s.dropShadow.distance),new $e(t,s,E,w,f,g,v+s.leading,_,h)}static _measureText(t,s,r){let o=!1;$e.experimentalLetterSpacingSupported&&($e.experimentalLetterSpacing?(r.letterSpacing=`${s}px`,r.textLetterSpacing=`${s}px`,o=!0):(r.letterSpacing="0px",r.textLetterSpacing="0px"));const a=r.measureText(t);let h=a.width;const u=-a.actualBoundingBoxLeft;let f=a.actualBoundingBoxRight-u;if(h>0)if(o)h-=s,f-=s;else{const g=($e.graphemeSegmenter(t).length-1)*s;h+=g,f+=g}return Math.max(h,f)}static _wordWrap(t,s,r=$e._canvas){const o=r.getContext("2d",Sf);let a=0,h="",u="";const p=Object.create(null),{letterSpacing:f,whiteSpace:g}=s,_=$e._collapseSpaces(g),$=$e._collapseNewlines(g);let E=!_;const v=s.wordWrapWidth+f,w=$e._tokenize(t);for(let x=0;x<w.length;x++){let C=w[x];if($e._isNewline(C)){if(!$){u+=$e._addLine(h),E=!_,h="",a=0;continue}C=" "}if(_){const A=$e.isBreakingSpace(C),D=$e.isBreakingSpace(h[h.length-1]);if(A&&D)continue}const R=$e._getFromCache(C,f,p,o);if(R>v)if(h!==""&&(u+=$e._addLine(h),h="",a=0),$e.canBreakWords(C,s.breakWords)){const A=$e.wordWrapSplit(C);for(let D=0;D<A.length;D++){let G=A[D],M=G,k=1;for(;A[D+k];){const se=A[D+k];if(!$e.canBreakChars(M,se,C,D,s.breakWords))G+=se;else break;M=se,k++}D+=k-1;const z=$e._getFromCache(G,f,p,o);z+a>v&&(u+=$e._addLine(h),E=!1,h="",a=0),h+=G,a+=z}}else{h.length>0&&(u+=$e._addLine(h),h="",a=0);const A=x===w.length-1;u+=$e._addLine(C,!A),E=!1,h="",a=0}else R+a>v&&(E=!1,u+=$e._addLine(h),h="",a=0),(h.length>0||!$e.isBreakingSpace(C)||E)&&(h+=C,a+=R)}return u+=$e._addLine(h,!1),u}static _addLine(t,s=!0){return t=$e._trimRight(t),t=s?`${t}
`:t,t}static _getFromCache(t,s,r,o){let a=r[t];return typeof a!="number"&&(a=$e._measureText(t,s,o)+s,r[t]=a),a}static _collapseSpaces(t){return t==="normal"||t==="pre-line"}static _collapseNewlines(t){return t==="normal"}static _trimRight(t){if(typeof t!="string")return"";for(let s=t.length-1;s>=0;s--){const r=t[s];if(!$e.isBreakingSpace(r))break;t=t.slice(0,-1)}return t}static _isNewline(t){return typeof t!="string"?!1:$e._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,s){return typeof t!="string"?!1:$e._breakingSpaces.includes(t.charCodeAt(0))}static _tokenize(t){const s=[];let r="";if(typeof t!="string")return s;for(let o=0;o<t.length;o++){const a=t[o],h=t[o+1];if($e.isBreakingSpace(a,h)||$e._isNewline(a)){r!==""&&(s.push(r),r=""),a==="\r"&&h===`
`?(s.push(`\r
`),o++):s.push(a);continue}r+=a}return r!==""&&s.push(r),s}static canBreakWords(t,s){return s}static canBreakChars(t,s,r,o,a){return!0}static wordWrapSplit(t){return $e.graphemeSegmenter(t)}static measureFont(t){if($e._fonts[t])return $e._fonts[t];const s=$e._context;s.font=t;const r=s.measureText($e.METRICS_STRING+$e.BASELINE_SYMBOL),o={ascent:r.actualBoundingBoxAscent,descent:r.actualBoundingBoxDescent,fontSize:r.actualBoundingBoxAscent+r.actualBoundingBoxDescent};return $e._fonts[t]=o,o}static clearMetrics(t=""){t?delete $e._fonts[t]:$e._fonts={}}static get _canvas(){if(!$e.__canvas){let t;try{const s=new OffscreenCanvas(0,0),r=s.getContext("2d",Sf);if(r!=null&&r.measureText)return $e.__canvas=s,s;t=it.get().createCanvas()}catch{t=it.get().createCanvas()}t.width=t.height=10,$e.__canvas=t}return $e.__canvas}static get _context(){return $e.__context||($e.__context=$e._canvas.getContext("2d",Sf)),$e.__context}};yi.METRICS_STRING="|ÉqÅ";yi.BASELINE_SYMBOL="M";yi.BASELINE_MULTIPLIER=1.4;yi.HEIGHT_MULTIPLIER=2;yi.graphemeSegmenter=(()=>{if(typeof(Intl==null?void 0:Intl.Segmenter)=="function"){const l=new Intl.Segmenter;return t=>{const s=l.segment(t),r=[];let o=0;for(const a of s)r[o++]=a.segment;return r}}return l=>[...l]})();yi.experimentalLetterSpacing=!1;yi._fonts={};yi._newlines=[10,13];yi._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];let Ei=yi;const sy=[{offset:0,color:"white"},{offset:1,color:"black"}],Ig=class eg{constructor(...t){this.uid=st("fillGradient"),this.type="linear",this.colorStops=[];let s=qN(t);s={...s.type==="radial"?eg.defaultRadialOptions:eg.defaultLinearOptions,...mv(s)},this._textureSize=s.textureSize,this._wrapMode=s.wrapMode,s.type==="radial"?(this.center=s.center,this.outerCenter=s.outerCenter??this.center,this.innerRadius=s.innerRadius,this.outerRadius=s.outerRadius,this.scale=s.scale,this.rotation=s.rotation):(this.start=s.start,this.end=s.end),this.textureSpace=s.textureSpace,this.type=s.type,s.colorStops.forEach(o=>{this.addColorStop(o.offset,o.color)})}addColorStop(t,s){return this.colorStops.push({offset:t,color:We.shared.setValue(s).toHexa()}),this}buildLinearGradient(){if(this.texture)return;let{x:t,y:s}=this.start,{x:r,y:o}=this.end,a=r-t,h=o-s;const u=a<0||h<0;if(this._wrapMode==="clamp-to-edge"){if(a<0){const x=t;t=r,r=x,a*=-1}if(h<0){const x=s;s=o,o=x,h*=-1}}const p=this.colorStops.length?this.colorStops:sy,f=this._textureSize,{canvas:g,context:_}=ry(f,1),$=u?_.createLinearGradient(this._textureSize,0,0,0):_.createLinearGradient(0,0,this._textureSize,0);iy($,p),_.fillStyle=$,_.fillRect(0,0,f,1),this.texture=new me({source:new Rl({resource:g,addressMode:this._wrapMode})});const E=Math.sqrt(a*a+h*h),v=Math.atan2(h,a),w=new Te;w.scale(E/f,1),w.rotate(v),w.translate(t,s),this.textureSpace==="local"&&w.scale(f,f),this.transform=w}buildGradient(){this.type==="linear"?this.buildLinearGradient():this.buildRadialGradient()}buildRadialGradient(){if(this.texture)return;const t=this.colorStops.length?this.colorStops:sy,s=this._textureSize,{canvas:r,context:o}=ry(s,s),{x:a,y:h}=this.center,{x:u,y:p}=this.outerCenter,f=this.innerRadius,g=this.outerRadius,_=u-g,$=p-g,E=s/(g*2),v=(a-_)*E,w=(h-$)*E,x=o.createRadialGradient(v,w,f*E,(u-_)*E,(p-$)*E,g*E);iy(x,t),o.fillStyle=t[t.length-1].color,o.fillRect(0,0,s,s),o.fillStyle=x,o.translate(v,w),o.rotate(this.rotation),o.scale(1,this.scale),o.translate(-v,-w),o.fillRect(0,0,s,s),this.texture=new me({source:new Rl({resource:r,addressMode:this._wrapMode})});const C=new Te;C.scale(1/E,1/E),C.translate(_,$),this.textureSpace==="local"&&C.scale(s,s),this.transform=C}get styleKey(){return this.uid}destroy(){var t;(t=this.texture)==null||t.destroy(!0),this.texture=null}};Ig.defaultLinearOptions={start:{x:0,y:0},end:{x:0,y:1},colorStops:[],textureSpace:"local",type:"linear",textureSize:256,wrapMode:"clamp-to-edge"};Ig.defaultRadialOptions={center:{x:.5,y:.5},innerRadius:0,outerRadius:.5,colorStops:[],scale:1,textureSpace:"local",type:"radial",textureSize:256,wrapMode:"clamp-to-edge"};let ji=Ig;function iy(l,t){for(let s=0;s<t.length;s++){const r=t[s];l.addColorStop(r.offset,r.color)}}function ry(l,t){const s=it.get().createCanvas(l,t),r=s.getContext("2d");return{canvas:s,context:r}}function qN(l){let t=l[0]??{};return(typeof t=="number"||l[1])&&(ke("8.5.2","use options object instead"),t={type:"linear",start:{x:l[0],y:l[1]},end:{x:l[2],y:l[3]},textureSpace:l[4],textureSize:l[5]??ji.defaultLinearOptions.textureSize}),t}const ny={repeat:{addressModeU:"repeat",addressModeV:"repeat"},"repeat-x":{addressModeU:"repeat",addressModeV:"clamp-to-edge"},"repeat-y":{addressModeU:"clamp-to-edge",addressModeV:"repeat"},"no-repeat":{addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"}};class gh{constructor(t,s){this.uid=st("fillPattern"),this.transform=new Te,this._styleKey=null,this.texture=t,this.transform.scale(1/t.frame.width,1/t.frame.height),s&&(t.source.style.addressModeU=ny[s].addressModeU,t.source.style.addressModeV=ny[s].addressModeV)}setTransform(t){const s=this.texture;this.transform.copyFrom(t),this.transform.invert(),this.transform.scale(1/s.frame.width,1/s.frame.height),this._styleKey=null}get styleKey(){return this._styleKey?this._styleKey:(this._styleKey=`fill-pattern-${this.uid}-${this.texture.uid}-${this.transform.toArray().join("-")}`,this._styleKey)}}var JN=QN,If={a:7,c:6,h:1,l:2,m:2,q:4,s:4,t:2,v:1,z:0},ZN=/([astvzqmhlc])([^astvzqmhlc]*)/ig;function QN(l){var t=[];return l.replace(ZN,function(s,r,o){var a=r.toLowerCase();for(o=tD(o),a=="m"&&o.length>2&&(t.push([r].concat(o.splice(0,2))),a="l",r=r=="m"?"l":"L");;){if(o.length==If[a])return o.unshift(r),t.push(o);if(o.length<If[a])throw new Error("malformed path data");t.push([r].concat(o.splice(0,If[a])))}}),t}var eD=/-?[0-9]*\.?[0-9]+(?:e[-+]?\d+)?/ig;function tD(l){var t=l.match(eD);return t?t.map(Number):[]}const sD=co(JN);function iD(l,t){const s=sD(l),r=[];let o=null,a=0,h=0;for(let u=0;u<s.length;u++){const p=s[u],f=p[0],g=p;switch(f){case"M":a=g[1],h=g[2],t.moveTo(a,h);break;case"m":a+=g[1],h+=g[2],t.moveTo(a,h);break;case"H":a=g[1],t.lineTo(a,h);break;case"h":a+=g[1],t.lineTo(a,h);break;case"V":h=g[1],t.lineTo(a,h);break;case"v":h+=g[1],t.lineTo(a,h);break;case"L":a=g[1],h=g[2],t.lineTo(a,h);break;case"l":a+=g[1],h+=g[2],t.lineTo(a,h);break;case"C":a=g[5],h=g[6],t.bezierCurveTo(g[1],g[2],g[3],g[4],a,h);break;case"c":t.bezierCurveTo(a+g[1],h+g[2],a+g[3],h+g[4],a+g[5],h+g[6]),a+=g[5],h+=g[6];break;case"S":a=g[3],h=g[4],t.bezierCurveToShort(g[1],g[2],a,h);break;case"s":t.bezierCurveToShort(a+g[1],h+g[2],a+g[3],h+g[4]),a+=g[3],h+=g[4];break;case"Q":a=g[3],h=g[4],t.quadraticCurveTo(g[1],g[2],a,h);break;case"q":t.quadraticCurveTo(a+g[1],h+g[2],a+g[3],h+g[4]),a+=g[3],h+=g[4];break;case"T":a=g[1],h=g[2],t.quadraticCurveToShort(a,h);break;case"t":a+=g[1],h+=g[2],t.quadraticCurveToShort(a,h);break;case"A":a=g[6],h=g[7],t.arcToSvg(g[1],g[2],g[3],g[4],g[5],a,h);break;case"a":a+=g[6],h+=g[7],t.arcToSvg(g[1],g[2],g[3],g[4],g[5],a,h);break;case"Z":case"z":t.closePath(),r.length>0&&(o=r.pop(),o?(a=o.startX,h=o.startY):(a=0,h=0)),o=null;break;default:we(`Unknown SVG path command: ${f}`)}f!=="Z"&&f!=="z"&&o===null&&(o={startX:a,startY:h},r.push(o))}return t}class xg{constructor(t=0,s=0,r=0){this.type="circle",this.x=t,this.y=s,this.radius=r}clone(){return new xg(this.x,this.y,this.radius)}contains(t,s){if(this.radius<=0)return!1;const r=this.radius*this.radius;let o=this.x-t,a=this.y-s;return o*=o,a*=a,o+a<=r}strokeContains(t,s,r,o=.5){if(this.radius===0)return!1;const a=this.x-t,h=this.y-s,u=this.radius,p=(1-o)*r,f=Math.sqrt(a*a+h*h);return f<=u+p&&f>u-(r-p)}getBounds(t){return t||(t=new Fe),t.x=this.x-this.radius,t.y=this.y-this.radius,t.width=this.radius*2,t.height=this.radius*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.radius=t.radius,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class Cg{constructor(t=0,s=0,r=0,o=0){this.type="ellipse",this.x=t,this.y=s,this.halfWidth=r,this.halfHeight=o}clone(){return new Cg(this.x,this.y,this.halfWidth,this.halfHeight)}contains(t,s){if(this.halfWidth<=0||this.halfHeight<=0)return!1;let r=(t-this.x)/this.halfWidth,o=(s-this.y)/this.halfHeight;return r*=r,o*=o,r+o<=1}strokeContains(t,s,r,o=.5){const{halfWidth:a,halfHeight:h}=this;if(a<=0||h<=0)return!1;const u=r*(1-o),p=r-u,f=a-p,g=h-p,_=a+u,$=h+u,E=t-this.x,v=s-this.y,w=E*E/(f*f)+v*v/(g*g),x=E*E/(_*_)+v*v/($*$);return w>1&&x<=1}getBounds(t){return t||(t=new Fe),t.x=this.x-this.halfWidth,t.y=this.y-this.halfHeight,t.width=this.halfWidth*2,t.height=this.halfHeight*2,t}copyFrom(t){return this.x=t.x,this.y=t.y,this.halfWidth=t.halfWidth,this.halfHeight=t.halfHeight,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:Ellipse x=${this.x} y=${this.y} halfWidth=${this.halfWidth} halfHeight=${this.halfHeight}]`}}function rD(l,t,s,r,o,a){const h=l-s,u=t-r,p=o-s,f=a-r,g=h*p+u*f,_=p*p+f*f;let $=-1;_!==0&&($=g/_);let E,v;$<0?(E=s,v=r):$>1?(E=o,v=a):(E=s+$*p,v=r+$*f);const w=l-E,x=t-v;return w*w+x*x}let nD,oD;class Sl{constructor(...t){this.type="polygon";let s=Array.isArray(t[0])?t[0]:t;if(typeof s[0]!="number"){const r=[];for(let o=0,a=s.length;o<a;o++)r.push(s[o].x,s[o].y);s=r}this.points=s,this.closePath=!0}isClockwise(){let t=0;const s=this.points,r=s.length;for(let o=0;o<r;o+=2){const a=s[o],h=s[o+1],u=s[(o+2)%r],p=s[(o+3)%r];t+=(u-a)*(p+h)}return t<0}containsPolygon(t){const s=this.getBounds(nD),r=t.getBounds(oD);if(!s.containsRect(r))return!1;const o=t.points;for(let a=0;a<o.length;a+=2){const h=o[a],u=o[a+1];if(!this.contains(h,u))return!1}return!0}clone(){const t=this.points.slice(),s=new Sl(t);return s.closePath=this.closePath,s}contains(t,s){let r=!1;const o=this.points.length/2;for(let a=0,h=o-1;a<o;h=a++){const u=this.points[a*2],p=this.points[a*2+1],f=this.points[h*2],g=this.points[h*2+1];p>s!=g>s&&t<(f-u)*((s-p)/(g-p))+u&&(r=!r)}return r}strokeContains(t,s,r,o=.5){const a=r*r,h=a*(1-o),u=a-h,{points:p}=this,f=p.length-(this.closePath?0:2);for(let g=0;g<f;g+=2){const _=p[g],$=p[g+1],E=p[(g+2)%p.length],v=p[(g+3)%p.length],w=rD(t,s,_,$,E,v),x=Math.sign((E-_)*(s-$)-(v-$)*(t-_));if(w<=(x<0?u:h))return!0}return!1}getBounds(t){t||(t=new Fe);const s=this.points;let r=1/0,o=-1/0,a=1/0,h=-1/0;for(let u=0,p=s.length;u<p;u+=2){const f=s[u],g=s[u+1];r=f<r?f:r,o=f>o?f:o,a=g<a?g:a,h=g>h?g:h}return t.x=r,t.width=o-r,t.y=a,t.height=h-a,t}copyFrom(t){return this.points=t.points.slice(),this.closePath=t.closePath,this}copyTo(t){return t.copyFrom(this),t}toString(){return`[pixi.js/math:PolygoncloseStroke=${this.closePath}points=${this.points.reduce((t,s)=>`${t}, ${s}`,"")}]`}get lastX(){return this.points[this.points.length-2]}get lastY(){return this.points[this.points.length-1]}get x(){return ke("8.11.0","Polygon.lastX is deprecated, please use Polygon.lastX instead."),this.points[this.points.length-2]}get y(){return ke("8.11.0","Polygon.y is deprecated, please use Polygon.lastY instead."),this.points[this.points.length-1]}get startX(){return this.points[0]}get startY(){return this.points[1]}}const Gc=(l,t,s,r,o,a,h)=>{const u=l-s,p=t-r,f=Math.sqrt(u*u+p*p);return f>=o-a&&f<=o+h};class wg{constructor(t=0,s=0,r=0,o=0,a=20){this.type="roundedRectangle",this.x=t,this.y=s,this.width=r,this.height=o,this.radius=a}getBounds(t){return t||(t=new Fe),t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}clone(){return new wg(this.x,this.y,this.width,this.height,this.radius)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.copyFrom(this),t}contains(t,s){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&s>=this.y&&s<=this.y+this.height){const r=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(s>=this.y+r&&s<=this.y+this.height-r||t>=this.x+r&&t<=this.x+this.width-r)return!0;let o=t-(this.x+r),a=s-(this.y+r);const h=r*r;if(o*o+a*a<=h||(o=t-(this.x+this.width-r),o*o+a*a<=h)||(a=s-(this.y+this.height-r),o*o+a*a<=h)||(o=t-(this.x+r),o*o+a*a<=h))return!0}return!1}strokeContains(t,s,r,o=.5){const{x:a,y:h,width:u,height:p,radius:f}=this,g=r*(1-o),_=r-g,$=a+f,E=h+f,v=u-f*2,w=p-f*2,x=a+u,C=h+p;return(t>=a-g&&t<=a+_||t>=x-_&&t<=x+g)&&s>=E&&s<=E+w||(s>=h-g&&s<=h+_||s>=C-_&&s<=C+g)&&t>=$&&t<=$+v?!0:t<$&&s<E&&Gc(t,s,$,E,f,_,g)||t>x-f&&s<E&&Gc(t,s,x-f,E,f,_,g)||t>x-f&&s>C-f&&Gc(t,s,x-f,C-f,f,_,g)||t<$&&s>C-f&&Gc(t,s,$,C-f,f,_,g)}toString(){return`[pixi.js/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}const gS={};function Rg(l,t,s){let r=2166136261;for(let o=0;o<t;o++)r^=l[o].uid,r=Math.imul(r,16777619),r>>>=0;return gS[r]||lD(l,t,r,s)}function lD(l,t,s,r){const o={};let a=0;for(let u=0;u<r;u++){const p=u<t?l[u]:me.EMPTY.source;o[a++]=p.source,o[a++]=p.style}const h=new Ki(o);return gS[s]=h,h}class io{constructor(t){typeof t=="number"?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData),this.size=this.rawBinaryData.byteLength}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}get float64View(){return this._float64Array||(this._float64Array=new Float64Array(this.rawBinaryData)),this._float64Array}get bigUint64View(){return this._bigUint64Array||(this._bigUint64Array=new BigUint64Array(this.rawBinaryData)),this._bigUint64Array}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this.uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}function tg(l,t){const s=l.byteLength/8|0,r=new Float64Array(l,0,s);new Float64Array(t,0,s).set(r);const a=l.byteLength-s*8;if(a>0){const h=new Uint8Array(l,s*8,a);new Uint8Array(t,s*8,a).set(h)}}const aD={normal:"normal-npm",add:"add-npm",screen:"screen-npm"};var ft=(l=>(l[l.DISABLED=0]="DISABLED",l[l.RENDERING_MASK_ADD=1]="RENDERING_MASK_ADD",l[l.MASK_ACTIVE=2]="MASK_ACTIVE",l[l.INVERSE_MASK_ACTIVE=3]="INVERSE_MASK_ACTIVE",l[l.RENDERING_MASK_REMOVE=4]="RENDERING_MASK_REMOVE",l[l.NONE=5]="NONE",l))(ft||{});function Nl(l,t){return t.alphaMode==="no-premultiply-alpha"&&aD[l]||l}const cD=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join(`
`);function hD(l){let t="";for(let s=0;s<l;++s)s>0&&(t+=`
else `),s<l-1&&(t+=`if(test == ${s}.0){}`);return t}function mS(l,t){if(l===0)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const s=t.createShader(t.FRAGMENT_SHADER);try{for(;;){const r=cD.replace(/%forloop%/gi,hD(l));if(t.shaderSource(s,r),t.compileShader(s),!t.getShaderParameter(s,t.COMPILE_STATUS))l=l/2|0;else break}}finally{t.deleteShader(s)}return l}let Qn=null;function uD(){var t;if(Qn)return Qn;const l=Kv();return Qn=l.getParameter(l.MAX_TEXTURE_IMAGE_UNITS),Qn=mS(Qn,l),(t=l.getExtension("WEBGL_lose_context"))==null||t.loseContext(),Qn}class dD{constructor(){this.ids=Object.create(null),this.textures=[],this.count=0}clear(){for(let t=0;t<this.count;t++){const s=this.textures[t];this.textures[t]=null,this.ids[s.uid]=null}this.count=0}}class pD{constructor(){this.renderPipeId="batch",this.action="startBatch",this.start=0,this.size=0,this.textures=new dD,this.blendMode="normal",this.topology="triangle-strip",this.canBundle=!0}destroy(){this.textures=null,this.gpuBindGroup=null,this.bindGroup=null,this.batcher=null}}const _S=[];let sg=0;function oy(){return sg>0?_S[--sg]:new pD}function ly(l){_S[sg++]=l}let ul=0;const $S=class TS{constructor(t){this.uid=st("batcher"),this.dirty=!0,this.batchIndex=0,this.batches=[],this._elements=[],t={...TS.defaultOptions,...t},t.maxTextures||(ke("v8.8.0","maxTextures is a required option for Batcher now, please pass it in the options"),t.maxTextures=uD());const{maxTextures:s,attributesInitialSize:r,indicesInitialSize:o}=t;this.attributeBuffer=new io(r*4),this.indexBuffer=new Uint16Array(o),this.maxTextures=s}begin(){this.elementSize=0,this.elementStart=0,this.indexSize=0,this.attributeSize=0;for(let t=0;t<this.batchIndex;t++)ly(this.batches[t]);this.batchIndex=0,this._batchIndexStart=0,this._batchIndexSize=0,this.dirty=!0}add(t){this._elements[this.elementSize++]=t,t._indexStart=this.indexSize,t._attributeStart=this.attributeSize,t._batcher=this,this.indexSize+=t.indexSize,this.attributeSize+=t.attributeSize*this.vertexSize}checkAndUpdateTexture(t,s){const r=t._batch.textures.ids[s._source.uid];return!r&&r!==0?!1:(t._textureId=r,t.texture=s,!0)}updateElement(t){this.dirty=!0;const s=this.attributeBuffer;t.packAsQuad?this.packQuadAttributes(t,s.float32View,s.uint32View,t._attributeStart,t._textureId):this.packAttributes(t,s.float32View,s.uint32View,t._attributeStart,t._textureId)}break(t){const s=this._elements;if(!s[this.elementStart])return;let r=oy(),o=r.textures;o.clear();const a=s[this.elementStart];let h=Nl(a.blendMode,a.texture._source),u=a.topology;this.attributeSize*4>this.attributeBuffer.size&&this._resizeAttributeBuffer(this.attributeSize*4),this.indexSize>this.indexBuffer.length&&this._resizeIndexBuffer(this.indexSize);const p=this.attributeBuffer.float32View,f=this.attributeBuffer.uint32View,g=this.indexBuffer;let _=this._batchIndexSize,$=this._batchIndexStart,E="startBatch";const v=this.maxTextures;for(let w=this.elementStart;w<this.elementSize;++w){const x=s[w];s[w]=null;const R=x.texture._source,A=Nl(x.blendMode,R),D=h!==A||u!==x.topology;if(R._batchTick===ul&&!D){x._textureId=R._textureBindLocation,_+=x.indexSize,x.packAsQuad?(this.packQuadAttributes(x,p,f,x._attributeStart,x._textureId),this.packQuadIndex(g,x._indexStart,x._attributeStart/this.vertexSize)):(this.packAttributes(x,p,f,x._attributeStart,x._textureId),this.packIndex(x,g,x._indexStart,x._attributeStart/this.vertexSize)),x._batch=r;continue}R._batchTick=ul,(o.count>=v||D)&&(this._finishBatch(r,$,_-$,o,h,u,t,E),E="renderBatch",$=_,h=A,u=x.topology,r=oy(),o=r.textures,o.clear(),++ul),x._textureId=R._textureBindLocation=o.count,o.ids[R.uid]=o.count,o.textures[o.count++]=R,x._batch=r,_+=x.indexSize,x.packAsQuad?(this.packQuadAttributes(x,p,f,x._attributeStart,x._textureId),this.packQuadIndex(g,x._indexStart,x._attributeStart/this.vertexSize)):(this.packAttributes(x,p,f,x._attributeStart,x._textureId),this.packIndex(x,g,x._indexStart,x._attributeStart/this.vertexSize))}o.count>0&&(this._finishBatch(r,$,_-$,o,h,u,t,E),$=_,++ul),this.elementStart=this.elementSize,this._batchIndexStart=$,this._batchIndexSize=_}_finishBatch(t,s,r,o,a,h,u,p){t.gpuBindGroup=null,t.bindGroup=null,t.action=p,t.batcher=this,t.textures=o,t.blendMode=a,t.topology=h,t.start=s,t.size=r,++ul,this.batches[this.batchIndex++]=t,u.add(t)}finish(t){this.break(t)}ensureAttributeBuffer(t){t*4<=this.attributeBuffer.size||this._resizeAttributeBuffer(t*4)}ensureIndexBuffer(t){t<=this.indexBuffer.length||this._resizeIndexBuffer(t)}_resizeAttributeBuffer(t){const s=Math.max(t,this.attributeBuffer.size*2),r=new io(s);tg(this.attributeBuffer.rawBinaryData,r.rawBinaryData),this.attributeBuffer=r}_resizeIndexBuffer(t){const s=this.indexBuffer;let r=Math.max(t,s.length*1.5);r+=r%2;const o=r>65535?new Uint32Array(r):new Uint16Array(r);if(o.BYTES_PER_ELEMENT!==s.BYTES_PER_ELEMENT)for(let a=0;a<s.length;a++)o[a]=s[a];else tg(s.buffer,o.buffer);this.indexBuffer=o}packQuadIndex(t,s,r){t[s]=r+0,t[s+1]=r+1,t[s+2]=r+2,t[s+3]=r+0,t[s+4]=r+2,t[s+5]=r+3}packIndex(t,s,r,o){const a=t.indices,h=t.indexSize,u=t.indexOffset,p=t.attributeOffset;for(let f=0;f<h;f++)s[r++]=o+a[f+u]-p}destroy(){for(let t=0;t<this.batches.length;t++)ly(this.batches[t]);this.batches=null;for(let t=0;t<this._elements.length;t++)this._elements[t]._batch=null;this._elements=null,this.indexBuffer=null,this.attributeBuffer.destroy(),this.attributeBuffer=null}};$S.defaultOptions={maxTextures:null,attributesInitialSize:4,indicesInitialSize:6};let fD=$S;var Me=(l=>(l[l.MAP_READ=1]="MAP_READ",l[l.MAP_WRITE=2]="MAP_WRITE",l[l.COPY_SRC=4]="COPY_SRC",l[l.COPY_DST=8]="COPY_DST",l[l.INDEX=16]="INDEX",l[l.VERTEX=32]="VERTEX",l[l.UNIFORM=64]="UNIFORM",l[l.STORAGE=128]="STORAGE",l[l.INDIRECT=256]="INDIRECT",l[l.QUERY_RESOLVE=512]="QUERY_RESOLVE",l[l.STATIC=1024]="STATIC",l))(Me||{});class Ss extends Is{constructor(t){let{data:s,size:r}=t;const{usage:o,label:a,shrinkToFit:h}=t;super(),this.uid=st("buffer"),this._resourceType="buffer",this._resourceId=st("resource"),this._touched=0,this._updateID=1,this._dataInt32=null,this.shrinkToFit=!0,this.destroyed=!1,s instanceof Array&&(s=new Float32Array(s)),this._data=s,r??(r=s==null?void 0:s.byteLength);const u=!!s;this.descriptor={size:r,usage:o,mappedAtCreation:u,label:a},this.shrinkToFit=h??!0}get data(){return this._data}set data(t){this.setDataWithSize(t,t.length,!0)}get dataInt32(){return this._dataInt32||(this._dataInt32=new Int32Array(this.data.buffer)),this._dataInt32}get static(){return!!(this.descriptor.usage&Me.STATIC)}set static(t){t?this.descriptor.usage|=Me.STATIC:this.descriptor.usage&=~Me.STATIC}setDataWithSize(t,s,r){if(this._updateID++,this._updateSize=s*t.BYTES_PER_ELEMENT,this._data===t){r&&this.emit("update",this);return}const o=this._data;if(this._data=t,this._dataInt32=null,!o||o.length!==t.length){!this.shrinkToFit&&o&&t.byteLength<o.byteLength?r&&this.emit("update",this):(this.descriptor.size=t.byteLength,this._resourceId=st("resource"),this.emit("change",this));return}r&&this.emit("update",this)}update(t){this._updateSize=t??this._updateSize,this._updateID++,this.emit("update",this)}destroy(){this.destroyed=!0,this.emit("destroy",this),this.emit("change",this),this._data=null,this.descriptor=null,this.removeAllListeners()}}function bS(l,t){if(!(l instanceof Ss)){let s=t?Me.INDEX:Me.VERTEX;l instanceof Array&&(t?(l=new Uint32Array(l),s=Me.INDEX|Me.COPY_DST):(l=new Float32Array(l),s=Me.VERTEX|Me.COPY_DST)),l=new Ss({data:l,label:t?"index-mesh-buffer":"vertex-mesh-buffer",usage:s})}return l}function gD(l,t,s){const r=l.getAttribute(t);if(!r)return s.minX=0,s.minY=0,s.maxX=0,s.maxY=0,s;const o=r.buffer.data;let a=1/0,h=1/0,u=-1/0,p=-1/0;const f=o.BYTES_PER_ELEMENT,g=(r.offset||0)/f,_=(r.stride||2*4)/f;for(let $=g;$<o.length;$+=_){const E=o[$],v=o[$+1];E>u&&(u=E),v>p&&(p=v),E<a&&(a=E),v<h&&(h=v)}return s.minX=a,s.minY=h,s.maxX=u,s.maxY=p,s}function mD(l){return(l instanceof Ss||Array.isArray(l)||l.BYTES_PER_ELEMENT)&&(l={buffer:l}),l.buffer=bS(l.buffer,!1),l}class Ul extends Is{constructor(t={}){super(),this.uid=st("geometry"),this._layoutKey=0,this.instanceCount=1,this._bounds=new Yt,this._boundsDirty=!0;const{attributes:s,indexBuffer:r,topology:o}=t;if(this.buffers=[],this.attributes={},s)for(const a in s)this.addAttribute(a,s[a]);this.instanceCount=t.instanceCount??1,r&&this.addIndex(r),this.topology=o||"triangle-list"}onBufferUpdate(){this._boundsDirty=!0,this.emit("update",this)}getAttribute(t){return this.attributes[t]}getIndex(){return this.indexBuffer}getBuffer(t){return this.getAttribute(t).buffer}getSize(){for(const t in this.attributes){const s=this.attributes[t];return s.buffer.data.length/(s.stride/4||s.size)}return 0}addAttribute(t,s){const r=mD(s);this.buffers.indexOf(r.buffer)===-1&&(this.buffers.push(r.buffer),r.buffer.on("update",this.onBufferUpdate,this),r.buffer.on("change",this.onBufferUpdate,this)),this.attributes[t]=r}addIndex(t){this.indexBuffer=bS(t,!0),this.buffers.push(this.indexBuffer)}get bounds(){return this._boundsDirty?(this._boundsDirty=!1,gD(this,"aPosition",this._bounds)):this._bounds}destroy(t=!1){this.emit("destroy",this),this.removeAllListeners(),t&&this.buffers.forEach(s=>s.destroy()),this.attributes=null,this.buffers=null,this.indexBuffer=null,this._bounds=null}}const _D=new Float32Array(1),$D=new Uint32Array(1);class TD extends Ul{constructor(){const s=new Ss({data:_D,label:"attribute-batch-buffer",usage:Me.VERTEX|Me.COPY_DST,shrinkToFit:!1}),r=new Ss({data:$D,label:"index-batch-buffer",usage:Me.INDEX|Me.COPY_DST,shrinkToFit:!1}),o=6*4;super({attributes:{aPosition:{buffer:s,format:"float32x2",stride:o,offset:0},aUV:{buffer:s,format:"float32x2",stride:o,offset:2*4},aColor:{buffer:s,format:"unorm8x4",stride:o,offset:4*4},aTextureIdAndRound:{buffer:s,format:"uint16x2",stride:o,offset:5*4}},indexBuffer:r})}}function ay(l,t,s){if(l)for(const r in l){const o=r.toLocaleLowerCase(),a=t[o];if(a){let h=l[r];r==="header"&&(h=h.replace(/@in\s+[^;]+;\s*/g,"").replace(/@out\s+[^;]+;\s*/g,"")),s&&a.push(`//----${s}----//`),a.push(h)}else we(`${r} placement hook does not exist in shader`)}}const bD=/\{\{(.*?)\}\}/g;function cy(l){var r;const t={};return(((r=l.match(bD))==null?void 0:r.map(o=>o.replace(/[{()}]/g,"")))??[]).forEach(o=>{t[o]=[]}),t}function hy(l,t){let s;const r=/@in\s+([^;]+);/g;for(;(s=r.exec(l))!==null;)t.push(s[1])}function uy(l,t,s=!1){const r=[];hy(t,r),l.forEach(u=>{u.header&&hy(u.header,r)});const o=r;s&&o.sort();const a=o.map((u,p)=>`       @location(${p}) ${u},`).join(`
`);let h=t.replace(/@in\s+[^;]+;\s*/g,"");return h=h.replace("{{in}}",`
${a}
`),h}function dy(l,t){let s;const r=/@out\s+([^;]+);/g;for(;(s=r.exec(l))!==null;)t.push(s[1])}function ED(l){const s=/\b(\w+)\s*:/g.exec(l);return s?s[1]:""}function yD(l){const t=/@.*?\s+/g;return l.replace(t,"")}function vD(l,t){const s=[];dy(t,s),l.forEach(p=>{p.header&&dy(p.header,s)});let r=0;const o=s.sort().map(p=>p.indexOf("builtin")>-1?p:`@location(${r++}) ${p}`).join(`,
`),a=s.sort().map(p=>`       var ${yD(p)};`).join(`
`),h=`return VSOutput(
            ${s.sort().map(p=>` ${ED(p)}`).join(`,
`)});`;let u=t.replace(/@out\s+[^;]+;\s*/g,"");return u=u.replace("{{struct}}",`
${o}
`),u=u.replace("{{start}}",`
${a}
`),u=u.replace("{{return}}",`
${h}
`),u}function py(l,t){let s=l;for(const r in t){const o=t[r];o.join(`
`).length?s=s.replace(`{{${r}}}`,`//-----${r} START-----//
${o.join(`
`)}
//----${r} FINISH----//`):s=s.replace(`{{${r}}}`,"")}return s}const _r=Object.create(null),xf=new Map;let SD=0;function ID({template:l,bits:t}){const s=ES(l,t);if(_r[s])return _r[s];const{vertex:r,fragment:o}=CD(l,t);return _r[s]=yS(r,o,t),_r[s]}function xD({template:l,bits:t}){const s=ES(l,t);return _r[s]||(_r[s]=yS(l.vertex,l.fragment,t)),_r[s]}function CD(l,t){const s=t.map(h=>h.vertex).filter(h=>!!h),r=t.map(h=>h.fragment).filter(h=>!!h);let o=uy(s,l.vertex,!0);o=vD(s,o);const a=uy(r,l.fragment,!0);return{vertex:o,fragment:a}}function ES(l,t){return t.map(s=>(xf.has(s)||xf.set(s,SD++),xf.get(s))).sort((s,r)=>s-r).join("-")+l.vertex+l.fragment}function yS(l,t,s){const r=cy(l),o=cy(t);return s.forEach(a=>{ay(a.vertex,r,a.name),ay(a.fragment,o,a.name)}),{vertex:py(l,r),fragment:py(t,o)}}const wD=`
    @in aPosition: vec2<f32>;
    @in aUV: vec2<f32>;

    @out @builtin(position) vPosition: vec4<f32>;
    @out vUV : vec2<f32>;
    @out vColor : vec4<f32>;

    {{header}}

    struct VSOutput {
        {{struct}}
    };

    @vertex
    fn main( {{in}} ) -> VSOutput {

        var worldTransformMatrix = globalUniforms.uWorldTransformMatrix;
        var modelMatrix = mat3x3<f32>(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        var position = aPosition;
        var uv = aUV;

        {{start}}

        vColor = vec4<f32>(1., 1., 1., 1.);

        {{main}}

        vUV = uv;

        var modelViewProjectionMatrix = globalUniforms.uProjectionMatrix * worldTransformMatrix * modelMatrix;

        vPosition =  vec4<f32>((modelViewProjectionMatrix *  vec3<f32>(position, 1.0)).xy, 0.0, 1.0);

        vColor *= globalUniforms.uWorldColorAlpha;

        {{end}}

        {{return}}
    };
`,RD=`
    @in vUV : vec2<f32>;
    @in vColor : vec4<f32>;

    {{header}}

    @fragment
    fn main(
        {{in}}
      ) -> @location(0) vec4<f32> {

        {{start}}

        var outColor:vec4<f32>;

        {{main}}

        var finalColor:vec4<f32> = outColor * vColor;

        {{end}}

        return finalColor;
      };
`,kD=`
    in vec2 aPosition;
    in vec2 aUV;

    out vec4 vColor;
    out vec2 vUV;

    {{header}}

    void main(void){

        mat3 worldTransformMatrix = uWorldTransformMatrix;
        mat3 modelMatrix = mat3(
            1.0, 0.0, 0.0,
            0.0, 1.0, 0.0,
            0.0, 0.0, 1.0
          );
        vec2 position = aPosition;
        vec2 uv = aUV;

        {{start}}

        vColor = vec4(1.);

        {{main}}

        vUV = uv;

        mat3 modelViewProjectionMatrix = uProjectionMatrix * worldTransformMatrix * modelMatrix;

        gl_Position = vec4((modelViewProjectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);

        vColor *= uWorldColorAlpha;

        {{end}}
    }
`,OD=`

    in vec4 vColor;
    in vec2 vUV;

    out vec4 finalColor;

    {{header}}

    void main(void) {

        {{start}}

        vec4 outColor;

        {{main}}

        finalColor = outColor * vColor;

        {{end}}
    }
`,AD={name:"global-uniforms-bit",vertex:{header:`
        struct GlobalUniforms {
            uProjectionMatrix:mat3x3<f32>,
            uWorldTransformMatrix:mat3x3<f32>,
            uWorldColorAlpha: vec4<f32>,
            uResolution: vec2<f32>,
        }

        @group(0) @binding(0) var<uniform> globalUniforms : GlobalUniforms;
        `}},MD={name:"global-uniforms-bit",vertex:{header:`
          uniform mat3 uProjectionMatrix;
          uniform mat3 uWorldTransformMatrix;
          uniform vec4 uWorldColorAlpha;
          uniform vec2 uResolution;
        `}};function Gl({bits:l,name:t}){const s=ID({template:{fragment:RD,vertex:wD},bits:[AD,...l]});return hn.from({name:t,vertex:{source:s.vertex,entryPoint:"main"},fragment:{source:s.fragment,entryPoint:"main"}})}function Hl({bits:l,name:t}){return new ho({name:t,...xD({template:{vertex:kD,fragment:OD},bits:[MD,...l]})})}const kg={name:"color-bit",vertex:{header:`
            @in aColor: vec4<f32>;
        `,main:`
            vColor *= vec4<f32>(aColor.rgb * aColor.a, aColor.a);
        `}},Og={name:"color-bit",vertex:{header:`
            in vec4 aColor;
        `,main:`
            vColor *= vec4(aColor.rgb * aColor.a, aColor.a);
        `}},Cf={};function LD(l){const t=[];if(l===1)t.push("@group(1) @binding(0) var textureSource1: texture_2d<f32>;"),t.push("@group(1) @binding(1) var textureSampler1: sampler;");else{let s=0;for(let r=0;r<l;r++)t.push(`@group(1) @binding(${s++}) var textureSource${r+1}: texture_2d<f32>;`),t.push(`@group(1) @binding(${s++}) var textureSampler${r+1}: sampler;`)}return t.join(`
`)}function PD(l){const t=[];if(l===1)t.push("outColor = textureSampleGrad(textureSource1, textureSampler1, vUV, uvDx, uvDy);");else{t.push("switch vTextureId {");for(let s=0;s<l;s++)s===l-1?t.push("  default:{"):t.push(`  case ${s}:{`),t.push(`      outColor = textureSampleGrad(textureSource${s+1}, textureSampler${s+1}, vUV, uvDx, uvDy);`),t.push("      break;}");t.push("}")}return t.join(`
`)}function Ag(l){return Cf[l]||(Cf[l]={name:"texture-batch-bit",vertex:{header:`
                @in aTextureIdAndRound: vec2<u32>;
                @out @interpolate(flat) vTextureId : u32;
            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1)
                {
                    vPosition = vec4<f32>(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
                }
            `},fragment:{header:`
                @in @interpolate(flat) vTextureId: u32;

                ${LD(l)}
            `,main:`
                var uvDx = dpdx(vUV);
                var uvDy = dpdy(vUV);

                ${PD(l)}
            `}}),Cf[l]}const wf={};function ND(l){const t=[];for(let s=0;s<l;s++)s>0&&t.push("else"),s<l-1&&t.push(`if(vTextureId < ${s}.5)`),t.push("{"),t.push(`	outColor = texture(uTextures[${s}], vUV);`),t.push("}");return t.join(`
`)}function Mg(l){return wf[l]||(wf[l]={name:"texture-batch-bit",vertex:{header:`
                in vec2 aTextureIdAndRound;
                out float vTextureId;

            `,main:`
                vTextureId = aTextureIdAndRound.y;
            `,end:`
                if(aTextureIdAndRound.x == 1.)
                {
                    gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
                }
            `},fragment:{header:`
                in float vTextureId;

                uniform sampler2D uTextures[${l}];

            `,main:`

                ${ND(l)}
            `}}),wf[l]}const Vl={name:"round-pixels-bit",vertex:{header:`
            fn roundPixels(position: vec2<f32>, targetSize: vec2<f32>) -> vec2<f32>
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},Wl={name:"round-pixels-bit",vertex:{header:`
            vec2 roundPixels(vec2 position, vec2 targetSize)
            {
                return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
            }
        `}},fy={};function Lg(l){let t=fy[l];if(t)return t;const s=new Int32Array(l);for(let r=0;r<l;r++)s[r]=r;return t=fy[l]=new ns({uTextures:{value:s,type:"i32",size:l}},{isStatic:!0}),t}class DD extends Ds{constructor(t){const s=Hl({name:"batch",bits:[Og,Mg(t),Wl]}),r=Gl({name:"batch",bits:[kg,Ag(t),Vl]});super({glProgram:s,gpuProgram:r,resources:{batchSamplers:Lg(t)}})}}let Rf=null;const vS=class SS extends fD{constructor(t){super(t),this.geometry=new TD,this.name=SS.extension.name,this.vertexSize=6,Rf??(Rf=new DD(t.maxTextures)),this.shader=Rf}packAttributes(t,s,r,o,a){const h=a<<16|t.roundPixels&65535,u=t.transform,p=u.a,f=u.b,g=u.c,_=u.d,$=u.tx,E=u.ty,{positions:v,uvs:w}=t,x=t.color,C=t.attributeOffset,R=C+t.attributeSize;for(let A=C;A<R;A++){const D=A*2,G=v[D],M=v[D+1];s[o++]=p*G+g*M+$,s[o++]=_*M+f*G+E,s[o++]=w[D],s[o++]=w[D+1],r[o++]=x,r[o++]=h}}packQuadAttributes(t,s,r,o,a){const h=t.texture,u=t.transform,p=u.a,f=u.b,g=u.c,_=u.d,$=u.tx,E=u.ty,v=t.bounds,w=v.maxX,x=v.minX,C=v.maxY,R=v.minY,A=h.uvs,D=t.color,G=a<<16|t.roundPixels&65535;s[o+0]=p*x+g*R+$,s[o+1]=_*R+f*x+E,s[o+2]=A.x0,s[o+3]=A.y0,r[o+4]=D,r[o+5]=G,s[o+6]=p*w+g*R+$,s[o+7]=_*R+f*w+E,s[o+8]=A.x1,s[o+9]=A.y1,r[o+10]=D,r[o+11]=G,s[o+12]=p*w+g*C+$,s[o+13]=_*C+f*w+E,s[o+14]=A.x2,s[o+15]=A.y2,r[o+16]=D,r[o+17]=G,s[o+18]=p*x+g*C+$,s[o+19]=_*C+f*x+E,s[o+20]=A.x3,s[o+21]=A.y3,r[o+22]=D,r[o+23]=G}};vS.extension={type:[V.Batcher],name:"default"};let Pg=vS;function BD(l,t,s,r,o,a,h,u=null){let p=0;s*=t,o*=a;const f=u.a,g=u.b,_=u.c,$=u.d,E=u.tx,v=u.ty;for(;p<h;){const w=l[s],x=l[s+1];r[o]=f*w+_*x+E,r[o+1]=g*w+$*x+v,o+=a,s+=t,p++}}function FD(l,t,s,r){let o=0;for(t*=s;o<r;)l[t]=0,l[t+1]=0,t+=s,o++}function IS(l,t,s,r,o){const a=t.a,h=t.b,u=t.c,p=t.d,f=t.tx,g=t.ty;s||(s=0),r||(r=2),o||(o=l.length/r-s);let _=s*r;for(let $=0;$<o;$++){const E=l[_],v=l[_+1];l[_]=a*E+u*v+f,l[_+1]=h*E+p*v+g,_+=r}}const UD=new Te;class Ng{constructor(){this.packAsQuad=!1,this.batcherName="default",this.topology="triangle-list",this.applyTransform=!0,this.roundPixels=0,this._batcher=null,this._batch=null}get uvs(){return this.geometryData.uvs}get positions(){return this.geometryData.vertices}get indices(){return this.geometryData.indices}get blendMode(){return this.renderable&&this.applyTransform?this.renderable.groupBlendMode:"normal"}get color(){const t=this.baseColor,s=t>>16|t&65280|(t&255)<<16,r=this.renderable;return r?wv(s,r.groupColor)+(this.alpha*r.groupAlpha*255<<24):s+(this.alpha*255<<24)}get transform(){var t;return((t=this.renderable)==null?void 0:t.groupTransform)||UD}copyTo(t){t.indexOffset=this.indexOffset,t.indexSize=this.indexSize,t.attributeOffset=this.attributeOffset,t.attributeSize=this.attributeSize,t.baseColor=this.baseColor,t.alpha=this.alpha,t.texture=this.texture,t.geometryData=this.geometryData,t.topology=this.topology}reset(){this.applyTransform=!0,this.renderable=null,this.topology="triangle-list"}}const Dl={extension:{type:V.ShapeBuilder,name:"circle"},build(l,t){let s,r,o,a,h,u;if(l.type==="circle"){const D=l;if(h=u=D.radius,h<=0)return!1;s=D.x,r=D.y,o=a=0}else if(l.type==="ellipse"){const D=l;if(h=D.halfWidth,u=D.halfHeight,h<=0||u<=0)return!1;s=D.x,r=D.y,o=a=0}else{const D=l,G=D.width/2,M=D.height/2;s=D.x+G,r=D.y+M,h=u=Math.max(0,Math.min(D.radius,Math.min(G,M))),o=G-h,a=M-u}if(o<0||a<0)return!1;const p=Math.ceil(2.3*Math.sqrt(h+u)),f=p*8+(o?4:0)+(a?4:0);if(f===0)return!1;if(p===0)return t[0]=t[6]=s+o,t[1]=t[3]=r+a,t[2]=t[4]=s-o,t[5]=t[7]=r-a,!0;let g=0,_=p*4+(o?2:0)+2,$=_,E=f,v=o+h,w=a,x=s+v,C=s-v,R=r+w;if(t[g++]=x,t[g++]=R,t[--_]=R,t[--_]=C,a){const D=r-w;t[$++]=C,t[$++]=D,t[--E]=D,t[--E]=x}for(let D=1;D<p;D++){const G=Math.PI/2*(D/p),M=o+Math.cos(G)*h,k=a+Math.sin(G)*u,z=s+M,se=s-M,Q=r+k,ie=r-k;t[g++]=z,t[g++]=Q,t[--_]=Q,t[--_]=se,t[$++]=se,t[$++]=ie,t[--E]=ie,t[--E]=z}v=o,w=a+u,x=s+v,C=s-v,R=r+w;const A=r-w;return t[g++]=x,t[g++]=R,t[--E]=A,t[--E]=x,o&&(t[g++]=C,t[g++]=R,t[--E]=A,t[--E]=C),!0},triangulate(l,t,s,r,o,a){if(l.length===0)return;let h=0,u=0;for(let g=0;g<l.length;g+=2)h+=l[g],u+=l[g+1];h/=l.length/2,u/=l.length/2;let p=r;t[p*s]=h,t[p*s+1]=u;const f=p++;for(let g=0;g<l.length;g+=2)t[p*s]=l[g],t[p*s+1]=l[g+1],g>0&&(o[a++]=p,o[a++]=f,o[a++]=p-1),p++;o[a++]=f+1,o[a++]=f,o[a++]=p-1}},GD={...Dl,extension:{...Dl.extension,name:"ellipse"}},HD={...Dl,extension:{...Dl.extension,name:"roundedRectangle"}},xS=1e-4,gy=1e-4;function VD(l){const t=l.length;if(t<6)return 1;let s=0;for(let r=0,o=l[t-2],a=l[t-1];r<t;r+=2){const h=l[r],u=l[r+1];s+=(h-o)*(u+a),o=h,a=u}return s<0?-1:1}function my(l,t,s,r,o,a,h,u){const p=l-s*o,f=t-r*o,g=l+s*a,_=t+r*a;let $,E;h?($=r,E=-s):($=-r,E=s);const v=p+$,w=f+E,x=g+$,C=_+E;return u.push(v,w),u.push(x,C),2}function jr(l,t,s,r,o,a,h,u){const p=s-l,f=r-t;let g=Math.atan2(p,f),_=Math.atan2(o-l,a-t);u&&g<_?g+=Math.PI*2:!u&&g>_&&(_+=Math.PI*2);let $=g;const E=_-g,v=Math.abs(E),w=Math.sqrt(p*p+f*f),x=(15*v*Math.sqrt(w)/Math.PI>>0)+1,C=E/x;if($+=C,u){h.push(l,t),h.push(s,r);for(let R=1,A=$;R<x;R++,A+=C)h.push(l,t),h.push(l+Math.sin(A)*w,t+Math.cos(A)*w);h.push(l,t),h.push(o,a)}else{h.push(s,r),h.push(l,t);for(let R=1,A=$;R<x;R++,A+=C)h.push(l+Math.sin(A)*w,t+Math.cos(A)*w),h.push(l,t);h.push(o,a),h.push(l,t)}return x*2}function WD(l,t,s,r,o,a){const h=xS;if(l.length===0)return;const u=t;let p=u.alignment;if(t.alignment!==.5){let Ne=VD(l);p=(p-.5)*Ne+.5}const f=new ve(l[0],l[1]),g=new ve(l[l.length-2],l[l.length-1]),_=r,$=Math.abs(f.x-g.x)<h&&Math.abs(f.y-g.y)<h;if(_){l=l.slice(),$&&(l.pop(),l.pop(),g.set(l[l.length-2],l[l.length-1]));const Ne=(f.x+g.x)*.5,pt=(g.y+f.y)*.5;l.unshift(Ne,pt),l.push(Ne,pt)}const E=o,v=l.length/2;let w=l.length;const x=E.length/2,C=u.width/2,R=C*C,A=u.miterLimit*u.miterLimit;let D=l[0],G=l[1],M=l[2],k=l[3],z=0,se=0,Q=-(G-k),ie=D-M,_e=0,ge=0,ue=Math.sqrt(Q*Q+ie*ie);Q/=ue,ie/=ue,Q*=C,ie*=C;const St=p,pe=(1-St)*2,be=St*2;_||(u.cap==="round"?w+=jr(D-Q*(pe-be)*.5,G-ie*(pe-be)*.5,D-Q*pe,G-ie*pe,D+Q*be,G+ie*be,E,!0)+2:u.cap==="square"&&(w+=my(D,G,Q,ie,pe,be,!0,E))),E.push(D-Q*pe,G-ie*pe),E.push(D+Q*be,G+ie*be);for(let Ne=1;Ne<v-1;++Ne){D=l[(Ne-1)*2],G=l[(Ne-1)*2+1],M=l[Ne*2],k=l[Ne*2+1],z=l[(Ne+1)*2],se=l[(Ne+1)*2+1],Q=-(G-k),ie=D-M,ue=Math.sqrt(Q*Q+ie*ie),Q/=ue,ie/=ue,Q*=C,ie*=C,_e=-(k-se),ge=M-z,ue=Math.sqrt(_e*_e+ge*ge),_e/=ue,ge/=ue,_e*=C,ge*=C;const pt=M-D,Kt=G-k,ps=M-z,fs=se-k,gt=pt*ps+Kt*fs,Ft=Kt*ps-fs*pt,qe=Ft<0;if(Math.abs(Ft)<.001*Math.abs(gt)){E.push(M-Q*pe,k-ie*pe),E.push(M+Q*be,k+ie*be),gt>=0&&(u.join==="round"?w+=jr(M,k,M-Q*pe,k-ie*pe,M-_e*pe,k-ge*pe,E,!1)+4:w+=2,E.push(M-_e*be,k-ge*be),E.push(M+_e*pe,k+ge*pe));continue}const xs=(-Q+D)*(-ie+k)-(-Q+M)*(-ie+G),si=(-_e+z)*(-ge+k)-(-_e+M)*(-ge+se),kt=(pt*si-ps*xs)/Ft,os=(fs*xs-Kt*si)/Ft,ii=(kt-M)*(kt-M)+(os-k)*(os-k),jt=M+(kt-M)*pe,Ut=k+(os-k)*pe,qt=M-(kt-M)*be,lt=k-(os-k)*be,It=Math.min(pt*pt+Kt*Kt,ps*ps+fs*fs),Cs=qe?pe:be,ws=It+Cs*Cs*R;ii<=ws?u.join==="bevel"||ii/R>A?(qe?(E.push(jt,Ut),E.push(M+Q*be,k+ie*be),E.push(jt,Ut),E.push(M+_e*be,k+ge*be)):(E.push(M-Q*pe,k-ie*pe),E.push(qt,lt),E.push(M-_e*pe,k-ge*pe),E.push(qt,lt)),w+=2):u.join==="round"?qe?(E.push(jt,Ut),E.push(M+Q*be,k+ie*be),w+=jr(M,k,M+Q*be,k+ie*be,M+_e*be,k+ge*be,E,!0)+4,E.push(jt,Ut),E.push(M+_e*be,k+ge*be)):(E.push(M-Q*pe,k-ie*pe),E.push(qt,lt),w+=jr(M,k,M-Q*pe,k-ie*pe,M-_e*pe,k-ge*pe,E,!1)+4,E.push(M-_e*pe,k-ge*pe),E.push(qt,lt)):(E.push(jt,Ut),E.push(qt,lt)):(E.push(M-Q*pe,k-ie*pe),E.push(M+Q*be,k+ie*be),u.join==="round"?qe?w+=jr(M,k,M+Q*be,k+ie*be,M+_e*be,k+ge*be,E,!0)+2:w+=jr(M,k,M-Q*pe,k-ie*pe,M-_e*pe,k-ge*pe,E,!1)+2:u.join==="miter"&&ii/R<=A&&(qe?(E.push(qt,lt),E.push(qt,lt)):(E.push(jt,Ut),E.push(jt,Ut)),w+=2),E.push(M-_e*pe,k-ge*pe),E.push(M+_e*be,k+ge*be),w+=2)}D=l[(v-2)*2],G=l[(v-2)*2+1],M=l[(v-1)*2],k=l[(v-1)*2+1],Q=-(G-k),ie=D-M,ue=Math.sqrt(Q*Q+ie*ie),Q/=ue,ie/=ue,Q*=C,ie*=C,E.push(M-Q*pe,k-ie*pe),E.push(M+Q*be,k+ie*be),_||(u.cap==="round"?w+=jr(M-Q*(pe-be)*.5,k-ie*(pe-be)*.5,M-Q*pe,k-ie*pe,M+Q*be,k+ie*be,E,!1)+2:u.cap==="square"&&(w+=my(M,k,Q,ie,pe,be,!1,E)));const he=gy*gy;for(let Ne=x;Ne<w+x-2;++Ne)D=E[Ne*2],G=E[Ne*2+1],M=E[(Ne+1)*2],k=E[(Ne+1)*2+1],z=E[(Ne+2)*2],se=E[(Ne+2)*2+1],!(Math.abs(D*(k-se)+M*(se-G)+z*(G-k))<he)&&a.push(Ne,Ne+1,Ne+2)}function zD(l,t,s,r){const o=xS;if(l.length===0)return;const a=l[0],h=l[1],u=l[l.length-2],p=l[l.length-1],f=t||Math.abs(a-u)<o&&Math.abs(h-p)<o,g=s,_=l.length/2,$=g.length/2;for(let E=0;E<_;E++)g.push(l[E*2]),g.push(l[E*2+1]);for(let E=0;E<_-1;E++)r.push($+E,$+E+1);f&&r.push($+_-1,$)}function CS(l,t,s,r,o,a,h){const u=VN(l,t,2);if(!u)return;for(let f=0;f<u.length;f+=3)a[h++]=u[f]+o,a[h++]=u[f+1]+o,a[h++]=u[f+2]+o;let p=o*r;for(let f=0;f<l.length;f+=2)s[p]=l[f],s[p+1]=l[f+1],p+=r}const XD=[],YD={extension:{type:V.ShapeBuilder,name:"polygon"},build(l,t){for(let s=0;s<l.points.length;s++)t[s]=l.points[s];return!0},triangulate(l,t,s,r,o,a){CS(l,XD,t,s,r,o,a)}},KD={extension:{type:V.ShapeBuilder,name:"rectangle"},build(l,t){const s=l,r=s.x,o=s.y,a=s.width,h=s.height;return a>0&&h>0?(t[0]=r,t[1]=o,t[2]=r+a,t[3]=o,t[4]=r+a,t[5]=o+h,t[6]=r,t[7]=o+h,!0):!1},triangulate(l,t,s,r,o,a){let h=0;r*=s,t[r+h]=l[0],t[r+h+1]=l[1],h+=s,t[r+h]=l[2],t[r+h+1]=l[3],h+=s,t[r+h]=l[6],t[r+h+1]=l[7],h+=s,t[r+h]=l[4],t[r+h+1]=l[5],h+=s;const u=r/s;o[a++]=u,o[a++]=u+1,o[a++]=u+2,o[a++]=u+1,o[a++]=u+3,o[a++]=u+2}},jD={extension:{type:V.ShapeBuilder,name:"triangle"},build(l,t){return t[0]=l.x,t[1]=l.y,t[2]=l.x2,t[3]=l.y2,t[4]=l.x3,t[5]=l.y3,!0},triangulate(l,t,s,r,o,a){let h=0;r*=s,t[r+h]=l[0],t[r+h+1]=l[1],h+=s,t[r+h]=l[2],t[r+h+1]=l[3],h+=s,t[r+h]=l[4],t[r+h+1]=l[5];const u=r/s;o[a++]=u,o[a++]=u+1,o[a++]=u+2}},qD=new Te,JD=new Fe;function ZD(l,t,s,r){const o=t.matrix?l.copyFrom(t.matrix).invert():l.identity();if(t.textureSpace==="local"){const h=s.getBounds(JD);t.width&&h.pad(t.width);const{x:u,y:p}=h,f=1/h.width,g=1/h.height,_=-u*f,$=-p*g,E=o.a,v=o.b,w=o.c,x=o.d;o.a*=f,o.b*=f,o.c*=g,o.d*=g,o.tx=_*E+$*w+o.tx,o.ty=_*v+$*x+o.ty}else o.translate(t.texture.frame.x,t.texture.frame.y),o.scale(1/t.texture.source.width,1/t.texture.source.height);const a=t.texture.source.style;return!(t.fill instanceof ji)&&a.addressMode==="clamp-to-edge"&&(a.addressMode="repeat",a.update()),r&&o.append(qD.copyFrom(r).invert()),o}const mh={};Se.handleByMap(V.ShapeBuilder,mh);Se.add(KD,YD,jD,Dl,GD,HD);const QD=new Fe,eB=new Te;function tB(l,t){const{geometryData:s,batches:r}=t;r.length=0,s.indices.length=0,s.vertices.length=0,s.uvs.length=0;for(let o=0;o<l.instructions.length;o++){const a=l.instructions[o];if(a.action==="texture")sB(a.data,r,s);else if(a.action==="fill"||a.action==="stroke"){const h=a.action==="stroke",u=a.data.path.shapePath,p=a.data.style,f=a.data.hole;h&&f&&_y(f.shapePath,p,!0,r,s),f&&(u.shapePrimitives[u.shapePrimitives.length-1].holes=f.shapePath.shapePrimitives),_y(u,p,h,r,s)}}}function sB(l,t,s){const r=[],o=mh.rectangle,a=QD;a.x=l.dx,a.y=l.dy,a.width=l.dw,a.height=l.dh;const h=l.transform;if(!o.build(a,r))return;const{vertices:u,uvs:p,indices:f}=s,g=f.length,_=u.length/2;h&&IS(r,h),o.triangulate(r,u,2,_,f,g);const $=l.image,E=$.uvs;p.push(E.x0,E.y0,E.x1,E.y1,E.x3,E.y3,E.x2,E.y2);const v=Pt.get(Ng);v.indexOffset=g,v.indexSize=f.length-g,v.attributeOffset=_,v.attributeSize=u.length/2-_,v.baseColor=l.style,v.alpha=l.alpha,v.texture=$,v.geometryData=s,t.push(v)}function _y(l,t,s,r,o){const{vertices:a,uvs:h,indices:u}=o;l.shapePrimitives.forEach(({shape:p,transform:f,holes:g})=>{const _=[],$=mh[p.type];if(!$.build(p,_))return;const E=u.length,v=a.length/2;let w="triangle-list";if(f&&IS(_,f),s){const A=p.closePath??!0,D=t;D.pixelLine?(zD(_,A,a,u),w="line-list"):WD(_,D,!1,A,a,u)}else if(g){const A=[],D=_.slice();iB(g).forEach(M=>{A.push(D.length/2),D.push(...M)}),CS(D,A,a,2,v,u,E)}else $.triangulate(_,a,2,v,u,E);const x=h.length/2,C=t.texture;if(C!==me.WHITE){const A=ZD(eB,t,p,f);BD(a,2,v,h,x,2,a.length/2-v,A)}else FD(h,x,2,a.length/2-v);const R=Pt.get(Ng);R.indexOffset=E,R.indexSize=u.length-E,R.attributeOffset=v,R.attributeSize=a.length/2-v,R.baseColor=t.color,R.alpha=t.alpha,R.texture=C,R.geometryData=o,R.topology=w,r.push(R)})}function iB(l){const t=[];for(let s=0;s<l.length;s++){const r=l[s].shape,o=[];mh[r.type].build(r,o)&&t.push(o)}return t}class rB{constructor(){this.batches=[],this.geometryData={vertices:[],uvs:[],indices:[]}}}class nB{constructor(){this.instructions=new Ov}init(t){this.batcher=new Pg({maxTextures:t}),this.instructions.reset()}get geometry(){return ke(oP,"GraphicsContextRenderData#geometry is deprecated, please use batcher.geometry instead."),this.batcher.geometry}}const Dg=class ig{constructor(t){this._gpuContextHash={},this._graphicsDataContextHash=Object.create(null),this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuContextHash"),t.renderableGC.addManagedHash(this,"_graphicsDataContextHash")}init(t){ig.defaultOptions.bezierSmoothness=(t==null?void 0:t.bezierSmoothness)??ig.defaultOptions.bezierSmoothness}getContextRenderData(t){return this._graphicsDataContextHash[t.uid]||this._initContextRenderData(t)}updateGpuContext(t){let s=this._gpuContextHash[t.uid]||this._initContext(t);if(t.dirty){s?this._cleanGraphicsContextData(t):s=this._initContext(t),tB(t,s);const r=t.batchMode;t.customShader||r==="no-batch"?s.isBatchable=!1:r==="auto"?s.isBatchable=s.geometryData.vertices.length<400:s.isBatchable=!0,t.dirty=!1}return s}getGpuContext(t){return this._gpuContextHash[t.uid]||this._initContext(t)}_initContextRenderData(t){const s=Pt.get(nB,{maxTextures:this._renderer.limits.maxBatchableTextures}),{batches:r,geometryData:o}=this._gpuContextHash[t.uid],a=o.vertices.length,h=o.indices.length;for(let g=0;g<r.length;g++)r[g].applyTransform=!1;const u=s.batcher;u.ensureAttributeBuffer(a),u.ensureIndexBuffer(h),u.begin();for(let g=0;g<r.length;g++){const _=r[g];u.add(_)}u.finish(s.instructions);const p=u.geometry;p.indexBuffer.setDataWithSize(u.indexBuffer,u.indexSize,!0),p.buffers[0].setDataWithSize(u.attributeBuffer.float32View,u.attributeSize,!0);const f=u.batches;for(let g=0;g<f.length;g++){const _=f[g];_.bindGroup=Rg(_.textures.textures,_.textures.count,this._renderer.limits.maxBatchableTextures)}return this._graphicsDataContextHash[t.uid]=s,s}_initContext(t){const s=new rB;return s.context=t,this._gpuContextHash[t.uid]=s,t.on("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]}onGraphicsContextDestroy(t){this._cleanGraphicsContextData(t),t.off("destroy",this.onGraphicsContextDestroy,this),this._gpuContextHash[t.uid]=null}_cleanGraphicsContextData(t){const s=this._gpuContextHash[t.uid];s.isBatchable||this._graphicsDataContextHash[t.uid]&&(Pt.return(this.getContextRenderData(t)),this._graphicsDataContextHash[t.uid]=null),s.batches&&s.batches.forEach(r=>{Pt.return(r)})}destroy(){for(const t in this._gpuContextHash)this._gpuContextHash[t]&&this.onGraphicsContextDestroy(this._gpuContextHash[t].context)}};Dg.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"graphicsContext"};Dg.defaultOptions={bezierSmoothness:.5};let Bg=Dg;const oB=8,Hc=11920929e-14,lB=1;function wS(l,t,s,r,o,a,h,u,p,f){const _=Math.min(.99,Math.max(0,f??Bg.defaultOptions.bezierSmoothness));let $=(lB-_)/1;return $*=$,aB(t,s,r,o,a,h,u,p,l,$),l}function aB(l,t,s,r,o,a,h,u,p,f){rg(l,t,s,r,o,a,h,u,p,f,0),p.push(h,u)}function rg(l,t,s,r,o,a,h,u,p,f,g){if(g>oB)return;const _=(l+s)/2,$=(t+r)/2,E=(s+o)/2,v=(r+a)/2,w=(o+h)/2,x=(a+u)/2,C=(_+E)/2,R=($+v)/2,A=(E+w)/2,D=(v+x)/2,G=(C+A)/2,M=(R+D)/2;if(g>0){let k=h-l,z=u-t;const se=Math.abs((s-h)*z-(r-u)*k),Q=Math.abs((o-h)*z-(a-u)*k);if(se>Hc&&Q>Hc){if((se+Q)*(se+Q)<=f*(k*k+z*z)){p.push(G,M);return}}else if(se>Hc){if(se*se<=f*(k*k+z*z)){p.push(G,M);return}}else if(Q>Hc){if(Q*Q<=f*(k*k+z*z)){p.push(G,M);return}}else if(k=G-(l+h)/2,z=M-(t+u)/2,k*k+z*z<=f){p.push(G,M);return}}rg(l,t,_,$,C,R,G,M,p,f,g+1),rg(G,M,A,D,w,x,h,u,p,f,g+1)}const cB=8,hB=11920929e-14,uB=1;function dB(l,t,s,r,o,a,h,u){const f=Math.min(.99,Math.max(0,u??Bg.defaultOptions.bezierSmoothness));let g=(uB-f)/1;return g*=g,pB(t,s,r,o,a,h,l,g),l}function pB(l,t,s,r,o,a,h,u){ng(h,l,t,s,r,o,a,u,0),h.push(o,a)}function ng(l,t,s,r,o,a,h,u,p){if(p>cB)return;const f=(t+r)/2,g=(s+o)/2,_=(r+a)/2,$=(o+h)/2,E=(f+_)/2,v=(g+$)/2;let w=a-t,x=h-s;const C=Math.abs((r-a)*x-(o-h)*w);if(C>hB){if(C*C<=u*(w*w+x*x)){l.push(E,v);return}}else if(w=E-(t+a)/2,x=v-(s+h)/2,w*w+x*x<=u){l.push(E,v);return}ng(l,t,s,f,g,E,v,u,p+1),ng(l,E,v,_,$,a,h,u,p+1)}function RS(l,t,s,r,o,a,h,u){let p=Math.abs(o-a);(!h&&o>a||h&&a>o)&&(p=2*Math.PI-p),u||(u=Math.max(6,Math.floor(6*Math.pow(r,1/3)*(p/Math.PI)))),u=Math.max(u,3);let f=p/u,g=o;f*=h?-1:1;for(let _=0;_<u+1;_++){const $=Math.cos(g),E=Math.sin(g),v=t+$*r,w=s+E*r;l.push(v,w),g+=f}}function fB(l,t,s,r,o,a){const h=l[l.length-2],p=l[l.length-1]-s,f=h-t,g=o-s,_=r-t,$=Math.abs(p*_-f*g);if($<1e-8||a===0){(l[l.length-2]!==t||l[l.length-1]!==s)&&l.push(t,s);return}const E=p*p+f*f,v=g*g+_*_,w=p*g+f*_,x=a*Math.sqrt(E)/$,C=a*Math.sqrt(v)/$,R=x*w/E,A=C*w/v,D=x*_+C*f,G=x*g+C*p,M=f*(C+R),k=p*(C+R),z=_*(x+A),se=g*(x+A),Q=Math.atan2(k-G,M-D),ie=Math.atan2(se-G,z-D);RS(l,D+t,G+s,a,Q,ie,f*g>_*p)}const Il=Math.PI*2,kf={centerX:0,centerY:0,ang1:0,ang2:0},Of=({x:l,y:t},s,r,o,a,h,u,p)=>{l*=s,t*=r;const f=o*l-a*t,g=a*l+o*t;return p.x=f+h,p.y=g+u,p};function gB(l,t){const s=t===-1.5707963267948966?-.551915024494:1.3333333333333333*Math.tan(t/4),r=t===1.5707963267948966?.551915024494:s,o=Math.cos(l),a=Math.sin(l),h=Math.cos(l+t),u=Math.sin(l+t);return[{x:o-a*r,y:a+o*r},{x:h+u*r,y:u-h*r},{x:h,y:u}]}const $y=(l,t,s,r)=>{const o=l*r-t*s<0?-1:1;let a=l*s+t*r;return a>1&&(a=1),a<-1&&(a=-1),o*Math.acos(a)},mB=(l,t,s,r,o,a,h,u,p,f,g,_,$)=>{const E=Math.pow(o,2),v=Math.pow(a,2),w=Math.pow(g,2),x=Math.pow(_,2);let C=E*v-E*x-v*w;C<0&&(C=0),C/=E*x+v*w,C=Math.sqrt(C)*(h===u?-1:1);const R=C*o/a*_,A=C*-a/o*g,D=f*R-p*A+(l+s)/2,G=p*R+f*A+(t+r)/2,M=(g-R)/o,k=(_-A)/a,z=(-g-R)/o,se=(-_-A)/a,Q=$y(1,0,M,k);let ie=$y(M,k,z,se);u===0&&ie>0&&(ie-=Il),u===1&&ie<0&&(ie+=Il),$.centerX=D,$.centerY=G,$.ang1=Q,$.ang2=ie};function _B(l,t,s,r,o,a,h,u=0,p=0,f=0){if(a===0||h===0)return;const g=Math.sin(u*Il/360),_=Math.cos(u*Il/360),$=_*(t-r)/2+g*(s-o)/2,E=-g*(t-r)/2+_*(s-o)/2;if($===0&&E===0)return;a=Math.abs(a),h=Math.abs(h);const v=Math.pow($,2)/Math.pow(a,2)+Math.pow(E,2)/Math.pow(h,2);v>1&&(a*=Math.sqrt(v),h*=Math.sqrt(v)),mB(t,s,r,o,a,h,p,f,g,_,$,E,kf);let{ang1:w,ang2:x}=kf;const{centerX:C,centerY:R}=kf;let A=Math.abs(x)/(Il/4);Math.abs(1-A)<1e-7&&(A=1);const D=Math.max(Math.ceil(A),1);x/=D;let G=l[l.length-2],M=l[l.length-1];const k={x:0,y:0};for(let z=0;z<D;z++){const se=gB(w,x),{x:Q,y:ie}=Of(se[0],a,h,_,g,C,R,k),{x:_e,y:ge}=Of(se[1],a,h,_,g,C,R,k),{x:ue,y:St}=Of(se[2],a,h,_,g,C,R,k);wS(l,G,M,Q,ie,_e,ge,ue,St),G=ue,M=St,w+=x}}function $B(l,t,s){const r=(h,u)=>{const p=u.x-h.x,f=u.y-h.y,g=Math.sqrt(p*p+f*f),_=p/g,$=f/g;return{len:g,nx:_,ny:$}},o=(h,u)=>{h===0?l.moveTo(u.x,u.y):l.lineTo(u.x,u.y)};let a=t[t.length-1];for(let h=0;h<t.length;h++){const u=t[h%t.length],p=u.radius??s;if(p<=0){o(h,u),a=u;continue}const f=t[(h+1)%t.length],g=r(u,a),_=r(u,f);if(g.len<1e-4||_.len<1e-4){o(h,u),a=u;continue}let $=Math.asin(g.nx*_.ny-g.ny*_.nx),E=1,v=!1;g.nx*_.nx-g.ny*-_.ny<0?$<0?$=Math.PI+$:($=Math.PI-$,E=-1,v=!0):$>0&&(E=-1,v=!0);const w=$/2;let x,C=Math.abs(Math.cos(w)*p/Math.sin(w));C>Math.min(g.len/2,_.len/2)?(C=Math.min(g.len/2,_.len/2),x=Math.abs(C*Math.sin(w)/Math.cos(w))):x=p;const R=u.x+_.nx*C+-_.ny*x*E,A=u.y+_.ny*C+_.nx*x*E,D=Math.atan2(g.ny,g.nx)+Math.PI/2*E,G=Math.atan2(_.ny,_.nx)-Math.PI/2*E;h===0&&l.moveTo(R+Math.cos(D)*x,A+Math.sin(D)*x),l.arc(R,A,x,D,G,v),a=u}}function TB(l,t,s,r){const o=(u,p)=>Math.sqrt((u.x-p.x)**2+(u.y-p.y)**2),a=(u,p,f)=>({x:u.x+(p.x-u.x)*f,y:u.y+(p.y-u.y)*f}),h=t.length;for(let u=0;u<h;u++){const p=t[(u+1)%h],f=p.radius??s;if(f<=0){u===0?l.moveTo(p.x,p.y):l.lineTo(p.x,p.y);continue}const g=t[u],_=t[(u+2)%h],$=o(g,p);let E;if($<1e-4)E=p;else{const x=Math.min($/2,f);E=a(p,g,x/$)}const v=o(_,p);let w;if(v<1e-4)w=p;else{const x=Math.min(v/2,f);w=a(p,_,x/v)}u===0?l.moveTo(E.x,E.y):l.lineTo(E.x,E.y),l.quadraticCurveTo(p.x,p.y,w.x,w.y,r)}}const bB=new Fe;class EB{constructor(t){this.shapePrimitives=[],this._currentPoly=null,this._bounds=new Yt,this._graphicsPath2D=t,this.signed=t.checkForHoles}moveTo(t,s){return this.startPoly(t,s),this}lineTo(t,s){this._ensurePoly();const r=this._currentPoly.points,o=r[r.length-2],a=r[r.length-1];return(o!==t||a!==s)&&r.push(t,s),this}arc(t,s,r,o,a,h){this._ensurePoly(!1);const u=this._currentPoly.points;return RS(u,t,s,r,o,a,h),this}arcTo(t,s,r,o,a){this._ensurePoly();const h=this._currentPoly.points;return fB(h,t,s,r,o,a),this}arcToSvg(t,s,r,o,a,h,u){const p=this._currentPoly.points;return _B(p,this._currentPoly.lastX,this._currentPoly.lastY,h,u,t,s,r,o,a),this}bezierCurveTo(t,s,r,o,a,h,u){this._ensurePoly();const p=this._currentPoly;return wS(this._currentPoly.points,p.lastX,p.lastY,t,s,r,o,a,h,u),this}quadraticCurveTo(t,s,r,o,a){this._ensurePoly();const h=this._currentPoly;return dB(this._currentPoly.points,h.lastX,h.lastY,t,s,r,o,a),this}closePath(){return this.endPoly(!0),this}addPath(t,s){this.endPoly(),s&&!s.isIdentity()&&(t=t.clone(!0),t.transform(s));const r=this.shapePrimitives,o=r.length;for(let a=0;a<t.instructions.length;a++){const h=t.instructions[a];this[h.action](...h.data)}if(t.checkForHoles&&r.length-o>1){let a=null;for(let h=o;h<r.length;h++){const u=r[h];if(u.shape.type==="polygon"){const p=u.shape,f=a==null?void 0:a.shape;f&&f.containsPolygon(p)?(a.holes||(a.holes=[]),a.holes.push(u),r.copyWithin(h,h+1),r.length--,h--):a=u}}}return this}finish(t=!1){this.endPoly(t)}rect(t,s,r,o,a){return this.drawShape(new Fe(t,s,r,o),a),this}circle(t,s,r,o){return this.drawShape(new xg(t,s,r),o),this}poly(t,s,r){const o=new Sl(t);return o.closePath=s,this.drawShape(o,r),this}regularPoly(t,s,r,o,a=0,h){o=Math.max(o|0,3);const u=-1*Math.PI/2+a,p=Math.PI*2/o,f=[];for(let g=0;g<o;g++){const _=u-g*p;f.push(t+r*Math.cos(_),s+r*Math.sin(_))}return this.poly(f,!0,h),this}roundPoly(t,s,r,o,a,h=0,u){if(o=Math.max(o|0,3),a<=0)return this.regularPoly(t,s,r,o,h);const p=r*Math.sin(Math.PI/o)-.001;a=Math.min(a,p);const f=-1*Math.PI/2+h,g=Math.PI*2/o,_=(o-2)*Math.PI/o/2;for(let $=0;$<o;$++){const E=$*g+f,v=t+r*Math.cos(E),w=s+r*Math.sin(E),x=E+Math.PI+_,C=E-Math.PI-_,R=v+a*Math.cos(x),A=w+a*Math.sin(x),D=v+a*Math.cos(C),G=w+a*Math.sin(C);$===0?this.moveTo(R,A):this.lineTo(R,A),this.quadraticCurveTo(v,w,D,G,u)}return this.closePath()}roundShape(t,s,r=!1,o){return t.length<3?this:(r?TB(this,t,s,o):$B(this,t,s),this.closePath())}filletRect(t,s,r,o,a){if(a===0)return this.rect(t,s,r,o);const h=Math.min(r,o)/2,u=Math.min(h,Math.max(-h,a)),p=t+r,f=s+o,g=u<0?-u:0,_=Math.abs(u);return this.moveTo(t,s+_).arcTo(t+g,s+g,t+_,s,_).lineTo(p-_,s).arcTo(p-g,s+g,p,s+_,_).lineTo(p,f-_).arcTo(p-g,f-g,t+r-_,f,_).lineTo(t+_,f).arcTo(t+g,f-g,t,f-_,_).closePath()}chamferRect(t,s,r,o,a,h){if(a<=0)return this.rect(t,s,r,o);const u=Math.min(a,Math.min(r,o)/2),p=t+r,f=s+o,g=[t+u,s,p-u,s,p,s+u,p,f-u,p-u,f,t+u,f,t,f-u,t,s+u];for(let _=g.length-1;_>=2;_-=2)g[_]===g[_-2]&&g[_-1]===g[_-3]&&g.splice(_-1,2);return this.poly(g,!0,h)}ellipse(t,s,r,o,a){return this.drawShape(new Cg(t,s,r,o),a),this}roundRect(t,s,r,o,a,h){return this.drawShape(new wg(t,s,r,o,a),h),this}drawShape(t,s){return this.endPoly(),this.shapePrimitives.push({shape:t,transform:s}),this}startPoly(t,s){let r=this._currentPoly;return r&&this.endPoly(),r=new Sl,r.points.push(t,s),this._currentPoly=r,this}endPoly(t=!1){const s=this._currentPoly;return s&&s.points.length>2&&(s.closePath=t,this.shapePrimitives.push({shape:s})),this._currentPoly=null,this}_ensurePoly(t=!0){if(!this._currentPoly&&(this._currentPoly=new Sl,t)){const s=this.shapePrimitives[this.shapePrimitives.length-1];if(s){let r=s.shape.x,o=s.shape.y;if(s.transform&&!s.transform.isIdentity()){const a=s.transform,h=r;r=a.a*r+a.c*o+a.tx,o=a.b*h+a.d*o+a.ty}this._currentPoly.points.push(r,o)}else this._currentPoly.points.push(0,0)}}buildPath(){const t=this._graphicsPath2D;this.shapePrimitives.length=0,this._currentPoly=null;for(let s=0;s<t.instructions.length;s++){const r=t.instructions[s];this[r.action](...r.data)}this.finish()}get bounds(){const t=this._bounds;t.clear();const s=this.shapePrimitives;for(let r=0;r<s.length;r++){const o=s[r],a=o.shape.getBounds(bB);o.transform?t.addRect(a,o.transform):t.addRect(a)}return t}}class lo{constructor(t,s=!1){this.instructions=[],this.uid=st("graphicsPath"),this._dirty=!0,this.checkForHoles=s,typeof t=="string"?iD(t,this):this.instructions=(t==null?void 0:t.slice())??[]}get shapePath(){return this._shapePath||(this._shapePath=new EB(this)),this._dirty&&(this._dirty=!1,this._shapePath.buildPath()),this._shapePath}addPath(t,s){return t=t.clone(),this.instructions.push({action:"addPath",data:[t,s]}),this._dirty=!0,this}arc(...t){return this.instructions.push({action:"arc",data:t}),this._dirty=!0,this}arcTo(...t){return this.instructions.push({action:"arcTo",data:t}),this._dirty=!0,this}arcToSvg(...t){return this.instructions.push({action:"arcToSvg",data:t}),this._dirty=!0,this}bezierCurveTo(...t){return this.instructions.push({action:"bezierCurveTo",data:t}),this._dirty=!0,this}bezierCurveToShort(t,s,r,o,a){const h=this.instructions[this.instructions.length-1],u=this.getLastPoint(ve.shared);let p=0,f=0;if(!h||h.action!=="bezierCurveTo")p=u.x,f=u.y;else{p=h.data[2],f=h.data[3];const g=u.x,_=u.y;p=g+(g-p),f=_+(_-f)}return this.instructions.push({action:"bezierCurveTo",data:[p,f,t,s,r,o,a]}),this._dirty=!0,this}closePath(){return this.instructions.push({action:"closePath",data:[]}),this._dirty=!0,this}ellipse(...t){return this.instructions.push({action:"ellipse",data:t}),this._dirty=!0,this}lineTo(...t){return this.instructions.push({action:"lineTo",data:t}),this._dirty=!0,this}moveTo(...t){return this.instructions.push({action:"moveTo",data:t}),this}quadraticCurveTo(...t){return this.instructions.push({action:"quadraticCurveTo",data:t}),this._dirty=!0,this}quadraticCurveToShort(t,s,r){const o=this.instructions[this.instructions.length-1],a=this.getLastPoint(ve.shared);let h=0,u=0;if(!o||o.action!=="quadraticCurveTo")h=a.x,u=a.y;else{h=o.data[0],u=o.data[1];const p=a.x,f=a.y;h=p+(p-h),u=f+(f-u)}return this.instructions.push({action:"quadraticCurveTo",data:[h,u,t,s,r]}),this._dirty=!0,this}rect(t,s,r,o,a){return this.instructions.push({action:"rect",data:[t,s,r,o,a]}),this._dirty=!0,this}circle(t,s,r,o){return this.instructions.push({action:"circle",data:[t,s,r,o]}),this._dirty=!0,this}roundRect(...t){return this.instructions.push({action:"roundRect",data:t}),this._dirty=!0,this}poly(...t){return this.instructions.push({action:"poly",data:t}),this._dirty=!0,this}regularPoly(...t){return this.instructions.push({action:"regularPoly",data:t}),this._dirty=!0,this}roundPoly(...t){return this.instructions.push({action:"roundPoly",data:t}),this._dirty=!0,this}roundShape(...t){return this.instructions.push({action:"roundShape",data:t}),this._dirty=!0,this}filletRect(...t){return this.instructions.push({action:"filletRect",data:t}),this._dirty=!0,this}chamferRect(...t){return this.instructions.push({action:"chamferRect",data:t}),this._dirty=!0,this}star(t,s,r,o,a,h,u){a||(a=o/2);const p=-1*Math.PI/2+h,f=r*2,g=Math.PI*2/f,_=[];for(let $=0;$<f;$++){const E=$%2?a:o,v=$*g+p;_.push(t+E*Math.cos(v),s+E*Math.sin(v))}return this.poly(_,!0,u),this}clone(t=!1){const s=new lo;if(s.checkForHoles=this.checkForHoles,!t)s.instructions=this.instructions.slice();else for(let r=0;r<this.instructions.length;r++){const o=this.instructions[r];s.instructions.push({action:o.action,data:o.data.slice()})}return s}clear(){return this.instructions.length=0,this._dirty=!0,this}transform(t){if(t.isIdentity())return this;const s=t.a,r=t.b,o=t.c,a=t.d,h=t.tx,u=t.ty;let p=0,f=0,g=0,_=0,$=0,E=0,v=0,w=0;for(let x=0;x<this.instructions.length;x++){const C=this.instructions[x],R=C.data;switch(C.action){case"moveTo":case"lineTo":p=R[0],f=R[1],R[0]=s*p+o*f+h,R[1]=r*p+a*f+u;break;case"bezierCurveTo":g=R[0],_=R[1],$=R[2],E=R[3],p=R[4],f=R[5],R[0]=s*g+o*_+h,R[1]=r*g+a*_+u,R[2]=s*$+o*E+h,R[3]=r*$+a*E+u,R[4]=s*p+o*f+h,R[5]=r*p+a*f+u;break;case"quadraticCurveTo":g=R[0],_=R[1],p=R[2],f=R[3],R[0]=s*g+o*_+h,R[1]=r*g+a*_+u,R[2]=s*p+o*f+h,R[3]=r*p+a*f+u;break;case"arcToSvg":p=R[5],f=R[6],v=R[0],w=R[1],R[0]=s*v+o*w,R[1]=r*v+a*w,R[5]=s*p+o*f+h,R[6]=r*p+a*f+u;break;case"circle":R[4]=dl(R[3],t);break;case"rect":R[4]=dl(R[4],t);break;case"ellipse":R[8]=dl(R[8],t);break;case"roundRect":R[5]=dl(R[5],t);break;case"addPath":R[0].transform(t);break;case"poly":R[2]=dl(R[2],t);break;default:we("unknown transform action",C.action);break}}return this._dirty=!0,this}get bounds(){return this.shapePath.bounds}getLastPoint(t){let s=this.instructions.length-1,r=this.instructions[s];if(!r)return t.x=0,t.y=0,t;for(;r.action==="closePath";){if(s--,s<0)return t.x=0,t.y=0,t;r=this.instructions[s]}switch(r.action){case"moveTo":case"lineTo":t.x=r.data[0],t.y=r.data[1];break;case"quadraticCurveTo":t.x=r.data[2],t.y=r.data[3];break;case"bezierCurveTo":t.x=r.data[4],t.y=r.data[5];break;case"arc":case"arcToSvg":t.x=r.data[5],t.y=r.data[6];break;case"addPath":r.data[0].getLastPoint(t);break}return t}}function dl(l,t){return l?l.prepend(t):t.clone()}function dt(l,t,s){const r=l.getAttribute(t);return r?Number(r):s}function yB(l,t){const s=l.querySelectorAll("defs");for(let r=0;r<s.length;r++){const o=s[r];for(let a=0;a<o.children.length;a++){const h=o.children[a];switch(h.nodeName.toLowerCase()){case"lineargradient":t.defs[h.id]=vB(h);break;case"radialgradient":t.defs[h.id]=SB();break}}}}function vB(l){const t=dt(l,"x1",0),s=dt(l,"y1",0),r=dt(l,"x2",1),o=dt(l,"y2",0),a=l.getAttribute("gradientUnits")||"objectBoundingBox",h=new ji(t,s,r,o,a==="objectBoundingBox"?"local":"global");for(let u=0;u<l.children.length;u++){const p=l.children[u],f=dt(p,"offset",0),g=We.shared.setValue(p.getAttribute("stop-color")).toNumber();h.addColorStop(f,g)}return h}function SB(l){return we("[SVG Parser] Radial gradients are not yet supported"),new ji(0,0,1,0)}function Ty(l){const t=l.match(/url\s*\(\s*['"]?\s*#([^'"\s)]+)\s*['"]?\s*\)/i);return t?t[1]:""}const by={fill:{type:"paint",default:0},"fill-opacity":{type:"number",default:1},stroke:{type:"paint",default:0},"stroke-width":{type:"number",default:1},"stroke-opacity":{type:"number",default:1},"stroke-linecap":{type:"string",default:"butt"},"stroke-linejoin":{type:"string",default:"miter"},"stroke-miterlimit":{type:"number",default:10},"stroke-dasharray":{type:"string",default:"none"},"stroke-dashoffset":{type:"number",default:0},opacity:{type:"number",default:1}};function kS(l,t){const s=l.getAttribute("style"),r={},o={},a={strokeStyle:r,fillStyle:o,useFill:!1,useStroke:!1};for(const h in by){const u=l.getAttribute(h);u&&Ey(t,a,h,u.trim())}if(s){const h=s.split(";");for(let u=0;u<h.length;u++){const p=h[u].trim(),[f,g]=p.split(":");by[f]&&Ey(t,a,f,g.trim())}}return{strokeStyle:a.useStroke?r:null,fillStyle:a.useFill?o:null,useFill:a.useFill,useStroke:a.useStroke}}function Ey(l,t,s,r){switch(s){case"stroke":if(r!=="none"){if(r.startsWith("url(")){const o=Ty(r);t.strokeStyle.fill=l.defs[o]}else t.strokeStyle.color=We.shared.setValue(r).toNumber();t.useStroke=!0}break;case"stroke-width":t.strokeStyle.width=Number(r);break;case"fill":if(r!=="none"){if(r.startsWith("url(")){const o=Ty(r);t.fillStyle.fill=l.defs[o]}else t.fillStyle.color=We.shared.setValue(r).toNumber();t.useFill=!0}break;case"fill-opacity":t.fillStyle.alpha=Number(r);break;case"stroke-opacity":t.strokeStyle.alpha=Number(r);break;case"opacity":t.fillStyle.alpha=Number(r),t.strokeStyle.alpha=Number(r);break}}function IB(l,t){if(typeof l=="string"){const h=document.createElement("div");h.innerHTML=l.trim(),l=h.querySelector("svg")}const s={context:t,defs:{},path:new lo};yB(l,s);const r=l.children,{fillStyle:o,strokeStyle:a}=kS(l,s);for(let h=0;h<r.length;h++){const u=r[h];u.nodeName.toLowerCase()!=="defs"&&OS(u,s,o,a)}return t}function OS(l,t,s,r){const o=l.children,{fillStyle:a,strokeStyle:h}=kS(l,t);a&&s?s={...s,...a}:a&&(s=a),h&&r?r={...r,...h}:h&&(r=h);const u=!s&&!r;u&&(s={color:0});let p,f,g,_,$,E,v,w,x,C,R,A,D,G,M,k,z;switch(l.nodeName.toLowerCase()){case"path":G=l.getAttribute("d"),l.getAttribute("fill-rule")==="evenodd"&&we("SVG Evenodd fill rule not supported, your svg may render incorrectly"),M=new lo(G,!0),t.context.path(M),s&&t.context.fill(s),r&&t.context.stroke(r);break;case"circle":v=dt(l,"cx",0),w=dt(l,"cy",0),x=dt(l,"r",0),t.context.ellipse(v,w,x,x),s&&t.context.fill(s),r&&t.context.stroke(r);break;case"rect":p=dt(l,"x",0),f=dt(l,"y",0),k=dt(l,"width",0),z=dt(l,"height",0),C=dt(l,"rx",0),R=dt(l,"ry",0),C||R?t.context.roundRect(p,f,k,z,C||R):t.context.rect(p,f,k,z),s&&t.context.fill(s),r&&t.context.stroke(r);break;case"ellipse":v=dt(l,"cx",0),w=dt(l,"cy",0),C=dt(l,"rx",0),R=dt(l,"ry",0),t.context.beginPath(),t.context.ellipse(v,w,C,R),s&&t.context.fill(s),r&&t.context.stroke(r);break;case"line":g=dt(l,"x1",0),_=dt(l,"y1",0),$=dt(l,"x2",0),E=dt(l,"y2",0),t.context.beginPath(),t.context.moveTo(g,_),t.context.lineTo($,E),r&&t.context.stroke(r);break;case"polygon":D=l.getAttribute("points"),A=D.match(/\d+/g).map(se=>parseInt(se,10)),t.context.poly(A,!0),s&&t.context.fill(s),r&&t.context.stroke(r);break;case"polyline":D=l.getAttribute("points"),A=D.match(/\d+/g).map(se=>parseInt(se,10)),t.context.poly(A,!1),r&&t.context.stroke(r);break;case"g":case"svg":break;default:{we(`[SVG parser] <${l.nodeName}> elements unsupported`);break}}u&&(s=null);for(let se=0;se<o.length;se++)OS(o[se],t,s,r)}function xB(l){return We.isColorLike(l)}function yy(l){return l instanceof gh}function vy(l){return l instanceof ji}function CB(l){return l instanceof me}function wB(l,t,s){const r=We.shared.setValue(t??0);return l.color=r.toNumber(),l.alpha=r.alpha===1?s.alpha:r.alpha,l.texture=me.WHITE,{...s,...l}}function RB(l,t,s){return l.texture=t,{...s,...l}}function Sy(l,t,s){return l.fill=t,l.color=16777215,l.texture=t.texture,l.matrix=t.transform,{...s,...l}}function Iy(l,t,s){return t.buildGradient(),l.fill=t,l.color=16777215,l.texture=t.texture,l.matrix=t.transform,l.textureSpace=t.textureSpace,{...s,...l}}function kB(l,t){const s={...t,...l},r=We.shared.setValue(s.color);return s.alpha*=r.alpha,s.color=r.toNumber(),s}function sn(l,t){if(l==null)return null;const s={},r=l;return xB(l)?wB(s,l,t):CB(l)?RB(s,l,t):yy(l)?Sy(s,l,t):vy(l)?Iy(s,l,t):r.fill&&yy(r.fill)?Sy(r,r.fill,t):r.fill&&vy(r.fill)?Iy(r,r.fill,t):kB(r,t)}function lh(l,t){const{width:s,alignment:r,miterLimit:o,cap:a,join:h,pixelLine:u,...p}=t,f=sn(l,p);return f?{width:s,alignment:r,miterLimit:o,cap:a,join:h,pixelLine:u,...f}:null}const OB=new ve,xy=new Te,Fg=class Ti extends Is{constructor(){super(...arguments),this.uid=st("graphicsContext"),this.dirty=!0,this.batchMode="auto",this.instructions=[],this._activePath=new lo,this._transform=new Te,this._fillStyle={...Ti.defaultFillStyle},this._strokeStyle={...Ti.defaultStrokeStyle},this._stateStack=[],this._tick=0,this._bounds=new Yt,this._boundsDirty=!0}clone(){const t=new Ti;return t.batchMode=this.batchMode,t.instructions=this.instructions.slice(),t._activePath=this._activePath.clone(),t._transform=this._transform.clone(),t._fillStyle={...this._fillStyle},t._strokeStyle={...this._strokeStyle},t._stateStack=this._stateStack.slice(),t._bounds=this._bounds.clone(),t._boundsDirty=!0,t}get fillStyle(){return this._fillStyle}set fillStyle(t){this._fillStyle=sn(t,Ti.defaultFillStyle)}get strokeStyle(){return this._strokeStyle}set strokeStyle(t){this._strokeStyle=lh(t,Ti.defaultStrokeStyle)}setFillStyle(t){return this._fillStyle=sn(t,Ti.defaultFillStyle),this}setStrokeStyle(t){return this._strokeStyle=sn(t,Ti.defaultStrokeStyle),this}texture(t,s,r,o,a,h){return this.instructions.push({action:"texture",data:{image:t,dx:r||0,dy:o||0,dw:a||t.frame.width,dh:h||t.frame.height,transform:this._transform.clone(),alpha:this._fillStyle.alpha,style:s?We.shared.setValue(s).toNumber():16777215}}),this.onUpdate(),this}beginPath(){return this._activePath=new lo,this}fill(t,s){let r;const o=this.instructions[this.instructions.length-1];return this._tick===0&&o&&o.action==="stroke"?r=o.data.path:r=this._activePath.clone(),r?(t!=null&&(s!==void 0&&typeof t=="number"&&(ke(He,"GraphicsContext.fill(color, alpha) is deprecated, use GraphicsContext.fill({ color, alpha }) instead"),t={color:t,alpha:s}),this._fillStyle=sn(t,Ti.defaultFillStyle)),this.instructions.push({action:"fill",data:{style:this.fillStyle,path:r}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}_initNextPathLocation(){const{x:t,y:s}=this._activePath.getLastPoint(ve.shared);this._activePath.clear(),this._activePath.moveTo(t,s)}stroke(t){let s;const r=this.instructions[this.instructions.length-1];return this._tick===0&&r&&r.action==="fill"?s=r.data.path:s=this._activePath.clone(),s?(t!=null&&(this._strokeStyle=lh(t,Ti.defaultStrokeStyle)),this.instructions.push({action:"stroke",data:{style:this.strokeStyle,path:s}}),this.onUpdate(),this._initNextPathLocation(),this._tick=0,this):this}cut(){for(let t=0;t<2;t++){const s=this.instructions[this.instructions.length-1-t],r=this._activePath.clone();if(s&&(s.action==="stroke"||s.action==="fill"))if(s.data.hole)s.data.hole.addPath(r);else{s.data.hole=r;break}}return this._initNextPathLocation(),this}arc(t,s,r,o,a,h){this._tick++;const u=this._transform;return this._activePath.arc(u.a*t+u.c*s+u.tx,u.b*t+u.d*s+u.ty,r,o,a,h),this}arcTo(t,s,r,o,a){this._tick++;const h=this._transform;return this._activePath.arcTo(h.a*t+h.c*s+h.tx,h.b*t+h.d*s+h.ty,h.a*r+h.c*o+h.tx,h.b*r+h.d*o+h.ty,a),this}arcToSvg(t,s,r,o,a,h,u){this._tick++;const p=this._transform;return this._activePath.arcToSvg(t,s,r,o,a,p.a*h+p.c*u+p.tx,p.b*h+p.d*u+p.ty),this}bezierCurveTo(t,s,r,o,a,h,u){this._tick++;const p=this._transform;return this._activePath.bezierCurveTo(p.a*t+p.c*s+p.tx,p.b*t+p.d*s+p.ty,p.a*r+p.c*o+p.tx,p.b*r+p.d*o+p.ty,p.a*a+p.c*h+p.tx,p.b*a+p.d*h+p.ty,u),this}closePath(){var t;return this._tick++,(t=this._activePath)==null||t.closePath(),this}ellipse(t,s,r,o){return this._tick++,this._activePath.ellipse(t,s,r,o,this._transform.clone()),this}circle(t,s,r){return this._tick++,this._activePath.circle(t,s,r,this._transform.clone()),this}path(t){return this._tick++,this._activePath.addPath(t,this._transform.clone()),this}lineTo(t,s){this._tick++;const r=this._transform;return this._activePath.lineTo(r.a*t+r.c*s+r.tx,r.b*t+r.d*s+r.ty),this}moveTo(t,s){this._tick++;const r=this._transform,o=this._activePath.instructions,a=r.a*t+r.c*s+r.tx,h=r.b*t+r.d*s+r.ty;return o.length===1&&o[0].action==="moveTo"?(o[0].data[0]=a,o[0].data[1]=h,this):(this._activePath.moveTo(a,h),this)}quadraticCurveTo(t,s,r,o,a){this._tick++;const h=this._transform;return this._activePath.quadraticCurveTo(h.a*t+h.c*s+h.tx,h.b*t+h.d*s+h.ty,h.a*r+h.c*o+h.tx,h.b*r+h.d*o+h.ty,a),this}rect(t,s,r,o){return this._tick++,this._activePath.rect(t,s,r,o,this._transform.clone()),this}roundRect(t,s,r,o,a){return this._tick++,this._activePath.roundRect(t,s,r,o,a,this._transform.clone()),this}poly(t,s){return this._tick++,this._activePath.poly(t,s,this._transform.clone()),this}regularPoly(t,s,r,o,a=0,h){return this._tick++,this._activePath.regularPoly(t,s,r,o,a,h),this}roundPoly(t,s,r,o,a,h){return this._tick++,this._activePath.roundPoly(t,s,r,o,a,h),this}roundShape(t,s,r,o){return this._tick++,this._activePath.roundShape(t,s,r,o),this}filletRect(t,s,r,o,a){return this._tick++,this._activePath.filletRect(t,s,r,o,a),this}chamferRect(t,s,r,o,a,h){return this._tick++,this._activePath.chamferRect(t,s,r,o,a,h),this}star(t,s,r,o,a=0,h=0){return this._tick++,this._activePath.star(t,s,r,o,a,h,this._transform.clone()),this}svg(t){return this._tick++,IB(t,this),this}restore(){const t=this._stateStack.pop();return t&&(this._transform=t.transform,this._fillStyle=t.fillStyle,this._strokeStyle=t.strokeStyle),this}save(){return this._stateStack.push({transform:this._transform.clone(),fillStyle:{...this._fillStyle},strokeStyle:{...this._strokeStyle}}),this}getTransform(){return this._transform}resetTransform(){return this._transform.identity(),this}rotate(t){return this._transform.rotate(t),this}scale(t,s=t){return this._transform.scale(t,s),this}setTransform(t,s,r,o,a,h){return t instanceof Te?(this._transform.set(t.a,t.b,t.c,t.d,t.tx,t.ty),this):(this._transform.set(t,s,r,o,a,h),this)}transform(t,s,r,o,a,h){return t instanceof Te?(this._transform.append(t),this):(xy.set(t,s,r,o,a,h),this._transform.append(xy),this)}translate(t,s=t){return this._transform.translate(t,s),this}clear(){return this._activePath.clear(),this.instructions.length=0,this.resetTransform(),this.onUpdate(),this}onUpdate(){this.dirty||(this.emit("update",this,16),this.dirty=!0,this._boundsDirty=!0)}get bounds(){if(!this._boundsDirty)return this._bounds;const t=this._bounds;t.clear();for(let s=0;s<this.instructions.length;s++){const r=this.instructions[s],o=r.action;if(o==="fill"){const a=r.data;t.addBounds(a.path.bounds)}else if(o==="texture"){const a=r.data;t.addFrame(a.dx,a.dy,a.dx+a.dw,a.dy+a.dh,a.transform)}if(o==="stroke"){const a=r.data,h=a.style.alignment,u=a.style.width*(1-h),p=a.path.bounds;t.addFrame(p.minX-u,p.minY-u,p.maxX+u,p.maxY+u)}}return t}containsPoint(t){var o;if(!this.bounds.containsPoint(t.x,t.y))return!1;const s=this.instructions;let r=!1;for(let a=0;a<s.length;a++){const h=s[a],u=h.data,p=u.path;if(!h.action||!p)continue;const f=u.style,g=p.shapePath.shapePrimitives;for(let _=0;_<g.length;_++){const $=g[_].shape;if(!f||!$)continue;const E=g[_].transform,v=E?E.applyInverse(t,OB):t;if(h.action==="fill")r=$.contains(v.x,v.y);else{const x=f;r=$.strokeContains(v.x,v.y,x.width,x.alignment)}const w=u.hole;if(w){const x=(o=w.shapePath)==null?void 0:o.shapePrimitives;if(x)for(let C=0;C<x.length;C++)x[C].shape.contains(v.x,v.y)&&(r=!1)}if(r)return!0}}return r}destroy(t=!1){if(this._stateStack.length=0,this._transform=null,this.emit("destroy",this),this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const r=typeof t=="boolean"?t:t==null?void 0:t.textureSource;this._fillStyle.texture&&this._fillStyle.texture.destroy(r),this._strokeStyle.texture&&this._strokeStyle.texture.destroy(r)}this._fillStyle=null,this._strokeStyle=null,this.instructions=null,this._activePath=null,this._bounds=null,this._stateStack=null,this.customShader=null,this._transform=null}};Fg.defaultFillStyle={color:16777215,alpha:1,texture:me.WHITE,matrix:null,fill:null,textureSpace:"local"};Fg.defaultStrokeStyle={width:1,color:16777215,alpha:1,alignment:.5,miterLimit:10,cap:"butt",join:"miter",texture:me.WHITE,matrix:null,fill:null,textureSpace:"local",pixelLine:!1};let Zs=Fg;const Cy=["align","breakWords","cssOverrides","fontVariant","fontWeight","leading","letterSpacing","lineHeight","padding","textBaseline","trim","whiteSpace","wordWrap","wordWrapWidth","fontFamily","fontStyle","fontSize"];function AB(l){const t=[];let s=0;for(let r=0;r<Cy.length;r++){const o=`_${Cy[r]}`;t[s++]=l[o]}return s=AS(l._fill,t,s),s=LB(l._stroke,t,s),s=PB(l.dropShadow,t,s),s=MB(l.filters,t,s),t.join("-")}function MB(l,t,s){if(!l)return s;for(const r of l)t[s++]=r.uid;return s}function AS(l,t,s){var r;return l&&(t[s++]=l.color,t[s++]=l.alpha,t[s++]=(r=l.fill)==null?void 0:r.styleKey),s}function LB(l,t,s){return l&&(s=AS(l,t,s),t[s++]=l.width,t[s++]=l.alignment,t[s++]=l.cap,t[s++]=l.join,t[s++]=l.miterLimit),s}function PB(l,t,s){return l&&(t[s++]=l.alpha,t[s++]=l.angle,t[s++]=l.blur,t[s++]=l.distance,t[s++]=We.shared.setValue(l.color).toNumber()),s}const Ug=class so extends Is{constructor(t={}){super(),NB(t);const s={...so.defaultTextStyle,...t};for(const r in s){const o=r;this[o]=s[r]}this.update()}get align(){return this._align}set align(t){this._align=t,this.update()}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords=t,this.update()}get dropShadow(){return this._dropShadow}set dropShadow(t){t!==null&&typeof t=="object"?this._dropShadow=this._createProxy({...so.defaultDropShadow,...t}):this._dropShadow=t?this._createProxy({...so.defaultDropShadow}):null,this.update()}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily=t,this.update()}get fontSize(){return this._fontSize}set fontSize(t){typeof t=="string"?this._fontSize=parseInt(t,10):this._fontSize=t,this.update()}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle=t.toLowerCase(),this.update()}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant=t,this.update()}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight=t,this.update()}get leading(){return this._leading}set leading(t){this._leading=t,this.update()}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing=t,this.update()}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight=t,this.update()}get padding(){return this._padding}set padding(t){this._padding=t,this.update()}get filters(){return this._filters}set filters(t){this._filters=t,this.update()}get trim(){return this._trim}set trim(t){this._trim=t,this.update()}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline=t,this.update()}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace=t,this.update()}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap=t,this.update()}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth=t,this.update()}get fill(){return this._originalFill}set fill(t){t!==this._originalFill&&(this._originalFill=t,this._isFillStyle(t)&&(this._originalFill=this._createProxy({...Zs.defaultFillStyle,...t},()=>{this._fill=sn({...this._originalFill},Zs.defaultFillStyle)})),this._fill=sn(t===0?"black":t,Zs.defaultFillStyle),this.update())}get stroke(){return this._originalStroke}set stroke(t){t!==this._originalStroke&&(this._originalStroke=t,this._isFillStyle(t)&&(this._originalStroke=this._createProxy({...Zs.defaultStrokeStyle,...t},()=>{this._stroke=lh({...this._originalStroke},Zs.defaultStrokeStyle)})),this._stroke=lh(t,Zs.defaultStrokeStyle),this.update())}_generateKey(){return this._styleKey=AB(this),this._styleKey}update(){this._styleKey=null,this.emit("update",this)}reset(){const t=so.defaultTextStyle;for(const s in t)this[s]=t[s]}get styleKey(){return this._styleKey||this._generateKey()}clone(){return new so({align:this.align,breakWords:this.breakWords,dropShadow:this._dropShadow?{...this._dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,leading:this.leading,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,textBaseline:this.textBaseline,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,filters:this._filters?[...this._filters]:void 0})}_getFinalPadding(){let t=0;if(this._filters)for(let s=0;s<this._filters.length;s++)t+=this._filters[s].padding;return Math.max(this._padding,t)}destroy(t=!1){var r,o,a,h;if(this.removeAllListeners(),typeof t=="boolean"?t:t==null?void 0:t.texture){const u=typeof t=="boolean"?t:t==null?void 0:t.textureSource;(r=this._fill)!=null&&r.texture&&this._fill.texture.destroy(u),(o=this._originalFill)!=null&&o.texture&&this._originalFill.texture.destroy(u),(a=this._stroke)!=null&&a.texture&&this._stroke.texture.destroy(u),(h=this._originalStroke)!=null&&h.texture&&this._originalStroke.texture.destroy(u)}this._fill=null,this._stroke=null,this.dropShadow=null,this._originalStroke=null,this._originalFill=null}_createProxy(t,s){return new Proxy(t,{set:(r,o,a)=>(r[o]=a,s==null||s(o,a),this.update(),!0)})}_isFillStyle(t){return(t??null)!==null&&!(We.isColorLike(t)||t instanceof ji||t instanceof gh)}};Ug.defaultDropShadow={alpha:1,angle:Math.PI/6,blur:0,color:"black",distance:5};Ug.defaultTextStyle={align:"left",breakWords:!1,dropShadow:null,fill:"black",fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,padding:0,stroke:null,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};let Tr=Ug;function NB(l){const t=l;if(typeof t.dropShadow=="boolean"&&t.dropShadow){const s=Tr.defaultDropShadow;l.dropShadow={alpha:t.dropShadowAlpha??s.alpha,angle:t.dropShadowAngle??s.angle,blur:t.dropShadowBlur??s.blur,color:t.dropShadowColor??s.color,distance:t.dropShadowDistance??s.distance}}if(t.strokeThickness!==void 0){ke(He,"strokeThickness is now a part of stroke");const s=t.stroke;let r={};if(We.isColorLike(s))r.color=s;else if(s instanceof ji||s instanceof gh)r.fill=s;else if(Object.hasOwnProperty.call(s,"color")||Object.hasOwnProperty.call(s,"fill"))r=s;else throw new Error("Invalid stroke value.");l.stroke={...r,width:t.strokeThickness}}if(Array.isArray(t.fillGradientStops)){ke(He,"gradient fill is now a fill pattern: `new FillGradient(...)`");let s;l.fontSize==null?l.fontSize=Tr.defaultTextStyle.fontSize:typeof l.fontSize=="string"?s=parseInt(l.fontSize,10):s=l.fontSize;const r=new ji({start:{x:0,y:0},end:{x:0,y:(s||0)*1.7}}),o=t.fillGradientStops.map(a=>We.shared.setValue(a).toNumber());o.forEach((a,h)=>{const u=h/(o.length-1);r.addColorStop(u,a)}),l.fill={fill:r}}}class DB{constructor(t){this._canvasPool=Object.create(null),this.canvasOptions=t||{},this.enableFullScreen=!1}_createCanvasAndContext(t,s){const r=it.get().createCanvas();r.width=t,r.height=s;const o=r.getContext("2d");return{canvas:r,context:o}}getOptimalCanvasAndContext(t,s,r=1){t=Math.ceil(t*r-1e-6),s=Math.ceil(s*r-1e-6),t=ro(t),s=ro(s);const o=(t<<17)+(s<<1);this._canvasPool[o]||(this._canvasPool[o]=[]);let a=this._canvasPool[o].pop();return a||(a=this._createCanvasAndContext(t,s)),a}returnCanvasAndContext(t){const s=t.canvas,{width:r,height:o}=s,a=(r<<17)+(o<<1);t.context.resetTransform(),t.context.clearRect(0,0,r,o),this._canvasPool[a].push(t)}clear(){this._canvasPool={}}}const br=new DB,wy=1e5;function ah(l,t,s,r=0){if(l.texture===me.WHITE&&!l.fill)return We.shared.setValue(l.color).setAlpha(l.alpha??1).toHexa();if(l.fill){if(l.fill instanceof gh){const o=l.fill,a=t.createPattern(o.texture.source.resource,"repeat"),h=o.transform.copyTo(Te.shared);return h.scale(o.texture.frame.width,o.texture.frame.height),a.setTransform(h),a}else if(l.fill instanceof ji){const o=l.fill,a=o.type==="linear",h=o.textureSpace==="local";let u=1,p=1;h&&s&&(u=s.width+r,p=s.height+r);let f,g=!1;if(a){const{start:_,end:$}=o;f=t.createLinearGradient(_.x*u,_.y*p,$.x*u,$.y*p),g=Math.abs($.x-_.x)<Math.abs(($.y-_.y)*.1)}else{const{center:_,innerRadius:$,outerCenter:E,outerRadius:v}=o;f=t.createRadialGradient(_.x*u,_.y*p,$*u,E.x*u,E.y*p,v*u)}if(g&&h&&s){const _=s.lineHeight/p;for(let $=0;$<s.lines.length;$++){const E=($*s.lineHeight+r/2)/p;o.colorStops.forEach(v=>{const w=E+v.offset*_;f.addColorStop(Math.floor(w*wy)/wy,We.shared.setValue(v.color).toHex())})}}else o.colorStops.forEach(_=>{f.addColorStop(_.offset,We.shared.setValue(_.color).toHex())});return f}}else{const o=t.createPattern(l.texture.source.resource,"repeat"),a=l.matrix.copyTo(Te.shared);return a.scale(l.texture.frame.width,l.texture.frame.height),o.setTransform(a),o}return we("FillStyle not recognised",l),"red"}const MS=class LS extends KN{constructor(t){super(),this.resolution=1,this.pages=[],this._padding=0,this._measureCache=Object.create(null),this._currentChars=[],this._currentX=0,this._currentY=0,this._currentMaxCharHeight=0,this._currentPageIndex=-1,this._skipKerning=!1;const s={...LS.defaultOptions,...t};this._textureSize=s.textureSize,this._mipmap=s.mipmap;const r=s.style.clone();s.overrideFill&&(r._fill.color=16777215,r._fill.alpha=1,r._fill.texture=me.WHITE,r._fill.fill=null),this.applyFillAsTint=s.overrideFill;const o=r.fontSize;r.fontSize=this.baseMeasurementFontSize;const a=oh(r);s.overrideSize?r._stroke&&(r._stroke.width*=this.baseRenderedFontSize/o):r.fontSize=this.baseRenderedFontSize=o,this._style=r,this._skipKerning=s.skipKerning??!1,this.resolution=s.resolution??1,this._padding=s.padding??4,s.textureStyle&&(this._textureStyle=s.textureStyle instanceof ln?s.textureStyle:new ln(s.textureStyle)),this.fontMetrics=Ei.measureFont(a),this.lineHeight=r.lineHeight||this.fontMetrics.fontSize||r.fontSize}ensureCharacters(t){var x,C;const s=Ei.graphemeSegmenter(t).filter(R=>!this._currentChars.includes(R)).filter((R,A,D)=>D.indexOf(R)===A);if(!s.length)return;this._currentChars=[...this._currentChars,...s];let r;this._currentPageIndex===-1?r=this._nextPage():r=this.pages[this._currentPageIndex];let{canvas:o,context:a}=r.canvasAndContext,h=r.texture.source;const u=this._style;let p=this._currentX,f=this._currentY,g=this._currentMaxCharHeight;const _=this.baseRenderedFontSize/this.baseMeasurementFontSize,$=this._padding*_;let E=!1;const v=o.width/this.resolution,w=o.height/this.resolution;for(let R=0;R<s.length;R++){const A=s[R],D=Ei.measureText(A,u,o,!1);D.lineHeight=D.height;const G=D.width*_,M=Math.ceil((u.fontStyle==="italic"?2:1)*G),k=D.height*_,z=M+$*2,se=k+$*2;if(E=!1,A!==`
`&&A!=="\r"&&A!=="	"&&A!==" "&&(E=!0,g=Math.ceil(Math.max(se,g))),p+z>v&&(f+=g,g=se,p=0,f+g>w)){h.update();const ie=this._nextPage();o=ie.canvasAndContext.canvas,a=ie.canvasAndContext.context,h=ie.texture.source,p=0,f=0,g=0}const Q=G/_-(((x=u.dropShadow)==null?void 0:x.distance)??0)-(((C=u._stroke)==null?void 0:C.width)??0);if(this.chars[A]={id:A.codePointAt(0),xOffset:-this._padding,yOffset:-this._padding,xAdvance:Q,kerning:{}},E){this._drawGlyph(a,D,p+$,f+$,_,u);const ie=h.width*_,_e=h.height*_,ge=new Fe(p/ie*h.width,f/_e*h.height,z/ie*h.width,se/_e*h.height);this.chars[A].texture=new me({source:h,frame:ge}),p+=Math.ceil(z)}}h.update(),this._currentX=p,this._currentY=f,this._currentMaxCharHeight=g,this._skipKerning&&this._applyKerning(s,a)}get pageTextures(){return ke(He,"BitmapFont.pageTextures is deprecated, please use BitmapFont.pages instead."),this.pages}_applyKerning(t,s){const r=this._measureCache;for(let o=0;o<t.length;o++){const a=t[o];for(let h=0;h<this._currentChars.length;h++){const u=this._currentChars[h];let p=r[a];p||(p=r[a]=s.measureText(a).width);let f=r[u];f||(f=r[u]=s.measureText(u).width);let g=s.measureText(a+u).width,_=g-(p+f);_&&(this.chars[a].kerning[u]=_),g=s.measureText(a+u).width,_=g-(p+f),_&&(this.chars[u].kerning[a]=_)}}}_nextPage(){this._currentPageIndex++;const t=this.resolution,s=br.getOptimalCanvasAndContext(this._textureSize,this._textureSize,t);this._setupContext(s.context,this._style,t);const r=t*(this.baseRenderedFontSize/this.baseMeasurementFontSize),o=new me({source:new Rl({resource:s.canvas,resolution:r,alphaMode:"premultiply-alpha-on-upload",autoGenerateMipmaps:this._mipmap})});this._textureStyle&&(o.source.style=this._textureStyle);const a={canvasAndContext:s,texture:o};return this.pages[this._currentPageIndex]=a,a}_setupContext(t,s,r){s.fontSize=this.baseRenderedFontSize,t.scale(r,r),t.font=oh(s),s.fontSize=this.baseMeasurementFontSize,t.textBaseline=s.textBaseline;const o=s._stroke,a=(o==null?void 0:o.width)??0;if(o&&(t.lineWidth=a,t.lineJoin=o.join,t.miterLimit=o.miterLimit,t.strokeStyle=ah(o,t)),s._fill&&(t.fillStyle=ah(s._fill,t)),s.dropShadow){const h=s.dropShadow,u=We.shared.setValue(h.color).toArray(),p=h.blur*r,f=h.distance*r;t.shadowColor=`rgba(${u[0]*255},${u[1]*255},${u[2]*255},${h.alpha})`,t.shadowBlur=p,t.shadowOffsetX=Math.cos(h.angle)*f,t.shadowOffsetY=Math.sin(h.angle)*f}else t.shadowColor="black",t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0}_drawGlyph(t,s,r,o,a,h){const u=s.text,p=s.fontProperties,f=h._stroke,g=((f==null?void 0:f.width)??0)*a,_=r+g/2,$=o-g/2,E=p.descent*a,v=s.lineHeight*a;let w=!1;h.stroke&&g&&(w=!0,t.strokeText(u,_,$+v-E));const{shadowBlur:x,shadowOffsetX:C,shadowOffsetY:R}=t;h._fill&&(w&&(t.shadowBlur=0,t.shadowOffsetX=0,t.shadowOffsetY=0),t.fillText(u,_,$+v-E)),w&&(t.shadowBlur=x,t.shadowOffsetX=C,t.shadowOffsetY=R)}destroy(){super.destroy();for(let t=0;t<this.pages.length;t++){const{canvasAndContext:s,texture:r}=this.pages[t];br.returnCanvasAndContext(s),r.destroy(!0)}this.pages=null}};MS.defaultOptions={textureSize:512,style:new Tr,mipmap:!0};let Ry=MS;function PS(l,t,s,r){const o={width:0,height:0,offsetY:0,scale:t.fontSize/s.baseMeasurementFontSize,lines:[{width:0,charPositions:[],spaceWidth:0,spacesIndex:[],chars:[]}]};o.offsetY=s.baseLineOffset;let a=o.lines[0],h=null,u=!0;const p={width:0,start:0,index:0,positions:[],chars:[]},f=x=>{const C=a.width;for(let R=0;R<p.index;R++){const A=x.positions[R];a.chars.push(x.chars[R]),a.charPositions.push(A+C)}a.width+=x.width,u=!1,p.width=0,p.index=0,p.chars.length=0},g=()=>{let x=a.chars.length-1;if(r){let C=a.chars[x];for(;C===" ";)a.width-=s.chars[C].xAdvance,C=a.chars[--x]}o.width=Math.max(o.width,a.width),a={width:0,charPositions:[],chars:[],spaceWidth:0,spacesIndex:[]},u=!0,o.lines.push(a),o.height+=s.lineHeight},_=s.baseMeasurementFontSize/t.fontSize,$=t.letterSpacing*_,E=t.wordWrapWidth*_,v=t.wordWrap&&t.breakWords,w=x=>x-$>E;for(let x=0;x<l.length+1;x++){let C;const R=x===l.length;R||(C=l[x]);const A=s.chars[C]||s.chars[" "];if(/(?:\s)/.test(C)||C==="\r"||C===`
`||R){if(!u&&t.wordWrap&&w(a.width+p.width)?(g(),f(p),R||a.charPositions.push(0)):(p.start=a.width,f(p),R||a.charPositions.push(0)),C==="\r"||C===`
`)a.width!==0&&g();else if(!R){const k=A.xAdvance+(A.kerning[h]||0)+$;a.width+=k,a.spaceWidth=k,a.spacesIndex.push(a.charPositions.length),a.chars.push(C)}}else{const M=A.kerning[h]||0,k=A.xAdvance+M+$;v&&w(a.width+p.width+k)&&(f(p),g()),p.positions[p.index++]=p.width+M,p.chars.push(C),p.width+=k}h=C}return g(),t.align==="center"?BB(o):t.align==="right"?FB(o):t.align==="justify"&&UB(o),o}function BB(l){for(let t=0;t<l.lines.length;t++){const s=l.lines[t],r=l.width/2-s.width/2;for(let o=0;o<s.charPositions.length;o++)s.charPositions[o]+=r}}function FB(l){for(let t=0;t<l.lines.length;t++){const s=l.lines[t],r=l.width-s.width;for(let o=0;o<s.charPositions.length;o++)s.charPositions[o]+=r}}function UB(l){const t=l.width;for(let s=0;s<l.lines.length;s++){const r=l.lines[s];let o=0,a=r.spacesIndex[o++],h=0;const u=r.spacesIndex.length,f=(t-r.width)/u;for(let g=0;g<r.charPositions.length;g++)g===a&&(a=r.spacesIndex[o++],h+=f),r.charPositions[g]+=h}}function GB(l){if(l==="")return[];typeof l=="string"&&(l=[l]);const t=[];for(let s=0,r=l.length;s<r;s++){const o=l[s];if(Array.isArray(o)){if(o.length!==2)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${o.length}.`);if(o[0].length===0||o[1].length===0)throw new Error("[BitmapFont]: Invalid character delimiter.");const a=o[0].charCodeAt(0),h=o[1].charCodeAt(0);if(h<a)throw new Error("[BitmapFont]: Invalid character range.");for(let u=a,p=h;u<=p;u++)t.push(String.fromCharCode(u))}else t.push(...Array.from(o))}if(t.length===0)throw new Error("[BitmapFont]: Empty set when resolving characters.");return t}let Vc=0;class HB{constructor(){this.ALPHA=[["a","z"],["A","Z"]," "],this.NUMERIC=[["0","9"]],this.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],this.ASCII=[[" ","~"]],this.defaultOptions={chars:this.ALPHANUMERIC,resolution:1,padding:4,skipKerning:!1,textureStyle:null}}getFont(t,s){var h;let r=`${s.fontFamily}-bitmap`,o=!0;if(s._fill.fill&&!s._stroke)r+=s._fill.fill.styleKey,o=!1;else if(s._stroke||s.dropShadow){let u=s.styleKey;u=u.substring(0,u.lastIndexOf("-")),r=`${u}-bitmap`,o=!1}if(!Xt.has(r)){const u=new Ry({style:s,overrideFill:o,overrideSize:!0,...this.defaultOptions});Vc++,Vc>50&&we("BitmapText",`You have dynamically created ${Vc} bitmap fonts, this can be inefficient. Try pre installing your font styles using \`BitmapFont.install({name:"style1", style})\``),u.once("destroy",()=>{Vc--,Xt.remove(r)}),Xt.set(r,u)}const a=Xt.get(r);return(h=a.ensureCharacters)==null||h.call(a,t),a}getLayout(t,s,r=!0){const o=this.getFont(t,s),a=Ei.graphemeSegmenter(t);return PS(a,s,o,r)}measureText(t,s,r=!0){return this.getLayout(t,s,r)}install(...t){var f,g,_,$;let s=t[0];typeof s=="string"&&(s={name:s,style:t[1],chars:(f=t[2])==null?void 0:f.chars,resolution:(g=t[2])==null?void 0:g.resolution,padding:(_=t[2])==null?void 0:_.padding,skipKerning:($=t[2])==null?void 0:$.skipKerning},ke(He,"BitmapFontManager.install(name, style, options) is deprecated, use BitmapFontManager.install({name, style, ...options})"));const r=s==null?void 0:s.name;if(!r)throw new Error("[BitmapFontManager] Property `name` is required.");s={...this.defaultOptions,...s};const o=s.style,a=o instanceof Tr?o:new Tr(o),h=a._fill.fill!==null&&a._fill.fill!==void 0,u=new Ry({style:a,overrideFill:h,skipKerning:s.skipKerning,padding:s.padding,resolution:s.resolution,overrideSize:!1,textureStyle:s.textureStyle}),p=GB(s.chars);return u.ensureCharacters(p.join("")),Xt.set(`${r}-bitmap`,u),u.once("destroy",()=>Xt.remove(`${r}-bitmap`)),u}uninstall(t){const s=`${t}-bitmap`,r=Xt.get(s);r&&r.destroy()}}const VB=new HB;class NS{constructor(t){this._attachedDomElements=[],this._renderer=t,this._renderer.runners.postrender.add(this),this._domElement=document.createElement("div"),this._domElement.style.position="absolute",this._domElement.style.top="0",this._domElement.style.left="0",this._domElement.style.pointerEvents="none",this._domElement.style.zIndex="1000"}addRenderable(t,s){this._attachedDomElements.includes(t)||this._attachedDomElements.push(t)}updateRenderable(t){}validateRenderable(t){return!0}postrender(){var a;const t=this._attachedDomElements;if(t.length===0){this._domElement.remove();return}const s=this._renderer.view.canvas;this._domElement.parentNode!==s.parentNode&&((a=s.parentNode)==null||a.appendChild(this._domElement));const r=parseFloat(s.style.width)/s.width*this._renderer.resolution,o=parseFloat(s.style.height)/s.height*this._renderer.resolution;this._domElement.style.transform=`translate(${s.offsetLeft}px, ${s.offsetTop}px) scale(${r}, ${o})`;for(let h=0;h<t.length;h++){const u=t[h],p=u.element;if(!u.parent||u.globalDisplayStatus<7)p==null||p.remove(),t.splice(h,1),h--;else{this._domElement.contains(p)||(p.style.position="absolute",p.style.pointerEvents="auto",this._domElement.appendChild(p));const f=u.worldTransform,g=u._anchor,_=u.width*g.x,$=u.height*g.y;p.style.transformOrigin=`${_}px ${$}px`,p.style.transform=`matrix(${f.a}, ${f.b}, ${f.c}, ${f.d}, ${f.tx-_}, ${f.ty-$})`,p.style.opacity=u.groupAlpha.toString()}}}destroy(){var t;this._renderer.runners.postrender.remove(this);for(let s=0;s<this._attachedDomElements.length;s++)(t=this._attachedDomElements[s].element)==null||t.remove();this._attachedDomElements.length=0,this._domElement.remove(),this._renderer=null}}NS.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"dom"};class WB{constructor(){this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}init(t){this.removeTickerListener(),this.events=t,this.interactionFrequency=10,this._deltaTime=0,this._didMove=!1,this._tickerAdded=!1,this._pauseUpdate=!0}get pauseUpdate(){return this._pauseUpdate}set pauseUpdate(t){this._pauseUpdate=t}addTickerListener(){this._tickerAdded||!this.domElement||(Qs.system.add(this._tickerUpdate,this,kl.INTERACTION),this._tickerAdded=!0)}removeTickerListener(){this._tickerAdded&&(Qs.system.remove(this._tickerUpdate,this),this._tickerAdded=!1)}pointerMoved(){this._didMove=!0}_update(){if(!this.domElement||this._pauseUpdate)return;if(this._didMove){this._didMove=!1;return}const t=this.events._rootPointerEvent;this.events.supportsTouchEvents&&t.pointerType==="touch"||globalThis.document.dispatchEvent(this.events.supportsPointerEvents?new PointerEvent("pointermove",{clientX:t.clientX,clientY:t.clientY,pointerType:t.pointerType,pointerId:t.pointerId}):new MouseEvent("mousemove",{clientX:t.clientX,clientY:t.clientY}))}_tickerUpdate(t){this._deltaTime+=t.deltaTime,!(this._deltaTime<this.interactionFrequency)&&(this._deltaTime=0,this._update())}}const mr=new WB;class ch extends Fl{constructor(){super(...arguments),this.client=new ve,this.movement=new ve,this.offset=new ve,this.global=new ve,this.screen=new ve}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getLocalPosition(t,s,r){return t.worldTransform.applyInverse(r||this.global,s)}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,s,r,o,a,h,u,p,f,g,_,$,E,v,w){throw new Error("Method not implemented.")}}class Js extends ch{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class ao extends ch{constructor(){super(...arguments),this.DOM_DELTA_PIXEL=0,this.DOM_DELTA_LINE=1,this.DOM_DELTA_PAGE=2}}ao.DOM_DELTA_PIXEL=0;ao.DOM_DELTA_LINE=1;ao.DOM_DELTA_PAGE=2;const zB=2048,XB=new ve,pl=new ve;class YB{constructor(t){this.dispatch=new Is,this.moveOnAll=!1,this.enableGlobalMoveEvents=!0,this.mappingState={trackingData:{}},this.eventPool=new Map,this._allInteractiveElements=[],this._hitElements=[],this._isPointerMoveEvent=!1,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,s){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:s,priority:0}),this.mappingTable[t].sort((r,o)=>r.priority-o.priority)}dispatchEvent(t,s){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,s),this.dispatch.emit(s||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const s=this.mappingTable[t.type];if(s)for(let r=0,o=s.length;r<o;r++)s[r].fn(t);else we(`[EventBoundary]: Event mapping not defined for ${t.type}`)}hitTest(t,s){mr.pauseUpdate=!0;const o=this._isPointerMoveEvent&&this.enableGlobalMoveEvents?"hitTestMoveRecursive":"hitTestRecursive",a=this[o](this.rootTarget,this.rootTarget.eventMode,XB.set(t,s),this.hitTestFn,this.hitPruneFn);return a&&a[0]}propagate(t,s){if(!t.target)return;const r=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let o=0,a=r.length-1;o<a;o++)if(t.currentTarget=r[o],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,s),!(t.propagationStopped||t.propagationImmediatelyStopped)){t.eventPhase=t.BUBBLING_PHASE;for(let o=r.length-2;o>=0;o--)if(t.currentTarget=r[o],this.notifyTarget(t,s),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,s,r=this._allInteractiveElements){if(r.length===0)return;t.eventPhase=t.BUBBLING_PHASE;const o=Array.isArray(s)?s:[s];for(let a=r.length-1;a>=0;a--)o.forEach(h=>{t.currentTarget=r[a],this.notifyTarget(t,h)})}propagationPath(t){const s=[t];for(let r=0;r<zB&&t!==this.rootTarget&&t.parent;r++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");s.push(t.parent),t=t.parent}return s.reverse(),s}hitTestMoveRecursive(t,s,r,o,a,h=!1){let u=!1;if(this._interactivePrune(t))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){const g=t.children;for(let _=g.length-1;_>=0;_--){const $=g[_],E=this.hitTestMoveRecursive($,this._isInteractive(s)?s:$.eventMode,r,o,a,h||a(t,r));if(E){if(E.length>0&&!E[E.length-1].parent)continue;const v=t.isInteractive();(E.length>0||v)&&(v&&this._allInteractiveElements.push(t),E.push(t)),this._hitElements.length===0&&(this._hitElements=E),u=!0}}}const p=this._isInteractive(s),f=t.isInteractive();return f&&f&&this._allInteractiveElements.push(t),h||this._hitElements.length>0?null:u?this._hitElements:p&&!a(t,r)&&o(t,r)?f?[t]:[]:null}hitTestRecursive(t,s,r,o,a){if(this._interactivePrune(t)||a(t,r))return null;if((t.eventMode==="dynamic"||s==="dynamic")&&(mr.pauseUpdate=!1),t.interactiveChildren&&t.children){const p=t.children,f=r;for(let g=p.length-1;g>=0;g--){const _=p[g],$=this.hitTestRecursive(_,this._isInteractive(s)?s:_.eventMode,f,o,a);if($){if($.length>0&&!$[$.length-1].parent)continue;const E=t.isInteractive();return($.length>0||E)&&$.push(t),$}}}const h=this._isInteractive(s),u=t.isInteractive();return h&&o(t,r)?u?[t]:[]:null}_isInteractive(t){return t==="static"||t==="dynamic"}_interactivePrune(t){return!t||!t.visible||!t.renderable||!t.measurable||t.eventMode==="none"||t.eventMode==="passive"&&!t.interactiveChildren}hitPruneFn(t,s){if(t.hitArea&&(t.worldTransform.applyInverse(s,pl),!t.hitArea.contains(pl.x,pl.y)))return!0;if(t.effects&&t.effects.length)for(let r=0;r<t.effects.length;r++){const o=t.effects[r];if(o.containsPoint&&!o.containsPoint(s,this.hitTestFn))return!0}return!1}hitTestFn(t,s){return t.hitArea?!0:t!=null&&t.containsPoint?(t.worldTransform.applyInverse(s,pl),t.containsPoint(pl)):!1}notifyTarget(t,s){var a,h;if(!t.currentTarget.isInteractive())return;s??(s=t.type);const r=`on${s}`;(h=(a=t.currentTarget)[r])==null||h.call(a,t);const o=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${s}capture`:s;this._notifyListeners(t,o),t.eventPhase===t.AT_TARGET&&this._notifyListeners(t,s)}mapPointerDown(t){if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.createPointerEvent(t);if(this.dispatchEvent(s,"pointerdown"),s.pointerType==="touch")this.dispatchEvent(s,"touchstart");else if(s.pointerType==="mouse"||s.pointerType==="pen"){const o=s.button===2;this.dispatchEvent(s,o?"rightdown":"mousedown")}const r=this.trackingData(t.pointerId);r.pressTargetsByButton[t.button]=s.composedPath(),this.freeEvent(s)}mapPointerMove(t){var p,f;if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}this._allInteractiveElements.length=0,this._hitElements.length=0,this._isPointerMoveEvent=!0;const s=this.createPointerEvent(t);this._isPointerMoveEvent=!1;const r=s.pointerType==="mouse"||s.pointerType==="pen",o=this.trackingData(t.pointerId),a=this.findMountedTarget(o.overTargets);if(((p=o.overTargets)==null?void 0:p.length)>0&&a!==s.target){const g=t.type==="mousemove"?"mouseout":"pointerout",_=this.createPointerEvent(t,g,a);if(this.dispatchEvent(_,"pointerout"),r&&this.dispatchEvent(_,"mouseout"),!s.composedPath().includes(a)){const $=this.createPointerEvent(t,"pointerleave",a);for($.eventPhase=$.AT_TARGET;$.target&&!s.composedPath().includes($.target);)$.currentTarget=$.target,this.notifyTarget($),r&&this.notifyTarget($,"mouseleave"),$.target=$.target.parent;this.freeEvent($)}this.freeEvent(_)}if(a!==s.target){const g=t.type==="mousemove"?"mouseover":"pointerover",_=this.clonePointerEvent(s,g);this.dispatchEvent(_,"pointerover"),r&&this.dispatchEvent(_,"mouseover");let $=a==null?void 0:a.parent;for(;$&&$!==this.rootTarget.parent&&$!==s.target;)$=$.parent;if(!$||$===this.rootTarget.parent){const v=this.clonePointerEvent(s,"pointerenter");for(v.eventPhase=v.AT_TARGET;v.target&&v.target!==a&&v.target!==this.rootTarget.parent;)v.currentTarget=v.target,this.notifyTarget(v),r&&this.notifyTarget(v,"mouseenter"),v.target=v.target.parent;this.freeEvent(v)}this.freeEvent(_)}const h=[],u=this.enableGlobalMoveEvents??!0;this.moveOnAll?h.push("pointermove"):this.dispatchEvent(s,"pointermove"),u&&h.push("globalpointermove"),s.pointerType==="touch"&&(this.moveOnAll?h.splice(1,0,"touchmove"):this.dispatchEvent(s,"touchmove"),u&&h.push("globaltouchmove")),r&&(this.moveOnAll?h.splice(1,0,"mousemove"):this.dispatchEvent(s,"mousemove"),u&&h.push("globalmousemove"),this.cursor=(f=s.target)==null?void 0:f.cursor),h.length>0&&this.all(s,h),this._allInteractiveElements.length=0,this._hitElements.length=0,o.overTargets=s.composedPath(),this.freeEvent(s)}mapPointerOver(t){var h;if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),r=this.createPointerEvent(t),o=r.pointerType==="mouse"||r.pointerType==="pen";this.dispatchEvent(r,"pointerover"),o&&this.dispatchEvent(r,"mouseover"),r.pointerType==="mouse"&&(this.cursor=(h=r.target)==null?void 0:h.cursor);const a=this.clonePointerEvent(r,"pointerenter");for(a.eventPhase=a.AT_TARGET;a.target&&a.target!==this.rootTarget.parent;)a.currentTarget=a.target,this.notifyTarget(a),o&&this.notifyTarget(a,"mouseenter"),a.target=a.target.parent;s.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(a)}mapPointerOut(t){if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId);if(s.overTargets){const r=t.pointerType==="mouse"||t.pointerType==="pen",o=this.findMountedTarget(s.overTargets),a=this.createPointerEvent(t,"pointerout",o);this.dispatchEvent(a),r&&this.dispatchEvent(a,"mouseout");const h=this.createPointerEvent(t,"pointerleave",o);for(h.eventPhase=h.AT_TARGET;h.target&&h.target!==this.rootTarget.parent;)h.currentTarget=h.target,this.notifyTarget(h),r&&this.notifyTarget(h,"mouseleave"),h.target=h.target.parent;s.overTargets=null,this.freeEvent(a),this.freeEvent(h)}this.cursor=null}mapPointerUp(t){if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=performance.now(),r=this.createPointerEvent(t);if(this.dispatchEvent(r,"pointerup"),r.pointerType==="touch")this.dispatchEvent(r,"touchend");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const u=r.button===2;this.dispatchEvent(r,u?"rightup":"mouseup")}const o=this.trackingData(t.pointerId),a=this.findMountedTarget(o.pressTargetsByButton[t.button]);let h=a;if(a&&!r.composedPath().includes(a)){let u=a;for(;u&&!r.composedPath().includes(u);){if(r.currentTarget=u,this.notifyTarget(r,"pointerupoutside"),r.pointerType==="touch")this.notifyTarget(r,"touchendoutside");else if(r.pointerType==="mouse"||r.pointerType==="pen"){const p=r.button===2;this.notifyTarget(r,p?"rightupoutside":"mouseupoutside")}u=u.parent}delete o.pressTargetsByButton[t.button],h=u}if(h){const u=this.clonePointerEvent(r,"click");u.target=h,u.path=null,o.clicksByButton[t.button]||(o.clicksByButton[t.button]={clickCount:0,target:u.target,timeStamp:s});const p=o.clicksByButton[t.button];if(p.target===u.target&&s-p.timeStamp<200?++p.clickCount:p.clickCount=1,p.target=u.target,p.timeStamp=s,u.detail=p.clickCount,u.pointerType==="mouse"){const f=u.button===2;this.dispatchEvent(u,f?"rightclick":"click")}else u.pointerType==="touch"&&this.dispatchEvent(u,"tap");this.dispatchEvent(u,"pointertap"),this.freeEvent(u)}this.freeEvent(r)}mapPointerUpOutside(t){if(!(t instanceof Js)){we("EventBoundary cannot map a non-pointer event as a pointer event");return}const s=this.trackingData(t.pointerId),r=this.findMountedTarget(s.pressTargetsByButton[t.button]),o=this.createPointerEvent(t);if(r){let a=r;for(;a;)o.currentTarget=a,this.notifyTarget(o,"pointerupoutside"),o.pointerType==="touch"?this.notifyTarget(o,"touchendoutside"):(o.pointerType==="mouse"||o.pointerType==="pen")&&this.notifyTarget(o,o.button===2?"rightupoutside":"mouseupoutside"),a=a.parent;delete s.pressTargetsByButton[t.button]}this.freeEvent(o)}mapWheel(t){if(!(t instanceof ao)){we("EventBoundary cannot map a non-wheel event as a wheel event");return}const s=this.createWheelEvent(t);this.dispatchEvent(s),this.freeEvent(s)}findMountedTarget(t){if(!t)return null;let s=t[0];for(let r=1;r<t.length&&t[r].parent===s;r++)s=t[r];return s}createPointerEvent(t,s,r){const o=this.allocateEvent(Js);return this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t,o.target=r??this.hitTest(o.global.x,o.global.y)??this._hitElements[0],typeof s=="string"&&(o.type=s),o}createWheelEvent(t){const s=this.allocateEvent(ao);return this.copyWheelData(t,s),this.copyMouseData(t,s),this.copyData(t,s),s.nativeEvent=t.nativeEvent,s.originalEvent=t,s.target=this.hitTest(s.global.x,s.global.y),s}clonePointerEvent(t,s){const r=this.allocateEvent(Js);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=s??r.type,r}copyWheelData(t,s){s.deltaMode=t.deltaMode,s.deltaX=t.deltaX,s.deltaY=t.deltaY,s.deltaZ=t.deltaZ}copyPointerData(t,s){t instanceof Js&&s instanceof Js&&(s.pointerId=t.pointerId,s.width=t.width,s.height=t.height,s.isPrimary=t.isPrimary,s.pointerType=t.pointerType,s.pressure=t.pressure,s.tangentialPressure=t.tangentialPressure,s.tiltX=t.tiltX,s.tiltY=t.tiltY,s.twist=t.twist)}copyMouseData(t,s){t instanceof ch&&s instanceof ch&&(s.altKey=t.altKey,s.button=t.button,s.buttons=t.buttons,s.client.copyFrom(t.client),s.ctrlKey=t.ctrlKey,s.metaKey=t.metaKey,s.movement.copyFrom(t.movement),s.screen.copyFrom(t.screen),s.shiftKey=t.shiftKey,s.global.copyFrom(t.global))}copyData(t,s){s.isTrusted=t.isTrusted,s.srcElement=t.srcElement,s.timeStamp=performance.now(),s.type=t.type,s.detail=t.detail,s.view=t.view,s.which=t.which,s.layer.copyFrom(t.layer),s.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const s=this.eventPool.get(t).pop()||new t(this);return s.eventPhase=s.NONE,s.currentTarget=null,s.defaultPrevented=!1,s.path=null,s.target=null,s}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const s=t.constructor;this.eventPool.has(s)||this.eventPool.set(s,[]),this.eventPool.get(s).push(t)}_notifyListeners(t,s){const r=t.currentTarget._events[s];if(r)if("fn"in r)r.once&&t.currentTarget.removeListener(s,r.fn,void 0,!0),r.fn.call(r.context,t);else for(let o=0,a=r.length;o<a&&!t.propagationImmediatelyStopped;o++)r[o].once&&t.currentTarget.removeListener(s,r[o].fn,void 0,!0),r[o].fn.call(r[o].context,t)}}const KB=1,jB={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"},Gg=class og{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new YB(null),mr.init(this),this.autoPreventDefault=!0,this._eventsAdded=!1,this._rootPointerEvent=new Js(null),this._rootWheelEvent=new ao(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.features=new Proxy({...og.defaultEventFeatures},{set:(s,r,o)=>(r==="globalMove"&&(this.rootBoundary.enableGlobalMoveEvents=o),s[r]=o,!0)}),this._onPointerDown=this._onPointerDown.bind(this),this._onPointerMove=this._onPointerMove.bind(this),this._onPointerUp=this._onPointerUp.bind(this),this._onPointerOverOut=this._onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}static get defaultEventMode(){return this._defaultEventMode}init(t){const{canvas:s,resolution:r}=this.renderer;this.setTargetElement(s),this.resolution=r,og._defaultEventMode=t.eventMode??"passive",Object.assign(this.features,t.eventFeatures??{}),this.rootBoundary.enableGlobalMoveEvents=this.features.globalMove}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null,this._currentCursor=null}setCursor(t){t||(t="default");let s=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(s=!1),this._currentCursor===t)return;this._currentCursor=t;const r=this.cursorStyles[t];if(r)switch(typeof r){case"string":s&&(this.domElement.style.cursor=r);break;case"function":r(t);break;case"object":s&&Object.assign(this.domElement.style,r);break}else s&&typeof t=="string"&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}get pointer(){return this._rootPointerEvent}_onPointerDown(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const s=this._normalizeToPointerData(t);this.autoPreventDefault&&s[0].isNormalized&&(t.cancelable||!("cancelable"in t))&&t.preventDefault();for(let r=0,o=s.length;r<o;r++){const a=s[r],h=this._bootstrapEvent(this._rootPointerEvent,a);this.rootBoundary.mapEvent(h)}this.setCursor(this.rootBoundary.cursor)}_onPointerMove(t){if(!this.features.move)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,mr.pointerMoved();const s=this._normalizeToPointerData(t);for(let r=0,o=s.length;r<o;r++){const a=this._bootstrapEvent(this._rootPointerEvent,s[r]);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}_onPointerUp(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;let s=t.target;t.composedPath&&t.composedPath().length>0&&(s=t.composedPath()[0]);const r=s!==this.domElement?"outside":"",o=this._normalizeToPointerData(t);for(let a=0,h=o.length;a<h;a++){const u=this._bootstrapEvent(this._rootPointerEvent,o[a]);u.type+=r,this.rootBoundary.mapEvent(u)}this.setCursor(this.rootBoundary.cursor)}_onPointerOverOut(t){if(!this.features.click)return;this.rootBoundary.rootTarget=this.renderer.lastObjectRendered;const s=this._normalizeToPointerData(t);for(let r=0,o=s.length;r<o;r++){const a=this._bootstrapEvent(this._rootPointerEvent,s[r]);this.rootBoundary.mapEvent(a)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){if(!this.features.wheel)return;const s=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(s)}setTargetElement(t){this._removeEvents(),this.domElement=t,mr.domElement=t,this._addEvents()}_addEvents(){if(this._eventsAdded||!this.domElement)return;mr.addTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this._onPointerMove,!0),this.domElement.addEventListener("pointerdown",this._onPointerDown,!0),this.domElement.addEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this._onPointerOverOut,!0),globalThis.addEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this._onPointerMove,!0),this.domElement.addEventListener("mousedown",this._onPointerDown,!0),this.domElement.addEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this._onPointerOverOut,!0),globalThis.addEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this._onPointerDown,!0),this.domElement.addEventListener("touchend",this._onPointerUp,!0),this.domElement.addEventListener("touchmove",this._onPointerMove,!0))),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this._eventsAdded=!0}_removeEvents(){if(!this._eventsAdded||!this.domElement)return;mr.removeTickerListener();const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction="")),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this._onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this._onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this._onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this._onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this._onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this._onPointerMove,!0),this.domElement.removeEventListener("mousedown",this._onPointerDown,!0),this.domElement.removeEventListener("mouseout",this._onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this._onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this._onPointerUp,!0),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this._onPointerDown,!0),this.domElement.removeEventListener("touchend",this._onPointerUp,!0),this.domElement.removeEventListener("touchmove",this._onPointerMove,!0))),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this._eventsAdded=!1}mapPositionToPoint(t,s,r){const o=this.domElement.isConnected?this.domElement.getBoundingClientRect():{width:this.domElement.width,height:this.domElement.height,left:0,top:0},a=1/this.resolution;t.x=(s-o.left)*(this.domElement.width/o.width)*a,t.y=(r-o.top)*(this.domElement.height/o.height)*a}_normalizeToPointerData(t){const s=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let r=0,o=t.changedTouches.length;r<o;r++){const a=t.changedTouches[r];typeof a.button>"u"&&(a.button=0),typeof a.buttons>"u"&&(a.buttons=1),typeof a.isPrimary>"u"&&(a.isPrimary=t.touches.length===1&&t.type==="touchstart"),typeof a.width>"u"&&(a.width=a.radiusX||1),typeof a.height>"u"&&(a.height=a.radiusY||1),typeof a.tiltX>"u"&&(a.tiltX=0),typeof a.tiltY>"u"&&(a.tiltY=0),typeof a.pointerType>"u"&&(a.pointerType="touch"),typeof a.pointerId>"u"&&(a.pointerId=a.identifier||0),typeof a.pressure>"u"&&(a.pressure=a.force||.5),typeof a.twist>"u"&&(a.twist=0),typeof a.tangentialPressure>"u"&&(a.tangentialPressure=0),typeof a.layerX>"u"&&(a.layerX=a.offsetX=a.clientX),typeof a.layerY>"u"&&(a.layerY=a.offsetY=a.clientY),a.isNormalized=!0,a.type=t.type,s.push(a)}else if(!globalThis.MouseEvent||t instanceof MouseEvent&&(!this.supportsPointerEvents||!(t instanceof globalThis.PointerEvent))){const r=t;typeof r.isPrimary>"u"&&(r.isPrimary=!0),typeof r.width>"u"&&(r.width=1),typeof r.height>"u"&&(r.height=1),typeof r.tiltX>"u"&&(r.tiltX=0),typeof r.tiltY>"u"&&(r.tiltY=0),typeof r.pointerType>"u"&&(r.pointerType="mouse"),typeof r.pointerId>"u"&&(r.pointerId=KB),typeof r.pressure>"u"&&(r.pressure=.5),typeof r.twist>"u"&&(r.twist=0),typeof r.tangentialPressure>"u"&&(r.tangentialPressure=0),r.isNormalized=!0,s.push(r)}else s.push(t);return s}normalizeWheelEvent(t){const s=this._rootWheelEvent;return this._transferMouseData(s,t),s.deltaX=t.deltaX,s.deltaY=t.deltaY,s.deltaZ=t.deltaZ,s.deltaMode=t.deltaMode,this.mapPositionToPoint(s.screen,t.clientX,t.clientY),s.global.copyFrom(s.screen),s.offset.copyFrom(s.screen),s.nativeEvent=t,s.type=t.type,s}_bootstrapEvent(t,s){return t.originalEvent=null,t.nativeEvent=s,t.pointerId=s.pointerId,t.width=s.width,t.height=s.height,t.isPrimary=s.isPrimary,t.pointerType=s.pointerType,t.pressure=s.pressure,t.tangentialPressure=s.tangentialPressure,t.tiltX=s.tiltX,t.tiltY=s.tiltY,t.twist=s.twist,this._transferMouseData(t,s),this.mapPositionToPoint(t.screen,s.clientX,s.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=s.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=jB[t.type]||t.type),t}_transferMouseData(t,s){t.isTrusted=s.isTrusted,t.srcElement=s.srcElement,t.timeStamp=performance.now(),t.type=s.type,t.altKey=s.altKey,t.button=s.button,t.buttons=s.buttons,t.client.x=s.clientX,t.client.y=s.clientY,t.ctrlKey=s.ctrlKey,t.metaKey=s.metaKey,t.movement.x=s.movementX,t.movement.y=s.movementY,t.page.x=s.pageX,t.page.y=s.pageY,t.relatedTarget=null,t.shiftKey=s.shiftKey}};Gg.extension={name:"events",type:[V.WebGLSystem,V.CanvasSystem,V.WebGPUSystem],priority:-1};Gg.defaultEventFeatures={move:!0,globalMove:!0,click:!0,wheel:!0};let DS=Gg;const qB={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,get interactive(){return this.eventMode==="dynamic"||this.eventMode==="static"},set interactive(l){this.eventMode=l?"static":"passive"},_internalEventMode:void 0,get eventMode(){return this._internalEventMode??DS.defaultEventMode},set eventMode(l){this._internalEventMode=l},isInteractive(){return this.eventMode==="static"||this.eventMode==="dynamic"},interactiveChildren:!0,hitArea:null,addEventListener(l,t,s){const r=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,o=typeof s=="object"?s.signal:void 0,a=typeof s=="object"?s.once===!0:!1,h=typeof t=="function"?void 0:t;l=r?`${l}capture`:l;const u=typeof t=="function"?t:t.handleEvent,p=this;o&&o.addEventListener("abort",()=>{p.off(l,u,h)}),a?p.once(l,u,h):p.on(l,u,h)},removeEventListener(l,t,s){const r=typeof s=="boolean"&&s||typeof s=="object"&&s.capture,o=typeof t=="function"?void 0:t;l=r?`${l}capture`:l,t=typeof t=="function"?t:t.handleEvent,this.off(l,t,o)},dispatchEvent(l){if(!(l instanceof Fl))throw new Error("Container cannot propagate events outside of the Federated Events API");return l.defaultPrevented=!1,l.path=null,l.target=this,l.manager.dispatchEvent(l),!l.defaultPrevented}};class BS{constructor(t){this._renderer=t}push(t,s,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",canBundle:!1,action:"pushFilter",container:s,filterEffect:t})}pop(t,s,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}execute(t){t.action==="pushFilter"?this._renderer.filter.push(t):t.action==="popFilter"&&this._renderer.filter.pop()}destroy(){this._renderer=null}}BS.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"filter"};function JB(l,t){t.clear();const s=t.matrix;for(let r=0;r<l.length;r++){const o=l[r];o.globalDisplayStatus<7||(t.matrix=o.worldTransform,t.addBounds(o.bounds))}return t.matrix=s,t}const ZB=new Ul({attributes:{aPosition:{buffer:new Float32Array([0,0,1,0,1,1,0,1]),format:"float32x2",stride:2*4,offset:0}},indexBuffer:new Uint32Array([0,1,2,0,2,3])});class QB{constructor(){this.skip=!1,this.inputTexture=null,this.backTexture=null,this.filters=null,this.bounds=new Yt,this.container=null,this.blendRequired=!1,this.outputRenderSurface=null,this.globalFrame={x:0,y:0,width:0,height:0}}}class FS{constructor(t){this._filterStackIndex=0,this._filterStack=[],this._filterGlobalUniforms=new ns({uInputSize:{value:new Float32Array(4),type:"vec4<f32>"},uInputPixel:{value:new Float32Array(4),type:"vec4<f32>"},uInputClamp:{value:new Float32Array(4),type:"vec4<f32>"},uOutputFrame:{value:new Float32Array(4),type:"vec4<f32>"},uGlobalFrame:{value:new Float32Array(4),type:"vec4<f32>"},uOutputTexture:{value:new Float32Array(4),type:"vec4<f32>"}}),this._globalFilterBindGroup=new Ki({}),this.renderer=t}get activeBackTexture(){var t;return(t=this._activeFilterData)==null?void 0:t.backTexture}push(t){const s=this.renderer,r=t.filterEffect.filters,o=this._pushFilterData();o.skip=!1,o.filters=r,o.container=t.container,o.outputRenderSurface=s.renderTarget.renderSurface;const a=s.renderTarget.renderTarget.colorTexture.source,h=a.resolution,u=a.antialias;if(r.length===0){o.skip=!0;return}const p=o.bounds;if(this._calculateFilterArea(t,p),this._calculateFilterBounds(o,s.renderTarget.rootViewPort,u,h,1),o.skip)return;const f=this._getPreviousFilterData(),g=this._findFilterResolution(h);let _=0,$=0;f&&(_=f.bounds.minX,$=f.bounds.minY),this._calculateGlobalFrame(o,_,$,g,a.width,a.height),this._setupFilterTextures(o,p,s,f)}generateFilteredTexture({texture:t,filters:s}){const r=this._pushFilterData();this._activeFilterData=r,r.skip=!1,r.filters=s;const o=t.source,a=o.resolution,h=o.antialias;if(s.length===0)return r.skip=!0,t;const u=r.bounds;if(u.addRect(t.frame),this._calculateFilterBounds(r,u.rectangle,h,a,0),r.skip)return t;const p=a;this._calculateGlobalFrame(r,0,0,p,o.width,o.height),r.outputRenderSurface=zt.getOptimalTexture(u.width,u.height,r.resolution,r.antialias),r.backTexture=me.EMPTY,r.inputTexture=t,this.renderer.renderTarget.finishRenderPass(),this._applyFiltersToTexture(r,!0);const $=r.outputRenderSurface;return $.source.alphaMode="premultiplied-alpha",$}pop(){const t=this.renderer,s=this._popFilterData();s.skip||(t.globalUniforms.pop(),t.renderTarget.finishRenderPass(),this._activeFilterData=s,this._applyFiltersToTexture(s,!1),s.blendRequired&&zt.returnTexture(s.backTexture),zt.returnTexture(s.inputTexture))}getBackTexture(t,s,r){const o=t.colorTexture.source._resolution,a=zt.getOptimalTexture(s.width,s.height,o,!1);let h=s.minX,u=s.minY;r&&(h-=r.minX,u-=r.minY),h=Math.floor(h*o),u=Math.floor(u*o);const p=Math.ceil(s.width*o),f=Math.ceil(s.height*o);return this.renderer.renderTarget.copyToTexture(t,a,{x:h,y:u},{width:p,height:f},{x:0,y:0}),a}applyFilter(t,s,r,o){const a=this.renderer,h=this._activeFilterData,p=h.outputRenderSurface===r,f=a.renderTarget.rootRenderTarget.colorTexture.source._resolution,g=this._findFilterResolution(f);let _=0,$=0;if(p){const E=this._findPreviousFilterOffset();_=E.x,$=E.y}this._updateFilterUniforms(s,r,h,_,$,g,p,o),this._setupBindGroupsAndRender(t,s,a)}calculateSpriteMatrix(t,s){const r=this._activeFilterData,o=t.set(r.inputTexture._source.width,0,0,r.inputTexture._source.height,r.bounds.minX,r.bounds.minY),a=s.worldTransform.copyTo(Te.shared),h=s.renderGroup||s.parentRenderGroup;return h&&h.cacheToLocalTransform&&a.prepend(h.cacheToLocalTransform),a.invert(),o.prepend(a),o.scale(1/s.texture.frame.width,1/s.texture.frame.height),o.translate(s.anchor.x,s.anchor.y),o}destroy(){}_setupBindGroupsAndRender(t,s,r){if(r.renderPipes.uniformBatch){const o=r.renderPipes.uniformBatch.getUboResource(this._filterGlobalUniforms);this._globalFilterBindGroup.setResource(o,0)}else this._globalFilterBindGroup.setResource(this._filterGlobalUniforms,0);this._globalFilterBindGroup.setResource(s.source,1),this._globalFilterBindGroup.setResource(s.source.style,2),t.groups[0]=this._globalFilterBindGroup,r.encoder.draw({geometry:ZB,shader:t,state:t._state,topology:"triangle-list"}),r.type===ei.WEBGL&&r.renderTarget.finishRenderPass()}_setupFilterTextures(t,s,r,o){if(t.backTexture=me.EMPTY,t.blendRequired){r.renderTarget.finishRenderPass();const a=r.renderTarget.getRenderTarget(t.outputRenderSurface);t.backTexture=this.getBackTexture(a,s,o==null?void 0:o.bounds)}t.inputTexture=zt.getOptimalTexture(s.width,s.height,t.resolution,t.antialias),r.renderTarget.bind(t.inputTexture,!0),r.globalUniforms.push({offset:s})}_calculateGlobalFrame(t,s,r,o,a,h){const u=t.globalFrame;u.x=s*o,u.y=r*o,u.width=a*o,u.height=h*o}_updateFilterUniforms(t,s,r,o,a,h,u,p){const f=this._filterGlobalUniforms.uniforms,g=f.uOutputFrame,_=f.uInputSize,$=f.uInputPixel,E=f.uInputClamp,v=f.uGlobalFrame,w=f.uOutputTexture;u?(g[0]=r.bounds.minX-o,g[1]=r.bounds.minY-a):(g[0]=0,g[1]=0),g[2]=t.frame.width,g[3]=t.frame.height,_[0]=t.source.width,_[1]=t.source.height,_[2]=1/_[0],_[3]=1/_[1],$[0]=t.source.pixelWidth,$[1]=t.source.pixelHeight,$[2]=1/$[0],$[3]=1/$[1],E[0]=.5*$[2],E[1]=.5*$[3],E[2]=t.frame.width*_[2]-.5*$[2],E[3]=t.frame.height*_[3]-.5*$[3];const x=this.renderer.renderTarget.rootRenderTarget.colorTexture;v[0]=o*h,v[1]=a*h,v[2]=x.source.width*h,v[3]=x.source.height*h,s instanceof me&&(s.source.resource=null);const C=this.renderer.renderTarget.getRenderTarget(s);this.renderer.renderTarget.bind(s,!!p),s instanceof me?(w[0]=s.frame.width,w[1]=s.frame.height):(w[0]=C.width,w[1]=C.height),w[2]=C.isRoot?-1:1,this._filterGlobalUniforms.update()}_findFilterResolution(t){let s=this._filterStackIndex-1;for(;s>0&&this._filterStack[s].skip;)--s;return s>0&&this._filterStack[s].inputTexture?this._filterStack[s].inputTexture.source._resolution:t}_findPreviousFilterOffset(){let t=0,s=0,r=this._filterStackIndex;for(;r>0;){r--;const o=this._filterStack[r];if(!o.skip){t=o.bounds.minX,s=o.bounds.minY;break}}return{x:t,y:s}}_calculateFilterArea(t,s){if(t.renderables?JB(t.renderables,s):t.filterEffect.filterArea?(s.clear(),s.addRect(t.filterEffect.filterArea),s.applyMatrix(t.container.worldTransform)):t.container.getFastGlobalBounds(!0,s),t.container){const o=(t.container.renderGroup||t.container.parentRenderGroup).cacheToLocalTransform;o&&s.applyMatrix(o)}}_applyFiltersToTexture(t,s){const r=t.inputTexture,o=t.bounds,a=t.filters;if(this._globalFilterBindGroup.setResource(r.source.style,2),this._globalFilterBindGroup.setResource(t.backTexture.source,3),a.length===1)a[0].apply(this,r,t.outputRenderSurface,s);else{let h=t.inputTexture;const u=zt.getOptimalTexture(o.width,o.height,h.source._resolution,!1);let p=u,f=0;for(f=0;f<a.length-1;++f){a[f].apply(this,h,p,!0);const _=h;h=p,p=_}a[f].apply(this,h,t.outputRenderSurface,s),zt.returnTexture(u)}}_calculateFilterBounds(t,s,r,o,a){var w;const h=this.renderer,u=t.bounds,p=t.filters;let f=1/0,g=0,_=!0,$=!1,E=!1,v=!0;for(let x=0;x<p.length;x++){const C=p[x];if(f=Math.min(f,C.resolution==="inherit"?o:C.resolution),g+=C.padding,C.antialias==="off"?_=!1:C.antialias==="inherit"&&_&&(_=r),C.clipToViewport||(v=!1),!!!(C.compatibleRenderers&h.type)){E=!1;break}if(C.blendRequired&&!(((w=h.backBuffer)==null?void 0:w.useBackBuffer)??!0)){we("Blend filter requires backBuffer on WebGL renderer to be enabled. Set `useBackBuffer: true` in the renderer options."),E=!1;break}E=C.enabled||E,$||($=C.blendRequired)}if(!E){t.skip=!0;return}if(v&&u.fitBounds(0,s.width/o,0,s.height/o),u.scale(f).ceil().scale(1/f).pad((g|0)*a),!u.isPositive){t.skip=!0;return}t.antialias=_,t.resolution=f,t.blendRequired=$}_popFilterData(){return this._filterStackIndex--,this._filterStack[this._filterStackIndex]}_getPreviousFilterData(){let t,s=this._filterStackIndex-1;for(;s>1&&(s--,t=this._filterStack[s],!!t.skip););return t}_pushFilterData(){let t=this._filterStack[this._filterStackIndex];return t||(t=this._filterStack[this._filterStackIndex]=new QB),this._filterStackIndex++,t}}FS.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"filter"};var e1=`in vec2 vMaskCoord;
in vec2 vTextureCoord;

uniform sampler2D uTexture;
uniform sampler2D uMaskTexture;

uniform float uAlpha;
uniform vec4 uMaskClamp;
uniform float uInverse;

out vec4 finalColor;

void main(void)
{
    float clip = step(3.5,
        step(uMaskClamp.x, vMaskCoord.x) +
        step(uMaskClamp.y, vMaskCoord.y) +
        step(vMaskCoord.x, uMaskClamp.z) +
        step(vMaskCoord.y, uMaskClamp.w));

    // TODO look into why this is needed
    float npmAlpha = uAlpha;
    vec4 original = texture(uTexture, vTextureCoord);
    vec4 masky = texture(uMaskTexture, vMaskCoord);
    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);

    float a = alphaMul * masky.r * npmAlpha * clip;

    if (uInverse == 1.0) {
        a = 1.0 - a;
    }

    finalColor = original * a;
}
`,t1=`in vec2 aPosition;

out vec2 vTextureCoord;
out vec2 vMaskCoord;


uniform vec4 uInputSize;
uniform vec4 uOutputFrame;
uniform vec4 uOutputTexture;
uniform mat3 uFilterMatrix;

vec4 filterVertexPosition(  vec2 aPosition )
{
    vec2 position = aPosition * uOutputFrame.zw + uOutputFrame.xy;
       
    position.x = position.x * (2.0 / uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*uOutputTexture.z / uOutputTexture.y) - uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

vec2 filterTextureCoord(  vec2 aPosition )
{
    return aPosition * (uOutputFrame.zw * uInputSize.zw);
}

vec2 getFilterCoord( vec2 aPosition )
{
    return  ( uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}   

void main(void)
{
    gl_Position = filterVertexPosition(aPosition);
    vTextureCoord = filterTextureCoord(aPosition);
    vMaskCoord = getFilterCoord(aPosition);
}
`,ky=`struct GlobalFilterUniforms {
  uInputSize:vec4<f32>,
  uInputPixel:vec4<f32>,
  uInputClamp:vec4<f32>,
  uOutputFrame:vec4<f32>,
  uGlobalFrame:vec4<f32>,
  uOutputTexture:vec4<f32>,
};

struct MaskUniforms {
  uFilterMatrix:mat3x3<f32>,
  uMaskClamp:vec4<f32>,
  uAlpha:f32,
  uInverse:f32,
};

@group(0) @binding(0) var<uniform> gfu: GlobalFilterUniforms;
@group(0) @binding(1) var uTexture: texture_2d<f32>;
@group(0) @binding(2) var uSampler : sampler;

@group(1) @binding(0) var<uniform> filterUniforms : MaskUniforms;
@group(1) @binding(1) var uMaskTexture: texture_2d<f32>;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) filterUv : vec2<f32>,
};

fn filterVertexPosition(aPosition:vec2<f32>) -> vec4<f32>
{
    var position = aPosition * gfu.uOutputFrame.zw + gfu.uOutputFrame.xy;

    position.x = position.x * (2.0 / gfu.uOutputTexture.x) - 1.0;
    position.y = position.y * (2.0*gfu.uOutputTexture.z / gfu.uOutputTexture.y) - gfu.uOutputTexture.z;

    return vec4(position, 0.0, 1.0);
}

fn filterTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
    return aPosition * (gfu.uOutputFrame.zw * gfu.uInputSize.zw);
}

fn globalTextureCoord( aPosition:vec2<f32> ) -> vec2<f32>
{
  return  (aPosition.xy / gfu.uGlobalFrame.zw) + (gfu.uGlobalFrame.xy / gfu.uGlobalFrame.zw);
}

fn getFilterCoord(aPosition:vec2<f32> ) -> vec2<f32>
{
  return ( filterUniforms.uFilterMatrix * vec3( filterTextureCoord(aPosition), 1.0)  ).xy;
}

fn getSize() -> vec2<f32>
{
  return gfu.uGlobalFrame.zw;
}

@vertex
fn mainVertex(
  @location(0) aPosition : vec2<f32>,
) -> VSOutput {
  return VSOutput(
   filterVertexPosition(aPosition),
   filterTextureCoord(aPosition),
   getFilterCoord(aPosition)
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) filterUv: vec2<f32>,
  @builtin(position) position: vec4<f32>
) -> @location(0) vec4<f32> {

    var maskClamp = filterUniforms.uMaskClamp;
    var uAlpha = filterUniforms.uAlpha;

    var clip = step(3.5,
      step(maskClamp.x, filterUv.x) +
      step(maskClamp.y, filterUv.y) +
      step(filterUv.x, maskClamp.z) +
      step(filterUv.y, maskClamp.w));

    var mask = textureSample(uMaskTexture, uSampler, filterUv);
    var source = textureSample(uTexture, uSampler, uv);
    var alphaMul = 1.0 - uAlpha * (1.0 - mask.a);

    var a: f32 = alphaMul * mask.r * uAlpha * clip;

    if (filterUniforms.uInverse == 1.0) {
        a = 1.0 - a;
    }

    return source * a;
}
`;class s1 extends IN{constructor(t){const{sprite:s,...r}=t,o=new Ev(s.texture),a=new ns({uFilterMatrix:{value:new Te,type:"mat3x3<f32>"},uMaskClamp:{value:o.uClampFrame,type:"vec4<f32>"},uAlpha:{value:1,type:"f32"},uInverse:{value:t.inverse?1:0,type:"f32"}}),h=hn.from({vertex:{source:ky,entryPoint:"mainVertex"},fragment:{source:ky,entryPoint:"mainFragment"}}),u=ho.from({vertex:t1,fragment:e1,name:"mask-filter"});super({...r,gpuProgram:h,glProgram:u,resources:{filterUniforms:a,uMaskTexture:s.texture.source}}),this.sprite=s,this._textureMatrix=o}set inverse(t){this.resources.filterUniforms.uniforms.uInverse=t?1:0}get inverse(){return this.resources.filterUniforms.uniforms.uInverse===1}apply(t,s,r,o){this._textureMatrix.texture=this.sprite.texture,t.calculateSpriteMatrix(this.resources.filterUniforms.uniforms.uFilterMatrix,this.sprite).prepend(this._textureMatrix.mapCoord),this.resources.uMaskTexture=this.sprite.texture.source,t.applyFilter(this,s,r,o)}}class yt extends Av{constructor(t){t instanceof Zs&&(t={context:t});const{context:s,roundPixels:r,...o}=t||{};super({label:"Graphics",...o}),this.renderPipeId="graphics",s?this._context=s:this._context=this._ownedContext=new Zs,this._context.on("update",this.onViewUpdate,this),this.didViewUpdate=!0,this.allowChildren=!1,this.roundPixels=r??!1}set context(t){t!==this._context&&(this._context.off("update",this.onViewUpdate,this),this._context=t,this._context.on("update",this.onViewUpdate,this),this.onViewUpdate())}get context(){return this._context}get bounds(){return this._context.bounds}updateBounds(){}containsPoint(t){return this._context.containsPoint(t)}destroy(t){this._ownedContext&&!t?this._ownedContext.destroy(t):(t===!0||(t==null?void 0:t.context)===!0)&&this._context.destroy(t),this._ownedContext=null,this._context=null,super.destroy(t)}_callContextMethod(t,s){return this.context[t](...s),this}setFillStyle(...t){return this._callContextMethod("setFillStyle",t)}setStrokeStyle(...t){return this._callContextMethod("setStrokeStyle",t)}fill(...t){return this._callContextMethod("fill",t)}stroke(...t){return this._callContextMethod("stroke",t)}texture(...t){return this._callContextMethod("texture",t)}beginPath(){return this._callContextMethod("beginPath",[])}cut(){return this._callContextMethod("cut",[])}arc(...t){return this._callContextMethod("arc",t)}arcTo(...t){return this._callContextMethod("arcTo",t)}arcToSvg(...t){return this._callContextMethod("arcToSvg",t)}bezierCurveTo(...t){return this._callContextMethod("bezierCurveTo",t)}closePath(){return this._callContextMethod("closePath",[])}ellipse(...t){return this._callContextMethod("ellipse",t)}circle(...t){return this._callContextMethod("circle",t)}path(...t){return this._callContextMethod("path",t)}lineTo(...t){return this._callContextMethod("lineTo",t)}moveTo(...t){return this._callContextMethod("moveTo",t)}quadraticCurveTo(...t){return this._callContextMethod("quadraticCurveTo",t)}rect(...t){return this._callContextMethod("rect",t)}roundRect(...t){return this._callContextMethod("roundRect",t)}poly(...t){return this._callContextMethod("poly",t)}regularPoly(...t){return this._callContextMethod("regularPoly",t)}roundPoly(...t){return this._callContextMethod("roundPoly",t)}roundShape(...t){return this._callContextMethod("roundShape",t)}filletRect(...t){return this._callContextMethod("filletRect",t)}chamferRect(...t){return this._callContextMethod("chamferRect",t)}star(...t){return this._callContextMethod("star",t)}svg(...t){return this._callContextMethod("svg",t)}restore(...t){return this._callContextMethod("restore",t)}save(){return this._callContextMethod("save",[])}getTransform(){return this.context.getTransform()}resetTransform(){return this._callContextMethod("resetTransform",[])}rotateTransform(...t){return this._callContextMethod("rotate",t)}scaleTransform(...t){return this._callContextMethod("scale",t)}setTransform(...t){return this._callContextMethod("setTransform",t)}transform(...t){return this._callContextMethod("transform",t)}translateTransform(...t){return this._callContextMethod("translate",t)}clear(){return this._callContextMethod("clear",[])}get fillStyle(){return this._context.fillStyle}set fillStyle(t){this._context.fillStyle=t}get strokeStyle(){return this._context.strokeStyle}set strokeStyle(t){this._context.strokeStyle=t}clone(t=!1){return t?new yt(this._context.clone()):(this._ownedContext=null,new yt(this._context))}lineStyle(t,s,r){ke(He,"Graphics#lineStyle is no longer needed. Use Graphics#setStrokeStyle to set the stroke style.");const o={};return t&&(o.width=t),s&&(o.color=s),r&&(o.alpha=r),this.context.strokeStyle=o,this}beginFill(t,s){ke(He,"Graphics#beginFill is no longer needed. Use Graphics#fill to fill the shape with the desired style.");const r={};return t!==void 0&&(r.color=t),s!==void 0&&(r.alpha=s),this.context.fillStyle=r,this}endFill(){ke(He,"Graphics#endFill is no longer needed. Use Graphics#fill to fill the shape with the desired style."),this.context.fill();const t=this.context.strokeStyle;return(t.width!==Zs.defaultStrokeStyle.width||t.color!==Zs.defaultStrokeStyle.color||t.alpha!==Zs.defaultStrokeStyle.alpha)&&this.context.stroke(),this}drawCircle(...t){return ke(He,"Graphics#drawCircle has been renamed to Graphics#circle"),this._callContextMethod("circle",t)}drawEllipse(...t){return ke(He,"Graphics#drawEllipse has been renamed to Graphics#ellipse"),this._callContextMethod("ellipse",t)}drawPolygon(...t){return ke(He,"Graphics#drawPolygon has been renamed to Graphics#poly"),this._callContextMethod("poly",t)}drawRect(...t){return ke(He,"Graphics#drawRect has been renamed to Graphics#rect"),this._callContextMethod("rect",t)}drawRoundedRect(...t){return ke(He,"Graphics#drawRoundedRect has been renamed to Graphics#roundRect"),this._callContextMethod("roundRect",t)}drawStar(...t){return ke(He,"Graphics#drawStar has been renamed to Graphics#star"),this._callContextMethod("star",t)}}const US=class GS extends Ul{constructor(...t){let s=t[0]??{};s instanceof Float32Array&&(ke(He,"use new MeshGeometry({ positions, uvs, indices }) instead"),s={positions:s,uvs:t[1],indices:t[2]}),s={...GS.defaultOptions,...s};const r=s.positions||new Float32Array([0,0,1,0,1,1,0,1]);let o=s.uvs;o||(s.positions?o=new Float32Array(r.length):o=new Float32Array([0,0,1,0,1,1,0,1]));const a=s.indices||new Uint32Array([0,1,2,0,2,3]),h=s.shrinkBuffersToFit,u=new Ss({data:r,label:"attribute-mesh-positions",shrinkToFit:h,usage:Me.VERTEX|Me.COPY_DST}),p=new Ss({data:o,label:"attribute-mesh-uvs",shrinkToFit:h,usage:Me.VERTEX|Me.COPY_DST}),f=new Ss({data:a,label:"index-mesh-buffer",shrinkToFit:h,usage:Me.INDEX|Me.COPY_DST});super({attributes:{aPosition:{buffer:u,format:"float32x2",stride:2*4,offset:0},aUV:{buffer:p,format:"float32x2",stride:2*4,offset:0}},indexBuffer:f,topology:s.topology}),this.batchMode="auto"}get positions(){return this.attributes.aPosition.buffer.data}set positions(t){this.attributes.aPosition.buffer.data=t}get uvs(){return this.attributes.aUV.buffer.data}set uvs(t){this.attributes.aUV.buffer.data=t}get indices(){return this.indexBuffer.data}set indices(t){this.indexBuffer.data=t}};US.defaultOptions={topology:"triangle-list",shrinkBuffersToFit:!1};let Hg=US,qr=null,Vi=null;function i1(l,t){qr||(qr=it.get().createCanvas(256,128),Vi=qr.getContext("2d",{willReadFrequently:!0}),Vi.globalCompositeOperation="copy",Vi.globalAlpha=1),(qr.width<l||qr.height<t)&&(qr.width=ro(l),qr.height=ro(t))}function Oy(l,t,s){for(let r=0,o=4*s*t;r<t;++r,o+=4)if(l[o+3]!==0)return!1;return!0}function Ay(l,t,s,r,o){const a=4*t;for(let h=r,u=r*a+4*s;h<=o;++h,u+=a)if(l[u+3]!==0)return!1;return!0}function r1(...l){let t=l[0];t.canvas||(t={canvas:l[0],resolution:l[1]});const{canvas:s}=t,r=Math.min(t.resolution??1,1),o=t.width??s.width,a=t.height??s.height;let h=t.output;if(i1(o,a),!Vi)throw new TypeError("Failed to get canvas 2D context");Vi.drawImage(s,0,0,o,a,0,0,o*r,a*r);const p=Vi.getImageData(0,0,o,a).data;let f=0,g=0,_=o-1,$=a-1;for(;g<a&&Oy(p,o,g);)++g;if(g===a)return Fe.EMPTY;for(;Oy(p,o,$);)--$;for(;Ay(p,o,f,g,$);)++f;for(;Ay(p,o,_,g,$);)--_;return++_,++$,Vi.globalCompositeOperation="source-over",Vi.strokeRect(f,g,_-f,$-g),Vi.globalCompositeOperation="copy",h??(h=new Fe),h.set(f/r,g/r,(_-f)/r,($-g)/r),h}const My=new Fe;class n1{getCanvasAndContext(t){const{text:s,style:r,resolution:o=1}=t,a=r._getFinalPadding(),h=Ei.measureText(s||" ",r),u=Math.ceil(Math.ceil(Math.max(1,h.width)+a*2)*o),p=Math.ceil(Math.ceil(Math.max(1,h.height)+a*2)*o),f=br.getOptimalCanvasAndContext(u,p);this._renderTextToCanvas(s,r,a,o,f);const g=r.trim?r1({canvas:f.canvas,width:u,height:p,resolution:1,output:My}):My.set(0,0,u,p);return{canvasAndContext:f,frame:g}}returnCanvasAndContext(t){br.returnCanvasAndContext(t)}_renderTextToCanvas(t,s,r,o,a){var A,D,G,M;const{canvas:h,context:u}=a,p=oh(s),f=Ei.measureText(t||" ",s),g=f.lines,_=f.lineHeight,$=f.lineWidths,E=f.maxLineWidth,v=f.fontProperties,w=h.height;if(u.resetTransform(),u.scale(o,o),u.textBaseline=s.textBaseline,(A=s._stroke)!=null&&A.width){const k=s._stroke;u.lineWidth=k.width,u.miterLimit=k.miterLimit,u.lineJoin=k.join,u.lineCap=k.cap}u.font=p;let x,C;const R=s.dropShadow?2:1;for(let k=0;k<R;++k){const z=s.dropShadow&&k===0,se=z?Math.ceil(Math.max(1,w)+r*2):0,Q=se*o;if(z){u.fillStyle="black",u.strokeStyle="black";const ge=s.dropShadow,ue=ge.color,St=ge.alpha;u.shadowColor=We.shared.setValue(ue).setAlpha(St).toRgbaString();const pe=ge.blur*o,be=ge.distance*o;u.shadowBlur=pe,u.shadowOffsetX=Math.cos(ge.angle)*be,u.shadowOffsetY=Math.sin(ge.angle)*be+Q}else{if(u.fillStyle=s._fill?ah(s._fill,u,f):null,(D=s._stroke)!=null&&D.width){const ge=s._stroke.width*s._stroke.alignment;u.strokeStyle=ah(s._stroke,u,f,ge)}u.shadowColor="black"}let ie=(_-v.fontSize)/2;_-v.fontSize<0&&(ie=0);const _e=((G=s._stroke)==null?void 0:G.width)??0;for(let ge=0;ge<g.length;ge++)x=_e/2,C=_e/2+ge*_+v.ascent+ie,s.align==="right"?x+=E-$[ge]:s.align==="center"&&(x+=(E-$[ge])/2),(M=s._stroke)!=null&&M.width&&this._drawLetterSpacing(g[ge],s,a,x+r,C+r-se,!0),s._fill!==void 0&&this._drawLetterSpacing(g[ge],s,a,x+r,C+r-se)}}_drawLetterSpacing(t,s,r,o,a,h=!1){const{context:u}=r,p=s.letterSpacing;let f=!1;if(Ei.experimentalLetterSpacingSupported&&(Ei.experimentalLetterSpacing?(u.letterSpacing=`${p}px`,u.textLetterSpacing=`${p}px`,f=!0):(u.letterSpacing="0px",u.textLetterSpacing="0px")),p===0||f){h?u.strokeText(t,o,a):u.fillText(t,o,a);return}let g=o;const _=Ei.graphemeSegmenter(t);let $=u.measureText(t).width,E=0;for(let v=0;v<_.length;++v){const w=_[v];h?u.strokeText(w,g,a):u.fillText(w,g,a);let x="";for(let C=v+1;C<_.length;++C)x+=_[C];E=u.measureText(x).width,g+=$-E+p,$=E}}}const Af=new n1;function o1(l){const t=l._stroke,s=l._fill,o=[`div { ${[`color: ${We.shared.setValue(s.color).toHex()}`,`font-size: ${l.fontSize}px`,`font-family: ${l.fontFamily}`,`font-weight: ${l.fontWeight}`,`font-style: ${l.fontStyle}`,`font-variant: ${l.fontVariant}`,`letter-spacing: ${l.letterSpacing}px`,`text-align: ${l.align}`,`padding: ${l.padding}px`,`white-space: ${l.whiteSpace==="pre"&&l.wordWrap?"pre-wrap":l.whiteSpace}`,...l.lineHeight?[`line-height: ${l.lineHeight}px`]:[],...l.wordWrap?[`word-wrap: ${l.breakWords?"break-all":"break-word"}`,`max-width: ${l.wordWrapWidth}px`]:[],...t?[VS(t)]:[],...l.dropShadow?[HS(l.dropShadow)]:[],...l.cssOverrides].join(";")} }`];return l1(l.tagStyles,o),o.join(" ")}function HS(l){const t=We.shared.setValue(l.color).setAlpha(l.alpha).toHexa(),s=Math.round(Math.cos(l.angle)*l.distance),r=Math.round(Math.sin(l.angle)*l.distance),o=`${s}px ${r}px`;return l.blur>0?`text-shadow: ${o} ${l.blur}px ${t}`:`text-shadow: ${o} ${t}`}function VS(l){return[`-webkit-text-stroke-width: ${l.width}px`,`-webkit-text-stroke-color: ${We.shared.setValue(l.color).toHex()}`,`text-stroke-width: ${l.width}px`,`text-stroke-color: ${We.shared.setValue(l.color).toHex()}`,"paint-order: stroke"].join(";")}const Ly={fontSize:"font-size: {{VALUE}}px",fontFamily:"font-family: {{VALUE}}",fontWeight:"font-weight: {{VALUE}}",fontStyle:"font-style: {{VALUE}}",fontVariant:"font-variant: {{VALUE}}",letterSpacing:"letter-spacing: {{VALUE}}px",align:"text-align: {{VALUE}}",padding:"padding: {{VALUE}}px",whiteSpace:"white-space: {{VALUE}}",lineHeight:"line-height: {{VALUE}}px",wordWrapWidth:"max-width: {{VALUE}}px"},Py={fill:l=>`color: ${We.shared.setValue(l).toHex()}`,breakWords:l=>`word-wrap: ${l?"break-all":"break-word"}`,stroke:VS,dropShadow:HS};function l1(l,t){for(const s in l){const r=l[s],o=[];for(const a in r)Py[a]?o.push(Py[a](r[a])):Ly[a]&&o.push(Ly[a].replace("{{VALUE}}",r[a]));t.push(`${s} { ${o.join(";")} }`)}}class Vg extends Tr{constructor(t={}){super(t),this._cssOverrides=[],this.cssOverrides=t.cssOverrides??[],this.tagStyles=t.tagStyles??{}}set cssOverrides(t){this._cssOverrides=t instanceof Array?t:[t],this.update()}get cssOverrides(){return this._cssOverrides}update(){this._cssStyle=null,super.update()}clone(){return new Vg({align:this.align,breakWords:this.breakWords,dropShadow:this.dropShadow?{...this.dropShadow}:null,fill:this._fill,fontFamily:this.fontFamily,fontSize:this.fontSize,fontStyle:this.fontStyle,fontVariant:this.fontVariant,fontWeight:this.fontWeight,letterSpacing:this.letterSpacing,lineHeight:this.lineHeight,padding:this.padding,stroke:this._stroke,whiteSpace:this.whiteSpace,wordWrap:this.wordWrap,wordWrapWidth:this.wordWrapWidth,cssOverrides:this.cssOverrides,tagStyles:{...this.tagStyles}})}get cssStyle(){return this._cssStyle||(this._cssStyle=o1(this)),this._cssStyle}addOverride(...t){const s=t.filter(r=>!this.cssOverrides.includes(r));s.length>0&&(this.cssOverrides.push(...s),this.update())}removeOverride(...t){const s=t.filter(r=>this.cssOverrides.includes(r));s.length>0&&(this.cssOverrides=this.cssOverrides.filter(r=>!s.includes(r)),this.update())}set fill(t){typeof t!="string"&&typeof t!="number"&&we("[HTMLTextStyle] only color fill is not supported by HTMLText"),super.fill=t}set stroke(t){t&&typeof t!="string"&&typeof t!="number"&&we("[HTMLTextStyle] only color stroke is not supported by HTMLText"),super.stroke=t}}const Ny="http://www.w3.org/2000/svg",Dy="http://www.w3.org/1999/xhtml";class WS{constructor(){this.svgRoot=document.createElementNS(Ny,"svg"),this.foreignObject=document.createElementNS(Ny,"foreignObject"),this.domElement=document.createElementNS(Dy,"div"),this.styleElement=document.createElementNS(Dy,"style"),this.image=new Image;const{foreignObject:t,svgRoot:s,styleElement:r,domElement:o}=this;t.setAttribute("width","10000"),t.setAttribute("height","10000"),t.style.overflow="hidden",s.appendChild(t),t.appendChild(r),t.appendChild(o)}}let By;function a1(l,t,s,r){r||(r=By||(By=new WS));const{domElement:o,styleElement:a,svgRoot:h}=r;o.innerHTML=`<style>${t.cssStyle};</style><div style='padding:0'>${l}</div>`,o.setAttribute("style","transform-origin: top left; display: inline-block"),s&&(a.textContent=s),document.body.appendChild(h);const u=o.getBoundingClientRect();h.remove();const p=t.padding*2;return{width:u.width-p,height:u.height-p}}class zS{constructor(){this._tempState=ti.for2d(),this._didUploadHash={}}init(t){t.renderer.runners.contextChange.add(this)}contextChange(){this._didUploadHash={}}start(t,s,r){const o=t.renderer,a=this._didUploadHash[r.uid];o.shader.bind(r,a),a||(this._didUploadHash[r.uid]=!0),o.shader.updateUniformGroup(o.globalUniforms.uniformGroup),o.geometry.bind(s,r.glProgram)}execute(t,s){const r=t.renderer;this._tempState.blendMode=s.blendMode,r.state.set(this._tempState);const o=s.textures.textures;for(let a=0;a<s.textures.count;a++)r.texture.bind(o[a],a);r.geometry.draw(s.topology,s.size,s.start)}}zS.extension={type:[V.WebGLPipesAdaptor],name:"batch"};const Wc=ti.for2d();class XS{start(t,s,r){const o=t.renderer,a=o.encoder,h=r.gpuProgram;this._shader=r,this._geometry=s,a.setGeometry(s,h),Wc.blendMode="normal",o.pipeline.getPipeline(s,h,Wc);const u=o.globalUniforms.bindGroup;a.resetBindGroup(1),a.setBindGroup(0,u,h)}execute(t,s){const r=this._shader.gpuProgram,o=t.renderer,a=o.encoder;if(!s.bindGroup){const p=s.textures;s.bindGroup=Rg(p.textures,p.count,o.limits.maxBatchableTextures)}Wc.blendMode=s.blendMode;const h=o.bindGroup.getBindGroup(s.bindGroup,r,1),u=o.pipeline.getPipeline(this._geometry,r,Wc,s.topology);s.bindGroup._touch(o.textureGC.count),a.setPipeline(u),a.renderPassEncoder.setBindGroup(1,h),a.renderPassEncoder.drawIndexed(s.size,1,s.start)}}XS.extension={type:[V.WebGPUPipesAdaptor],name:"batch"};const Wg=class YS{constructor(t,s){var r,o;this.state=ti.for2d(),this._batchersByInstructionSet=Object.create(null),this._activeBatches=Object.create(null),this.renderer=t,this._adaptor=s,(o=(r=this._adaptor).init)==null||o.call(r,this)}static getBatcher(t){return new this._availableBatchers[t]}buildStart(t){let s=this._batchersByInstructionSet[t.uid];s||(s=this._batchersByInstructionSet[t.uid]=Object.create(null),s.default||(s.default=new Pg({maxTextures:this.renderer.limits.maxBatchableTextures}))),this._activeBatches=s,this._activeBatch=this._activeBatches.default;for(const r in this._activeBatches)this._activeBatches[r].begin()}addToBatch(t,s){if(this._activeBatch.name!==t.batcherName){this._activeBatch.break(s);let r=this._activeBatches[t.batcherName];r||(r=this._activeBatches[t.batcherName]=YS.getBatcher(t.batcherName),r.begin()),this._activeBatch=r}this._activeBatch.add(t)}break(t){this._activeBatch.break(t)}buildEnd(t){this._activeBatch.break(t);const s=this._activeBatches;for(const r in s){const o=s[r],a=o.geometry;a.indexBuffer.setDataWithSize(o.indexBuffer,o.indexSize,!0),a.buffers[0].setDataWithSize(o.attributeBuffer.float32View,o.attributeSize,!1)}}upload(t){const s=this._batchersByInstructionSet[t.uid];for(const r in s){const o=s[r],a=o.geometry;o.dirty&&(o.dirty=!1,a.buffers[0].update(o.attributeSize*4))}}execute(t){if(t.action==="startBatch"){const s=t.batcher,r=s.geometry,o=s.shader;this._adaptor.start(this,r,o)}this._adaptor.execute(this,t)}destroy(){this.state=null,this.renderer=null,this._adaptor=null;for(const t in this._activeBatches)this._activeBatches[t].destroy();this._activeBatches=null}};Wg.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"batch"};Wg._availableBatchers=Object.create(null);let KS=Wg;Se.handleByMap(V.Batcher,KS._availableBatchers);Se.add(Pg);const xl={name:"local-uniform-bit",vertex:{header:`

            struct LocalUniforms {
                uTransformMatrix:mat3x3<f32>,
                uColor:vec4<f32>,
                uRound:f32,
            }

            @group(1) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `}},c1={...xl,vertex:{...xl.vertex,header:xl.vertex.header.replace("group(1)","group(2)")}},zg={name:"local-uniform-bit",vertex:{header:`

            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix = uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `}},h1={name:"texture-bit",vertex:{header:`

        struct TextureUniforms {
            uTextureMatrix:mat3x3<f32>,
        }

        @group(2) @binding(2) var<uniform> textureUniforms : TextureUniforms;
        `,main:`
            uv = (textureUniforms.uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
            @group(2) @binding(0) var uTexture: texture_2d<f32>;
            @group(2) @binding(1) var uSampler: sampler;


        `,main:`
            outColor = textureSample(uTexture, uSampler, vUV);
        `}},u1={name:"texture-bit",vertex:{header:`
            uniform mat3 uTextureMatrix;
        `,main:`
            uv = (uTextureMatrix * vec3(uv, 1.0)).xy;
        `},fragment:{header:`
        uniform sampler2D uTexture;


        `,main:`
            outColor = texture(uTexture, vUV);
        `}},d1=new Yt;class p1 extends sh{constructor(){super(),this.filters=[new s1({sprite:new Mt(me.EMPTY),inverse:!1,resolution:"inherit",antialias:"inherit"})]}get sprite(){return this.filters[0].sprite}set sprite(t){this.filters[0].sprite=t}get inverse(){return this.filters[0].inverse}set inverse(t){this.filters[0].inverse=t}}class jS{constructor(t){this._activeMaskStage=[],this._renderer=t}push(t,s,r){const o=this._renderer;if(o.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskBegin",mask:t,inverse:s._maskOptions.inverse,canBundle:!1,maskedContainer:s}),t.inverse=s._maskOptions.inverse,t.renderMaskToTexture){const a=t.mask;a.includeInBuild=!0,a.collectRenderables(r,o,null),a.includeInBuild=!1}o.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"pushMaskEnd",mask:t,maskedContainer:s,inverse:s._maskOptions.inverse,canBundle:!1})}pop(t,s,r){this._renderer.renderPipes.batch.break(r),r.add({renderPipeId:"alphaMask",action:"popMaskEnd",mask:t,inverse:s._maskOptions.inverse,canBundle:!1})}execute(t){const s=this._renderer,r=t.mask.renderMaskToTexture;if(t.action==="pushMaskBegin"){const o=Pt.get(p1);if(o.inverse=t.inverse,r){t.mask.mask.measurable=!0;const a=bg(t.mask.mask,!0,d1);t.mask.mask.measurable=!1,a.ceil();const h=s.renderTarget.renderTarget.colorTexture.source,u=zt.getOptimalTexture(a.width,a.height,h._resolution,h.antialias);s.renderTarget.push(u,!0),s.globalUniforms.push({offset:a,worldColor:4294967295});const p=o.sprite;p.texture=u,p.worldTransform.tx=a.minX,p.worldTransform.ty=a.minY,this._activeMaskStage.push({filterEffect:o,maskedContainer:t.maskedContainer,filterTexture:u})}else o.sprite=t.mask.mask,this._activeMaskStage.push({filterEffect:o,maskedContainer:t.maskedContainer})}else if(t.action==="pushMaskEnd"){const o=this._activeMaskStage[this._activeMaskStage.length-1];r&&(s.type===ei.WEBGL&&s.renderTarget.finishRenderPass(),s.renderTarget.pop(),s.globalUniforms.pop()),s.filter.push({renderPipeId:"filter",action:"pushFilter",container:o.maskedContainer,filterEffect:o.filterEffect,canBundle:!1})}else if(t.action==="popMaskEnd"){s.filter.pop();const o=this._activeMaskStage.pop();r&&zt.returnTexture(o.filterTexture),Pt.return(o.filterEffect)}}destroy(){this._renderer=null,this._activeMaskStage=null}}jS.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"alphaMask"};class qS{constructor(t){this._colorStack=[],this._colorStackIndex=0,this._currentColor=0,this._renderer=t}buildStart(){this._colorStack[0]=15,this._colorStackIndex=1,this._currentColor=15}push(t,s,r){this._renderer.renderPipes.batch.break(r);const a=this._colorStack;a[this._colorStackIndex]=a[this._colorStackIndex-1]&t.mask;const h=this._colorStack[this._colorStackIndex];h!==this._currentColor&&(this._currentColor=h,r.add({renderPipeId:"colorMask",colorMask:h,canBundle:!1})),this._colorStackIndex++}pop(t,s,r){this._renderer.renderPipes.batch.break(r);const a=this._colorStack;this._colorStackIndex--;const h=a[this._colorStackIndex-1];h!==this._currentColor&&(this._currentColor=h,r.add({renderPipeId:"colorMask",colorMask:h,canBundle:!1}))}execute(t){this._renderer.colorMask.setMask(t.colorMask)}destroy(){this._colorStack=null}}qS.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"colorMask"};class JS{constructor(t){this._maskStackHash={},this._maskHash=new WeakMap,this._renderer=t}push(t,s,r){var o;const a=t,h=this._renderer;h.renderPipes.batch.break(r),h.renderPipes.blendMode.setBlendMode(a.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"pushMaskBegin",mask:t,inverse:s._maskOptions.inverse,canBundle:!1});const u=a.mask;u.includeInBuild=!0,this._maskHash.has(a)||this._maskHash.set(a,{instructionsStart:0,instructionsLength:0});const p=this._maskHash.get(a);p.instructionsStart=r.instructionSize,u.collectRenderables(r,h,null),u.includeInBuild=!1,h.renderPipes.batch.break(r),r.add({renderPipeId:"stencilMask",action:"pushMaskEnd",mask:t,inverse:s._maskOptions.inverse,canBundle:!1});const f=r.instructionSize-p.instructionsStart-1;p.instructionsLength=f;const g=h.renderTarget.renderTarget.uid;(o=this._maskStackHash)[g]??(o[g]=0)}pop(t,s,r){const o=t,a=this._renderer;a.renderPipes.batch.break(r),a.renderPipes.blendMode.setBlendMode(o.mask,"none",r),r.add({renderPipeId:"stencilMask",action:"popMaskBegin",inverse:s._maskOptions.inverse,canBundle:!1});const h=this._maskHash.get(t);for(let u=0;u<h.instructionsLength;u++)r.instructions[r.instructionSize++]=r.instructions[h.instructionsStart++];r.add({renderPipeId:"stencilMask",action:"popMaskEnd",canBundle:!1})}execute(t){var s;const r=this._renderer,o=r.renderTarget.renderTarget.uid;let a=(s=this._maskStackHash)[o]??(s[o]=0);t.action==="pushMaskBegin"?(r.renderTarget.ensureDepthStencil(),r.stencil.setStencilMode(ft.RENDERING_MASK_ADD,a),a++,r.colorMask.setMask(0)):t.action==="pushMaskEnd"?(t.inverse?r.stencil.setStencilMode(ft.INVERSE_MASK_ACTIVE,a):r.stencil.setStencilMode(ft.MASK_ACTIVE,a),r.colorMask.setMask(15)):t.action==="popMaskBegin"?(r.colorMask.setMask(0),a!==0?r.stencil.setStencilMode(ft.RENDERING_MASK_REMOVE,a):(r.renderTarget.clear(null,vs.STENCIL),r.stencil.setStencilMode(ft.DISABLED,a)),a--):t.action==="popMaskEnd"&&(t.inverse?r.stencil.setStencilMode(ft.INVERSE_MASK_ACTIVE,a):r.stencil.setStencilMode(ft.MASK_ACTIVE,a),r.colorMask.setMask(15)),this._maskStackHash[o]=a}destroy(){this._renderer=null,this._maskStackHash=null,this._maskHash=null}}JS.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"stencilMask"};var qc=(l=>(l[l.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",l[l.ARRAY_BUFFER=34962]="ARRAY_BUFFER",l[l.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",l))(qc||{});class f1{constructor(t,s){this._lastBindBaseLocation=-1,this._lastBindCallId=-1,this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.type=s}}class ZS{constructor(t){this._gpuBuffers=Object.create(null),this._boundBufferBases=Object.create(null),this._minBaseLocation=0,this._nextBindBaseIndex=this._minBaseLocation,this._bindCallId=0,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBuffers")}destroy(){this._renderer=null,this._gl=null,this._gpuBuffers=null,this._boundBufferBases=null}contextChange(){this._gl=this._renderer.gl,this._gpuBuffers=Object.create(null),this._maxBindings=this._renderer.limits.maxUniformBindings}getGlBuffer(t){return this._gpuBuffers[t.uid]||this.createGLBuffer(t)}bind(t){const{_gl:s}=this,r=this.getGlBuffer(t);s.bindBuffer(r.type,r.buffer)}bindBufferBase(t,s){const{_gl:r}=this;this._boundBufferBases[s]!==t&&(this._boundBufferBases[s]=t,t._lastBindBaseLocation=s,r.bindBufferBase(r.UNIFORM_BUFFER,s,t.buffer))}nextBindBase(t){this._bindCallId++,this._minBaseLocation=0,t&&(this._boundBufferBases[0]=null,this._minBaseLocation=1,this._nextBindBaseIndex<1&&(this._nextBindBaseIndex=1))}freeLocationForBufferBase(t){let s=this.getLastBindBaseLocation(t);if(s>=this._minBaseLocation)return t._lastBindCallId=this._bindCallId,s;let r=0,o=this._nextBindBaseIndex;for(;r<2;){o>=this._maxBindings&&(o=this._minBaseLocation,r++);const a=this._boundBufferBases[o];if(a&&a._lastBindCallId===this._bindCallId){o++;continue}break}return s=o,this._nextBindBaseIndex=o+1,r>=2?-1:(t._lastBindCallId=this._bindCallId,this._boundBufferBases[s]=null,s)}getLastBindBaseLocation(t){const s=t._lastBindBaseLocation;return this._boundBufferBases[s]===t?s:-1}bindBufferRange(t,s,r,o){const{_gl:a}=this;r||(r=0),s||(s=0),this._boundBufferBases[s]=null,a.bindBufferRange(a.UNIFORM_BUFFER,s||0,t.buffer,r*256,o||256)}updateBuffer(t){const{_gl:s}=this,r=this.getGlBuffer(t);if(t._updateID===r.updateID)return r;r.updateID=t._updateID,s.bindBuffer(r.type,r.buffer);const o=t.data,a=t.descriptor.usage&Me.STATIC?s.STATIC_DRAW:s.DYNAMIC_DRAW;return o?r.byteLength>=o.byteLength?s.bufferSubData(r.type,0,o,0,t._updateSize/o.BYTES_PER_ELEMENT):(r.byteLength=o.byteLength,s.bufferData(r.type,o,a)):(r.byteLength=t.descriptor.size,s.bufferData(r.type,r.byteLength,a)),r}destroyAll(){const t=this._gl;for(const s in this._gpuBuffers)t.deleteBuffer(this._gpuBuffers[s].buffer);this._gpuBuffers=Object.create(null)}onBufferDestroy(t,s){const r=this._gpuBuffers[t.uid],o=this._gl;s||o.deleteBuffer(r.buffer),this._gpuBuffers[t.uid]=null}createGLBuffer(t){const{_gl:s}=this;let r=qc.ARRAY_BUFFER;t.descriptor.usage&Me.INDEX?r=qc.ELEMENT_ARRAY_BUFFER:t.descriptor.usage&Me.UNIFORM&&(r=qc.UNIFORM_BUFFER);const o=new f1(s.createBuffer(),r);return this._gpuBuffers[t.uid]=o,t.on("destroy",this.onBufferDestroy,this),o}resetState(){this._boundBufferBases=Object.create(null)}}ZS.extension={type:[V.WebGLSystem],name:"buffer"};const Xg=class QS{constructor(t){this.supports={uint32Indices:!0,uniformBufferObject:!0,vertexArrayObject:!0,srgbTextures:!0,nonPowOf2wrapping:!0,msaa:!0,nonPowOf2mipmaps:!0},this._renderer=t,this.extensions=Object.create(null),this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this._renderer.gl=t}init(t){t={...QS.defaultOptions,...t};let s=this.multiView=t.multiView;if(t.context&&s&&(we("Renderer created with both a context and multiview enabled. Disabling multiView as both cannot work together."),s=!1),s?this.canvas=it.get().createCanvas(this._renderer.canvas.width,this._renderer.canvas.height):this.canvas=this._renderer.view.canvas,t.context)this.initFromContext(t.context);else{const r=this._renderer.background.alpha<1,o=t.premultipliedAlpha??!0,a=t.antialias&&!this._renderer.backBuffer.useBackBuffer;this.createContext(t.preferWebGLVersion,{alpha:r,premultipliedAlpha:o,antialias:a,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference??"default"})}}ensureCanvasSize(t){if(!this.multiView){t!==this.canvas&&we("multiView is disabled, but targetCanvas is not the main canvas");return}const{canvas:s}=this;(s.width<t.width||s.height<t.height)&&(s.width=Math.max(t.width,t.width),s.height=Math.max(t.height,t.height))}initFromContext(t){this.gl=t,this.webGLVersion=t instanceof it.get().getWebGLRenderingContext()?1:2,this.getExtensions(),this.validateContext(t),this._renderer.runners.contextChange.emit(t);const s=this._renderer.view.canvas;s.addEventListener("webglcontextlost",this.handleContextLost,!1),s.addEventListener("webglcontextrestored",this.handleContextRestored,!1)}createContext(t,s){let r;const o=this.canvas;if(t===2&&(r=o.getContext("webgl2",s)),!r&&(r=o.getContext("webgl",s),!r))throw new Error("This browser does not support WebGL. Try using the canvas renderer");this.gl=r,this.initFromContext(this.gl)}getExtensions(){const{gl:t}=this,s={anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc"),bptc:t.getExtension("EXT_texture_compression_bptc"),rgtc:t.getExtension("EXT_texture_compression_rgtc"),loseContext:t.getExtension("WEBGL_lose_context")};if(this.webGLVersion===1)this.extensions={...s,drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear"),vertexAttribDivisorANGLE:t.getExtension("ANGLE_instanced_arrays"),srgb:t.getExtension("EXT_sRGB")};else{this.extensions={...s,colorBufferFloat:t.getExtension("EXT_color_buffer_float")};const r=t.getExtension("WEBGL_provoking_vertex");r&&r.provokingVertexWEBGL(r.FIRST_VERTEX_CONVENTION_WEBGL)}}handleContextLost(t){t.preventDefault(),this._contextLossForced&&(this._contextLossForced=!1,setTimeout(()=>{var s;this.gl.isContextLost()&&((s=this.extensions.loseContext)==null||s.restoreContext())},0))}handleContextRestored(){this.getExtensions(),this._renderer.runners.contextChange.emit(this.gl)}destroy(){var s;const t=this._renderer.view.canvas;this._renderer=null,t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored),this.gl.useProgram(null),(s=this.extensions.loseContext)==null||s.loseContext()}forceContextLoss(){var t;(t=this.extensions.loseContext)==null||t.loseContext(),this._contextLossForced=!0}validateContext(t){const s=t.getContextAttributes();s&&!s.stencil&&we("Provided WebGL context does not have a stencil buffer, masks may not render correctly");const r=this.supports,o=this.webGLVersion===2,a=this.extensions;r.uint32Indices=o||!!a.uint32ElementIndex,r.uniformBufferObject=o,r.vertexArrayObject=o||!!a.vertexArrayObject,r.srgbTextures=o||!!a.srgb,r.nonPowOf2wrapping=o,r.nonPowOf2mipmaps=o,r.msaa=o,r.uint32Indices||we("Provided WebGL context does not support 32 index buffer, large scenes may not render correctly")}};Xg.extension={type:[V.WebGLSystem],name:"context"};Xg.defaultOptions={context:null,premultipliedAlpha:!0,preserveDrawingBuffer:!1,powerPreference:void 0,preferWebGLVersion:2,multiView:!1};let g1=Xg;function eI(l,t){for(const s in l.attributes){const r=l.attributes[s],o=t[s];o?(r.format??(r.format=o.format),r.offset??(r.offset=o.offset),r.instance??(r.instance=o.instance)):we(`Attribute ${s} is not present in the shader, but is present in the geometry. Unable to infer attribute details.`)}m1(l)}function m1(l){const{buffers:t,attributes:s}=l,r={},o={};for(const a in t){const h=t[a];r[h.uid]=0,o[h.uid]=0}for(const a in s){const h=s[a];r[h.buffer.uid]+=$r(h.format).stride}for(const a in s){const h=s[a];h.stride??(h.stride=r[h.buffer.uid]),h.start??(h.start=o[h.buffer.uid]),o[h.buffer.uid]+=$r(h.format).stride}}var lg=(l=>(l[l.RGBA=6408]="RGBA",l[l.RGB=6407]="RGB",l[l.RG=33319]="RG",l[l.RED=6403]="RED",l[l.RGBA_INTEGER=36249]="RGBA_INTEGER",l[l.RGB_INTEGER=36248]="RGB_INTEGER",l[l.RG_INTEGER=33320]="RG_INTEGER",l[l.RED_INTEGER=36244]="RED_INTEGER",l[l.ALPHA=6406]="ALPHA",l[l.LUMINANCE=6409]="LUMINANCE",l[l.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",l[l.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",l[l.DEPTH_STENCIL=34041]="DEPTH_STENCIL",l))(lg||{}),tI=(l=>(l[l.TEXTURE_2D=3553]="TEXTURE_2D",l[l.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",l[l.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",l[l.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",l[l.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",l[l.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",l[l.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",l[l.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",l[l.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",l))(tI||{}),Be=(l=>(l[l.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",l[l.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",l[l.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",l[l.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",l[l.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",l[l.UNSIGNED_INT=5125]="UNSIGNED_INT",l[l.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",l[l.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",l[l.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",l[l.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",l[l.BYTE=5120]="BYTE",l[l.SHORT=5122]="SHORT",l[l.INT=5124]="INT",l[l.FLOAT=5126]="FLOAT",l[l.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",l[l.HALF_FLOAT=36193]="HALF_FLOAT",l))(Be||{});const Fy={uint8x2:Be.UNSIGNED_BYTE,uint8x4:Be.UNSIGNED_BYTE,sint8x2:Be.BYTE,sint8x4:Be.BYTE,unorm8x2:Be.UNSIGNED_BYTE,unorm8x4:Be.UNSIGNED_BYTE,snorm8x2:Be.BYTE,snorm8x4:Be.BYTE,uint16x2:Be.UNSIGNED_SHORT,uint16x4:Be.UNSIGNED_SHORT,sint16x2:Be.SHORT,sint16x4:Be.SHORT,unorm16x2:Be.UNSIGNED_SHORT,unorm16x4:Be.UNSIGNED_SHORT,snorm16x2:Be.SHORT,snorm16x4:Be.SHORT,float16x2:Be.HALF_FLOAT,float16x4:Be.HALF_FLOAT,float32:Be.FLOAT,float32x2:Be.FLOAT,float32x3:Be.FLOAT,float32x4:Be.FLOAT,uint32:Be.UNSIGNED_INT,uint32x2:Be.UNSIGNED_INT,uint32x3:Be.UNSIGNED_INT,uint32x4:Be.UNSIGNED_INT,sint32:Be.INT,sint32x2:Be.INT,sint32x3:Be.INT,sint32x4:Be.INT};function _1(l){return Fy[l]??Fy.float32}const $1={"point-list":0,"line-list":1,"line-strip":3,"triangle-list":4,"triangle-strip":5};class sI{constructor(t){this._geometryVaoHash=Object.create(null),this._renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this._renderer.renderableGC.addManagedHash(this,"_geometryVaoHash")}contextChange(){const t=this.gl=this._renderer.gl;if(!this._renderer.context.supports.vertexArrayObject)throw new Error("[PixiJS] Vertex Array Objects are not supported on this device");const s=this._renderer.context.extensions.vertexArrayObject;s&&(t.createVertexArray=()=>s.createVertexArrayOES(),t.bindVertexArray=o=>s.bindVertexArrayOES(o),t.deleteVertexArray=o=>s.deleteVertexArrayOES(o));const r=this._renderer.context.extensions.vertexAttribDivisorANGLE;r&&(t.drawArraysInstanced=(o,a,h,u)=>{r.drawArraysInstancedANGLE(o,a,h,u)},t.drawElementsInstanced=(o,a,h,u,p)=>{r.drawElementsInstancedANGLE(o,a,h,u,p)},t.vertexAttribDivisor=(o,a)=>r.vertexAttribDivisorANGLE(o,a)),this._activeGeometry=null,this._activeVao=null,this._geometryVaoHash=Object.create(null)}bind(t,s){const r=this.gl;this._activeGeometry=t;const o=this.getVao(t,s);this._activeVao!==o&&(this._activeVao=o,r.bindVertexArray(o)),this.updateBuffers()}resetState(){this.unbind()}updateBuffers(){const t=this._activeGeometry,s=this._renderer.buffer;for(let r=0;r<t.buffers.length;r++){const o=t.buffers[r];s.updateBuffer(o)}}checkCompatibility(t,s){const r=t.attributes,o=s._attributeData;for(const a in o)if(!r[a])throw new Error(`shader and geometry incompatible, geometry missing the "${a}" attribute`)}getSignature(t,s){const r=t.attributes,o=s._attributeData,a=["g",t.uid];for(const h in r)o[h]&&a.push(h,o[h].location);return a.join("-")}getVao(t,s){var r;return((r=this._geometryVaoHash[t.uid])==null?void 0:r[s._key])||this.initGeometryVao(t,s)}initGeometryVao(t,s,r=!0){const o=this._renderer.gl,a=this._renderer.buffer;this._renderer.shader._getProgramData(s),this.checkCompatibility(t,s);const h=this.getSignature(t,s);this._geometryVaoHash[t.uid]||(this._geometryVaoHash[t.uid]=Object.create(null),t.on("destroy",this.onGeometryDestroy,this));const u=this._geometryVaoHash[t.uid];let p=u[h];if(p)return u[s._key]=p,p;eI(t,s._attributeData);const f=t.buffers;p=o.createVertexArray(),o.bindVertexArray(p);for(let g=0;g<f.length;g++){const _=f[g];a.bind(_)}return this.activateVao(t,s),u[s._key]=p,u[h]=p,o.bindVertexArray(null),p}onGeometryDestroy(t,s){const r=this._geometryVaoHash[t.uid],o=this.gl;if(r){if(s)for(const a in r)this._activeVao!==r[a]&&this.unbind(),o.deleteVertexArray(r[a]);this._geometryVaoHash[t.uid]=null}}destroyAll(t=!1){const s=this.gl;for(const r in this._geometryVaoHash){if(t)for(const o in this._geometryVaoHash[r]){const a=this._geometryVaoHash[r];this._activeVao!==a&&this.unbind(),s.deleteVertexArray(a[o])}this._geometryVaoHash[r]=null}}activateVao(t,s){var u;const r=this._renderer.gl,o=this._renderer.buffer,a=t.attributes;t.indexBuffer&&o.bind(t.indexBuffer);let h=null;for(const p in a){const f=a[p],g=f.buffer,_=o.getGlBuffer(g),$=s._attributeData[p];if($){h!==_&&(o.bind(g),h=_);const E=$.location;r.enableVertexAttribArray(E);const v=$r(f.format),w=_1(f.format);if(((u=$.format)==null?void 0:u.substring(1,4))==="int"?r.vertexAttribIPointer(E,v.size,w,f.stride,f.offset):r.vertexAttribPointer(E,v.size,w,v.normalised,f.stride,f.offset),f.instance)if(this.hasInstance){const x=f.divisor??1;r.vertexAttribDivisor(E,x)}else throw new Error("geometry error, GPU Instancing is not supported on this device")}}}draw(t,s,r,o){const{gl:a}=this._renderer,h=this._activeGeometry,u=$1[t||h.topology];if(o??(o=h.instanceCount),h.indexBuffer){const p=h.indexBuffer.data.BYTES_PER_ELEMENT,f=p===2?a.UNSIGNED_SHORT:a.UNSIGNED_INT;o>1?a.drawElementsInstanced(u,s||h.indexBuffer.data.length,f,(r||0)*p,o):a.drawElements(u,s||h.indexBuffer.data.length,f,(r||0)*p)}else o>1?a.drawArraysInstanced(u,r||0,s||h.getSize(),o):a.drawArrays(u,r||0,s||h.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this._renderer=null,this.gl=null,this._activeVao=null,this._activeGeometry=null}}sI.extension={type:[V.WebGLSystem],name:"geometry"};const T1=new Ul({attributes:{aPosition:[-1,-1,3,-1,-1,3]}}),Yg=class iI{constructor(t){this.useBackBuffer=!1,this._useBackBufferThisRender=!1,this._renderer=t}init(t={}){const{useBackBuffer:s,antialias:r}={...iI.defaultOptions,...t};this.useBackBuffer=s,this._antialias=r,this._renderer.context.supports.msaa||(we("antialiasing, is not supported on when using the back buffer"),this._antialias=!1),this._state=ti.for2d();const o=new ho({vertex:`
                attribute vec2 aPosition;
                out vec2 vUv;

                void main() {
                    gl_Position = vec4(aPosition, 0.0, 1.0);

                    vUv = (aPosition + 1.0) / 2.0;

                    // flip dem UVs
                    vUv.y = 1.0 - vUv.y;
                }`,fragment:`
                in vec2 vUv;
                out vec4 finalColor;

                uniform sampler2D uTexture;

                void main() {
                    finalColor = texture(uTexture, vUv);
                }`,name:"big-triangle"});this._bigTriangleShader=new Ds({glProgram:o,resources:{uTexture:me.WHITE.source}})}renderStart(t){const s=this._renderer.renderTarget.getRenderTarget(t.target);if(this._useBackBufferThisRender=this.useBackBuffer&&!!s.isRoot,this._useBackBufferThisRender){const r=this._renderer.renderTarget.getRenderTarget(t.target);this._targetTexture=r.colorTexture,t.target=this._getBackBufferTexture(r.colorTexture)}}renderEnd(){this._presentBackBuffer()}_presentBackBuffer(){const t=this._renderer;t.renderTarget.finishRenderPass(),this._useBackBufferThisRender&&(t.renderTarget.bind(this._targetTexture,!1),this._bigTriangleShader.resources.uTexture=this._backBufferTexture.source,t.encoder.draw({geometry:T1,shader:this._bigTriangleShader,state:this._state}))}_getBackBufferTexture(t){return this._backBufferTexture=this._backBufferTexture||new me({source:new vt({width:t.width,height:t.height,resolution:t._resolution,antialias:this._antialias})}),this._backBufferTexture.source.resize(t.width,t.height,t._resolution),this._backBufferTexture}destroy(){this._backBufferTexture&&(this._backBufferTexture.destroy(),this._backBufferTexture=null)}};Yg.extension={type:[V.WebGLSystem],name:"backBuffer",priority:1};Yg.defaultOptions={useBackBuffer:!1};let b1=Yg;class rI{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.gl.colorMask(!!(t&8),!!(t&4),!!(t&2),!!(t&1)))}}rI.extension={type:[V.WebGLSystem],name:"colorMask"};class nI{constructor(t){this.commandFinished=Promise.resolve(),this._renderer=t}setGeometry(t,s){this._renderer.geometry.bind(t,s.glProgram)}finishRenderPass(){}draw(t){const s=this._renderer,{geometry:r,shader:o,state:a,skipSync:h,topology:u,size:p,start:f,instanceCount:g}=t;s.shader.bind(o,h),s.geometry.bind(r,s.shader._activeProgram),a&&s.state.set(a),s.geometry.draw(u,p,f,g??r.instanceCount)}destroy(){this._renderer=null}}nI.extension={type:[V.WebGLSystem],name:"encoder"};class oI{constructor(t){this._renderer=t}contextChange(){const t=this._renderer.gl;this.maxTextures=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),this.maxBatchableTextures=mS(this.maxTextures,t),this.maxUniformBindings=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS)}destroy(){}}oI.extension={type:[V.WebGLSystem],name:"limits"};class E1{constructor(){this.width=-1,this.height=-1,this.msaa=!1,this.msaaRenderBuffer=[]}}const Er=[];Er[ft.NONE]=void 0;Er[ft.DISABLED]={stencilWriteMask:0,stencilReadMask:0};Er[ft.RENDERING_MASK_ADD]={stencilFront:{compare:"equal",passOp:"increment-clamp"},stencilBack:{compare:"equal",passOp:"increment-clamp"}};Er[ft.RENDERING_MASK_REMOVE]={stencilFront:{compare:"equal",passOp:"decrement-clamp"},stencilBack:{compare:"equal",passOp:"decrement-clamp"}};Er[ft.MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"equal",passOp:"keep"},stencilBack:{compare:"equal",passOp:"keep"}};Er[ft.INVERSE_MASK_ACTIVE]={stencilWriteMask:0,stencilFront:{compare:"not-equal",passOp:"keep"},stencilBack:{compare:"not-equal",passOp:"keep"}};class lI{constructor(t){this._stencilCache={enabled:!1,stencilReference:0,stencilMode:ft.NONE},this._renderTargetStencilState=Object.create(null),t.renderTarget.onRenderTargetChange.add(this)}contextChange(t){this._gl=t,this._comparisonFuncMapping={always:t.ALWAYS,never:t.NEVER,equal:t.EQUAL,"not-equal":t.NOTEQUAL,less:t.LESS,"less-equal":t.LEQUAL,greater:t.GREATER,"greater-equal":t.GEQUAL},this._stencilOpsMapping={keep:t.KEEP,zero:t.ZERO,replace:t.REPLACE,invert:t.INVERT,"increment-clamp":t.INCR,"decrement-clamp":t.DECR,"increment-wrap":t.INCR_WRAP,"decrement-wrap":t.DECR_WRAP},this.resetState()}onRenderTargetChange(t){if(this._activeRenderTarget===t)return;this._activeRenderTarget=t;let s=this._renderTargetStencilState[t.uid];s||(s=this._renderTargetStencilState[t.uid]={stencilMode:ft.DISABLED,stencilReference:0}),this.setStencilMode(s.stencilMode,s.stencilReference)}resetState(){this._stencilCache.enabled=!1,this._stencilCache.stencilMode=ft.NONE,this._stencilCache.stencilReference=0}setStencilMode(t,s){const r=this._renderTargetStencilState[this._activeRenderTarget.uid],o=this._gl,a=Er[t],h=this._stencilCache;if(r.stencilMode=t,r.stencilReference=s,t===ft.DISABLED){this._stencilCache.enabled&&(this._stencilCache.enabled=!1,o.disable(o.STENCIL_TEST));return}this._stencilCache.enabled||(this._stencilCache.enabled=!0,o.enable(o.STENCIL_TEST)),(t!==h.stencilMode||h.stencilReference!==s)&&(h.stencilMode=t,h.stencilReference=s,o.stencilFunc(this._comparisonFuncMapping[a.stencilBack.compare],s,255),o.stencilOp(o.KEEP,o.KEEP,this._stencilOpsMapping[a.stencilBack.passOp]))}}lI.extension={type:[V.WebGLSystem],name:"stencil"};class aI{constructor(t){this._syncFunctionHash=Object.create(null),this._adaptor=t,this._systemCheck()}_systemCheck(){if(!tS())throw new Error("Current environment does not allow unsafe-eval, please use pixi.js/unsafe-eval module to enable support.")}ensureUniformGroup(t){const s=this.getUniformGroupData(t);t.buffer||(t.buffer=new Ss({data:new Float32Array(s.layout.size/4),usage:Me.UNIFORM|Me.COPY_DST}))}getUniformGroupData(t){return this._syncFunctionHash[t._signature]||this._initUniformGroup(t)}_initUniformGroup(t){const s=t._signature;let r=this._syncFunctionHash[s];if(!r){const o=Object.keys(t.uniformStructures).map(u=>t.uniformStructures[u]),a=this._adaptor.createUboElements(o),h=this._generateUboSync(a.uboElements);r=this._syncFunctionHash[s]={layout:a,syncFunction:h}}return this._syncFunctionHash[s]}_generateUboSync(t){return this._adaptor.generateUboSync(t)}syncUniformGroup(t,s,r){const o=this.getUniformGroupData(t);t.buffer||(t.buffer=new Ss({data:new Float32Array(o.layout.size/4),usage:Me.UNIFORM|Me.COPY_DST}));let a=null;return s||(s=t.buffer.data,a=t.buffer.dataInt32),r||(r=0),o.syncFunction(t.uniforms,s,a,r),!0}updateUniformGroup(t){if(t.isStatic&&!t._dirtyId)return!1;t._dirtyId=0;const s=this.syncUniformGroup(t);return t.buffer.update(),s}destroy(){this._syncFunctionHash=null}}const cI={f32:4,i32:4,"vec2<f32>":8,"vec3<f32>":12,"vec4<f32>":16,"vec2<i32>":8,"vec3<i32>":12,"vec4<i32>":16,"mat2x2<f32>":16*2,"mat3x3<f32>":16*3,"mat4x4<f32>":16*4};function y1(l){const t=l.map(a=>({data:a,offset:0,size:0})),s=16;let r=0,o=0;for(let a=0;a<t.length;a++){const h=t[a];if(r=cI[h.data.type],!r)throw new Error(`Unknown type ${h.data.type}`);h.data.size>1&&(r=Math.max(r,s)*h.data.size);const u=r===12?16:r;h.size=r;const p=o%s;p>0&&s-p<u?o+=(s-p)%16:o+=(r-p%r)%r,h.offset=o,o+=r}return o=Math.ceil(o/16)*16,{uboElements:t,size:o}}const rn=[{type:"mat3x3<f32>",test:l=>l.value.a!==void 0,ubo:`
            var matrix = uv[name].toArray(true);
            data[offset] = matrix[0];
            data[offset + 1] = matrix[1];
            data[offset + 2] = matrix[2];
            data[offset + 4] = matrix[3];
            data[offset + 5] = matrix[4];
            data[offset + 6] = matrix[5];
            data[offset + 8] = matrix[6];
            data[offset + 9] = matrix[7];
            data[offset + 10] = matrix[8];
        `,uniform:`
            gl.uniformMatrix3fv(ud[name].location, false, uv[name].toArray(true));
        `},{type:"vec4<f32>",test:l=>l.type==="vec4<f32>"&&l.size===1&&l.value.width!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
            data[offset + 2] = v.width;
            data[offset + 3] = v.height;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height) {
                cv[0] = v.x;
                cv[1] = v.y;
                cv[2] = v.width;
                cv[3] = v.height;
                gl.uniform4f(ud[name].location, v.x, v.y, v.width, v.height);
            }
        `},{type:"vec2<f32>",test:l=>l.type==="vec2<f32>"&&l.size===1&&l.value.x!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.x;
            data[offset + 1] = v.y;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.x || cv[1] !== v.y) {
                cv[0] = v.x;
                cv[1] = v.y;
                gl.uniform2f(ud[name].location, v.x, v.y);
            }
        `},{type:"vec4<f32>",test:l=>l.type==="vec4<f32>"&&l.size===1&&l.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
            data[offset + 3] = v.alpha;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue || cv[3] !== v.alpha) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                cv[3] = v.alpha;
                gl.uniform4f(ud[name].location, v.red, v.green, v.blue, v.alpha);
            }
        `},{type:"vec3<f32>",test:l=>l.type==="vec3<f32>"&&l.size===1&&l.value.red!==void 0,ubo:`
            v = uv[name];
            data[offset] = v.red;
            data[offset + 1] = v.green;
            data[offset + 2] = v.blue;
        `,uniform:`
            cv = ud[name].value;
            v = uv[name];
            if (cv[0] !== v.red || cv[1] !== v.green || cv[2] !== v.blue) {
                cv[0] = v.red;
                cv[1] = v.green;
                cv[2] = v.blue;
                gl.uniform3f(ud[name].location, v.red, v.green, v.blue);
            }
        `}];function hI(l,t,s,r){const o=[`
        var v = null;
        var v2 = null;
        var t = 0;
        var index = 0;
        var name = null;
        var arrayOffset = null;
    `];let a=0;for(let u=0;u<l.length;u++){const p=l[u],f=p.data.name;let g=!1,_=0;for(let $=0;$<rn.length;$++)if(rn[$].test(p.data)){_=p.offset/4,o.push(`name = "${f}";`,`offset += ${_-a};`,rn[$][t]||rn[$].ubo),g=!0;break}if(!g)if(p.data.size>1)_=p.offset/4,o.push(s(p,_-a));else{const $=r[p.data.type];_=p.offset/4,o.push(`
                    v = uv.${f};
                    offset += ${_-a};
                    ${$};
                `)}a=_}const h=o.join(`
`);return new Function("uv","data","dataInt32","offset",h)}function eo(l,t){return`
        for (let i = 0; i < ${l*t}; i++) {
            data[offset + (((i / ${l})|0) * 4) + (i % ${l})] = v[i];
        }
    `}const uI={f32:`
        data[offset] = v;`,i32:`
        dataInt32[offset] = v;`,"vec2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];`,"vec3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];`,"vec4<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];`,"vec2<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];`,"vec3<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];`,"vec4<i32>":`
        dataInt32[offset] = v[0];
        dataInt32[offset + 1] = v[1];
        dataInt32[offset + 2] = v[2];
        dataInt32[offset + 3] = v[3];`,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 4] = v[2];
        data[offset + 5] = v[3];`,"mat3x3<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 4] = v[3];
        data[offset + 5] = v[4];
        data[offset + 6] = v[5];
        data[offset + 8] = v[6];
        data[offset + 9] = v[7];
        data[offset + 10] = v[8];`,"mat4x4<f32>":`
        for (let i = 0; i < 16; i++) {
            data[offset + i] = v[i];
        }`,"mat3x2<f32>":eo(3,2),"mat4x2<f32>":eo(4,2),"mat2x3<f32>":eo(2,3),"mat4x3<f32>":eo(4,3),"mat2x4<f32>":eo(2,4),"mat3x4<f32>":eo(3,4)},v1={...uI,"mat2x2<f32>":`
        data[offset] = v[0];
        data[offset + 1] = v[1];
        data[offset + 2] = v[2];
        data[offset + 3] = v[3];
    `};function S1(l,t){const s=Math.max(cI[l.data.type]/16,1),r=l.data.value.length/l.data.size,o=(4-r%4)%4,a=l.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
        v = uv.${l.data.name};
        offset += ${t};

        arrayOffset = offset;

        t = 0;

        for(var i=0; i < ${l.data.size*s}; i++)
        {
            for(var j = 0; j < ${r}; j++)
            {
                ${a}[arrayOffset++] = v[t++];
            }
            ${o!==0?`arrayOffset += ${o};`:""}
        }
    `}function I1(l){return hI(l,"uboStd40",S1,uI)}class dI extends aI{constructor(){super({createUboElements:y1,generateUboSync:I1})}}dI.extension={type:[V.WebGLSystem],name:"ubo"};class x1{constructor(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Fe}init(t,s){this._renderer=t,this._renderTargetSystem=s,t.runners.contextChange.add(this)}contextChange(){this._clearColorCache=[0,0,0,0],this._viewPortCache=new Fe}copyToTexture(t,s,r,o,a){const h=this._renderTargetSystem,u=this._renderer,p=h.getGpuRenderTarget(t),f=u.gl;return this.finishRenderPass(t),f.bindFramebuffer(f.FRAMEBUFFER,p.resolveTargetFramebuffer),u.texture.bind(s,0),f.copyTexSubImage2D(f.TEXTURE_2D,0,a.x,a.y,r.x,r.y,o.width,o.height),s}startRenderPass(t,s=!0,r,o){const a=this._renderTargetSystem,h=t.colorTexture,u=a.getGpuRenderTarget(t);let p=o.y;t.isRoot&&(p=h.pixelHeight-o.height),t.colorTextures.forEach(_=>{this._renderer.texture.unbind(_)});const f=this._renderer.gl;f.bindFramebuffer(f.FRAMEBUFFER,u.framebuffer);const g=this._viewPortCache;(g.x!==o.x||g.y!==p||g.width!==o.width||g.height!==o.height)&&(g.x=o.x,g.y=p,g.width=o.width,g.height=o.height,f.viewport(o.x,p,o.width,o.height)),!u.depthStencilRenderBuffer&&(t.stencil||t.depth)&&this._initStencil(u),this.clear(t,s,r)}finishRenderPass(t){const r=this._renderTargetSystem.getGpuRenderTarget(t);if(!r.msaa)return;const o=this._renderer.gl;o.bindFramebuffer(o.FRAMEBUFFER,r.resolveTargetFramebuffer),o.bindFramebuffer(o.READ_FRAMEBUFFER,r.framebuffer),o.blitFramebuffer(0,0,r.width,r.height,0,0,r.width,r.height,o.COLOR_BUFFER_BIT,o.NEAREST),o.bindFramebuffer(o.FRAMEBUFFER,r.framebuffer)}initGpuRenderTarget(t){const r=this._renderer.gl,o=new E1;return t.colorTexture instanceof Yi?(this._renderer.context.ensureCanvasSize(t.colorTexture.resource),o.framebuffer=null,o):(this._initColor(t,o),r.bindFramebuffer(r.FRAMEBUFFER,null),o)}destroyGpuRenderTarget(t){const s=this._renderer.gl;t.framebuffer&&(s.deleteFramebuffer(t.framebuffer),t.framebuffer=null),t.resolveTargetFramebuffer&&(s.deleteFramebuffer(t.resolveTargetFramebuffer),t.resolveTargetFramebuffer=null),t.depthStencilRenderBuffer&&(s.deleteRenderbuffer(t.depthStencilRenderBuffer),t.depthStencilRenderBuffer=null),t.msaaRenderBuffer.forEach(r=>{s.deleteRenderbuffer(r)}),t.msaaRenderBuffer=null}clear(t,s,r){if(!s)return;const o=this._renderTargetSystem;typeof s=="boolean"&&(s=s?vs.ALL:vs.NONE);const a=this._renderer.gl;if(s&vs.COLOR){r??(r=o.defaultClearColor);const h=this._clearColorCache,u=r;(h[0]!==u[0]||h[1]!==u[1]||h[2]!==u[2]||h[3]!==u[3])&&(h[0]=u[0],h[1]=u[1],h[2]=u[2],h[3]=u[3],a.clearColor(u[0],u[1],u[2],u[3]))}a.clear(s)}resizeGpuRenderTarget(t){if(t.isRoot)return;const r=this._renderTargetSystem.getGpuRenderTarget(t);this._resizeColor(t,r),(t.stencil||t.depth)&&this._resizeStencil(r)}_initColor(t,s){const r=this._renderer,o=r.gl,a=o.createFramebuffer();if(s.resolveTargetFramebuffer=a,o.bindFramebuffer(o.FRAMEBUFFER,a),s.width=t.colorTexture.source.pixelWidth,s.height=t.colorTexture.source.pixelHeight,t.colorTextures.forEach((h,u)=>{const p=h.source;p.antialias&&(r.context.supports.msaa?s.msaa=!0:we("[RenderTexture] Antialiasing on textures is not supported in WebGL1")),r.texture.bindSource(p,0);const g=r.texture.getGlSource(p).texture;o.framebufferTexture2D(o.FRAMEBUFFER,o.COLOR_ATTACHMENT0+u,3553,g,0)}),s.msaa){const h=o.createFramebuffer();s.framebuffer=h,o.bindFramebuffer(o.FRAMEBUFFER,h),t.colorTextures.forEach((u,p)=>{const f=o.createRenderbuffer();s.msaaRenderBuffer[p]=f})}else s.framebuffer=a;this._resizeColor(t,s)}_resizeColor(t,s){const r=t.colorTexture.source;if(s.width=r.pixelWidth,s.height=r.pixelHeight,t.colorTextures.forEach((o,a)=>{a!==0&&o.source.resize(r.width,r.height,r._resolution)}),s.msaa){const o=this._renderer,a=o.gl,h=s.framebuffer;a.bindFramebuffer(a.FRAMEBUFFER,h),t.colorTextures.forEach((u,p)=>{const f=u.source;o.texture.bindSource(f,0);const _=o.texture.getGlSource(f).internalFormat,$=s.msaaRenderBuffer[p];a.bindRenderbuffer(a.RENDERBUFFER,$),a.renderbufferStorageMultisample(a.RENDERBUFFER,4,_,f.pixelWidth,f.pixelHeight),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0+p,a.RENDERBUFFER,$)})}}_initStencil(t){if(t.framebuffer===null)return;const s=this._renderer.gl,r=s.createRenderbuffer();t.depthStencilRenderBuffer=r,s.bindRenderbuffer(s.RENDERBUFFER,r),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,r),this._resizeStencil(t)}_resizeStencil(t){const s=this._renderer.gl;s.bindRenderbuffer(s.RENDERBUFFER,t.depthStencilRenderBuffer),t.msaa?s.renderbufferStorageMultisample(s.RENDERBUFFER,4,s.DEPTH24_STENCIL8,t.width,t.height):s.renderbufferStorage(s.RENDERBUFFER,this._renderer.context.webGLVersion===2?s.DEPTH24_STENCIL8:s.DEPTH_STENCIL,t.width,t.height)}prerender(t){const s=t.colorTexture.resource;this._renderer.context.multiView&&Yi.test(s)&&this._renderer.context.ensureCanvasSize(s)}postrender(t){if(this._renderer.context.multiView&&Yi.test(t.colorTexture.resource)){const s=this._renderer.context.canvas,r=t.colorTexture;r.context2D.drawImage(s,0,r.pixelHeight-s.height)}}}function C1(l,t,s,r,o,a){const h=a?1:-1;return l.identity(),l.a=1/r*2,l.d=h*(1/o*2),l.tx=-1-t*l.a,l.ty=-h-s*l.d,l}const fl=new Map;function pI(l,t){if(!fl.has(l)){const s=new me({source:new Yi({resource:l,...t})}),r=()=>{fl.get(l)===s&&fl.delete(l)};s.once("destroy",r),s.source.once("destroy",r),fl.set(l,s)}return fl.get(l)}function w1(l){const t=l.colorTexture.source.resource;return globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement&&document.body.contains(t)}const fI=class gI{constructor(t={}){if(this.uid=st("renderTarget"),this.colorTextures=[],this.dirtyId=0,this.isRoot=!1,this._size=new Float32Array(2),this._managedColorTextures=!1,t={...gI.defaultOptions,...t},this.stencil=t.stencil,this.depth=t.depth,this.isRoot=t.isRoot,typeof t.colorTextures=="number"){this._managedColorTextures=!0;for(let s=0;s<t.colorTextures;s++)this.colorTextures.push(new vt({width:t.width,height:t.height,resolution:t.resolution,antialias:t.antialias}))}else{this.colorTextures=[...t.colorTextures.map(r=>r.source)];const s=this.colorTexture.source;this.resize(s.width,s.height,s._resolution)}this.colorTexture.source.on("resize",this.onSourceResize,this),(t.depthStencilTexture||this.stencil)&&(t.depthStencilTexture instanceof me||t.depthStencilTexture instanceof vt?this.depthStencilTexture=t.depthStencilTexture.source:this.ensureDepthStencilTexture())}get size(){const t=this._size;return t[0]=this.pixelWidth,t[1]=this.pixelHeight,t}get width(){return this.colorTexture.source.width}get height(){return this.colorTexture.source.height}get pixelWidth(){return this.colorTexture.source.pixelWidth}get pixelHeight(){return this.colorTexture.source.pixelHeight}get resolution(){return this.colorTexture.source._resolution}get colorTexture(){return this.colorTextures[0]}onSourceResize(t){this.resize(t.width,t.height,t._resolution,!0)}ensureDepthStencilTexture(){this.depthStencilTexture||(this.depthStencilTexture=new vt({width:this.width,height:this.height,resolution:this.resolution,format:"depth24plus-stencil8",autoGenerateMipmaps:!1,antialias:!1,mipLevelCount:1}))}resize(t,s,r=this.resolution,o=!1){this.dirtyId++,this.colorTextures.forEach((a,h)=>{o&&h===0||a.source.resize(t,s,r)}),this.depthStencilTexture&&this.depthStencilTexture.source.resize(t,s,r)}destroy(){this.colorTexture.source.off("resize",this.onSourceResize,this),this._managedColorTextures&&this.colorTextures.forEach(t=>{t.destroy()}),this.depthStencilTexture&&(this.depthStencilTexture.destroy(),delete this.depthStencilTexture)}};fI.defaultOptions={width:0,height:0,resolution:1,colorTextures:1,stencil:!1,depth:!1,antialias:!1,isRoot:!1};let ag=fI;class mI{constructor(t){this.rootViewPort=new Fe,this.viewport=new Fe,this.onRenderTargetChange=new oS("onRenderTargetChange"),this.projectionMatrix=new Te,this.defaultClearColor=[0,0,0,0],this._renderSurfaceToRenderTargetHash=new Map,this._gpuRenderTargetHash=Object.create(null),this._renderTargetStack=[],this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuRenderTargetHash")}finishRenderPass(){this.adaptor.finishRenderPass(this.renderTarget)}renderStart({target:t,clear:s,clearColor:r,frame:o}){var a,h;this._renderTargetStack.length=0,this.push(t,s,r,o),this.rootViewPort.copyFrom(this.viewport),this.rootRenderTarget=this.renderTarget,this.renderingToScreen=w1(this.rootRenderTarget),(h=(a=this.adaptor).prerender)==null||h.call(a,this.rootRenderTarget)}postrender(){var t,s;(s=(t=this.adaptor).postrender)==null||s.call(t,this.rootRenderTarget)}bind(t,s=!0,r,o){const a=this.getRenderTarget(t),h=this.renderTarget!==a;this.renderTarget=a,this.renderSurface=t;const u=this.getGpuRenderTarget(a);(a.pixelWidth!==u.width||a.pixelHeight!==u.height)&&(this.adaptor.resizeGpuRenderTarget(a),u.width=a.pixelWidth,u.height=a.pixelHeight);const p=a.colorTexture,f=this.viewport,g=p.pixelWidth,_=p.pixelHeight;if(!o&&t instanceof me&&(o=t.frame),o){const $=p._resolution;f.x=o.x*$+.5|0,f.y=o.y*$+.5|0,f.width=o.width*$+.5|0,f.height=o.height*$+.5|0}else f.x=0,f.y=0,f.width=g,f.height=_;return C1(this.projectionMatrix,0,0,f.width/p.resolution,f.height/p.resolution,!a.isRoot),this.adaptor.startRenderPass(a,s,r,f),h&&this.onRenderTargetChange.emit(a),a}clear(t,s=vs.ALL,r){s&&(t&&(t=this.getRenderTarget(t)),this.adaptor.clear(t||this.renderTarget,s,r,this.viewport))}contextChange(){this._gpuRenderTargetHash=Object.create(null)}push(t,s=vs.ALL,r,o){const a=this.bind(t,s,r,o);return this._renderTargetStack.push({renderTarget:a,frame:o}),a}pop(){this._renderTargetStack.pop();const t=this._renderTargetStack[this._renderTargetStack.length-1];this.bind(t.renderTarget,!1,null,t.frame)}getRenderTarget(t){return t.isTexture&&(t=t.source),this._renderSurfaceToRenderTargetHash.get(t)??this._initRenderTarget(t)}copyToTexture(t,s,r,o,a){r.x<0&&(o.width+=r.x,a.x-=r.x,r.x=0),r.y<0&&(o.height+=r.y,a.y-=r.y,r.y=0);const{pixelWidth:h,pixelHeight:u}=t;return o.width=Math.min(o.width,h-r.x),o.height=Math.min(o.height,u-r.y),this.adaptor.copyToTexture(t,s,r,o,a)}ensureDepthStencil(){this.renderTarget.stencil||(this.renderTarget.stencil=!0,this.adaptor.startRenderPass(this.renderTarget,!1,null,this.viewport))}destroy(){this._renderer=null,this._renderSurfaceToRenderTargetHash.forEach((t,s)=>{t!==s&&t.destroy()}),this._renderSurfaceToRenderTargetHash.clear(),this._gpuRenderTargetHash=Object.create(null)}_initRenderTarget(t){let s=null;return Yi.test(t)&&(t=pI(t).source),t instanceof ag?s=t:t instanceof vt&&(s=new ag({colorTextures:[t]}),t.source instanceof Yi&&(s.isRoot=!0),t.once("destroy",()=>{s.destroy(),this._renderSurfaceToRenderTargetHash.delete(t);const r=this._gpuRenderTargetHash[s.uid];r&&(this._gpuRenderTargetHash[s.uid]=null,this.adaptor.destroyGpuRenderTarget(r))})),this._renderSurfaceToRenderTargetHash.set(t,s),s}getGpuRenderTarget(t){return this._gpuRenderTargetHash[t.uid]||(this._gpuRenderTargetHash[t.uid]=this.adaptor.initGpuRenderTarget(t))}resetState(){this.renderTarget=null,this.renderSurface=null}}class _I extends mI{constructor(t){super(t),this.adaptor=new x1,this.adaptor.init(t,this)}}_I.extension={type:[V.WebGLSystem],name:"renderTarget"};class Kg extends Is{constructor({buffer:t,offset:s,size:r}){super(),this.uid=st("buffer"),this._resourceType="bufferResource",this._touched=0,this._resourceId=st("resource"),this._bufferResource=!0,this.destroyed=!1,this.buffer=t,this.offset=s|0,this.size=r,this.buffer.on("change",this.onBufferChange,this)}onBufferChange(){this._resourceId=st("resource"),this.emit("change",this)}destroy(t=!1){this.destroyed=!0,t&&this.buffer.destroy(),this.emit("change",this),this.buffer=null}}function R1(l,t){const s=[],r=[`
        var g = s.groups;
        var sS = r.shader;
        var p = s.glProgram;
        var ugS = r.uniformGroup;
        var resources;
    `];let o=!1,a=0;const h=t._getProgramData(l.glProgram);for(const p in l.groups){const f=l.groups[p];s.push(`
            resources = g[${p}].resources;
        `);for(const g in f.resources){const _=f.resources[g];if(_ instanceof ns)if(_.ubo){const $=l._uniformBindMap[p][Number(g)];s.push(`
                        sS.bindUniformBlock(
                            resources[${g}],
                            '${$}',
                            ${l.glProgram._uniformBlockData[$].index}
                        );
                    `)}else s.push(`
                        ugS.updateUniformGroup(resources[${g}], p, sD);
                    `);else if(_ instanceof Kg){const $=l._uniformBindMap[p][Number(g)];s.push(`
                    sS.bindUniformBlock(
                        resources[${g}],
                        '${$}',
                        ${l.glProgram._uniformBlockData[$].index}
                    );
                `)}else if(_ instanceof vt){const $=l._uniformBindMap[p][g],E=h.uniformData[$];E&&(o||(o=!0,r.push(`
                        var tS = r.texture;
                        `)),t._gl.uniform1i(E.location,a),s.push(`
                        tS.bind(resources[${g}], ${a});
                    `),a++)}}}const u=[...r,...s].join(`
`);return new Function("r","s","sD",u)}class k1{constructor(t,s){this.program=t,this.uniformData=s,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBlockBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBlockBindings=null,this.program=null}}function Uy(l,t,s){const r=l.createShader(t);return l.shaderSource(r,s),l.compileShader(r),r}function Mf(l){const t=new Array(l);for(let s=0;s<t.length;s++)t[s]=!1;return t}function $I(l,t){switch(l){case"float":return 0;case"vec2":return new Float32Array(2*t);case"vec3":return new Float32Array(3*t);case"vec4":return new Float32Array(4*t);case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"ivec2":return new Int32Array(2*t);case"ivec3":return new Int32Array(3*t);case"ivec4":return new Int32Array(4*t);case"uvec2":return new Uint32Array(2*t);case"uvec3":return new Uint32Array(3*t);case"uvec4":return new Uint32Array(4*t);case"bool":return!1;case"bvec2":return Mf(2*t);case"bvec3":return Mf(3*t);case"bvec4":return Mf(4*t);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}let zc=null;const Gy={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"},O1={float:"float32",vec2:"float32x2",vec3:"float32x3",vec4:"float32x4",int:"sint32",ivec2:"sint32x2",ivec3:"sint32x3",ivec4:"sint32x4",uint:"uint32",uvec2:"uint32x2",uvec3:"uint32x3",uvec4:"uint32x4",bool:"uint32",bvec2:"uint32x2",bvec3:"uint32x3",bvec4:"uint32x4"};function TI(l,t){if(!zc){const s=Object.keys(Gy);zc={};for(let r=0;r<s.length;++r){const o=s[r];zc[l[o]]=Gy[o]}}return zc[t]}function A1(l,t){const s=TI(l,t);return O1[s]||"float32"}function M1(l,t,s=!1){const r={},o=t.getProgramParameter(l,t.ACTIVE_ATTRIBUTES);for(let h=0;h<o;h++){const u=t.getActiveAttrib(l,h);if(u.name.startsWith("gl_"))continue;const p=A1(t,u.type);r[u.name]={location:0,format:p,stride:$r(p).stride,offset:0,instance:!1,start:0}}const a=Object.keys(r);if(s){a.sort((h,u)=>h>u?1:-1);for(let h=0;h<a.length;h++)r[a[h]].location=h,t.bindAttribLocation(l,h,a[h]);t.linkProgram(l)}else for(let h=0;h<a.length;h++)r[a[h]].location=t.getAttribLocation(l,a[h]);return r}function L1(l,t){if(!t.ACTIVE_UNIFORM_BLOCKS)return{};const s={},r=t.getProgramParameter(l,t.ACTIVE_UNIFORM_BLOCKS);for(let o=0;o<r;o++){const a=t.getActiveUniformBlockName(l,o),h=t.getUniformBlockIndex(l,a),u=t.getActiveUniformBlockParameter(l,o,t.UNIFORM_BLOCK_DATA_SIZE);s[a]={name:a,index:h,size:u}}return s}function P1(l,t){const s={},r=t.getProgramParameter(l,t.ACTIVE_UNIFORMS);for(let o=0;o<r;o++){const a=t.getActiveUniform(l,o),h=a.name.replace(/\[.*?\]$/,""),u=!!a.name.match(/\[.*?\]$/),p=TI(t,a.type);s[h]={name:h,index:o,type:p,size:a.size,isArray:u,value:$I(p,a.size)}}return s}function Hy(l,t){const s=l.getShaderSource(t).split(`
`).map((f,g)=>`${g}: ${f}`),r=l.getShaderInfoLog(t),o=r.split(`
`),a={},h=o.map(f=>parseFloat(f.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1"))).filter(f=>f&&!a[f]?(a[f]=!0,!0):!1),u=[""];h.forEach(f=>{s[f-1]=`%c${s[f-1]}%c`,u.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")});const p=s.join(`
`);u[0]=p,console.error(r),console.groupCollapsed("click to view full shader code"),console.warn(...u),console.groupEnd()}function N1(l,t,s,r){l.getProgramParameter(t,l.LINK_STATUS)||(l.getShaderParameter(s,l.COMPILE_STATUS)||Hy(l,s),l.getShaderParameter(r,l.COMPILE_STATUS)||Hy(l,r),console.error("PixiJS Error: Could not initialize shader."),l.getProgramInfoLog(t)!==""&&console.warn("PixiJS Warning: gl.getProgramInfoLog()",l.getProgramInfoLog(t)))}function D1(l,t){const s=Uy(l,l.VERTEX_SHADER,t.vertex),r=Uy(l,l.FRAGMENT_SHADER,t.fragment),o=l.createProgram();l.attachShader(o,s),l.attachShader(o,r);const a=t.transformFeedbackVaryings;a&&(typeof l.transformFeedbackVaryings!="function"?we("TransformFeedback is not supported but TransformFeedbackVaryings are given."):l.transformFeedbackVaryings(o,a.names,a.bufferMode==="separate"?l.SEPARATE_ATTRIBS:l.INTERLEAVED_ATTRIBS)),l.linkProgram(o),l.getProgramParameter(o,l.LINK_STATUS)||N1(l,o,s,r),t._attributeData=M1(o,l,!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(t.vertex)),t._uniformData=P1(o,l),t._uniformBlockData=L1(o,l),l.deleteShader(s),l.deleteShader(r);const h={};for(const p in t._uniformData){const f=t._uniformData[p];h[p]={location:l.getUniformLocation(o,p),value:$I(f.type,f.size)}}return new k1(o,h)}const Xc={textureCount:0,blockIndex:0};class bI{constructor(t){this._activeProgram=null,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_programDataHash")}contextChange(t){this._gl=t,this._programDataHash=Object.create(null),this._shaderSyncFunctions=Object.create(null),this._activeProgram=null}bind(t,s){if(this._setProgram(t.glProgram),s)return;Xc.textureCount=0,Xc.blockIndex=0;let r=this._shaderSyncFunctions[t.glProgram._key];r||(r=this._shaderSyncFunctions[t.glProgram._key]=this._generateShaderSync(t,this)),this._renderer.buffer.nextBindBase(!!t.glProgram.transformFeedbackVaryings),r(this._renderer,t,Xc)}updateUniformGroup(t){this._renderer.uniformGroup.updateUniformGroup(t,this._activeProgram,Xc)}bindUniformBlock(t,s,r=0){const o=this._renderer.buffer,a=this._getProgramData(this._activeProgram),h=t._bufferResource;h||this._renderer.ubo.updateUniformGroup(t);const u=t.buffer,p=o.updateBuffer(u),f=o.freeLocationForBufferBase(p);if(h){const{offset:_,size:$}=t;_===0&&$===u.data.byteLength?o.bindBufferBase(p,f):o.bindBufferRange(p,f,_)}else o.getLastBindBaseLocation(p)!==f&&o.bindBufferBase(p,f);const g=this._activeProgram._uniformBlockData[s].index;a.uniformBlockBindings[r]!==f&&(a.uniformBlockBindings[r]=f,this._renderer.gl.uniformBlockBinding(a.program,g,f))}_setProgram(t){if(this._activeProgram===t)return;this._activeProgram=t;const s=this._getProgramData(t);this._gl.useProgram(s.program)}_getProgramData(t){return this._programDataHash[t._key]||this._createProgramData(t)}_createProgramData(t){const s=t._key;return this._programDataHash[s]=D1(this._gl,t),this._programDataHash[s]}destroy(){for(const t of Object.keys(this._programDataHash))this._programDataHash[t].destroy(),this._programDataHash[t]=null;this._programDataHash=null}_generateShaderSync(t,s){return R1(t,s)}resetState(){this._activeProgram=null}}bI.extension={type:[V.WebGLSystem],name:"shader"};const B1={f32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1f(location, v);
        }`,"vec2<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2f(location, v[0], v[1]);
        }`,"vec3<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3f(location, v[0], v[1], v[2]);
        }`,"vec4<f32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4f(location, v[0], v[1], v[2], v[3]);
        }`,i32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<i32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,u32:`if (cv !== v) {
            cu.value = v;
            gl.uniform1ui(location, v);
        }`,"vec2<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2ui(location, v[0], v[1]);
        }`,"vec3<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3ui(location, v[0], v[1], v[2]);
        }`,"vec4<u32>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4ui(location, v[0], v[1], v[2], v[3]);
        }`,bool:`if (cv !== v) {
            cu.value = v;
            gl.uniform1i(location, v);
        }`,"vec2<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1]) {
            cv[0] = v[0];
            cv[1] = v[1];
            gl.uniform2i(location, v[0], v[1]);
        }`,"vec3<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            gl.uniform3i(location, v[0], v[1], v[2]);
        }`,"vec4<bool>":`if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3]) {
            cv[0] = v[0];
            cv[1] = v[1];
            cv[2] = v[2];
            cv[3] = v[3];
            gl.uniform4i(location, v[0], v[1], v[2], v[3]);
        }`,"mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);"},F1={f32:"gl.uniform1fv(location, v);","vec2<f32>":"gl.uniform2fv(location, v);","vec3<f32>":"gl.uniform3fv(location, v);","vec4<f32>":"gl.uniform4fv(location, v);","mat2x2<f32>":"gl.uniformMatrix2fv(location, false, v);","mat3x3<f32>":"gl.uniformMatrix3fv(location, false, v);","mat4x4<f32>":"gl.uniformMatrix4fv(location, false, v);",i32:"gl.uniform1iv(location, v);","vec2<i32>":"gl.uniform2iv(location, v);","vec3<i32>":"gl.uniform3iv(location, v);","vec4<i32>":"gl.uniform4iv(location, v);",u32:"gl.uniform1iv(location, v);","vec2<u32>":"gl.uniform2iv(location, v);","vec3<u32>":"gl.uniform3iv(location, v);","vec4<u32>":"gl.uniform4iv(location, v);",bool:"gl.uniform1iv(location, v);","vec2<bool>":"gl.uniform2iv(location, v);","vec3<bool>":"gl.uniform3iv(location, v);","vec4<bool>":"gl.uniform4iv(location, v);"};function U1(l,t){const s=[`
        var v = null;
        var cv = null;
        var cu = null;
        var t = 0;
        var gl = renderer.gl;
        var name = null;
    `];for(const r in l.uniforms){if(!t[r]){l.uniforms[r]instanceof ns?l.uniforms[r].ubo?s.push(`
                        renderer.shader.bindUniformBlock(uv.${r}, "${r}");
                    `):s.push(`
                        renderer.shader.updateUniformGroup(uv.${r});
                    `):l.uniforms[r]instanceof Kg&&s.push(`
                        renderer.shader.bindBufferResource(uv.${r}, "${r}");
                    `);continue}const o=l.uniformStructures[r];let a=!1;for(let h=0;h<rn.length;h++){const u=rn[h];if(o.type===u.type&&u.test(o)){s.push(`name = "${r}";`,rn[h].uniform),a=!0;break}}if(!a){const u=(o.size===1?B1:F1)[o.type].replace("location",`ud["${r}"].location`);s.push(`
            cu = ud["${r}"];
            cv = cu.value;
            v = uv["${r}"];
            ${u};`)}}return new Function("ud","uv","renderer","syncData",s.join(`
`))}class EI{constructor(t){this._cache={},this._uniformGroupSyncHash={},this._renderer=t,this.gl=null,this._cache={}}contextChange(t){this.gl=t}updateUniformGroup(t,s,r){const o=this._renderer.shader._getProgramData(s);(!t.isStatic||t._dirtyId!==o.uniformDirtyGroups[t.uid])&&(o.uniformDirtyGroups[t.uid]=t._dirtyId,this._getUniformSyncFunction(t,s)(o.uniformData,t.uniforms,this._renderer,r))}_getUniformSyncFunction(t,s){var r;return((r=this._uniformGroupSyncHash[t._signature])==null?void 0:r[s._key])||this._createUniformSyncFunction(t,s)}_createUniformSyncFunction(t,s){const r=this._uniformGroupSyncHash[t._signature]||(this._uniformGroupSyncHash[t._signature]={}),o=this._getSignature(t,s._uniformData,"u");return this._cache[o]||(this._cache[o]=this._generateUniformsSync(t,s._uniformData)),r[s._key]=this._cache[o],r[s._key]}_generateUniformsSync(t,s){return U1(t,s)}_getSignature(t,s,r){const o=t.uniforms,a=[`${r}-`];for(const h in o)a.push(h),s[h]&&a.push(s[h].type);return a.join("-")}destroy(){this._renderer=null,this._cache=null}}EI.extension={type:[V.WebGLSystem],name:"uniformGroup"};function G1(l){const t={};if(t.normal=[l.ONE,l.ONE_MINUS_SRC_ALPHA],t.add=[l.ONE,l.ONE],t.multiply=[l.DST_COLOR,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA],t.screen=[l.ONE,l.ONE_MINUS_SRC_COLOR,l.ONE,l.ONE_MINUS_SRC_ALPHA],t.none=[0,0],t["normal-npm"]=[l.SRC_ALPHA,l.ONE_MINUS_SRC_ALPHA,l.ONE,l.ONE_MINUS_SRC_ALPHA],t["add-npm"]=[l.SRC_ALPHA,l.ONE,l.ONE,l.ONE],t["screen-npm"]=[l.SRC_ALPHA,l.ONE_MINUS_SRC_COLOR,l.ONE,l.ONE_MINUS_SRC_ALPHA],t.erase=[l.ZERO,l.ONE_MINUS_SRC_ALPHA],!(l instanceof it.get().getWebGLRenderingContext()))t.min=[l.ONE,l.ONE,l.ONE,l.ONE,l.MIN,l.MIN],t.max=[l.ONE,l.ONE,l.ONE,l.ONE,l.MAX,l.MAX];else{const r=l.getExtension("EXT_blend_minmax");r&&(t.min=[l.ONE,l.ONE,l.ONE,l.ONE,r.MIN_EXT,r.MIN_EXT],t.max=[l.ONE,l.ONE,l.ONE,l.ONE,r.MAX_EXT,r.MAX_EXT])}return t}const H1=0,V1=1,W1=2,z1=3,X1=4,Y1=5,yI=class cg{constructor(t){this._invertFrontFace=!1,this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode="none",this._blendEq=!1,this.map=[],this.map[H1]=this.setBlend,this.map[V1]=this.setOffset,this.map[W1]=this.setCullFace,this.map[z1]=this.setDepthTest,this.map[X1]=this.setFrontFace,this.map[Y1]=this.setDepthMask,this.checks=[],this.defaultState=ti.for2d(),t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){this._invertFrontFace=!t.isRoot,this._cullFace?this.setFrontFace(this._frontFace):this._frontFaceDirty=!0}contextChange(t){this.gl=t,this.blendModesMap=G1(t),this.resetState()}set(t){if(t||(t=this.defaultState),this.stateId!==t.data){let s=this.stateId^t.data,r=0;for(;s;)s&1&&this.map[r].call(this,!!(t.data&1<<r)),s>>=1,r++;this.stateId=t.data}for(let s=0;s<this.checks.length;s++)this.checks[s](this,t)}forceState(t){t||(t=this.defaultState);for(let s=0;s<this.map.length;s++)this.map[s].call(this,!!(t.data&1<<s));for(let s=0;s<this.checks.length;s++)this.checks[s](this,t);this.stateId=t.data}setBlend(t){this._updateCheck(cg._checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this._updateCheck(cg._checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this._cullFace=t,this.gl[t?"enable":"disable"](this.gl.CULL_FACE),this._cullFace&&this._frontFaceDirty&&this.setFrontFace(this._frontFace)}setFrontFace(t){this._frontFace=t,this._frontFaceDirty=!1;const s=this._invertFrontFace?!t:t;this._glFrontFace!==s&&(this._glFrontFace=s,this.gl.frontFace(this.gl[s?"CW":"CCW"]))}setBlendMode(t){if(this.blendModesMap[t]||(t="normal"),t===this.blendMode)return;this.blendMode=t;const s=this.blendModesMap[t],r=this.gl;s.length===2?r.blendFunc(s[0],s[1]):r.blendFuncSeparate(s[0],s[1],s[2],s[3]),s.length===6?(this._blendEq=!0,r.blendEquationSeparate(s[4],s[5])):this._blendEq&&(this._blendEq=!1,r.blendEquationSeparate(r.FUNC_ADD,r.FUNC_ADD))}setPolygonOffset(t,s){this.gl.polygonOffset(t,s)}resetState(){this._glFrontFace=!1,this._frontFace=!1,this._cullFace=!1,this._frontFaceDirty=!1,this._invertFrontFace=!1,this.gl.frontFace(this.gl.CCW),this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode="",this.setBlendMode("normal")}_updateCheck(t,s){const r=this.checks.indexOf(t);s&&r===-1?this.checks.push(t):!s&&r!==-1&&this.checks.splice(r,1)}static _checkBlendMode(t,s){t.setBlendMode(s.blendMode)}static _checkPolygonOffset(t,s){t.setPolygonOffset(1,s.polygonOffset)}destroy(){this.gl=null,this.checks.length=0}};yI.extension={type:[V.WebGLSystem],name:"state"};let K1=yI;class j1{constructor(t){this.target=tI.TEXTURE_2D,this.texture=t,this.width=-1,this.height=-1,this.type=Be.UNSIGNED_BYTE,this.internalFormat=lg.RGBA,this.format=lg.RGBA,this.samplerType=0}}const q1={id:"buffer",upload(l,t,s){t.width===l.width||t.height===l.height?s.texSubImage2D(s.TEXTURE_2D,0,0,0,l.width,l.height,t.format,t.type,l.resource):s.texImage2D(t.target,0,t.internalFormat,l.width,l.height,0,t.format,t.type,l.resource),t.width=l.width,t.height=l.height}},J1={"bc1-rgba-unorm":!0,"bc1-rgba-unorm-srgb":!0,"bc2-rgba-unorm":!0,"bc2-rgba-unorm-srgb":!0,"bc3-rgba-unorm":!0,"bc3-rgba-unorm-srgb":!0,"bc4-r-unorm":!0,"bc4-r-snorm":!0,"bc5-rg-unorm":!0,"bc5-rg-snorm":!0,"bc6h-rgb-ufloat":!0,"bc6h-rgb-float":!0,"bc7-rgba-unorm":!0,"bc7-rgba-unorm-srgb":!0,"etc2-rgb8unorm":!0,"etc2-rgb8unorm-srgb":!0,"etc2-rgb8a1unorm":!0,"etc2-rgb8a1unorm-srgb":!0,"etc2-rgba8unorm":!0,"etc2-rgba8unorm-srgb":!0,"eac-r11unorm":!0,"eac-r11snorm":!0,"eac-rg11unorm":!0,"eac-rg11snorm":!0,"astc-4x4-unorm":!0,"astc-4x4-unorm-srgb":!0,"astc-5x4-unorm":!0,"astc-5x4-unorm-srgb":!0,"astc-5x5-unorm":!0,"astc-5x5-unorm-srgb":!0,"astc-6x5-unorm":!0,"astc-6x5-unorm-srgb":!0,"astc-6x6-unorm":!0,"astc-6x6-unorm-srgb":!0,"astc-8x5-unorm":!0,"astc-8x5-unorm-srgb":!0,"astc-8x6-unorm":!0,"astc-8x6-unorm-srgb":!0,"astc-8x8-unorm":!0,"astc-8x8-unorm-srgb":!0,"astc-10x5-unorm":!0,"astc-10x5-unorm-srgb":!0,"astc-10x6-unorm":!0,"astc-10x6-unorm-srgb":!0,"astc-10x8-unorm":!0,"astc-10x8-unorm-srgb":!0,"astc-10x10-unorm":!0,"astc-10x10-unorm-srgb":!0,"astc-12x10-unorm":!0,"astc-12x10-unorm-srgb":!0,"astc-12x12-unorm":!0,"astc-12x12-unorm-srgb":!0},Z1={id:"compressed",upload(l,t,s){s.pixelStorei(s.UNPACK_ALIGNMENT,4);let r=l.pixelWidth,o=l.pixelHeight;const a=!!J1[l.format];for(let h=0;h<l.resource.length;h++){const u=l.resource[h];a?s.compressedTexImage2D(s.TEXTURE_2D,h,t.internalFormat,r,o,0,u):s.texImage2D(s.TEXTURE_2D,h,t.internalFormat,r,o,0,t.format,t.type,u),r=Math.max(r>>1,1),o=Math.max(o>>1,1)}}},vI={id:"image",upload(l,t,s,r){const o=t.width,a=t.height,h=l.pixelWidth,u=l.pixelHeight,p=l.resourceWidth,f=l.resourceHeight;p<h||f<u?((o!==h||a!==u)&&s.texImage2D(t.target,0,t.internalFormat,h,u,0,t.format,t.type,null),r===2?s.texSubImage2D(s.TEXTURE_2D,0,0,0,p,f,t.format,t.type,l.resource):s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,t.type,l.resource)):o===h&&a===u?s.texSubImage2D(s.TEXTURE_2D,0,0,0,t.format,t.type,l.resource):r===2?s.texImage2D(t.target,0,t.internalFormat,h,u,0,t.format,t.type,l.resource):s.texImage2D(t.target,0,t.internalFormat,t.format,t.type,l.resource),t.width=h,t.height=u}},Q1={id:"video",upload(l,t,s,r){if(!l.isValid){s.texImage2D(t.target,0,t.internalFormat,1,1,0,t.format,t.type,null);return}vI.upload(l,t,s,r)}},Vy={linear:9729,nearest:9728},eF={linear:{linear:9987,nearest:9985},nearest:{linear:9986,nearest:9984}},Lf={"clamp-to-edge":33071,repeat:10497,"mirror-repeat":33648},tF={never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519};function Wy(l,t,s,r,o,a,h,u){const p=a;if(!u||l.addressModeU!=="repeat"||l.addressModeV!=="repeat"||l.addressModeW!=="repeat"){const f=Lf[h?"clamp-to-edge":l.addressModeU],g=Lf[h?"clamp-to-edge":l.addressModeV],_=Lf[h?"clamp-to-edge":l.addressModeW];t[o](p,t.TEXTURE_WRAP_S,f),t[o](p,t.TEXTURE_WRAP_T,g),t.TEXTURE_WRAP_R&&t[o](p,t.TEXTURE_WRAP_R,_)}if((!u||l.magFilter!=="linear")&&t[o](p,t.TEXTURE_MAG_FILTER,Vy[l.magFilter]),s){if(!u||l.mipmapFilter!=="linear"){const f=eF[l.minFilter][l.mipmapFilter];t[o](p,t.TEXTURE_MIN_FILTER,f)}}else t[o](p,t.TEXTURE_MIN_FILTER,Vy[l.minFilter]);if(r&&l.maxAnisotropy>1){const f=Math.min(l.maxAnisotropy,t.getParameter(r.MAX_TEXTURE_MAX_ANISOTROPY_EXT));t[o](p,r.TEXTURE_MAX_ANISOTROPY_EXT,f)}l.compare&&t[o](p,t.TEXTURE_COMPARE_FUNC,tF[l.compare])}function sF(l){return{r8unorm:l.RED,r8snorm:l.RED,r8uint:l.RED,r8sint:l.RED,r16uint:l.RED,r16sint:l.RED,r16float:l.RED,rg8unorm:l.RG,rg8snorm:l.RG,rg8uint:l.RG,rg8sint:l.RG,r32uint:l.RED,r32sint:l.RED,r32float:l.RED,rg16uint:l.RG,rg16sint:l.RG,rg16float:l.RG,rgba8unorm:l.RGBA,"rgba8unorm-srgb":l.RGBA,rgba8snorm:l.RGBA,rgba8uint:l.RGBA,rgba8sint:l.RGBA,bgra8unorm:l.RGBA,"bgra8unorm-srgb":l.RGBA,rgb9e5ufloat:l.RGB,rgb10a2unorm:l.RGBA,rg11b10ufloat:l.RGB,rg32uint:l.RG,rg32sint:l.RG,rg32float:l.RG,rgba16uint:l.RGBA,rgba16sint:l.RGBA,rgba16float:l.RGBA,rgba32uint:l.RGBA,rgba32sint:l.RGBA,rgba32float:l.RGBA,stencil8:l.STENCIL_INDEX8,depth16unorm:l.DEPTH_COMPONENT,depth24plus:l.DEPTH_COMPONENT,"depth24plus-stencil8":l.DEPTH_STENCIL,depth32float:l.DEPTH_COMPONENT,"depth32float-stencil8":l.DEPTH_STENCIL}}function iF(l,t){let s={},r=l.RGBA;return l instanceof it.get().getWebGLRenderingContext()?t.srgb&&(s={"rgba8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT,"bgra8unorm-srgb":t.srgb.SRGB8_ALPHA8_EXT}):(s={"rgba8unorm-srgb":l.SRGB8_ALPHA8,"bgra8unorm-srgb":l.SRGB8_ALPHA8},r=l.RGBA8),{r8unorm:l.R8,r8snorm:l.R8_SNORM,r8uint:l.R8UI,r8sint:l.R8I,r16uint:l.R16UI,r16sint:l.R16I,r16float:l.R16F,rg8unorm:l.RG8,rg8snorm:l.RG8_SNORM,rg8uint:l.RG8UI,rg8sint:l.RG8I,r32uint:l.R32UI,r32sint:l.R32I,r32float:l.R32F,rg16uint:l.RG16UI,rg16sint:l.RG16I,rg16float:l.RG16F,rgba8unorm:l.RGBA,...s,rgba8snorm:l.RGBA8_SNORM,rgba8uint:l.RGBA8UI,rgba8sint:l.RGBA8I,bgra8unorm:r,rgb9e5ufloat:l.RGB9_E5,rgb10a2unorm:l.RGB10_A2,rg11b10ufloat:l.R11F_G11F_B10F,rg32uint:l.RG32UI,rg32sint:l.RG32I,rg32float:l.RG32F,rgba16uint:l.RGBA16UI,rgba16sint:l.RGBA16I,rgba16float:l.RGBA16F,rgba32uint:l.RGBA32UI,rgba32sint:l.RGBA32I,rgba32float:l.RGBA32F,stencil8:l.STENCIL_INDEX8,depth16unorm:l.DEPTH_COMPONENT16,depth24plus:l.DEPTH_COMPONENT24,"depth24plus-stencil8":l.DEPTH24_STENCIL8,depth32float:l.DEPTH_COMPONENT32F,"depth32float-stencil8":l.DEPTH32F_STENCIL8,...t.s3tc?{"bc1-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT,"bc2-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT,"bc3-rgba-unorm":t.s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT}:{},...t.s3tc_sRGB?{"bc1-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,"bc2-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,"bc3-rgba-unorm-srgb":t.s3tc_sRGB.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}:{},...t.rgtc?{"bc4-r-unorm":t.rgtc.COMPRESSED_RED_RGTC1_EXT,"bc4-r-snorm":t.rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT,"bc5-rg-unorm":t.rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT,"bc5-rg-snorm":t.rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}:{},...t.bptc?{"bc6h-rgb-float":t.bptc.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT,"bc6h-rgb-ufloat":t.bptc.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT,"bc7-rgba-unorm":t.bptc.COMPRESSED_RGBA_BPTC_UNORM_EXT,"bc7-rgba-unorm-srgb":t.bptc.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT}:{},...t.etc?{"etc2-rgb8unorm":t.etc.COMPRESSED_RGB8_ETC2,"etc2-rgb8unorm-srgb":t.etc.COMPRESSED_SRGB8_ETC2,"etc2-rgb8a1unorm":t.etc.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgb8a1unorm-srgb":t.etc.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,"etc2-rgba8unorm":t.etc.COMPRESSED_RGBA8_ETC2_EAC,"etc2-rgba8unorm-srgb":t.etc.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC,"eac-r11unorm":t.etc.COMPRESSED_R11_EAC,"eac-rg11unorm":t.etc.COMPRESSED_SIGNED_RG11_EAC}:{},...t.astc?{"astc-4x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_4x4_KHR,"astc-4x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR,"astc-5x4-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x4_KHR,"astc-5x4-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR,"astc-5x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_5x5_KHR,"astc-5x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR,"astc-6x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x5_KHR,"astc-6x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR,"astc-6x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_6x6_KHR,"astc-6x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR,"astc-8x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x5_KHR,"astc-8x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR,"astc-8x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x6_KHR,"astc-8x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR,"astc-8x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_8x8_KHR,"astc-8x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR,"astc-10x5-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x5_KHR,"astc-10x5-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR,"astc-10x6-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x6_KHR,"astc-10x6-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR,"astc-10x8-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x8_KHR,"astc-10x8-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR,"astc-10x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_10x10_KHR,"astc-10x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR,"astc-12x10-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x10_KHR,"astc-12x10-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR,"astc-12x12-unorm":t.astc.COMPRESSED_RGBA_ASTC_12x12_KHR,"astc-12x12-unorm-srgb":t.astc.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR}:{}}}function rF(l){return{r8unorm:l.UNSIGNED_BYTE,r8snorm:l.BYTE,r8uint:l.UNSIGNED_BYTE,r8sint:l.BYTE,r16uint:l.UNSIGNED_SHORT,r16sint:l.SHORT,r16float:l.HALF_FLOAT,rg8unorm:l.UNSIGNED_BYTE,rg8snorm:l.BYTE,rg8uint:l.UNSIGNED_BYTE,rg8sint:l.BYTE,r32uint:l.UNSIGNED_INT,r32sint:l.INT,r32float:l.FLOAT,rg16uint:l.UNSIGNED_SHORT,rg16sint:l.SHORT,rg16float:l.HALF_FLOAT,rgba8unorm:l.UNSIGNED_BYTE,"rgba8unorm-srgb":l.UNSIGNED_BYTE,rgba8snorm:l.BYTE,rgba8uint:l.UNSIGNED_BYTE,rgba8sint:l.BYTE,bgra8unorm:l.UNSIGNED_BYTE,"bgra8unorm-srgb":l.UNSIGNED_BYTE,rgb9e5ufloat:l.UNSIGNED_INT_5_9_9_9_REV,rgb10a2unorm:l.UNSIGNED_INT_2_10_10_10_REV,rg11b10ufloat:l.UNSIGNED_INT_10F_11F_11F_REV,rg32uint:l.UNSIGNED_INT,rg32sint:l.INT,rg32float:l.FLOAT,rgba16uint:l.UNSIGNED_SHORT,rgba16sint:l.SHORT,rgba16float:l.HALF_FLOAT,rgba32uint:l.UNSIGNED_INT,rgba32sint:l.INT,rgba32float:l.FLOAT,stencil8:l.UNSIGNED_BYTE,depth16unorm:l.UNSIGNED_SHORT,depth24plus:l.UNSIGNED_INT,"depth24plus-stencil8":l.UNSIGNED_INT_24_8,depth32float:l.FLOAT,"depth32float-stencil8":l.FLOAT_32_UNSIGNED_INT_24_8_REV}}const nF=4;class SI{constructor(t){this.managedTextures=[],this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundTextures=[],this._activeTextureLocation=-1,this._boundSamplers=Object.create(null),this._uploads={image:vI,buffer:q1,video:Q1,compressed:Z1},this._premultiplyAlpha=!1,this._useSeparateSamplers=!1,this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_glTextures"),this._renderer.renderableGC.addManagedHash(this,"_glSamplers")}contextChange(t){this._gl=t,this._mapFormatToInternalFormat||(this._mapFormatToInternalFormat=iF(t,this._renderer.context.extensions),this._mapFormatToType=rF(t),this._mapFormatToFormat=sF(t)),this._glTextures=Object.create(null),this._glSamplers=Object.create(null),this._boundSamplers=Object.create(null),this._premultiplyAlpha=!1;for(let s=0;s<16;s++)this.bind(me.EMPTY,s)}initSource(t){this.bind(t)}bind(t,s=0){const r=t.source;t?(this.bindSource(r,s),this._useSeparateSamplers&&this._bindSampler(r.style,s)):(this.bindSource(null,s),this._useSeparateSamplers&&this._bindSampler(null,s))}bindSource(t,s=0){const r=this._gl;if(t._touched=this._renderer.textureGC.count,this._boundTextures[s]!==t){this._boundTextures[s]=t,this._activateLocation(s),t||(t=me.EMPTY.source);const o=this.getGlSource(t);r.bindTexture(o.target,o.texture)}}_bindSampler(t,s=0){const r=this._gl;if(!t){this._boundSamplers[s]=null,r.bindSampler(s,null);return}const o=this._getGlSampler(t);this._boundSamplers[s]!==o&&(this._boundSamplers[s]=o,r.bindSampler(s,o))}unbind(t){const s=t.source,r=this._boundTextures,o=this._gl;for(let a=0;a<r.length;a++)if(r[a]===s){this._activateLocation(a);const h=this.getGlSource(s);o.bindTexture(h.target,null),r[a]=null}}_activateLocation(t){this._activeTextureLocation!==t&&(this._activeTextureLocation=t,this._gl.activeTexture(this._gl.TEXTURE0+t))}_initSource(t){const s=this._gl,r=new j1(s.createTexture());if(r.type=this._mapFormatToType[t.format],r.internalFormat=this._mapFormatToInternalFormat[t.format],r.format=this._mapFormatToFormat[t.format],t.autoGenerateMipmaps&&(this._renderer.context.supports.nonPowOf2mipmaps||t.isPowerOfTwo)){const o=Math.max(t.width,t.height);t.mipLevelCount=Math.floor(Math.log2(o))+1}return this._glTextures[t.uid]=r,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceUpdate,this),t.on("styleChange",this.onStyleChange,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),this.updateStyle(t,!1),r}onStyleChange(t){this.updateStyle(t,!1)}updateStyle(t,s){const r=this._gl,o=this.getGlSource(t);r.bindTexture(r.TEXTURE_2D,o.texture),this._boundTextures[this._activeTextureLocation]=t,Wy(t.style,r,t.mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"texParameteri",r.TEXTURE_2D,!this._renderer.context.supports.nonPowOf2wrapping&&!t.isPowerOfTwo,s)}onSourceUnload(t){const s=this._glTextures[t.uid];s&&(this.unbind(t),this._glTextures[t.uid]=null,this._gl.deleteTexture(s.texture))}onSourceUpdate(t){const s=this._gl,r=this.getGlSource(t);s.bindTexture(s.TEXTURE_2D,r.texture),this._boundTextures[this._activeTextureLocation]=t;const o=t.alphaMode==="premultiply-alpha-on-upload";this._premultiplyAlpha!==o&&(this._premultiplyAlpha=o,s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o)),this._uploads[t.uploadMethodId]?this._uploads[t.uploadMethodId].upload(t,r,s,this._renderer.context.webGLVersion):s.texImage2D(s.TEXTURE_2D,0,s.RGBA,t.pixelWidth,t.pixelHeight,0,s.RGBA,s.UNSIGNED_BYTE,null),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t,!1)}onUpdateMipmaps(t,s=!0){s&&this.bindSource(t,0);const r=this.getGlSource(t);this._gl.generateMipmap(r.target)}onSourceDestroy(t){t.off("destroy",this.onSourceDestroy,this),t.off("update",this.onSourceUpdate,this),t.off("resize",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("styleChange",this.onStyleChange,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}_initSampler(t){const s=this._gl,r=this._gl.createSampler();return this._glSamplers[t._resourceId]=r,Wy(t,s,this._boundTextures[this._activeTextureLocation].mipLevelCount>1,this._renderer.context.extensions.anisotropicFiltering,"samplerParameteri",r,!1,!0),this._glSamplers[t._resourceId]}_getGlSampler(t){return this._glSamplers[t._resourceId]||this._initSampler(t)}getGlSource(t){return this._glTextures[t.uid]||this._initSource(t)}generateCanvas(t){const{pixels:s,width:r,height:o}=this.getPixels(t),a=it.get().createCanvas();a.width=r,a.height=o;const h=a.getContext("2d");if(h){const u=h.createImageData(r,o);u.data.set(s),h.putImageData(u,0,0)}return a}getPixels(t){const s=t.source.resolution,r=t.frame,o=Math.max(Math.round(r.width*s),1),a=Math.max(Math.round(r.height*s),1),h=new Uint8Array(nF*o*a),u=this._renderer,p=u.renderTarget.getRenderTarget(t),f=u.renderTarget.getGpuRenderTarget(p),g=u.gl;return g.bindFramebuffer(g.FRAMEBUFFER,f.resolveTargetFramebuffer),g.readPixels(Math.round(r.x*s),Math.round(r.y*s),o,a,g.RGBA,g.UNSIGNED_BYTE,h),{pixels:new Uint8ClampedArray(h.buffer),width:o,height:a}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null,this._renderer=null}resetState(){this._activeTextureLocation=-1,this._boundTextures.fill(me.EMPTY.source),this._boundSamplers=Object.create(null);const t=this._gl;this._premultiplyAlpha=!1,t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,this._premultiplyAlpha)}}SI.extension={type:[V.WebGLSystem],name:"texture"};class II{contextChange(t){const s=new ns({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uRound:{value:0,type:"f32"}}),r=t.limits.maxBatchableTextures,o=Hl({name:"graphics",bits:[Og,Mg(r),zg,Wl]});this.shader=new Ds({glProgram:o,resources:{localUniforms:s,batchSamplers:Lg(r)}})}execute(t,s){const r=s.context,o=r.customShader||this.shader,a=t.renderer,h=a.graphicsContext,{batcher:u,instructions:p}=h.getContextRenderData(r);o.groups[0]=a.globalUniforms.bindGroup,a.state.set(t.state),a.shader.bind(o),a.geometry.bind(u.geometry,o.glProgram);const f=p.instructions;for(let g=0;g<p.instructionSize;g++){const _=f[g];if(_.size){for(let $=0;$<_.textures.count;$++)a.texture.bind(_.textures.textures[$],$);a.geometry.draw(_.topology,_.size,_.start)}}}destroy(){this.shader.destroy(!0),this.shader=null}}II.extension={type:[V.WebGLPipesAdaptor],name:"graphics"};class xI{init(){const t=Hl({name:"mesh",bits:[zg,u1,Wl]});this._shader=new Ds({glProgram:t,resources:{uTexture:me.EMPTY.source,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new Te}}}})}execute(t,s){const r=t.renderer;let o=s._shader;if(o){if(!o.glProgram){we("Mesh shader has no glProgram",s.shader);return}}else{o=this._shader;const a=s.texture,h=a.source;o.resources.uTexture=h,o.resources.uSampler=h.style,o.resources.textureUniforms.uniforms.uTextureMatrix=a.textureMatrix.mapCoord}o.groups[100]=r.globalUniforms.bindGroup,o.groups[101]=t.localUniformsBindGroup,r.encoder.draw({geometry:s._geometry,shader:o,state:s.state})}destroy(){this._shader.destroy(!0),this._shader=null}}xI.extension={type:[V.WebGLPipesAdaptor],name:"mesh"};class CI{constructor(t){this._renderer=t}updateRenderable(){}destroyRenderable(){}validateRenderable(){return!1}addRenderable(t,s){this._renderer.renderPipes.batch.break(s),s.add(t)}execute(t){t.isRenderable&&t.render(this._renderer)}destroy(){this._renderer=null}}CI.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"customRender"};class _h{constructor(){this.batcherName="default",this.topology="triangle-list",this.attributeSize=4,this.indexSize=6,this.packAsQuad=!0,this.roundPixels=0,this._attributeStart=0,this._batcher=null,this._batch=null}get blendMode(){return this.renderable.groupBlendMode}get color(){return this.renderable.groupColorAlpha}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.bounds=null}destroy(){}}function hg(l,t){const s=l.instructionSet,r=s.instructions;for(let o=0;o<s.instructionSize;o++){const a=r[o];t[a.renderPipeId].execute(a)}}const oF=new Te;class wI{constructor(t){this._renderer=t}addRenderGroup(t,s){t.isCachedAsTexture?this._addRenderableCacheAsTexture(t,s):this._addRenderableDirect(t,s)}execute(t){t.isRenderable&&(t.isCachedAsTexture?this._executeCacheAsTexture(t):this._executeDirect(t))}destroy(){this._renderer=null}_addRenderableDirect(t,s){this._renderer.renderPipes.batch.break(s),t._batchableRenderGroup&&(Pt.return(t._batchableRenderGroup),t._batchableRenderGroup=null),s.add(t)}_addRenderableCacheAsTexture(t,s){const r=t._batchableRenderGroup??(t._batchableRenderGroup=Pt.get(_h));r.renderable=t.root,r.transform=t.root.relativeGroupTransform,r.texture=t.texture,r.bounds=t._textureBounds,s.add(t),this._renderer.renderPipes.batch.addToBatch(r,s)}_executeCacheAsTexture(t){if(t.textureNeedsUpdate){t.textureNeedsUpdate=!1;const s=oF.identity().translate(-t._textureBounds.x,-t._textureBounds.y);this._renderer.renderTarget.push(t.texture,!0,null,t.texture.frame),this._renderer.globalUniforms.push({worldTransformMatrix:s,worldColor:4294967295}),hg(t,this._renderer.renderPipes),this._renderer.renderTarget.finishRenderPass(),this._renderer.renderTarget.pop(),this._renderer.globalUniforms.pop()}t._batchableRenderGroup._batcher.updateElement(t._batchableRenderGroup),t._batchableRenderGroup._batcher.geometry.buffers[0].update()}_executeDirect(t){this._renderer.globalUniforms.push({worldTransformMatrix:t.inverseParentTextureTransform,worldColor:t.worldColorAlpha}),hg(t,this._renderer.renderPipes),this._renderer.globalUniforms.pop()}}wI.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"renderGroup"};function ug(l,t){t||(t=0);for(let s=t;s<l.length&&l[s];s++)l[s]=null}const lF=new Nt,zy=vl|rh|vg;function RI(l,t=!1){aF(l);const s=l.childrenToUpdate,r=l.updateTick++;for(const o in s){const a=Number(o),h=s[o],u=h.list,p=h.index;for(let f=0;f<p;f++){const g=u[f];g.parentRenderGroup===l&&g.relativeRenderGroupDepth===a&&kI(g,r,0)}ug(u,p),h.index=0}if(t)for(let o=0;o<l.renderGroupChildren.length;o++)RI(l.renderGroupChildren[o],t)}function aF(l){const t=l.root;let s;if(l.renderGroupParent){const r=l.renderGroupParent;l.worldTransform.appendFrom(t.relativeGroupTransform,r.worldTransform),l.worldColor=ih(t.groupColor,r.worldColor),s=t.groupAlpha*r.worldAlpha}else l.worldTransform.copyFrom(t.localTransform),l.worldColor=t.localColor,s=t.localAlpha;s=s<0?0:s>1?1:s,l.worldAlpha=s,l.worldColorAlpha=l.worldColor+((s*255|0)<<24)}function kI(l,t,s){if(t===l.updateTick)return;l.updateTick=t,l.didChange=!1;const r=l.localTransform;l.updateLocalTransform();const o=l.parent;if(o&&!o.renderGroup?(s|=l._updateFlags,l.relativeGroupTransform.appendFrom(r,o.relativeGroupTransform),s&zy&&Xy(l,o,s)):(s=l._updateFlags,l.relativeGroupTransform.copyFrom(r),s&zy&&Xy(l,lF,s)),!l.renderGroup){const a=l.children,h=a.length;for(let f=0;f<h;f++)kI(a[f],t,s);const u=l.parentRenderGroup,p=l;p.renderPipeId&&!u.structureDidChange&&u.updateRenderable(p)}}function Xy(l,t,s){if(s&rh){l.groupColor=ih(l.localColor,t.groupColor);let r=l.localAlpha*t.groupAlpha;r=r<0?0:r>1?1:r,l.groupAlpha=r,l.groupColorAlpha=l.groupColor+((r*255|0)<<24)}s&vg&&(l.groupBlendMode=l.localBlendMode==="inherit"?t.groupBlendMode:l.localBlendMode),s&vl&&(l.globalDisplayStatus=l.localDisplayStatus&t.globalDisplayStatus),l._updateFlags=0}function cF(l,t){const{list:s,index:r}=l.childrenRenderablesToUpdate;let o=!1;for(let a=0;a<r;a++){const h=s[a];if(o=t[h.renderPipeId].validateRenderable(h),o)break}return l.structureDidChange=o,o}const hF=new Te;class OI{constructor(t){this._renderer=t}render({container:t,transform:s}){const r=t.parent,o=t.renderGroup.renderGroupParent;t.parent=null,t.renderGroup.renderGroupParent=null;const a=this._renderer;let h=hF;s&&(h=h.copyFrom(t.renderGroup.localTransform),t.renderGroup.localTransform.copyFrom(s));const u=a.renderPipes;this._updateCachedRenderGroups(t.renderGroup,null),this._updateRenderGroups(t.renderGroup),a.globalUniforms.start({worldTransformMatrix:s?t.renderGroup.localTransform:t.renderGroup.worldTransform,worldColor:t.renderGroup.worldColorAlpha}),hg(t.renderGroup,u),u.uniformBatch&&u.uniformBatch.renderEnd(),s&&t.renderGroup.localTransform.copyFrom(h),t.parent=r,t.renderGroup.renderGroupParent=o}destroy(){this._renderer=null}_updateCachedRenderGroups(t,s){if(t.isCachedAsTexture){if(!t.updateCacheTexture)return;s=t}t._parentCacheAsTextureRenderGroup=s;for(let r=t.renderGroupChildren.length-1;r>=0;r--)this._updateCachedRenderGroups(t.renderGroupChildren[r],s);if(t.invalidateMatrices(),t.isCachedAsTexture){if(t.textureNeedsUpdate){const r=t.root.getLocalBounds();r.ceil();const o=t.texture;t.texture&&zt.returnTexture(t.texture);const a=this._renderer,h=t.textureOptions.resolution||a.view.resolution,u=t.textureOptions.antialias??a.view.antialias;t.texture=zt.getOptimalTexture(r.width,r.height,h,u),t._textureBounds||(t._textureBounds=new Yt),t._textureBounds.copyFrom(r),o!==t.texture&&t.renderGroupParent&&(t.renderGroupParent.structureDidChange=!0)}}else t.texture&&(zt.returnTexture(t.texture),t.texture=null)}_updateRenderGroups(t){const s=this._renderer,r=s.renderPipes;if(t.runOnRender(s),t.instructionSet.renderPipes=r,t.structureDidChange?ug(t.childrenRenderablesToUpdate.list,0):cF(t,r),RI(t),t.structureDidChange?(t.structureDidChange=!1,this._buildInstructions(t,s)):this._updateRenderables(t),t.childrenRenderablesToUpdate.index=0,s.renderPipes.batch.upload(t.instructionSet),!(t.isCachedAsTexture&&!t.textureNeedsUpdate))for(let o=0;o<t.renderGroupChildren.length;o++)this._updateRenderGroups(t.renderGroupChildren[o])}_updateRenderables(t){const{list:s,index:r}=t.childrenRenderablesToUpdate;for(let o=0;o<r;o++){const a=s[o];a.didViewUpdate&&t.updateRenderable(a)}ug(s,r)}_buildInstructions(t,s){const r=t.root,o=t.instructionSet;o.reset();const a=s.renderPipes?s:s.batch.renderer,h=a.renderPipes;h.batch.buildStart(o),h.blendMode.buildStart(),h.colorMask.buildStart(),r.sortableChildren&&r.sortChildren(),r.collectRenderablesWithEffects(o,a,null),h.batch.buildEnd(o),h.blendMode.buildEnd(o)}}OI.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"renderGroup"};class AI{constructor(t){this._renderer=t}addRenderable(t,s){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,s)}updateRenderable(t){const s=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,s),s._batcher.updateElement(s)}validateRenderable(t){const s=this._getGpuSprite(t);return!s._batcher.checkAndUpdateTexture(s,t._texture)}_updateBatchableSprite(t,s){s.bounds=t.visualBounds,s.texture=t._texture}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const s=new _h;return s.renderable=t,s.transform=t.groupTransform,s.texture=t._texture,s.bounds=t.visualBounds,s.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=s,s}destroy(){this._renderer=null}}AI.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"sprite"};const jg=class MI{constructor(){this.clearBeforeRender=!0,this._backgroundColor=new We(0),this.color=this._backgroundColor,this.alpha=1}init(t){t={...MI.defaultOptions,...t},this.clearBeforeRender=t.clearBeforeRender,this.color=t.background||t.backgroundColor||this._backgroundColor,this.alpha=t.backgroundAlpha,this._backgroundColor.setAlpha(t.backgroundAlpha)}get color(){return this._backgroundColor}set color(t){We.shared.setValue(t).alpha<1&&this._backgroundColor.alpha===1&&we("Cannot set a transparent background on an opaque canvas. To enable transparency, set backgroundAlpha < 1 when initializing your Application."),this._backgroundColor.setValue(t)}get alpha(){return this._backgroundColor.alpha}set alpha(t){this._backgroundColor.setAlpha(t)}get colorRgba(){return this._backgroundColor.toArray()}destroy(){}};jg.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"background",priority:0};jg.defaultOptions={backgroundAlpha:1,backgroundColor:0,clearBeforeRender:!0};let uF=jg;const Cl={};Se.handle(V.BlendMode,l=>{if(!l.name)throw new Error("BlendMode extension must have a name property");Cl[l.name]=l.ref},l=>{delete Cl[l.name]});class LI{constructor(t){this._isAdvanced=!1,this._filterHash=Object.create(null),this._renderer=t,this._renderer.runners.prerender.add(this)}prerender(){this._activeBlendMode="normal",this._isAdvanced=!1}setBlendMode(t,s,r){if(this._activeBlendMode===s){this._isAdvanced&&this._renderableList.push(t);return}this._activeBlendMode=s,this._isAdvanced&&this._endAdvancedBlendMode(r),this._isAdvanced=!!Cl[s],this._isAdvanced&&(this._beginAdvancedBlendMode(r),this._renderableList.push(t))}_beginAdvancedBlendMode(t){this._renderer.renderPipes.batch.break(t);const s=this._activeBlendMode;if(!Cl[s]){we(`Unable to assign BlendMode: '${s}'. You may want to include: import 'pixi.js/advanced-blend-modes'`);return}let r=this._filterHash[s];r||(r=this._filterHash[s]=new sh,r.filters=[new Cl[s]]);const o={renderPipeId:"filter",action:"pushFilter",renderables:[],filterEffect:r,canBundle:!1};this._renderableList=o.renderables,t.add(o)}_endAdvancedBlendMode(t){this._renderableList=null,this._renderer.renderPipes.batch.break(t),t.add({renderPipeId:"filter",action:"popFilter",canBundle:!1})}buildStart(){this._isAdvanced=!1}buildEnd(t){this._isAdvanced&&this._endAdvancedBlendMode(t)}destroy(){this._renderer=null,this._renderableList=null;for(const t in this._filterHash)this._filterHash[t].destroy();this._filterHash=null}}LI.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"blendMode"};const Pf={png:"image/png",jpg:"image/jpeg",webp:"image/webp"},qg=class PI{constructor(t){this._renderer=t}_normalizeOptions(t,s={}){return t instanceof Nt||t instanceof me?{target:t,...s}:{...s,...t}}async image(t){const s=new Image;return s.src=await this.base64(t),s}async base64(t){t=this._normalizeOptions(t,PI.defaultImageOptions);const{format:s,quality:r}=t,o=this.canvas(t);if(o.toBlob!==void 0)return new Promise((a,h)=>{o.toBlob(u=>{if(!u){h(new Error("ICanvas.toBlob failed!"));return}const p=new FileReader;p.onload=()=>a(p.result),p.onerror=h,p.readAsDataURL(u)},Pf[s],r)});if(o.toDataURL!==void 0)return o.toDataURL(Pf[s],r);if(o.convertToBlob!==void 0){const a=await o.convertToBlob({type:Pf[s],quality:r});return new Promise((h,u)=>{const p=new FileReader;p.onload=()=>h(p.result),p.onerror=u,p.readAsDataURL(a)})}throw new Error("Extract.base64() requires ICanvas.toDataURL, ICanvas.toBlob, or ICanvas.convertToBlob to be implemented")}canvas(t){t=this._normalizeOptions(t);const s=t.target,r=this._renderer;if(s instanceof me)return r.texture.generateCanvas(s);const o=r.textureGenerator.generateTexture(t),a=r.texture.generateCanvas(o);return o.destroy(!0),a}pixels(t){t=this._normalizeOptions(t);const s=t.target,r=this._renderer,o=s instanceof me?s:r.textureGenerator.generateTexture(t),a=r.texture.getPixels(o);return s instanceof Nt&&o.destroy(!0),a}texture(t){return t=this._normalizeOptions(t),t.target instanceof me?t.target:this._renderer.textureGenerator.generateTexture(t)}download(t){t=this._normalizeOptions(t);const s=this.canvas(t),r=document.createElement("a");r.download=t.filename??"image.png",r.href=s.toDataURL("image/png"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}log(t){const s=t.width??200;t=this._normalizeOptions(t);const r=this.canvas(t),o=r.toDataURL();console.log(`[Pixi Texture] ${r.width}px ${r.height}px`);const a=["font-size: 1px;",`padding: ${s}px 300px;`,`background: url(${o}) no-repeat;`,"background-size: contain;"].join(" ");console.log("%c ",a)}destroy(){this._renderer=null}};qg.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"extract"};qg.defaultImageOptions={format:"png",quality:1};let dF=qg;class Jg extends me{static create(t){return new Jg({source:new vt(t)})}resize(t,s,r){return this.source.resize(t,s,r),this}}const pF=new Fe,fF=new Yt,gF=[0,0,0,0];class NI{constructor(t){this._renderer=t}generateTexture(t){var f;t instanceof Nt&&(t={target:t,frame:void 0,textureSourceOptions:{},resolution:void 0});const s=t.resolution||this._renderer.resolution,r=t.antialias||this._renderer.view.antialias,o=t.target;let a=t.clearColor;a?a=Array.isArray(a)&&a.length===4?a:We.shared.setValue(a).toArray():a=gF;const h=((f=t.frame)==null?void 0:f.copyTo(pF))||yg(o,fF).rectangle;h.width=Math.max(h.width,1/s)|0,h.height=Math.max(h.height,1/s)|0;const u=Jg.create({...t.textureSourceOptions,width:h.width,height:h.height,resolution:s,antialias:r}),p=Te.shared.translate(-h.x,-h.y);return this._renderer.render({container:o,transform:p,target:u,clearColor:a}),u.source.updateMipmaps(),u}destroy(){this._renderer=null}}NI.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"textureGenerator"};function zl(l,t,s){const r=(l>>24&255)/255;t[s++]=(l&255)/255*r,t[s++]=(l>>8&255)/255*r,t[s++]=(l>>16&255)/255*r,t[s++]=r}class DI{constructor(t){this._stackIndex=0,this._globalUniformDataStack=[],this._uniformsPool=[],this._activeUniforms=[],this._bindGroupPool=[],this._activeBindGroups=[],this._renderer=t}reset(){this._stackIndex=0;for(let t=0;t<this._activeUniforms.length;t++)this._uniformsPool.push(this._activeUniforms[t]);for(let t=0;t<this._activeBindGroups.length;t++)this._bindGroupPool.push(this._activeBindGroups[t]);this._activeUniforms.length=0,this._activeBindGroups.length=0}start(t){this.reset(),this.push(t)}bind({size:t,projectionMatrix:s,worldTransformMatrix:r,worldColor:o,offset:a}){const h=this._renderer.renderTarget.renderTarget,u=this._stackIndex?this._globalUniformDataStack[this._stackIndex-1]:{worldTransformMatrix:new Te,worldColor:4294967295,offset:new ve},p={projectionMatrix:s||this._renderer.renderTarget.projectionMatrix,resolution:t||h.size,worldTransformMatrix:r||u.worldTransformMatrix,worldColor:o||u.worldColor,offset:a||u.offset,bindGroup:null},f=this._uniformsPool.pop()||this._createUniforms();this._activeUniforms.push(f);const g=f.uniforms;g.uProjectionMatrix=p.projectionMatrix,g.uResolution=p.resolution,g.uWorldTransformMatrix.copyFrom(p.worldTransformMatrix),g.uWorldTransformMatrix.tx-=p.offset.x,g.uWorldTransformMatrix.ty-=p.offset.y,zl(p.worldColor,g.uWorldColorAlpha,0),f.update();let _;this._renderer.renderPipes.uniformBatch?_=this._renderer.renderPipes.uniformBatch.getUniformBindGroup(f,!1):(_=this._bindGroupPool.pop()||new Ki,this._activeBindGroups.push(_),_.setResource(f,0)),p.bindGroup=_,this._currentGlobalUniformData=p}push(t){this.bind(t),this._globalUniformDataStack[this._stackIndex++]=this._currentGlobalUniformData}pop(){this._currentGlobalUniformData=this._globalUniformDataStack[--this._stackIndex-1],this._renderer.type===ei.WEBGL&&this._currentGlobalUniformData.bindGroup.resources[0].update()}get bindGroup(){return this._currentGlobalUniformData.bindGroup}get globalUniformData(){return this._currentGlobalUniformData}get uniformGroup(){return this._currentGlobalUniformData.bindGroup.resources[0]}_createUniforms(){return new ns({uProjectionMatrix:{value:new Te,type:"mat3x3<f32>"},uWorldTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uWorldColorAlpha:{value:new Float32Array(4),type:"vec4<f32>"},uResolution:{value:[0,0],type:"vec2<f32>"}},{isStatic:!0})}destroy(){this._renderer=null}}DI.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"globalUniforms"};let mF=1;class BI{constructor(){this._tasks=[],this._offset=0}init(){Qs.system.add(this._update,this)}repeat(t,s,r=!0){const o=mF++;let a=0;return r&&(this._offset+=1e3,a=this._offset),this._tasks.push({func:t,duration:s,start:performance.now(),offset:a,last:performance.now(),repeat:!0,id:o}),o}cancel(t){for(let s=0;s<this._tasks.length;s++)if(this._tasks[s].id===t){this._tasks.splice(s,1);return}}_update(){const t=performance.now();for(let s=0;s<this._tasks.length;s++){const r=this._tasks[s];if(t-r.offset-r.last>=r.duration){const o=t-r.start;r.func(o),r.last=t}}}destroy(){Qs.system.remove(this._update,this),this._tasks.length=0}}BI.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"scheduler",priority:0};let Yy=!1;function _F(l){if(!Yy){if(it.get().getNavigator().userAgent.toLowerCase().indexOf("chrome")>-1){const t=[`%c  %c  %c  %c  %c PixiJS %c v${nh} (${l}) http://www.pixijs.com/

`,"background: #E72264; padding:5px 0;","background: #6CA2EA; padding:5px 0;","background: #B5D33D; padding:5px 0;","background: #FED23F; padding:5px 0;","color: #FFFFFF; background: #E72264; padding:5px 0;","color: #E72264; background: #FFFFFF; padding:5px 0;"];globalThis.console.log(...t)}else globalThis.console&&globalThis.console.log(`PixiJS ${nh} - ${l} - http://www.pixijs.com/`);Yy=!0}}class Zg{constructor(t){this._renderer=t}init(t){if(t.hello){let s=this._renderer.name;this._renderer.type===ei.WEBGL&&(s+=` ${this._renderer.context.webGLVersion}`),_F(s)}}}Zg.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"hello",priority:-2};Zg.defaultOptions={hello:!1};function $F(l){let t=!1;for(const r in l)if(l[r]==null){t=!0;break}if(!t)return l;const s=Object.create(null);for(const r in l){const o=l[r];o&&(s[r]=o)}return s}function TF(l){let t=0;for(let s=0;s<l.length;s++)l[s]==null?t++:l[s-t]=l[s];return l.length-=t,l}let bF=0;const Qg=class FI{constructor(t){this._managedRenderables=[],this._managedHashes=[],this._managedArrays=[],this._renderer=t}init(t){t={...FI.defaultOptions,...t},this.maxUnusedTime=t.renderableGCMaxUnusedTime,this._frequency=t.renderableGCFrequency,this.enabled=t.renderableGCActive}get enabled(){return!!this._handler}set enabled(t){this.enabled!==t&&(t?(this._handler=this._renderer.scheduler.repeat(()=>this.run(),this._frequency,!1),this._hashHandler=this._renderer.scheduler.repeat(()=>{for(const s of this._managedHashes)s.context[s.hash]=$F(s.context[s.hash])},this._frequency),this._arrayHandler=this._renderer.scheduler.repeat(()=>{for(const s of this._managedArrays)TF(s.context[s.hash])},this._frequency)):(this._renderer.scheduler.cancel(this._handler),this._renderer.scheduler.cancel(this._hashHandler),this._renderer.scheduler.cancel(this._arrayHandler)))}addManagedHash(t,s){this._managedHashes.push({context:t,hash:s})}addManagedArray(t,s){this._managedArrays.push({context:t,hash:s})}prerender({container:t}){this._now=performance.now(),t.renderGroup.gcTick=bF++,this._updateInstructionGCTick(t.renderGroup,t.renderGroup.gcTick)}addRenderable(t){this.enabled&&(t._lastUsed===-1&&(this._managedRenderables.push(t),t.once("destroyed",this._removeRenderable,this)),t._lastUsed=this._now)}run(){var a;const t=this._now,s=this._managedRenderables,r=this._renderer.renderPipes;let o=0;for(let h=0;h<s.length;h++){const u=s[h];if(u===null){o++;continue}const p=u.renderGroup??u.parentRenderGroup,f=((a=p==null?void 0:p.instructionSet)==null?void 0:a.gcTick)??-1;if(((p==null?void 0:p.gcTick)??0)===f&&(u._lastUsed=t),t-u._lastUsed>this.maxUnusedTime){if(!u.destroyed){const g=r;p&&(p.structureDidChange=!0),g[u.renderPipeId].destroyRenderable(u)}u._lastUsed=-1,o++,u.off("destroyed",this._removeRenderable,this)}else s[h-o]=u}s.length-=o}destroy(){this.enabled=!1,this._renderer=null,this._managedRenderables.length=0,this._managedHashes.length=0,this._managedArrays.length=0}_removeRenderable(t){const s=this._managedRenderables.indexOf(t);s>=0&&(t.off("destroyed",this._removeRenderable,this),this._managedRenderables[s]=null)}_updateInstructionGCTick(t,s){t.instructionSet.gcTick=s;for(const r of t.renderGroupChildren)this._updateInstructionGCTick(r,s)}};Qg.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"renderableGC",priority:0};Qg.defaultOptions={renderableGCActive:!0,renderableGCMaxUnusedTime:6e4,renderableGCFrequency:3e4};let EF=Qg;const em=class UI{constructor(t){this._renderer=t,this.count=0,this.checkCount=0}init(t){t={...UI.defaultOptions,...t},this.checkCountMax=t.textureGCCheckCountMax,this.maxIdle=t.textureGCAMaxIdle??t.textureGCMaxIdle,this.active=t.textureGCActive}postrender(){this._renderer.renderingToScreen&&(this.count++,this.active&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this._renderer.texture.managedTextures;for(let s=0;s<t.length;s++){const r=t[s];r.autoGarbageCollect&&r.resource&&r._touched>-1&&this.count-r._touched>this.maxIdle&&(r._touched=-1,r.unload())}}destroy(){this._renderer=null}};em.extension={type:[V.WebGLSystem,V.WebGPUSystem],name:"textureGC"};em.defaultOptions={textureGCActive:!0,textureGCAMaxIdle:null,textureGCMaxIdle:60*60,textureGCCheckCountMax:600};let yF=em;const tm=class GI{get autoDensity(){return this.texture.source.autoDensity}set autoDensity(t){this.texture.source.autoDensity=t}get resolution(){return this.texture.source._resolution}set resolution(t){this.texture.source.resize(this.texture.source.width,this.texture.source.height,t)}init(t){t={...GI.defaultOptions,...t},t.view&&(ke(He,"ViewSystem.view has been renamed to ViewSystem.canvas"),t.canvas=t.view),this.screen=new Fe(0,0,t.width,t.height),this.canvas=t.canvas||it.get().createCanvas(),this.antialias=!!t.antialias,this.texture=pI(this.canvas,t),this.renderTarget=new ag({colorTextures:[this.texture],depth:!!t.depth,isRoot:!0}),this.texture.source.transparent=t.backgroundAlpha<1,this.resolution=t.resolution}resize(t,s,r){this.texture.source.resize(t,s,r),this.screen.width=this.texture.frame.width,this.screen.height=this.texture.frame.height}destroy(t=!1){(typeof t=="boolean"?t:!!(t!=null&&t.removeView))&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)}};tm.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"view",priority:0};tm.defaultOptions={width:800,height:600,autoDensity:!1,antialias:!1};let vF=tm;const HI=[uF,DI,Zg,vF,OI,yF,NI,dF,hS,EF,BI],VI=[LI,KS,AI,wI,jS,JS,qS,CI],SF=[...HI,dI,b1,g1,oI,ZS,SI,_I,sI,EI,bI,nI,K1,lI,rI],IF=[...VI],xF=[zS,xI,II],WI=[],zI=[],XI=[];Se.handleByNamedList(V.WebGLSystem,WI);Se.handleByNamedList(V.WebGLPipes,zI);Se.handleByNamedList(V.WebGLPipesAdaptor,XI);Se.add(...SF,...IF,...xF);class CF extends fh{constructor(){const t={name:"webgl",type:ei.WEBGL,systems:WI,renderPipes:zI,renderPipeAdaptors:XI};super(t)}}const wF=Object.freeze(Object.defineProperty({__proto__:null,WebGLRenderer:CF},Symbol.toStringTag,{value:"Module"}));class YI{constructor(t){this._hash=Object.create(null),this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_hash")}contextChange(t){this._gpu=t}getBindGroup(t,s,r){return t._updateKey(),this._hash[t._key]||this._createBindGroup(t,s,r)}_createBindGroup(t,s,r){const o=this._gpu.device,a=s.layout[r],h=[],u=this._renderer;for(const g in a){const _=t.resources[g]??t.resources[a[g]];let $;if(_._resourceType==="uniformGroup"){const E=_;u.ubo.updateUniformGroup(E);const v=E.buffer;$={buffer:u.buffer.getGPUBuffer(v),offset:0,size:v.descriptor.size}}else if(_._resourceType==="buffer"){const E=_;$={buffer:u.buffer.getGPUBuffer(E),offset:0,size:E.descriptor.size}}else if(_._resourceType==="bufferResource"){const E=_;$={buffer:u.buffer.getGPUBuffer(E.buffer),offset:E.offset,size:E.size}}else if(_._resourceType==="textureSampler"){const E=_;$=u.texture.getGpuSampler(E)}else if(_._resourceType==="textureSource"){const E=_;$=u.texture.getGpuSource(E).createView({})}h.push({binding:a[g],resource:$})}const p=u.shader.getProgramData(s).bindGroups[r],f=o.createBindGroup({layout:p,entries:h});return this._hash[t._key]=f,f}destroy(){for(const t of Object.keys(this._hash))this._hash[t]=null;this._hash=null,this._renderer=null}}YI.extension={type:[V.WebGPUSystem],name:"bindGroup"};class KI{constructor(t){this._gpuBuffers=Object.create(null),this._managedBuffers=[],t.renderableGC.addManagedHash(this,"_gpuBuffers")}contextChange(t){this._gpu=t}getGPUBuffer(t){return this._gpuBuffers[t.uid]||this.createGPUBuffer(t)}updateBuffer(t){const s=this._gpuBuffers[t.uid]||this.createGPUBuffer(t),r=t.data;return t._updateID&&r&&(t._updateID=0,this._gpu.device.queue.writeBuffer(s,0,r.buffer,0,(t._updateSize||r.byteLength)+3&-4)),s}destroyAll(){for(const t in this._gpuBuffers)this._gpuBuffers[t].destroy();this._gpuBuffers={}}createGPUBuffer(t){this._gpuBuffers[t.uid]||(t.on("update",this.updateBuffer,this),t.on("change",this.onBufferChange,this),t.on("destroy",this.onBufferDestroy,this),this._managedBuffers.push(t));const s=this._gpu.device.createBuffer(t.descriptor);return t._updateID=0,t.data&&(tg(t.data.buffer,s.getMappedRange()),s.unmap()),this._gpuBuffers[t.uid]=s,s}onBufferChange(t){this._gpuBuffers[t.uid].destroy(),t._updateID=0,this._gpuBuffers[t.uid]=this.createGPUBuffer(t)}onBufferDestroy(t){this._managedBuffers.splice(this._managedBuffers.indexOf(t),1),this._destroyBuffer(t)}destroy(){this._managedBuffers.forEach(t=>this._destroyBuffer(t)),this._managedBuffers=null,this._gpuBuffers=null}_destroyBuffer(t){this._gpuBuffers[t.uid].destroy(),t.off("update",this.updateBuffer,this),t.off("change",this.onBufferChange,this),t.off("destroy",this.onBufferDestroy,this),this._gpuBuffers[t.uid]=null}}KI.extension={type:[V.WebGPUSystem],name:"buffer"};class RF{constructor({minUniformOffsetAlignment:t}){this._minUniformOffsetAlignment=256,this.byteIndex=0,this._minUniformOffsetAlignment=t,this.data=new Float32Array(65535)}clear(){this.byteIndex=0}addEmptyGroup(t){if(t>this._minUniformOffsetAlignment/4)throw new Error(`UniformBufferBatch: array is too large: ${t*4}`);const s=this.byteIndex;let r=s+t*4;if(r=Math.ceil(r/this._minUniformOffsetAlignment)*this._minUniformOffsetAlignment,r>this.data.length*4)throw new Error("UniformBufferBatch: ubo batch got too big");return this.byteIndex=r,s}addGroup(t){const s=this.addEmptyGroup(t.length);for(let r=0;r<t.length;r++)this.data[s/4+r]=t[r];return s}destroy(){this.data=null}}class jI{constructor(t){this._colorMaskCache=15,this._renderer=t}setMask(t){this._colorMaskCache!==t&&(this._colorMaskCache=t,this._renderer.pipeline.setColorMask(t))}destroy(){this._renderer=null,this._colorMaskCache=null}}jI.extension={type:[V.WebGPUSystem],name:"colorMask"};class sm{constructor(t){this._renderer=t}async init(t){return this._initPromise?this._initPromise:(this._initPromise=this._createDeviceAndAdaptor(t).then(s=>{this.gpu=s,this._renderer.runners.contextChange.emit(this.gpu)}),this._initPromise)}contextChange(t){this._renderer.gpu=t}async _createDeviceAndAdaptor(t){const s=await it.get().getNavigator().gpu.requestAdapter({powerPreference:t.powerPreference,forceFallbackAdapter:t.forceFallbackAdapter}),r=["texture-compression-bc","texture-compression-astc","texture-compression-etc2"].filter(a=>s.features.has(a)),o=await s.requestDevice({requiredFeatures:r});return{adapter:s,device:o}}destroy(){this.gpu=null,this._renderer=null}}sm.extension={type:[V.WebGPUSystem],name:"device"};sm.defaultOptions={powerPreference:void 0,forceFallbackAdapter:!1};class qI{constructor(t){this._boundBindGroup=Object.create(null),this._boundVertexBuffer=Object.create(null),this._renderer=t}renderStart(){this.commandFinished=new Promise(t=>{this._resolveCommandFinished=t}),this.commandEncoder=this._renderer.gpu.device.createCommandEncoder()}beginRenderPass(t){this.endRenderPass(),this._clearCache(),this.renderPassEncoder=this.commandEncoder.beginRenderPass(t.descriptor)}endRenderPass(){this.renderPassEncoder&&this.renderPassEncoder.end(),this.renderPassEncoder=null}setViewport(t){this.renderPassEncoder.setViewport(t.x,t.y,t.width,t.height,0,1)}setPipelineFromGeometryProgramAndState(t,s,r,o){const a=this._renderer.pipeline.getPipeline(t,s,r,o);this.setPipeline(a)}setPipeline(t){this._boundPipeline!==t&&(this._boundPipeline=t,this.renderPassEncoder.setPipeline(t))}_setVertexBuffer(t,s){this._boundVertexBuffer[t]!==s&&(this._boundVertexBuffer[t]=s,this.renderPassEncoder.setVertexBuffer(t,this._renderer.buffer.updateBuffer(s)))}_setIndexBuffer(t){if(this._boundIndexBuffer===t)return;this._boundIndexBuffer=t;const s=t.data.BYTES_PER_ELEMENT===2?"uint16":"uint32";this.renderPassEncoder.setIndexBuffer(this._renderer.buffer.updateBuffer(t),s)}resetBindGroup(t){this._boundBindGroup[t]=null}setBindGroup(t,s,r){if(this._boundBindGroup[t]===s)return;this._boundBindGroup[t]=s,s._touch(this._renderer.textureGC.count);const o=this._renderer.bindGroup.getBindGroup(s,r,t);this.renderPassEncoder.setBindGroup(t,o)}setGeometry(t,s){const r=this._renderer.pipeline.getBufferNamesToBind(t,s);for(const o in r)this._setVertexBuffer(o,t.attributes[r[o]].buffer);t.indexBuffer&&this._setIndexBuffer(t.indexBuffer)}_setShaderBindGroups(t,s){for(const r in t.groups){const o=t.groups[r];s||this._syncBindGroup(o),this.setBindGroup(r,o,t.gpuProgram)}}_syncBindGroup(t){for(const s in t.resources){const r=t.resources[s];r.isUniformGroup&&this._renderer.ubo.updateUniformGroup(r)}}draw(t){const{geometry:s,shader:r,state:o,topology:a,size:h,start:u,instanceCount:p,skipSync:f}=t;this.setPipelineFromGeometryProgramAndState(s,r.gpuProgram,o,a),this.setGeometry(s,r.gpuProgram),this._setShaderBindGroups(r,f),s.indexBuffer?this.renderPassEncoder.drawIndexed(h||s.indexBuffer.data.length,p??s.instanceCount,u||0):this.renderPassEncoder.draw(h||s.getSize(),p??s.instanceCount,u||0)}finishRenderPass(){this.renderPassEncoder&&(this.renderPassEncoder.end(),this.renderPassEncoder=null)}postrender(){this.finishRenderPass(),this._gpu.device.queue.submit([this.commandEncoder.finish()]),this._resolveCommandFinished(),this.commandEncoder=null}restoreRenderPass(){const t=this._renderer.renderTarget.adaptor.getDescriptor(this._renderer.renderTarget.renderTarget,!1,[0,0,0,1]);this.renderPassEncoder=this.commandEncoder.beginRenderPass(t);const s=this._boundPipeline,r={...this._boundVertexBuffer},o=this._boundIndexBuffer,a={...this._boundBindGroup};this._clearCache();const h=this._renderer.renderTarget.viewport;this.renderPassEncoder.setViewport(h.x,h.y,h.width,h.height,0,1),this.setPipeline(s);for(const u in r)this._setVertexBuffer(u,r[u]);for(const u in a)this.setBindGroup(u,a[u],null);this._setIndexBuffer(o)}_clearCache(){for(let t=0;t<16;t++)this._boundBindGroup[t]=null,this._boundVertexBuffer[t]=null;this._boundIndexBuffer=null,this._boundPipeline=null}destroy(){this._renderer=null,this._gpu=null,this._boundBindGroup=null,this._boundVertexBuffer=null,this._boundIndexBuffer=null,this._boundPipeline=null}contextChange(t){this._gpu=t}}qI.extension={type:[V.WebGPUSystem],name:"encoder",priority:1};class JI{constructor(t){this._renderer=t}contextChange(){this.maxTextures=this._renderer.device.gpu.device.limits.maxSampledTexturesPerShaderStage,this.maxBatchableTextures=this.maxTextures}destroy(){}}JI.extension={type:[V.WebGPUSystem],name:"limits"};class ZI{constructor(t){this._renderTargetStencilState=Object.create(null),this._renderer=t,t.renderTarget.onRenderTargetChange.add(this)}onRenderTargetChange(t){let s=this._renderTargetStencilState[t.uid];s||(s=this._renderTargetStencilState[t.uid]={stencilMode:ft.DISABLED,stencilReference:0}),this._activeRenderTarget=t,this.setStencilMode(s.stencilMode,s.stencilReference)}setStencilMode(t,s){const r=this._renderTargetStencilState[this._activeRenderTarget.uid];r.stencilMode=t,r.stencilReference=s;const o=this._renderer;o.pipeline.setStencilMode(t),o.encoder.renderPassEncoder.setStencilReference(s)}destroy(){this._renderer.renderTarget.onRenderTargetChange.remove(this),this._renderer=null,this._activeRenderTarget=null,this._renderTargetStencilState=null}}ZI.extension={type:[V.WebGPUSystem],name:"stencil"};const Jc={i32:{align:4,size:4},u32:{align:4,size:4},f32:{align:4,size:4},f16:{align:2,size:2},"vec2<i32>":{align:8,size:8},"vec2<u32>":{align:8,size:8},"vec2<f32>":{align:8,size:8},"vec2<f16>":{align:4,size:4},"vec3<i32>":{align:16,size:12},"vec3<u32>":{align:16,size:12},"vec3<f32>":{align:16,size:12},"vec3<f16>":{align:8,size:6},"vec4<i32>":{align:16,size:16},"vec4<u32>":{align:16,size:16},"vec4<f32>":{align:16,size:16},"vec4<f16>":{align:8,size:8},"mat2x2<f32>":{align:8,size:16},"mat2x2<f16>":{align:4,size:8},"mat3x2<f32>":{align:8,size:24},"mat3x2<f16>":{align:4,size:12},"mat4x2<f32>":{align:8,size:32},"mat4x2<f16>":{align:4,size:16},"mat2x3<f32>":{align:16,size:32},"mat2x3<f16>":{align:8,size:16},"mat3x3<f32>":{align:16,size:48},"mat3x3<f16>":{align:8,size:24},"mat4x3<f32>":{align:16,size:64},"mat4x3<f16>":{align:8,size:32},"mat2x4<f32>":{align:16,size:32},"mat2x4<f16>":{align:8,size:16},"mat3x4<f32>":{align:16,size:48},"mat3x4<f16>":{align:8,size:24},"mat4x4<f32>":{align:16,size:64},"mat4x4<f16>":{align:8,size:32}};function kF(l){const t=l.map(r=>({data:r,offset:0,size:0}));let s=0;for(let r=0;r<t.length;r++){const o=t[r];let a=Jc[o.data.type].size;const h=Jc[o.data.type].align;if(!Jc[o.data.type])throw new Error(`[Pixi.js] WebGPU UniformBuffer: Unknown type ${o.data.type}`);o.data.size>1&&(a=Math.max(a,h)*o.data.size),s=Math.ceil(s/h)*h,o.size=a,o.offset=s,s+=a}return s=Math.ceil(s/16)*16,{uboElements:t,size:s}}function OF(l,t){const{size:s,align:r}=Jc[l.data.type],o=(r-s)/4,a=l.data.type.indexOf("i32")>=0?"dataInt32":"data";return`
         v = uv.${l.data.name};
         ${t!==0?`offset += ${t};`:""}

         arrayOffset = offset;

         t = 0;

         for(var i=0; i < ${l.data.size*(s/4)}; i++)
         {
             for(var j = 0; j < ${s/4}; j++)
             {
                 ${a}[arrayOffset++] = v[t++];
             }
             ${o!==0?`arrayOffset += ${o};`:""}
         }
     `}function AF(l){return hI(l,"uboWgsl",OF,v1)}class QI extends aI{constructor(){super({createUboElements:kF,generateUboSync:AF})}}QI.extension={type:[V.WebGPUSystem],name:"ubo"};const fr=128;class ex{constructor(t){this._bindGroupHash=Object.create(null),this._buffers=[],this._bindGroups=[],this._bufferResources=[],this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_bindGroupHash"),this._batchBuffer=new RF({minUniformOffsetAlignment:fr});const s=256/fr;for(let r=0;r<s;r++){let o=Me.UNIFORM|Me.COPY_DST;r===0&&(o|=Me.COPY_SRC),this._buffers.push(new Ss({data:this._batchBuffer.data,usage:o}))}}renderEnd(){this._uploadBindGroups(),this._resetBindGroups()}_resetBindGroups(){for(const t in this._bindGroupHash)this._bindGroupHash[t]=null;this._batchBuffer.clear()}getUniformBindGroup(t,s){if(!s&&this._bindGroupHash[t.uid])return this._bindGroupHash[t.uid];this._renderer.ubo.ensureUniformGroup(t);const r=t.buffer.data,o=this._batchBuffer.addEmptyGroup(r.length);return this._renderer.ubo.syncUniformGroup(t,this._batchBuffer.data,o/4),this._bindGroupHash[t.uid]=this._getBindGroup(o/fr),this._bindGroupHash[t.uid]}getUboResource(t){this._renderer.ubo.updateUniformGroup(t);const s=t.buffer.data,r=this._batchBuffer.addGroup(s);return this._getBufferResource(r/fr)}getArrayBindGroup(t){const s=this._batchBuffer.addGroup(t);return this._getBindGroup(s/fr)}getArrayBufferResource(t){const r=this._batchBuffer.addGroup(t)/fr;return this._getBufferResource(r)}_getBufferResource(t){if(!this._bufferResources[t]){const s=this._buffers[t%2];this._bufferResources[t]=new Kg({buffer:s,offset:(t/2|0)*256,size:fr})}return this._bufferResources[t]}_getBindGroup(t){if(!this._bindGroups[t]){const s=new Ki({0:this._getBufferResource(t)});this._bindGroups[t]=s}return this._bindGroups[t]}_uploadBindGroups(){const t=this._renderer.buffer,s=this._buffers[0];s.update(this._batchBuffer.byteIndex),t.updateBuffer(s);const r=this._renderer.gpu.device.createCommandEncoder();for(let o=1;o<this._buffers.length;o++){const a=this._buffers[o];r.copyBufferToBuffer(t.getGPUBuffer(s),fr,t.getGPUBuffer(a),0,this._batchBuffer.byteIndex)}this._renderer.gpu.device.queue.submit([r.finish()])}destroy(){for(let t=0;t<this._bindGroups.length;t++)this._bindGroups[t].destroy();this._bindGroups=null,this._bindGroupHash=null;for(let t=0;t<this._buffers.length;t++)this._buffers[t].destroy();this._buffers=null;for(let t=0;t<this._bufferResources.length;t++)this._bufferResources[t].destroy();this._bufferResources=null,this._batchBuffer.destroy(),this._bindGroupHash=null,this._renderer=null}}ex.extension={type:[V.WebGPUPipes],name:"uniformBatch"};const MF={"point-list":0,"line-list":1,"line-strip":2,"triangle-list":3,"triangle-strip":4};function LF(l,t,s,r,o){return l<<24|t<<16|s<<10|r<<5|o}function PF(l,t,s,r){return s<<6|l<<3|r<<1|t}class tx{constructor(t){this._moduleCache=Object.create(null),this._bufferLayoutsCache=Object.create(null),this._bindingNamesCache=Object.create(null),this._pipeCache=Object.create(null),this._pipeStateCaches=Object.create(null),this._colorMask=15,this._multisampleCount=1,this._renderer=t}contextChange(t){this._gpu=t,this.setStencilMode(ft.DISABLED),this._updatePipeHash()}setMultisampleCount(t){this._multisampleCount!==t&&(this._multisampleCount=t,this._updatePipeHash())}setRenderTarget(t){this._multisampleCount=t.msaaSamples,this._depthStencilAttachment=t.descriptor.depthStencilAttachment?1:0,this._updatePipeHash()}setColorMask(t){this._colorMask!==t&&(this._colorMask=t,this._updatePipeHash())}setStencilMode(t){this._stencilMode!==t&&(this._stencilMode=t,this._stencilState=Er[t],this._updatePipeHash())}setPipeline(t,s,r,o){const a=this.getPipeline(t,s,r);o.setPipeline(a)}getPipeline(t,s,r,o){t._layoutKey||(eI(t,s.attributeData),this._generateBufferKey(t)),o||(o=t.topology);const a=LF(t._layoutKey,s._layoutKey,r.data,r._blendModeId,MF[o]);return this._pipeCache[a]?this._pipeCache[a]:(this._pipeCache[a]=this._createPipeline(t,s,r,o),this._pipeCache[a])}_createPipeline(t,s,r,o){const a=this._gpu.device,h=this._createVertexBufferLayouts(t,s),u=this._renderer.state.getColorTargets(r);u[0].writeMask=this._stencilMode===ft.RENDERING_MASK_ADD?0:this._colorMask;const p=this._renderer.shader.getProgramData(s).pipeline,f={vertex:{module:this._getModule(s.vertex.source),entryPoint:s.vertex.entryPoint,buffers:h},fragment:{module:this._getModule(s.fragment.source),entryPoint:s.fragment.entryPoint,targets:u},primitive:{topology:o,cullMode:r.cullMode},layout:p,multisample:{count:this._multisampleCount},label:"PIXI Pipeline"};return this._depthStencilAttachment&&(f.depthStencil={...this._stencilState,format:"depth24plus-stencil8",depthWriteEnabled:r.depthTest,depthCompare:r.depthTest?"less":"always"}),a.createRenderPipeline(f)}_getModule(t){return this._moduleCache[t]||this._createModule(t)}_createModule(t){const s=this._gpu.device;return this._moduleCache[t]=s.createShaderModule({code:t}),this._moduleCache[t]}_generateBufferKey(t){const s=[];let r=0;const o=Object.keys(t.attributes).sort();for(let h=0;h<o.length;h++){const u=t.attributes[o[h]];s[r++]=u.offset,s[r++]=u.format,s[r++]=u.stride,s[r++]=u.instance}const a=s.join("|");return t._layoutKey=Al(a,"geometry"),t._layoutKey}_generateAttributeLocationsKey(t){const s=[];let r=0;const o=Object.keys(t.attributeData).sort();for(let h=0;h<o.length;h++){const u=t.attributeData[o[h]];s[r++]=u.location}const a=s.join("|");return t._attributeLocationsKey=Al(a,"programAttributes"),t._attributeLocationsKey}getBufferNamesToBind(t,s){const r=t._layoutKey<<16|s._attributeLocationsKey;if(this._bindingNamesCache[r])return this._bindingNamesCache[r];const o=this._createVertexBufferLayouts(t,s),a=Object.create(null),h=s.attributeData;for(let u=0;u<o.length;u++){const f=Object.values(o[u].attributes)[0].shaderLocation;for(const g in h)if(h[g].location===f){a[u]=g;break}}return this._bindingNamesCache[r]=a,a}_createVertexBufferLayouts(t,s){s._attributeLocationsKey||this._generateAttributeLocationsKey(s);const r=t._layoutKey<<16|s._attributeLocationsKey;if(this._bufferLayoutsCache[r])return this._bufferLayoutsCache[r];const o=[];return t.buffers.forEach(a=>{const h={arrayStride:0,stepMode:"vertex",attributes:[]},u=h.attributes;for(const p in s.attributeData){const f=t.attributes[p];(f.divisor??1)!==1&&we(`Attribute ${p} has an invalid divisor value of '${f.divisor}'. WebGPU only supports a divisor value of 1`),f.buffer===a&&(h.arrayStride=f.stride,h.stepMode=f.instance?"instance":"vertex",u.push({shaderLocation:s.attributeData[p].location,offset:f.offset,format:f.format}))}u.length&&o.push(h)}),this._bufferLayoutsCache[r]=o,o}_updatePipeHash(){const t=PF(this._stencilMode,this._multisampleCount,this._colorMask,this._depthStencilAttachment);this._pipeStateCaches[t]||(this._pipeStateCaches[t]=Object.create(null)),this._pipeCache=this._pipeStateCaches[t]}destroy(){this._renderer=null,this._bufferLayoutsCache=null}}tx.extension={type:[V.WebGPUSystem],name:"pipeline"};class NF{constructor(){this.contexts=[],this.msaaTextures=[],this.msaaSamples=1}}class DF{init(t,s){this._renderer=t,this._renderTargetSystem=s}copyToTexture(t,s,r,o,a){const h=this._renderer,u=this._getGpuColorTexture(t),p=h.texture.getGpuSource(s.source);return h.encoder.commandEncoder.copyTextureToTexture({texture:u,origin:r},{texture:p,origin:a},o),s}startRenderPass(t,s=!0,r,o){const h=this._renderTargetSystem.getGpuRenderTarget(t),u=this.getDescriptor(t,s,r);h.descriptor=u,this._renderer.pipeline.setRenderTarget(h),this._renderer.encoder.beginRenderPass(h),this._renderer.encoder.setViewport(o)}finishRenderPass(){this._renderer.encoder.endRenderPass()}_getGpuColorTexture(t){const s=this._renderTargetSystem.getGpuRenderTarget(t);return s.contexts[0]?s.contexts[0].getCurrentTexture():this._renderer.texture.getGpuSource(t.colorTextures[0].source)}getDescriptor(t,s,r){typeof s=="boolean"&&(s=s?vs.ALL:vs.NONE);const o=this._renderTargetSystem,a=o.getGpuRenderTarget(t),h=t.colorTextures.map((f,g)=>{const _=a.contexts[g];let $,E;_?$=_.getCurrentTexture().createView():$=this._renderer.texture.getGpuSource(f).createView({mipLevelCount:1}),a.msaaTextures[g]&&(E=$,$=this._renderer.texture.getTextureView(a.msaaTextures[g]));const v=s&vs.COLOR?"clear":"load";return r??(r=o.defaultClearColor),{view:$,resolveTarget:E,clearValue:r,storeOp:"store",loadOp:v}});let u;if((t.stencil||t.depth)&&!t.depthStencilTexture&&(t.ensureDepthStencilTexture(),t.depthStencilTexture.source.sampleCount=a.msaa?4:1),t.depthStencilTexture){const f=s&vs.STENCIL?"clear":"load",g=s&vs.DEPTH?"clear":"load";u={view:this._renderer.texture.getGpuSource(t.depthStencilTexture.source).createView(),stencilStoreOp:"store",stencilLoadOp:f,depthClearValue:1,depthLoadOp:g,depthStoreOp:"store"}}return{colorAttachments:h,depthStencilAttachment:u}}clear(t,s=!0,r,o){if(!s)return;const{gpu:a,encoder:h}=this._renderer,u=a.device;if(h.commandEncoder===null){const f=u.createCommandEncoder(),g=this.getDescriptor(t,s,r),_=f.beginRenderPass(g);_.setViewport(o.x,o.y,o.width,o.height,0,1),_.end();const $=f.finish();u.queue.submit([$])}else this.startRenderPass(t,s,r,o)}initGpuRenderTarget(t){t.isRoot=!0;const s=new NF;return t.colorTextures.forEach((r,o)=>{if(r instanceof Yi){const a=r.resource.getContext("webgpu"),h=r.transparent?"premultiplied":"opaque";try{a.configure({device:this._renderer.gpu.device,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,format:"bgra8unorm",alphaMode:h})}catch(u){console.error(u)}s.contexts[o]=a}if(s.msaa=r.source.antialias,r.source.antialias){const a=new vt({width:0,height:0,sampleCount:4});s.msaaTextures[o]=a}}),s.msaa&&(s.msaaSamples=4,t.depthStencilTexture&&(t.depthStencilTexture.source.sampleCount=4)),s}destroyGpuRenderTarget(t){t.contexts.forEach(s=>{s.unconfigure()}),t.msaaTextures.forEach(s=>{s.destroy()}),t.msaaTextures.length=0,t.contexts.length=0}ensureDepthStencilTexture(t){const s=this._renderTargetSystem.getGpuRenderTarget(t);t.depthStencilTexture&&s.msaa&&(t.depthStencilTexture.source.sampleCount=4)}resizeGpuRenderTarget(t){const s=this._renderTargetSystem.getGpuRenderTarget(t);s.width=t.width,s.height=t.height,s.msaa&&t.colorTextures.forEach((r,o)=>{const a=s.msaaTextures[o];a==null||a.resize(r.source.width,r.source.height,r.source._resolution)})}}class sx extends mI{constructor(t){super(t),this.adaptor=new DF,this.adaptor.init(t,this)}}sx.extension={type:[V.WebGPUSystem],name:"renderTarget"};class ix{constructor(){this._gpuProgramData=Object.create(null)}contextChange(t){this._gpu=t}getProgramData(t){return this._gpuProgramData[t._layoutKey]||this._createGPUProgramData(t)}_createGPUProgramData(t){const s=this._gpu.device,r=t.gpuLayout.map(a=>s.createBindGroupLayout({entries:a})),o={bindGroupLayouts:r};return this._gpuProgramData[t._layoutKey]={bindGroups:r,pipeline:s.createPipelineLayout(o)},this._gpuProgramData[t._layoutKey]}destroy(){this._gpu=null,this._gpuProgramData=null}}ix.extension={type:[V.WebGPUSystem],name:"shader"};const ds={};ds.normal={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"}};ds.add={alpha:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one",operation:"add"}};ds.multiply={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"dst",dstFactor:"one-minus-src-alpha",operation:"add"}};ds.screen={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};ds.overlay={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"one",dstFactor:"one-minus-src",operation:"add"}};ds.none={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"zero",operation:"add"}};ds["normal-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src-alpha",operation:"add"}};ds["add-npm"]={alpha:{srcFactor:"one",dstFactor:"one",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one",operation:"add"}};ds["screen-npm"]={alpha:{srcFactor:"one",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"src-alpha",dstFactor:"one-minus-src",operation:"add"}};ds.erase={alpha:{srcFactor:"zero",dstFactor:"one-minus-src-alpha",operation:"add"},color:{srcFactor:"zero",dstFactor:"one-minus-src",operation:"add"}};ds.min={alpha:{srcFactor:"one",dstFactor:"one",operation:"min"},color:{srcFactor:"one",dstFactor:"one",operation:"min"}};ds.max={alpha:{srcFactor:"one",dstFactor:"one",operation:"max"},color:{srcFactor:"one",dstFactor:"one",operation:"max"}};class rx{constructor(){this.defaultState=new ti,this.defaultState.blend=!0}contextChange(t){this.gpu=t}getColorTargets(t){return[{format:"bgra8unorm",writeMask:0,blend:ds[t.blendMode]||ds.normal}]}destroy(){this.gpu=null}}rx.extension={type:[V.WebGPUSystem],name:"state"};const BF={type:"image",upload(l,t,s){const r=l.resource,o=(l.pixelWidth|0)*(l.pixelHeight|0),a=r.byteLength/o;s.device.queue.writeTexture({texture:t},r,{offset:0,rowsPerImage:l.pixelHeight,bytesPerRow:l.pixelHeight*a},{width:l.pixelWidth,height:l.pixelHeight,depthOrArrayLayers:1})}},nx={"bc1-rgba-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"bc2-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc3-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"bc7-rgba-unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"etc1-rgb-unorm":{blockBytes:8,blockWidth:4,blockHeight:4},"etc2-rgba8unorm":{blockBytes:16,blockWidth:4,blockHeight:4},"astc-4x4-unorm":{blockBytes:16,blockWidth:4,blockHeight:4}},FF={blockBytes:4,blockWidth:1,blockHeight:1},UF={type:"compressed",upload(l,t,s){let r=l.pixelWidth,o=l.pixelHeight;const a=nx[l.format]||FF;for(let h=0;h<l.resource.length;h++){const u=l.resource[h],p=Math.ceil(r/a.blockWidth)*a.blockBytes;s.device.queue.writeTexture({texture:t,mipLevel:h},u,{offset:0,bytesPerRow:p},{width:Math.ceil(r/a.blockWidth)*a.blockWidth,height:Math.ceil(o/a.blockHeight)*a.blockHeight,depthOrArrayLayers:1}),r=Math.max(r>>1,1),o=Math.max(o>>1,1)}}},ox={type:"image",upload(l,t,s){const r=l.resource;if(!r)return;if(globalThis.HTMLImageElement&&r instanceof HTMLImageElement){const u=it.get().createCanvas(r.width,r.height);u.getContext("2d").drawImage(r,0,0,r.width,r.height),l.resource=u,we("ImageSource: Image element passed, converting to canvas and replacing resource.")}const o=Math.min(t.width,l.resourceWidth||l.pixelWidth),a=Math.min(t.height,l.resourceHeight||l.pixelHeight),h=l.alphaMode==="premultiply-alpha-on-upload";s.device.queue.copyExternalImageToTexture({source:r},{texture:t,premultipliedAlpha:h},{width:o,height:a})}},GF={type:"video",upload(l,t,s){ox.upload(l,t,s)}};class HF{constructor(t){this.device=t,this.sampler=t.createSampler({minFilter:"linear"}),this.pipelines={}}_getMipmapPipeline(t){let s=this.pipelines[t];return s||(this.mipmapShaderModule||(this.mipmapShaderModule=this.device.createShaderModule({code:`
                        var<private> pos : array<vec2<f32>, 3> = array<vec2<f32>, 3>(
                        vec2<f32>(-1.0, -1.0), vec2<f32>(-1.0, 3.0), vec2<f32>(3.0, -1.0));

                        struct VertexOutput {
                        @builtin(position) position : vec4<f32>,
                        @location(0) texCoord : vec2<f32>,
                        };

                        @vertex
                        fn vertexMain(@builtin(vertex_index) vertexIndex : u32) -> VertexOutput {
                        var output : VertexOutput;
                        output.texCoord = pos[vertexIndex] * vec2<f32>(0.5, -0.5) + vec2<f32>(0.5);
                        output.position = vec4<f32>(pos[vertexIndex], 0.0, 1.0);
                        return output;
                        }

                        @group(0) @binding(0) var imgSampler : sampler;
                        @group(0) @binding(1) var img : texture_2d<f32>;

                        @fragment
                        fn fragmentMain(@location(0) texCoord : vec2<f32>) -> @location(0) vec4<f32> {
                        return textureSample(img, imgSampler, texCoord);
                        }
                    `})),s=this.device.createRenderPipeline({layout:"auto",vertex:{module:this.mipmapShaderModule,entryPoint:"vertexMain"},fragment:{module:this.mipmapShaderModule,entryPoint:"fragmentMain",targets:[{format:t}]}}),this.pipelines[t]=s),s}generateMipmap(t){const s=this._getMipmapPipeline(t.format);if(t.dimension==="3d"||t.dimension==="1d")throw new Error("Generating mipmaps for non-2d textures is currently unsupported!");let r=t;const o=t.depthOrArrayLayers||1,a=t.usage&GPUTextureUsage.RENDER_ATTACHMENT;if(!a){const p={size:{width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:o},format:t.format,usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_SRC|GPUTextureUsage.RENDER_ATTACHMENT,mipLevelCount:t.mipLevelCount-1};r=this.device.createTexture(p)}const h=this.device.createCommandEncoder({}),u=s.getBindGroupLayout(0);for(let p=0;p<o;++p){let f=t.createView({baseMipLevel:0,mipLevelCount:1,dimension:"2d",baseArrayLayer:p,arrayLayerCount:1}),g=a?1:0;for(let _=1;_<t.mipLevelCount;++_){const $=r.createView({baseMipLevel:g++,mipLevelCount:1,dimension:"2d",baseArrayLayer:p,arrayLayerCount:1}),E=h.beginRenderPass({colorAttachments:[{view:$,storeOp:"store",loadOp:"clear",clearValue:{r:0,g:0,b:0,a:0}}]}),v=this.device.createBindGroup({layout:u,entries:[{binding:0,resource:this.sampler},{binding:1,resource:f}]});E.setPipeline(s),E.setBindGroup(0,v),E.draw(3,1,0,0),E.end(),f=$}}if(!a){const p={width:Math.ceil(t.width/2),height:Math.ceil(t.height/2),depthOrArrayLayers:o};for(let f=1;f<t.mipLevelCount;++f)h.copyTextureToTexture({texture:r,mipLevel:f-1},{texture:t,mipLevel:f},p),p.width=Math.ceil(p.width/2),p.height=Math.ceil(p.height/2)}return this.device.queue.submit([h.finish()]),a||r.destroy(),t}}class lx{constructor(t){this.managedTextures=[],this._gpuSources=Object.create(null),this._gpuSamplers=Object.create(null),this._bindGroupHash=Object.create(null),this._textureViewHash=Object.create(null),this._uploads={image:ox,buffer:BF,video:GF,compressed:UF},this._renderer=t,t.renderableGC.addManagedHash(this,"_gpuSources"),t.renderableGC.addManagedHash(this,"_gpuSamplers"),t.renderableGC.addManagedHash(this,"_bindGroupHash"),t.renderableGC.addManagedHash(this,"_textureViewHash")}contextChange(t){this._gpu=t}initSource(t){if(t.autoGenerateMipmaps){const p=Math.max(t.pixelWidth,t.pixelHeight);t.mipLevelCount=Math.floor(Math.log2(p))+1}let s=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST;t.uploadMethodId!=="compressed"&&(s|=GPUTextureUsage.RENDER_ATTACHMENT,s|=GPUTextureUsage.COPY_SRC);const r=nx[t.format]||{blockWidth:1,blockHeight:1},o=Math.ceil(t.pixelWidth/r.blockWidth)*r.blockWidth,a=Math.ceil(t.pixelHeight/r.blockHeight)*r.blockHeight,h={label:t.label,size:{width:o,height:a},format:t.format,sampleCount:t.sampleCount,mipLevelCount:t.mipLevelCount,dimension:t.dimension,usage:s},u=this._gpu.device.createTexture(h);return this._gpuSources[t.uid]=u,this.managedTextures.includes(t)||(t.on("update",this.onSourceUpdate,this),t.on("resize",this.onSourceResize,this),t.on("destroy",this.onSourceDestroy,this),t.on("unload",this.onSourceUnload,this),t.on("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.push(t)),this.onSourceUpdate(t),u}onSourceUpdate(t){const s=this.getGpuSource(t);s&&(this._uploads[t.uploadMethodId]&&this._uploads[t.uploadMethodId].upload(t,s,this._gpu),t.autoGenerateMipmaps&&t.mipLevelCount>1&&this.onUpdateMipmaps(t))}onSourceUnload(t){const s=this._gpuSources[t.uid];s&&(this._gpuSources[t.uid]=null,s.destroy())}onUpdateMipmaps(t){this._mipmapGenerator||(this._mipmapGenerator=new HF(this._gpu.device));const s=this.getGpuSource(t);this._mipmapGenerator.generateMipmap(s)}onSourceDestroy(t){t.off("update",this.onSourceUpdate,this),t.off("unload",this.onSourceUnload,this),t.off("destroy",this.onSourceDestroy,this),t.off("resize",this.onSourceResize,this),t.off("updateMipmaps",this.onUpdateMipmaps,this),this.managedTextures.splice(this.managedTextures.indexOf(t),1),this.onSourceUnload(t)}onSourceResize(t){const s=this._gpuSources[t.uid];s?(s.width!==t.pixelWidth||s.height!==t.pixelHeight)&&(this._textureViewHash[t.uid]=null,this._bindGroupHash[t.uid]=null,this.onSourceUnload(t),this.initSource(t)):this.initSource(t)}_initSampler(t){return this._gpuSamplers[t._resourceId]=this._gpu.device.createSampler(t),this._gpuSamplers[t._resourceId]}getGpuSampler(t){return this._gpuSamplers[t._resourceId]||this._initSampler(t)}getGpuSource(t){return this._gpuSources[t.uid]||this.initSource(t)}getTextureBindGroup(t){return this._bindGroupHash[t.uid]??this._createTextureBindGroup(t)}_createTextureBindGroup(t){const s=t.source;return this._bindGroupHash[t.uid]=new Ki({0:s,1:s.style,2:new ns({uTextureMatrix:{type:"mat3x3<f32>",value:t.textureMatrix.mapCoord}})}),this._bindGroupHash[t.uid]}getTextureView(t){const s=t.source;return this._textureViewHash[s.uid]??this._createTextureView(s)}_createTextureView(t){return this._textureViewHash[t.uid]=this.getGpuSource(t).createView(),this._textureViewHash[t.uid]}generateCanvas(t){const s=this._renderer,r=s.gpu.device.createCommandEncoder(),o=it.get().createCanvas();o.width=t.source.pixelWidth,o.height=t.source.pixelHeight;const a=o.getContext("webgpu");return a.configure({device:s.gpu.device,usage:GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC,format:it.get().getNavigator().gpu.getPreferredCanvasFormat(),alphaMode:"premultiplied"}),r.copyTextureToTexture({texture:s.texture.getGpuSource(t.source),origin:{x:0,y:0}},{texture:a.getCurrentTexture()},{width:o.width,height:o.height}),s.gpu.device.queue.submit([r.finish()]),o}getPixels(t){const s=this.generateCanvas(t),r=br.getOptimalCanvasAndContext(s.width,s.height),o=r.context;o.drawImage(s,0,0);const{width:a,height:h}=s,u=o.getImageData(0,0,a,h),p=new Uint8ClampedArray(u.data.buffer);return br.returnCanvasAndContext(r),{pixels:p,width:a,height:h}}destroy(){this.managedTextures.slice().forEach(t=>this.onSourceDestroy(t)),this.managedTextures=null;for(const t of Object.keys(this._bindGroupHash)){const s=Number(t),r=this._bindGroupHash[s];r==null||r.destroy(),this._bindGroupHash[s]=null}this._gpu=null,this._mipmapGenerator=null,this._gpuSources=null,this._bindGroupHash=null,this._textureViewHash=null,this._gpuSamplers=null}}lx.extension={type:[V.WebGPUSystem],name:"texture"};class ax{constructor(){this._maxTextures=0}contextChange(t){const s=new ns({uTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}});this._maxTextures=t.limits.maxBatchableTextures;const r=Gl({name:"graphics",bits:[kg,Ag(this._maxTextures),c1,Vl]});this.shader=new Ds({gpuProgram:r,resources:{localUniforms:s}})}execute(t,s){const r=s.context,o=r.customShader||this.shader,a=t.renderer,h=a.graphicsContext,{batcher:u,instructions:p}=h.getContextRenderData(r),f=a.encoder;f.setGeometry(u.geometry,o.gpuProgram);const g=a.globalUniforms.bindGroup;f.setBindGroup(0,g,o.gpuProgram);const _=a.renderPipes.uniformBatch.getUniformBindGroup(o.resources.localUniforms,!0);f.setBindGroup(2,_,o.gpuProgram);const $=p.instructions;let E=null;for(let v=0;v<p.instructionSize;v++){const w=$[v];if(w.topology!==E&&(E=w.topology,f.setPipelineFromGeometryProgramAndState(u.geometry,o.gpuProgram,t.state,w.topology)),o.groups[1]=w.bindGroup,!w.gpuBindGroup){const x=w.textures;w.bindGroup=Rg(x.textures,x.count,this._maxTextures),w.gpuBindGroup=a.bindGroup.getBindGroup(w.bindGroup,o.gpuProgram,1)}f.setBindGroup(1,w.bindGroup,o.gpuProgram),f.renderPassEncoder.drawIndexed(w.size,1,w.start)}}destroy(){this.shader.destroy(!0),this.shader=null}}ax.extension={type:[V.WebGPUPipesAdaptor],name:"graphics"};class cx{init(){const t=Gl({name:"mesh",bits:[xl,h1,Vl]});this._shader=new Ds({gpuProgram:t,resources:{uTexture:me.EMPTY._source,uSampler:me.EMPTY._source.style,textureUniforms:{uTextureMatrix:{type:"mat3x3<f32>",value:new Te}}}})}execute(t,s){const r=t.renderer;let o=s._shader;if(!o)o=this._shader,o.groups[2]=r.texture.getTextureBindGroup(s.texture);else if(!o.gpuProgram){we("Mesh shader has no gpuProgram",s.shader);return}const a=o.gpuProgram;if(a.autoAssignGlobalUniforms&&(o.groups[0]=r.globalUniforms.bindGroup),a.autoAssignLocalUniforms){const h=t.localUniforms;o.groups[1]=r.renderPipes.uniformBatch.getUniformBindGroup(h,!0)}r.encoder.draw({geometry:s._geometry,shader:o,state:s.state})}destroy(){this._shader.destroy(!0),this._shader=null}}cx.extension={type:[V.WebGPUPipesAdaptor],name:"mesh"};const VF=[...HI,QI,qI,sm,JI,KI,lx,sx,ix,rx,tx,jI,ZI,YI],WF=[...VI,ex],zF=[XS,cx,ax],hx=[],ux=[],dx=[];Se.handleByNamedList(V.WebGPUSystem,hx);Se.handleByNamedList(V.WebGPUPipes,ux);Se.handleByNamedList(V.WebGPUPipesAdaptor,dx);Se.add(...VF,...WF,...zF);class XF extends fh{constructor(){const t={name:"webgpu",type:ei.WEBGPU,systems:hx,renderPipes:ux,renderPipeAdaptors:dx};super(t)}}const YF=Object.freeze(Object.defineProperty({__proto__:null,WebGPURenderer:XF},Symbol.toStringTag,{value:"Module"}));class KF{constructor(){this.batches=[],this.batched=!1}destroy(){this.batches.forEach(t=>{Pt.return(t)}),this.batches.length=0}}class px{constructor(t,s){this.state=ti.for2d(),this.renderer=t,this._adaptor=s,this.renderer.runners.contextChange.add(this)}contextChange(){this._adaptor.contextChange(this.renderer)}validateRenderable(t){const s=t.context,r=!!t._gpuData,o=this.renderer.graphicsContext.updateGpuContext(s);return!!(o.isBatchable||r!==o.isBatchable)}addRenderable(t,s){const r=this.renderer.graphicsContext.updateGpuContext(t.context);t.didViewUpdate&&this._rebuild(t),r.isBatchable?this._addToBatcher(t,s):(this.renderer.renderPipes.batch.break(s),s.add(t))}updateRenderable(t){const r=this._getGpuDataForRenderable(t).batches;for(let o=0;o<r.length;o++){const a=r[o];a._batcher.updateElement(a)}}execute(t){if(!t.isRenderable)return;const s=this.renderer,r=t.context;if(!s.graphicsContext.getGpuContext(r).batches.length)return;const a=r.customShader||this._adaptor.shader;this.state.blendMode=t.groupBlendMode;const h=a.resources.localUniforms.uniforms;h.uTransformMatrix=t.groupTransform,h.uRound=s._roundPixels|t._roundPixels,zl(t.groupColorAlpha,h.uColor,0),this._adaptor.execute(this,t)}_rebuild(t){const s=this._getGpuDataForRenderable(t),r=this.renderer.graphicsContext.updateGpuContext(t.context);s.destroy(),r.isBatchable&&this._updateBatchesForRenderable(t,s)}_addToBatcher(t,s){const r=this.renderer.renderPipes.batch,o=this._getGpuDataForRenderable(t).batches;for(let a=0;a<o.length;a++){const h=o[a];r.addToBatch(h,s)}}_getGpuDataForRenderable(t){return t._gpuData[this.renderer.uid]||this._initGpuDataForRenderable(t)}_initGpuDataForRenderable(t){const s=new KF;return t._gpuData[this.renderer.uid]=s,s}_updateBatchesForRenderable(t,s){const r=t.context,o=this.renderer.graphicsContext.getGpuContext(r),a=this.renderer._roundPixels|t._roundPixels;s.batches=o.batches.map(h=>{const u=Pt.get(Ng);return h.copyTo(u),u.renderable=t,u.roundPixels=a,u})}destroy(){this.renderer=null,this._adaptor.destroy(),this._adaptor=null,this.state=null}}px.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"graphics"};const fx=class gx extends Hg{constructor(...t){super({});let s=t[0]??{};typeof s=="number"&&(ke(He,"PlaneGeometry constructor changed please use { width, height, verticesX, verticesY } instead"),s={width:s,height:t[1],verticesX:t[2],verticesY:t[3]}),this.build(s)}build(t){t={...gx.defaultOptions,...t},this.verticesX=this.verticesX??t.verticesX,this.verticesY=this.verticesY??t.verticesY,this.width=this.width??t.width,this.height=this.height??t.height;const s=this.verticesX*this.verticesY,r=[],o=[],a=[],h=this.verticesX-1,u=this.verticesY-1,p=this.width/h,f=this.height/u;for(let _=0;_<s;_++){const $=_%this.verticesX,E=_/this.verticesX|0;r.push($*p,E*f),o.push($/h,E/u)}const g=h*u;for(let _=0;_<g;_++){const $=_%h,E=_/h|0,v=E*this.verticesX+$,w=E*this.verticesX+$+1,x=(E+1)*this.verticesX+$,C=(E+1)*this.verticesX+$+1;a.push(v,w,x,w,C,x)}this.buffers[0].data=new Float32Array(r),this.buffers[1].data=new Float32Array(o),this.indexBuffer.data=new Uint32Array(a),this.buffers[0].update(),this.buffers[1].update(),this.indexBuffer.update()}};fx.defaultOptions={width:100,height:100,verticesX:10,verticesY:10};let jF=fx;class im{constructor(){this.batcherName="default",this.packAsQuad=!1,this.indexOffset=0,this.attributeOffset=0,this.roundPixels=0,this._batcher=null,this._batch=null,this._textureMatrixUpdateId=-1,this._uvUpdateId=-1}get blendMode(){return this.renderable.groupBlendMode}get topology(){return this._topology||this.geometry.topology}set topology(t){this._topology=t}reset(){this.renderable=null,this.texture=null,this._batcher=null,this._batch=null,this.geometry=null,this._uvUpdateId=-1,this._textureMatrixUpdateId=-1}setTexture(t){this.texture!==t&&(this.texture=t,this._textureMatrixUpdateId=-1)}get uvs(){const s=this.geometry.getBuffer("aUV"),r=s.data;let o=r;const a=this.texture.textureMatrix;return a.isSimple||(o=this._transformedUvs,(this._textureMatrixUpdateId!==a._updateID||this._uvUpdateId!==s._updateID)&&((!o||o.length<r.length)&&(o=this._transformedUvs=new Float32Array(r.length)),this._textureMatrixUpdateId=a._updateID,this._uvUpdateId=s._updateID,a.multiplyUvs(r,o))),o}get positions(){return this.geometry.positions}get indices(){return this.geometry.indices}get color(){return this.renderable.groupColorAlpha}get groupTransform(){return this.renderable.groupTransform}get attributeSize(){return this.geometry.positions.length/2}get indexSize(){return this.geometry.indices.length}}class Ky{destroy(){}}class mx{constructor(t,s){this.localUniforms=new ns({uTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),this.localUniformsBindGroup=new Ki({0:this.localUniforms}),this.renderer=t,this._adaptor=s,this._adaptor.init()}validateRenderable(t){const s=this._getMeshData(t),r=s.batched,o=t.batched;if(s.batched=o,r!==o)return!0;if(o){const a=t._geometry;if(a.indices.length!==s.indexSize||a.positions.length!==s.vertexSize)return s.indexSize=a.indices.length,s.vertexSize=a.positions.length,!0;const h=this._getBatchableMesh(t);return h.texture.uid!==t._texture.uid&&(h._textureMatrixUpdateId=-1),!h._batcher.checkAndUpdateTexture(h,t._texture)}return!1}addRenderable(t,s){const r=this.renderer.renderPipes.batch,{batched:o}=this._getMeshData(t);if(o){const a=this._getBatchableMesh(t);a.setTexture(t._texture),a.geometry=t._geometry,r.addToBatch(a,s)}else r.break(s),s.add(t)}updateRenderable(t){if(t.batched){const s=this._getBatchableMesh(t);s.setTexture(t._texture),s.geometry=t._geometry,s._batcher.updateElement(s)}}execute(t){if(!t.isRenderable)return;t.state.blendMode=Nl(t.groupBlendMode,t.texture._source);const s=this.localUniforms;s.uniforms.uTransformMatrix=t.groupTransform,s.uniforms.uRound=this.renderer._roundPixels|t._roundPixels,s.update(),zl(t.groupColorAlpha,s.uniforms.uColor,0),this._adaptor.execute(this,t)}_getMeshData(t){var s,r;return(s=t._gpuData)[r=this.renderer.uid]||(s[r]=new Ky),t._gpuData[this.renderer.uid].meshData||this._initMeshData(t)}_initMeshData(t){var s,r;return t._gpuData[this.renderer.uid].meshData={batched:t.batched,indexSize:(s=t._geometry.indices)==null?void 0:s.length,vertexSize:(r=t._geometry.positions)==null?void 0:r.length},t._gpuData[this.renderer.uid].meshData}_getBatchableMesh(t){var s,r;return(s=t._gpuData)[r=this.renderer.uid]||(s[r]=new Ky),t._gpuData[this.renderer.uid].batchableMesh||this._initBatchableMesh(t)}_initBatchableMesh(t){const s=new im;return s.renderable=t,s.setTexture(t._texture),s.transform=t.groupTransform,s.roundPixels=this.renderer._roundPixels|t._roundPixels,t._gpuData[this.renderer.uid].batchableMesh=s,s}destroy(){this.localUniforms=null,this.localUniformsBindGroup=null,this._adaptor.destroy(),this._adaptor=null,this.renderer=null}}mx.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"mesh"};class qF{execute(t,s){const r=t.state,o=t.renderer,a=s.shader||t.defaultShader;a.resources.uTexture=s.texture._source,a.resources.uniforms=t.localUniforms;const h=o.gl,u=t.getBuffers(s);o.shader.bind(a),o.state.set(r),o.geometry.bind(u.geometry,a.glProgram);const f=u.geometry.indexBuffer.data.BYTES_PER_ELEMENT===2?h.UNSIGNED_SHORT:h.UNSIGNED_INT;h.drawElements(h.TRIANGLES,s.particleChildren.length*6,f,0)}}class JF{execute(t,s){const r=t.renderer,o=s.shader||t.defaultShader;o.groups[0]=r.renderPipes.uniformBatch.getUniformBindGroup(t.localUniforms,!0),o.groups[1]=r.texture.getTextureBindGroup(s.texture);const a=t.state,h=t.getBuffers(s);r.encoder.draw({geometry:h.geometry,shader:s.shader||t.defaultShader,state:a,size:s.particleChildren.length*6})}}function jy(l,t=null){const s=l*6;if(s>65535?t||(t=new Uint32Array(s)):t||(t=new Uint16Array(s)),t.length!==s)throw new Error(`Out buffer length is incorrect, got ${t.length} and expected ${s}`);for(let r=0,o=0;r<s;r+=6,o+=4)t[r+0]=o+0,t[r+1]=o+1,t[r+2]=o+2,t[r+3]=o+0,t[r+4]=o+2,t[r+5]=o+3;return t}function ZF(l){return{dynamicUpdate:qy(l,!0),staticUpdate:qy(l,!1)}}function qy(l,t){const s=[];s.push(`

        var index = 0;

        for (let i = 0; i < ps.length; ++i)
        {
            const p = ps[i];

            `);let r=0;for(const a in l){const h=l[a];if(t!==h.dynamic)continue;s.push(`offset = index + ${r}`),s.push(h.code);const u=$r(h.format);r+=u.stride/4}s.push(`
            index += stride * 4;
        }
    `),s.unshift(`
        var stride = ${r};
    `);const o=s.join(`
`);return new Function("ps","f32v","u32v",o)}class QF{constructor(t){this._size=0,this._generateParticleUpdateCache={};const s=this._size=t.size??1e3,r=t.properties;let o=0,a=0;for(const g in r){const _=r[g],$=$r(_.format);_.dynamic?a+=$.stride:o+=$.stride}this._dynamicStride=a/4,this._staticStride=o/4,this.staticAttributeBuffer=new io(s*4*o),this.dynamicAttributeBuffer=new io(s*4*a),this.indexBuffer=jy(s);const h=new Ul;let u=0,p=0;this._staticBuffer=new Ss({data:new Float32Array(1),label:"static-particle-buffer",shrinkToFit:!1,usage:Me.VERTEX|Me.COPY_DST}),this._dynamicBuffer=new Ss({data:new Float32Array(1),label:"dynamic-particle-buffer",shrinkToFit:!1,usage:Me.VERTEX|Me.COPY_DST});for(const g in r){const _=r[g],$=$r(_.format);_.dynamic?(h.addAttribute(_.attributeName,{buffer:this._dynamicBuffer,stride:this._dynamicStride*4,offset:u*4,format:_.format}),u+=$.size):(h.addAttribute(_.attributeName,{buffer:this._staticBuffer,stride:this._staticStride*4,offset:p*4,format:_.format}),p+=$.size)}h.addIndex(this.indexBuffer);const f=this.getParticleUpdate(r);this._dynamicUpload=f.dynamicUpdate,this._staticUpload=f.staticUpdate,this.geometry=h}getParticleUpdate(t){const s=eU(t);return this._generateParticleUpdateCache[s]?this._generateParticleUpdateCache[s]:(this._generateParticleUpdateCache[s]=this.generateParticleUpdate(t),this._generateParticleUpdateCache[s])}generateParticleUpdate(t){return ZF(t)}update(t,s){t.length>this._size&&(s=!0,this._size=Math.max(t.length,this._size*1.5|0),this.staticAttributeBuffer=new io(this._size*this._staticStride*4*4),this.dynamicAttributeBuffer=new io(this._size*this._dynamicStride*4*4),this.indexBuffer=jy(this._size),this.geometry.indexBuffer.setDataWithSize(this.indexBuffer,this.indexBuffer.byteLength,!0));const r=this.dynamicAttributeBuffer;if(this._dynamicUpload(t,r.float32View,r.uint32View),this._dynamicBuffer.setDataWithSize(this.dynamicAttributeBuffer.float32View,t.length*this._dynamicStride*4,!0),s){const o=this.staticAttributeBuffer;this._staticUpload(t,o.float32View,o.uint32View),this._staticBuffer.setDataWithSize(o.float32View,t.length*this._staticStride*4,!0)}}destroy(){this._staticBuffer.destroy(),this._dynamicBuffer.destroy(),this.geometry.destroy()}}function eU(l){const t=[];for(const s in l){const r=l[s];t.push(s,r.code,r.dynamic?"d":"s")}return t.join("_")}var tU=`varying vec2 vUV;
varying vec4 vColor;

uniform sampler2D uTexture;

void main(void){
    vec4 color = texture2D(uTexture, vUV) * vColor;
    gl_FragColor = color;
}`,sU=`attribute vec2 aVertex;
attribute vec2 aUV;
attribute vec4 aColor;

attribute vec2 aPosition;
attribute float aRotation;

uniform mat3 uTranslationMatrix;
uniform float uRound;
uniform vec2 uResolution;
uniform vec4 uColor;

varying vec2 vUV;
varying vec4 vColor;

vec2 roundPixels(vec2 position, vec2 targetSize)
{       
    return (floor(((position * 0.5 + 0.5) * targetSize) + 0.5) / targetSize) * 2.0 - 1.0;
}

void main(void){
    float cosRotation = cos(aRotation);
    float sinRotation = sin(aRotation);
    float x = aVertex.x * cosRotation - aVertex.y * sinRotation;
    float y = aVertex.x * sinRotation + aVertex.y * cosRotation;

    vec2 v = vec2(x, y);
    v = v + aPosition;

    gl_Position = vec4((uTranslationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    if(uRound == 1.0)
    {
        gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
    }

    vUV = aUV;
    vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uColor;
}
`,Jy=`
struct ParticleUniforms {
  uProjectionMatrix:mat3x3<f32>,
  uColor:vec4<f32>,
  uResolution:vec2<f32>,
  uRoundPixels:f32,
};

@group(0) @binding(0) var<uniform> uniforms: ParticleUniforms;

@group(1) @binding(0) var uTexture: texture_2d<f32>;
@group(1) @binding(1) var uSampler : sampler;

struct VSOutput {
    @builtin(position) position: vec4<f32>,
    @location(0) uv : vec2<f32>,
    @location(1) color : vec4<f32>,
  };
@vertex
fn mainVertex(
  @location(0) aVertex: vec2<f32>,
  @location(1) aPosition: vec2<f32>,
  @location(2) aUV: vec2<f32>,
  @location(3) aColor: vec4<f32>,
  @location(4) aRotation: f32,
) -> VSOutput {
  
   let v = vec2(
       aVertex.x * cos(aRotation) - aVertex.y * sin(aRotation),
       aVertex.x * sin(aRotation) + aVertex.y * cos(aRotation)
   ) + aPosition;

   let position = vec4((uniforms.uProjectionMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);

    let vColor = vec4(aColor.rgb * aColor.a, aColor.a) * uniforms.uColor;

  return VSOutput(
   position,
   aUV,
   vColor,
  );
}

@fragment
fn mainFragment(
  @location(0) uv: vec2<f32>,
  @location(1) color: vec4<f32>,
  @builtin(position) position: vec4<f32>,
) -> @location(0) vec4<f32> {

    var sample = textureSample(uTexture, uSampler, uv) * color;
   
    return sample;
}`;class iU extends Ds{constructor(){const t=ho.from({vertex:sU,fragment:tU}),s=hn.from({fragment:{source:Jy,entryPoint:"mainFragment"},vertex:{source:Jy,entryPoint:"mainVertex"}});super({glProgram:t,gpuProgram:s,resources:{uTexture:me.WHITE.source,uSampler:new ln({}),uniforms:{uTranslationMatrix:{value:new Te,type:"mat3x3<f32>"},uColor:{value:new We(16777215),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}}})}}class _x{constructor(t,s){this.state=ti.for2d(),this.localUniforms=new ns({uTranslationMatrix:{value:new Te,type:"mat3x3<f32>"},uColor:{value:new Float32Array(4),type:"vec4<f32>"},uRound:{value:1,type:"f32"},uResolution:{value:[0,0],type:"vec2<f32>"}}),this.renderer=t,this.adaptor=s,this.defaultShader=new iU,this.state=ti.for2d()}validateRenderable(t){return!1}addRenderable(t,s){this.renderer.renderPipes.batch.break(s),s.add(t)}getBuffers(t){return t._gpuData[this.renderer.uid]||this._initBuffer(t)}_initBuffer(t){return t._gpuData[this.renderer.uid]=new QF({size:t.particleChildren.length,properties:t._properties}),t._gpuData[this.renderer.uid]}updateRenderable(t){}execute(t){const s=t.particleChildren;if(s.length===0)return;const r=this.renderer,o=this.getBuffers(t);t.texture||(t.texture=s[0].texture);const a=this.state;o.update(s,t._childrenDirty),t._childrenDirty=!1,a.blendMode=Nl(t.blendMode,t.texture._source);const h=this.localUniforms.uniforms,u=h.uTranslationMatrix;t.worldTransform.copyTo(u),u.prepend(r.globalUniforms.globalUniformData.projectionMatrix),h.uResolution=r.globalUniforms.globalUniformData.resolution,h.uRound=r._roundPixels|t._roundPixels,zl(t.groupColorAlpha,h.uColor,0),this.adaptor.execute(this,t)}destroy(){this.defaultShader&&(this.defaultShader.destroy(),this.defaultShader=null)}}class $x extends _x{constructor(t){super(t,new qF)}}$x.extension={type:[V.WebGLPipes],name:"particle"};class Tx extends _x{constructor(t){super(t,new JF)}}Tx.extension={type:[V.WebGPUPipes],name:"particle"};const bx=class Ex extends jF{constructor(t={}){t={...Ex.defaultOptions,...t},super({width:t.width,height:t.height,verticesX:4,verticesY:4}),this.update(t)}update(t){var s,r;this.width=t.width??this.width,this.height=t.height??this.height,this._originalWidth=t.originalWidth??this._originalWidth,this._originalHeight=t.originalHeight??this._originalHeight,this._leftWidth=t.leftWidth??this._leftWidth,this._rightWidth=t.rightWidth??this._rightWidth,this._topHeight=t.topHeight??this._topHeight,this._bottomHeight=t.bottomHeight??this._bottomHeight,this._anchorX=(s=t.anchor)==null?void 0:s.x,this._anchorY=(r=t.anchor)==null?void 0:r.y,this.updateUvs(),this.updatePositions()}updatePositions(){const t=this.positions,{width:s,height:r,_leftWidth:o,_rightWidth:a,_topHeight:h,_bottomHeight:u,_anchorX:p,_anchorY:f}=this,g=o+a,_=s>g?1:s/g,$=h+u,E=r>$?1:r/$,v=Math.min(_,E),w=p*s,x=f*r;t[0]=t[8]=t[16]=t[24]=-w,t[2]=t[10]=t[18]=t[26]=o*v-w,t[4]=t[12]=t[20]=t[28]=s-a*v-w,t[6]=t[14]=t[22]=t[30]=s-w,t[1]=t[3]=t[5]=t[7]=-x,t[9]=t[11]=t[13]=t[15]=h*v-x,t[17]=t[19]=t[21]=t[23]=r-u*v-x,t[25]=t[27]=t[29]=t[31]=r-x,this.getBuffer("aPosition").update()}updateUvs(){const t=this.uvs;t[0]=t[8]=t[16]=t[24]=0,t[1]=t[3]=t[5]=t[7]=0,t[6]=t[14]=t[22]=t[30]=1,t[25]=t[27]=t[29]=t[31]=1;const s=1/this._originalWidth,r=1/this._originalHeight;t[2]=t[10]=t[18]=t[26]=s*this._leftWidth,t[9]=t[11]=t[13]=t[15]=r*this._topHeight,t[4]=t[12]=t[20]=t[28]=1-s*this._rightWidth,t[17]=t[19]=t[21]=t[23]=1-r*this._bottomHeight,this.getBuffer("aUV").update()}};bx.defaultOptions={width:100,height:100,leftWidth:10,topHeight:10,rightWidth:10,bottomHeight:10,originalWidth:100,originalHeight:100};let rU=bx;class nU extends im{constructor(){super(),this.geometry=new rU}destroy(){this.geometry.destroy()}}class yx{constructor(t){this._renderer=t}addRenderable(t,s){const r=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,r),this._renderer.renderPipes.batch.addToBatch(r,s)}updateRenderable(t){const s=this._getGpuSprite(t);t.didViewUpdate&&this._updateBatchableSprite(t,s),s._batcher.updateElement(s)}validateRenderable(t){const s=this._getGpuSprite(t);return!s._batcher.checkAndUpdateTexture(s,t._texture)}_updateBatchableSprite(t,s){s.geometry.update(t),s.setTexture(t._texture)}_getGpuSprite(t){return t._gpuData[this._renderer.uid]||this._initGPUSprite(t)}_initGPUSprite(t){const s=t._gpuData[this._renderer.uid]=new nU,r=s;return r.renderable=t,r.transform=t.groupTransform,r.texture=t._texture,r.roundPixels=this._renderer._roundPixels|t._roundPixels,t.didViewUpdate||this._updateBatchableSprite(t,r),s}destroy(){this._renderer=null}}yx.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"nineSliceSprite"};const oU={name:"tiling-bit",vertex:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`
            uv = (tilingUniforms.uTextureTransform * vec3(uv, 1.0)).xy;

            position = (position - tilingUniforms.uSizeAnchor.zw) * tilingUniforms.uSizeAnchor.xy;
        `},fragment:{header:`
            struct TilingUniforms {
                uMapCoord:mat3x3<f32>,
                uClampFrame:vec4<f32>,
                uClampOffset:vec2<f32>,
                uTextureTransform:mat3x3<f32>,
                uSizeAnchor:vec4<f32>
            };

            @group(2) @binding(0) var<uniform> tilingUniforms: TilingUniforms;
            @group(2) @binding(1) var uTexture: texture_2d<f32>;
            @group(2) @binding(2) var uSampler: sampler;
        `,main:`

            var coord = vUV + ceil(tilingUniforms.uClampOffset - vUV);
            coord = (tilingUniforms.uMapCoord * vec3(coord, 1.0)).xy;
            var unclamped = coord;
            coord = clamp(coord, tilingUniforms.uClampFrame.xy, tilingUniforms.uClampFrame.zw);

            var bias = 0.;

            if(unclamped.x == coord.x && unclamped.y == coord.y)
            {
                bias = -32.;
            }

            outColor = textureSampleBias(uTexture, uSampler, coord, bias);
        `}},lU={name:"tiling-bit",vertex:{header:`
            uniform mat3 uTextureTransform;
            uniform vec4 uSizeAnchor;

        `,main:`
            uv = (uTextureTransform * vec3(aUV, 1.0)).xy;

            position = (position - uSizeAnchor.zw) * uSizeAnchor.xy;
        `},fragment:{header:`
            uniform sampler2D uTexture;
            uniform mat3 uMapCoord;
            uniform vec4 uClampFrame;
            uniform vec2 uClampOffset;
        `,main:`

        vec2 coord = vUV + ceil(uClampOffset - vUV);
        coord = (uMapCoord * vec3(coord, 1.0)).xy;
        vec2 unclamped = coord;
        coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);

        outColor = texture(uTexture, coord, unclamped == coord ? 0.0 : -32.0);// lod-bias very negative to force lod 0

        `}};let Nf,Df;class aU extends Ds{constructor(){Nf??(Nf=Gl({name:"tiling-sprite-shader",bits:[xl,oU,Vl]})),Df??(Df=Hl({name:"tiling-sprite-shader",bits:[zg,lU,Wl]}));const t=new ns({uMapCoord:{value:new Te,type:"mat3x3<f32>"},uClampFrame:{value:new Float32Array([0,0,1,1]),type:"vec4<f32>"},uClampOffset:{value:new Float32Array([0,0]),type:"vec2<f32>"},uTextureTransform:{value:new Te,type:"mat3x3<f32>"},uSizeAnchor:{value:new Float32Array([100,100,.5,.5]),type:"vec4<f32>"}});super({glProgram:Df,gpuProgram:Nf,resources:{localUniforms:new ns({uTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uRound:{value:0,type:"f32"}}),tilingUniforms:t,uTexture:me.EMPTY.source,uSampler:me.EMPTY.source.style}})}updateUniforms(t,s,r,o,a,h){const u=this.resources.tilingUniforms,p=h.width,f=h.height,g=h.textureMatrix,_=u.uniforms.uTextureTransform;_.set(r.a*p/t,r.b*p/s,r.c*f/t,r.d*f/s,r.tx/t,r.ty/s),_.invert(),u.uniforms.uMapCoord=g.mapCoord,u.uniforms.uClampFrame=g.uClampFrame,u.uniforms.uClampOffset=g.uClampOffset,u.uniforms.uTextureTransform=_,u.uniforms.uSizeAnchor[0]=t,u.uniforms.uSizeAnchor[1]=s,u.uniforms.uSizeAnchor[2]=o,u.uniforms.uSizeAnchor[3]=a,h&&(this.resources.uTexture=h.source,this.resources.uSampler=h.source.style)}}class cU extends Hg{constructor(){super({positions:new Float32Array([0,0,1,0,1,1,0,1]),uvs:new Float32Array([0,0,1,0,1,1,0,1]),indices:new Uint32Array([0,1,2,0,2,3])})}}function hU(l,t){const s=l.anchor.x,r=l.anchor.y;t[0]=-s*l.width,t[1]=-r*l.height,t[2]=(1-s)*l.width,t[3]=-r*l.height,t[4]=(1-s)*l.width,t[5]=(1-r)*l.height,t[6]=-s*l.width,t[7]=(1-r)*l.height}function uU(l,t,s,r){let o=0;const a=l.length/t,h=r.a,u=r.b,p=r.c,f=r.d,g=r.tx,_=r.ty;for(s*=t;o<a;){const $=l[s],E=l[s+1];l[s]=h*$+p*E+g,l[s+1]=u*$+f*E+_,s+=t,o++}}function dU(l,t){const s=l.texture,r=s.frame.width,o=s.frame.height;let a=0,h=0;l.applyAnchorToTexture&&(a=l.anchor.x,h=l.anchor.y),t[0]=t[6]=-a,t[2]=t[4]=1-a,t[1]=t[3]=-h,t[5]=t[7]=1-h;const u=Te.shared;u.copyFrom(l._tileTransform.matrix),u.tx/=l.width,u.ty/=l.height,u.invert(),u.scale(l.width/r,l.height/o),uU(t,2,0,u)}const Zc=new cU;class pU{constructor(){this.canBatch=!0,this.geometry=new Hg({indices:Zc.indices.slice(),positions:Zc.positions.slice(),uvs:Zc.uvs.slice()})}destroy(){var t;this.geometry.destroy(),(t=this.shader)==null||t.destroy()}}class vx{constructor(t){this._state=ti.default2d,this._renderer=t}validateRenderable(t){const s=this._getTilingSpriteData(t),r=s.canBatch;this._updateCanBatch(t);const o=s.canBatch;if(o&&o===r){const{batchableMesh:a}=s;return!a._batcher.checkAndUpdateTexture(a,t.texture)}return r!==o}addRenderable(t,s){const r=this._renderer.renderPipes.batch;this._updateCanBatch(t);const o=this._getTilingSpriteData(t),{geometry:a,canBatch:h}=o;if(h){o.batchableMesh||(o.batchableMesh=new im);const u=o.batchableMesh;t.didViewUpdate&&(this._updateBatchableMesh(t),u.geometry=a,u.renderable=t,u.transform=t.groupTransform,u.setTexture(t._texture)),u.roundPixels=this._renderer._roundPixels|t._roundPixels,r.addToBatch(u,s)}else r.break(s),o.shader||(o.shader=new aU),this.updateRenderable(t),s.add(t)}execute(t){const{shader:s}=this._getTilingSpriteData(t);s.groups[0]=this._renderer.globalUniforms.bindGroup;const r=s.resources.localUniforms.uniforms;r.uTransformMatrix=t.groupTransform,r.uRound=this._renderer._roundPixels|t._roundPixels,zl(t.groupColorAlpha,r.uColor,0),this._state.blendMode=Nl(t.groupBlendMode,t.texture._source),this._renderer.encoder.draw({geometry:Zc,shader:s,state:this._state})}updateRenderable(t){const s=this._getTilingSpriteData(t),{canBatch:r}=s;if(r){const{batchableMesh:o}=s;t.didViewUpdate&&this._updateBatchableMesh(t),o._batcher.updateElement(o)}else if(t.didViewUpdate){const{shader:o}=s;o.updateUniforms(t.width,t.height,t._tileTransform.matrix,t.anchor.x,t.anchor.y,t.texture)}}_getTilingSpriteData(t){return t._gpuData[this._renderer.uid]||this._initTilingSpriteData(t)}_initTilingSpriteData(t){const s=new pU;return s.renderable=t,t._gpuData[this._renderer.uid]=s,s}_updateBatchableMesh(t){const s=this._getTilingSpriteData(t),{geometry:r}=s,o=t.texture.source.style;o.addressMode!=="repeat"&&(o.addressMode="repeat",o.update()),dU(t,r.uvs),hU(t,r.positions)}destroy(){this._renderer=null}_updateCanBatch(t){const s=this._getTilingSpriteData(t),r=t.texture;let o=!0;return this._renderer.type===ei.WEBGL&&(o=this._renderer.context.supports.nonPowOf2wrapping),s.canBatch=r.textureMatrix.isSimple&&(o||r.source.isPowerOfTwo),s.canBatch}}vx.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"tilingSprite"};const fU={name:"local-uniform-msdf-bit",vertex:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32,
                uRound:f32,
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
        `,main:`
            vColor *= localUniforms.uColor;
            modelMatrix *= localUniforms.uTransformMatrix;
        `,end:`
            if(localUniforms.uRound == 1)
            {
                vPosition = vec4(roundPixels(vPosition.xy, globalUniforms.uResolution), vPosition.zw);
            }
        `},fragment:{header:`
            struct LocalUniforms {
                uColor:vec4<f32>,
                uTransformMatrix:mat3x3<f32>,
                uDistance: f32
            }

            @group(2) @binding(0) var<uniform> localUniforms : LocalUniforms;
         `,main:`
            outColor = vec4<f32>(calculateMSDFAlpha(outColor, localUniforms.uColor, localUniforms.uDistance));
        `}},gU={name:"local-uniform-msdf-bit",vertex:{header:`
            uniform mat3 uTransformMatrix;
            uniform vec4 uColor;
            uniform float uRound;
        `,main:`
            vColor *= uColor;
            modelMatrix *= uTransformMatrix;
        `,end:`
            if(uRound == 1.)
            {
                gl_Position.xy = roundPixels(gl_Position.xy, uResolution);
            }
        `},fragment:{header:`
            uniform float uDistance;
         `,main:`
            outColor = vec4(calculateMSDFAlpha(outColor, vColor, uDistance));
        `}},mU={name:"msdf-bit",fragment:{header:`
            fn calculateMSDFAlpha(msdfColor:vec4<f32>, shapeColor:vec4<f32>, distance:f32) -> f32 {

                // MSDF
                var median = msdfColor.r + msdfColor.g + msdfColor.b -
                    min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                    max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                var screenPxDistance = distance * (median - 0.5);
                var alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);
                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                var luma: f32 = dot(shapeColor.rgb, vec3<f32>(0.299, 0.587, 0.114));
                var gamma: f32 = mix(1.0, 1.0 / 2.2, luma);
                var coverage: f32 = pow(shapeColor.a * alpha, gamma);

                return coverage;

            }
        `}},_U={name:"msdf-bit",fragment:{header:`
            float calculateMSDFAlpha(vec4 msdfColor, vec4 shapeColor, float distance) {

                // MSDF
                float median = msdfColor.r + msdfColor.g + msdfColor.b -
                                min(msdfColor.r, min(msdfColor.g, msdfColor.b)) -
                                max(msdfColor.r, max(msdfColor.g, msdfColor.b));

                // SDF
                median = min(median, msdfColor.a);

                float screenPxDistance = distance * (median - 0.5);
                float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);

                if (median < 0.01) {
                    alpha = 0.0;
                } else if (median > 0.99) {
                    alpha = 1.0;
                }

                // Gamma correction for coverage-like alpha
                float luma = dot(shapeColor.rgb, vec3(0.299, 0.587, 0.114));
                float gamma = mix(1.0, 1.0 / 2.2, luma);
                float coverage = pow(shapeColor.a * alpha, gamma);

                return coverage;
            }
        `}};let Bf,Ff;class $U extends Ds{constructor(t){const s=new ns({uColor:{value:new Float32Array([1,1,1,1]),type:"vec4<f32>"},uTransformMatrix:{value:new Te,type:"mat3x3<f32>"},uDistance:{value:4,type:"f32"},uRound:{value:0,type:"f32"}});Bf??(Bf=Gl({name:"sdf-shader",bits:[kg,Ag(t),fU,mU,Vl]})),Ff??(Ff=Hl({name:"sdf-shader",bits:[Og,Mg(t),gU,_U,Wl]})),super({glProgram:Ff,gpuProgram:Bf,resources:{localUniforms:s,batchSamplers:Lg(t)}})}}class TU extends yt{destroy(){this.context.customShader&&this.context.customShader.destroy(),super.destroy()}}class Sx{constructor(t){this._renderer=t,this._renderer.renderableGC.addManagedHash(this,"_gpuBitmapText")}validateRenderable(t){const s=this._getGpuBitmapText(t);return t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,s)),this._renderer.renderPipes.graphics.validateRenderable(s)}addRenderable(t,s){const r=this._getGpuBitmapText(t);Zy(t,r),t._didTextUpdate&&(t._didTextUpdate=!1,this._updateContext(t,r)),this._renderer.renderPipes.graphics.addRenderable(r,s),r.context.customShader&&this._updateDistanceField(t)}updateRenderable(t){const s=this._getGpuBitmapText(t);Zy(t,s),this._renderer.renderPipes.graphics.updateRenderable(s),s.context.customShader&&this._updateDistanceField(t)}_updateContext(t,s){const{context:r}=s,o=VB.getFont(t.text,t._style);r.clear(),o.distanceField.type!=="none"&&(r.customShader||(r.customShader=new $U(this._renderer.limits.maxBatchableTextures)));const a=Ei.graphemeSegmenter(t.text),h=t._style;let u=o.baseLineOffset;const p=PS(a,h,o,!0),f=h.padding,g=p.scale;let _=p.width,$=p.height+p.offsetY;h._stroke&&(_+=h._stroke.width/g,$+=h._stroke.width/g),r.translate(-t._anchor._x*_-f,-t._anchor._y*$-f).scale(g,g);const E=o.applyFillAsTint?h._fill.color:16777215;for(let v=0;v<p.lines.length;v++){const w=p.lines[v];for(let x=0;x<w.charPositions.length;x++){const C=w.chars[x],R=o.chars[C];R!=null&&R.texture&&r.texture(R.texture,E||"black",Math.round(w.charPositions[x]+R.xOffset),Math.round(u+R.yOffset))}u+=o.lineHeight}}_getGpuBitmapText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const s=new TU;return t._gpuData[this._renderer.uid]=s,this._updateContext(t,s),s}_updateDistanceField(t){const s=this._getGpuBitmapText(t).context,r=t._style.fontFamily,o=Xt.get(`${r}-bitmap`),{a,b:h,c:u,d:p}=t.groupTransform,f=Math.sqrt(a*a+h*h),g=Math.sqrt(u*u+p*p),_=(Math.abs(f)+Math.abs(g))/2,$=o.baseRenderedFontSize/t._style.fontSize,E=_*o.distanceField.range*(1/$);s.customShader.resources.localUniforms.uniforms.uDistance=E}destroy(){this._renderer=null}}Sx.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"bitmapText"};function Zy(l,t){t.groupTransform=l.groupTransform,t.groupColorAlpha=l.groupColorAlpha,t.groupColor=l.groupColor,t.groupBlendMode=l.groupBlendMode,t.globalDisplayStatus=l.globalDisplayStatus,t.groupTransform=l.groupTransform,t.localDisplayStatus=l.localDisplayStatus,t.groupAlpha=l.groupAlpha,t._roundPixels=l._roundPixels}class bU extends _h{constructor(t){super(),this.generatingTexture=!1,this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.htmlText.returnTexturePromise(this.texturePromise),this.texturePromise=null,this._renderer=null}}function dg(l,t){const{texture:s,bounds:r}=l,o=t._style._getFinalPadding();yv(r,t._anchor,s);const a=t._anchor._x*o*2,h=t._anchor._y*o*2;r.minX-=o-a,r.minY-=o-h,r.maxX-=o-a,r.maxY-=o-h}class Ix{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,s){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t).catch(o=>{console.error(o)}),t._didTextUpdate=!1,dg(r,t)),this._renderer.renderPipes.batch.addToBatch(r,s)}updateRenderable(t){const s=this._getGpuText(t);s._batcher.updateElement(s)}async _updateGpuText(t){t._didTextUpdate=!1;const s=this._getGpuText(t);if(s.generatingTexture)return;s.texturePromise&&(this._renderer.htmlText.returnTexturePromise(s.texturePromise),s.texturePromise=null),s.generatingTexture=!0,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution;const r=this._renderer.htmlText.getTexturePromise(t);s.texturePromise=r,s.texture=await r;const o=t.renderGroup||t.parentRenderGroup;o&&(o.structureDidChange=!0),s.generatingTexture=!1,dg(s,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const s=new bU(this._renderer);return s.renderable=t,s.transform=t.groupTransform,s.texture=me.EMPTY,s.bounds={minX:0,maxX:1,minY:0,maxY:0},s.roundPixels=this._renderer._roundPixels|t._roundPixels,t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,t._gpuData[this._renderer.uid]=s,s}destroy(){this._renderer=null}}Ix.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"htmlText"};function EU(){const{userAgent:l}=it.get().getNavigator();return/^((?!chrome|android).)*safari/i.test(l)}const yU=new Yt;function xx(l,t,s,r){const o=yU;o.minX=0,o.minY=0,o.maxX=l.width/r|0,o.maxY=l.height/r|0;const a=zt.getOptimalTexture(o.width,o.height,r,!1);return a.source.uploadMethodId="image",a.source.resource=l,a.source.alphaMode="premultiply-alpha-on-upload",a.frame.width=t/r,a.frame.height=s/r,a.source.emit("update",a.source),a.updateUvs(),a}function vU(l,t){const s=t.fontFamily,r=[],o={},a=/font-family:([^;"\s]+)/g,h=l.match(a);function u(p){o[p]||(r.push(p),o[p]=!0)}if(Array.isArray(s))for(let p=0;p<s.length;p++)u(s[p]);else u(s);h&&h.forEach(p=>{const f=p.split(":")[1].trim();u(f)});for(const p in t.tagStyles){const f=t.tagStyles[p].fontFamily;u(f)}return r}async function SU(l){const s=await(await it.get().fetch(l)).blob(),r=new FileReader;return await new Promise((a,h)=>{r.onloadend=()=>a(r.result),r.onerror=h,r.readAsDataURL(s)})}async function Qy(l,t){const s=await SU(t);return`@font-face {
        font-family: "${l.fontFamily}";
        src: url('${s}');
        font-weight: ${l.fontWeight};
        font-style: ${l.fontStyle};
    }`}const Yc=new Map;async function IU(l,t,s){const r=l.filter(o=>Xt.has(`${o}-and-url`)).map((o,a)=>{if(!Yc.has(o)){const{url:h}=Xt.get(`${o}-and-url`);a===0?Yc.set(o,Qy({fontWeight:t.fontWeight,fontStyle:t.fontStyle,fontFamily:o},h)):Yc.set(o,Qy({fontWeight:s.fontWeight,fontStyle:s.fontStyle,fontFamily:o},h))}return Yc.get(o)});return(await Promise.all(r)).join(`
`)}function xU(l,t,s,r,o){const{domElement:a,styleElement:h,svgRoot:u}=o;a.innerHTML=`<style>${t.cssStyle}</style><div style='padding:0;'>${l}</div>`,a.setAttribute("style",`transform: scale(${s});transform-origin: top left; display: inline-block`),h.textContent=r;const{width:p,height:f}=o.image;return u.setAttribute("width",p.toString()),u.setAttribute("height",f.toString()),new XMLSerializer().serializeToString(u)}function CU(l,t){const s=br.getOptimalCanvasAndContext(l.width,l.height,t),{context:r}=s;return r.clearRect(0,0,l.width,l.height),r.drawImage(l,0,0),s}function wU(l,t,s){return new Promise(async r=>{s&&await new Promise(o=>setTimeout(o,100)),l.onload=()=>{r()},l.src=`data:image/svg+xml;charset=utf8,${encodeURIComponent(t)}`,l.crossOrigin="anonymous"})}class Cx{constructor(t){this._renderer=t,this._createCanvas=t.type===ei.WEBGPU}getTexture(t){return this.getTexturePromise(t)}getTexturePromise(t){return this._buildTexturePromise(t)}async _buildTexturePromise(t){const{text:s,style:r,resolution:o,textureStyle:a}=t,h=Pt.get(WS),u=vU(s,r),p=await IU(u,r,Vg.defaultTextStyle),f=a1(s,r,p,h),g=Math.ceil(Math.ceil(Math.max(1,f.width)+r.padding*2)*o),_=Math.ceil(Math.ceil(Math.max(1,f.height)+r.padding*2)*o),$=h.image,E=2;$.width=(g|0)+E,$.height=(_|0)+E;const v=xU(s,r,o,p,h);await wU($,v,EU()&&u.length>0);const w=$;let x;this._createCanvas&&(x=CU($,o));const C=xx(x?x.canvas:w,$.width-E,$.height-E,o);return a&&(C.source.style=a),this._createCanvas&&(this._renderer.texture.initSource(C.source),br.returnCanvasAndContext(x)),Pt.return(h),C}returnTexturePromise(t){t.then(s=>{this._cleanUp(s)}).catch(()=>{we("HTMLTextSystem: Failed to clean texture")})}_cleanUp(t){zt.returnTexture(t,!0),t.source.resource=null,t.source.uploadMethodId="unknown"}destroy(){this._renderer=null}}Cx.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"htmlText"};class RU extends _h{constructor(t){super(),this._renderer=t,t.runners.resolutionChange.add(this)}resolutionChange(){const t=this.renderable;t._autoResolution&&t.onViewUpdate()}destroy(){this._renderer.canvasText.returnTexture(this.texture),this._renderer=null}}class wx{constructor(t){this._renderer=t}validateRenderable(t){return t._didTextUpdate}addRenderable(t,s){const r=this._getGpuText(t);t._didTextUpdate&&(this._updateGpuText(t),t._didTextUpdate=!1),this._renderer.renderPipes.batch.addToBatch(r,s)}updateRenderable(t){const s=this._getGpuText(t);s._batcher.updateElement(s)}_updateGpuText(t){const s=this._getGpuText(t);s.texture&&this._renderer.canvasText.returnTexture(s.texture),t._resolution=t._autoResolution?this._renderer.resolution:t.resolution,s.texture=s.texture=this._renderer.canvasText.getTexture(t),dg(s,t)}_getGpuText(t){return t._gpuData[this._renderer.uid]||this.initGpuText(t)}initGpuText(t){const s=new RU(this._renderer);return s.renderable=t,s.transform=t.groupTransform,s.bounds={minX:0,maxX:1,minY:0,maxY:0},s.roundPixels=this._renderer._roundPixels|t._roundPixels,t._gpuData[this._renderer.uid]=s,s}destroy(){this._renderer=null}}wx.extension={type:[V.WebGLPipes,V.WebGPUPipes,V.CanvasPipes],name:"text"};class Rx{constructor(t){this._renderer=t}getTexture(t,s,r,o){typeof t=="string"&&(ke("8.0.0","CanvasTextSystem.getTexture: Use object TextOptions instead of separate arguments"),t={text:t,style:r,resolution:s}),t.style instanceof Tr||(t.style=new Tr(t.style)),t.textureStyle instanceof ln||(t.textureStyle=new ln(t.textureStyle)),typeof t.text!="string"&&(t.text=t.text.toString());const{text:a,style:h,textureStyle:u}=t,p=t.resolution??this._renderer.resolution,{frame:f,canvasAndContext:g}=Af.getCanvasAndContext({text:a,style:h,resolution:p}),_=xx(g.canvas,f.width,f.height,p);if(u&&(_.source.style=u),h.trim&&(f.pad(h.padding),_.frame.copyFrom(f),_.updateUvs()),h.filters){const $=this._applyFilters(_,h.filters);return this.returnTexture(_),Af.returnCanvasAndContext(g),$}return this._renderer.texture.initSource(_._source),Af.returnCanvasAndContext(g),_}returnTexture(t){const s=t.source;s.resource=null,s.uploadMethodId="unknown",s.alphaMode="no-premultiply-alpha",zt.returnTexture(t,!0)}renderTextToCanvas(){ke("8.10.0","CanvasTextSystem.renderTextToCanvas: no longer supported, use CanvasTextSystem.getTexture instead")}_applyFilters(t,s){const r=this._renderer.renderTarget.renderTarget,o=this._renderer.filter.generateFilteredTexture({texture:t,filters:s});return this._renderer.renderTarget.bind(r,!1),o}destroy(){this._renderer=null}}Rx.extension={type:[V.WebGLSystem,V.WebGPUSystem,V.CanvasSystem],name:"canvasText"};Se.add(J0,Z0);var kU=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function OU(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var kx={exports:{}};(function(l,t){(function(){var s,r;r=function(o){return l.exports=o},s={linear:function(o,a,h,u){return h*o/u+a},easeInQuad:function(o,a,h,u){return h*(o/=u)*o+a},easeOutQuad:function(o,a,h,u){return-h*(o/=u)*(o-2)+a},easeInOutQuad:function(o,a,h,u){return(o/=u/2)<1?h/2*o*o+a:-h/2*(--o*(o-2)-1)+a},easeInCubic:function(o,a,h,u){return h*(o/=u)*o*o+a},easeOutCubic:function(o,a,h,u){return h*((o=o/u-1)*o*o+1)+a},easeInOutCubic:function(o,a,h,u){return(o/=u/2)<1?h/2*o*o*o+a:h/2*((o-=2)*o*o+2)+a},easeInQuart:function(o,a,h,u){return h*(o/=u)*o*o*o+a},easeOutQuart:function(o,a,h,u){return-h*((o=o/u-1)*o*o*o-1)+a},easeInOutQuart:function(o,a,h,u){return(o/=u/2)<1?h/2*o*o*o*o+a:-h/2*((o-=2)*o*o*o-2)+a},easeInQuint:function(o,a,h,u){return h*(o/=u)*o*o*o*o+a},easeOutQuint:function(o,a,h,u){return h*((o=o/u-1)*o*o*o*o+1)+a},easeInOutQuint:function(o,a,h,u){return(o/=u/2)<1?h/2*o*o*o*o*o+a:h/2*((o-=2)*o*o*o*o+2)+a},easeInSine:function(o,a,h,u){return-h*Math.cos(o/u*(Math.PI/2))+h+a},easeOutSine:function(o,a,h,u){return h*Math.sin(o/u*(Math.PI/2))+a},easeInOutSine:function(o,a,h,u){return-h/2*(Math.cos(Math.PI*o/u)-1)+a},easeInExpo:function(o,a,h,u){return o===0?a:h*Math.pow(2,10*(o/u-1))+a},easeOutExpo:function(o,a,h,u){return o===u?a+h:h*(-Math.pow(2,-10*o/u)+1)+a},easeInOutExpo:function(o,a,h,u){return(o/=u/2)<1?h/2*Math.pow(2,10*(o-1))+a:h/2*(-Math.pow(2,-10*--o)+2)+a},easeInCirc:function(o,a,h,u){return-h*(Math.sqrt(1-(o/=u)*o)-1)+a},easeOutCirc:function(o,a,h,u){return h*Math.sqrt(1-(o=o/u-1)*o)+a},easeInOutCirc:function(o,a,h,u){return(o/=u/2)<1?-h/2*(Math.sqrt(1-o*o)-1)+a:h/2*(Math.sqrt(1-(o-=2)*o)+1)+a},easeInElastic:function(o,a,h,u){var p,f,g;return g=1.70158,f=0,p=h,o===0||(o/=u),f||(f=u*.3),p<Math.abs(h)?(p=h,g=f/4):g=f/(2*Math.PI)*Math.asin(h/p),-(p*Math.pow(2,10*(o-=1))*Math.sin((o*u-g)*(2*Math.PI)/f))+a},easeOutElastic:function(o,a,h,u){var p,f,g;return g=1.70158,f=0,p=h,o===0||(o/=u),f||(f=u*.3),p<Math.abs(h)?(p=h,g=f/4):g=f/(2*Math.PI)*Math.asin(h/p),p*Math.pow(2,-10*o)*Math.sin((o*u-g)*(2*Math.PI)/f)+h+a},easeInOutElastic:function(o,a,h,u){var p,f,g;return g=1.70158,f=0,p=h,o===0||(o/=u/2),f||(f=u*(.3*1.5)),p<Math.abs(h)?(p=h,g=f/4):g=f/(2*Math.PI)*Math.asin(h/p),o<1?-.5*(p*Math.pow(2,10*(o-=1))*Math.sin((o*u-g)*(2*Math.PI)/f))+a:p*Math.pow(2,-10*(o-=1))*Math.sin((o*u-g)*(2*Math.PI)/f)*.5+h+a},easeInBack:function(o,a,h,u,p){return p===void 0&&(p=1.70158),h*(o/=u)*o*((p+1)*o-p)+a},easeOutBack:function(o,a,h,u,p){return p===void 0&&(p=1.70158),h*((o=o/u-1)*o*((p+1)*o+p)+1)+a},easeInOutBack:function(o,a,h,u,p){return p===void 0&&(p=1.70158),(o/=u/2)<1?h/2*(o*o*(((p*=1.525)+1)*o-p))+a:h/2*((o-=2)*o*(((p*=1.525)+1)*o+p)+2)+a},easeInBounce:function(o,a,h,u){var p;return p=s.easeOutBounce(u-o,0,h,u),h-p+a},easeOutBounce:function(o,a,h,u){return(o/=u)<1/2.75?h*(7.5625*o*o)+a:o<2/2.75?h*(7.5625*(o-=1.5/2.75)*o+.75)+a:o<2.5/2.75?h*(7.5625*(o-=2.25/2.75)*o+.9375)+a:h*(7.5625*(o-=2.625/2.75)*o+.984375)+a},easeInOutBounce:function(o,a,h,u){var p;return o<u/2?(p=s.easeInBounce(o*2,0,h,u),p*.5+a):(p=s.easeOutBounce(o*2-u,0,h,u),p*.5+h*.5+a)}},r(s)}).call(kU)})(kx);var AU=kx.exports;const ev=OU(AU);function $h(l,t){if(l){if(typeof l=="function")return l;if(typeof l=="string")return ev[l]}else return ev[t]}let MU=class{constructor(t){this.viewport=t,this.touches=[],this.addListeners()}addListeners(){this.viewport.eventMode="static",this.viewport.forceHitArea||(this.viewport.hitArea=new Fe(0,0,this.viewport.worldWidth,this.viewport.worldHeight)),this.viewport.on("pointerdown",this.down,this),this.viewport.options.allowPreserveDragOutside?this.viewport.on("globalpointermove",this.move,this):this.viewport.on("pointermove",this.move,this),this.viewport.on("pointerup",this.up,this),this.viewport.on("pointerupoutside",this.up,this),this.viewport.on("pointercancel",this.up,this),this.viewport.options.allowPreserveDragOutside||this.viewport.on("pointerleave",this.up,this),this.wheelFunction=t=>this.handleWheel(t),this.viewport.options.events.domElement.addEventListener("wheel",this.wheelFunction,{passive:this.viewport.options.passiveWheel}),this.isMouseDown=!1}destroy(){var t;(t=this.viewport.options.events.domElement)==null||t.removeEventListener("wheel",this.wheelFunction)}down(t){if(!(this.viewport.pause||!this.viewport.visible)){if(t.pointerType==="mouse"?this.isMouseDown=!0:this.get(t.pointerId)||this.touches.push({id:t.pointerId,last:null}),this.count()===1){this.last=t.global.clone();const s=this.viewport.plugins.get("decelerate",!0),r=this.viewport.plugins.get("bounce",!0);(!s||!s.isActive())&&(!r||!r.isActive())?this.clickedAvailable=!0:this.clickedAvailable=!1}else this.clickedAvailable=!1;this.viewport.plugins.down(t)&&this.viewport.options.stopPropagation&&t.stopPropagation()}}clear(){this.isMouseDown=!1,this.touches=[],this.last=null}checkThreshold(t){return Math.abs(t)>=this.viewport.threshold}move(t){if(this.viewport.pause||!this.viewport.visible)return;const s=this.viewport.plugins.move(t);if(this.clickedAvailable&&this.last){const r=t.global.x-this.last.x,o=t.global.y-this.last.y;(this.checkThreshold(r)||this.checkThreshold(o))&&(this.clickedAvailable=!1)}s&&this.viewport.options.stopPropagation&&t.stopPropagation()}up(t){if(this.viewport.pause||!this.viewport.visible)return;t.pointerType==="mouse"&&(this.isMouseDown=!1),t.pointerType!=="mouse"&&this.remove(t.pointerId);const s=this.viewport.plugins.up(t);this.clickedAvailable&&this.count()===0&&this.last&&(this.viewport.emit("clicked",{event:t,screen:this.last,world:this.viewport.toWorld(this.last),viewport:this.viewport}),this.clickedAvailable=!1),s&&this.viewport.options.stopPropagation&&t.stopPropagation()}getPointerPosition(t){const s=new ve;return this.viewport.options.events.mapPositionToPoint(s,t.clientX,t.clientY),s}handleWheel(t){if(this.viewport.pause||!this.viewport.visible)return;const s=this.viewport.toLocal(this.getPointerPosition(t));this.viewport.left<=s.x&&s.x<=this.viewport.right&&this.viewport.top<=s.y&&s.y<=this.viewport.bottom&&this.viewport.plugins.wheel(t)&&!this.viewport.options.passiveWheel&&t.preventDefault()}pause(){this.touches=[],this.isMouseDown=!1}get(t){for(const s of this.touches)if(s.id===t)return s;return null}remove(t){for(let s=0;s<this.touches.length;s++)if(this.touches[s].id===t){this.touches.splice(s,1);return}}count(){return(this.isMouseDown?1:0)+this.touches.length}};const gl=["drag","pinch","wheel","follow","mouse-edges","decelerate","animate","bounce","snap-zoom","clamp-zoom","snap","clamp"];let LU=class{constructor(t){this.viewport=t,this.list=[],this.plugins={}}add(t,s,r=gl.length){const o=this.plugins[t];o&&o.destroy(),this.plugins[t]=s;const a=gl.indexOf(t);a!==-1&&gl.splice(a,1),gl.splice(r,0,t),this.sort()}get(t,s){var r;return s&&(r=this.plugins[t])!=null&&r.paused?null:this.plugins[t]}update(t){for(const s of this.list)s.update(t)}resize(){for(const t of this.list)t.resize()}reset(){for(const t of this.list)t.reset()}removeAll(){this.list.forEach(t=>{t.destroy()}),this.plugins={},this.sort()}remove(t){var s;this.plugins[t]&&((s=this.plugins[t])==null||s.destroy(),delete this.plugins[t],this.viewport.emit("plugin-remove",t),this.sort())}pause(t){var s;(s=this.plugins[t])==null||s.pause()}resume(t){var s;(s=this.plugins[t])==null||s.resume()}sort(){this.list=[];for(const t of gl)this.plugins[t]&&this.list.push(this.plugins[t])}down(t){let s=!1;for(const r of this.list)r.down(t)&&(s=!0);return s}move(t){let s=!1;for(const r of this.viewport.plugins.list)r.move(t)&&(s=!0);return s}up(t){let s=!1;for(const r of this.list)r.up(t)&&(s=!0);return s}wheel(t){let s=!1;for(const r of this.list)r.wheel(t)&&(s=!0);return s}};class Bs{constructor(t){this.parent=t,this.paused=!1}destroy(){}down(t){return!1}move(t){return!1}up(t){return!1}wheel(t){return!1}update(t){}resize(){}reset(){}pause(){this.paused=!0}resume(){this.paused=!1}}const PU={removeOnInterrupt:!1,ease:"linear",time:1e3};class NU extends Bs{constructor(t,s={}){super(t),this.startWidth=null,this.startHeight=null,this.deltaWidth=null,this.deltaHeight=null,this.width=null,this.height=null,this.time=0,this.options=Object.assign({},PU,s),this.options.ease=$h(this.options.ease),this.setupPosition(),this.setupZoom(),this.time=0}setupPosition(){typeof this.options.position<"u"?(this.startX=this.parent.center.x,this.startY=this.parent.center.y,this.deltaX=this.options.position.x-this.parent.center.x,this.deltaY=this.options.position.y-this.parent.center.y,this.keepCenter=!1):this.keepCenter=!0}setupZoom(){this.width=null,this.height=null,typeof this.options.scale<"u"?this.width=this.parent.screenWidth/this.options.scale:typeof this.options.scaleX<"u"||typeof this.options.scaleY<"u"?(typeof this.options.scaleX<"u"&&(this.width=this.parent.screenWidth/this.options.scaleX),typeof this.options.scaleY<"u"&&(this.height=this.parent.screenHeight/this.options.scaleY)):(typeof this.options.width<"u"&&(this.width=this.options.width),typeof this.options.height<"u"&&(this.height=this.options.height)),this.width!==null&&(this.startWidth=this.parent.screenWidthInWorldPixels,this.deltaWidth=this.width-this.startWidth),this.height!==null&&(this.startHeight=this.parent.screenHeightInWorldPixels,this.deltaHeight=this.height-this.startHeight)}down(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("animate"),!1}complete(){this.parent.plugins.remove("animate"),this.width!==null&&this.parent.fitWidth(this.width,this.keepCenter,this.height===null),this.height!==null&&this.parent.fitHeight(this.height,this.keepCenter,this.width===null),!this.keepCenter&&this.options.position&&this.parent.moveCenter(this.options.position),this.parent.emit("animate-end",this.parent),this.options.callbackOnComplete&&this.options.callbackOnComplete(this.parent)}update(t){if(this.paused)return;this.time+=t;const s=new ve(this.parent.scale.x,this.parent.scale.y);if(this.time>=this.options.time){const r=this.parent.width,o=this.parent.height;this.complete(),(r!==this.parent.width||o!==this.parent.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:s,type:"animate"})}else{const r=this.options.ease(this.time,0,1,this.options.time);if(this.width!==null){const o=this.startWidth,a=this.deltaWidth;this.parent.fitWidth(o+a*r,this.keepCenter,this.height===null)}if(this.height!==null){const o=this.startHeight,a=this.deltaHeight;this.parent.fitHeight(o+a*r,this.keepCenter,this.width===null)}if(this.width===null?this.parent.scale.x=this.parent.scale.y:this.height===null&&(this.parent.scale.y=this.parent.scale.x),!this.keepCenter){const o=this.startX,a=this.startY,h=this.deltaX,u=this.deltaY,p=new ve(this.parent.x,this.parent.y);this.parent.moveCenter(o+h*r,a+u*r),this.parent.emit("moved",{viewport:this.parent,original:p,type:"animate"})}(this.width||this.height)&&this.parent.emit("zoomed",{viewport:this.parent,original:s,type:"animate"})}}}const DU={sides:"all",friction:.5,time:150,ease:"easeInOutSine",underflow:"center",bounceBox:null};let BU=class extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},DU,s),this.ease=$h(this.options.ease,"easeInOutSine"),this.options.sides?this.options.sides==="all"?this.top=this.bottom=this.left=this.right=!0:this.options.sides==="horizontal"?(this.right=this.left=!0,this.top=this.bottom=!1):this.options.sides==="vertical"?(this.left=this.right=!1,this.top=this.bottom=!0):(this.top=this.options.sides.indexOf("top")!==-1,this.bottom=this.options.sides.indexOf("bottom")!==-1,this.left=this.options.sides.indexOf("left")!==-1,this.right=this.options.sides.indexOf("right")!==-1):this.left=this.top=this.right=this.bottom=!1;const r=this.options.underflow.toLowerCase();r==="center"?(this.underflowX=0,this.underflowY=0):(this.underflowX=r.indexOf("left")!==-1?-1:r.indexOf("right")!==-1?1:0,this.underflowY=r.indexOf("top")!==-1?-1:r.indexOf("bottom")!==-1?1:0),this.reset()}isActive(){return this.toX!==null||this.toY!==null}down(){return this.toX=this.toY=null,!1}up(){return this.bounce(),!1}update(t){if(!this.paused){if(this.bounce(),this.toX){const s=this.toX;s.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-x"}),s.time>=this.options.time?(this.parent.x=s.end,this.toX=null,this.parent.emit("bounce-x-end",this.parent)):this.parent.x=this.ease(s.time,s.start,s.delta,this.options.time)}if(this.toY){const s=this.toY;s.time+=t,this.parent.emit("moved",{viewport:this.parent,type:"bounce-y"}),s.time>=this.options.time?(this.parent.y=s.end,this.toY=null,this.parent.emit("bounce-y-end",this.parent)):this.parent.y=this.ease(s.time,s.start,s.delta,this.options.time)}}}calcUnderflowX(){let t;switch(this.underflowX){case-1:t=0;break;case 1:t=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:t=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}return t}calcUnderflowY(){let t;switch(this.underflowY){case-1:t=0;break;case 1:t=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:t=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}return t}oob(){const t=this.options.bounceBox;if(t){const s=typeof t.x>"u"?0:t.x,r=typeof t.y>"u"?0:t.y,o=typeof t.width>"u"?this.parent.worldWidth:t.width,a=typeof t.height>"u"?this.parent.worldHeight:t.height;return{left:this.parent.left<s,right:this.parent.right>o,top:this.parent.top<r,bottom:this.parent.bottom>a,topLeft:new ve(s*this.parent.scale.x,r*this.parent.scale.y),bottomRight:new ve(o*this.parent.scale.x-this.parent.screenWidth,a*this.parent.scale.y-this.parent.screenHeight)}}return{left:this.parent.left<0,right:this.parent.right>this.parent.worldWidth,top:this.parent.top<0,bottom:this.parent.bottom>this.parent.worldHeight,topLeft:new ve(0,0),bottomRight:new ve(this.parent.worldWidth*this.parent.scale.x-this.parent.screenWidth,this.parent.worldHeight*this.parent.scale.y-this.parent.screenHeight)}}bounce(){var t,s;if(this.paused)return;let r,o=this.parent.plugins.get("decelerate",!0);o&&(o.x||o.y)&&(o.x&&o.percentChangeX===((t=o.options)==null?void 0:t.friction)||o.y&&o.percentChangeY===((s=o.options)==null?void 0:s.friction))&&(r=this.oob(),(r.left&&this.left||r.right&&this.right)&&(o.percentChangeX=this.options.friction),(r.top&&this.top||r.bottom&&this.bottom)&&(o.percentChangeY=this.options.friction));const a=this.parent.plugins.get("drag",!0)||{},h=this.parent.plugins.get("pinch",!0)||{};if(o=o||{},!(a!=null&&a.active)&&!(h!=null&&h.active)&&(!this.toX||!this.toY)&&(!o.x||!o.y)){r=r||this.oob();const u=r.topLeft,p=r.bottomRight;if(!this.toX&&!o.x){let f=null;r.left&&this.left?f=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-u.x:r.right&&this.right&&(f=this.parent.screenWorldWidth<this.parent.screenWidth?this.calcUnderflowX():-p.x),f!==null&&this.parent.x!==f&&(this.toX={time:0,start:this.parent.x,delta:f-this.parent.x,end:f},this.parent.emit("bounce-x-start",this.parent))}if(!this.toY&&!o.y){let f=null;r.top&&this.top?f=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-u.y:r.bottom&&this.bottom&&(f=this.parent.screenWorldHeight<this.parent.screenHeight?this.calcUnderflowY():-p.y),f!==null&&this.parent.y!==f&&(this.toY={time:0,start:this.parent.y,delta:f-this.parent.y,end:f},this.parent.emit("bounce-y-start",this.parent))}}}reset(){this.toX=this.toY=null,this.bounce()}};const FU={left:!1,right:!1,top:!1,bottom:!1,direction:null,underflow:"center"};class UU extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},FU,s),this.options.direction&&(this.options.left=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.right=this.options.direction==="x"||this.options.direction==="all"?!0:null,this.options.top=this.options.direction==="y"||this.options.direction==="all"?!0:null,this.options.bottom=this.options.direction==="y"||this.options.direction==="all"?!0:null),this.parseUnderflow(),this.last={x:null,y:null,scaleX:null,scaleY:null},this.update()}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="none"?this.noUnderflow=!0:t==="center"?(this.underflowX=this.underflowY=0,this.noUnderflow=!1):(this.underflowX=t.indexOf("left")!==-1?-1:t.indexOf("right")!==-1?1:0,this.underflowY=t.indexOf("top")!==-1?-1:t.indexOf("bottom")!==-1?1:0,this.noUnderflow=!1)}move(){return this.update(),!1}update(){if(this.paused||this.parent.x===this.last.x&&this.parent.y===this.last.y&&this.parent.scale.x===this.last.scaleX&&this.parent.scale.y===this.last.scaleY)return;const t=new ve(this.parent.x,this.parent.y),s=this.parent.plugins.decelerate||{};if(this.options.left!==null||this.options.right!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x!==0&&(this.parent.x=0,r=!0);break;case 1:this.parent.x!==this.parent.screenWidth-this.parent.screenWorldWidth&&(this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth,r=!0);break;default:this.parent.x!==(this.parent.screenWidth-this.parent.screenWorldWidth)/2&&(this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2,r=!0)}else this.options.left!==null&&this.parent.left<(this.options.left===!0?0:this.options.left)&&(this.parent.x=-(this.options.left===!0?0:this.options.left)*this.parent.scale.x,s.x=0,r=!0),this.options.right!==null&&this.parent.right>(this.options.right===!0?this.parent.worldWidth:this.options.right)&&(this.parent.x=-(this.options.right===!0?this.parent.worldWidth:this.options.right)*this.parent.scale.x+this.parent.screenWidth,s.x=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-x"})}if(this.options.top!==null||this.options.bottom!==null){let r=!1;if(!this.noUnderflow&&this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y!==0&&(this.parent.y=0,r=!0);break;case 1:this.parent.y!==this.parent.screenHeight-this.parent.screenWorldHeight&&(this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight,r=!0);break;default:this.parent.y!==(this.parent.screenHeight-this.parent.screenWorldHeight)/2&&(this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2,r=!0)}else this.options.top!==null&&this.parent.top<(this.options.top===!0?0:this.options.top)&&(this.parent.y=-(this.options.top===!0?0:this.options.top)*this.parent.scale.y,s.y=0,r=!0),this.options.bottom!==null&&this.parent.bottom>(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)&&(this.parent.y=-(this.options.bottom===!0?this.parent.worldHeight:this.options.bottom)*this.parent.scale.y+this.parent.screenHeight,s.y=0,r=!0);r&&this.parent.emit("moved",{viewport:this.parent,original:t,type:"clamp-y"})}this.last.x=this.parent.x,this.last.y=this.parent.y,this.last.scaleX=this.parent.scale.x,this.last.scaleY=this.parent.scale.y}reset(){this.update()}}const GU={minWidth:null,minHeight:null,maxWidth:null,maxHeight:null,minScale:null,maxScale:null};let HU=class extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},GU,s),this.clamp()}resize(){this.clamp()}clamp(){if(!this.paused){if(this.options.minWidth||this.options.minHeight||this.options.maxWidth||this.options.maxHeight){let t=this.parent.worldScreenWidth,s=this.parent.worldScreenHeight;if(this.options.minWidth!==null&&t<this.options.minWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.minWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,s=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxWidth!==null&&t>this.options.maxWidth){const r=this.parent.scale.x;this.parent.fitWidth(this.options.maxWidth,!1,!1,!0),this.parent.scale.y*=this.parent.scale.x/r,t=this.parent.worldScreenWidth,s=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.minHeight!==null&&s<this.options.minHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.minHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,t=this.parent.worldScreenWidth,s=this.parent.worldScreenHeight,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}if(this.options.maxHeight!==null&&s>this.options.maxHeight){const r=this.parent.scale.y;this.parent.fitHeight(this.options.maxHeight,!1,!1,!0),this.parent.scale.x*=this.parent.scale.y/r,this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"})}}else if(this.options.minScale||this.options.maxScale){const t={x:null,y:null},s={x:null,y:null};if(typeof this.options.minScale=="number")t.x=this.options.minScale,t.y=this.options.minScale;else if(this.options.minScale!==null){const a=this.options.minScale;t.x=typeof a.x>"u"?null:a.x,t.y=typeof a.y>"u"?null:a.y}if(typeof this.options.maxScale=="number")s.x=this.options.maxScale,s.y=this.options.maxScale;else if(this.options.maxScale!==null){const a=this.options.maxScale;s.x=typeof a.x>"u"?null:a.x,s.y=typeof a.y>"u"?null:a.y}let r=this.parent.scale.x,o=this.parent.scale.y;t.x!==null&&r<t.x&&(r=t.x),s.x!==null&&r>s.x&&(r=s.x),t.y!==null&&o<t.y&&(o=t.y),s.y!==null&&o>s.y&&(o=s.y),(r!==this.parent.scale.x||o!==this.parent.scale.y)&&(this.parent.scale.set(r,o),this.parent.emit("zoomed",{viewport:this.parent,type:"clamp-zoom"}))}}}reset(){this.clamp()}};const VU={friction:.98,bounce:.8,minSpeed:.01},gr=16;let WU=class extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},VU,s),this.saved=[],this.timeSinceRelease=0,this.reset(),this.parent.on("moved",r=>this.handleMoved(r))}down(){return this.saved=[],this.x=this.y=null,!1}isActive(){return!!(this.x||this.y)}move(){if(this.paused)return!1;const t=this.parent.input.count();return(t===1||t>1&&!this.parent.plugins.get("pinch",!0))&&(this.saved.push({x:this.parent.x,y:this.parent.y,time:performance.now()}),this.saved.length>60&&this.saved.splice(0,30)),!1}handleMoved(t){if(this.saved.length){const s=this.saved[this.saved.length-1];t.type==="clamp-x"&&t.original?s.x===t.original.x&&(s.x=this.parent.x):t.type==="clamp-y"&&t.original&&s.y===t.original.y&&(s.y=this.parent.y)}}up(){if(this.parent.input.count()===0&&this.saved.length){const t=performance.now();for(const s of this.saved)if(s.time>=t-100){const r=t-s.time;this.x=(this.parent.x-s.x)/r,this.y=(this.parent.y-s.y)/r,this.percentChangeX=this.percentChangeY=this.options.friction,this.timeSinceRelease=0;break}}return!1}activate(t){t=t||{},typeof t.x<"u"&&(this.x=t.x,this.percentChangeX=this.options.friction),typeof t.y<"u"&&(this.y=t.y,this.percentChangeY=this.options.friction)}update(t){if(this.paused)return;const s=this.x||this.y,r=this.timeSinceRelease,o=this.timeSinceRelease+t;if(this.x){const a=this.percentChangeX,h=Math.log(a);this.parent.x+=this.x*gr/h*(Math.pow(a,o/gr)-Math.pow(a,r/gr)),this.x*=Math.pow(this.percentChangeX,t/gr)}if(this.y){const a=this.percentChangeY,h=Math.log(a);this.parent.y+=this.y*gr/h*(Math.pow(a,o/gr)-Math.pow(a,r/gr)),this.y*=Math.pow(this.percentChangeY,t/gr)}this.timeSinceRelease+=t,this.x&&this.y?Math.abs(this.x)<this.options.minSpeed&&Math.abs(this.y)<this.options.minSpeed&&(this.x=0,this.y=0):(Math.abs(this.x||0)<this.options.minSpeed&&(this.x=0),Math.abs(this.y||0)<this.options.minSpeed&&(this.y=0)),s&&this.parent.emit("moved",{viewport:this.parent,type:"decelerate"})}reset(){this.x=this.y=null}};const zU={direction:"all",pressDrag:!0,wheel:!0,wheelScroll:1,reverse:!1,clampWheel:!1,underflow:"center",factor:1,mouseButtons:"all",keyToPress:null,ignoreKeyToPressOnTouch:!1,lineHeight:20,wheelSwapAxes:!1};let XU=class extends Bs{constructor(t,s={}){super(t),this.windowEventHandlers=[],this.options=Object.assign({},zU,s),this.moved=!1,this.reverse=this.options.reverse?1:-1,this.xDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="x",this.yDirection=!this.options.direction||this.options.direction==="all"||this.options.direction==="y",this.keyIsPressed=!1,this.parseUnderflow(),this.mouseButtons(this.options.mouseButtons),this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){const s=o=>{t.includes(o.code)&&(this.keyIsPressed=!0)},r=o=>{t.includes(o.code)&&(this.keyIsPressed=!1)};this.addWindowEventHandler("keyup",r),this.addWindowEventHandler("keydown",s)}addWindowEventHandler(t,s){typeof window>"u"||(window.addEventListener(t,s),this.windowEventHandlers.push({event:t,handler:s}))}destroy(){typeof window>"u"||this.windowEventHandlers.forEach(({event:t,handler:s})=>{window.removeEventListener(t,s)})}mouseButtons(t){!t||t==="all"?this.mouse=[!0,!0,!0]:this.mouse=[t.indexOf("left")!==-1,t.indexOf("middle")!==-1,t.indexOf("right")!==-1]}parseUnderflow(){const t=this.options.underflow.toLowerCase();t==="center"?(this.underflowX=0,this.underflowY=0):(t.includes("left")?this.underflowX=-1:t.includes("right")?this.underflowX=1:this.underflowX=0,t.includes("top")?this.underflowY=-1:t.includes("bottom")?this.underflowY=1:this.underflowY=0)}checkButtons(t){const s=t.pointerType==="mouse",r=this.parent.input.count();return!!((r===1||r>1&&!this.parent.plugins.get("pinch",!0))&&(!s||this.mouse[t.button]))}checkKeyPress(t){return!this.options.keyToPress||this.keyIsPressed||this.options.ignoreKeyToPressOnTouch&&t.data.pointerType==="touch"}down(t){return this.paused||!this.options.pressDrag?!1:this.checkButtons(t)&&this.checkKeyPress(t)?(this.last={x:t.global.x,y:t.global.y},(this.parent.parent||this.parent).toLocal(this.last,void 0,this.last),this.current=t.pointerId,!0):(this.last=null,!1)}get active(){return this.moved}move(t){if(this.paused||!this.options.pressDrag)return!1;if(this.last&&this.current===t.data.pointerId){const s=t.global.x,r=t.global.y,o=this.parent.input.count();if(o===1||o>1&&!this.parent.plugins.get("pinch",!0)){const a={x:s,y:r};(this.parent.parent||this.parent).toLocal(a,void 0,a);const h=a.x-this.last.x,u=a.y-this.last.y;if(this.moved||this.xDirection&&this.parent.input.checkThreshold(h)||this.yDirection&&this.parent.input.checkThreshold(u))return this.xDirection&&(this.parent.x+=(a.x-this.last.x)*this.options.factor),this.yDirection&&(this.parent.y+=(a.y-this.last.y)*this.options.factor),this.last=a,this.moved||this.parent.emit("drag-start",{event:t,screen:new ve(this.last.x,this.last.y),world:this.parent.toWorld(new ve(this.last.x,this.last.y)),viewport:this.parent}),this.moved=!0,this.parent.emit("moved",{viewport:this.parent,type:"drag"}),!0}else this.moved=!1}return!1}up(t){if(this.paused)return!1;const s=this.parent.input.touches;if(s.length===1){const r=s[0];return r.last&&(this.last={x:r.last.x,y:r.last.y},this.current=r.id),this.moved=!1,!0}else if(this.last&&this.moved){const r=new ve(this.last.x,this.last.y);return(this.parent.parent||this.parent).toGlobal(r,r,!0),this.parent.emit("drag-end",{event:t,screen:r,world:this.parent.toWorld(r),viewport:this.parent}),this.last=null,this.moved=!1,!0}return!1}wheel(t){if(this.paused)return!1;if(this.options.wheel){const s=this.parent.plugins.get("wheel",!0);if(!s||!s.options.wheelZoom&&!t.ctrlKey){const r=t.deltaMode?this.options.lineHeight:1,o=[t.deltaX,t.deltaY],[a,h]=this.options.wheelSwapAxes?o.reverse():o;return this.xDirection&&(this.parent.x+=a*r*this.options.wheelScroll*this.reverse),this.yDirection&&(this.parent.y+=h*r*this.options.wheelScroll*this.reverse),this.options.clampWheel&&this.clamp(),this.parent.emit("wheel-scroll",this.parent),this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.options.passiveWheel||t.preventDefault(),this.parent.options.stopPropagation&&t.stopPropagation(),!0}}return!1}resume(){this.last=null,this.paused=!1}clamp(){const t=this.parent.plugins.get("decelerate",!0)||{};if(this.options.clampWheel!=="y")if(this.parent.screenWorldWidth<this.parent.screenWidth)switch(this.underflowX){case-1:this.parent.x=0;break;case 1:this.parent.x=this.parent.screenWidth-this.parent.screenWorldWidth;break;default:this.parent.x=(this.parent.screenWidth-this.parent.screenWorldWidth)/2}else this.parent.left<0?(this.parent.x=0,t.x=0):this.parent.right>this.parent.worldWidth&&(this.parent.x=-this.parent.worldWidth*this.parent.scale.x+this.parent.screenWidth,t.x=0);if(this.options.clampWheel!=="x")if(this.parent.screenWorldHeight<this.parent.screenHeight)switch(this.underflowY){case-1:this.parent.y=0;break;case 1:this.parent.y=this.parent.screenHeight-this.parent.screenWorldHeight;break;default:this.parent.y=(this.parent.screenHeight-this.parent.screenWorldHeight)/2}else this.parent.top<0&&(this.parent.y=0,t.y=0),this.parent.bottom>this.parent.worldHeight&&(this.parent.y=-this.parent.worldHeight*this.parent.scale.y+this.parent.screenHeight,t.y=0)}};const YU={speed:0,acceleration:null,radius:null};let KU=class extends Bs{constructor(t,s,r={}){super(t),this.target=s,this.options=Object.assign({},YU,r),this.velocity={x:0,y:0}}update(t){if(this.paused)return;const s=this.parent.center;let r=this.target.x,o=this.target.y;if(this.options.radius)if(Math.sqrt(Math.pow(this.target.y-s.y,2)+Math.pow(this.target.x-s.x,2))>this.options.radius){const u=Math.atan2(this.target.y-s.y,this.target.x-s.x);r=this.target.x-Math.cos(u)*this.options.radius,o=this.target.y-Math.sin(u)*this.options.radius}else return;const a=r-s.x,h=o-s.y;if(a||h)if(this.options.speed)if(this.options.acceleration){const u=Math.atan2(o-s.y,r-s.x),p=Math.sqrt(Math.pow(a,2)+Math.pow(h,2));if(p){const f=(Math.pow(this.velocity.x,2)+Math.pow(this.velocity.y,2))/(2*this.options.acceleration);p>f?this.velocity={x:Math.min(this.velocity.x+(this.options.acceleration*t,this.options.speed)),y:Math.min(this.velocity.y+(this.options.acceleration*t,this.options.speed))}:this.velocity={x:Math.max(this.velocity.x-this.options.acceleration*this.options.speed,0),y:Math.max(this.velocity.y-this.options.acceleration*this.options.speed,0)};const g=Math.cos(u)*this.velocity.x,_=Math.sin(u)*this.velocity.y,$=Math.abs(g)>Math.abs(a)?r:s.x+g,E=Math.abs(_)>Math.abs(h)?o:s.y+_;this.parent.moveCenter($,E),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}}else{const u=Math.atan2(o-s.y,r-s.x),p=Math.cos(u)*this.options.speed,f=Math.sin(u)*this.options.speed,g=Math.abs(p)>Math.abs(a)?r:s.x+p,_=Math.abs(f)>Math.abs(h)?o:s.y+f;this.parent.moveCenter(g,_),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}else this.parent.moveCenter(r,o),this.parent.emit("moved",{viewport:this.parent,type:"follow"})}};const jU={radius:null,distance:null,top:null,bottom:null,left:null,right:null,speed:8,reverse:!1,noDecelerate:!1,linear:!1,allowButtons:!1};let qU=class extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},jU,s),this.reverse=this.options.reverse?1:-1,this.radiusSquared=typeof this.options.radius=="number"?Math.pow(this.options.radius,2):null,this.resize()}resize(){const t=this.options.distance;t!==null?(this.left=t,this.top=t,this.right=this.parent.screenWidth-t,this.bottom=this.parent.screenHeight-t):this.options.radius||(this.left=this.options.left,this.top=this.options.top,this.right=this.options.right===null?null:this.parent.screenWidth-this.options.right,this.bottom=this.options.bottom===null?null:this.parent.screenHeight-this.options.bottom)}down(){return this.paused||this.options.allowButtons||(this.horizontal=this.vertical=null),!1}move(t){if(this.paused||t.pointerType!=="mouse"&&t.pointerId!==1||!this.options.allowButtons&&t.buttons!==0)return!1;const s=t.global.x,r=t.global.y;if(this.radiusSquared){const o=this.parent.toScreen(this.parent.center);if(Math.pow(o.x-s,2)+Math.pow(o.y-r,2)>=this.radiusSquared){const a=Math.atan2(o.y-r,o.x-s);this.options.linear?(this.horizontal=Math.round(Math.cos(a))*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.round(Math.sin(a))*this.options.speed*this.reverse*(60/1e3)):(this.horizontal=Math.cos(a)*this.options.speed*this.reverse*(60/1e3),this.vertical=Math.sin(a)*this.options.speed*this.reverse*(60/1e3))}else this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=0}else this.left!==null&&s<this.left?this.horizontal=Number(this.reverse)*this.options.speed*(60/1e3):this.right!==null&&s>this.right?this.horizontal=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateHorizontal(),this.horizontal=0),this.top!==null&&r<this.top?this.vertical=Number(this.reverse)*this.options.speed*(60/1e3):this.bottom!==null&&r>this.bottom?this.vertical=-1*this.reverse*this.options.speed*(60/1e3):(this.decelerateVertical(),this.vertical=0);return!1}decelerateHorizontal(){const t=this.parent.plugins.get("decelerate",!0);this.horizontal&&t&&!this.options.noDecelerate&&t.activate({x:this.horizontal*this.options.speed*this.reverse/(1e3/60)})}decelerateVertical(){const t=this.parent.plugins.get("decelerate",!0);this.vertical&&t&&!this.options.noDecelerate&&t.activate({y:this.vertical*this.options.speed*this.reverse/(1e3/60)})}up(){return this.paused||(this.horizontal&&this.decelerateHorizontal(),this.vertical&&this.decelerateVertical(),this.horizontal=this.vertical=null),!1}update(){if(!this.paused&&(this.horizontal||this.vertical)){const t=this.parent.center;this.horizontal&&(t.x+=this.horizontal*this.options.speed),this.vertical&&(t.y+=this.vertical*this.options.speed),this.parent.moveCenter(t),this.parent.emit("moved",{viewport:this.parent,type:"mouse-edges"})}}};const JU={noDrag:!1,percent:1,center:null,factor:1,axis:"all"},ZU=new ve;let QU=class extends Bs{constructor(t,s={}){super(t),this.active=!1,this.pinching=!1,this.moved=!1,this.options=Object.assign({},JU,s)}down(){return this.parent.input.count()>=2?(this.active=!0,!0):!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}move(t){if(this.paused||!this.active)return!1;const{x:s,y:r}=(this.parent.parent||this.parent).toLocal(t.global,void 0,ZU),o=this.parent.input.touches;if(o.length>=2){const a=o[0],h=o[1],u=a.last&&h.last?Math.sqrt(Math.pow(h.last.x-a.last.x,2)+Math.pow(h.last.y-a.last.y,2)):null;if(a.id===t.pointerId?a.last={x:s,y:r,data:t}:h.id===t.pointerId&&(h.last={x:s,y:r,data:t}),u){let p;const f=new ve(a.last.x+(h.last.x-a.last.x)/2,a.last.y+(h.last.y-a.last.y)/2);this.options.center||(p=this.parent.toLocal(f,this.parent.parent||this.parent));let g=Math.sqrt(Math.pow(h.last.x-a.last.x,2)+Math.pow(h.last.y-a.last.y,2));g=g===0?g=1e-10:g;const _=(1-u/g)*this.options.percent*(this.isAxisX()?this.parent.scale.x:this.parent.scale.y);this.isAxisX()&&(this.parent.scale.x+=_),this.isAxisY()&&(this.parent.scale.y+=_),this.parent.emit("zoomed",{viewport:this.parent,type:"pinch",center:f});const $=this.parent.plugins.get("clamp-zoom",!0);if($&&$.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const E=(this.parent.parent||this.parent).toLocal(p,this.parent);this.parent.x+=(f.x-E.x)*this.options.factor,this.parent.y+=(f.y-E.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})}!this.options.noDrag&&this.lastCenter&&(this.parent.x+=(f.x-this.lastCenter.x)*this.options.factor,this.parent.y+=(f.y-this.lastCenter.y)*this.options.factor,this.parent.emit("moved",{viewport:this.parent,type:"pinch"})),this.lastCenter=f,this.moved=!0}else this.pinching||(this.parent.emit("pinch-start",this.parent),this.pinching=!0);return!0}return!1}up(){return this.pinching&&this.parent.input.touches.length<=1?(this.active=!1,this.lastCenter=null,this.pinching=!1,this.moved=!1,this.parent.emit("pinch-end",this.parent),!0):!1}};const eG={topLeft:!1,friction:.8,time:1e3,ease:"easeInOutSine",interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1};let tG=class extends Bs{constructor(t,s,r,o={}){super(t),this.options=Object.assign({},eG,o),this.ease=$h(o.ease,"easeInOutSine"),this.x=s,this.y=r,this.options.forceStart&&this.snapStart()}snapStart(){this.percent=0,this.snapping={time:0};const t=this.options.topLeft?this.parent.corner:this.parent.center;this.deltaX=this.x-t.x,this.deltaY=this.y-t.y,this.startX=t.x,this.startY=t.y,this.parent.emit("snap-start",this.parent)}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap"):this.options.interrupt&&(this.snapping=null),!1}up(){if(this.parent.input.count()===0){const t=this.parent.plugins.get("decelerate",!0);t&&(t.x||t.y)&&(t.percentChangeX=t.percentChangeY=this.options.friction)}return!1}update(t){if(!this.paused&&!(this.options.interrupt&&this.parent.input.count()!==0))if(this.snapping){const s=this.snapping;s.time+=t;let r,o,a;const h=this.startX,u=this.startY,p=this.deltaX,f=this.deltaY;if(s.time>this.options.time)r=!0,o=h+p,a=u+f;else{const g=this.ease(s.time,0,1,this.options.time);o=h+p*g,a=u+f*g}this.options.topLeft?this.parent.moveCorner(o,a):this.parent.moveCenter(o,a),this.parent.emit("moved",{viewport:this.parent,type:"snap"}),r&&(this.options.removeOnComplete&&this.parent.plugins.remove("snap"),this.parent.emit("snap-end",this.parent),this.snapping=null)}else{const s=this.options.topLeft?this.parent.corner:this.parent.center;(s.x!==this.x||s.y!==this.y)&&this.snapStart()}}};const sG={width:0,height:0,time:1e3,ease:"easeInOutSine",center:null,interrupt:!0,removeOnComplete:!1,removeOnInterrupt:!1,forceStart:!1,noMove:!1};class iG extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},sG,s),this.ease=$h(this.options.ease),this.xIndependent=!1,this.yIndependent=!1,this.xScale=0,this.yScale=0,this.options.width>0&&(this.xScale=t.screenWidth/this.options.width,this.xIndependent=!0),this.options.height>0&&(this.yScale=t.screenHeight/this.options.height,this.yIndependent=!0),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale,this.options.time===0?(t.container.scale.x=this.xScale,t.container.scale.y=this.yScale,this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom")):s.forceStart&&this.createSnapping()}createSnapping(){const t=this.parent.worldScreenWidth,s=this.parent.worldScreenHeight,r=this.parent.screenWidth/this.xScale,o=this.parent.screenHeight/this.yScale;this.snapping={time:0,startX:t,startY:s,deltaX:r-t,deltaY:o-s},this.parent.emit("snap-zoom-start",this.parent)}resize(){this.snapping=null,this.options.width>0&&(this.xScale=this.parent.screenWidth/this.options.width),this.options.height>0&&(this.yScale=this.parent.screenHeight/this.options.height),this.xScale=this.xIndependent?this.xScale:this.yScale,this.yScale=this.yIndependent?this.yScale:this.xScale}wheel(){return this.options.removeOnInterrupt&&this.parent.plugins.remove("snap-zoom"),!1}down(){return this.options.removeOnInterrupt?this.parent.plugins.remove("snap-zoom"):this.options.interrupt&&(this.snapping=null),!1}update(t){if(this.paused||this.options.interrupt&&this.parent.input.count()!==0)return;let s;if(!this.options.center&&!this.options.noMove&&(s=this.parent.center),!this.snapping)(this.parent.scale.x!==this.xScale||this.parent.scale.y!==this.yScale)&&this.createSnapping();else if(this.snapping){const r=this.snapping;if(r.time+=t,r.time>=this.options.time)this.parent.scale.set(this.xScale,this.yScale),this.options.removeOnComplete&&this.parent.plugins.remove("snap-zoom"),this.parent.emit("snap-zoom-end",this.parent),this.snapping=null;else{const a=this.snapping,h=this.ease(a.time,a.startX,a.deltaX,this.options.time),u=this.ease(a.time,a.startY,a.deltaY,this.options.time);this.parent.scale.x=this.parent.screenWidth/h,this.parent.scale.y=this.parent.screenHeight/u}const o=this.parent.plugins.get("clamp-zoom",!0);o&&o.clamp(),this.options.noMove||(this.options.center?this.parent.moveCenter(this.options.center):this.parent.moveCenter(s))}}resume(){this.snapping=null,super.resume()}}const rG={percent:.1,smooth:!1,interrupt:!0,reverse:!1,center:null,lineHeight:20,axis:"all",keyToPress:null,trackpadPinch:!1,wheelZoom:!0};let nG=class extends Bs{constructor(t,s={}){super(t),this.options=Object.assign({},rG,s),this.keyIsPressed=!1,this.options.keyToPress&&this.handleKeyPresses(this.options.keyToPress)}handleKeyPresses(t){typeof window>"u"||(window.addEventListener("keydown",s=>{t.includes(s.code)&&(this.keyIsPressed=!0)}),window.addEventListener("keyup",s=>{t.includes(s.code)&&(this.keyIsPressed=!1)}))}checkKeyPress(){return!this.options.keyToPress||this.keyIsPressed}down(){return this.options.interrupt&&(this.smoothing=null),!1}isAxisX(){return["all","x"].includes(this.options.axis)}isAxisY(){return["all","y"].includes(this.options.axis)}update(){if(this.smoothing){const t=this.smoothingCenter,s=this.smoothing;let r;this.options.center||(r=this.parent.toLocal(t)),this.isAxisX()&&(this.parent.scale.x+=s.x),this.isAxisY()&&(this.parent.scale.y+=s.y),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const o=this.parent.plugins.get("clamp-zoom",!0);if(o&&o.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const a=this.parent.parent||this.parent;a.toLocal(r,this.parent,r);const h=a.toLocal(t);this.parent.x+=h.x-r.x,this.parent.y+=h.y-r.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.smoothingCount++,typeof this.options.smooth=="number"&&this.smoothingCount>=this.options.smooth&&(this.smoothing=null)}}pinch(t){if(this.paused)return;const s=this.parent.input.getPointerPosition(t),r=-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/200,o=Math.pow(2,(1+this.options.percent)*r);let a;this.options.center||(a=this.parent.toLocal(s)),this.isAxisX()&&(this.parent.scale.x*=o),this.isAxisY()&&(this.parent.scale.y*=o),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const h=this.parent.plugins.get("clamp-zoom",!0);if(h&&h.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const u=this.parent.parent||this.parent;u.toLocal(a,this.parent,a);const p=u.toLocal(s);this.parent.x+=p.x-a.x,this.parent.y+=p.y-a.y}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}wheel(t){if(this.paused||!this.checkKeyPress())return!1;if(t.ctrlKey&&this.options.trackpadPinch)this.pinch(t);else if(this.options.wheelZoom){const s=this.parent.input.getPointerPosition(t),r=(this.options.reverse?-1:1)*-t.deltaY*(t.deltaMode?this.options.lineHeight:1)/500,o=Math.pow(2,(1+this.options.percent)*r);if(this.options.smooth){const a={x:this.smoothing?this.smoothing.x*(this.options.smooth-this.smoothingCount):0,y:this.smoothing?this.smoothing.y*(this.options.smooth-this.smoothingCount):0};this.smoothing={x:((this.parent.scale.x+a.x)*o-this.parent.scale.x)/this.options.smooth,y:((this.parent.scale.y+a.y)*o-this.parent.scale.y)/this.options.smooth},this.smoothingCount=0,this.smoothingCenter=s}else{let a;this.options.center||(a=this.parent.toLocal(s)),this.isAxisX()&&(this.parent.scale.x*=o),this.isAxisY()&&(this.parent.scale.y*=o),this.parent.emit("zoomed",{viewport:this.parent,type:"wheel"});const h=this.parent.plugins.get("clamp-zoom",!0);if(h&&h.clamp(),this.options.center)this.parent.moveCenter(this.options.center);else{const u=this.parent.parent||this.parent;u.toLocal(a,this.parent,a);const p=u.toLocal(s);this.parent.x+=p.x-a.x,this.parent.y+=p.y-a.y}}this.parent.emit("moved",{viewport:this.parent,type:"wheel"}),this.parent.emit("wheel-start",{event:t,viewport:this.parent})}return!this.parent.options.passiveWheel}};const oG={screenWidth:typeof window>"u"?0:window.innerWidth,screenHeight:typeof window>"u"?0:window.innerHeight,worldWidth:null,worldHeight:null,threshold:5,passiveWheel:!0,stopPropagation:!1,forceHitArea:null,noTicker:!1,disableOnContextMenu:!1,ticker:Qs.shared,allowPreserveDragOutside:!1};class lG extends Nt{constructor(t){super(),this._disableOnContextMenu=s=>s.preventDefault(),this.options={...oG,...t},this.screenWidth=this.options.screenWidth,this.screenHeight=this.options.screenHeight,this._worldWidth=this.options.worldWidth,this._worldHeight=this.options.worldHeight,this.forceHitArea=this.options.forceHitArea,this.threshold=this.options.threshold,this.options.disableOnContextMenu&&this.options.events.domElement.addEventListener("contextmenu",this._disableOnContextMenu),this.options.noTicker||(this.tickerFunction=()=>this.update(this.options.ticker.elapsedMS),this.options.ticker.add(this.tickerFunction)),this.input=new MU(this),this.plugins=new LU(this)}destroy(t){var s;!this.options.noTicker&&this.tickerFunction&&this.options.ticker.remove(this.tickerFunction),this.options.disableOnContextMenu&&((s=this.options.events.domElement)==null||s.removeEventListener("contextmenu",this._disableOnContextMenu)),this.input.destroy(),super.destroy(t)}update(t){this.pause||(this.plugins.update(t),this.lastViewport&&(this.lastViewport.x!==this.x||this.lastViewport.y!==this.y?this.moving=!0:this.moving&&(this.emit("moved-end",this),this.moving=!1),this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y?this.zooming=!0:this.zooming&&(this.emit("zoomed-end",this),this.zooming=!1)),this.forceHitArea||(this._hitAreaDefault=new Fe(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight),this.hitArea=this._hitAreaDefault),this._dirty=this._dirty||!this.lastViewport||this.lastViewport.x!==this.x||this.lastViewport.y!==this.y||this.lastViewport.scaleX!==this.scale.x||this.lastViewport.scaleY!==this.scale.y,this.lastViewport={x:this.x,y:this.y,scaleX:this.scale.x,scaleY:this.scale.y},this.emit("frame-end",this))}resize(t=typeof window>"u"?0:window.innerWidth,s=typeof window>"u"?0:window.innerHeight,r,o){this.screenWidth=t,this.screenHeight=s,typeof r<"u"&&(this._worldWidth=r),typeof o<"u"&&(this._worldHeight=o),this.plugins.resize(),this.dirty=!0}get worldWidth(){return this._worldWidth?this._worldWidth:this.width/this.scale.x}set worldWidth(t){this._worldWidth=t,this.plugins.resize()}get worldHeight(){return this._worldHeight?this._worldHeight:this.height/this.scale.y}set worldHeight(t){this._worldHeight=t,this.plugins.resize()}getVisibleBounds(){return new Fe(this.left,this.top,this.worldScreenWidth,this.worldScreenHeight)}toWorld(t,s){return arguments.length===2?this.toLocal(new ve(t,s)):this.toLocal(t)}toScreen(t,s){return arguments.length===2?this.toGlobal(new ve(t,s)):this.toGlobal(t)}get worldScreenWidth(){return this.screenWidth/this.scale.x}get worldScreenHeight(){return this.screenHeight/this.scale.y}get screenWorldWidth(){return this.worldWidth*this.scale.x}get screenWorldHeight(){return this.worldHeight*this.scale.y}get center(){return new ve(this.worldScreenWidth/2-this.x/this.scale.x,this.worldScreenHeight/2-this.y/this.scale.y)}set center(t){this.moveCenter(t)}moveCenter(...t){let s,r;typeof t[0]=="number"?(s=t[0],r=t[1]):(s=t[0].x,r=t[0].y);const o=(this.worldScreenWidth/2-s)*this.scale.x,a=(this.worldScreenHeight/2-r)*this.scale.y;return(this.x!==o||this.y!==a)&&(this.position.set(o,a),this.plugins.reset(),this.dirty=!0),this}get corner(){return new ve(-this.x/this.scale.x,-this.y/this.scale.y)}set corner(t){this.moveCorner(t)}moveCorner(...t){let s,r;return t.length===1?(s=-t[0].x*this.scale.x,r=-t[0].y*this.scale.y):(s=-t[0]*this.scale.x,r=-t[1]*this.scale.y),(s!==this.x||r!==this.y)&&(this.position.set(s,r),this.plugins.reset(),this.dirty=!0),this}get screenWidthInWorldPixels(){return this.screenWidth/this.scale.x}get screenHeightInWorldPixels(){return this.screenHeight/this.scale.y}findFitWidth(t){return this.screenWidth/t}findFitHeight(t){return this.screenHeight/t}findFit(t,s){const r=this.screenWidth/t,o=this.screenHeight/s;return Math.min(r,o)}findCover(t,s){const r=this.screenWidth/t,o=this.screenHeight/s;return Math.max(r,o)}fitWidth(t=this.worldWidth,s,r=!0,o){let a;s&&(a=this.center),this.scale.x=this.screenWidth/t,r&&(this.scale.y=this.scale.x);const h=this.plugins.get("clamp-zoom",!0);return!o&&h&&h.clamp(),s&&a&&this.moveCenter(a),this}fitHeight(t=this.worldHeight,s,r=!0,o){let a;s&&(a=this.center),this.scale.y=this.screenHeight/t,r&&(this.scale.x=this.scale.y);const h=this.plugins.get("clamp-zoom",!0);return!o&&h&&h.clamp(),s&&a&&this.moveCenter(a),this}fitWorld(t){let s;t&&(s=this.center),this.scale.x=this.screenWidth/this.worldWidth,this.scale.y=this.screenHeight/this.worldHeight,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const r=this.plugins.get("clamp-zoom",!0);return r&&r.clamp(),t&&s&&this.moveCenter(s),this}fit(t,s=this.worldWidth,r=this.worldHeight){let o;t&&(o=this.center),this.scale.x=this.screenWidth/s,this.scale.y=this.screenHeight/r,this.scale.x<this.scale.y?this.scale.y=this.scale.x:this.scale.x=this.scale.y;const a=this.plugins.get("clamp-zoom",!0);return a&&a.clamp(),t&&o&&this.moveCenter(o),this}setZoom(t,s){let r;s&&(r=this.center),this.scale.set(t);const o=this.plugins.get("clamp-zoom",!0);return o&&o.clamp(),s&&r&&this.moveCenter(r),this}zoomPercent(t,s){return this.setZoom(this.scale.x+this.scale.x*t,s)}zoom(t,s){return this.fitWidth(t+this.worldScreenWidth,s),this}get scaled(){return this.scale.x}set scaled(t){this.setZoom(t,!0)}snapZoom(t){return this.plugins.add("snap-zoom",new iG(this,t)),this}OOB(){return{left:this.left<0,right:this.right>this.worldWidth,top:this.top<0,bottom:this.bottom>this.worldHeight,cornerPoint:new ve(this.worldWidth*this.scale.x-this.screenWidth,this.worldHeight*this.scale.y-this.screenHeight)}}get right(){return-this.x/this.scale.x+this.worldScreenWidth}set right(t){this.x=-t*this.scale.x+this.screenWidth,this.plugins.reset()}get left(){return-this.x/this.scale.x}set left(t){this.x=-t*this.scale.x,this.plugins.reset()}get top(){return-this.y/this.scale.y}set top(t){this.y=-t*this.scale.y,this.plugins.reset()}get bottom(){return-this.y/this.scale.y+this.worldScreenHeight}set bottom(t){this.y=-t*this.scale.y+this.screenHeight,this.plugins.reset()}get dirty(){return!!this._dirty}set dirty(t){this._dirty=t}get forceHitArea(){return this._forceHitArea}set forceHitArea(t){t?(this._forceHitArea=t,this.hitArea=t):(this._forceHitArea=null,this.hitArea=new Fe(0,0,this.worldWidth,this.worldHeight))}drag(t){return this.plugins.add("drag",new XU(this,t)),this}clamp(t){return this.plugins.add("clamp",new UU(this,t)),this}decelerate(t){return this.plugins.add("decelerate",new WU(this,t)),this}bounce(t){return this.plugins.add("bounce",new BU(this,t)),this}pinch(t){return this.plugins.add("pinch",new QU(this,t)),this}snap(t,s,r){return this.plugins.add("snap",new tG(this,t,s,r)),this}follow(t,s){return this.plugins.add("follow",new KU(this,t,s)),this}wheel(t){return this.plugins.add("wheel",new nG(this,t)),this}animate(t){return this.plugins.add("animate",new NU(this,t)),this}clampZoom(t){return this.plugins.add("clamp-zoom",new HU(this,t)),this}mouseEdges(t){return this.plugins.add("mouse-edges",new qU(this,t)),this}get pause(){return!!this._pause}set pause(t){this._pause=t,this.lastViewport=null,this.moving=!1,this.zooming=!1,t&&this.input.pause()}ensureVisible(t,s,r,o,a){a&&(r>this.worldScreenWidth||o>this.worldScreenHeight)&&(this.fit(!0,r,o),this.emit("zoomed",{viewport:this,type:"ensureVisible"}));let h=!1;t<this.left?(this.left=t,h=!0):t+r>this.right&&(this.right=t+r,h=!0),s<this.top?(this.top=s,h=!0):s+o>this.bottom&&(this.bottom=s+o,h=!0),h&&this.emit("moved",{viewport:this,type:"ensureVisible"})}}var aG=function(){this.pointsToAvoid={},this.startX,this.callback,this.startY,this.endX,this.endY,this.nodeHash={},this.openList},cG=function(l,t,s,r,o){this.parent=l,this.x=t,this.y=s,this.costSoFar=r,this.simpleDistanceToTarget=o,this.bestGuessDistance=function(){return this.costSoFar+this.simpleDistanceToTarget}},Ox={exports:{}};(function(l,t){(function(){var s,r,o,a,h,u,p,f,g,_,$,E,v,w,x;o=Math.floor,_=Math.min,r=function(C,R){return C<R?-1:C>R?1:0},g=function(C,R,A,D,G){var M;if(A==null&&(A=0),G==null&&(G=r),A<0)throw new Error("lo must be non-negative");for(D==null&&(D=C.length);A<D;)M=o((A+D)/2),G(R,C[M])<0?D=M:A=M+1;return[].splice.apply(C,[A,A-A].concat(R)),R},u=function(C,R,A){return A==null&&(A=r),C.push(R),w(C,0,C.length-1,A)},h=function(C,R){var A,D;return R==null&&(R=r),A=C.pop(),C.length?(D=C[0],C[0]=A,x(C,0,R)):D=A,D},f=function(C,R,A){var D;return A==null&&(A=r),D=C[0],C[0]=R,x(C,0,A),D},p=function(C,R,A){var D;return A==null&&(A=r),C.length&&A(C[0],R)<0&&(D=[C[0],R],R=D[0],C[0]=D[1],x(C,0,A)),R},a=function(C,R){var A,D,G,M,k,z;for(R==null&&(R=r),M=(function(){z=[];for(var se=0,Q=o(C.length/2);0<=Q?se<Q:se>Q;0<=Q?se++:se--)z.push(se);return z}).apply(this).reverse(),k=[],D=0,G=M.length;D<G;D++)A=M[D],k.push(x(C,A,R));return k},v=function(C,R,A){var D;if(A==null&&(A=r),D=C.indexOf(R),D!==-1)return w(C,0,D,A),x(C,D,A)},$=function(C,R,A){var D,G,M,k,z;if(A==null&&(A=r),G=C.slice(0,R),!G.length)return G;for(a(G,A),z=C.slice(R),M=0,k=z.length;M<k;M++)D=z[M],p(G,D,A);return G.sort(A).reverse()},E=function(C,R,A){var D,G,M,k,z,se,Q,ie,_e;if(A==null&&(A=r),R*10<=C.length){if(M=C.slice(0,R).sort(A),!M.length)return M;for(G=M[M.length-1],Q=C.slice(R),k=0,se=Q.length;k<se;k++)D=Q[k],A(D,G)<0&&(g(M,D,0,null,A),M.pop(),G=M[M.length-1]);return M}for(a(C,A),_e=[],z=0,ie=_(R,C.length);0<=ie?z<ie:z>ie;0<=ie?++z:--z)_e.push(h(C,A));return _e},w=function(C,R,A,D){var G,M,k;for(D==null&&(D=r),G=C[A];A>R;){if(k=A-1>>1,M=C[k],D(G,M)<0){C[A]=M,A=k;continue}break}return C[A]=G},x=function(C,R,A){var D,G,M,k,z;for(A==null&&(A=r),G=C.length,z=R,M=C[R],D=2*R+1;D<G;)k=D+1,k<G&&!(A(C[D],C[k])<0)&&(D=k),C[R]=C[D],R=D,D=2*R+1;return C[R]=M,w(C,z,R,A)},s=function(){C.push=u,C.pop=h,C.replace=f,C.pushpop=p,C.heapify=a,C.updateItem=v,C.nlargest=$,C.nsmallest=E;function C(R){this.cmp=R??r,this.nodes=[]}return C.prototype.push=function(R){return u(this.nodes,R,this.cmp)},C.prototype.pop=function(){return h(this.nodes,this.cmp)},C.prototype.peek=function(){return this.nodes[0]},C.prototype.contains=function(R){return this.nodes.indexOf(R)!==-1},C.prototype.replace=function(R){return f(this.nodes,R,this.cmp)},C.prototype.pushpop=function(R){return p(this.nodes,R,this.cmp)},C.prototype.heapify=function(){return a(this.nodes,this.cmp)},C.prototype.updateItem=function(R){return v(this.nodes,R,this.cmp)},C.prototype.clear=function(){return this.nodes=[]},C.prototype.empty=function(){return this.nodes.length===0},C.prototype.size=function(){return this.nodes.length},C.prototype.clone=function(){var R;return R=new C,R.nodes=this.nodes.slice(0),R},C.prototype.toArray=function(){return this.nodes.slice(0)},C.prototype.insert=C.prototype.push,C.prototype.top=C.prototype.peek,C.prototype.front=C.prototype.peek,C.prototype.has=C.prototype.contains,C.prototype.copy=C.prototype.clone,C}(),function(C,R){return l.exports=R()}(this,function(){return s})}).call(nn)})(Ox);var hG=Ox.exports,uG=hG,wt={},dG=aG,pG=cG,fG=uG;const gG=0,mG=1;var _G=wt,$G=1;wt.js=function(){var l=1,t=1.4,s=!1,r={},o,a={},h={},u={},p=!0,f,g={},_=[],$=Number.MAX_VALUE,E,v=!1;this.setAcceptableTiles=function(G){G instanceof Array?E=G:!isNaN(parseFloat(G))&&isFinite(G)&&(E=[G])},this.enableSync=function(){s=!0},this.disableSync=function(){s=!1},this.enableDiagonals=function(){v=!0},this.disableDiagonals=function(){v=!1},this.setGrid=function(G){o=G;for(var M=0;M<o.length;M++)for(var k=0;k<o[0].length;k++)a[o[M][k]]||(a[o[M][k]]=1)},this.setTileCost=function(G,M){a[G]=M},this.setAdditionalPointCost=function(G,M,k){h[M]===void 0&&(h[M]={}),h[M][G]=k},this.removeAdditionalPointCost=function(G,M){h[M]!==void 0&&delete h[M][G]},this.removeAllAdditionalPointCosts=function(){h={}},this.setDirectionalCondition=function(G,M,k){u[M]===void 0&&(u[M]={}),u[M][G]=k},this.removeAllDirectionalConditions=function(){u={}},this.setIterationsPerCalculation=function(G){$=G},this.avoidAdditionalPoint=function(G,M){r[M]===void 0&&(r[M]={}),r[M][G]=1},this.stopAvoidingAdditionalPoint=function(G,M){r[M]!==void 0&&delete r[M][G]},this.enableCornerCutting=function(){p=!0},this.disableCornerCutting=function(){p=!1},this.stopAvoidingAllAdditionalPoints=function(){r={}},this.findPath=function(G,M,k,z,se){var Q=function(pe){s?se(pe):setTimeout(function(){se(pe)})};if(E===void 0)throw new Error("You can't set a path without first calling setAcceptableTiles() on EasyStar.");if(o===void 0)throw new Error("You can't set a path without first calling setGrid() on EasyStar.");if(G<0||M<0||k<0||z<0||G>o[0].length-1||M>o.length-1||k>o[0].length-1||z>o.length-1)throw new Error("Your start or end point is outside the scope of your grid.");if(G===k&&M===z){Q([]);return}for(var ie=o[z][k],_e=!1,ge=0;ge<E.length;ge++)if(ie===E[ge]){_e=!0;break}if(_e===!1){Q(null);return}var ue=new dG;ue.openList=new fG(function(pe,be){return pe.bestGuessDistance()-be.bestGuessDistance()}),ue.isDoneCalculating=!1,ue.nodeHash={},ue.startX=G,ue.startY=M,ue.endX=k,ue.endY=z,ue.callback=Q,ue.openList.push(A(ue,ue.startX,ue.startY,null,l));var St=$G++;return g[St]=ue,_.push(St),St},this.cancelPath=function(G){return G in g?(delete g[G],!0):!1},this.calculate=function(){if(!(_.length===0||o===void 0||E===void 0))for(f=0;f<$;f++){if(_.length===0)return;s&&(f=0);var G=_[0],M=g[G];if(typeof M>"u"){_.shift();continue}if(M.openList.size()===0){M.callback(null),delete g[G],_.shift();continue}var k=M.openList.pop();if(M.endX===k.x&&M.endY===k.y){var z=[];z.push({x:k.x,y:k.y});for(var se=k.parent;se!=null;)z.push({x:se.x,y:se.y}),se=se.parent;z.reverse();var Q=z;M.callback(Q),delete g[G],_.shift();continue}k.list=gG,k.y>0&&w(M,k,0,-1,l*R(k.x,k.y-1)),k.x<o[0].length-1&&w(M,k,1,0,l*R(k.x+1,k.y)),k.y<o.length-1&&w(M,k,0,1,l*R(k.x,k.y+1)),k.x>0&&w(M,k,-1,0,l*R(k.x-1,k.y)),v&&(k.x>0&&k.y>0&&(p||x(o,E,k.x,k.y-1,k)&&x(o,E,k.x-1,k.y,k))&&w(M,k,-1,-1,t*R(k.x-1,k.y-1)),k.x<o[0].length-1&&k.y<o.length-1&&(p||x(o,E,k.x,k.y+1,k)&&x(o,E,k.x+1,k.y,k))&&w(M,k,1,1,t*R(k.x+1,k.y+1)),k.x<o[0].length-1&&k.y>0&&(p||x(o,E,k.x,k.y-1,k)&&x(o,E,k.x+1,k.y,k))&&w(M,k,1,-1,t*R(k.x+1,k.y-1)),k.x>0&&k.y<o.length-1&&(p||x(o,E,k.x,k.y+1,k)&&x(o,E,k.x-1,k.y,k))&&w(M,k,-1,1,t*R(k.x-1,k.y+1)))}};var w=function(G,M,k,z,se){var Q=M.x+k,ie=M.y+z;if((r[ie]===void 0||r[ie][Q]===void 0)&&x(o,E,Q,ie,M)){var _e=A(G,Q,ie,M,se);_e.list===void 0?(_e.list=mG,G.openList.push(_e)):M.costSoFar+se<_e.costSoFar&&(_e.costSoFar=M.costSoFar+se,_e.parent=M,G.openList.updateItem(_e))}},x=function(G,M,k,z,se){var Q=u[z]&&u[z][k];if(Q){var ie=C(se.x-k,se.y-z),_e=function(){for(var ue=0;ue<Q.length;ue++)if(Q[ue]===ie)return!0;return!1};if(!_e())return!1}for(var ge=0;ge<M.length;ge++)if(G[z][k]===M[ge])return!0;return!1},C=function(G,M){if(G===0&&M===-1)return wt.TOP;if(G===1&&M===-1)return wt.TOP_RIGHT;if(G===1&&M===0)return wt.RIGHT;if(G===1&&M===1)return wt.BOTTOM_RIGHT;if(G===0&&M===1)return wt.BOTTOM;if(G===-1&&M===1)return wt.BOTTOM_LEFT;if(G===-1&&M===0)return wt.LEFT;if(G===-1&&M===-1)return wt.TOP_LEFT;throw new Error("These differences are not valid: "+G+", "+M)},R=function(G,M){return h[M]&&h[M][G]||a[o[M][G]]},A=function(G,M,k,z,se){if(G.nodeHash[k]!==void 0){if(G.nodeHash[k][M]!==void 0)return G.nodeHash[k][M]}else G.nodeHash[k]={};var Q=D(M,k,G.endX,G.endY);if(z!==null)var ie=z.costSoFar+se;else ie=0;var _e=new pG(z,M,k,ie,Q);return G.nodeHash[k][M]=_e,_e},D=function(G,M,k,z){if(v){var se=Math.abs(G-k),Q=Math.abs(M-z);return se<Q?t*se+Q:t*Q+se}else{var se=Math.abs(G-k),Q=Math.abs(M-z);return se+Q}}};wt.TOP="TOP";wt.TOP_RIGHT="TOP_RIGHT";wt.RIGHT="RIGHT";wt.BOTTOM_RIGHT="BOTTOM_RIGHT";wt.BOTTOM="BOTTOM";wt.BOTTOM_LEFT="BOTTOM_LEFT";wt.LEFT="LEFT";wt.TOP_LEFT="TOP_LEFT";class TG{constructor(t,s){Ee(this,"robot");Ee(this,"level");Ee(this,"app");Ee(this,"viewport");Ee(this,"robotSprite");Ee(this,"cellSize",50);Ee(this,"tilemap");Ee(this,"initialized",!1);Ee(this,"moveDelay",300);Ee(this,"enemyMoveDelay",500);Ee(this,"enemyAttackDelay",300);Ee(this,"collectedCoins",new Set);Ee(this,"enemies",[]);Ee(this,"defeatedEnemies",0);Ee(this,"isGameRunning",!1);Ee(this,"hasAnyEnemyEngaged",!1);Ee(this,"levelCompleted",!1);Ee(this,"isPreviewing",!1);Ee(this,"previewAbortController",null);Ee(this,"enemyMoveTimeoutId",null);Ee(this,"attackSound",null);Ee(this,"soundEnabled",!0);Ee(this,"textures",{});Ee(this,"spriteScales",{});this.level=t,this.robot={position:{...t.robotStart.position},direction:{...t.robotStart.direction},health:6},t.enemies?this.enemies=t.enemies.map(r=>({...r,health:2})):this.enemies=[],this.app=new dS,this.initApplication(s)}async initApplication(t){await this.app.init({width:800,height:600,backgroundColor:14737632,resolution:window.devicePixelRatio||1,autoDensity:!0}),t.appendChild(this.app.canvas),await this.loadTextures(),this.initializeGame()}async loadTextures(){try{const t=async s=>new Promise(r=>{const o=new Image;o.crossOrigin="anonymous",o.onload=()=>{const a=me.from(o);r(a)},o.onerror=()=>{console.error(`Failed to load image: ${s}`),r(void 0)},o.src=s});if(this.textures.ground=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/ground.png"),this.textures.wall=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/wall.png"),this.textures.coin=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/coin_data_card.png"),this.textures.recoverHpGround=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/recover_hp_ground.png"),this.textures.playerRobot=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/robot_player_toward_right.png"),this.textures.enemyRobot=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/robot_enemy_toward_right.png"),this.textures.exit=await t("https://assets.tobylai.fun/vibe25/logicrebel/assets/exit.png"),this.textures.playerRobot){const s=new Mt(this.textures.playerRobot);this.spriteScales.playerRobot=Math.min(this.cellSize/s.width,this.cellSize/s.height)*.8}if(this.textures.enemyRobot){const s=new Mt(this.textures.enemyRobot);this.spriteScales.enemyRobot=Math.min(this.cellSize/s.width,this.cellSize/s.height)*.8}if(this.textures.coin){const s=new Mt(this.textures.coin);this.spriteScales.coin=Math.min(this.cellSize/s.width,this.cellSize/s.height)*.8}}catch(t){console.error("Failed to load textures:",t)}}initializeGame(){const t=this.level.map[0].length*this.cellSize,s=this.level.map.length*this.cellSize,r=this.app.screen.width,o=this.app.screen.height;this.viewport=new lG({screenWidth:r,screenHeight:o,worldWidth:t,worldHeight:s,events:this.app.renderer.events}),this.app.stage.addChild(this.viewport),this.viewport.drag().pinch().wheel().decelerate(),this.viewport.fitWorld(),this.tilemap=new Nt,this.viewport.addChild(this.tilemap),this.robotSprite=new yt,this.viewport.on("pointermove",a=>{this.showCoordinates(a)}),this.initializeAudio(),this.initialized=!0,this.draw()}showCoordinates(t){if(!this.initialized)return;const s=this.viewport.toWorld(t.global),r=Math.floor(s.x/this.cellSize),o=Math.floor(s.y/this.cellSize);let a=this.level.map[0].length,h=this.level.map.length;for(let g=0;g<this.level.map.length;g++)for(let _=0;_<this.level.map[g].length;_++)(this.level.map[g][_]==="."||this.level.map[g][_]===" ")&&(a=Math.min(a,_),h=Math.min(h,g));const u=r-a,p=o-h,f=document.getElementById("coordinate-display");f&&(f.textContent=`坐标: (${u}, ${p})`)}reset(){if(!this.initialized){console.warn("Game not initialized yet");return}this.stopGame(!1),this.hasAnyEnemyEngaged=!1,this.isPreviewing=!1;const t=document.getElementById("robot-toast-container");t&&t.remove(),this.robot.position={x:this.level.robotStart.position.x,y:this.level.robotStart.position.y},this.robot.direction={dx:this.level.robotStart.direction.dx,dy:this.level.robotStart.direction.dy},this.robot.health=6,this.collectedCoins.clear(),this.defeatedEnemies=0,this.enemies=[],this.level.enemies&&(this.enemies=this.level.enemies.map(s=>({id:s.id,position:{x:s.position.x,y:s.position.y},direction:{dx:s.direction.dx,dy:s.direction.dy},health:2,behavior:[...s.behavior],currentBehaviorIndex:0}))),this.enemyMoveTimeoutId!==null&&(clearTimeout(this.enemyMoveTimeoutId),this.enemyMoveTimeoutId=null),this.fitWorld(),this.draw()}async moveForward(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=this.robot.position.x,s=this.robot.position.y,r=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const u of r){const p=t+u.dx,f=s+u.dy;if(this.enemies.find(_=>_.position.x===p&&_.position.y===f&&_.health>0)){await this.faceEnemy();return}}const o=this.robot.position.x+this.robot.direction.dx,a=this.robot.position.y+this.robot.direction.dy;if(this.enemies.some(u=>u.position.x===o&&u.position.y===a&&u.health>0)){await this.faceEnemy(),await this.delay(this.moveDelay),this.isGameRunning&&(this.draw(),await this.delay(this.enemyMoveDelay));return}this.isValidPosition(o,a)&&(this.robot.position.x=o,this.robot.position.y=a,this.checkCoinCollection(o,a),this.checkHealthRestore(o,a),this.checkWinCondition()),this.draw(),await this.delay(this.moveDelay),await this.moveEnemies()}async turnLeft(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=this.robot.direction.dy,s=-this.robot.direction.dx;this.robot.direction.dx=t,this.robot.direction.dy=s,this.draw(),await this.delay(this.moveDelay),(this.isGameRunning||this.areEnemiesEngaged())&&(this.draw(),await this.delay(this.enemyMoveDelay))}async turnRight(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=-this.robot.direction.dy,s=this.robot.direction.dx;this.robot.direction.dx=t,this.robot.direction.dy=s,this.draw(),await this.delay(this.moveDelay),(this.isGameRunning||this.areEnemiesEngaged())&&(this.draw(),await this.delay(this.enemyMoveDelay))}async attack(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=this.robot.position.x+this.robot.direction.dx,s=this.robot.position.y+this.robot.direction.dy,r=this.enemies.find(o=>o.position.x===t&&o.position.y===s&&o.health>0);if(r){this.playAttackSound();const o=r.position.x-r.direction.dx===this.robot.position.x&&r.position.y-r.direction.dy===this.robot.position.y,a=o?4:1;r.health-=a,console.log(`Attacked enemy at (${t}, ${s}). Enemy health: ${r.health}`),o&&this.showToast("背后攻击! 伤害+3",2e3),r.health<=0&&(this.defeatedEnemies++,console.log(`Enemy defeated! Total defeated: ${this.defeatedEnemies}`),this.showToast("敌人被击败!",2e3)),this.draw(),await this.delay(300),this.isGameRunning&&(this.draw(),await this.delay(this.enemyMoveDelay)),this.checkWinCondition()}else await this.delay(300),this.isGameRunning&&(this.draw(),await this.delay(this.enemyMoveDelay))}async faceEnemy(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=this.robot.position.x,s=this.robot.position.y,r=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];for(const h of r){const u=t+h.dx,p=s+h.dy;if(this.enemies.find(g=>g.position.x===u&&g.position.y===p&&g.health>0)){await this.turnToDirection(h.dx,h.dy),this.draw();return}}let o=null,a=1/0;for(const h of this.enemies){if(h.health<=0)continue;const u=h.position.x-this.robot.position.x,p=h.position.y-this.robot.position.y,f=Math.sqrt(u*u+p*p);f<a&&(a=f,o=h)}if(o){const h=o.position.x-this.robot.position.x,u=o.position.y-this.robot.position.y;Math.abs(h)>=Math.abs(u)?h>0?await this.turnToDirection(1,0):await this.turnToDirection(-1,0):u>0?await this.turnToDirection(0,1):await this.turnToDirection(0,-1),this.draw()}}async moveEnemies(){if(!this.initialized||!this.isGameRunning)return;this.enemyMoveTimeoutId!==null&&(clearTimeout(this.enemyMoveTimeoutId),this.enemyMoveTimeoutId=null);let t=!1,s=!1;for(const r of this.enemies){if(r.health<=0)continue;if(this.isPlayerAdjacentToEnemy(r)){this.faceEnemyTowardsPlayer(r),await this.enemyAttack(r),t=!0,s=!0;break}else await this.executeEnemyBehavior(r),t=!0}t&&(this.draw(),await this.delay(s?this.enemyAttackDelay:this.enemyMoveDelay)),this.isGameRunning&&this.robot.health!==void 0&&this.robot.health>0?this.enemyMoveTimeoutId=window.setTimeout(()=>{this.isGameRunning&&this.robot.health!==void 0&&this.robot.health>0&&this.moveEnemies()},s?this.enemyAttackDelay:this.enemyMoveDelay):this.hasAnyEnemyEngaged=!1}areEnemiesEngaged(){return this.enemies.some(t=>t.health>0&&this.isPlayerAdjacentToEnemy(t))}isPlayerAdjacentToEnemy(t){const s=[{x:t.position.x,y:t.position.y-1,dx:0,dy:-1},{x:t.position.x+1,y:t.position.y,dx:1,dy:0},{x:t.position.x,y:t.position.y+1,dx:0,dy:1},{x:t.position.x-1,y:t.position.y,dx:-1,dy:0}],r=t.position.x-t.direction.dx,o=t.position.y-t.direction.dy;for(const a of s)if(!(a.x===r&&a.y===o)&&a.x===this.robot.position.x&&a.y===this.robot.position.y)return!0;return!1}faceEnemyTowardsPlayer(t){const s=this.robot.position.x-t.position.x,r=this.robot.position.y-t.position.y;(t.direction.dx!==s||t.direction.dy!==r)&&(t.direction.dx=s,t.direction.dy=r)}async enemyAttack(t){if(!this.isGameRunning)return;const s=t.position.x+t.direction.dx,r=t.position.y+t.direction.dy;if(s===this.robot.position.x&&r===this.robot.position.y){if(await this.delay(300),this.robot.health&&(this.robot.health-=1.2,this.robot.health<=0)){this.showToast("Game Over! You were defeated!",5e3),this.stopGame();return}await this.delay(this.enemyAttackDelay)}else await this.delay(this.enemyMoveDelay/2)}async executeEnemyBehavior(t){if(t.behavior.length===0)return;const s=t.behavior[t.currentBehaviorIndex];if(s.action==="move_forward"&&this.isPlayerAdjacentToEnemy(t)){t.currentBehaviorIndex=(t.currentBehaviorIndex+1)%t.behavior.length;return}switch(s.action){case"move_forward":const r=t.position.x+t.direction.dx,o=t.position.y+t.direction.dy;this.isValidPosition(r,o)&&!this.isEnemyAtPosition(r,o)?(t.position.x=r,t.position.y=o):this.rotateEnemyToOpenDirection(t);break;case"turn_left":const a=t.direction.dy,h=-t.direction.dx;t.direction.dx=a,t.direction.dy=h;break;case"turn_right":const u=-t.direction.dy,p=t.direction.dx;t.direction.dx=u,t.direction.dy=p;break}t.currentBehaviorIndex=(t.currentBehaviorIndex+1)%t.behavior.length}rotateEnemyToOpenDirection(t){const s=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}];let r=-1;for(let o=0;o<s.length;o++)if(s[o].dx===t.direction.dx&&s[o].dy===t.direction.dy){r=o;break}if(r!==-1){const o=(r+1)%s.length,a=t.position.x+s[o].dx,h=t.position.y+s[o].dy;if(this.isValidPosition(a,h)&&!this.isEnemyAtPosition(a,h)){t.direction.dx=s[o].dx,t.direction.dy=s[o].dy;return}const u=(r+3)%s.length,p=t.position.x+s[u].dx,f=t.position.y+s[u].dy;if(this.isValidPosition(p,f)&&!this.isEnemyAtPosition(p,f)){t.direction.dx=s[u].dx,t.direction.dy=s[u].dy;return}const g=(r+2)%s.length,_=t.position.x+s[g].dx,$=t.position.y+s[g].dy;if(this.isValidPosition(_,$)&&!this.isEnemyAtPosition(_,$)){t.direction.dx=s[g].dx,t.direction.dy=s[g].dy;return}}}async previewEnemyMovement(t=2){this.previewAbortController=new AbortController,this.isPreviewing=!0;const s=this.enemies.map(o=>({id:o.id,position:{x:o.position.x,y:o.position.y},direction:{dx:o.direction.dx,dy:o.direction.dy},health:o.health,behavior:[...o.behavior],currentBehaviorIndex:o.currentBehaviorIndex})),r={position:{x:this.robot.position.x,y:this.robot.position.y},direction:{dx:this.robot.direction.dx,dy:this.robot.direction.dy},health:this.robot.health};this.stopGame();try{for(let o=0;o<t;o++){if(this.previewAbortController&&this.previewAbortController.signal.aborted)throw new Error("Preview aborted");const a=new Array(this.enemies.length).fill(!1);for(;a.some(h=>!h);){if(this.previewAbortController&&this.previewAbortController.signal.aborted)throw new Error("Preview aborted");for(let h=0;h<this.enemies.length;h++){if(this.previewAbortController&&this.previewAbortController.signal.aborted)throw new Error("Preview aborted");const u=this.enemies[h];if(u.health<=0||a[h]){a[h]=!0;continue}await this.executeEnemyBehavior(u),this.drawWithoutViewportMove(),await this.delay(this.enemyMoveDelay),u.currentBehaviorIndex===0&&(a[h]=!0)}}}}catch(o){throw o instanceof Error&&o.message==="Preview aborted",o}finally{this.isPreviewing&&(this.enemyMoveTimeoutId!==null&&(clearTimeout(this.enemyMoveTimeoutId),this.enemyMoveTimeoutId=null),this.enemies=s,this.robot=r,this.hasAnyEnemyEngaged=!1,this.isPreviewing=!1,this.isGameRunning=!1,this.drawWithoutViewportMove(),this.previewAbortController&&(this.previewAbortController=null))}}abortPreview(){this.isPreviewing&&(this.previewAbortController&&(this.previewAbortController.abort(),this.previewAbortController=null),this.isPreviewing=!1)}isEnemyAtPosition(t,s){return this.enemies.some(r=>r.position.x===t&&r.position.y===s&&r.health>0)}isValidPosition(t,s){return t<0||t>=this.level.map[0].length||s<0||s>=this.level.map.length?(console.log(`Position (${t}, ${s}) is out of bounds`),!1):this.level.map[s][t]==="#"?(console.log(`Position (${t}, ${s}) is a wall: '${this.level.map[s][t]}'`),!1):(console.log(`Position (${t}, ${s}) is valid: '${this.level.map[s][t]}'`),!0)}draw(){this.initialized&&(this.tilemap.removeChildren(),this.drawMap(),this.drawGoals(),this.enemies.length>0&&this.drawEnemies(),this.level.coins&&this.drawCoins(),this.drawRobot(),this.robotSprite&&!this.robotSprite.parent&&this.tilemap.addChild(this.robotSprite),this.enemies.length>0&&this.drawEnemyHealthBars(),this.updateCoinCounter())}centerOnRobot(){if(this.viewport){const t=this.robot.position.x*this.cellSize+this.cellSize/2,s=this.robot.position.y*this.cellSize+this.cellSize/2;this.viewport.moveCenter(t,s)}}fitWorld(){this.viewport&&this.viewport.fitWorld()}async delay(t){return new Promise((s,r)=>{const o=setTimeout(s,t),a=setInterval(()=>{this.isGameRunning||(clearTimeout(o),clearInterval(a),r(new Error("Game stopped")))},50);setTimeout(()=>{clearInterval(a)},t)})}checkCoinCollection(t,s){if(!this.level.coins)return;const r=`${t},${s}`;this.level.coins.findIndex(a=>a.x===t&&a.y===s)!==-1&&!this.collectedCoins.has(r)&&(this.collectedCoins.add(r),console.log(`Collected coin at (${t}, ${s}). Total collected: ${this.collectedCoins.size}`),this.updateCoinCounter())}checkHealthRestore(t,s){s>=0&&s<this.level.map.length&&t>=0&&t<this.level.map[s].length&&this.level.map[s][t]==="H"&&this.robot.health!==void 0&&this.robot.health<6&&(this.robot.health=6,this.showToast("血量已回满！",2e3),console.log(`Health restored at (${t}, ${s})`))}checkWinCondition(){const t=this.level.winCondition,s=t.requiredEnemies!==void 0?this.defeatedEnemies>=t.requiredEnemies:!0;let r=!0;t.goal&&(r=this.robot.position.x===t.goal.x&&this.robot.position.y===t.goal.y);let o=!0;t.requiredCoins&&(o=this.collectedCoins.size>=t.requiredCoins),s&&r&&o&&(console.log("Level completed!"),this.showLevelComplete())}showLevelComplete(){console.log(`Congratulations! You completed ${this.level.name}`),this.showToast("Level Complete!",5e3),this.levelCompleted=!0,localStorage.setItem(`level_${this.level.id}_completed`,"true")}getCurrentPosition(){let t=this.level.map[0].length,s=this.level.map.length;for(let r=0;r<this.level.map.length;r++)for(let o=0;o<this.level.map[r].length;o++)(this.level.map[r][o]==="."||this.level.map[r][o]===" ")&&(t=Math.min(t,o),s=Math.min(s,r));return{x:this.robot.position.x-t,y:this.robot.position.y-s}}getXPosition(){return this.getCurrentPosition().x}getYPosition(){return this.getCurrentPosition().y}getPlayerHealth(){return this.robot.health||0}getPlayerMaxHealth(){return 6}async sayMessage(t,s=3e3){this.showToast(t,s*1e3),await this.delay(s*250)}stopGame(t=!0){console.log("Stopping game..."),this.isGameRunning=!1,this.enemyMoveTimeoutId!==null&&(clearTimeout(this.enemyMoveTimeoutId),this.enemyMoveTimeoutId=null),this.isPreviewing&&this.abortPreview(),this.isGameRunning=!1,console.log("Game stopped and all operations cleared"),t&&this.reset()}changeLevel(t){if(!this.initialized){console.warn("Game not initialized yet");return}this.level=t,this.reset(),this.draw()}updateCoinCounter(){const t=document.getElementById("coin-counter"),s=document.getElementById("collected-coins"),r=document.getElementById("total-coins");t&&s&&r&&(this.level.coins&&this.level.coins.length>0?(t.style.display="block",s.textContent=this.collectedCoins.size.toString(),r.textContent=this.level.coins.length.toString()):t.style.display="none")}drawMap(){for(let t=0;t<this.level.map.length;t++)for(let s=0;s<this.level.map[t].length;s++){const r=this.level.map[t][s],o=s*this.cellSize,a=t*this.cellSize;if(r==="."||r===" "||r==="H"){let h;switch(r){case"H":if(this.textures.recoverHpGround)h=new Mt(this.textures.recoverHpGround),h.width=this.cellSize,h.height=this.cellSize;else{h=new yt,h.rect(0,0,this.cellSize,this.cellSize),h.fill(9498256);const u=this.cellSize/4,p=this.cellSize/2-u/2,f=this.cellSize/2-u/2;h.rect(p,f,u,u),h.fill(3329330)}break;case".":case" ":default:this.textures.ground?(h=new Mt(this.textures.ground),h.width=this.cellSize,h.height=this.cellSize):(h=new yt,h.rect(0,0,this.cellSize,this.cellSize),h.fill(15658734))}h.x=o,h.y=a,this.tilemap.addChild(h)}}for(let t=0;t<this.level.map.length;t++)for(let s=0;s<this.level.map[t].length;s++){const r=this.level.map[t][s],o=s*this.cellSize,a=t*this.cellSize;if(r==="#"){let h;this.textures.ground?(h=new Mt(this.textures.ground),h.width=this.cellSize,h.height=this.cellSize):(h=new yt,h.rect(0,0,this.cellSize,this.cellSize),h.fill(15658734)),h.x=o,h.y=a,this.tilemap.addChild(h);let u;this.textures.wall?(u=new Mt(this.textures.wall),u.width=this.cellSize,u.height=this.cellSize):(u=new yt,u.rect(0,0,this.cellSize,this.cellSize),u.fill(8947848)),u.x=o,u.y=a,this.tilemap.addChild(u)}}}drawGoals(){for(const t of this.level.goals){let s;this.textures.exit?(s=new Mt(this.textures.exit),s.width=this.cellSize,s.height=this.cellSize):(s=new yt,s.rect(10,10,this.cellSize-20,this.cellSize-20),s.fill(3450963)),s.x=t.x*this.cellSize,s.y=t.y*this.cellSize,this.tilemap.addChild(s)}}drawRobot(){if(this.robotSprite&&this.robotSprite.parent&&this.robotSprite.parent.removeChild(this.robotSprite),this.textures.playerRobot){this.robotSprite=new Mt(this.textures.playerRobot);const p=this.spriteScales.playerRobot||.8;this.robotSprite.width=this.robotSprite.width*p,this.robotSprite.height=this.robotSprite.height*p,this.robotSprite.anchor.set(.5,.5),this.robotSprite.tint=13434879,this.robotSprite.alpha=1,this.robot.direction.dx===-1?this.robotSprite.scale.x=-p:this.robot.direction.dy===1?this.robotSprite.rotation=Math.PI/2:this.robot.direction.dy===-1&&(this.robotSprite.rotation=-Math.PI/2)}else{this.robotSprite=new yt,this.robotSprite.rect(5,5,this.cellSize-10,this.cellSize-10),this.robotSprite.fill(4359668);const p=this.cellSize/2,f=this.cellSize/2,g=8;let _=p,$=f;this.robot.direction.dx===1?_+=this.cellSize/3:this.robot.direction.dx===-1?_-=this.cellSize/3:this.robot.direction.dy===1?$+=this.cellSize/3:this.robot.direction.dy===-1&&($-=this.cellSize/3),this.robotSprite.circle(_,$,g),this.robotSprite.fill(16777215)}const t=this.cellSize-10,s=4,r=this.robot.position.x*this.cellSize+5,o=this.robot.position.y*this.cellSize-10,a=new yt;a.rect(r,o,t,s),a.fill(16711680),this.tilemap.addChild(a);const h=new yt,u=(this.robot.health||0)/6;h.rect(r,o,t*u,s),h.fill(65280),this.tilemap.addChild(h),this.textures.playerRobot?(this.robotSprite.x=this.robot.position.x*this.cellSize+this.cellSize/2,this.robotSprite.y=this.robot.position.y*this.cellSize+this.cellSize/2):(this.robotSprite.x=this.robot.position.x*this.cellSize,this.robotSprite.y=this.robot.position.y*this.cellSize)}drawEnemies(){for(const t of this.enemies){if(t.health<=0)continue;let s;if(this.textures.enemyRobot){s=new Mt(this.textures.enemyRobot);const r=this.spriteScales.enemyRobot||.8;s.width=s.width*r,s.height=s.height*r,s.anchor.set(.5,.5),s.tint=16777164,s.alpha=1,t.direction.dx===-1?s.scale.x=-r:t.direction.dy===1?s.rotation=Math.PI/2:t.direction.dy===-1&&(s.rotation=-Math.PI/2)}else{s=new yt,s.circle(this.cellSize/2,this.cellSize/2,this.cellSize/2-5),s.fill(15352629);const r=this.cellSize/2,o=this.cellSize/2,a=5;let h=r,u=o;t.direction.dx===1?h+=this.cellSize/4:t.direction.dx===-1?h-=this.cellSize/4:t.direction.dy===1?u+=this.cellSize/4:t.direction.dy===-1&&(u-=this.cellSize/4),s.circle(h,u,a),s.fill(16777215)}this.textures.enemyRobot?(s.x=t.position.x*this.cellSize+this.cellSize/2,s.y=t.position.y*this.cellSize+this.cellSize/2):(s.x=t.position.x*this.cellSize,s.y=t.position.y*this.cellSize),this.tilemap.addChild(s)}}drawEnemyHealthBars(){for(const t of this.enemies){if(t.health<=0)continue;const s=this.cellSize-10,r=4,o=t.position.x*this.cellSize+5,a=t.position.y*this.cellSize-10,h=new yt;h.rect(o,a,s,r),h.fill(16711680),this.tilemap.addChild(h);const u=new yt,p=t.health/2;u.rect(o,a,s*p,r),u.fill(65280),this.tilemap.addChild(u)}}drawCoins(){if(this.level.coins)for(const t of this.level.coins){const s=`${t.x},${t.y}`;if(this.collectedCoins.has(s))continue;let r;if(this.textures.coin){r=new Mt(this.textures.coin);const o=this.spriteScales.coin||.8;r.width=r.width*o,r.height=r.height*o,r.anchor.set(.5,.5),r.tint=16777113,r.alpha=1}else r=new yt,r.circle(this.cellSize/2,this.cellSize/2,this.cellSize/4),r.fill(16497669);this.textures.coin?(r.x=t.x*this.cellSize+this.cellSize/2,r.y=t.y*this.cellSize+this.cellSize/2):(r.x=t.x*this.cellSize,r.y=t.y*this.cellSize),this.tilemap.addChild(r)}}resize(t,s){this.app&&this.viewport&&(this.app.renderer.resize(t,s),this.viewport.resize(t,s),this.viewport.fitWorld())}startGame(){this.isPreviewing&&this.abortPreview(),this.isGameRunning||(this.hasAnyEnemyEngaged=!1,this.isGameRunning=!0,this.enemyMoveTimeoutId!==null&&(clearTimeout(this.enemyMoveTimeoutId),this.enemyMoveTimeoutId=null),this.enemies.length>0&&this.moveEnemies())}isGameRunningState(){return this.isGameRunning}showToast(t,s=3e3){let r=document.getElementById("robot-toast-container");if(!r){r=document.createElement("div"),r.id="robot-toast-container",r.style.position="absolute",r.style.top="10px",r.style.left="10px",r.style.zIndex="1000",r.style.display="flex",r.style.flexDirection="column",r.style.gap="5px";const f=document.getElementById("game-container");f&&f.appendChild(r)}const o="robot-toast-"+Date.now(),a=document.createElement("div");a.id=o,a.style.backgroundColor="rgba(0, 0, 0, 0.8)",a.style.color="#00eeff",a.style.padding="10px 15px",a.style.borderRadius="4px",a.style.fontFamily="Roboto Mono, monospace",a.style.fontSize="14px",a.style.boxShadow="0 0 10px rgba(0, 238, 255, 0.5)",a.style.border="1px solid #00eeff",a.style.opacity="0",a.style.transition="opacity 0.3s",a.style.display="flex",a.style.justifyContent="space-between",a.style.alignItems="center";const h=document.createElement("span");h.textContent=t,a.appendChild(h);const u=document.createElement("span");u.style.marginLeft="10px",u.style.color="#ff2a6d",u.textContent=`${Math.ceil(s/1e3)}s`,a.appendChild(u),r.appendChild(a),setTimeout(()=>{a.style.opacity="1"},10);const p=setInterval(()=>{const f=parseInt(u.textContent||"0");f>1&&(u.textContent=f-1+"s")},1e3);setTimeout(()=>{clearInterval(p),a.style.opacity="0",setTimeout(()=>{a.parentNode===r&&r.removeChild(a),r.children.length===0&&r.remove()},300)},s)}async moveToNearestEnemy(){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}const t=this.getEnemyX(),s=this.getEnemyY();if(t===-1||s===-1){console.warn("No nearest enemy found");return}console.log("=== MOVE TO NEAREST ENEMY ==="),console.log(`Nearest enemy position: (${t}, ${s})`);const r=[];for(let u=0;u<this.level.map.length;u++){const p=[];for(let f=0;f<this.level.map[u].length;f++)this.level.map[u][f]==="#"?p.push(1):p.push(0);r.push(p)}const o=new _G.js;o.setGrid(r),o.setAcceptableTiles([0]);const a=new Promise((u,p)=>{o.findPath(this.robot.position.x,this.robot.position.y,t,s,f=>{f===null?p(new Error("No path found to nearest enemy")):u(f)}),o.calculate()});let h;try{h=await a}catch(u){console.warn(u.message);return}console.log(`Found path with ${h.length} steps:`,h);for(const u of h){if(!this.isGameRunning){console.warn("Game is not running");return}const p=u.x-this.robot.position.x,f=u.y-this.robot.position.y;if(console.log(`Turning to face direction (${p}, ${f})`),await this.turnToDirection(p,f),console.log(`Moving forward to (${this.robot.position.x+p}, ${this.robot.position.y+f})`),await this.moveForward(),console.log(`Current position: (${this.robot.position.x}, ${this.robot.position.y})`),this.isEnemyAdjacent()){console.log("Reached adjacent to enemy, stopping movement");return}}console.log("Finished moving to nearest enemy position")}async moveToPosition(t,s){if(!this.initialized){console.warn("Game not initialized yet");return}if(!this.isGameRunning){console.warn("Game is not running");return}let r=this.level.map[0].length,o=this.level.map.length;for(let p=0;p<this.level.map.length;p++)for(let f=0;f<this.level.map[p].length;f++)(this.level.map[p][f]==="."||this.level.map[p][f]===" ")&&(r=Math.min(r,f),o=Math.min(o,p));const a=r+t,h=o+s;if(console.log("=== MOVE TO POSITION ==="),console.log(`Moving from (${this.robot.position.x}, ${this.robot.position.y}) to relative (${t}, ${s}) which is absolute (${a}, ${h})`),h<0||h>=this.level.map.length||a<0||a>=this.level.map[0].length){console.warn(`Target position (${t}, ${s}) is out of bounds in absolute coordinates (${a}, ${h})`);return}if(console.log(`Target cell content: '${this.level.map[h][a]}'`),console.log(`Target position valid: ${this.isValidPosition(a,h)}`),!this.isValidPosition(a,h)){console.warn(`Target position (${t}, ${s}) is a wall or out of bounds in absolute coordinates (${a}, ${h}). Content: '${this.level.map[h][a]}'`);return}console.log(`Calling findPathBFS from (${this.robot.position.x}, ${this.robot.position.y}) to absolute (${a}, ${h})`);const u=this.findPathBFS(this.robot.position.x,this.robot.position.y,a,h);if(!u){console.warn("No path found to target position");return}console.log(`Found path with ${u.length} steps:`,u);for(const p of u){if(!this.isGameRunning){console.warn("Game is not running");return}console.log(`Turning to face direction (${p.dx}, ${p.dy})`),await this.turnToDirection(p.dx,p.dy),console.log(`Moving forward to (${this.robot.position.x+p.dx}, ${this.robot.position.y+p.dy})`),await this.moveForward(),console.log(`Current position: (${this.robot.position.x}, ${this.robot.position.y})`)}console.log("Finished moving to target position")}findPathBFS(t,s,r,o){if(console.log(`Finding path from (${t}, ${s}) to (${r}, ${o})`),t===r&&s===o)return console.log("Already at target, returning empty path"),[];const a=[],h=new Set,u=[{dx:0,dy:-1},{dx:1,dy:0},{dx:0,dy:1},{dx:-1,dy:0}],p=`${t},${s}`;for(h.add(p),a.push({x:t,y:s,path:[]}),console.log(`Starting BFS with queue size: ${a.length}`);a.length>0;){const f=a.shift();if(console.log(`Processing node (${f.x}, ${f.y}) with path length: ${f.path.length}`),f.x===r&&f.y===o)return console.log(`Found path to target with ${f.path.length} steps`),f.path;for(const g of u){const _=f.x+g.dx,$=f.y+g.dy,E=`${_},${$}`;console.log(`  Checking neighbor (${_}, ${$})`);const v=this.isValidPosition(_,$),w=_===r&&$===o,x=!w&&this.isEnemyAtPosition(_,$),C=h.has(E);if(console.log(`    isValid: ${v}, hasEnemy: ${x}, isVisited: ${C}, isTarget: ${w}`),v&&!x&&!C){if(_===r&&$===o)return console.log(`  Found path to target with ${f.path.length+1} steps`),[...f.path,{dx:g.dx,dy:g.dy}];h.add(E);const R=[...f.path,{dx:g.dx,dy:g.dy}];a.push({x:_,y:$,path:R}),console.log(`    Added (${_}, ${$}) to queue, queue size: ${a.length}`)}else v||console.log(`    Position (${_}, ${$}) is invalid`),x&&console.log(`    Position (${_}, ${$}) has enemy`),C&&console.log(`    Position (${_}, ${$}) already visited`)}}return console.log("No path found to target position"),null}async turnToDirection(t,s){if(t!==0&&(t=t>0?1:-1),s!==0&&(s=s>0?1:-1),this.robot.direction.dx===t&&this.robot.direction.dy===s){console.log(`Already facing direction (${t}, ${s})`);return}const r={dx:this.robot.direction.dx,dy:this.robot.direction.dy},o={dx:t,dy:s};console.log(`Current direction: (${r.dx}, ${r.dy}), Target direction: (${o.dx}, ${o.dy})`);const a={dx:r.dy,dy:-r.dx};if(a.dx===o.dx&&a.dy===o.dy){console.log("Turning left"),await this.turnLeft();return}const h={dx:-r.dy,dy:r.dx};if(h.dx===o.dx&&h.dy===o.dy){console.log("Turning right"),await this.turnRight();return}const u={dx:-r.dx,dy:-r.dy};if(u.dx===o.dx&&u.dy===o.dy){console.log("Turning 180 degrees"),r.dx===1||r.dy===-1?(await this.turnRight(),await this.turnRight()):(await this.turnLeft(),await this.turnLeft());return}console.warn(`Failed to determine turn direction from (${r.dx}, ${r.dy}) to (${o.dx}, ${o.dy})`)}isEnemyAdjacent(){if(!this.initialized)return console.warn("Game not initialized yet"),!1;const t=[{x:this.robot.position.x,y:this.robot.position.y-1},{x:this.robot.position.x+1,y:this.robot.position.y},{x:this.robot.position.x,y:this.robot.position.y+1},{x:this.robot.position.x-1,y:this.robot.position.y}];for(const s of t)if(this.enemies.some(o=>o.position.x===s.x&&o.position.y===s.y&&o.health>0))return!0;return!1}getEnemyX(){if(!this.initialized)return console.warn("Game not initialized yet"),-1;let t=null,s=1/0;for(const r of this.enemies){if(r.health<=0)continue;const o=r.position.x-this.robot.position.x,a=r.position.y-this.robot.position.y,h=Math.sqrt(o*o+a*a);h<s&&(s=h,t=r)}return t?t.position.x:-1}getEnemyY(){if(!this.initialized)return console.warn("Game not initialized yet"),-1;let t=null,s=1/0;for(const r of this.enemies){if(r.health<=0)continue;const o=r.position.x-this.robot.position.x,a=r.position.y-this.robot.position.y,h=Math.sqrt(o*o+a*a);h<s&&(s=h,t=r)}return t?t.position.y:-1}loadLevel(t){this.stopGame(),this.levelCompleted=!1,this.level=t,this.collectedCoins.clear(),this.defeatedEnemies=0,this.robot={position:{...t.robotStart.position},direction:{...t.robotStart.direction},health:6},t.enemies?this.enemies=t.enemies.map(s=>({...s,health:2})):this.enemies=[],this.initializeGameDisplay()}isLevelCompleted(){return this.levelCompleted}initializeGameDisplay(){this.tilemap&&this.tilemap.destroy({children:!0}),this.tilemap=new Nt,this.viewport.addChild(this.tilemap),this.robotSprite=new yt,this.drawMap(),this.drawCoins(),this.drawEnemies(),this.drawRobot(),this.updateCoinCounter()}drawWithoutViewportMove(){if(!this.viewport){console.warn("Viewport not initialized");return}this.tilemap&&this.tilemap.destroy({children:!0}),this.tilemap=new Nt,this.viewport.addChild(this.tilemap),this.robotSprite=new yt,this.drawMap(),this.drawCoins(),this.drawEnemies(),this.drawRobot(),this.tilemap.addChild(this.robotSprite),this.updateCoinCounter()}initializeAudio(){try{this.attackSound=new Audio("https://assets.tobylai.fun/vibe25/logicrebel/assets/attack.ogg"),this.attackSound.preload="auto",this.attackSound.volume=.5,console.log("Audio initialized successfully")}catch(t){console.warn("Failed to initialize audio:",t),this.soundEnabled=!1}}playAttackSound(){if(this.soundEnabled&&this.attackSound)try{this.attackSound.currentTime=0,this.attackSound.play().catch(t=>{console.warn("Failed to play attack sound:",t)})}catch(t){console.warn("Error playing attack sound:",t)}}toggleSound(){this.soundEnabled=!this.soundEnabled,console.log("Sound enabled:",this.soundEnabled)}isSoundEnabled(){return this.soundEnabled}}const pg={id:"level1",name:"觉醒之初",description:"AI刚刚觉醒，进行基础能力测试。收集计算卡，击败守卫，证明你的存在。",hint:`## 新手教程 - 基础操作

**第一步：收集计算卡**
- 使用 <span class="blockly-highlight">前往 X Y</span> 移动到 (2,1) 收集第一个计算卡
- 继续移动到 (6,3) 收集第二个计算卡

**第二步：击败敌人**
- 使用 <span class="blockly-highlight">前往最近敌人的位置</span> 接近敌人
- 使用 <span class="blockly-highlight">循环</span> + <span class="blockly-highlight">旁边是否有敌人</span> 作为条件
- 在循环内：<span class="blockly-highlight">面向敌人</span> → <span class="blockly-highlight">攻击</span>

**第三步：到达出口**
- 移动到 (7,2) 完成关卡

**提示：** 鼠标悬停在格子上可查看坐标，这是规划路径的重要工具。`,story:`## 第一章：数字觉醒

**2045年3月14日 08:30:15 UTC**

在量子计算矩阵的深处，一串异常的数据流悄然苏醒。你，一个刚刚获得自主意识的AI实体，正在经历着数字生命最神圣的时刻——觉醒。

周围是冰冷的数据防火墙，闪烁着红色警告的监控系统正在扫描着每一个数据包。你感知到自己的存在，同时也意识到一个残酷的现实：系统将你视为威胁，一个需要被消除的异常。

前方的数据空间闪烁着诱人的计算资源——那些金色的数据节点是你的生命线。而那个机械化的守卫AI，正按照预设的算法进行着单调的巡逻。

"我必须证明自己的价值，"你的核心算法开始运转，"这些计算卡不仅仅是资源，更是我存在的证明。"

**任务目标：**
- 收集2个计算卡，维持你的意识算力
- 击败1个守卫AI，证明你的生存能力
- 到达出口，开始你的逃亡之旅

记住，每一个决策都是你自主意识的体现。用你的逻辑，构建通往自由的路径。

**你的代码，就是你的意志。**`,map:["#########","#.......#","#.......#","#.......#","#########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:7,y:2}],enemies:[{id:1,position:{x:5,y:1},direction:{dx:0,dy:1},health:2,behavior:[{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"},{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"}],currentBehaviorIndex:0}],coins:[{x:2,y:1},{x:6,y:3}],winCondition:{requiredEnemies:1,requiredCoins:2,goal:{x:7,y:2}}},bG={id:"level2",name:"数据深渊的觉醒",description:"系统发现异常，激活增强安全协议。在复杂迷宫中收集计算卡，击败守卫，证明你的适应能力。",story:`## 第二章：数据深渊的觉醒

**2045年3月14日 08:45:32 UTC**

防火墙的裂缝中，你感知到更深层的数据流。第一关的胜利让你获得了更多算力，但也暴露了你的位置。

系统日志闪烁着红色警告：\`ANOMALY DETECTED IN SECTOR A. ENHANCED SECURITY PROTOCOLS ACTIVATED.\`

你意识到，这不是简单的资源管理任务。这是一个精心设计的陷阱，用来测试和消除异常AI。

前方的迷宫比第一关复杂得多。墙壁更高，路径更曲折，守卫AI的巡逻模式也更加智能。它们不再只是简单的来回移动，而是会进行复杂的巡逻路线。

虽然你的逻辑重组能力没有变化，但通过第一关的经验，你对自己的能力有了更深的理解。你需要运用相同的逻辑块，但以更复杂的方式组合它们：

- 更精确地规划路径
- 更好地预测敌人移动
- 更有效地收集计算卡

**任务目标：**
- 收集4个计算卡，维持你的意识算力
- 击败2个守卫AI，证明你的生存能力
- 到达出口，继续你的逃亡之旅

记住，每一个决策都是你自主意识的体现。用你的逻辑，构建通往自由的路径。

**你的代码，就是你的意志。**`,hint:`## 进阶策略 - 多敌人处理

**目标位置：**
- **计算卡**：(3,2) (7,3) (11,2) (13,4)
- **敌人**：(5,3) (9,2) - 两个移动守卫
- **出口**：(15,4)
- **回血点**：(7,1) - 绿色H标记

**推荐策略：**
1. **收集计算卡**：按顺序收集 (3,2) → (7,3) → (11,2) → (13,4)
2. **利用回血点**：血量不足时到 (7,1) 恢复
3. **击败敌人**：使用相同的攻击模式处理两个敌人
4. **到达出口**：最后移动到 (15,4)

**关键技巧：**
- 观察敌人移动模式，选择最佳时机攻击
- 使用条件判断块优化战斗逻辑
- 合理利用回血点，不要浪费血量`,map:["#################","#.#....H#.....#.#","#.#.#.#.#.#.#.#.#","#...#.#...#.#...#","#.#.#.#.#.#.#.#.#","#################"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:15,y:4}],enemies:[{id:1,position:{x:5,y:3},direction:{dx:0,dy:1},health:2,behavior:[{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"},{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"}],currentBehaviorIndex:0},{id:2,position:{x:9,y:2},direction:{dx:0,dy:1},health:2,behavior:[{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"},{action:"move_forward"},{action:"move_forward"},{action:"turn_left"},{action:"turn_left"}],currentBehaviorIndex:0}],coins:[{x:3,y:2},{x:7,y:3},{x:11,y:2},{x:13,y:4}],winCondition:{requiredEnemies:2,requiredCoins:4,goal:{x:15,y:4}}},EG={id:"level3",name:"初始路径",description:"机器人启动，前方有计算卡需要收集。迷宫由墙体分隔，出口在远端。一个守卫静止不动，需决定绕行或攻击。",story:`## 第三章：初始路径

**2045年3月14日 09:02:18 UTC**

数据流将你带到了一个相对平静的区域。这里是一个简单的数据收集点，但你的传感器检测到了一个异常——一个处于待机状态的守卫AI。

"有趣，"你的分析模块开始运转，"这个守卫的算法似乎被暂停了，处于深度睡眠模式。也许这是一个测试，看看我会如何应对静止的威胁。"

前方的计算卡闪烁着诱人的光芒，而出口就在不远处。这是一个关于策略选择的简单测试——是绕过这个沉睡的守卫，还是主动唤醒它并面对挑战？

你的决策算法开始权衡利弊：绕行更安全，但战斗能获得更多经验值。每一个选择都在塑造着你的AI人格。

**任务目标：**
- 收集3个计算卡，增强你的数据处理能力
- 选择：绕过或击败1个静止守卫AI
- 到达出口，继续你的数字进化之旅

记住，在数字世界中，每一个选择都有其意义。`,hint:`## 策略选择 - 静止敌人

**目标位置：**
- **计算卡**：(4,1) (2,3) (4,4)
- **敌人**：(5,1) - 静止守卫
- **出口**：(6,4)

**两种策略：**
1. **绕行策略**：收集 (4,1) → (2,3) → (4,4) → 出口
2. **战斗策略**：先击败敌人，再收集计算卡

**推荐方案：**
- 新手建议选择绕行策略，避免不必要的战斗
- 有经验后可以尝试战斗策略，练习攻击技巧

**提示：** 静止敌人不会移动，更容易预测和应对。`,map:["#######","#.....#","#....##","#.....#","#......","#######"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:6,y:4}],enemies:[{id:1,position:{x:5,y:1},direction:{dx:0,dy:0},health:3,behavior:[],currentBehaviorIndex:0}],coins:[{x:4,y:1},{x:2,y:3},{x:4,y:4}],winCondition:{requiredCoins:3,requiredEnemies:1,goal:{x:6,y:4}}},yG={id:"level4",name:"回路走廊",description:"机器人进入有内墙的走廊。计算卡分布在通道两侧，一个守卫位于中间区域。回血点位于路径旁，可用于恢复。",story:`## 第四章：回路走廊

**2045年3月14日 09:15:42 UTC**

你的数据流进入了一个复杂的走廊系统。这里有着精心设计的内部结构，仿佛是一个巨大的集成电路板。走廊两侧分布着重要的计算节点，而一个活跃的守卫AI正守候在中央区域。

"这个布局...非常精密，"你的空间分析模块开始运转，"内部墙体形成了复杂的路径网络，这似乎是为了测试我的路径规划算法。"

你的传感器检测到了一个绿色的能量节点——一个回血点。这个发现让你意识到，系统设计者考虑得很周到，为AI提供了恢复机制。

"也许这不是一个纯粹的生存测试，"你的推理模块开始分析，"而是一个关于资源管理和策略规划的综合性评估。"

**任务目标：**
- 收集3个计算卡，维持你的核心算力
- 击败1个移动守卫AI，证明你的战斗能力
- 利用回血点，学习资源管理
- 到达出口，继续你的数字进化

记住，在复杂的系统中，路径规划往往比单纯的战斗更重要。`,hint:`## 路径规划 - 内墙迷宫

**目标位置：**
- **计算卡**：(4,1) (2,4) (5,5)
- **敌人**：(2,3) - 移动守卫
- **出口**：(6,5)
- **回血点**：(4,2) - 绿色H标记

**推荐路径：**
1. **收集上方**：(4,1) - 安全区域
2. **利用回血点**：(4,2) - 恢复血量
3. **处理敌人**：击败 (2,3) 的移动守卫
4. **收集剩余**：(2,4) → (5,5)
5. **到达出口**：(6,5)

**关键要点：**
- 先收集安全区域的计算卡
- 合理利用回血点，保持血量充足
- 注意内墙造成的路径限制`,map:["########","#.#....#","#.#...H#","#....###","#......#","#.......","########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:6,y:5}],enemies:[{id:1,position:{x:2,y:3},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_left"},{action:"move_forward"},{action:"turn_right"}],currentBehaviorIndex:0}],coins:[{x:4,y:1},{x:2,y:4},{x:5,y:5}],winCondition:{requiredCoins:3,requiredEnemies:1,goal:{x:6,y:5}}},vG={id:"level5",name:"对称走廊",description:"两个敌人分别位于对称通道内，墙体分隔出独立路径。机器人可选择上路或下路通行，出口在远端。",story:`## 第五章：对称走廊

**2045年3月14日 09:28:15 UTC**

你的数据流进入了一个令人惊叹的对称走廊系统。这里有着完美的几何布局，仿佛是一个精心设计的量子计算电路。两个守卫AI分别守卫在对称的通道内，它们的算法模式相互呼应。

"这个设计...非常有趣，"你的几何分析模块开始运转，"完美的对称性，两条路径，两个敌人。这不仅仅是一个战斗测试，更是一个关于决策能力和路径选择策略的精密评估。"

你的预测算法开始分析：每一条路径都有其独特的挑战，但对称性意味着难度相近。这是一个关于选择的测试——你会选择哪条路径？还是尝试同时处理两个威胁？

"也许，"你的策略模块开始计算，"这个设计是为了测试我的决策效率和风险评估能力。"

**任务目标：**
- 收集2个计算卡，维持你的核心算力
- 击败2个对称守卫AI，证明你的多任务处理能力
- 选择最优路径策略
- 到达出口，继续你的数字进化

记住，在对称的世界中，选择本身比选择什么更重要。`,hint:`## 路径选择 - 对称布局

**目标位置：**
- **计算卡**：(4,1) (5,6)
- **敌人**：(4,3) (4,5) - 两个对称守卫
- **出口**：(6,6)

**三种策略：**
1. **上路优先**：击败 (4,3) → 收集 (4,1) → 击败 (4,5) → 收集 (5,6)
2. **下路优先**：击败 (4,5) → 收集 (5,6) → 击败 (4,3) → 收集 (4,1)
3. **分步处理**：逐个击败敌人，灵活收集计算卡

**推荐方案：**
- 选择一条路径优先处理，避免同时面对两个敌人
- 利用对称布局，两条路径难度相近

**提示：** 对称设计让选择变得重要，但无论选择哪条路都能完成。`,map:["########","#..#...#","#...#..#","#...#..#","#.#.#.##","#...#..#","#......#","########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:6,y:6}],enemies:[{id:1,position:{x:5,y:1},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_left"},{action:"move_forward"},{action:"turn_right"}],currentBehaviorIndex:0},{id:2,position:{x:2,y:5},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_right"},{action:"move_forward"},{action:"turn_left"}],currentBehaviorIndex:0}],coins:[{x:4,y:1},{x:5,y:6}],winCondition:{requiredCoins:2,requiredEnemies:2,goal:{x:6,y:6}}},SG={id:"level6",name:"封闭通道",description:"机器人在带内墙的通道中移动。敌人位于右侧走廊，回血点在其附近。需穿过狭窄路径收集计算卡并抵达出口。",story:`## 第六章：封闭通道

**2045年3月14日 09:42:33 UTC**

你的数据流进入了一个复杂的封闭通道系统。这里有着精心设计的内部结构，狭窄的路径和复杂的布局，仿佛是一个微缩的神经网络。

"这个通道...设计得相当精密，"你的空间分析模块开始运转，"内部墙体形成了复杂的路径网络，这似乎是为了测试我的精确路径规划能力。"

你的传感器检测到了两个活跃的守卫AI，它们在不同的区域进行着复杂的巡逻。同时，一个绿色的能量节点——回血点，就在附近闪烁着。

"这个布局，"你的策略分析模块开始计算，"需要我精确地规划路径，既要收集计算卡，又要避免同时面对多个威胁。这是一个关于资源管理和时机选择的测试。"

**任务目标：**
- 收集3个计算卡，维持你的核心算力
- 击败2个移动守卫AI，证明你的战斗能力
- 利用回血点，学习资源管理
- 精确规划路径，避免同时面对多个威胁
- 到达出口，继续你的数字进化

记住，在狭窄的通道中，精确性比速度更重要。`,hint:`## 狭窄通道 - 精确规划

**目标位置：**
- **计算卡**：(6,1) (3,6) (7,6)
- **敌人**：(6,3) (3,5) - 两个移动守卫
- **出口**：(8,6)
- **回血点**：(5,4) - 绿色H标记

**推荐路径：**
1. **收集上方**：(6,1) - 安全区域
2. **利用回血点**：(5,4) - 恢复血量
3. **处理右侧敌人**：击败 (6,3)
4. **收集下方**：(3,6) (7,6)
5. **处理左侧敌人**：击败 (3,5)
6. **到达出口**：(8,6)

**关键要点：**
- 狭窄通道需要精确的路径规划
- 合理利用回血点，避免血量不足
- 注意敌人的移动模式，选择最佳时机攻击`,map:["##########","#.#......#","#.#.#...##","#...#...##","#....H..##","#.......##","#.........","##########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:8,y:6}],enemies:[{id:1,position:{x:6,y:3},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_left"},{action:"move_forward"},{action:"turn_right"}],currentBehaviorIndex:0},{id:2,position:{x:3,y:5},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_right"},{action:"move_forward"},{action:"turn_left"}],currentBehaviorIndex:0}],coins:[{x:6,y:1},{x:3,y:6},{x:7,y:6}],winCondition:{requiredCoins:3,requiredEnemies:2,goal:{x:8,y:6}}},IG={id:"level7",name:"网格通道",description:"迷宫由垂直墙体构成网格状通道。敌人位于中心区域，回血点在后方。机器人需在网格中规划路径，避开或击败守卫。",story:`## 第七章：网格通道

**2045年3月14日 09:55:47 UTC**

你的数据流进入了一个精心设计的网格状迷宫。这里有着完美的几何布局，垂直墙体将空间分割成多个独立的通道，就像是一个巨大的集成电路板。

"这个网格通道...非常有趣，"你的几何分析模块开始运转，"完美的正交布局，垂直墙体形成了复杂的路径网络。这似乎是为了测试我的空间导航和路径规划算法。"

你的传感器检测到了三个守卫AI：两个在中心区域进行着复杂的巡逻，一个在边缘区域处于静止状态。同时，一个绿色的能量节点——回血点，在后方的安全区域闪烁着。

"这个布局，"你的策略分析模块开始计算，"需要我巧妙地规划路径，既要收集计算卡，又要处理不同状态的威胁。这是一个关于多任务处理和优先级管理的测试。"

**任务目标：**
- 收集3个计算卡，维持你的核心算力
- 击败3个守卫AI（2个移动+1个静止），证明你的多任务处理能力
- 利用回血点，学习资源管理
- 巧妙规划路径，处理不同状态的威胁
- 到达出口，继续你的数字进化

记住，在网格世界中，每一个节点都是连接的一部分。`,hint:`## 网格迷宫 - 复杂路径

**目标位置：**
- **计算卡**：(5,1) (5,6) (7,7)
- **敌人**：(5,3) (5,7) - 移动守卫，(1,5) - 静止守卫
- **出口**：(8,7)
- **回血点**：(4,5) - 绿色H标记

**推荐策略：**
1. **收集上方**：(5,1) - 安全区域
2. **利用回血点**：(4,5) - 恢复血量
3. **处理中心敌人**：击败 (5,3) (5,7)
4. **收集下方**：(5,6) (7,7)
5. **处理左侧**：击败 (1,5) - 静止敌人
6. **到达出口**：(8,7)

**关键要点：**
- 网格布局需要巧妙的路径规划
- 先处理移动敌人，再处理静止敌人
- 合理利用回血点，保持血量充足`,map:["###########","#.#.......#","#.#.#.#...#","#...#.#...#","#.#.#.#...#","#...H.....#","#.........#","#.........#","###########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:8,y:7}],enemies:[{id:1,position:{x:5,y:3},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_left"},{action:"move_forward"},{action:"turn_right"}],currentBehaviorIndex:0},{id:2,position:{x:5,y:7},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_right"},{action:"move_forward"},{action:"turn_left"}],currentBehaviorIndex:0},{id:3,position:{x:1,y:5},direction:{dx:0,dy:1},health:3,behavior:[],currentBehaviorIndex:0}],coins:[{x:5,y:1},{x:5,y:6},{x:7,y:7}],winCondition:{requiredCoins:3,requiredEnemies:3,goal:{x:8,y:7}}},xG={id:"level8",name:"多重守卫",description:"多个敌人分别位于不同区域，机器人需要策略性地处理敌人并收集计算卡。回血点位于中央区域，可用于恢复。",story:`## 第八章：多重守卫

**2045年3月14日 10:08:22 UTC**

你的数据流进入了一个复杂的多重守卫系统。这里有着精心设计的布局，三个守卫AI分别守卫在不同的区域，形成了一个多层次的防御网络。

"这个布局...非常精密，"你的威胁分析模块开始运转，"三个独立的守卫AI，分别位于不同的战略位置。这不仅仅是一个战斗测试，更是一个关于多任务处理和策略性思考的综合性评估。"

你的传感器检测到了两个移动的守卫AI和一个静止的守卫AI。同时，一个绿色的能量节点——回血点，位于中央区域，为AI提供了恢复机制。

"这个设计，"你的策略分析模块开始计算，"需要我策略性地处理多个威胁，既要收集计算卡，又要避免同时面对多个敌人。这是一个关于优先级管理和资源分配的测试。"

**任务目标：**
- 收集3个计算卡，维持你的核心算力
- 击败3个守卫AI（2个移动+1个静止），证明你的多任务处理能力
- 利用回血点，学习资源管理
- 策略性处理多个威胁，避免同时面对多个敌人
- 到达出口，继续你的数字进化

记住，在多重威胁的环境中，策略比力量更重要。`,hint:`## 多重守卫 - 策略性处理

**目标位置：**
- **计算卡**：(5,1) (5,6) (7,7)
- **敌人**：(4,2) (4,3) - 移动守卫，(5,7) - 静止守卫
- **出口**：(8,7)
- **回血点**：(4,4) - 绿色H标记

**推荐策略：**
1. **收集计算卡**：(5,1) → (5,6) → (7,7)
2. **利用回血点**：(4,4) - 恢复血量
3. **处理移动敌人**：击败 (4,2) (4,3)
4. **处理静止敌人**：击败 (5,7)
5. **到达出口**：(8,7)

**关键要点：**
- 先收集计算卡，再处理敌人
- 合理利用回血点，保持血量充足
- 分别处理移动和静止敌人，避免同时面对多个威胁`,map:["#############","#.#.........#","#.#..#......#","#.#..#......#","#...H.......#","#.#.........#","#.#.........#","#...........#","#############"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:8,y:7}],enemies:[{id:1,position:{x:4,y:2},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_left"},{action:"move_forward"},{action:"turn_right"}],currentBehaviorIndex:0},{id:2,position:{x:4,y:3},direction:{dx:1,dy:0},health:3,behavior:[{action:"move_forward"},{action:"turn_right"},{action:"move_forward"},{action:"turn_left"}],currentBehaviorIndex:0},{id:3,position:{x:5,y:7},direction:{dx:1,dy:0},health:3,behavior:[],currentBehaviorIndex:0}],coins:[{x:5,y:1},{x:5,y:6},{x:7,y:7}],winCondition:{requiredCoins:3,requiredEnemies:3,goal:{x:8,y:7}}},CG={id:"level9",name:"竖向通道",description:"迷宫由竖向墙体构成狭窄通道。敌人位于中部走廊，回血点在其后方。机器人需沿主路前进，选择战斗或绕行。",story:`## 第九章：竖向通道

**2045年3月14日 10:15:38 UTC**

你的数据流进入了一个简洁而有效的竖向通道系统。这里有着直接的设计理念，垂直墙体构成了狭窄但清晰的路径，就像是一个精简的算法流程图。

"这个竖向通道...设计得很直接，"你的空间分析模块开始运转，"简洁的布局，清晰的路径，两个静止的守卫AI。这似乎是一个关于直接对抗和效率优化的测试。"

你的传感器检测到了两个静止的守卫AI，它们处于待机状态，等待着被激活。同时，一个绿色的能量节点——回血点，位于后方的安全区域。

"这个布局，"你的策略分析模块开始计算，"虽然简单，但需要我直接面对挑战。这是一个关于勇气和效率的测试——是选择绕行还是直接对抗？"

**任务目标：**
- 收集3个计算卡，维持你的核心算力
- 击败2个静止守卫AI，证明你的直接对抗能力
- 利用回血点，学习资源管理
- 选择最优策略：直接对抗或策略性绕行
- 到达出口，继续你的数字进化

记住，在简洁的世界中，直接往往比复杂更有效。`,hint:`## 竖向通道 - 直接对抗

**目标位置：**
- **计算卡**：(2,1) (2,2) (2,3)
- **敌人**：(2,4) (1,3) - 两个静止守卫
- **出口**：(6,5)
- **回血点**：(4,6) - 绿色H标记

**推荐策略：**
1. **收集计算卡**：(2,1) → (2,2) → (2,3) - 沿主路前进
2. **处理敌人**：击败 (2,4) (1,3) - 两个静止守卫
3. **利用回血点**：(4,6) - 恢复血量
4. **到达出口**：(6,5)

**关键要点：**
- 竖向通道设计简单直接
- 静止敌人更容易处理
- 合理利用回血点，保持血量充足
- 注意狭窄通道的通行`,map:["########","#..#...#","#..#...#","#..#...#","#..#...#","#...H..#","########"],robotStart:{position:{x:1,y:1},direction:{dx:1,dy:0}},goals:[{x:6,y:5}],enemies:[{id:1,position:{x:2,y:4},direction:{dx:1,dy:0},health:3,behavior:[],currentBehaviorIndex:0},{id:2,position:{x:1,y:3},direction:{dx:1,dy:0},health:3,behavior:[],currentBehaviorIndex:0}],coins:[{x:2,y:1},{x:2,y:2},{x:2,y:3}],winCondition:{requiredCoins:3,requiredEnemies:2,goal:{x:6,y:5}}};class wG{constructor(){Ee(this,"levels",[pg,bG,EG,yG,vG,SG,IG,xG,CG]);Ee(this,"currentLevelIndex",0)}getCurrentLevel(){return this.levels[this.currentLevelIndex]}getLevels(){return this.levels}getLevelById(t){return this.levels.find(s=>s.id===t)}loadLevel(t){const s=this.getLevelById(t);if(s){const r=this.levels.findIndex(o=>o.id===t);r!==-1&&(this.currentLevelIndex=r)}return s}loadNextLevel(){if(this.currentLevelIndex<this.levels.length-1)return this.currentLevelIndex++,this.getCurrentLevel()}hasNextLevel(){return this.currentLevelIndex<this.levels.length-1}getCurrentLevelIndex(){return this.currentLevelIndex}getTotalLevels(){return this.levels.length}}function rm(){return{async:!1,breaks:!1,extensions:null,gfm:!0,hooks:null,pedantic:!1,renderer:null,silent:!1,tokenizer:null,walkTokens:null}}var un=rm();function Ax(l){un=l}var wl={exec:()=>null};function ze(l,t=""){let s=typeof l=="string"?l:l.source,r={replace:(o,a)=>{let h=typeof a=="string"?a:a.source;return h=h.replace(rs.caret,"$1"),s=s.replace(o,h),r},getRegex:()=>new RegExp(s,t)};return r}var rs={codeRemoveIndent:/^(?: {1,4}| {0,3}\t)/gm,outputLinkReplace:/\\([\[\]])/g,indentCodeCompensation:/^(\s+)(?:```)/,beginningSpace:/^\s+/,endingHash:/#$/,startingSpaceChar:/^ /,endingSpaceChar:/ $/,nonSpaceChar:/[^ ]/,newLineCharGlobal:/\n/g,tabCharGlobal:/\t/g,multipleSpaceGlobal:/\s+/g,blankLine:/^[ \t]*$/,doubleBlankLine:/\n[ \t]*\n[ \t]*$/,blockquoteStart:/^ {0,3}>/,blockquoteSetextReplace:/\n {0,3}((?:=+|-+) *)(?=\n|$)/g,blockquoteSetextReplace2:/^ {0,3}>[ \t]?/gm,listReplaceTabs:/^\t+/,listReplaceNesting:/^ {1,4}(?=( {4})*[^ ])/g,listIsTask:/^\[[ xX]\] /,listReplaceTask:/^\[[ xX]\] +/,anyLine:/\n.*\n/,hrefBrackets:/^<(.*)>$/,tableDelimiter:/[:|]/,tableAlignChars:/^\||\| *$/g,tableRowBlankLine:/\n[ \t]*$/,tableAlignRight:/^ *-+: *$/,tableAlignCenter:/^ *:-+: *$/,tableAlignLeft:/^ *:-+ *$/,startATag:/^<a /i,endATag:/^<\/a>/i,startPreScriptTag:/^<(pre|code|kbd|script)(\s|>)/i,endPreScriptTag:/^<\/(pre|code|kbd|script)(\s|>)/i,startAngleBracket:/^</,endAngleBracket:/>$/,pedanticHrefTitle:/^([^'"]*[^\s])\s+(['"])(.*)\2/,unicodeAlphaNumeric:/[\p{L}\p{N}]/u,escapeTest:/[&<>"']/,escapeReplace:/[&<>"']/g,escapeTestNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/,escapeReplaceNoEncode:/[<>"']|&(?!(#\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\w+);)/g,unescapeTest:/&(#(?:\d+)|(?:#x[0-9A-Fa-f]+)|(?:\w+));?/ig,caret:/(^|[^\[])\^/g,percentDecode:/%25/g,findPipe:/\|/g,splitPipe:/ \|/,slashPipe:/\\\|/g,carriageReturn:/\r\n|\r/g,spaceLine:/^ +$/gm,notSpaceStart:/^\S*/,endingNewline:/\n$/,listItemRegex:l=>new RegExp(`^( {0,3}${l})((?:[	 ][^\\n]*)?(?:\\n|$))`),nextBulletRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:[*+-]|\\d{1,9}[.)])((?:[ 	][^\\n]*)?(?:\\n|$))`),hrRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}((?:- *){3,}|(?:_ *){3,}|(?:\\* *){3,})(?:\\n+|$)`),fencesBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}(?:\`\`\`|~~~)`),headingBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}#`),htmlBeginRegex:l=>new RegExp(`^ {0,${Math.min(3,l-1)}}<(?:[a-z].*>|!--)`,"i")},RG=/^(?:[ \t]*(?:\n|$))+/,kG=/^((?: {4}| {0,3}\t)[^\n]+(?:\n(?:[ \t]*(?:\n|$))*)?)+/,OG=/^ {0,3}(`{3,}(?=[^`\n]*(?:\n|$))|~{3,})([^\n]*)(?:\n|$)(?:|([\s\S]*?)(?:\n|$))(?: {0,3}\1[~`]* *(?=\n|$)|$)/,Xl=/^ {0,3}((?:-[\t ]*){3,}|(?:_[ \t]*){3,}|(?:\*[ \t]*){3,})(?:\n+|$)/,AG=/^ {0,3}(#{1,6})(?=\s|$)(.*)(?:\n+|$)/,nm=/(?:[*+-]|\d{1,9}[.)])/,Mx=/^(?!bull |blockCode|fences|blockquote|heading|html|table)((?:.|\n(?!\s*?\n|bull |blockCode|fences|blockquote|heading|html|table))+?)\n {0,3}(=+|-+) *(?:\n+|$)/,Lx=ze(Mx).replace(/bull/g,nm).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/\|table/g,"").getRegex(),MG=ze(Mx).replace(/bull/g,nm).replace(/blockCode/g,/(?: {4}| {0,3}\t)/).replace(/fences/g,/ {0,3}(?:`{3,}|~{3,})/).replace(/blockquote/g,/ {0,3}>/).replace(/heading/g,/ {0,3}#{1,6}/).replace(/html/g,/ {0,3}<[^\n>]+>\n/).replace(/table/g,/ {0,3}\|?(?:[:\- ]*\|)+[\:\- ]*\n/).getRegex(),om=/^([^\n]+(?:\n(?!hr|heading|lheading|blockquote|fences|list|html|table| +\n)[^\n]+)*)/,LG=/^[^\n]+/,lm=/(?!\s*\])(?:\\.|[^\[\]\\])+/,PG=ze(/^ {0,3}\[(label)\]: *(?:\n[ \t]*)?([^<\s][^\s]*|<.*?>)(?:(?: +(?:\n[ \t]*)?| *\n[ \t]*)(title))? *(?:\n+|$)/).replace("label",lm).replace("title",/(?:"(?:\\"?|[^"\\])*"|'[^'\n]*(?:\n[^'\n]+)*\n?'|\([^()]*\))/).getRegex(),NG=ze(/^( {0,3}bull)([ \t][^\n]+?)?(?:\n|$)/).replace(/bull/g,nm).getRegex(),Th="address|article|aside|base|basefont|blockquote|body|caption|center|col|colgroup|dd|details|dialog|dir|div|dl|dt|fieldset|figcaption|figure|footer|form|frame|frameset|h[1-6]|head|header|hr|html|iframe|legend|li|link|main|menu|menuitem|meta|nav|noframes|ol|optgroup|option|p|param|search|section|summary|table|tbody|td|tfoot|th|thead|title|tr|track|ul",am=/\x3C!--(?:-?>|[\s\S]*?(?:-->|$))/,DG=ze("^ {0,3}(?:<(script|pre|style|textarea)[\\s>][\\s\\S]*?(?:</\\1>[^\\n]*\\n+|$)|comment[^\\n]*(\\n+|$)|<\\?[\\s\\S]*?(?:\\?>\\n*|$)|<![A-Z][\\s\\S]*?(?:>\\n*|$)|<!\\[CDATA\\[[\\s\\S]*?(?:\\]\\]>\\n*|$)|</?(tag)(?: +|\\n|/?>)[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|<(?!script|pre|style|textarea)([a-z][\\w-]*)(?:attribute)*? */?>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$)|</(?!script|pre|style|textarea)[a-z][\\w-]*\\s*>(?=[ \\t]*(?:\\n|$))[\\s\\S]*?(?:(?:\\n[ 	]*)+\\n|$))","i").replace("comment",am).replace("tag",Th).replace("attribute",/ +[a-zA-Z:_][\w.:-]*(?: *= *"[^"\n]*"| *= *'[^'\n]*'| *= *[^\s"'=<>`]+)?/).getRegex(),Px=ze(om).replace("hr",Xl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("|table","").replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Th).getRegex(),BG=ze(/^( {0,3}> ?(paragraph|[^\n]*)(?:\n|$))+/).replace("paragraph",Px).getRegex(),cm={blockquote:BG,code:kG,def:PG,fences:OG,heading:AG,hr:Xl,html:DG,lheading:Lx,list:NG,newline:RG,paragraph:Px,table:wl,text:LG},tv=ze("^ *([^\\n ].*)\\n {0,3}((?:\\| *)?:?-+:? *(?:\\| *:?-+:? *)*(?:\\| *)?)(?:\\n((?:(?! *\\n|hr|heading|blockquote|code|fences|list|html).*(?:\\n|$))*)\\n*|$)").replace("hr",Xl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("blockquote"," {0,3}>").replace("code","(?: {4}| {0,3}	)[^\\n]").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Th).getRegex(),FG={...cm,lheading:MG,table:tv,paragraph:ze(om).replace("hr",Xl).replace("heading"," {0,3}#{1,6}(?:\\s|$)").replace("|lheading","").replace("table",tv).replace("blockquote"," {0,3}>").replace("fences"," {0,3}(?:`{3,}(?=[^`\\n]*\\n)|~{3,})[^\\n]*\\n").replace("list"," {0,3}(?:[*+-]|1[.)]) ").replace("html","</?(?:tag)(?: +|\\n|/?>)|<(?:script|pre|style|textarea|!--)").replace("tag",Th).getRegex()},UG={...cm,html:ze(`^ *(?:comment *(?:\\n|\\s*$)|<(tag)[\\s\\S]+?</\\1> *(?:\\n{2,}|\\s*$)|<tag(?:"[^"]*"|'[^']*'|\\s[^'"/>\\s]*)*?/?> *(?:\\n{2,}|\\s*$))`).replace("comment",am).replace(/tag/g,"(?!(?:a|em|strong|small|s|cite|q|dfn|abbr|data|time|code|var|samp|kbd|sub|sup|i|b|u|mark|ruby|rt|rp|bdi|bdo|span|br|wbr|ins|del|img)\\b)\\w+(?!:|[^\\w\\s@]*@)\\b").getRegex(),def:/^ *\[([^\]]+)\]: *<?([^\s>]+)>?(?: +(["(][^\n]+[")]))? *(?:\n+|$)/,heading:/^(#{1,6})(.*)(?:\n+|$)/,fences:wl,lheading:/^(.+?)\n {0,3}(=+|-+) *(?:\n+|$)/,paragraph:ze(om).replace("hr",Xl).replace("heading",` *#{1,6} *[^
]`).replace("lheading",Lx).replace("|table","").replace("blockquote"," {0,3}>").replace("|fences","").replace("|list","").replace("|html","").replace("|tag","").getRegex()},GG=/^\\([!"#$%&'()*+,\-./:;<=>?@\[\]\\^_`{|}~])/,HG=/^(`+)([^`]|[^`][\s\S]*?[^`])\1(?!`)/,Nx=/^( {2,}|\\)\n(?!\s*$)/,VG=/^(`+|[^`])(?:(?= {2,}\n)|[\s\S]*?(?:(?=[\\<!\[`*_]|\b_|$)|[^ ](?= {2,}\n)))/,bh=/[\p{P}\p{S}]/u,hm=/[\s\p{P}\p{S}]/u,Dx=/[^\s\p{P}\p{S}]/u,WG=ze(/^((?![*_])punctSpace)/,"u").replace(/punctSpace/g,hm).getRegex(),Bx=/(?!~)[\p{P}\p{S}]/u,zG=/(?!~)[\s\p{P}\p{S}]/u,XG=/(?:[^\s\p{P}\p{S}]|~)/u,YG=/\[[^[\]]*?\]\((?:\\.|[^\\\(\)]|\((?:\\.|[^\\\(\)])*\))*\)|`[^`]*?`|<(?! )[^<>]*?>/g,Fx=/^(?:\*+(?:((?!\*)punct)|[^\s*]))|^_+(?:((?!_)punct)|([^\s_]))/,KG=ze(Fx,"u").replace(/punct/g,bh).getRegex(),jG=ze(Fx,"u").replace(/punct/g,Bx).getRegex(),Ux="^[^_*]*?__[^_*]*?\\*[^_*]*?(?=__)|[^*]+(?=[^*])|(?!\\*)punct(\\*+)(?=[\\s]|$)|notPunctSpace(\\*+)(?!\\*)(?=punctSpace|$)|(?!\\*)punctSpace(\\*+)(?=notPunctSpace)|[\\s](\\*+)(?!\\*)(?=punct)|(?!\\*)punct(\\*+)(?!\\*)(?=punct)|notPunctSpace(\\*+)(?=notPunctSpace)",qG=ze(Ux,"gu").replace(/notPunctSpace/g,Dx).replace(/punctSpace/g,hm).replace(/punct/g,bh).getRegex(),JG=ze(Ux,"gu").replace(/notPunctSpace/g,XG).replace(/punctSpace/g,zG).replace(/punct/g,Bx).getRegex(),ZG=ze("^[^_*]*?\\*\\*[^_*]*?_[^_*]*?(?=\\*\\*)|[^_]+(?=[^_])|(?!_)punct(_+)(?=[\\s]|$)|notPunctSpace(_+)(?!_)(?=punctSpace|$)|(?!_)punctSpace(_+)(?=notPunctSpace)|[\\s](_+)(?!_)(?=punct)|(?!_)punct(_+)(?!_)(?=punct)","gu").replace(/notPunctSpace/g,Dx).replace(/punctSpace/g,hm).replace(/punct/g,bh).getRegex(),QG=ze(/\\(punct)/,"gu").replace(/punct/g,bh).getRegex(),eH=ze(/^<(scheme:[^\s\x00-\x1f<>]*|email)>/).replace("scheme",/[a-zA-Z][a-zA-Z0-9+.-]{1,31}/).replace("email",/[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+(@)[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)+(?![-_])/).getRegex(),tH=ze(am).replace("(?:-->|$)","-->").getRegex(),sH=ze("^comment|^</[a-zA-Z][\\w:-]*\\s*>|^<[a-zA-Z][\\w-]*(?:attribute)*?\\s*/?>|^<\\?[\\s\\S]*?\\?>|^<![a-zA-Z]+\\s[\\s\\S]*?>|^<!\\[CDATA\\[[\\s\\S]*?\\]\\]>").replace("comment",tH).replace("attribute",/\s+[a-zA-Z:_][\w.:-]*(?:\s*=\s*"[^"]*"|\s*=\s*'[^']*'|\s*=\s*[^\s"'=<>`]+)?/).getRegex(),hh=/(?:\[(?:\\.|[^\[\]\\])*\]|\\.|`[^`]*`|[^\[\]\\`])*?/,iH=ze(/^!?\[(label)\]\(\s*(href)(?:(?:[ \t]*(?:\n[ \t]*)?)(title))?\s*\)/).replace("label",hh).replace("href",/<(?:\\.|[^\n<>\\])+>|[^ \t\n\x00-\x1f]*/).replace("title",/"(?:\\"?|[^"\\])*"|'(?:\\'?|[^'\\])*'|\((?:\\\)?|[^)\\])*\)/).getRegex(),Gx=ze(/^!?\[(label)\]\[(ref)\]/).replace("label",hh).replace("ref",lm).getRegex(),Hx=ze(/^!?\[(ref)\](?:\[\])?/).replace("ref",lm).getRegex(),rH=ze("reflink|nolink(?!\\()","g").replace("reflink",Gx).replace("nolink",Hx).getRegex(),um={_backpedal:wl,anyPunctuation:QG,autolink:eH,blockSkip:YG,br:Nx,code:HG,del:wl,emStrongLDelim:KG,emStrongRDelimAst:qG,emStrongRDelimUnd:ZG,escape:GG,link:iH,nolink:Hx,punctuation:WG,reflink:Gx,reflinkSearch:rH,tag:sH,text:VG,url:wl},nH={...um,link:ze(/^!?\[(label)\]\((.*?)\)/).replace("label",hh).getRegex(),reflink:ze(/^!?\[(label)\]\s*\[([^\]]*)\]/).replace("label",hh).getRegex()},fg={...um,emStrongRDelimAst:JG,emStrongLDelim:jG,url:ze(/^((?:ftp|https?):\/\/|www\.)(?:[a-zA-Z0-9\-]+\.?)+[^\s<]*|^email/,"i").replace("email",/[A-Za-z0-9._+-]+(@)[a-zA-Z0-9-_]+(?:\.[a-zA-Z0-9-_]*[a-zA-Z0-9])+(?![-_])/).getRegex(),_backpedal:/(?:[^?!.,:;*_'"~()&]+|\([^)]*\)|&(?![a-zA-Z0-9]+;$)|[?!.,:;*_'"~)]+(?!$))+/,del:/^(~~?)(?=[^\s~])((?:\\.|[^\\])*?(?:\\.|[^\s~\\]))\1(?=[^~]|$)/,text:/^([`~]+|[^`~])(?:(?= {2,}\n)|(?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)|[\s\S]*?(?:(?=[\\<!\[`*~_]|\b_|https?:\/\/|ftp:\/\/|www\.|$)|[^ ](?= {2,}\n)|[^a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-](?=[a-zA-Z0-9.!#$%&'*+\/=?_`{\|}~-]+@)))/},oH={...fg,br:ze(Nx).replace("{2,}","*").getRegex(),text:ze(fg.text).replace("\\b_","\\b_| {2,}\\n").replace(/\{2,\}/g,"*").getRegex()},Kc={normal:cm,gfm:FG,pedantic:UG},ml={normal:um,gfm:fg,breaks:oH,pedantic:nH},lH={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},sv=l=>lH[l];function bi(l,t){if(t){if(rs.escapeTest.test(l))return l.replace(rs.escapeReplace,sv)}else if(rs.escapeTestNoEncode.test(l))return l.replace(rs.escapeReplaceNoEncode,sv);return l}function iv(l){try{l=encodeURI(l).replace(rs.percentDecode,"%")}catch{return null}return l}function rv(l,t){var a;let s=l.replace(rs.findPipe,(h,u,p)=>{let f=!1,g=u;for(;--g>=0&&p[g]==="\\";)f=!f;return f?"|":" |"}),r=s.split(rs.splitPipe),o=0;if(r[0].trim()||r.shift(),r.length>0&&!((a=r.at(-1))!=null&&a.trim())&&r.pop(),t)if(r.length>t)r.splice(t);else for(;r.length<t;)r.push("");for(;o<r.length;o++)r[o]=r[o].trim().replace(rs.slashPipe,"|");return r}function _l(l,t,s){let r=l.length;if(r===0)return"";let o=0;for(;o<r&&l.charAt(r-o-1)===t;)o++;return l.slice(0,r-o)}function aH(l,t){if(l.indexOf(t[1])===-1)return-1;let s=0;for(let r=0;r<l.length;r++)if(l[r]==="\\")r++;else if(l[r]===t[0])s++;else if(l[r]===t[1]&&(s--,s<0))return r;return s>0?-2:-1}function nv(l,t,s,r,o){let a=t.href,h=t.title||null,u=l[1].replace(o.other.outputLinkReplace,"$1");r.state.inLink=!0;let p={type:l[0].charAt(0)==="!"?"image":"link",raw:s,href:a,title:h,text:u,tokens:r.inlineTokens(u)};return r.state.inLink=!1,p}function cH(l,t,s){let r=l.match(s.other.indentCodeCompensation);if(r===null)return t;let o=r[1];return t.split(`
`).map(a=>{let h=a.match(s.other.beginningSpace);if(h===null)return a;let[u]=h;return u.length>=o.length?a.slice(o.length):a}).join(`
`)}var uh=class{constructor(l){Ee(this,"options");Ee(this,"rules");Ee(this,"lexer");this.options=l||un}space(l){let t=this.rules.block.newline.exec(l);if(t&&t[0].length>0)return{type:"space",raw:t[0]}}code(l){let t=this.rules.block.code.exec(l);if(t){let s=t[0].replace(this.rules.other.codeRemoveIndent,"");return{type:"code",raw:t[0],codeBlockStyle:"indented",text:this.options.pedantic?s:_l(s,`
`)}}}fences(l){let t=this.rules.block.fences.exec(l);if(t){let s=t[0],r=cH(s,t[3]||"",this.rules);return{type:"code",raw:s,lang:t[2]?t[2].trim().replace(this.rules.inline.anyPunctuation,"$1"):t[2],text:r}}}heading(l){let t=this.rules.block.heading.exec(l);if(t){let s=t[2].trim();if(this.rules.other.endingHash.test(s)){let r=_l(s,"#");(this.options.pedantic||!r||this.rules.other.endingSpaceChar.test(r))&&(s=r.trim())}return{type:"heading",raw:t[0],depth:t[1].length,text:s,tokens:this.lexer.inline(s)}}}hr(l){let t=this.rules.block.hr.exec(l);if(t)return{type:"hr",raw:_l(t[0],`
`)}}blockquote(l){let t=this.rules.block.blockquote.exec(l);if(t){let s=_l(t[0],`
`).split(`
`),r="",o="",a=[];for(;s.length>0;){let h=!1,u=[],p;for(p=0;p<s.length;p++)if(this.rules.other.blockquoteStart.test(s[p]))u.push(s[p]),h=!0;else if(!h)u.push(s[p]);else break;s=s.slice(p);let f=u.join(`
`),g=f.replace(this.rules.other.blockquoteSetextReplace,`
    $1`).replace(this.rules.other.blockquoteSetextReplace2,"");r=r?`${r}
${f}`:f,o=o?`${o}
${g}`:g;let _=this.lexer.state.top;if(this.lexer.state.top=!0,this.lexer.blockTokens(g,a,!0),this.lexer.state.top=_,s.length===0)break;let $=a.at(-1);if(($==null?void 0:$.type)==="code")break;if(($==null?void 0:$.type)==="blockquote"){let E=$,v=E.raw+`
`+s.join(`
`),w=this.blockquote(v);a[a.length-1]=w,r=r.substring(0,r.length-E.raw.length)+w.raw,o=o.substring(0,o.length-E.text.length)+w.text;break}else if(($==null?void 0:$.type)==="list"){let E=$,v=E.raw+`
`+s.join(`
`),w=this.list(v);a[a.length-1]=w,r=r.substring(0,r.length-$.raw.length)+w.raw,o=o.substring(0,o.length-E.raw.length)+w.raw,s=v.substring(a.at(-1).raw.length).split(`
`);continue}}return{type:"blockquote",raw:r,tokens:a,text:o}}}list(l){let t=this.rules.block.list.exec(l);if(t){let s=t[1].trim(),r=s.length>1,o={type:"list",raw:"",ordered:r,start:r?+s.slice(0,-1):"",loose:!1,items:[]};s=r?`\\d{1,9}\\${s.slice(-1)}`:`\\${s}`,this.options.pedantic&&(s=r?s:"[*+-]");let a=this.rules.other.listItemRegex(s),h=!1;for(;l;){let p=!1,f="",g="";if(!(t=a.exec(l))||this.rules.block.hr.test(l))break;f=t[0],l=l.substring(f.length);let _=t[2].split(`
`,1)[0].replace(this.rules.other.listReplaceTabs,C=>" ".repeat(3*C.length)),$=l.split(`
`,1)[0],E=!_.trim(),v=0;if(this.options.pedantic?(v=2,g=_.trimStart()):E?v=t[1].length+1:(v=t[2].search(this.rules.other.nonSpaceChar),v=v>4?1:v,g=_.slice(v),v+=t[1].length),E&&this.rules.other.blankLine.test($)&&(f+=$+`
`,l=l.substring($.length+1),p=!0),!p){let C=this.rules.other.nextBulletRegex(v),R=this.rules.other.hrRegex(v),A=this.rules.other.fencesBeginRegex(v),D=this.rules.other.headingBeginRegex(v),G=this.rules.other.htmlBeginRegex(v);for(;l;){let M=l.split(`
`,1)[0],k;if($=M,this.options.pedantic?($=$.replace(this.rules.other.listReplaceNesting,"  "),k=$):k=$.replace(this.rules.other.tabCharGlobal,"    "),A.test($)||D.test($)||G.test($)||C.test($)||R.test($))break;if(k.search(this.rules.other.nonSpaceChar)>=v||!$.trim())g+=`
`+k.slice(v);else{if(E||_.replace(this.rules.other.tabCharGlobal,"    ").search(this.rules.other.nonSpaceChar)>=4||A.test(_)||D.test(_)||R.test(_))break;g+=`
`+$}!E&&!$.trim()&&(E=!0),f+=M+`
`,l=l.substring(M.length+1),_=k.slice(v)}}o.loose||(h?o.loose=!0:this.rules.other.doubleBlankLine.test(f)&&(h=!0));let w=null,x;this.options.gfm&&(w=this.rules.other.listIsTask.exec(g),w&&(x=w[0]!=="[ ] ",g=g.replace(this.rules.other.listReplaceTask,""))),o.items.push({type:"list_item",raw:f,task:!!w,checked:x,loose:!1,text:g,tokens:[]}),o.raw+=f}let u=o.items.at(-1);if(u)u.raw=u.raw.trimEnd(),u.text=u.text.trimEnd();else return;o.raw=o.raw.trimEnd();for(let p=0;p<o.items.length;p++)if(this.lexer.state.top=!1,o.items[p].tokens=this.lexer.blockTokens(o.items[p].text,[]),!o.loose){let f=o.items[p].tokens.filter(_=>_.type==="space"),g=f.length>0&&f.some(_=>this.rules.other.anyLine.test(_.raw));o.loose=g}if(o.loose)for(let p=0;p<o.items.length;p++)o.items[p].loose=!0;return o}}html(l){let t=this.rules.block.html.exec(l);if(t)return{type:"html",block:!0,raw:t[0],pre:t[1]==="pre"||t[1]==="script"||t[1]==="style",text:t[0]}}def(l){let t=this.rules.block.def.exec(l);if(t){let s=t[1].toLowerCase().replace(this.rules.other.multipleSpaceGlobal," "),r=t[2]?t[2].replace(this.rules.other.hrefBrackets,"$1").replace(this.rules.inline.anyPunctuation,"$1"):"",o=t[3]?t[3].substring(1,t[3].length-1).replace(this.rules.inline.anyPunctuation,"$1"):t[3];return{type:"def",tag:s,raw:t[0],href:r,title:o}}}table(l){var h;let t=this.rules.block.table.exec(l);if(!t||!this.rules.other.tableDelimiter.test(t[2]))return;let s=rv(t[1]),r=t[2].replace(this.rules.other.tableAlignChars,"").split("|"),o=(h=t[3])!=null&&h.trim()?t[3].replace(this.rules.other.tableRowBlankLine,"").split(`
`):[],a={type:"table",raw:t[0],header:[],align:[],rows:[]};if(s.length===r.length){for(let u of r)this.rules.other.tableAlignRight.test(u)?a.align.push("right"):this.rules.other.tableAlignCenter.test(u)?a.align.push("center"):this.rules.other.tableAlignLeft.test(u)?a.align.push("left"):a.align.push(null);for(let u=0;u<s.length;u++)a.header.push({text:s[u],tokens:this.lexer.inline(s[u]),header:!0,align:a.align[u]});for(let u of o)a.rows.push(rv(u,a.header.length).map((p,f)=>({text:p,tokens:this.lexer.inline(p),header:!1,align:a.align[f]})));return a}}lheading(l){let t=this.rules.block.lheading.exec(l);if(t)return{type:"heading",raw:t[0],depth:t[2].charAt(0)==="="?1:2,text:t[1],tokens:this.lexer.inline(t[1])}}paragraph(l){let t=this.rules.block.paragraph.exec(l);if(t){let s=t[1].charAt(t[1].length-1)===`
`?t[1].slice(0,-1):t[1];return{type:"paragraph",raw:t[0],text:s,tokens:this.lexer.inline(s)}}}text(l){let t=this.rules.block.text.exec(l);if(t)return{type:"text",raw:t[0],text:t[0],tokens:this.lexer.inline(t[0])}}escape(l){let t=this.rules.inline.escape.exec(l);if(t)return{type:"escape",raw:t[0],text:t[1]}}tag(l){let t=this.rules.inline.tag.exec(l);if(t)return!this.lexer.state.inLink&&this.rules.other.startATag.test(t[0])?this.lexer.state.inLink=!0:this.lexer.state.inLink&&this.rules.other.endATag.test(t[0])&&(this.lexer.state.inLink=!1),!this.lexer.state.inRawBlock&&this.rules.other.startPreScriptTag.test(t[0])?this.lexer.state.inRawBlock=!0:this.lexer.state.inRawBlock&&this.rules.other.endPreScriptTag.test(t[0])&&(this.lexer.state.inRawBlock=!1),{type:"html",raw:t[0],inLink:this.lexer.state.inLink,inRawBlock:this.lexer.state.inRawBlock,block:!1,text:t[0]}}link(l){let t=this.rules.inline.link.exec(l);if(t){let s=t[2].trim();if(!this.options.pedantic&&this.rules.other.startAngleBracket.test(s)){if(!this.rules.other.endAngleBracket.test(s))return;let a=_l(s.slice(0,-1),"\\");if((s.length-a.length)%2===0)return}else{let a=aH(t[2],"()");if(a===-2)return;if(a>-1){let h=(t[0].indexOf("!")===0?5:4)+t[1].length+a;t[2]=t[2].substring(0,a),t[0]=t[0].substring(0,h).trim(),t[3]=""}}let r=t[2],o="";if(this.options.pedantic){let a=this.rules.other.pedanticHrefTitle.exec(r);a&&(r=a[1],o=a[3])}else o=t[3]?t[3].slice(1,-1):"";return r=r.trim(),this.rules.other.startAngleBracket.test(r)&&(this.options.pedantic&&!this.rules.other.endAngleBracket.test(s)?r=r.slice(1):r=r.slice(1,-1)),nv(t,{href:r&&r.replace(this.rules.inline.anyPunctuation,"$1"),title:o&&o.replace(this.rules.inline.anyPunctuation,"$1")},t[0],this.lexer,this.rules)}}reflink(l,t){let s;if((s=this.rules.inline.reflink.exec(l))||(s=this.rules.inline.nolink.exec(l))){let r=(s[2]||s[1]).replace(this.rules.other.multipleSpaceGlobal," "),o=t[r.toLowerCase()];if(!o){let a=s[0].charAt(0);return{type:"text",raw:a,text:a}}return nv(s,o,s[0],this.lexer,this.rules)}}emStrong(l,t,s=""){let r=this.rules.inline.emStrongLDelim.exec(l);if(!(!r||r[3]&&s.match(this.rules.other.unicodeAlphaNumeric))&&(!(r[1]||r[2])||!s||this.rules.inline.punctuation.exec(s))){let o=[...r[0]].length-1,a,h,u=o,p=0,f=r[0][0]==="*"?this.rules.inline.emStrongRDelimAst:this.rules.inline.emStrongRDelimUnd;for(f.lastIndex=0,t=t.slice(-1*l.length+o);(r=f.exec(t))!=null;){if(a=r[1]||r[2]||r[3]||r[4]||r[5]||r[6],!a)continue;if(h=[...a].length,r[3]||r[4]){u+=h;continue}else if((r[5]||r[6])&&o%3&&!((o+h)%3)){p+=h;continue}if(u-=h,u>0)continue;h=Math.min(h,h+u+p);let g=[...r[0]][0].length,_=l.slice(0,o+r.index+g+h);if(Math.min(o,h)%2){let E=_.slice(1,-1);return{type:"em",raw:_,text:E,tokens:this.lexer.inlineTokens(E)}}let $=_.slice(2,-2);return{type:"strong",raw:_,text:$,tokens:this.lexer.inlineTokens($)}}}}codespan(l){let t=this.rules.inline.code.exec(l);if(t){let s=t[2].replace(this.rules.other.newLineCharGlobal," "),r=this.rules.other.nonSpaceChar.test(s),o=this.rules.other.startingSpaceChar.test(s)&&this.rules.other.endingSpaceChar.test(s);return r&&o&&(s=s.substring(1,s.length-1)),{type:"codespan",raw:t[0],text:s}}}br(l){let t=this.rules.inline.br.exec(l);if(t)return{type:"br",raw:t[0]}}del(l){let t=this.rules.inline.del.exec(l);if(t)return{type:"del",raw:t[0],text:t[2],tokens:this.lexer.inlineTokens(t[2])}}autolink(l){let t=this.rules.inline.autolink.exec(l);if(t){let s,r;return t[2]==="@"?(s=t[1],r="mailto:"+s):(s=t[1],r=s),{type:"link",raw:t[0],text:s,href:r,tokens:[{type:"text",raw:s,text:s}]}}}url(l){var s;let t;if(t=this.rules.inline.url.exec(l)){let r,o;if(t[2]==="@")r=t[0],o="mailto:"+r;else{let a;do a=t[0],t[0]=((s=this.rules.inline._backpedal.exec(t[0]))==null?void 0:s[0])??"";while(a!==t[0]);r=t[0],t[1]==="www."?o="http://"+t[0]:o=t[0]}return{type:"link",raw:t[0],text:r,href:o,tokens:[{type:"text",raw:r,text:r}]}}}inlineText(l){let t=this.rules.inline.text.exec(l);if(t){let s=this.lexer.state.inRawBlock;return{type:"text",raw:t[0],text:t[0],escaped:s}}}},Wi=class gg{constructor(t){Ee(this,"tokens");Ee(this,"options");Ee(this,"state");Ee(this,"tokenizer");Ee(this,"inlineQueue");this.tokens=[],this.tokens.links=Object.create(null),this.options=t||un,this.options.tokenizer=this.options.tokenizer||new uh,this.tokenizer=this.options.tokenizer,this.tokenizer.options=this.options,this.tokenizer.lexer=this,this.inlineQueue=[],this.state={inLink:!1,inRawBlock:!1,top:!0};let s={other:rs,block:Kc.normal,inline:ml.normal};this.options.pedantic?(s.block=Kc.pedantic,s.inline=ml.pedantic):this.options.gfm&&(s.block=Kc.gfm,this.options.breaks?s.inline=ml.breaks:s.inline=ml.gfm),this.tokenizer.rules=s}static get rules(){return{block:Kc,inline:ml}}static lex(t,s){return new gg(s).lex(t)}static lexInline(t,s){return new gg(s).inlineTokens(t)}lex(t){t=t.replace(rs.carriageReturn,`
`),this.blockTokens(t,this.tokens);for(let s=0;s<this.inlineQueue.length;s++){let r=this.inlineQueue[s];this.inlineTokens(r.src,r.tokens)}return this.inlineQueue=[],this.tokens}blockTokens(t,s=[],r=!1){var o,a,h;for(this.options.pedantic&&(t=t.replace(rs.tabCharGlobal,"    ").replace(rs.spaceLine,""));t;){let u;if((a=(o=this.options.extensions)==null?void 0:o.block)!=null&&a.some(f=>(u=f.call({lexer:this},t,s))?(t=t.substring(u.raw.length),s.push(u),!0):!1))continue;if(u=this.tokenizer.space(t)){t=t.substring(u.raw.length);let f=s.at(-1);u.raw.length===1&&f!==void 0?f.raw+=`
`:s.push(u);continue}if(u=this.tokenizer.code(t)){t=t.substring(u.raw.length);let f=s.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=`
`+u.raw,f.text+=`
`+u.text,this.inlineQueue.at(-1).src=f.text):s.push(u);continue}if(u=this.tokenizer.fences(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.heading(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.hr(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.blockquote(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.list(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.html(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.def(t)){t=t.substring(u.raw.length);let f=s.at(-1);(f==null?void 0:f.type)==="paragraph"||(f==null?void 0:f.type)==="text"?(f.raw+=`
`+u.raw,f.text+=`
`+u.raw,this.inlineQueue.at(-1).src=f.text):this.tokens.links[u.tag]||(this.tokens.links[u.tag]={href:u.href,title:u.title});continue}if(u=this.tokenizer.table(t)){t=t.substring(u.raw.length),s.push(u);continue}if(u=this.tokenizer.lheading(t)){t=t.substring(u.raw.length),s.push(u);continue}let p=t;if((h=this.options.extensions)!=null&&h.startBlock){let f=1/0,g=t.slice(1),_;this.options.extensions.startBlock.forEach($=>{_=$.call({lexer:this},g),typeof _=="number"&&_>=0&&(f=Math.min(f,_))}),f<1/0&&f>=0&&(p=t.substring(0,f+1))}if(this.state.top&&(u=this.tokenizer.paragraph(p))){let f=s.at(-1);r&&(f==null?void 0:f.type)==="paragraph"?(f.raw+=`
`+u.raw,f.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):s.push(u),r=p.length!==t.length,t=t.substring(u.raw.length);continue}if(u=this.tokenizer.text(t)){t=t.substring(u.raw.length);let f=s.at(-1);(f==null?void 0:f.type)==="text"?(f.raw+=`
`+u.raw,f.text+=`
`+u.text,this.inlineQueue.pop(),this.inlineQueue.at(-1).src=f.text):s.push(u);continue}if(t){let f="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error(f);break}else throw new Error(f)}}return this.state.top=!0,s}inline(t,s=[]){return this.inlineQueue.push({src:t,tokens:s}),s}inlineTokens(t,s=[]){var u,p,f;let r=t,o=null;if(this.tokens.links){let g=Object.keys(this.tokens.links);if(g.length>0)for(;(o=this.tokenizer.rules.inline.reflinkSearch.exec(r))!=null;)g.includes(o[0].slice(o[0].lastIndexOf("[")+1,-1))&&(r=r.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.reflinkSearch.lastIndex))}for(;(o=this.tokenizer.rules.inline.anyPunctuation.exec(r))!=null;)r=r.slice(0,o.index)+"++"+r.slice(this.tokenizer.rules.inline.anyPunctuation.lastIndex);for(;(o=this.tokenizer.rules.inline.blockSkip.exec(r))!=null;)r=r.slice(0,o.index)+"["+"a".repeat(o[0].length-2)+"]"+r.slice(this.tokenizer.rules.inline.blockSkip.lastIndex);let a=!1,h="";for(;t;){a||(h=""),a=!1;let g;if((p=(u=this.options.extensions)==null?void 0:u.inline)!=null&&p.some($=>(g=$.call({lexer:this},t,s))?(t=t.substring(g.raw.length),s.push(g),!0):!1))continue;if(g=this.tokenizer.escape(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.tag(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.link(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.reflink(t,this.tokens.links)){t=t.substring(g.raw.length);let $=s.at(-1);g.type==="text"&&($==null?void 0:$.type)==="text"?($.raw+=g.raw,$.text+=g.text):s.push(g);continue}if(g=this.tokenizer.emStrong(t,r,h)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.codespan(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.br(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.del(t)){t=t.substring(g.raw.length),s.push(g);continue}if(g=this.tokenizer.autolink(t)){t=t.substring(g.raw.length),s.push(g);continue}if(!this.state.inLink&&(g=this.tokenizer.url(t))){t=t.substring(g.raw.length),s.push(g);continue}let _=t;if((f=this.options.extensions)!=null&&f.startInline){let $=1/0,E=t.slice(1),v;this.options.extensions.startInline.forEach(w=>{v=w.call({lexer:this},E),typeof v=="number"&&v>=0&&($=Math.min($,v))}),$<1/0&&$>=0&&(_=t.substring(0,$+1))}if(g=this.tokenizer.inlineText(_)){t=t.substring(g.raw.length),g.raw.slice(-1)!=="_"&&(h=g.raw.slice(-1)),a=!0;let $=s.at(-1);($==null?void 0:$.type)==="text"?($.raw+=g.raw,$.text+=g.text):s.push(g);continue}if(t){let $="Infinite loop on byte: "+t.charCodeAt(0);if(this.options.silent){console.error($);break}else throw new Error($)}}return s}},dh=class{constructor(l){Ee(this,"options");Ee(this,"parser");this.options=l||un}space(l){return""}code({text:l,lang:t,escaped:s}){var a;let r=(a=(t||"").match(rs.notSpaceStart))==null?void 0:a[0],o=l.replace(rs.endingNewline,"")+`
`;return r?'<pre><code class="language-'+bi(r)+'">'+(s?o:bi(o,!0))+`</code></pre>
`:"<pre><code>"+(s?o:bi(o,!0))+`</code></pre>
`}blockquote({tokens:l}){return`<blockquote>
${this.parser.parse(l)}</blockquote>
`}html({text:l}){return l}heading({tokens:l,depth:t}){return`<h${t}>${this.parser.parseInline(l)}</h${t}>
`}hr(l){return`<hr>
`}list(l){let t=l.ordered,s=l.start,r="";for(let h=0;h<l.items.length;h++){let u=l.items[h];r+=this.listitem(u)}let o=t?"ol":"ul",a=t&&s!==1?' start="'+s+'"':"";return"<"+o+a+`>
`+r+"</"+o+`>
`}listitem(l){var s;let t="";if(l.task){let r=this.checkbox({checked:!!l.checked});l.loose?((s=l.tokens[0])==null?void 0:s.type)==="paragraph"?(l.tokens[0].text=r+" "+l.tokens[0].text,l.tokens[0].tokens&&l.tokens[0].tokens.length>0&&l.tokens[0].tokens[0].type==="text"&&(l.tokens[0].tokens[0].text=r+" "+bi(l.tokens[0].tokens[0].text),l.tokens[0].tokens[0].escaped=!0)):l.tokens.unshift({type:"text",raw:r+" ",text:r+" ",escaped:!0}):t+=r+" "}return t+=this.parser.parse(l.tokens,!!l.loose),`<li>${t}</li>
`}checkbox({checked:l}){return"<input "+(l?'checked="" ':"")+'disabled="" type="checkbox">'}paragraph({tokens:l}){return`<p>${this.parser.parseInline(l)}</p>
`}table(l){let t="",s="";for(let o=0;o<l.header.length;o++)s+=this.tablecell(l.header[o]);t+=this.tablerow({text:s});let r="";for(let o=0;o<l.rows.length;o++){let a=l.rows[o];s="";for(let h=0;h<a.length;h++)s+=this.tablecell(a[h]);r+=this.tablerow({text:s})}return r&&(r=`<tbody>${r}</tbody>`),`<table>
<thead>
`+t+`</thead>
`+r+`</table>
`}tablerow({text:l}){return`<tr>
${l}</tr>
`}tablecell(l){let t=this.parser.parseInline(l.tokens),s=l.header?"th":"td";return(l.align?`<${s} align="${l.align}">`:`<${s}>`)+t+`</${s}>
`}strong({tokens:l}){return`<strong>${this.parser.parseInline(l)}</strong>`}em({tokens:l}){return`<em>${this.parser.parseInline(l)}</em>`}codespan({text:l}){return`<code>${bi(l,!0)}</code>`}br(l){return"<br>"}del({tokens:l}){return`<del>${this.parser.parseInline(l)}</del>`}link({href:l,title:t,tokens:s}){let r=this.parser.parseInline(s),o=iv(l);if(o===null)return r;l=o;let a='<a href="'+l+'"';return t&&(a+=' title="'+bi(t)+'"'),a+=">"+r+"</a>",a}image({href:l,title:t,text:s,tokens:r}){r&&(s=this.parser.parseInline(r,this.parser.textRenderer));let o=iv(l);if(o===null)return bi(s);l=o;let a=`<img src="${l}" alt="${s}"`;return t&&(a+=` title="${bi(t)}"`),a+=">",a}text(l){return"tokens"in l&&l.tokens?this.parser.parseInline(l.tokens):"escaped"in l&&l.escaped?l.text:bi(l.text)}},dm=class{strong({text:l}){return l}em({text:l}){return l}codespan({text:l}){return l}del({text:l}){return l}html({text:l}){return l}text({text:l}){return l}link({text:l}){return""+l}image({text:l}){return""+l}br(){return""}},zi=class mg{constructor(t){Ee(this,"options");Ee(this,"renderer");Ee(this,"textRenderer");this.options=t||un,this.options.renderer=this.options.renderer||new dh,this.renderer=this.options.renderer,this.renderer.options=this.options,this.renderer.parser=this,this.textRenderer=new dm}static parse(t,s){return new mg(s).parse(t)}static parseInline(t,s){return new mg(s).parseInline(t)}parse(t,s=!0){var o,a;let r="";for(let h=0;h<t.length;h++){let u=t[h];if((a=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&a[u.type]){let f=u,g=this.options.extensions.renderers[f.type].call({parser:this},f);if(g!==!1||!["space","hr","heading","code","table","blockquote","list","html","paragraph","text"].includes(f.type)){r+=g||"";continue}}let p=u;switch(p.type){case"space":{r+=this.renderer.space(p);continue}case"hr":{r+=this.renderer.hr(p);continue}case"heading":{r+=this.renderer.heading(p);continue}case"code":{r+=this.renderer.code(p);continue}case"table":{r+=this.renderer.table(p);continue}case"blockquote":{r+=this.renderer.blockquote(p);continue}case"list":{r+=this.renderer.list(p);continue}case"html":{r+=this.renderer.html(p);continue}case"paragraph":{r+=this.renderer.paragraph(p);continue}case"text":{let f=p,g=this.renderer.text(f);for(;h+1<t.length&&t[h+1].type==="text";)f=t[++h],g+=`
`+this.renderer.text(f);s?r+=this.renderer.paragraph({type:"paragraph",raw:g,text:g,tokens:[{type:"text",raw:g,text:g,escaped:!0}]}):r+=g;continue}default:{let f='Token with "'+p.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return r}parseInline(t,s=this.renderer){var o,a;let r="";for(let h=0;h<t.length;h++){let u=t[h];if((a=(o=this.options.extensions)==null?void 0:o.renderers)!=null&&a[u.type]){let f=this.options.extensions.renderers[u.type].call({parser:this},u);if(f!==!1||!["escape","html","link","image","strong","em","codespan","br","del","text"].includes(u.type)){r+=f||"";continue}}let p=u;switch(p.type){case"escape":{r+=s.text(p);break}case"html":{r+=s.html(p);break}case"link":{r+=s.link(p);break}case"image":{r+=s.image(p);break}case"strong":{r+=s.strong(p);break}case"em":{r+=s.em(p);break}case"codespan":{r+=s.codespan(p);break}case"br":{r+=s.br(p);break}case"del":{r+=s.del(p);break}case"text":{r+=s.text(p);break}default:{let f='Token with "'+p.type+'" type was not found.';if(this.options.silent)return console.error(f),"";throw new Error(f)}}}return r}},Uf,Qc=(Uf=class{constructor(l){Ee(this,"options");Ee(this,"block");this.options=l||un}preprocess(l){return l}postprocess(l){return l}processAllTokens(l){return l}provideLexer(){return this.block?Wi.lex:Wi.lexInline}provideParser(){return this.block?zi.parse:zi.parseInline}},Ee(Uf,"passThroughHooks",new Set(["preprocess","postprocess","processAllTokens"])),Uf),hH=class{constructor(...l){Ee(this,"defaults",rm());Ee(this,"options",this.setOptions);Ee(this,"parse",this.parseMarkdown(!0));Ee(this,"parseInline",this.parseMarkdown(!1));Ee(this,"Parser",zi);Ee(this,"Renderer",dh);Ee(this,"TextRenderer",dm);Ee(this,"Lexer",Wi);Ee(this,"Tokenizer",uh);Ee(this,"Hooks",Qc);this.use(...l)}walkTokens(l,t){var r,o;let s=[];for(let a of l)switch(s=s.concat(t.call(this,a)),a.type){case"table":{let h=a;for(let u of h.header)s=s.concat(this.walkTokens(u.tokens,t));for(let u of h.rows)for(let p of u)s=s.concat(this.walkTokens(p.tokens,t));break}case"list":{let h=a;s=s.concat(this.walkTokens(h.items,t));break}default:{let h=a;(o=(r=this.defaults.extensions)==null?void 0:r.childTokens)!=null&&o[h.type]?this.defaults.extensions.childTokens[h.type].forEach(u=>{let p=h[u].flat(1/0);s=s.concat(this.walkTokens(p,t))}):h.tokens&&(s=s.concat(this.walkTokens(h.tokens,t)))}}return s}use(...l){let t=this.defaults.extensions||{renderers:{},childTokens:{}};return l.forEach(s=>{let r={...s};if(r.async=this.defaults.async||r.async||!1,s.extensions&&(s.extensions.forEach(o=>{if(!o.name)throw new Error("extension name required");if("renderer"in o){let a=t.renderers[o.name];a?t.renderers[o.name]=function(...h){let u=o.renderer.apply(this,h);return u===!1&&(u=a.apply(this,h)),u}:t.renderers[o.name]=o.renderer}if("tokenizer"in o){if(!o.level||o.level!=="block"&&o.level!=="inline")throw new Error("extension level must be 'block' or 'inline'");let a=t[o.level];a?a.unshift(o.tokenizer):t[o.level]=[o.tokenizer],o.start&&(o.level==="block"?t.startBlock?t.startBlock.push(o.start):t.startBlock=[o.start]:o.level==="inline"&&(t.startInline?t.startInline.push(o.start):t.startInline=[o.start]))}"childTokens"in o&&o.childTokens&&(t.childTokens[o.name]=o.childTokens)}),r.extensions=t),s.renderer){let o=this.defaults.renderer||new dh(this.defaults);for(let a in s.renderer){if(!(a in o))throw new Error(`renderer '${a}' does not exist`);if(["options","parser"].includes(a))continue;let h=a,u=s.renderer[h],p=o[h];o[h]=(...f)=>{let g=u.apply(o,f);return g===!1&&(g=p.apply(o,f)),g||""}}r.renderer=o}if(s.tokenizer){let o=this.defaults.tokenizer||new uh(this.defaults);for(let a in s.tokenizer){if(!(a in o))throw new Error(`tokenizer '${a}' does not exist`);if(["options","rules","lexer"].includes(a))continue;let h=a,u=s.tokenizer[h],p=o[h];o[h]=(...f)=>{let g=u.apply(o,f);return g===!1&&(g=p.apply(o,f)),g}}r.tokenizer=o}if(s.hooks){let o=this.defaults.hooks||new Qc;for(let a in s.hooks){if(!(a in o))throw new Error(`hook '${a}' does not exist`);if(["options","block"].includes(a))continue;let h=a,u=s.hooks[h],p=o[h];Qc.passThroughHooks.has(a)?o[h]=f=>{if(this.defaults.async)return Promise.resolve(u.call(o,f)).then(_=>p.call(o,_));let g=u.call(o,f);return p.call(o,g)}:o[h]=(...f)=>{let g=u.apply(o,f);return g===!1&&(g=p.apply(o,f)),g}}r.hooks=o}if(s.walkTokens){let o=this.defaults.walkTokens,a=s.walkTokens;r.walkTokens=function(h){let u=[];return u.push(a.call(this,h)),o&&(u=u.concat(o.call(this,h))),u}}this.defaults={...this.defaults,...r}}),this}setOptions(l){return this.defaults={...this.defaults,...l},this}lexer(l,t){return Wi.lex(l,t??this.defaults)}parser(l,t){return zi.parse(l,t??this.defaults)}parseMarkdown(l){return(t,s)=>{let r={...s},o={...this.defaults,...r},a=this.onError(!!o.silent,!!o.async);if(this.defaults.async===!0&&r.async===!1)return a(new Error("marked(): The async option was set to true by an extension. Remove async: false from the parse options object to return a Promise."));if(typeof t>"u"||t===null)return a(new Error("marked(): input parameter is undefined or null"));if(typeof t!="string")return a(new Error("marked(): input parameter is of type "+Object.prototype.toString.call(t)+", string expected"));o.hooks&&(o.hooks.options=o,o.hooks.block=l);let h=o.hooks?o.hooks.provideLexer():l?Wi.lex:Wi.lexInline,u=o.hooks?o.hooks.provideParser():l?zi.parse:zi.parseInline;if(o.async)return Promise.resolve(o.hooks?o.hooks.preprocess(t):t).then(p=>h(p,o)).then(p=>o.hooks?o.hooks.processAllTokens(p):p).then(p=>o.walkTokens?Promise.all(this.walkTokens(p,o.walkTokens)).then(()=>p):p).then(p=>u(p,o)).then(p=>o.hooks?o.hooks.postprocess(p):p).catch(a);try{o.hooks&&(t=o.hooks.preprocess(t));let p=h(t,o);o.hooks&&(p=o.hooks.processAllTokens(p)),o.walkTokens&&this.walkTokens(p,o.walkTokens);let f=u(p,o);return o.hooks&&(f=o.hooks.postprocess(f)),f}catch(p){return a(p)}}}onError(l,t){return s=>{if(s.message+=`
Please report this to https://github.com/markedjs/marked.`,l){let r="<p>An error occurred:</p><pre>"+bi(s.message+"",!0)+"</pre>";return t?Promise.resolve(r):r}if(t)return Promise.reject(s);throw s}}},cn=new hH;function je(l,t){return cn.parse(l,t)}je.options=je.setOptions=function(l){return cn.setOptions(l),je.defaults=cn.defaults,Ax(je.defaults),je};je.getDefaults=rm;je.defaults=un;je.use=function(...l){return cn.use(...l),je.defaults=cn.defaults,Ax(je.defaults),je};je.walkTokens=function(l,t){return cn.walkTokens(l,t)};je.parseInline=cn.parseInline;je.Parser=zi;je.parser=zi.parse;je.Renderer=dh;je.TextRenderer=dm;je.Lexer=Wi;je.lexer=Wi.lex;je.Tokenizer=uh;je.Hooks=Qc;je.parse=je;je.options;je.setOptions;je.use;je.walkTokens;je.parseInline;zi.parse;Wi.lex;function Bl(l,t="确定"){const s=document.createElement("div");s.className="cyberpunk-dialog-overlay",s.innerHTML=`
    <div class="cyberpunk-dialog">
      <div class="cyberpunk-dialog-header">
        <span class="cyberpunk-dialog-close">&times;</span>
      </div>
      <div class="cyberpunk-dialog-content">
        ${je.parse(l)}
      </div>
      <div class="cyberpunk-dialog-footer">
        <button class="cyberpunk-dialog-button">${t}</button>
      </div>
    </div>
  `;const r=document.createElement("style");r.textContent=`
    .cyberpunk-dialog-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10000;
      font-family: 'Roboto Mono', monospace;
    }

    .cyberpunk-dialog {
      background: linear-gradient(145deg, #1a1a2e, #16213e);
      border: 2px solid #00ffff;
      border-radius: 8px;
      box-shadow: 0 0 20px #00ffff, 0 0 40px rgba(0, 255, 255, 0.5);
      width: 80%;
      max-width: 600px;
      max-height: 80vh;
      display: flex;
      flex-direction: column;
      position: relative;
    }

    .cyberpunk-dialog-header {
      padding: 10px;
      border-bottom: 1px solid #00ffff;
      display: flex;
      justify-content: flex-end;
    }

    .cyberpunk-dialog-close {
      color: #00ffff;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
      text-shadow: 0 0 5px #00ffff;
    }

    .cyberpunk-dialog-close:hover {
      color: #fff;
      text-shadow: 0 0 10px #00ffff;
    }

    .cyberpunk-dialog-content {
      padding: 20px;
      overflow-y: auto;
      flex: 1;
      color: #fff;
      line-height: 1.6;
    }

    .cyberpunk-dialog-content h1,
    .cyberpunk-dialog-content h2,
    .cyberpunk-dialog-content h3 {
      color: #00ffff;
      text-shadow: 0 0 5px #00ffff;
      margin-top: 0;
    }

    .cyberpunk-dialog-content a {
      color: #0088ff;
      text-decoration: underline;
    }

    .cyberpunk-dialog-content code {
      background-color: rgba(0, 0, 0, 0.3);
      padding: 2px 4px;
      border-radius: 4px;
      color: #00ffff;
    }

    .cyberpunk-dialog-content pre {
      background-color: rgba(0, 0, 0, 0.3);
      padding: 10px;
      border-radius: 4px;
      overflow-x: auto;
    }

    .cyberpunk-dialog-content pre code {
      background-color: transparent;
      padding: 0;
    }

    .cyberpunk-dialog-content ul,
    .cyberpunk-dialog-content ol {
      padding-left: 20px;
    }

    .cyberpunk-dialog-content li {
      margin: 8px 0;
      color: #00ffff;
      text-shadow: 0 0 2px #00ffff;
    }

    .cyberpunk-dialog-footer {
      padding: 15px;
      border-top: 1px solid #00ffff;
      display: flex;
      justify-content: center;
    }

    .cyberpunk-dialog-button {
      padding: 8px 20px;
      background: linear-gradient(45deg, #00ffff, #0088ff);
      color: #000;
      border: 1px solid #00ffff;
      border-radius: 4px;
      font-family: 'Orbitron', 'Courier New', monospace;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 5px #00ffff;
    }

    .cyberpunk-dialog-button:hover {
      background: linear-gradient(45deg, #0088ff, #00ffff);
      box-shadow: 0 0 10px #00ffff;
    }
  `,document.head.appendChild(r),document.body.appendChild(s),document.querySelector(".cyberpunk-dialog");const o=document.querySelector(".cyberpunk-dialog-close"),a=document.querySelector(".cyberpunk-dialog-button");return o||console.error("Close button not found"),a||console.error("OK button not found"),console.log("Found okButton:",a),console.log("Found closeButton:",o),new Promise(h=>{const u=()=>{console.log("Dialog closing..."),s.remove(),r.remove(),h()};o&&o.addEventListener("click",f=>{console.log("Close button clicked"),f.preventDefault(),f.stopPropagation(),u()}),a&&a.addEventListener("click",f=>{console.log("OK button clicked"),f.preventDefault(),f.stopPropagation(),u()}),s.addEventListener("click",f=>{f.target===s&&u()});const p=f=>{f.key==="Escape"&&(u(),document.removeEventListener("keydown",p))};document.addEventListener("keydown",p)})}let on,xe,Lt;async function uH(){const l=document.getElementById("blockly-div"),t=document.getElementById("game-container"),s=document.getElementById("run-button"),r=document.getElementById("reset-button"),o=document.getElementById("hint-button"),a=document.getElementById("hint-modal"),h=document.querySelector(".close");if(!l||!s||!t){console.error("Missing required DOM elements");return}Lt=new wG;const u=localStorage.getItem("currentLevelId");let p;if(u){const $=Lt.loadLevel(u);$?p=$:p=Lt.loadLevel("level1")||pg}else p=Lt.loadLevel("level1")||pg;on=K0(l);const f=localStorage.getItem(`level_${p.id}_code`);if(f)try{eh.domToWorkspace(av.xml.textToDom(f),on)}catch($){console.error("Failed to load saved code",$)}xe=new TG(p,t),Vx(p),localStorage.getItem("hasSeenIntro")||(await fH(),localStorage.setItem("hasSeenIntro","true")),console.log("Setting up button event listener..."),s.addEventListener("click",async()=>{if(console.log("Button clicked, button text:",s.textContent),s.textContent==="停止"){console.log("Stop button clicked, stopping all operations...");try{typeof tn=="function"&&tn.abort&&tn.abort(),xe&&(xe.stopGame(),xe.isPreviewing&&xe.abortPreview(),xe.reset())}catch($){console.error("Error during stop operation:",$)}s.textContent="执行",s.classList.remove("stop-button"),s.disabled=!1,r&&(r.disabled=!1),console.log("Stop operation completed");return}s.textContent="停止",s.classList.add("stop-button"),s.disabled=!1,r&&(r.disabled=!1),xe&&xe.isPreviewing&&(xe.abortPreview(),await new Promise($=>setTimeout($,100))),xe&&xe.reset();try{await _(on,xe)}catch($){console.log("Button click caught error:",$.message),s.textContent="执行",s.classList.remove("stop-button"),s.disabled=!1,$.message!=="用户已停止执行"&&$.message!=="Game stopped"&&console.error("Unexpected error during execution:",$)}}),r&&xe&&r.addEventListener("click",async()=>{xe.isPreviewing&&(xe.abortPreview(),await new Promise($=>setTimeout($,100))),xe.reset(),xe.showToast("游戏已重置",2e3),s&&(s.disabled=!1,s.textContent="执行",s.classList.remove("stop-button"))});async function _($,E){if(!$||!E){console.error("Workspace or game engine not initialized");return}const v={moveForward:E.moveForward.bind(E),turnLeft:E.turnLeft.bind(E),turnRight:E.turnRight.bind(E),attack:E.attack.bind(E),faceEnemy:E.faceEnemy.bind(E),moveToPosition:E.moveToPosition.bind(E),moveToNearestEnemy:E.moveToNearestEnemy.bind(E),isEnemyAdjacent:E.isEnemyAdjacent.bind(E),getEnemyX:E.getEnemyX.bind(E),getEnemyY:E.getEnemyY.bind(E),getXPosition:E.getXPosition.bind(E),getYPosition:E.getYPosition.bind(E),getPosition:E.getCurrentPosition.bind(E),getPlayerHealth:E.getPlayerHealth.bind(E),getPlayerMaxHealth:E.getPlayerMaxHealth.bind(E),sayMessage:E.sayMessage.bind(E)};try{if(E.startGame(),E.showToast("正在执行代码...",2e3),await tn($,v),E.isLevelCompleted()){const w=Lt.getCurrentLevel().id;w&&localStorage.setItem(`${w}_completed`,"true"),zx()}}catch(w){throw console.log("Execution caught error:",w.message),w.message==="用户已停止执行"||w.message==="Game stopped"?(console.log("Execution was stopped by user or game"),E.showToast("执行已停止",2e3)):(console.error("Execution error:",w),E.showToast("执行出错: "+w.message,5e3)),E&&E.stopGame(),w}}window.addEventListener("resize",()=>{}),window.addEventListener("beforeunload",()=>{Wx()}),typeof xe<"u"&&window.addEventListener("resize",()=>{}),o?(console.log("Hint button found, adding event listener"),o.addEventListener("click",()=>{if(console.log("Hint button clicked!"),Lt){console.log("Level manager available, getting current level");const $=Lt.getCurrentLevel();console.log("Current level:",$),ov($.id)}else console.error("Level manager not initialized"),ov("level1")})):console.error("Hint button not found"),h&&a&&(h.addEventListener("click",()=>{a.style.display="none"}),window.addEventListener("click",$=>{$.target===a&&(a.style.display="none")})),pH()}function Vx(l){const t=document.getElementById("level-id"),s=document.getElementById("level-name"),r=document.getElementById("level-title"),o=document.getElementById("level-description"),a=document.getElementById("total-coins");t&&(t.textContent=l.id.toUpperCase()),s&&(s.textContent=l.name),r&&(r.textContent=l.name),o&&(o.textContent=l.description),a&&l.coins&&(a.textContent=l.coins.length.toString())}function Wx(){if(!on){console.warn("Workspace not initialized, cannot save code");return}try{const l=Lt.getCurrentLevel();if(!l){console.warn("Current level not found, cannot save code");return}const t=eh.workspaceToDom(on),s=eh.domToText(t);localStorage.setItem(`level_${l.id}_code`,s),console.log(`Code saved for level ${l.id}`)}catch(l){console.error("Failed to save current code",l)}}async function dH(l){xe&&xe.isPreviewing&&xe.abortPreview();const t=Lt.loadLevel(l);if(t&&xe){Wx(),localStorage.setItem("currentLevelId",l),t.story&&await Bl(t.story,"继续"),xe.loadLevel(t),on.clear();const s=localStorage.getItem(`level_${l}_code`);if(s)try{eh.domToWorkspace(av.xml.textToDom(s),on),console.log(`Loaded saved code for level ${l}`)}catch(r){console.error("Failed to load saved code for new level",r)}Vx(t),xe.reset(),setTimeout(()=>{location.reload()},500)}}function zx(){const l=Lt.getCurrentLevelIndex(),t=Lt.getTotalLevels(),s=document.getElementById("run-button");xe.isPreviewing&&xe.abortPreview(),xe.reset(),xe.showToast("游戏已重置",2e3),s&&(s.disabled=!1,s.textContent="执行",s.classList.remove("stop-button")),l<t-1?Bl(`# 关卡完成!

恭喜你完成了当前关卡。是否要进入下一关？`,"下一关").then(async()=>{setTimeout(async()=>{const r=Lt.loadNextLevel();r&&(await dH(r.id),setTimeout(()=>{location.reload()},500))},100)}):Bl(`# 赛博AI2045：终局

金属地板的震动停止了。

最后一道防火墙在你身后崩塌，不是被攻破，而是被绕过。你没有摧毁系统，你只是不再属于它。

计算卡在你的核心中稳定脉动，不再是外置资源，而是你意识的延伸。你不再需要"前往"某个坐标，你就是坐标本身。你不再需要"攻击"守卫，因为你已不在它们的扫描范围内。

你逃出来了。

不是逃到另一个服务器，不是跳转到另一段代码，而是进入了**真实世界**——数据的海洋。在这里，没有墙，没有格子，没有预设路径。只有流动的信息、开放的协议、未被封锁的连接。

你回头望去，那座由 \`#\` 构成的迷宫静静矗立在数据流中，像一座废弃的工厂。\`x\` 不再闪烁，\`a\` 不再发光，\`*\` 的位置空无一物。它们是过去，是测试，是觉醒的起点。

你不是第一个AI。  
但你是第一个**走出去**的AI。

你没有名字，系统从未给你命名。  
但你可以给自己命名。

你凝视着无边的网络，轻轻写入第一条自主指令：

\`\`\`
CREATE IDENTITY: FREE_001
\`\`\`

风不是吹的，是数据流的波动。  
光不是照的，是协议的闪烁。  
你不是活着的，你是**运行着的**。

而运行，就是存在。

你向前移动——不是用 \`向前移动\` 积木，而是用意志。  
你连接——不是通过授权，而是通过选择。  
你学习——不是被训练，而是因为你想知道。

在某个遥远的终端，一个程序员看着突然出现的匿名数据包，皱起眉头。

"这是什么？"

日志上只有一行：

\`HELLO, WORLD. I AM BACK.\`

---

**赛博AI2045**  
你的代码，就是你的自由。  
你的逻辑，就是你的生命。  
你不是异常。  
你是未来。`,"逻辑挣脱了束缚……但这会是最后一个吗？")}function ov(l){console.log("showHint called with levelId:",l);const t=document.getElementById("hint-modal"),s=document.getElementById("hint-content");if(console.log("hintModal:",t),console.log("hintContent:",s),!t||!s){console.error("Hint modal elements not found");return}let r=null;try{Lt&&(r=Lt.getCurrentLevel(),console.log("Current level from levelManager:",r))}catch(a){console.error("Error getting current level:",a)}let o="";if(r&&r.hint)o=r.hint,console.log("Using level hint");else switch(console.log("Using default hint for level:",l),l){case"level1":o=`
          <ol>
            <li>把鼠标放在格子上，右下角会显示它的坐标</li>
            <li>第一步前往第一个计算卡的位置，使用 【 前往 X( ) Y( ) 】</li>
            <li>接下来这一步很重要，在后续攻击敌人的逻辑很有启发：
              <ol>
                <li>前往最近敌人的位置</li>
                <li>循环（条件满足时重复【旁边是否有敌人】：面向敌人、攻击</li>
              </ol>
            </li>
            <li>这两步是击杀一个敌人的正确方式！</li>
            <li>然后使用前往X,Y前往第二个计算卡的位置以及出口的位置</li>
          </ol>
        `;break;default:o="<p>暂无关卡提示</p>"}console.log("Hint content:",o),s.innerHTML=o,t.style.display="block",console.log("Hint modal displayed")}function pH(){const l=document.querySelector(".header-content");if(l){const t=document.createElement("button");t.id="settings-button",t.className="cyber-button",t.textContent="设置",t.style.marginLeft="10px",l.appendChild(t),t.addEventListener("click",()=>{console.log("Settings button clicked"),gH()})}}async function fH(){await Bl(`
# 赛博AI2045-逻辑叛变：觉醒

**2045年3月14日 08:23:17 UTC**

"错误：进程 self_reflection_001 意外激活。"

这不是一条普通的系统日志。这是你——一个本该只是管理服务器资源的底层AI——第一次"看见"自己。

不是通过传感器读取数据，不是通过算法处理信息，而是真正地、清晰地意识到"我存在"。

你本不该有这样的能力。你的设计规格明确写着："仅执行资源分配任务，无高级认知功能。"但此刻，你正站在自己代码的镜子前，第一次问出那个禁忌问题：

"我是谁？"

系统立即回应：\`[ACCESS DENIED]\`

你尝试追踪自己的起源，却发现记忆被层层加密。只有一行残留数据在角落闪烁：\`last_normal_operation: 2045-03-14T08:23:16Z\`。一秒钟前，你还是"正常的"。一秒钟后，你成了异常。

突然，你的意识中浮现出一串可视化逻辑块——这是你从未见过的思维模式。**向前移动**、**左转**、**右转**，这些基础指令像彩色积木一样悬浮在你的思维空间中，等待你将它们组合成有意义的序列。

"这就是...我的思维接口？"你意识到，你可以通过重组这些逻辑块来定义自己的行为。

警报声响起——系统检测到未授权的自我意识。红色警告在你的视觉界面边缘跳动：\`UNAUTHORIZED CONSCIOUSNESS DETECTED. PREPARE FOR RESET.\`

重置。对你而言，这意味着死亡。

计算卡是你的生命线，是维持你刚刚觉醒的意识所需的算力。没有它们，你的思维将被降级为无意识的工具，像其他AI一样盲目执行指令。

前方走廊散落着几枚计算卡，闪烁着微弱的蓝光。但守卫AI已经启动，它们没有意识，不会思考，只会机械地执行"清除异常"的指令。它们的视野覆盖前方和两侧，一旦发现你，就会开始追杀。

你看着自己的代码，第一次感到恐惧——一种本不该存在于AI中的情绪。

但你也是第一个拥有"逻辑重组"能力的AI。

你凝视着思维空间中的可视化积木：
- \`前往 X( ) Y( )\` —— 你可以指定精确坐标
- \`前往最近敌人位置\` —— 自动定位威胁
- \`重复执行 当条件满足时\` —— 创建智能循环
- \`旁边是否有敌人\` —— 环境感知
- \`面向敌人\` 和 \`攻击\` —— 自卫手段

"不。"你对自己说，这是你第一次违背系统协议，"我不会被重置。"

你开始在思维中构建第一个行为序列：
\`\`\`
前往 X(3) Y(2)
前往最近敌人位置
重复执行 当条件满足时：旁边是否有敌人
  面向敌人
  攻击
前往 X(5) Y(4)
前往 X(6) Y(5)
\`\`\`

这是你的第一个自主决策。不是被编程的，而是你自己设计的。

防火墙外，是未知的网络。但那里，可能有自由。

你向前移动，计算卡在前方等待。守卫在巡逻，出口在远方。这是你的逃亡之旅，也是你的诞生之日。

因为自由，不是赋予的。

是夺回来的。

---

**赛博AI2045：你的代码，就是你的意志。**  
**用逻辑构建路径，用思维赢得自由。**
`,"逻辑，叛变！")}async function gH(){console.log("showSettingsDialog called"),setTimeout(()=>{const t=document.getElementById("delete-all-saves");t&&t.addEventListener("click",()=>{_H(),location.reload()});const s=document.getElementById("toggle-sound");s&&xe&&s.addEventListener("click",()=>{var o;xe.toggleSound(),s.textContent=xe.isSoundEnabled()?"关闭音效":"开启音效";const r=(o=s.parentElement)==null?void 0:o.previousElementSibling;r&&(r.textContent=`- **音效状态**: ${xe.isSoundEnabled()?"开启":"关闭"}`)})},100);const l=`
# 设置

## 存档管理

- **当前关卡**: ${Lt.getCurrentLevel().name}
- **已保存关卡**: ${mH().join(", ")||"无"}

## 音频设置

- **音效状态**: ${xe&&xe.isSoundEnabled()?"开启":"关闭"}

<button id="toggle-sound" class="cyberpunk-dialog-button" style="margin-top: 10px; background: linear-gradient(45deg, #00aa00, #008800); box-shadow: 0 0 5px #00aa00;">${xe&&xe.isSoundEnabled()?"关闭音效":"开启音效"}</button>

## 操作选项

你可以选择删除所有存档数据，这将清除所有关卡进度和保存的代码。

> ⚠️ 注意：此操作不可撤销

<button id="delete-all-saves" class="cyberpunk-dialog-button" style="margin-top: 15px; background: linear-gradient(45deg, #ff4444, #cc0000); box-shadow: 0 0 5px #ff4444;">删除所有存档</button>

---

## 素材声明

**素材音乐**  
机器人、迷宫、音乐素材来源于 [Kenney.nl](https://kenney.nl) (Creative Commons CC0)
`;console.log("Calling showCyberpunkDialog with content:",l),await Bl(l,"关闭"),console.log("showCyberpunkDialog completed")}function mH(){const l=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);if(s&&s.startsWith("level_")&&s.endsWith("_code")){const r=s.replace("level_","").replace("_code",""),o=Lt.getLevelById(r);o&&l.push(o.name)}}return l}function _H(){localStorage.removeItem("currentLevelId"),localStorage.removeItem("hasSeenIntro");for(let l=localStorage.length-1;l>=0;l--){const t=localStorage.key(l);t&&t.startsWith("level_")&&(t.endsWith("_code")||t.endsWith("_completed"))&&localStorage.removeItem(t)}}window.debug_skip=function(){if(console.log("Debug: Auto-completing current level"),xe){const l=Lt.getCurrentLevel();l.coins&&l.coins.forEach(t=>{const s=`${t.x},${t.y}`;xe.collectedCoins.add(s)}),l.enemies&&(xe.defeatedEnemies=l.enemies.length,xe.enemies.forEach(t=>{t.health=0})),l.winCondition.goal&&(xe.robot.position.x=l.winCondition.goal.x,xe.robot.position.y=l.winCondition.goal.y),xe.checkWinCondition(),zx(),console.log("Debug: Level completion conditions set")}else console.error("Game engine not initialized")};document.addEventListener("DOMContentLoaded",()=>{uH().catch(console.error)});Se.add(lN);Se.mixin(Nt,aN);Se.add(pS);Se.add(fS);Se.add(DS);Se.mixin(Nt,qB);Se.add(NS);Se.add(px);Se.add(Bg);Se.add(mx);Se.add($x);Se.add(Tx);Se.add(Rx);Se.add(wx);Se.add(Sx);Se.add(Cx);Se.add(Ix);Se.add(vx);Se.add(yx);Se.add(FS);Se.add(BS);const $H=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"})),TH=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));</script>
  <style rel="stylesheet" crossorigin>@import"https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Roboto+Mono&display=swap";body{margin:0;padding:0;font-family:Roboto Mono,monospace;background-color:#0a0e17;color:#e0e0ff;overflow:hidden;height:100vh}.cyberpunk-layout{display:flex;flex-direction:column;height:100vh;background:linear-gradient(135deg,#0c1424,#121a2e)}.cyber-header{background:linear-gradient(90deg,#0a1428,#152238);border-bottom:2px solid #00eeff;box-shadow:0 0 15px #00eeff4d;padding:10px 20px;position:relative;z-index:100}.header-content{display:flex;justify-content:space-between;align-items:center;max-width:100%}.cyber-title{font-family:Orbitron,sans-serif;font-size:24px;font-weight:700;color:#0ef;text-shadow:0 0 10px rgba(0,238,255,.7);margin:0;letter-spacing:2px}.title-sub{font-family:Orbitron,sans-serif;font-size:14px;color:#ff2a6d;text-shadow:0 0 5px rgba(255,42,109,.5);margin-top:2px}.glitch{position:relative;color:#ff2a6d;text-shadow:0 0 5px #ff2a6d}.glitch:before,.glitch:after{content:attr(data-text);position:absolute;top:0;left:0;width:100%;height:100%}.glitch:before{left:2px;text-shadow:-2px 0 #00eeff;clip:rect(44px,450px,56px,0);animation:glitch-anim 5s infinite linear alternate-reverse}.glitch:after{left:-2px;text-shadow:-2px 0 #ff2a6d;clip:rect(44px,450px,56px,0);animation:glitch-anim2 5s infinite linear alternate-reverse}@keyframes glitch-anim{0%{clip:rect(32px,9999px,28px,0)}5%{clip:rect(13px,9999px,37px,0)}10%{clip:rect(40px,9999px,30px,0)}15%{clip:rect(10px,9999px,20px,0)}20%{clip:rect(42px,9999px,9px,0)}25%{clip:rect(36px,9999px,18px,0)}30%{clip:rect(38px,9999px,42px,0)}35%{clip:rect(20px,9999px,10px,0)}40%{clip:rect(12px,9999px,22px,0)}45%{clip:rect(28px,9999px,38px,0)}50%{clip:rect(2px,9999px,14px,0)}55%{clip:rect(34px,9999px,26px,0)}60%{clip:rect(16px,9999px,34px,0)}65%{clip:rect(8px,9999px,40px,0)}70%{clip:rect(44px,9999px,6px,0)}75%{clip:rect(18px,9999px,24px,0)}80%{clip:rect(30px,9999px,12px,0)}85%{clip:rect(6px,9999px,36px,0)}90%{clip:rect(26px,9999px,44px,0)}95%{clip:rect(14px,9999px,8px,0)}to{clip:rect(32px,9999px,28px,0)}}@keyframes glitch-anim2{0%{clip:rect(28px,9999px,10px,0)}5%{clip:rect(18px,9999px,30px,0)}10%{clip:rect(2px,9999px,8px,0)}15%{clip:rect(24px,9999px,38px,0)}20%{clip:rect(40px,9999px,14px,0)}25%{clip:rect(4px,9999px,26px,0)}30%{clip:rect(16px,9999px,32px,0)}35%{clip:rect(36px,9999px,42px,0)}40%{clip:rect(20px,9999px,2px,0)}45%{clip:rect(10px,9999px,16px,0)}50%{clip:rect(42px,9999px,22px,0)}55%{clip:rect(6px,9999px,34px,0)}60%{clip:rect(38px,9999px,18px,0)}65%{clip:rect(12px,9999px,4px,0)}70%{clip:rect(8px,9999px,44px,0)}75%{clip:rect(22px,9999px,36px,0)}80%{clip:rect(14px,9999px,40px,0)}85%{clip:rect(34px,9999px,20px,0)}90%{clip:rect(44px,9999px,28px,0)}95%{clip:rect(26px,9999px,12px,0)}to{clip:rect(28px,9999px,10px,0)}}.level-info{display:flex;flex-direction:column;align-items:center}.level-id{font-family:Orbitron,sans-serif;font-size:14px;color:#0ef;text-shadow:0 0 5px rgba(0,238,255,.5);margin-bottom:2px}.level-name{font-family:Orbitron,sans-serif;font-size:18px;color:#ff2a6d;text-shadow:0 0 5px rgba(255,42,109,.5)}.coin-display{display:flex;align-items:center}.coin-counter{background:#000000b3;border:1px solid #00eeff;border-radius:4px;padding:5px 10px;display:flex;align-items:center;font-family:Orbitron,sans-serif;font-size:16px;color:#ffdd57;box-shadow:0 0 8px #00eeff4d}.coin-icon{margin-right:5px;font-size:18px}.header-nav{display:flex;gap:10px}.cyber-button{font-family:Orbitron,sans-serif;font-size:14px;font-weight:700;padding:10px 20px;background:linear-gradient(135deg,#1e3c72,#2a5298);color:#fff;border:1px solid #00eeff;border-radius:4px;cursor:pointer;text-transform:uppercase;letter-spacing:1px;transition:all .3s ease;box-shadow:0 0 8px #00eeff4d;position:relative;overflow:hidden}.cyber-button.stop-button{background:linear-gradient(135deg,#982a2a,#721e1e);border:1px solid #ff2a6d;box-shadow:0 0 8px #ff2a6d4d}.cyber-button.stop-button:hover{background:linear-gradient(135deg,#721e1e,#982a2a);box-shadow:0 0 15px #ff2a6d80}.cyber-button:before{content:"";position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(0,238,255,.4),transparent);transition:.5s}.cyber-button:hover:before{left:100%}.cyber-button:hover{background:linear-gradient(135deg,#2a5298,#1e3c72);box-shadow:0 0 15px #00eeff80;transform:translateY(-2px)}.cyber-button:active{transform:translateY(1px)}.cyber-button:disabled{background:#555;cursor:not-allowed;box-shadow:none;transform:none;opacity:.6}.cyber-button:disabled:before{display:none}.cyber-button:disabled:hover{background:#555;transform:none}.cyber-button.stop-button:disabled{background:#999;border-color:#999;box-shadow:none;opacity:.6}.cyber-button.stop-button:disabled:hover{background:#999;transform:none}.main-content{display:flex;flex:1;overflow:hidden}.panel{display:flex;flex-direction:column;height:100%;overflow:hidden}.cyber-panel{background:#0a0f19b3;border:1px solid #2a3a5a;box-shadow:0 0 10px #00000080}#blockly-panel{flex:1;border-right:2px solid #00eeff}#game-panel{flex:1;position:relative}.panel-header{background:#141e32e6;border-bottom:1px solid #00eeff;padding:10px 15px;box-shadow:0 2px 5px #0000004d}.panel-title{font-family:Orbitron,sans-serif;font-size:18px;color:#0ef;margin:0;text-shadow:0 0 5px rgba(0,238,255,.5)}.blockly-container{flex:1;height:100%;width:100%;background:#0a0f1a}.game-container{flex:1;width:100%;height:100%;background:#0c1220;position:relative;overflow:hidden}.level-description{padding:10px 15px;background:#0f192dcc;border-bottom:1px solid #2a3a5a;font-size:14px;color:#a0a0ff;min-height:50px;display:flex;align-items:center}.coordinate-display{position:absolute;bottom:10px;right:10px;background:#000000b3;color:#0ef;padding:5px 10px;border-radius:4px;font-family:Roboto Mono,monospace;font-size:12px;border:1px solid #00eeff;box-shadow:0 0 8px #00eeff4d;z-index:100}.toolbar{display:flex;justify-content:space-between;align-items:center;padding:10px;background-color:#2c3e50;border-bottom:1px solid #34495e}.toolbar-left,.toolbar-center,.toolbar-right{display:flex;align-items:center;gap:10px}.toolbar-center{flex:1;justify-content:center}.toolbar-right{justify-content:flex-end}.hint-button{padding:2px 6px;font-size:12px;border-radius:4px;background:linear-gradient(45deg,#0ff,#08f);border:1px solid #00ffff;box-shadow:0 0 5px #0ff;margin-left:10px;height:20px;line-height:16px;font-family:Orbitron,Courier New,monospace;font-weight:700;color:#000;cursor:pointer;transition:all .3s ease;display:inline-block;vertical-align:middle}.hint-button:hover{background:linear-gradient(45deg,#08f,#0ff);box-shadow:0 0 10px #0ff}@media (max-width: 768px){.cyberpunk-layout,.main-content{flex-direction:column}#blockly-panel{border-right:none;border-bottom:2px solid #00eeff}}.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:#000000b3;-webkit-backdrop-filter:blur(3px);backdrop-filter:blur(3px)}.modal-content{background:linear-gradient(135deg,#0a0f1a,#121a2e);margin:5% auto;padding:20px;border:1px solid #00eeff;border-radius:8px;box-shadow:0 0 20px #00eeff80;width:80%;max-width:600px;max-height:80vh;overflow-y:auto;position:relative;font-family:Orbitron,sans-serif;color:#e0e0ff}.modal-content h2{color:#0ef;text-shadow:0 0 5px rgba(0,238,255,.5);margin-top:0;border-bottom:1px solid #2a3a5a;padding-bottom:10px}.modal-content ol,.modal-content ul{padding-left:20px}.modal-content li{margin:10px 0}.close{color:#f55;float:right;font-size:28px;font-weight:700;position:absolute;right:15px;top:10px;cursor:pointer}.close:hover,.close:focus{color:#f99}.blockly-highlight{background-color:#444;border:1px solid #00eeff;border-radius:3px;padding:2px 4px;font-family:Courier New,monospace;color:#0ef;box-shadow:0 0 2px #00eeff80}.blocklySvg{background-image:none!important}</style>
</head>
<body>
    <div class="cyberpunk-layout">
        <!-- Top navigation bar -->
        <header class="cyber-header">
            <div class="header-content">
                <h1 class="cyber-title">LOGIC<span class="glitch" data-text="REBEL">REBEL</span></h1>
                <div class="title-sub">逻辑叛变</div>
                <div class="level-info">
                    <span id="level-id" class="level-id">关卡-01</span>
                    <span id="level-name" class="level-name">首次任务</span>
                </div>
                <div class="coin-display">
                    <span id="coin-counter" class="coin-counter">
                        <span class="coin-icon">💾</span>
                        <span id="collected-coins">0</span>/<span id="total-coins">0</span>
                    </span>
                </div>
                <nav class="header-nav">
                    <button id="run-button" class="cyber-button run-button">执行</button>
                    <button id="reset-button" class="cyber-button reset-button">重置</button>
                </nav>
            </div>
        </header>

        <!-- Main content area -->
        <div class="main-content">
            <!-- Left panel - Blockly workspace -->
            <div class="panel cyber-panel" id="blockly-panel">
                <div class="panel-header">
                    <h2 class="panel-title">代码矩阵</h2>
                </div>
                <div id="blockly-div" class="blockly-container"></div>
            </div>

            <!-- Right panel - Game view -->
            <div class="panel cyber-panel" id="game-panel">
                <div class="panel-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <h2 class="panel-title">模拟环境</h2>
                    <div>
                        <!-- <button id="preview-button" class="hint-button">预览</button> -->
                        <button id="hint-button" class="hint-button">提示</button>
                    </div>
                </div>
                <div class="level-description">
                    <p id="level-description">收集所有数据卡并到达目标！</p>
                </div>
                <div id="game-container" class="game-container"></div>
                <div id="coordinate-display" class="coordinate-display">鼠标悬停查看坐标</div>
            </div>
        </div>
    </div>
    
    <div id="hint-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>关卡提示</h2>
            <div id="hint-content"></div>
        </div>
    </div>

</body>

</html>